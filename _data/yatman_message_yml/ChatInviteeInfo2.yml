ChatInviteeInfo2: # This is page name
  # Jump from ChatPage, responsible to turn 1 to 1 to group chat, and attach invited Message Doc
  module: meetingroom
  title: 'ChatInviteeInfo2'
  init:
    - .SignInCheck
  save:
    - =..inviteToChat.edgeAPI.store: ''

  input:
    InviteePhoneNumber: ''
    firstName: ''
    lastName: ''
    fullName: ''
    InviterName: .Global.currentUser.vertex.name.userName

  inviteToChat:
    response: ''
    edge:
      id: ''
      type: 1091
      refid: ''
      name: ''
      subType: 1 # 0 for 1 to 1 chat ,  1 for group chat
    edgeAPI:
      .EdgeAPI: ''
      store:
        api: ce
        dataIn: inviteToChat.edge
        dataOut: inviteToChat.response

  newInviteMessage: # every time a user is invited to a group chat, put in a doc to the root chat
    document: #DOC
      eid: ''
      subtype:
        isOnServer: 1
        isZipped: 0 # 0 not gziped  1  gziped
        isBinary: 0 # 0 Base64       1  binary
        isEncrypted: 0 #0 no         1  encrypted
        isExtraKeyNeeded: 0 #0 no   1  yes
        isEditable: 0 #0  no        1  yes
        applicationDataType: 0 #0 data
        mediaType: 8 # text
      type: 1281 # invite user doc
      name:
        title: fileMessage
        data: '' # ..input
    docAPI: # DOCAPI
      store:
        api: cd
        dataKey: newInviteMessage.document

  components:
    - .BaseHeader3:
    - .HeaderLeftButton:
    # - .HeaderRightButton:
    #   text: Contacts
    - type: view
      style:
        left: '0'
        top: '0.12'
        width: '1'
        height: '0.35'
      children:
        - type: label
          text: 'Phone #'
          style:
            left: '0.1333'
            top: '0.05'
            width: '0.72'
            height: '0.03'
            fontSize: '16'
        - type: textField
          dataKey: input.InviteePhoneNumber
          contentType: phone
          style:
            left: '0.1333'
            top: '0.09'
            width: '0.72'
            height: '0.03'
            fontSize: '19'
            color: '0x707070ff'
            border:
              style: '2'
              color: '0x707070ff'
            borderWidth: '1'
        - type: label
          text: 'First Name:'
          style:
            left: '0.1333'
            top: '0.155'
            width: '0.72'
            height: '0.03'
            fontSize: '16'
        - type: textField
          dataKey: input.firstName
          contentType: text
          style:
            left: '0.1333'
            top: '0.195'
            width: '0.72'
            height: '0.03'
            fontSize: '19'
            color: '0x707070ff'
            border:
              style: '2'
              color: '0x707070ff'
            borderWidth: '1'
        - type: label
          text: 'Last Name:'
          style:
            left: '0.1333'
            top: '0.26'
            width: '0.72'
            height: '0.03'
            fontSize: '16'
        - type: textField
          dataKey: input.lastName
          contentType: text
          style:
            left: '0.1333'
            top: '0.3'
            width: '0.72'
            height: '0.03'
            fontSize: '19'
            color: '0x707070ff'
            border:
              style: '2'
              color: '0x707070ff'
            borderWidth: '1'
    - type: button
      onClick:
        - actionType: popUp
          popUpView: confirmView
      text: Invite
      style:
        left: '0.1'
        top: '0.75'
        width: '0.8'
        height: '0.05'
        color: '0xffffffff'
        fontSize: '19'
        backgroundColor: '0x388eccff'
        textAlign:
          x: center
        border:
          style: '1'
    - type: popUp # view
      viewTag: confirmView
      style:
        left: '0'
        top: '0'
        width: '1'
        height: '1'
        backgroundColor: '0x00000066'
      children:
        - type: view
          style:
            left: '0.05'
            top: '0.15'
            width: '0.89333'
            height: '0.35'
            backgroundColor: '0xeeeeeeff'
            border:
              style: '5'
            borderRadius: '15'
          children:
            - type: label
              text: 'Send Invite Link'
              style:
                .LabelStyle:
                  left: '0'
                  top: '0.04'
                  width: '0.89333'
                  height: '0.04'
                  color: '0x00000088'
                  fontSize: '20'
                  fontStyle: bold
                  display: inline
                  textAlign:
                    x: center
                    y: center
            - type: label
              text: 'Send invite link to'
              style:
                .LabelStyle:
                  left: '0'
                  top: '0.1'
                  width: '0.89333'
                  height: '0.04'
                  color: '0x00000088'
                  fontSize: '14'
                  display: inline
                  textAlign:
                    x: center
                    y: center
            - type: label
              # text: "John"
              dataKey: input.firstName
              style:
                .LabelStyle:
                  left: '0'
                  top: '0.15'
                  width: '0.89333'
                  height: '0.027247'
                  color: '0x00000088'
                  fontSize: '14'
                  display: inline
                  textAlign:
                    x: center
                    y: center
            - type: label
              #text: "+1 7148397253"
              dataKey: input.InviteePhoneNumber
              style:
                .LabelStyle:
                  left: '0'
                  top: '0.20'
                  width: '0.89333'
                  height: '0.027247'
                  color: '0x00000088'
                  fontSize: '14'
                  display: inline
                  textAlign:
                    x: center
                    y: center
            - type: divider
              style:
                .DividerStyle:
                  left: '0'
                  top: '0.25436'
                  width: '0.89333'
                  height: '0.001'
                  backgroundColor: '0x00000088'
            - type: button
              onClick:
                - actionType: popUpDismiss
                  popUpView: confirmView
              text: Cancel
              style:
                .LabelStyle:
                  left: '0'
                  top: '0.275'
                  width: '0.42'
                  height: '0.06812'
                  color: '0x007affff'
                  fontSize: '17'
                  display: inline
                  textAlign:
                    x: center
                    y: center
                  border:
                    style: '5'
                  borderRadius: '15'

            - type: button
              onClick:
                - actionType: evalObject
                  object:
                    =.builtIn.string.concat:
                      dataIn:
                        - =..input.firstName
                        - ' '
                        - =..input.lastName
                      dataOut: input.fullName
                - actionType: evalObject
                  object:
                    - if:
                        - =.MessageObjStore.currentChatEdge.subType # if 0 value evaluate to false
                        - actionType: evalObject # subType == 1
                          object:
                            # if this is already a group chat, just invite this user
                            - ..inviteToChat.edge.name@: =..input
                            - ..inviteToChat.edge.refid@: =.MessageObjStore.currentChatEdge.id
                            - =..inviteToChat.edgeAPI.store: ''
                        - actionType: evalObject # subType == 0
                          object:
                            # if this is a 1 to 1 chat, create a new group chat edge, then invite this user
                            - ..inviteToChat.edge@: =.MessageObjStore.currentChatEdge
                            - ..inviteToChat.edge.id@: ''
                            - ..inviteToChat.edge.refid@: ''
                            - ..inviteToChat.edge.subType@: 1
                            - =..inviteToChat.edgeAPI.store: '' # create a new group chat edge from current 1 to 1 edge
                            - .MessageObjStore.currentChatEdge@: =..inviteToChat.response.edge # Update current Chat Edge
                            - ..inviteToChat.edge.refid@: =.MessageObjStore.currentChatEdge.id
                            - ..inviteToChat.edge.name@: =..input
                            - =..inviteToChat.edgeAPI.store: '' # invite this new user

                  # create a invite person message doc
                - =..newInviteMessage.document.eid@: =.MessageObjStore.currentChatEdge.id # group chat root edge
                - =..newInviteMessage.document.name.data@: =..input
                - =..newInviteMessage.docAPI.store: ''
                - actionType: popUpDismiss
                  popUpView: confirmView
                - goto: ChatPage
              text: Confirm
              style:
                .LabelStyle:
                  left: '0.45'
                  top: '0.275'
                  width: '0.42'
                  height: '0.06812'
                  color: '0x007affff'
                  fontSize: '17'
                  display: inline
                  textAlign:
                    x: center
                    y: center
                  border:
                    style: '5'
                  borderRadius: '15'
            - type: divider
              style:
                .DividerStyle:
                  left: '0.45'
                  top: '0.26'
                  width: '0.001'
                  height: '0.07'
                  backgroundColor: '0x00000088'
