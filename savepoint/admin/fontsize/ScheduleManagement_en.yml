ScheduleManagement: #xd page number: 1080
  pageNumber: "450" 
  viewPort: top
  title: "ScheduleManagement"
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - =..patient.docAPI.get: ""
    - actionType: evalObject
      object: .BaseDate.getDate
    - ..formData.timeTable.response@: ""  #表格置空
    - =..providerList.docAPI.get: ""
    - if: 
      - ..providerList.list.doc.0
      - actionType: evalObject
        object:
          - =.builtIn.array.getIdByUserName:
              dataIn:
                array: =..providerList.list.doc
                userName: =..formData.providerName
              dataOut: ScheduleManagement.formData.providerId 
          - =.builtIn.object.extract:
              dataIn:
                array: =..providerList.list.doc
                field: name.data.fullName
              dataOut: ScheduleManagement.formData.providerList
          - ..appointment.edge.id.0@: =..providerList.list.doc.0.bsig
          - .Global.formData.scheduleManageProdId@: =..providerList.list.doc.0.bsig
          - .Global.formData.scheduleManageProdName@: =..providerList.list.doc.0.name.data.fullName
          - ..formData.providerName@: =..providerList.list.doc.0.name.data.fullName
          - ..formData.providerId@: =..providerList.list.doc.0.bsig
          - ..inMeeting.edge.id@: =..providerList.list.doc.0.bsig
      - continue
    - =.builtIn.array.selectOneToArr:   # 获取所有的address
        dataIn:
          arr: =.Global.locationAll
          key: "medicalFacilityName"
        dataOut: ScheduleManagement.addressName
    - actionType: evalObject  # 获取表格的数据
      object:  
        - if: 
          - ..formData.providerId
          - =..inMeeting.edgeAPI.get: ""
          - continue
        - =.builtIn.object.extractArray: 
            dataIn: 
              obj: =..inMeeting.edgeResp.edge
              arr:
                - stime
                - etime
                - name.visitReason
                - id
            dataOut: ScheduleManagement.formData.timeTable.chartData
    - =..appointment.edgeAPI.get: ""
    - =.builtIn.array.getListLength:
        dataIn:
          object: =..appointment.list.edge
        dataOut: ScheduleManagement.formData.appointmentLength
    - actionType: evalObject
      object: 
        - ..selectDate@: .BaseDate.calendarDate.todayDate
        - .Global.currentSubtype@: '196609'
        - .Global.visitType@: "Telemedicine"
        - ..newAppointment.edge.name.visitType@: "Telemedicine"
        - ..newAppointment.edge.name.visitTypeShow@: "Telemedicine"
  patient:  # 获取所有的病人
    list: ""
    docAPI:
      get: 
        api: rd
        dataKey: patient.list
        ObjType: 8
        type: .DocType.Profile
        id: .Global.currentFacility.id
        xfname: E.bvid|E.evid
        sCondition: "E.type=10002 AND E.mtime>0"
        maxcount: "10000"
        _nonce: =.Global._nonce
      store:
        api: ce
        dataIn: ScheduleManagement.formData.patientInfo
  schedule:     # 获取avilability，可用时间的
    response: ""
    scheduleList: ""
    get:
      api: re
      dataIn: ScheduleManagement.schedule.edge
      dataOut: ScheduleManagement.schedule.scheduleList
    edge:
      type: 40000
      id: []
      sCondition: "=.Global.scheduleScondition"
      xfname: "evid,bvid"
      maxcount: "10000"
      obfname: "etime"
      asc: true
      _nonce: =.Global._nonce
  visitReason: 
    docResp: ""
    document: 
    docIn:
      type: .DocType.VisitReason
      id: ""
      xfname: "ovid"
      obfname: "ctime"
      _nonce: =.Global_nonce
      maxcount: "1"
    docAPI: 
      get: 
        .DocAPI.get: ""
        api: rd
        dataIn: visitReason.docIn
        dataOut: ScheduleManagement.visitReason.docResp
  appointment:
    list:
      edge: []
    deleteReq:
      id: ""
    edge:
      .Edge: ""
      # id: 
      # id: NzczFCtoRgYkcD3yEvGhRA==
      id:
        - ..formData.providerId
        - .Global.currentFacility.id
      ObjType: 20
      xfname: "E2.evid,E2.bvid&E.evid"
      # type: .EdgeType.WaitingRoom
      sCondition: "E2.type=40000 AND E2.subtype=196609 AND E.type = 40000 AND E.subtype=196610"
      obfname: "ctime"
      _nonce: .Global._nonce
      maxcount: "100"
    edgeAPI:
      get:
        api: re
        dataIn: ScheduleManagement.appointment.edge
        dataOut: ScheduleManagement.appointment.list
      delete:
        api: dx
        dataIn: ScheduleManagement.appointment.deleteReq
  inMeeting:  # 同意预约后，正在开会的40000那条边（subtype为6或者100）
    edgeResp: ""
    edge:
      .Edge: ""
      id: ""
      ObjType: "4"
      xfname: "E.bvid | E.evid"
      # type: .EdgeType.WaitingRoom
      sCondition: "(E.type=40000 OR E.type = 1053) AND E2.type=40000  AND E2.subtype in (196614,100)"
      obfname: "ctime"
      _nonce: .Global._nonce
      maxcount: "100"
    edgeAPI: 
      get: 
        api: re
        dataIn: inMeeting.edge
        dataOut: ScheduleManagement.inMeeting.edgeResp
  invite:  # 1053那条边，将其他人邀请进入会议
    edge:
      type: .EdgeType.InviteInfo
      refid: ""
      bvid: .Global.currentUser.vertex.id
      # bvid: .MyActiveProvider.providerId
      evid: ..formData.providerId
      _nonce: =.Global._nonce
      # evid: "NzczFCtoRgYkcD3yEvGhRA=="
      name:
        firstName: ""
        lastName: ""
        roomName: ""
        date: ""
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: invite.edge
  approveAppointment:
    edge:
      bvid: .Global.currentFacility.id
      .Edge: ""
      name: ""
      type: .EdgeType.WaitingRoom 
      subtype: 5
      refid: ""
      evid: ""
      stime: ""
      etime: ""
    edgeAPI:
      store:
        api: ce
        dataIn: approveAppointment.edge
        dataOut: approveAppointment.response
  denyAppointment:
    edge:
      bvid: .Global.currentFacility.id
      .Edge: ""
      name: ""
      type: .EdgeType.WaitingRoom 
      subtype: 7
      refid: ""
      evid: ""
      stime: ""
      etime: ""
    edgeAPI:
      store:
        api: ce
        dataIn: denyAppointment.edge
        dataOut: denyAppointment.response
  approveAppointment10:
    response:
    edge:
      bvid: .Global.currentFacility.id
      .Edge: ""
      name: ""
      type: .EdgeType.WaitingRoom 
      subtype: 10
      refid: ""
      evid: ""
      stime: ""
      etime: ""
    edgeAPI:
      store:
        api: ce
        dataIn: approveAppointment10.edge
        dataOut: approveAppointment10.response
  providerList:
    list: ""
    docAPI:
      get: 
        api: rd
        dataKey: providerList.list
        ObjType: 12
        type: .DocType.DoctorProfile
        id: .Global.currentFacility.id
        xfname: E.bvid|E.evid
        sCondition: E.type=10002 
        maxcount: "10000"
        _nonce: =.Global._nonce
  visitType: "Telemedicine"
  splitTime: []  # availablity 里的具体每一个时间段
  locationId: .Global.currentFacility.id  # 创建预约时候location要使用的
  requestLocationId: .Global.currentFacility.id   # 获取所有病人给location的预约请求时候location要使用的
  requestAddress: ""   
  clock: ""
  selectDate: ""
  appointmentTime: ""
  formData: 
    inviteMessage: ""
    currentVisitType: "Telemedicine"
    locationHidden: "true"
    locationList: ""
    dataStruc:
        - reason 
        - duration
    appointmentInfo: ""
    scheduleInfoAppointment: ""
    providerList: []
    providerName: 
    providerId: 
    appointmentLength: "0"
    durationMinutes: ""
    timeTable:
      chartType: "calendarTable"
      chartData:  []
        #json object include  stime , etime , name , color , id , fontColor
      response: ""
  newAppointment:
    response: ""
    edge:
      .Edge: ""
      evid: ""
      bvid: ""
      subtype: "0x30002"        # 预约的时候会根据不同的类型给不同的subtype:  telemedicine: 0x20002
      type: 40000
      name:
        patientName: "" #"" #病人名字
        visitType: "Telemedicine" # visitType 用于判定
        visitTypeShow: "" # visitType 用于显示 ，避免和判定冲突
        providerName: "" # 医生名字
        visitReason: "" # 看病原因
        blockColor: "" #背景色
        fontColor: "" #字体颜色
        Reason: ""   # 看病原因的拼接，用于展示
        document: ""    # 看病原因要填写的vaccin
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: newAppointment.edge
        dataOut: newAppointment.response
  reasonForVisit: []
  components:
    - type: popUp
      viewTag: calenderView
      style:
        left: "0.45"
        top: "0.24"
        width: "0.24"
        height: "0.4" 
        zIndex: "100000"
      children:
        - .BaseDate.calendar:
          children:
            - .BaseDate.calendarHeader:
              children:
                - .BaseDate.monthView:
                - .BaseDate.yearView: 
                - .BaseDate.weekView:
            - .BaseDate.dayView:
            - .BaseDate.addButton:
              text: "Select"
              onClick:
                - actionType: evalObject
                  object:
                    - ..selectDate@: =.BaseDate.calendarDate.todayDate
                - actionType: builtIn
                  funcName: redraw
                  viewTag: dateView
                - actionType: popUpDismiss
                  popUpView: calenderView
    - .BaseCheckView: ""
      message: "You don't have the authority to create a new appointment"
      viewTag: scheduleInfoAuthCreate
      style: 
        zIndex: "100000"
    - .SideMenuBar:
      children:
        - .aitLogo:
        - .MenuBar:
    - .TopBar:
    - .BodyView:
      children:
        - .Label1:
          type: label
          text: "Schedule Management"
          style:
            left: "0.03"
            fontSize: "25"
            top: "0.02"
          # onClick:
          #   - actionType: popUp
          #     popUpView: create
        - .Scselect1:
          options:
            - Telemedicine
            - Office Visits
          dataKey: formData.currentVisitType
          onChange:
            - actionType: evalObject
              object:
                .Global._nonce@:
                  =.builtIn.math.random: ""
            # - actionType: updateObject
            #   dataKey: ScheduleManagement.appointment.list.edge
            #   dataObject: []
            - actionType: evalObject
              object:
                ..appointment.list.edge@: []
            - actionType: evalObject
              object:
                - if:
                  - =.builtIn.string.equal:
                      dataIn: 
                        string1: =..formData.currentVisitType
                        string2: "Office Visits"
                  - ..appointment.edge.sCondition@: "E2.type=40000 AND E2.subtype in (131073) AND E.type = 40000 AND E.subtype=131074" 
                  - ..appointment.edge.sCondition@: "E2.type=40000 AND E2.subtype in (196609) AND E.type = 40000 AND E.subtype=196610"
                - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
                - =.Global.jwt.edgeAPI.store: ""
                - =..appointment.edgeAPI.get: ""
            - actionType: evalObject
              object: 
                - =.builtIn.array.getListLength:
                    dataIn:
                      object: =..appointment.list.edge
                    dataOut: ScheduleManagement.formData.appointmentLength
            - actionType: builtIn
              funcName: redraw
              viewTag: appointmentTag
            # - actionType: builtIn
            #   funcName: redraw
            #   viewTag: calenderTableView
            - actionType: builtIn
              funcName: redraw
              viewTag: appointmentLengthTag
            - actionType: evalObject
              object:
                - if:
                  - =.builtIn.string.equal:
                      dataIn: 
                        string1: =..formData.currentVisitType
                        string2: "Office Visits"
                  - actionType: builtIn
                    funcName: show
                    viewTag: locationSelect
                  - actionType: builtIn
                    funcName: hide
                    viewTag: locationSelect
            # - actionType: builtIn
            #   funcName: redraw
            #   viewTag: locationSelect 
          style:
            left: "0.35"
        - .Scselect1:
          dataKey: formData.providerName
          options:
            ..formData.providerList
          onChange:
            - actionType: evalObject
              object: 
                .Global._nonce@: 
                  =.builtIn.math.random: ""
            - actionType: evalObject
              object:   
                - ..appointment.list.edge@: []
                - =.builtIn.array.getIdByUserName:
                    dataIn:
                      array: =..providerList.list.doc
                      userName: =..formData.providerName
                    dataOut: ScheduleManagement.formData.providerId 
                - ..appointment.edge.id.0@: =..formData.providerId
                # - ..appointment.edge.id@: =..formData.providerId
                - ..inMeeting.edge.id@: =..formData.providerId
                - .Global.formData.scheduleManageProdId@: =..formData.providerId
                - .Global.formData.scheduleManageProdName@: =..formData.providerName
            - actionType: evalObject
              object: 
                - =..appointment.edgeAPI.get: ""
                - =.builtIn.array.getListLength:
                    dataIn:
                      object: =..appointment.list.edge
                    dataOut: ScheduleManagement.formData.appointmentLength
            - actionType: evalObject
              object: 
                .Global._nonce@: 
                  =.builtIn.math.random: ""  
            - actionType: evalObject
              object:  
                - =..inMeeting.edgeAPI.get: ""
                - =.builtIn.object.extractArray: 
                    dataIn: 
                      obj: =..inMeeting.edgeResp.edge
                      arr:
                        - stime
                        - etime
                        - name.visitReason
                        - id
                    dataOut: ScheduleManagement.formData.timeTable.chartData
            - actionType: builtIn
              funcName: redraw
              viewTag: appointmentTag
            - actionType: builtIn
              funcName: redraw
              viewTag: calenderTableView
            - actionType: builtIn
              funcName: redraw
              viewTag: appointmentLengthTag
        - .Scimage1:
        - .Addbutton:
          children: 
            - .Label1:
              text: 'Add Appointment'
              style: 
                fontSize: '1.6vh'
                top: '0.014'
                left: '0.025'
            - type: image
              path: addwhite.png
              style:
                top: '0.015'
                width: "0.01"
                left: '0.007'
          onClick:
            # - actionType: updateObject
            #   dataKey: ScheduleManagement.visitReason.response
            #   dataObject: []
            - actionType: evalObject
              object:
                .Global._nonce@:
                  =.builtIn.math.random: ""
            - actionType: evalObject
              object: 
                - ..visitReason.docResp.0.doc.0.name.data.reasonForVisit@: []
                - ..visitReason.docIn.id@: =..formData.providerId
                - ..newAppointment.edge.name.providerName@: =..formData.providerName
                - =..visitReason.docAPI.get: ""
                # - =.builtIn.object.extractArray: 
                #     dataIn: 
                #       obj: =..visitReason.response.doc.0.name.data.reasonForVisit
                #       arr: =..formData.dataStruc
                #     dataOut: ScheduleManagement.middleStruc  
                - ..visitReason.document@: =..visitReason.docResp.0.doc.0
                - =.builtIn.array.add:
                    dataIn:
                      object: =..schedule.edge.id
                      value: =..formData.providerId
                - =.builtIn.array.add:
                    dataIn:
                      object: =..schedule.edge.id
                      value: =.Global.currentFacility.id
                - =.builtIn.array.convertToList:
                    dataIn:
                      array: =..visitReason.document.name.data.reasonForVisit
                      key: reason
                    dataOut: ScheduleManagement.reasonForVisit
                - =.builtIn.array.getByKey:
                    dataIn:
                      array: =..visitReason.document.name.data.reasonForVisit
                      key1: reason
                      value: =..reasonForVisit.0
                      key2: duration
                    dataOut: ScheduleManagement.selectData.duration
                - =.builtIn.string.retainNumber:
                    dataIn:
                      value: =..selectData.duration
                    dataOut: ScheduleManagement.formData.duration
                - .ScheduleManagement.selectData.reason@: =..reasonForVisit.0
                - =.builtIn.date.transformMonth:
                    dataIn:
                      month: =.BaseDate.calendarDate.month
                    dataOut: BaseDate.calendarDate.monthName
                - =.builtIn.date.getTimeStampOfDate:
                    dataIn:
                      date: =.BaseDate.calendarDate.todayDate
                    dataOut: BaseDate.calendarDate.todayStamp
                - =.builtIn.string.concat:
                    dataIn:
                      - "(stime<"
                      - =.BaseDate.calendarDate.todayStamp.start
                      - " AND "
                      - "etime>"
                      - =.BaseDate.calendarDate.todayStamp.start
                      - " OR "
                      - "stime>"
                      - =.BaseDate.calendarDate.todayStamp.start
                      - " AND "
                      - "etime<"
                      - =.BaseDate.calendarDate.todayStamp.end
                      - " OR "
                      - "stime<"
                      - =.BaseDate.calendarDate.todayStamp.end
                      - " AND "
                      - "etime>"
                      - =.BaseDate.calendarDate.todayStamp.end
                      - ")"
                      - " AND "
                      - "subtype="
                      - =.Global.currentSubtype
                    dataOut: Global.scheduleScondition
            - actionType: evalObject
              object:
                - .BaseDate.schedule.scheduleList.edge@: []

            # - actionType: updateObject
            #   dataKey: ScheduleManagement.visitReason.document
            #   dataObject: []
            # - actionType: updateObject
            #   dataKey: ScheduleManagement.visitReason.doc.id
            #   dataObject: []
            - actionType: evalObject
              object: 
                .Global._nonce@: 
                  =.builtIn.math.random: ""
            - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
            - =.Global.jwt.edgeAPI.store: ""
            - actionType: evalObject
              object:
                - =..schedule.get: ""
                - ..schedule.edge.id@: []
            - actionType: evalObject
              object:           
                - =.builtIn.date.splitTime:
                    dataIn:
                      object2: =..schedule.scheduleList.edge
                      timeSlot: =..formData.duration
                      year: =.BaseDate.calendarDate.year
                      month: =.BaseDate.calendarDate.month
                      day: =.BaseDate.calendarDate.day
                    dataOut: ScheduleManagement.splitTime 
            - actionType: builtIn
              funcName: redraw
              viewTag: create1
            - actionType: evalObject
              object:
                - if: 
                  - =.builtIn.string.equal:
                      dataIn: 
                        string1: =.Global.auth.scheduleInfo.create
                        string2: true 
                  - actionType: popUp
                    popUpView: create1
                  - actionType: popUp
                    popUpView: scheduleInfoAuthCreate
    - type: view
      style: 
        left: "0.18"
        width: "0.22"
        height: "0.83"
        top: "0.149"
        backgroundColor: "0xffffff"
      children: 
        - type: view
          style:
            width: '0.22'
            height: '0.08'
            left: '0'
            marginTop: "0"
            backgroundColor: "0xffffff"
          viewTag: appointmentLengthTag
          children:
            - .Label1:
              text: Appointment Request
              style:
                left: '0.01'
                fontSize: '16'
                top: '0.015'
            - .Label1:
              dataKey: formData.appointmentLength
              style:
                left: '0.01'
                color: '#0063A8'
                top: '0.05'
            - .Label1:
              text: pending request
              style:
                left: '0.02'
                color: '#0063A8'
                fontSize: "14"
                top: '0.05'
        - type: view
          viewTag: locationSelect
          style:
            width: "0.22"
            left: "0"
            height: "0.05"
            marginTop: "0"
            display: none
            isHidden: =..formData.locationHidden
          children:
            - type: label
              text: "Select Location"
              style:
                width: "0.08"
                left: "0.01"
                height: "0.05"
                textAlign:
                  y: center
                fontSize: "12"
            - type: select
              dataKey: requestAddress
              onChange: 
                - actionType: evalObject
                  object:
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - =.builtIn.array.matchInArray:
                        dataIn:
                          arr: =.Global.locationAll
                          value: =..requestAddress
                          key: medicalFacilityName
                          key1: "id"
                        dataOut: ScheduleManagement.requestLocationId
                    - ..appointment.edge.id.0@: =..formData.providerId
                    - ..appointment.edge.id.1@: =..requestLocationId
                    - ..appointment.list.edge@: []
                    - ..appointment.edge.sCondition@: "E2.type=40000 AND E2.subtype=131073 AND E.type = 40000 AND E.subtype=131074" 
                    - .Global.jwt.edge.bvid@: =..requestLocationId
                    - =.Global.jwt.edgeAPI.store: ""
                    - =..appointment.edgeAPI.get: ""
                    - =.builtIn.array.getListLength:
                        dataIn:
                          object: =..appointment.list.edge
                        dataOut: ScheduleManagement.formData.appointmentLength
                - actionType: builtIn
                  funcName: redraw
                  viewTag: appointmentTag
                # - actionType: builtIn
                #   funcName: redraw
                #   viewTag: calenderTableView
                - actionType: builtIn
                  funcName: redraw
                  viewTag: appointmentLengthTag
              options:
                ..addressName
              style:
                width: "0.1"
                left: "0.08"
                height: "0.03"
                top: "0.01"
        - type: scrollView
          viewTag: appointmentTag
          style:
            width: "0.22"
            left: "0"
            marginTop: "0"
            height: "0.75"
            overflow: scroll
            backgroundColor: "0xffffff"
          children:
            - .BaseList:
              # viewTag: appointmentTag
              listObject: ..appointment.list.edge
              style:
                width: '0.22'
                left: '0'
                height: 'auto'
                # top: '0.22'
                top: "0"
                margin: "0"
                # position: fixed
              children:
                - .BaseListItem:
                  style:
                    width: '0.2'
                    left: '0.01'
                    height: '0.16'
                    marginTop: "0.01"
                    display: inline-block
                    backgroundColor: ' #F4F8FA'
                    borderRadius: '10'
                    # overflow: "hidden"
                  children:
                    - .Label1:
                      dataKey: itemObject.name.patientName
                      style:
                        fontSize: '14'
                        fontWeight: '500'
                        left: '0.05'
                        top: '0.02'
                    - .Label1:
                      dataKey: itemObject.name.visitType
                      style:
                        left: '0.05'
                        top: '0.047'
                        color: '#808080'
                    - .Label1:
                      text: 'More Info'
                      onClick: 
                        - emit:
                            dataKey: 
                              var: itemObject
                            actions:
                              - .Global.formData.scheduleManagePatdId@: $var.bvid
                        - goto: ScheduleManagementPI
                      style:
                        left: '0.15'
                        top: '0.02'
                        color: '#1492E6'
                    - type: image
                      path: schedule.png
                      style:
                        width: '0.01'
                        left: '0.05'
                        top: '0.08'
                    - .Label1:
                      text=func: .builtIn.string.formatUnixtimeL_en
                      dataKey: itemObject.stime
                      style:
                        left: '0.065'
                        top: '0.08'
                        color: '#000000'
                    - type: image
                      path: history.png
                      style:
                        width: '0.01'
                        left: '0.117'
                        top: '0.081'
                    - .Label1:
                      text=func: .builtIn.string.formatUnixtimeLT_en
                      dataKey: itemObject.stime
                      style:
                        left: '0.13'
                        top: '0.08'
                        color: '#000000'               
                    - type: button
                      text: 'Approve'
                      onClick:
                        - emit:
                            dataKey: 
                              var: itemObject
                            actions:
                              - ..formData.appointmentInfo@: $var
                              - ..invite.edge.refid@: $var.id
                              - =.builtIn.date.getDurationByMinute:
                                  dataIn:
                                    stime: =..formData.appointmentInfo.stime
                                    etime: =..formData.appointmentInfo.etime
                                  dataOut: ScheduleManagement.formData.durationMinutes
                              - =.builtIn.string.concat:
                                  dataIn:
                                    - =..formData.durationMinutes
                                    - " "
                                    - "min"
                                  dataOut: ScheduleManagement.formData.durationMinutes
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: Next2
                        - actionType: popUp
                          popUpView: Next2
                      style:
                        fontSize: '13'
                        color: '#8990a1'
                        backgroundColor: '#f4f8fa' 
                        width: '0.06'
                        top: '0.12'
                        borderRadius: '5'
                        left: '0.02'
                    # - type: button
                    #   text: 'Change'
                    #   style:
                    #     fontSize: '13'
                    #     color: '#8990a1'
                    #     backgroundColor: '#f4f8fa'
                    #     width: '0.04'
                    #     top: '0.12'
                    #     borderRadius: '5'
                    #     left: '0.086'
                    - type: button
                      text: 'Deny'
                      onClick:
                        # - actionType: evalObject
                        #   object:
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: ""
                        - emit:
                            dataKey: 
                              var: itemObject
                            actions:
                              # - ..appointment.deleteReq.id@: $var.id
                              # - =..appointment.edgeAPI.delete: ""
                              - .Global.jwt.edge.bvid@: $var.evid
                              - =.Global.jwt.edgeAPI.store: ""
                              - ..denyAppointment.edge@: $var
                              - ..denyAppointment.edge.id@: ""
                              - ..denyAppointment.edge.subtype@: 7
                              - ..denyAppointment.edge.evid@: $var.bvid
                              - ..denyAppointment.edge.bvid@: $var.evid
                              - ..denyAppointment.edge.refid@: $var.id
                              - =..denyAppointment.edgeAPI.store: ""
                              - ..appointment.list.edge@: []
                              - =..appointment.edgeAPI.get: ""
                              - .Global.jwt.edge.bvid@: =.Global.currentUser.vertex.id
                              - =.Global.jwt.edgeAPI.store: ""
                              - =.builtIn.goto:
                                  dataIn:
                                    destination: ScheduleManagement
                                    pageReload: true
                        # - actionType: builtIn
                        #   funcName: redraw
                        #   viewTag: appointmentTag


                      style:
                        fontSize: '13'
                        color: '#8990a1'
                        backgroundColor: '#f4f8fa'
                        width: '0.06'
                        top: '0.12'
                        borderRadius: '5'
                        left: '0.12'
                    - type: view
                      style:
                        width: '0.2'
                        height: '0.001'
                        backgroundColor: '#dee2e4'
                        top: '0.11'
                    - type: view
                      style:
                        height: '0.049'
                        width: '0.0005'
                        backgroundColor: '#dee2e4'
                        top: '0.11'
                        left: '0.1'
                    - type: image
                      path: 'Icon awesome-check.png'
                      style: 
                        width: '0.01'
                        top: '0.125'
                        left: '0.02'
                    # - type: image
                    #   path: 'chooseAvatar2.png'
                    #   style: 
                    #     width: '0.01'
                    #     top: '0.125'
                    #     left: '0.076'
                    - type: image
                      path: 'Icon material-close.png'
                      style: 
                        width: '0.01'
                        top: '0.123'
                        left: '0.12'
                    - type: image
                      path: 'Beau McGee.png'
                      style: 
                        width: '0.04'
                        top: '0.01'
                        left: '0.003'           
    - type: scrollView
      style:
        width: '0.55'
        height: '0.83'
        top: '0.149'
        left: '0.41'
        backgroundColor: "0xffffff"
        overflowY: scroll
      children: 
        - type: chart
          dataKey: formData.timeTable
          viewTag: calenderTableView
          onClick: 
            - actionType: evalObject
              object: 
                - .Global.formData.patientHistoryInfo.id@: =..formData.timeTable.response
            - actionType: evalObject
              object: 
                - if:
                  - =..formData.timeTable.response
                  - goto: PatientSummary 
                  - continue
            
          style:
            width: "0.55"
            height: "0.75"
            left: "0"
            top: "0"
    # - type: view
    - .BasePopUp:
      viewTag: Contacts
      style: 
        zIndex: "1000"
      children:
        - .PopUphead:
          style: 
            left: "0.6"
          children:
            - .CreateLabel:
              text: 'Invite'
            - .Closebutton:
              onClick:
                - actionType: popUpDismiss
                  popUpView: Contacts     
        - type: view
          style:
            height: '0.91'
            width: '0.4'
            left: "0.6"
            top: '0.08'
            backgroundColor: '0xffffff'
          viewTag: ContactsTag
          children:
            - type: view
              style: 
                left: "0.03"
                width: "0.34"
                top: "0.02"
                height: "0.04"
                border: 
                  style: "3"
                borderWidth: "1"
                borderColor: "0xbbbbbb"
                borderRadius: "10"
              children: 
                - type: textField
                  placeholder: Search
                  style: 
                    left: "0.007"
                    width: "0.2"
                    top: "0"
                    height: "0.038"
                    fontSize: "1.6vh"
                    border: 
                      style: "1"
                - type: button
                  text: Search
                  style: 
                    left: "0.28"
                    width: "0.06"
                    height: "0.04"
                    fontSize: "1.6vh"
                    color: "0xffffff"
                    backgroundColor: "0x2988e6"
                    border: 
                      style: "3"
                    borderWidth: "1"
                    borderColor: "0x2988e6"
                    borderRadius: "10"
            - type: label
              text: Patient List
              style: 
                left: "0.03"
                width: "0.34"
                top: "0.08"
                height: "0.04"
                fontSize: "1.9vh"
                fontFamily: sans-serif
                fontWeight: "500"
                textAlign: 
                  y: center
            - .BaseList:
              listObject: ..patient.list.doc
              style:
                width: '0.36'
                height: '0.35'  
                top: '0.12'   
                left: '0.02'
                display: flex
                margin: "0"
              children:
                - .BaseListItem:
                  style:
                    height: '0.05'
                    width: '0.36'
                    display: inline-block
                    border: 
                      style: "2"
                    borderWidth: "1"
                    borderColor: "0xbbbbbb"
                  onClick:
                    - actionType: evalObject
                      object:
                        - .ScheduleManagement.invite.edge.evid@: ""
                        - .ScheduleManagement.invite.edge.evid@: =.ScheduleManagement.formData.providerId
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - ..newAppointment.edge.evid@: $var.bsig
                          - ..newAppointment.edge.name.patientName@: $var.name.data.fullName
                          - ..newAppointment.edge.name.patientPhoneNumber@: $var.name.data.phone
                          # - ..invite.edge.bvid@: =.Global.currentFacility.id
                          - ..invite.edge.evid@: =..formData.providerId
                          - ..invite.edge.name.phoneNumber@: $var.name.data.phone
                          - =.builtIn.string.concat:
                              dataIn:
                                - $var.name.data.fullName
                                - "-"
                                - =.ScheduleManagement.selectData.reason
                              dataOut: ScheduleManagement.newAppointment.edge.name.visitReason
                    - actionType: popUpDismiss
                      popUpView: Contacts
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: Detials
                    - actionType: popUp
                      popUpView: Detials
                  children:
                    - .Label1:
                      dataKey: itemObject.name.data.fullName
                      style: 
                        height: '0.05'
                        textAlign:
                          y: center
                        left: '0.04'
                        fontSize: '13'
                    - .Label1:
                      text=func: .builtIn.string.formatUnixtimeL_en
                      dataKey: itemObject.ctime
                      # dataKey: 'itemObject.time'
                      style:
                        top: "0"  
                        height: '0.05'
                        textAlign:
                          y: center
                        left: '0.25'
                        fontSize: '13'   
    - .BasePopUp:
      viewTag: Next2
      children:
        - type: view
          style:
            top: "0"
            left: "0.6"
            height: "1"
            width: "0.4"
          children:
            - .PopUphead:
              children:
                - .CreateLabel:
                  text: 'Appointment Details'
                - .Closebutton:
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: Next2
            - type: view
              style:
                height: '0.91'
                width: '0.4'
                top: '0.08'
                backgroundColor: '0xffffff'
              children:
                - type: button
                  text: "Edit"
                  style:
                    top: "0.03"
                    left: "0.32"
                    height: "0.047"
                    width: "0.07"
                    backgroundColor: "0xffffff"
                    borderColor: '#005795'
                    borderRadius: "2"
                    fontFamily: "Poppins"
                    color: "#005795"
                    boxShadow: "0px 0px 1.7px 1.7px #005795"
                - type: image
                  path: Flat.jpg
                  style:
                    width: '0.09'
                    left: '0.14'
                    top: '0.05'
                - type: label
                  textBoard: 
                    - text: 'Date & Time'
                    - br:
                    - br:
                    - br:
                    - text: 'Provider:'
                    - br:
                  style:
                    left: '0.08'
                    top: '0.25'
                    lineHeight: '2'
                - type: label
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: formData.appointmentInfo.stime
                  style:
                    left: '0.08'
                    top: '0.3'
                    fontWeight: '500'
                - type: label
                  dataKey: formData.providerName
                  style:
                    left: '0.08'
                    top: '0.39'
                    fontWeight: '500'
                - type: view
                  style:
                    left: '0.06'
                    height: '0.25'
                    width: '0.28'
                    top: '0.45'
                    backgroundColor: '0xfbf5eb'
                    border:
                      style: "3"
                    borderColor: '0xf4b03e'
                    borderWidth: '2'
                  children:
                    - type: label
                      text: Patient Name
                      style:
                        left: '0.02'
                        top: '0.035'
                        fontSize: '16'
                        fontWeight: '500'
                    - type: label
                      # dataKey: formData.appointmentInfo.name.patientName
                      text: Patient Phone Number
                      style:
                        left: '0.02'
                        top: '0.085'
                        fontSize: '16'
                        fontWeight: '500'
                    - type: label
                      text: Appointment Type
                      style:
                        left: '0.02'
                        top: '0.135'
                        fontSize: '16'
                        fontWeight: '500'
                    - type: label  
                      text: Duration
                      style: 
                        left: '0.02'
                        top: '0.185'
                        fontSize: '16'
                        fontWeight: '500'
                    - type: label
                      dataKey: formData.appointmentInfo.name.patientName
                      style:
                        left: '0.18'
                        top: '0.035'
                        fontSize: '16'
                        fontWeight: '500'
                    - type: label
                      # dataKey: formData.appointmentInfo.name.patientName
                      dataKey: formData.appointmentInfo.name.patientPhoneNumber
                      style:
                        left: '0.18'
                        top: '0.085'
                        fontSize: '16'
                        fontWeight: '500'
                    - type: label
                      dataKey: formData.appointmentInfo.name.visitType
                      style:
                        left: '0.18'
                        top: '0.135'
                        fontSize: '16'
                        fontWeight: '500'
                    - type: label  
                      dataKey: formData.durationMinutes 
                      style: 
                        left: '0.18'
                        top: '0.185'
                        fontSize: '16'
                        fontWeight: '500'
            - .BottomButton:
              text: 'Approve Appointment'
              style:
                left: '0.13'
                top: '0.85'
                width: '0.15'
                backgroundColor: '#005795'
                color: '0xffffff'
                fontSize: "1.6vh"
              onClick:
                - actionType: evalObject
                  object:
                    - =.builtIn.string.concat:
                        dataIn:
                          - =..formData.appointmentInfo.name.patientName
                          - " "
                          - =..formData.appointmentInfo.name.patientPhoneNumber
                        dataOut: ScheduleManagement.formData.inviteMessage
                    - .Global.jwt.edge.bvid@: =..formData.appointmentInfo.evid
                    - =.Global.jwt.edgeAPI.store: ""
                    - ..approveAppointment.edge.evid@: =..formData.appointmentInfo.bvid
                    - ..approveAppointment.edge.bvid@: =..formData.appointmentInfo.evid
                    - ..approveAppointment.edge.name@: =..formData.appointmentInfo.name
                    - ..approveAppointment.edge.refid@: =..formData.appointmentInfo.id
                    - ..approveAppointment.edge.stime@: =..formData.appointmentInfo.stime
                    - ..approveAppointment.edge.etime@: =..formData.appointmentInfo.etime
                    - =..approveAppointment.edgeAPI.store: ""
                    - ..approveAppointment10.edge@: =..approveAppointment.response.edge
                    - ..approveAppointment10.edge.id@: ""
                    - ..approveAppointment10.edge.subtype@: 10
                    - ..approveAppointment10.edge.evid@: =.Global.currentFacility.id
                    - ..approveAppointment10.edge.refid@: =..approveAppointment.response.edge.id
                    - =..approveAppointment10.edgeAPI.store: ""
                    - ..invite.edge.refid@: =..approveAppointment10.response.edge.id
                    - ..invite.edge.bvid@: =..formData.appointmentInfo.evid
                    - =..invite.edgeAPI.store: ""
                - actionType: evalObject
                  object: 
                    .Global._nonce@: 
                      =.builtIn.math.random: ""  
                - actionType: evalObject
                  object:  
                    - =..inMeeting.edgeAPI.get: ""
                    - =.builtIn.object.extractArray: 
                        dataIn: 
                          obj: =..inMeeting.edgeResp.edge
                          arr:
                            - stime
                            - etime
                            - name.visitReason
                            - id
                        dataOut: ScheduleManagement.formData.timeTable.chartData
                    - .Global.jwt.edge.bvid@: =.Global.currentUser.vertex.id
                    - =.Global.jwt.edgeAPI.store: ""
                
                - actionType: popUpDismiss
                  popUpView: Next2
                - actionType: builtIn
                  funcName: redraw  
                  viewTag: inviteSuccess
                - actionType: builtIn
                  funcName: redraw  
                  viewTag: calenderTableView
                - actionType: popUp
                  popUpView: inviteSuccess      
    - .BasePopUp:
      viewTag: Detials
      children:
        - type: view
          style:
            top: "0"
            left: "0.6"
            width: "0.4"
            height: "1"
            # backgroundColor: "0xffffff"
            # zIndex: "1000"
          children:
            - .PopUphead:
              children:
                - .CreateLabel:
                - .Closebutton:
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: Detials
            - type: view
              style:
                height: '0.91'
                width: '0.4'
                top: '0.08'
                backgroundColor: '0xffffff'
              children:
                - type: view
                  style:
                    height: '0.44'
                    width: '0.4'
                    top: '0'
                    backgroundColor: '#ffffff'
                  children:
                    - type: label
                      text: Date & Time
                      style:
                        left: '0.16'
                        top: '0.01'
                        fontSize: '14'
                        color: '#000000'
                        textAlign:
                          x: center
                    - type: divider
                      style:
                        left: "0.05"
                        top: '0.04'
                        width: "0.3"
                        height: "0.0001"
                        color: "#707070"
                    - type: label
                      dataKey: appointmentTime
                      style:
                        left: '0'
                        width: "0.4"
                        top: '0.08'
                        fontSize: '18'
                        color: '#000000'
                        textAlign:
                          x: center
                    - type: view
                      style:
                        top: "0.14"
                        left: "0"
                        width: "0.4"
                        height: "0.2"
                      children:
                        - .ScheduleManagementText: 
                          text: Type
                        - .ScheduleManagementDatakey: 
                          dataKey: newAppointment.edge.name.visitType
                        - .ScheduleManagementText: 
                          text: Reason for Visit
                          style: 
                            top: "0.05"
                        - .ScheduleManagementDatakey: 
                          dataKey: selectData.reason
                          style: 
                            top: "0.05"
                        - .ScheduleManagementText: 
                          text: Duration
                          style: 
                            top: "0.1"
                        - .ScheduleManagementDatakey: 
                          dataKey: selectData.duration
                          style: 
                            top: "0.1"
                        # -
                        # - .ScheduleManagementText: 
                        #   text: Notes
                        #   style: 
                        #     top: "0.15"
                        # - .ScheduleManagementDatakey: 
                        #   dataKey: selectData.reason
                        #   style: 
                        #     top: "0.15"
                        - type: button
                          text: "Change Details"
                          onClick:
                            - actionType: popUpDismiss
                              popUpView: Detials
                            - actionType: popUp
                              popUpView: Create1
                          style:
                            left: "0.14"
                            height: "0.035"
                            top: "0.23"
                            width: "0.1"
                            fontSize: "16"
                            border: 
                              style: "6"
                              color: "#005795"
                            backgroundColor: "#ffffff"
                            color: "#005795"
                            textAlign: 
                              x: center
                              y: center
                - type: view
                  style:
                    height: '0.45'
                    width: '0.4'
                    top: '0.44'
                    backgroundColor: '#F5F5F5'
                  children:
                    - type: label
                      text: Add Patient
                      style:
                        left: '0.16'
                        top: '0.03'
                        fontSize: '14'
                        color: '#000000'
                        textAlign:
                          x: center
                    - type: divider
                      style:
                        left: "0.08"
                        top: '0.06'
                        width: "0.2"
                        height: "0.0001"
                        color: "#707070"
                    - type: button
                      text: "Patient List"
                      onClick: 
                        - actionType: popUpDismiss
                          popUpView: Detials
                        - actionType: popUp
                          popUpView: Contacts
                      style:
                        left: "0.3"
                        height: "0.035"
                        top: "0.02"
                        width: "0.07"
                        fontSize: "16"
                        border: 
                          style: "6"
                          color: "#005795"
                        color: "#005795"
                        textAlign: 
                          x: center
                          y: center
                    - type: view
                      style:
                        top: "0.09"
                        left: "0"
                        width: "0.4"
                        height: "0.2"
                      children:
                        - .Label1:
                          text: Patient Name
                          style:
                            fontSize: '13'
                            left: '0.05'
                            top: '0'
                        - .TextField1:
                          placeholder: 'Enter Here' 
                          dataKey: newAppointment.edge.name.patientName
                          style:
                            width: '0.23'
                            left: '0.05'
                            top: '0.04'
                            fontSize: '13'
                        - .Label1:
                          text: 'Phone Number'
                          style:
                            fontSize: '13'
                            left: '0.05'
                            top: '0.11'
                        - .TextField1:
                          placeholder: 'Enter Here' 
                          dataKey: newAppointment.edge.name.patientPhoneNumber
                          style:
                            width: '0.23'
                            left: '0.05'
                            top: '0.15'
                            fontSize: '13'  
                        - type: button
                          text: "Create Appointment"
                          onClick:
                            - actionType: evalObject
                              object:
                                - ..newAppointment.edge.name.Reason@: =..selectData.reason
                                - if:
                                  - =.builtIn.string.equal: 
                                      dataIn: 
                                        string1: =..newAppointment.edge.name.visitType
                                        string2: "Telemedicine"
                                  - ..newAppointment.edge.name.blockColor@: "0xe4f5e9" 
                                  - ..newAppointment.edge.name.blockColor@: "0xfff7e3" 
                                - if:
                                  - =.builtIn.string.equal: 
                                      dataIn: 
                                        string1: =..newAppointment.edge.name.visitType
                                        string2: "Telemedicine"
                                  - ..newAppointment.edge.name.fontColor@: "0x30b354" 
                                  - ..newAppointment.edge.name.fontColor@: "0xffc02d" 
                                - .Global.jwt.edge.bvid@: =..newAppointment.edge.bvid
                                - =.Global.jwt.edgeAPI.store: ""
                                - ..invite.edge.bvid@: =..newAppointment.edge.bvid
                                - =..newAppointment.edgeAPI.store: ""
                                - ..invite.edge.refid@: =..newAppointment.response.edge.id
                                - =..invite.edgeAPI.store: ""
                            - actionType: popUpDismiss
                              popUpView: Detials
                            # - actionType: builtIn
                            #   funcName: redraw  
                            #   viewTag: inviteSuccess
                            - actionType: popUp
                              popUpView: inviteSuccess
                          style:
                            left: "0.12"
                            height: "0.04"
                            top: "0.3"
                            width: "0.14"
                            fontSize: "16"
                            backgroundColor: "#005795"
                            borderRadius: "3"
                            border: 
                              style: "6"
                            color: "#ffffff"
                            textAlign: 
                              x: center  
    - .BasePopUp:
      viewTag: inviteSuccess
      children:
        - .PopUphead:
          style:
            left: '0.588'
            borderRadius: "5"
          children:
            - .CreateLabel:
              text: 'Appointment Detials'
            - .Closebutton:
              onClick:
                - actionType: popUpDismiss
                  popUpView: inviteSuccess
        - type: view
          style:
            height: '0.92'
            width: '0.4'
            top: '0.075'
            left: '0.588'
            backgroundColor: '0xffffff'
          children:
            - type: image
              path: successCheck.png
              style:
                width: '0.1'
                top: '0.12'
                left: '0.155'
            - type: label
              text: 'Success!'
              style:
                width: '0.1'
                height: '0.05'
                left: '0.17'
                top: '0.37'
                fontSize: '28'
            - type: label
              text: 'The appointment invitation has been sent to'
              style:
                width: '0.25'
                height: '0.03'
                left: '0.11'
                top: '0.5'
                fontSize: '16'
            - type: label
              dataKey: formData.inviteMessage
              style:
                width: '0.3'
                height: '0.05'
                left: '0.05'
                top: '0.55'
                fontSize: '16' 
                textAlign: 
                  x: center
                  y: center  
            - .BottomButton:
              text: 'Done'
              style:
                width: '0.12'
                left: '0.15'
                top: '0.7'
                backgroundColor: '#005795'
                color: '0xffffff'
              onClick:
                - actionType: evalObject
                  object: 
                    .Global._nonce@: 
                      =.builtIn.math.random: ""
                - actionType: evalObject
                  object:   
                    - ..appointment.list.edge@: []
                    # - ..appointment.edge.id@: =..formData.providerId
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""
                - actionType: evalObject
                  object: 
                    - =..appointment.edgeAPI.get: ""
                    - =.builtIn.array.getListLength:
                        dataIn:
                          object: =..appointment.list.edge
                        dataOut: ScheduleManagement.formData.appointmentLength
                    - ..appointment.list.edge@: []
                    - =..appointment.edgeAPI.get: ""
                    - =.builtIn.goto:
                        dataIn:
                          destination: ScheduleManagement
                          pageReload: true
                - actionType: builtIn
                  funcName: redraw
                  viewTag: appointmentTag
                - actionType: builtIn
                  funcName: redraw
                  viewTag: appointmentLengthTag
                - actionType: popUpDismiss
                  popUpView: inviteSuccess
                # - goto: ScheduleManagement          
    - .BasePopUp:
    # - type: view
      style:
        top: "0"
        left: "0"
        height: "1"
        width: "1"
        zIndex: "1000"
      viewTag: create1
      children:
        - .PopUphead:
          style:
            left: '0.6'
          children:
            - .CreateLabel:
              style:
            - .Closebutton:
              onClick:
                - actionType: popUpDismiss
                  popUpView: create1
                - actionType: builtIn
                  funcName: hide
                  viewTag: addressView
        - type: view
          style:
            height: '0.91'
            width: '0.4'
            top: '0.08'
            left: '0.6'
            backgroundColor: '0xffffff'
          viewTag: DataTag
          children:
            - type: label
              text: Complete fields below
              style:
                left: '0.02'
                top: '0.01'
                fontSize: '1.8vh'
                color: '#000000'
            - type: label
              text: Select Provider
              style:
                left: '0.06'
                top: '0.07'
                fontSize: '13'
            - .TextField1:
              dataKey: formData.providerName
              isEditable: "false"
              style:
                width: '0.08'
                left: '0.06'
                top: '0.1'
                fontSize: '13'
                backgroundColor: "0xffffff"
            - type: label
              text: Type
              style:
                left: '0.15'
                top: '0.07'
                fontSize: '13'
                width: "0.1"
            # - type: label
            #   # text: Gary Chen, MD
            #   dataKey: formData.providerName
            #   style:
            #     left: '0.07'
            #     top: '0.11'
            #     fontSize: '13'
            #     # width: "0.3"
            - type: select
              options: 
                - "Telemedicine"
                - "Office Visits"
              dataKey: visitType
              onChange:
                - actionType: evalObject
                  object:
                    - if: 
                      - =.builtIn.string.equal:
                          dataIn:
                            string1: =..visitType
                            string2: 'Telemedicine'
                      - actionType: builtIn
                        funcName: hide
                        viewTag: addressView
                      - actionType: builtIn
                        funcName: show
                        viewTag: addressView
                    - if: 
                      - =.builtIn.string.equal:
                          dataIn:
                            string1: =..visitType
                            string2: 'Telemedicine'
                      - actionType: evalObject
                        object:
                          - .ScheduleManagement.formData.currentSubtype@: '196609'
                          - .Global.currentSubtype@: '196609'
                          - .Global.visitType@: "Telemedicine"
                          - ..newAppointment.edge.name.visitType@: "Telemedicine"
                          - ..newAppointment.edge.name.visitTypeShow@: "Telemedicine"
                          - ..newAppointment.edge.subtype: "131074"  # 0x20002 表示类型为telemedicine
                          - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
                          - ..schedule.edge.id.1@: =.Global.currentFacility.id
                      - continue
                    - if: 
                      - =.builtIn.string.equal:
                          dataIn:
                            string1: =..visitType
                            string2: 'Office Visits'
                      - actionType: evalObject
                        object:
                          - .ScheduleManagement.formData.currentSubtype@: '131073'
                          - .Global.currentSubtype@: '131073'
                          - .Global.visitType@: "Office Visits"
                          - ..newAppointment.edge.name.visitType@: "Office Visits"
                          - ..newAppointment.edge.name.visitTypeShow@: "Office Visits"
                          - ..newAppointment.edge.subtype: "196610"  # 0x30002 表示类型为office visit
                          - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
                          - ..schedule.edge.id.1@: =..locationId
                      - continue
                - actionType: evalObject
                  object:
                    - .BaseDate.schedule.scheduleList.edge@: []
                    - ..splitTime@: [] 
                - actionType: updateObject
                  dataKey: ScheduleManagement.schedule.scheduleList.edge
                  dataObject: []  
                - =.Global.jwt.edgeAPI.store: ""
                - actionType: evalObject
                  object:
                    - ..schedule.edge.id.0@: =..formData.providerId
                    - =.builtIn.string.concat:
                        dataIn:
                          - "(stime<"
                          - =.BaseDate.calendarDate.todayStamp.start
                          - " AND "
                          - "etime>"
                          - =.BaseDate.calendarDate.todayStamp.start
                          - " OR "
                          - "stime>"
                          - =.BaseDate.calendarDate.todayStamp.start
                          - " AND "
                          - "etime<"
                          - =.BaseDate.calendarDate.todayStamp.end
                          - " OR "
                          - "stime<"
                          - =.BaseDate.calendarDate.todayStamp.end
                          - " AND "
                          - "etime>"
                          - =.BaseDate.calendarDate.todayStamp.end
                          - ")"
                          - " AND "
                          - "subtype="
                          - =.Global.currentSubtype
                          # - " AND "
                          # - "name like '%"
                          # - =..selectData.reason
                          # - "%'"
                        dataOut: Global.scheduleScondition
                - actionType: evalObject
                  object: 
                    .Global._nonce@: 
                      =.builtIn.math.random: ""
                - actionType: evalObject
                  object:
                    - =..schedule.get: ""
                    # - ..schedule.edge.id@: []
                - actionType: evalObject
                  object: 
                    - if: 
                      - ..schedule.scheduleList.edge.0
                      - =.builtIn.date.splitTime:
                          dataIn:
                            object2: =..schedule.scheduleList.edge
                            timeSlot: =..formData.duration
                            year: =.BaseDate.calendarDate.year
                            month: =.BaseDate.calendarDate.month
                            day: =.BaseDate.calendarDate.day
                          dataOut: ScheduleManagement.splitTime 
                      - ..splitTime@: [] 
                - actionType: builtIn
                  funcName: redraw
                  viewTag: calendarTag
                - actionType: builtIn
                  funcName: redraw
                  viewTag: splitTimeTag
              style:
                left: '0.15'
                top: '0.1'
                fontSize: '13'
                borderColor: "#EAEAEA" 
                width: '0.083'
                height: '0.046'
                textIndent: 10px
            - type: view
              viewTag: addressView
              style: 
                left: '0.24'
                top: '0.07'
                width: '0.1'
                height: '0.15'
                display: none
              children: 
                - type: label
                  text: Address
                  style: 
                    left: '0'
                    top: '0'
                    fontSize: '13'
                    borderColor: "#EAEAEA" 
                    width: '0.1'
                    height: '0.046'
                - type: select
                  dataKey: formDataOfficeVisisAddress
                  options: 
                    ..addressName
                  onChange:
                    - actionType: evalObject
                      object: 
                        - =.builtIn.array.matchInArray:
                            dataIn:
                              arr: =.Global.locationAll
                              value: =..formDataOfficeVisisAddress
                              key: medicalFacilityName
                              key1: "id"
                            dataOut: ScheduleManagement.locationId
                        - =.builtIn.string.concat:
                            dataIn:
                              - "(stime<"
                              - =.BaseDate.calendarDate.todayStamp.start
                              - " AND "
                              - "etime>"
                              - =.BaseDate.calendarDate.todayStamp.start
                              - " OR "
                              - "stime>"
                              - =.BaseDate.calendarDate.todayStamp.start
                              - " AND "
                              - "etime<"
                              - =.BaseDate.calendarDate.todayStamp.end
                              - " OR "
                              - "stime<"
                              - =.BaseDate.calendarDate.todayStamp.end
                              - " AND "
                              - "etime>"
                              - =.BaseDate.calendarDate.todayStamp.end
                              - ")"
                              - " AND "
                              - "subtype="
                              - =.Global.currentSubtype
                              # - " AND "
                              # - "name like '%"
                              # - =..selectData.reason
                              # - "%'"
                            dataOut: Global.scheduleScondition
                    - actionType: evalObject
                      object: 
                        .Global._nonce@: 
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - .BaseDate.schedule.scheduleList.edge@: []
                        - ..splitTime@: [] 
                        - ..schedule.edge.id@: []
                    - actionType: updateObject
                      dataKey: ScheduleManagement.schedule.scheduleList.edge
                      dataObject: []  
                    - actionType: evalObject
                      object:
                        - =.builtIn.array.add:
                            dataIn:
                              object: =..schedule.edge.id
                              value: =..formData.providerId
                        - .Global.jwt.edge.bvid@: =..locationId
                        - =.Global.jwt.edgeAPI.store: ""
                        - =.builtIn.array.add:
                            dataIn:
                              object: =..schedule.edge.id
                              value: =..locationId
                    - actionType: evalObject
                      object:
                        - =..schedule.get: ""
                        - ..schedule.edge.id@: []
                    - actionType: evalObject
                      object: 
                        - if: 
                          - ..schedule.scheduleList.edge.0
                          - =.builtIn.date.splitTime:
                              dataIn:
                                object2: =..schedule.scheduleList.edge
                                timeSlot: =..formData.duration
                                year: =.BaseDate.calendarDate.year
                                month: =.BaseDate.calendarDate.month
                                day: =.BaseDate.calendarDate.day
                              dataOut: ScheduleManagement.splitTime 
                          - ..splitTime@: [] 
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: calendarTag
                    # - actionType: builtIn
                    #   funcName: redraw
                    #   viewTag: DataTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: splitTimeTag

                  style: 
                    left: "0"
                    width: "0.08"
                    top: "0.03"
                    height: "0.046"
                    border: 
                      style: "3"
                    borderWidth: "1"
                    borderColor: "0xdededf"
                    borderRadius: "2"
                    boxSizing: border-box
                    textAlign: 
                      y: center
            - type: label
              text: Duration
              style:
                left: '0.19'
                top: '0.18'
                fontSize: '13'
            # - .TextField1:
            #   placeholder: 'Enter Here'
            - type: textField
              # placeholder: Virtual Care
              dataKey: ScheduleManagement.selectData.duration
              isEditable: "false"
              viewTag: durationTag
              style: 
                left: '0.19'
                top: '0.21'
                fontSize: '13'
                borderWidth: "1"
                borderColor: "#EAEAEA" 
                boxSizing: "border-box"
                width: '0.14'
                height: '0.046'
                textIndent: 10px
                backgroundColor: "0xffffff"
            - type: label
              text: Reason for visit(notes)
              style:
                left: '0.06'
                top: '0.18'
                fontSize: '13'          
            - type: select
              dataKey: selectData.reason
              options:
                ..reasonForVisit
              style:
                width: '0.12'
                left: '0.06'
                top: '0.21'
                borderColor: "#EAEAEA" 
                fontSize: '13'
                height: '0.046'
                backgroundColor: "0xffffff"
              onChange:
                - emit:
                    actions:
                      - =.builtIn.array.getByKey:
                          dataIn:
                            array: =..visitReason.document.name.data.reasonForVisit
                            key1: reason
                            value: =..selectData.reason
                            key2: duration
                          dataOut: ScheduleManagement.selectData.duration
                      - =.builtIn.string.retainNumber:
                          dataIn:
                            value: =..selectData.duration
                          dataOut: ScheduleManagement.formData.duration
                      - .BaseDate.formData.duration@: =.ScheduleManagement.formData.duration
                - actionType: builtIn
                  funcName: redraw
                  viewTag: durationTag 
            - .BaseDate.calendar:
              style:
                top: "0.26"
                left: "0.05"
                borderWidth: "0"
              children:
                - .BaseDate.calendarHeader:
                  children:
                    - .BaseDate.monthView:
                    - .BaseDate.yearView:
                    - .BaseDate.weekView:
                    - type: list
                      contentType: listObject
                      listObject: =.BaseDate.calendarDate.minidayLable
                      iteratorVar: itemObject
                      style:
                        top: "0.06"
                        left: "0.015"
                        width: "0.21"
                        # height: "auto"
                        # justifyContent: "space-between"
                      children:
                        - type: listItem
                          itemObject: ""
                          onClick:
                            - emit:
                                dataKey:
                                  var: itemObject
                                actions:
                                  - =.builtIn.date.miniWeeklyCalendarArray:
                                      dataIn:
                                        year: $var.year
                                        month: $var.month
                                        today: $var.day
                                        markDay: $var.day
                                        color: "0x000000"
                                        backgroundColor: "0xFFFFFF6f"
                                        todayColor: "0xffffff"
                                        todayBackgroundColor: "0x2988E6"
                                      dataOut: BaseDate.calendarDate.minidayLable
                                  - .BaseDate.calendarDate.year@: $var.year
                                  - .BaseDate.calendarDate.month@: $var.month
                                  - .BaseDate.calendarDate.day@: $var.day
                                  - =.builtIn.date.ShowDateByNumber:
                                      dataIn:
                                        year: =.BaseDate.calendarDate.year
                                        month: =.BaseDate.calendarDate.month
                                        day: =.BaseDate.calendarDate.day
                                        formatType: "Y-M-D"
                                      dataOut: BaseDate.calendarDate.todayDate
                                  - =.builtIn.date.transformMonth:
                                      dataIn:
                                        month: =.BaseDate.calendarDate.month
                                      dataOut: BaseDate.calendarDate.monthName
                                  - =.builtIn.date.getTimeStampOfDate:
                                      dataIn:
                                        date: =.BaseDate.calendarDate.todayDate
                                      dataOut: BaseDate.calendarDate.todayStamp
                                  - =.builtIn.string.concat:
                                      dataIn:
                                        - "(stime<"
                                        - =.BaseDate.calendarDate.todayStamp.start
                                        - " AND "
                                        - "etime>"
                                        - =.BaseDate.calendarDate.todayStamp.start
                                        - " OR "
                                        - "stime>"
                                        - =.BaseDate.calendarDate.todayStamp.start
                                        - " AND "
                                        - "etime<"
                                        - =.BaseDate.calendarDate.todayStamp.end
                                        - " OR "
                                        - "stime<"
                                        - =.BaseDate.calendarDate.todayStamp.end
                                        - " AND "
                                        - "etime>"
                                        - =.BaseDate.calendarDate.todayStamp.end
                                        - ")"
                                        - " AND "
                                        - "subtype="
                                        - =.Global.currentSubtype
                                        # - " AND "
                                        # - "name like '%"
                                        # - =..selectData.reason
                                        # - "%'"
                                      dataOut: Global.scheduleScondition
                                  # - =.builtIn.string.concat:
                                  #     dataIn:
                                  #       - "stime>"
                                  #       - =.BaseDate.calendarDate.todayStamp.start
                                  #       - " AND "
                                  #       - "etime<"
                                  #       - =.BaseDate.calendarDate.todayStamp.end
                                  #       - " AND "
                                  #       - "subtype="
                                  #       - =.Global.currentSubtype
                                  #     dataOut: Global.scheduleScondition
                            - actionType: evalObject
                              object:
                                - .BaseDate.schedule.scheduleList.edge@: []
                                - ..splitTime@: [] 
                            - actionType: updateObject
                              dataKey: ScheduleManagement.schedule.scheduleList.edge
                              dataObject: []    # 将所得的可用时间置空,防止所选的那天为空,但是使用了缓存值
                            - actionType: evalObject
                              object: 
                                .Global._nonce@: 
                                  =.builtIn.math.random: ""
                            - actionType: evalObject
                              object:
                                - =.builtIn.array.add:
                                    dataIn:
                                      object: =..schedule.edge.id
                                      value: =..formData.providerId
                                - if:  
                                  - =.builtIn.string.equal:
                                      dataIn:
                                        string1: =..newAppointment.edge.name.visitType
                                        string2: "Office Visits"
                                  - .Global.jwt.edge.bvid@: =..locationId
                                  - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
                                - =.Global.jwt.edgeAPI.store: ""
                                - if: 
                                  - =.builtIn.string.equal:
                                      dataIn:
                                        string1: =..newAppointment.edge.name.visitType
                                        string2: "Office Visits"
                                  - =.builtIn.array.add:
                                      dataIn:
                                        object: =..schedule.edge.id
                                        value: =..locationId
                                  - =.builtIn.array.add:
                                      dataIn:
                                        object: =..schedule.edge.id
                                        value: =.Global.currentFacility.id
                            - actionType: evalObject
                              object:
                                - =..schedule.get: ""
                                - ..schedule.edge.id@: []
                            - actionType: evalObject
                              object: 
                                - if: 
                                  - ..schedule.scheduleList.edge.0
                                  - =.builtIn.date.splitTime:
                                      dataIn:
                                        object2: =..schedule.scheduleList.edge
                                        timeSlot: =..formData.duration
                                        year: =.BaseDate.calendarDate.year
                                        month: =.BaseDate.calendarDate.month
                                        day: =.BaseDate.calendarDate.day
                                      dataOut: ScheduleManagement.splitTime 
                                  - ..splitTime@: [] 
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: calendarTag
                            # - actionType: builtIn
                            #   funcName: redraw
                            #   viewTag: DataTag
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: splitTimeTag
                            # - actionType: evalObject
                            #   object: 
                            #     - ..splitTime@: []
                          style:
                            width: "0.03"
                            height: "0.02"
                            # boxSizing: "border-box"
                            # border: "none"
                            padding: "0"
                            margin: "0"
                            display: "inline-block"
                            # flex: "auto"
                            marginTop: "0.02"
                          children:
                            - type: label
                              dataKey: itemObject.day
                              style:
                                top: "0"
                                left: "0.0065"
                                width: "0.017"
                                height: "0.03"
                                color: itemObject.color
                                backgroundColor: itemObject.backgroundColor
                                borderRadius: "50"
                                fontSize: "18"
                                textAlign:
                                  x: center
                                  y: center

                - .BaseDate.leftWeek:
                - .BaseDate.nextWeek:
            - type: label
              text: Availability
              style:
                left: '0.04'
                top: '0.42'
                fontSize: '1.8vh'
            - type: scrollView
              viewTag: splitTimeTag
              style: 
                top: "0.48"
                height: "0.4"
                width: "0.3"
                left: "0.05"
                overflow: scroll
              children: 
                # - type: label
                #   dataKey: splitTime.0.showTime
                #   style:
                #     top: "0"
                - type: list
                  contentType: listObject
                  listObject: .ScheduleManagement.splitTime
                  iteratorVar: itemObject
                  style:
                    top: "0"
                    height: "0.4"
                    width: "0.3"
                    left: "0"
                    margin: "0"
                    display: inline-block
                  children:
                    - type: listItem
                      itemObject: "" 
                      onClick:
                        - emit: 
                            dataKey: 
                              var: itemObject
                            actions: 
                              - =.builtIn.string.concat: 
                                  dataIn: 
                                    - =.BaseDate.calendarDate.monthName
                                    - " "
                                    - =.BaseDate.calendarDate.day
                                    - ","
                                    - =.BaseDate.calendarDate.year
                                    - " "
                                    - "at"
                                    - " "
                                    - $var.showTime
                                  dataOut: ScheduleManagement.appointmentTime
                              - ..clock@: $var
                              - ..newAppointment.edge.stime@: =..clock.stime
                              - ..newAppointment.edge.etime@: =..clock.etime
                              - ..newAppointment.edge.refid@: =..clock.refid
                              # - ..newAppointment.edge.evid@: =..formData.providerId
                        - actionType: evalObject
                          object: 
                            # - if: 
                                # - ..newAppointment.edge.name.visitType@: "Office Visits"
                                # - =.builtIn.string.equal:
                                #     dataIn:
                                #       string1: =..newAppointment.edge.name.visitType
                                #       string2: "Office Visits"
                                # - ..newAppointment.edge.bvid@: =..locationId
                                # - ..newAppointment.edge.bvid@: =.Global.currentFacility.id
                            - ..newAppointment.edge.bvid@: =..formData.providerId
                        - actionType: builtIn
                          funcName: hide
                          viewTag: addressView
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: Detials
                        - actionType: popUpDismiss
                          popUpView: create1
                        - actionType: popUp
                          popUpView: Detials
                      style:
                        width: '0.05'
                        height: '0.03'
                        left: '0'
                        float: left
                        marginRight: "2%"
                        marginTop: "0.02"
                        backgroundColor: "0x2988e6"
                        border:   
                          style: '3'
                        borderColor: "0x2988e6"
                        borderRadius: "5"
                      children:
                        - type: label
                          dataKey: itemObject.showTime
                          style: 
                            left: "0"
                            width: "0.05"
                            height: "0.03"
                            color: "0xffffff"
                            textAlign:
                              x: center
                              y: center