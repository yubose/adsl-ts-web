EditFacilityInfo: #xd page number: 59
  pageNumber: "350" 
  init:
    - .SignInCheck
    - ..fac_RootNotebook.edgeReq.id@: =.Global.formData.locationId
    - =..fac_RootNotebook.edgeAPI.get: ""
    - ..facility.documentReq.id@: =..fac_RootNotebook.edge.edge.0.id
    - =..facility.docAPI.get: ""
    - ..facility.document.eid@: =..fac_RootNotebook.edge.edge.0.id
    - ..BusinessLogo.docIn.id@: =..fac_RootNotebook.edge.edge.0.id
    - ..Profile.docIn.id@: =..fac_RootNotebook.edge.edge.0.id
    - ..BusinessLogo.document.eid@: =..fac_RootNotebook.edge.edge.0.id
    - ..Profile.document.eid@: =..fac_RootNotebook.edge.edge.0.id
    - =..location.vertexAPI.get: ""
    - ..location.vertex@: =..location.resp.vertex.0
    - if:
      - =..facility.response.doc.0
      - ..facility.document@: =..facility.response.doc.0
      - ..facility.document.name.data.basicInfo@: =.Global.currentFacility.name.basicInfo
    - =..BusinessLogo.docAPI.get: ""
    - =..Profile.docAPI.get: ""
    - if: 
      - =..BusinessLogo.resp.doc.0
      - actionType: evalObject
        object:
          - =.builtIn.utils.prepareDoc:
              dataIn:
                doc: =..BusinessLogo.resp.doc.0
              dataOut: EditFacilityInfo.BusinessLogo.resp
      - continue
    - actionType: evalObject
      object:
        - ..BusinessLogo.url@: =..BusinessLogo.resp.name.data
    - if: 
      - =..Profile.resp.doc.0
      - actionType: evalObject
        object:
          - =.builtIn.utils.prepareDoc:
              dataIn:
                doc: =..Profile.resp.doc.0
              dataOut: EditFacilityInfo.Profile.resp
      - continue
    - actionType: evalObject
      object:
        - ..Profile.url@: =..Profile.resp.name.data
  viewPort: top
  title: "EditFacilityInfo"
  formData:
    state: ""
  getJWT:
    edge:
      type: .EdgeType.JWT
      bvid: .Global.currentFacility.id
    edgeAPI:
      store:
        api: ce
        dataIn: EditFacilityInfo.getJWT.edge
  fac_RootNotebook:
    edgeReq:
      id: ""
      xfname: bvid
      type: .EdgeType.RootNotebook
    edge: ""
    edgeAPI:
      get:
        api: re
        dataIn: EditFacilityInfo.fac_RootNotebook.edgeReq
        dataOut: EditFacilityInfo.fac_RootNotebook.edge
  facility:
    # response: ""
    # document: ""
    # vertex:
      # id: .Global.currentFacility.id
    response: ""
    documentReq:
      id: ""
      xfname: eid
      type: .DocType.FacilityProfile
    document:
      # eid: .Global.rootNotebookID
      eid: ""
      # fid: .Global.currentFacility.id
      type: .DocType.FacilityProfile
      name: 
        data: 
          basicInfo: ""
    docAPI:
      store:
        api: cd
        dataIn: EditFacilityInfo.facility.document
      get:
        api: rd
        dataIn: EditFacilityInfo.facility.documentReq
        dataOut: EditFacilityInfo.facility.response
  location:   # 更新profile的同时，把最新的信息都更新到vertex上，保持最新
    resp: ""
    vertexIn: 
      id: .Global.formData.locationId
      xfname: "id"
      # sCondition: "E.type=1100 AND V.type!=1"
      obfname: "mtime"
      asc: true
      _nonce: =.Global._nonce
    vertex: 
      .Vertex: ""
      type: ""
      name: 
        basicInfo:
          medicalFacilityName: ""
          specialty: ""
          phoneNumber: ""
          introduction: ""
          address: ""
          city: ""
          state: ""
          zipCode: ""
          NPI: ""
          DEANumber: ""
          medicalLicense: ""
          medicalLicenseState: ""
      uid: ""
      jwt: ""
      # pk: "VW/ceBN733d2oAki+muUeSAaKZBaE9SIbRJu5gBz40c="
      # esk: "2f8J1+aRIftJkKL+VxLb00qYjW3hWfQwLIBGumdwum/NHXlv6VChfmPIhj0bTOaUK4VscRwwa4soTqJ8x0a1jsOBoDDZz5aR"
    vertexAPI:
      .VertexAPI: ""
      get: 
        api: rv
        dataIn: EditFacilityInfo.location.vertexIn
        dataOut: EditFacilityInfo.location.resp
      store: 
        api: cv
        dataIn: EditFacilityInfo.location.vertex
        # dataOut: EditFacilityInfo.location.resp
  BusinessLogo:
    url: BusinessLogo.png
    document:
      .Document: ""
      subtype:
        isEncrypted: "1"
        isOnServer: "0"
      type: .DocType.BusinessLogoPicture
      name:
        title: ""
        type: ..BusinessLogo.docAPI.store.subtype.mediaType
        data: binFile
      deat:
        sig: ""
        url: ""     
      eid: ""
    resp: ""
    docIn: 
      id: .Global.rootNotebookID
      xfname: eid
      type: .DocType.BusinessLogoPicture
      maxcount: "1"
      obfname: "ctime"
      _nonce: =.Global._nonce
    docAPI: 
      store:
        api: cd
        dataKey: BusinessLogo.document
        subtype:
          mediaType: ""
      get:
        .DocAPI.get: "" 
        dataIn: BusinessLogo.docIn
        dataOut: EditFacilityInfo.BusinessLogo.resp
  Profile:
    url: ProfilePicture.png
    document:
      .Document: ""
      subtype:
        isEncrypted: "1"
        isOnServer: "0"
      type: .DocType.ProfilePicture
      name:
        title: ""
        type: ..Profile.docAPI.store.subtype.mediaType
        data: binFile
      deat:
        sig: ""
        url: ""     
      eid: "" 
    docIn: 
      id: ""
      xfname: eid
      type: .DocType.ProfilePicture
      maxcount: "1"
      obfname: "ctime"
      _nonce: =.Global._nonce
    docAPI: 
      store:
        api: cd
        dataKey: Profile.document
        subtype:
          mediaType: ""
      get:
        .DocAPI.get: "" 
        dataIn: Profile.docIn
        dataOut: EditFacilityInfo.Profile.resp
  components:
    - .SideMenuBar:
      children:
        - .aitLogo:
        - .MenuBar:
    - .TopBar:
    - .BodyView:
      children:
        - type: view
          style:  
            left: "0.03"
            top: "0.01"
            width: "0.78"
            height: "0.06"
          children: 
            - .EdLabel:
              text: Back
              onClick: 
                - goto: FacilityInfo1
              style:
                height: "0.055"
                width: "0.08"
                fontSize: "1.8vh"
                top: "0.024"
                left: "0"
                textDecoration: underline
                color: "0x005795"
                # backgroundColor: "0xcdcdcd"
                textAlign: 
                  x: left
            - .Edimage:
              path: Icon material-close.png
            - .EdLabel:
              text: "NOT VERIFIED YET"
    - .ContentView:
      style: 
        height: "0.83"
        left: "0.19"
        top: "0.145"
      children:
        - type: label
          text: "Account Management"
          style:
            fontSize: "16"
            left: "0.02"
            top: "0.03"
            color: "#517086"
        - .Label1:
          text: "Medical Facility Name"
          style:
            left: "0.04"
            top: "0.09"
        - .TextField1:
          dataKey: facility.document.name.data.basicInfo.medicalFacilityName
          style:
            width: "0.25"
            left: "0.04"
            top: "0.12"
        - .Label1:
          text: "Phone Number"
          style:
            left: "0.31"
            top: "0.09"
        - .TextField1:
          # placeholder: "(714)123-4567"
          dataKey: facility.document.name.data.basicInfo.phoneNumber
          style:
            width: "0.25"
            left: "0.31"
            top: "0.12"
        - .Label1:
          text: "Specialty"
          style:
            left: "0.61"
            top: "0.09"
        - type: select
          dataKey: facility.document.name.data.basicInfo.specialty
          options:
            .SpecialtySelect
          style:
            top: "0.12"
            left: "0.61"
            width: "0.15"
            height: "0.05"
            borderColor: "#eaeaea"
            color: "#000000"
            borderRadius: "3px 3px 0px 0px"
        - type: image
          path: bottomArrow.png
          style:
            top: "0.12"
            left: "0.745"
            height: "0.05"
        - .Label1:
          text: "Address"
          style:
            left: "0.04"
            top: "0.18"
        - .TextField1:
          # placeholder: "1000 S Anaheim Blvd Ste 200"
          dataKey: facility.document.name.data.basicInfo.address
          style:
            width: "0.25"
            left: "0.04"
            top: "0.21"
        - .Label1:
          text: "City"
          style:
            left: "0.31"
            top: "0.18"
        - .TextField1:
          # placeholder: "Anaheim"
          dataKey: facility.document.name.data.basicInfo.city
          style:
            width: "0.25"
            left: "0.31"
            top: "0.21"   
        - .Label1:
          text: "State"
          style:
            left: "0.61"
            top: "0.18"
        - .TimeSelect:
          style:
            width: "0.06"
            left: "0.61"
            top: "0.21"
            fontStyle: "bold"
          dataKey: facility.document.name.data.basicInfo.state
          options: .SelectData.state               
            
        - .Label1:
          text: "Zip Code"
          style:
            left: "0.68"
            top: "0.18"
        - .TextField1:
          # placeholder: "12345"
          dataKey: facility.document.name.data.basicInfo.zipCode
          style:
            width: "0.09"
            left: "0.68"
            top: "0.21"    
        - .Label1:
          text: "Introduction"
          style:
            left: "0.04"
            top: "0.28"
        - type: textView
          # placeholder: "Lorem ipsum dolor sit amet,consectetur adipiscing elit.Vestibulum porttitor iaculis velit,sit amet interdum risus lacinia at.Praesent porta ac lorem gravida commodo.Aliquam dictum volutpat justo,sit amet interdum leo elementum eu.Aenean varius dolor at pellentesque sagittis.Cras consectetur leo nec libero ultricies malesuada."
          dataKey: facility.document.name.data.basicInfo.introduction
          style:
            width: "0.73"
            height: "0.1"
            fontFamily: "sans-serif"
            left: "0.04"
            top: "0.31"
            borderColor: "#EAEAEA"
        - .Label1:
          text: "Tax ID"
          style:
            left: "0.04"
            top: "0.43"
        - .TextField1:
          placeholder: "1234567890"
          dataKey: facility.document.name.data.basicInfo.taxId
          style:
            width: "0.25"
            left: "0.04"
            top: "0.46"
        - .Label1:
          text: "NPI"
          style:
            left: "0.31"
            top: "0.43"
        - .TextField1:
          # placeholder: "1234567890"
          dataKey: facility.document.name.data.basicInfo.NPI
          style:
            width: "0.21"
            left: "0.31"
            top: "0.46"
        # - .Label1:
        #   text: "Insurance"
        #   style:
        #     left: "0.04"
        #     top: "0.52"
        # - .TextField1:
        #   placeholder: "ICW Group"
        #   style:
        #     width: "0.27"
        #     left: "0.04"
        #     top: "0.55"
        # - .Label1:
        #   text: "Medical License #"
        #   style:
        #     left: "0.33"
        #     top: "0.52"
        # - .TextField1:
        #   # placeholder: "A12345"
        #   dataKey: facility.document.name.data.basicInfo.medicalLicense
        #   style:
        #     width: "0.27"
        #     left: "0.33"
        #     top: "0.55"
        # - .Label1:
        #   text: "Medical License State"
        #   style:
        #     left: "0.62"
        #     top: "0.52"
        #     # color: "#1492E6"
        # - type: select
        #   dataKey: facility.document.name.data.basicInfo.medicalLicenseState
        #   options:
        #     - CA 
        #     - a
        #     - b
        #   style:
        #     top: "0.55"
        #     left: "0.62"
        #     width: "0.08"
        #     height: "0.05"
        #     borderColor: "#eaeaea"
        #     color: "#000000"
        #     borderRadius: "3px 3px 0px 0px"
        #     fontStyle: "bold"
        # - type: image
        #   path: bottomArrow.png
        #   style:
        #     top: "0.55"
        #     left: "0.67"
        #     height: "0.05"

        - type: label
          text: "Uploads"
          style:
            fontSize: "16"
            left: "0.02"
            top: "0.54"
            color: "#517086"   
        - type: view
          viewTag: pictureView
          style: 
            left: "0"
            width: "0.78"
            top: "0.59"
            height: "0.23"
          children: 
            - .Label1:
              text: "Business Logo"
              style:
                left: "0.16"
                top: "0"  
                width: "0.15"
                textAlign: 
                  x: center
            - .Label1:
              text: "Profile Picture"
              style:
                left: "0.47"
                top: "0"  
                width: "0.15"
                textAlign: 
                  x: center
            - .EdImage:
              contentType: file
              onClick:
                - actionType: updateObject
                  dataObject: BLOB
                  dataKey: EditFacilityInfo.BusinessLogo.document.name.data
                - actionType: popUp
                  popUpView: uploading 
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..fac_RootNotebook.edge.edge.0.id
                              string2: =.Global.fac_rootNotebook
                        - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
                        - .Global.jwt.edge.bvid@: =.Global.formData.locationId
                    - =.Global.jwt.edgeAPI.store: ""  
                    - =..BusinessLogo.docAPI.store: ""
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""
                - actionType: evalObject
                  object: 
                    - =..BusinessLogo.docAPI.get: ""
                - actionType: evalObject
                  object:
                    - =.builtIn.utils.prepareDoc:
                        dataIn:
                          doc: =..BusinessLogo.resp.doc.0
                        dataOut: EditFacilityInfo.BusinessLogo.resp
                - actionType: evalObject
                  object:
                    - ..BusinessLogo.url@: =..BusinessLogo.resp.name.data
                - actionType: popUpDismiss
                  popUpView: uploading 
                - actionType: builtIn
                  funcName: redraw
                  viewTag: pictureView
              path: 
                emit: 
                  actions: 
                    - if: 
                      - =..BusinessLogo.resp.name.data
                      - ..BusinessLogo.url
                      - BusinessLogo.png
              style:
                left: "0.16"
                top: "0.05"
                width: "0.15"
                height: "0.1"
            - .EdImage:
              contentType: file
              onClick:
                - actionType: updateObject
                  dataObject: BLOB
                  dataKey: EditFacilityInfo.Profile.document.name.data
                - actionType: popUp
                  popUpView: uploading 
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..fac_RootNotebook.edge.edge.0.id
                              string2: =.Global.fac_rootNotebook
                        - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
                        - .Global.jwt.edge.bvid@: =.Global.formData.locationId
                    - =.Global.jwt.edgeAPI.store: ""    
                    - =..Profile.docAPI.store: ""
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""
                - actionType: evalObject
                  object: 
                    - =..Profile.docAPI.get: ""
                - actionType: evalObject
                  object:
                    - =.builtIn.utils.prepareDoc:
                        dataIn:
                          doc: =..Profile.resp.doc.0
                        dataOut: EditFacilityInfo.Profile.resp
                - actionType: evalObject
                  object:
                    - ..Profile.url@: =..Profile.resp.name.data
                - actionType: popUpDismiss
                  popUpView: uploading 
                - actionType: builtIn
                  funcName: redraw
                  viewTag: pictureView
              path: 
                emit: 
                  actions: 
                    - if: 
                      - =..Profile.resp.name.data
                      - ..Profile.url
                      - ProfilePicture.png
              style:
                left: "0.47"
                top: "0.05"
                width: "0.15"
                height: "0.1"
        - .BottomButton:
          text: "Save"
          onClick:
            - actionType: popUp
              popUpView: uploading 
            - actionType: evalObject
              object:
                - .Global.jwt.edge.bvid@: =.Global.formData.locationId
                - =.Global.jwt.edgeAPI.store: ""
                - =..facility.docAPI.store: ""
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =..fac_RootNotebook.edge.edge.0.id
                          string2: =.Global.fac_rootNotebook
                    - .Global.currentFacility.name.basicInfo@: =..facility.document.name.data.basicInfo
                    - continue
                - ..location.vertex.name.basicInfo@: =..facility.document.name.data.basicInfo
                - ..location.vertex.uid@: =..facility.document.name.data.basicInfo.phoneNumber
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =..fac_RootNotebook.edge.edge.0.id
                          string2: =.Global.fac_rootNotebook
                    - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
                    - .Global.jwt.edge.bvid@: =.Global.formData.locationId
                - =.Global.jwt.edgeAPI.store: ""    
                - =..location.vertexAPI.store: ""
            - actionType: popUp
              popUpView: uploading 
            - goto: FacilityInfo1
          style:
            left: "0.65"
            top: "0.04"
            color: "#ffffff"
            backgroundColor: "#00497c"
            width: "0.11"
    - .LoadingView: ""
      message: "loading ..."
      viewTag: uploading

      
      