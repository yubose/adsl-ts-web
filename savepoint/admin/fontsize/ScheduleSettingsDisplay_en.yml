ScheduleSettingsDisplay: #xd page number: 65
  pageNumber: "380"
  init:
  #   - .SignInCheck
    - actionType: evalObject
      object: .BaseDate.getDate

    - actionType: evalObject
      object:
        - =.builtIn.date.LoopToGenerate:
            dataIn:
              span: =..newAppointment.edge.name.setting.bookingTimeSpan
            dataOut: ScheduleSettingsDisplay.scheduleSettingsTemp.TimeSpan
    - actionType: evalObject
      object:
        .ScheduleSettingsDisplay.newAppointment.edge.name.setting.timezoneOffsetInMinute@:
          =.builtIn.date.getTimezoneOffset: ""
    - actionType: evalObject
      object:
        - if:
          - =.Global.currentSchedule.id
          - ..newAppointment.edge@: =.Global.currentSchedule
          - ..newAppointment.edge@: =..newBackup
        - if:
          - =.Global.currentSchedule.id
          - =.builtIn.array.transformNull:
              dataIn:
                dayObject: =..newAppointment.edge.name.setting.day
          - continue
        - ..newAppointment.edge.id@: ""
        - if:
          - =.Global.currentSchedule.id
          - =.builtIn.date.transformSelectWeek:
              dataIn:
                object: =.Global.currentSchedule.name.setting.day
              dataOut: ScheduleSettingsDisplay.formData.res
          - continue
        - if:
          - =.ScheduleSettingsDisplay.formData.res.addWeek.0
          - ..addWeek@: =.ScheduleSettingsDisplay.formData.res.addWeek
          - continue
        - if:
          - =.ScheduleSettingsDisplay.formData.res.selectWeek.0
          - ..scheduleSettingsTemp.weekDaySelect@: =.ScheduleSettingsDisplay.formData.res.selectWeek
          - continue
    - ..newAppointment.edge.name.visitType@: =.Global.formData.scheduleType
    - ..newAppointment.edge.name.setting.Address@: =.Global.formData.scheduleAddress
    - if:  # 判断是什么类型，并根据类型决定预约的edge的bvid
      - =.builtIn.string.equal:
          dataIn:
            string1: =..newAppointment.edge.name.visitType
            string2: "Telemedicine"
      - ..newAppointment.edge.bvid@: =.Global.currentFacility.id 
      - ..newAppointment.edge.bvid@: =.Global.formData.scheduleLocationId
    - ..newAppointment.edge.name.setting.startDate@: =.BaseDate.calendarDate.todayDate
    - if:  # 判断是什么类型，并根据类型决定是否可编辑地址
      - =.builtIn.string.equal:
          dataIn:
            string1: =..newAppointment.edge.name.visitType
            string2: "Telemedicine"
      - continue
      - =.builtIn.checkField:
          dataIn:
            contentType: messageHidden
            wait: 100 


  viewPort: top
  # WeekData: 
  newAppointment:
    response:
    edge:
      .Edge: ""
      id: ""
      subtype: .Global.setSchedule.scheduleTypeNumber #   0x10003 3<<16 + 1  3*65536 +1  0x30000|1 196609   online ,  +2 in office  0x20000|1    2<<16 + 1  131073,  0x10000|1 1<<16+1 65537
      type: 40000
      # bvid: .Global.currentFacility.id 
      bvid: ""  
      evid: .Global.acceptInfo.bsig
      name:
        roomName: ""
        visitType: ""
        setting:
          day:
            -
            -
            -
            -
            -
            -
            -
          forwardRepeatWeeks: '10'
          blockDays: []
          governmentHolidays: ''
          businessHolidays: ''
          # advanceBookingLimit: '1'
          bookingTimeSpan: '30'
          timeSlotBackColor: "#ffffff"
          timeSlotColor: "#000000"
          timezoneOffsetInMinute: "" 
          startDate: ""
          endDate: ""  
          Address: ""
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: newAppointment.edge
        dataOut: newAppointment.response
  AvailableTime: 
    timeStart: "" 
    timeEnd: "" 
    timeResult: ""
  addWeek: []

  scheduleSettingsTemp:
    weekdayTemp:
      - key: Su
        index: 0
      - key: M
        index: 1
      - key: T
        index: 2
      - key: W
        index: 3
      - key: Th
        index: 4
      - key: F
        index: 5
      - key: Sa
        index: 6
    weekDaySelect:
      - key: M
        index: 1
      - key: T
        index: 2
      - key: W
        index: 3
    TimeSpan:  
      - 00:00
      - 12:00
  date:
    - day: Sunday
    - day: Monday
    - day: Tuesday
    - day: Wednesday
    - day: Thursday
    - day: Friday
    - day: Saturday
  components:
    - .SideMenuBar:
      children:
        - .aitLogo:
        - .MenuBar:
    - .TopBar:
    - .BodyView:
      children:
        - .ContentView:
          style:
            height: "0.85"
            top: "0.05"
          children:
            - type: view
              style:
                width: "0.78"
                height: "0.2"
                top: "0"
                left: "0"
                border: 
                  style: "2"
                borderWidth: "1"
                borderColor: "#cfcfcf"
              children:
                - type: image
                  path: 
                    emit: 
                      actions: 
                        - if: 
                          - =.Global.acceptInfo.name.inviteeAvatar.data
                          - .Global.acceptInfo.name.inviteeAvatar.data
                          - ava.png
                  # path=func: .builtIn.utils.prepareDocToPath
                  # dataKey: Global.acceptInfo.name.inviteeAvatar
                  style:
                    top: "0.05"
                    left: "0.045"
                    width: "0.06"
                - type: label
                  dataKey: Global.acceptInfo.name.inviteeName
                  style:
                    top: "0.07"
                    left: "0.16"
                    fontSize: "18"
                    fontFamily: Poppins
                    color: "#646d82"
                - type: label
                  dataKey: Global.acceptInfo.name.inviteeCategory
                  style:
                    top: "0.1"
                    left: "0.16"
                    fontSize: "14"
                    fontFamily: Poppins
                    color: "#a6b1c2"   
                - type: label
                  text: Availability Settings
                  style:
                    top: "0.13"
                    left: "0.3"
                    fontSize: "2.1vh"
                    fontFamily: sans-serif
                    color: "#000000"  
                # - type: view
                #   style: 
                #     top: "0.2"
                #     left: "0.3"
                #     width: "0.4"
                #   children:
                #     - type: image
                #       path: MaterialCheck.png
                #       style:
                #         left: "0"
                #         top: "0"
                #         width: "0.015"
                #     - type: label
                #       text: 1000 S Anaheim Blvd Anaheim, CA 92805
                #       style:
                #         top: "0"
                #         left: "0.02"
                #         fontSize: "16"
                #         fontFamily: Poppins
                # - type: view
                #   style: 
                #     top: "0.25"
                #     left: "0.3"
                #     width: "0.4"
                #   children:
                #     - type: image
                #       path: MaterialNoCheck.png
                #       style:
                #         left: "0"
                #         top: "0"
                #         width: "0.015"
                #     - type: label
                #       text: 17610 Bloomfield Ave Cerritos, CA 90703
                #       style:
                #         top: "0"
                #         left: "0.02"
                #         fontSize: "16"
                #         fontFamily: Poppins
                - type: label
                  text: Cancel
                  onClick:
                    - actionType: builtIn
                      funcName: goBack
                      reload: true
                  style:
                    top: "0.03"
                    left: "0.72"
                    fontSize: "14"
                    color: "#1492e6"
                # - type: label
                #   text: Status
                #   style:
                #     top: "0.08"
                #     left: "0.65"
                #     fontSize: "18"
                #     color: "#517086"   
                # - type: image
                #   path: switch.png
                #   style:
                #     top: "0.08"
                #     left: "0.715"
                #     width: "0.03"                            
            - type: view
              style:
                width: "0.78"
                height: "0.645"
                top: "0.2"
                left: "0"
                border: 
                  style: "2"
                borderColor: "#cfcfcf"
              children:
                - type: view
                  style:
                    top: "0.04"
                    left: "0.05"
                    width: "0.7"
                    height: "0.1"
                    # backgroundColor: "#8dd35f"
                  children:
                    - type: view
                      style:
                        left: "0"
                        width: "0.21"
                        height: "0.1"
                        # backgroundColor: "#fccb43"
                      children: 
                        - type: label
                          text: "Appointment Type"
                          style:
                            left: "0"
                            width: "0.21"
                            height: "0.04"
                            fontSize: "15"
                            # fontWeight: "300"
                        - type: label
                          dataKey: newAppointment.edge.name.visitType
                          # options:
                          #   .appointmentType
                          onChange:
                            - actionType: evalObject
                              object:
                                
                                - if: 
                                  - =.builtIn.string.equal:
                                      dataIn:
                                        string1: =..newAppointment.edge.name.visitType
                                        string2: Telemedicine
                                  - ..newAppointment.edge.subtype@: 196611
                                  - ..newAppointment.edge.subtype@: 131075
                          style:
                            top: "0.04"
                            left: "0"
                            width: "0.21"
                            height: "0.04"
                            border: 
                              style: "3"
                            borderWidth: "1"
                            borderColor: "#eaeaea"
                            boxSizing: border-box
                            textIndent: 1em
                            textAlign: 
                              y: center
                    - type: view
                      contentType: messageHidden
                      style:
                        left: "0.25"
                        width: "0.25"
                        height: "0.1"
                        top: "0"
                        isHidden: "true"
                      children: 
                        - type: label
                          text: "Address location"
                          style:
                            left: "0"
                            width: "0.25"
                            height: "0.04"
                            fontSize: "15"
                        - type: label
                          dataKey: newAppointment.edge.name.setting.Address
                          # options:
                          #   .location
                          style:
                            top: "0.04"
                            left: "0"
                            width: "0.25"
                            fontSize: "15"
                            height: "0.04"
                            textIndent: 1em
                            borderColor: "#eaeaea"
                            border: 
                              style: "3"
                            textAlign: 
                              y: center
                - type: label
                  text: "Select the available days that patient can be scheduled"
                  style:
                    top: "0.17"
                    left: "0.05"
                    fontSize: "16"
              
                - type: view
                  viewTag: AvailableTimeTag
                  style:
                    top: "0.22"
                    left: "0.05"
                    width: "0.25"
                    height: "0.407"
                    border:
                      style: "3"
                    borderColor: "#d0d9df"
                  children:
                    - type: view
                      style:
                        top: "0"
                        left: "0"
                        width: "0.25"
                        height: "0.05"
                        backgroundColor: "#004779"
                      children:
                        - type: label
                          text: Availability  Setting
                          style:
                            top: "0"
                            left: "0.02"
                            height: "0.05"
                            textAlign: 
                              y: center
                            fontFamily: Poppins 
                            fontSize: "16"
                            color: "0xFFFFFF"
                            
                    - .BaseList:
                      listObject: ..scheduleSettingsTemp.weekdayTemp
                      style:
                        top: "0.05"
                        width: "0.25"
                        margin: "0"
                      children:
                        - .BaseListItem:
                          style:
                            width: "0.25"
                            height: "0.05"
                            border: 
                              style: "2"
                            borderWidth: "1"
                            borderColor: "#d0d9df"
                          children:
                            # - type: image
                            #   path: 
                            #     emit:
                            #       dataKey:
                            #         var: itemObject
                            #       actions:
                            #         - if:
                            #           - =.builtIn.array.hasKey:
                            #               dataIn:
                            #                 object: =..scheduleSettingsTemp.weekDaySelect
                            #                 key: $var.key
                            #           - MaterialCheck.png
                            #           - MaterialNoCheck.png
                            #   onClick:
                            #     - emit:
                            #         dataKey:
                            #           var: itemObject
                            #         actions: 
                            #           - if:
                            #             - =.builtIn.array.hasKey:
                            #                 dataIn:
                            #                   object: =..scheduleSettingsTemp.weekDaySelect
                            #                   key: $var.key
                            #             - =.builtIn.array.removeByKey:
                            #                 dataIn:
                            #                   object: =..scheduleSettingsTemp.weekDaySelect 
                            #                   key: $var.key
                            #             - =.builtIn.array.copyByKey:
                            #                 dataIn:
                            #                   array1: =..scheduleSettingsTemp.weekdayTemp
                            #                   array2: =..scheduleSettingsTemp.weekDaySelect
                            #                   key: $var.key
                            #           - =.builtIn.array.SortBy:
                            #               dataIn:
                            #                 object: =..scheduleSettingsTemp.weekDaySelect 
                            #                 iterate: "index"
                            #                 orders: "asc"
                            #               dataOut: ScheduleSettingsDisplay.scheduleSettingsTemp.weekDaySelect 
                            #     - actionType: builtIn
                            #       funcName: redraw
                            #       viewTag: AvailableTimeTag
                            #     - actionType: builtIn
                            #       funcName: redraw
                            #       viewTag: timeSlot
                            #   style: 
                            #     top: "0.015"
                            #     left: "0.01"
                            #     height: "0.02"
                            - type: label
                              dataKey: itemObject.key
                              style:
                                top: "0.015"
                                left: "0.025"
                                fontFamily: Poppins 
                                fontSize: "14"
                            - type: select
                              dataKey: AvailableTime.timeStart
                              options:
                                ..scheduleSettingsTemp.TimeSpan
                              style: 
                                top: "0.01"
                                width: "0.05"
                                height: "0.03"
                                fontSize: "15"
                                left: "0.07"
                                boxSizing: border-box
                                borderColor: "#d0d9df" 
                            - type: select
                              dataKey: AvailableTime.timeEnd
                              options:
                                ..scheduleSettingsTemp.TimeSpan
                              style: 
                                top: "0.01"
                                width: "0.05"
                                height: "0.03"
                                left: "0.13"
                                fontSize: "15"
                                boxSizing: border-box
                                borderColor: "#d0d9df"   
                            - type: label
                              text: +
                              onClick:
                                - actionType: evalObject
                                  object: 
                                    .ScheduleSettingsDisplay.WeekData@: ""
                                - emit:
                                    dataKey:
                                      var: itemObject
                                    actions:
                                      - =.builtIn.string.concat:
                                          dataIn:
                                            - $var.AvailableTime.timeStart 
                                            - "-"
                                            - $var.AvailableTime.timeEnd
                                          dataOut: ScheduleSettingsDisplay.AvailableTime.timeResult
                                      - =.builtIn.array.addByIndex:
                                          dataIn:
                                            object: =..newAppointment.edge.name.setting.day
                                            value: =..AvailableTime.timeResult
                                            index: $var.index
                                      - =.builtIn.array.AddWeek:
                                          dataIn:
                                            object: =..addWeek
                                            duration: =.ScheduleSettingsDisplay.AvailableTime.timeResult
                                            Address: ""
                                            index: $var.index
                                            key: $var.key
                                      - =.builtIn.date.TransformWeekDate:
                                          dataIn:
                                            object: =..addWeek
                                          dataOut: ScheduleSettingsDisplay.WeekData
                                      - =.builtIn.array.SortBy:
                                          dataIn:
                                            object: =..addWeek 
                                            iterate: "index"
                                            orders: "asc"
                                          dataOut: ScheduleSettingsDisplay.addWeek
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: timeSlot
                              style: 
                                top: "0"
                                left: "0.22"
                                height: "0.05"
                                fontSize: "2.8vh"
                                color: "0x004779"
                                textAlign: 
                                  y: center
                - type: view
                  # viewTag: AvailableTimeTag
                  style:
                    top: "0.22"
                    left: "0.35"
                    width: "0.25"
                    height: "auto"
                  children:
                    - type: view
                      style:
                        top: "0"
                        left: "0"
                        width: "0.25"
                        height: "0.05"
                        backgroundColor: "#004779"
                      children:
                        - type: label
                          text: Availability
                          style:
                            top: "0"
                            left: "0.02"
                            fontFamily: Poppins 
                            fontSize: "16"
                            height: "0.05"
                            color: "0xFFFFFF"
                            textAlign: 
                              y: center
                    - type: scrollView
                      style:
                        top: "0.05"
                        width: "0.25"
                        height: "0.35"
                        left: "0"
                        overflow: scroll
                      children: 
                        - type: list
                          contentType: listObject
                          listObject: ..addWeek
                          iteratorVar: itemObject
                          viewTag: timeSlot
                          style:
                            top: "0"
                            width: "0.25"
                            height: "auto"
                            left: "0"
                            margin: "0"
                            zIndex: "10000"
                            border:
                              style: "3"
                            borderColor: "#d0d9df"
                            boxSizing: border-box
                          children:
                            - type: listItem
                              itemObject: ""
                              style:
                                height: "0.05"
                                width: "0.25"
                                left: "0"
                                border: 
                                  style: "2"
                                borderWidth: "1"
                                borderColor: "#d0d9df"
                              # viewTag: selectWeek
                              children:
                                - type: label
                                  dataKey: itemObject.key
                                  style:
                                    width: "0"
                                    left: "0.02"
                                    fontSize: "16"
                                    top: "0"
                                    height: "0.05"
                                    textAlign: 
                                      y: center
                                      
                                - type: label
                                  dataKey: itemObject.duration
                                  style:
                                    width: "0.1"
                                    left: "0.1"
                                    fontSize: "16"
                                    top: "0"
                                    height: "0.05"
                                    textAlign: 
                                      y: center
                                - type: image
                                  onClick:
                                    - emit:
                                        dataKey:
                                          var: itemObject
                                        actions:
                                          - =.builtIn.array.removeWeekByIndexs:
                                              dataIn:
                                                object1: =..addWeek
                                                object2: =..newAppointment.edge.name.setting.day
                                                index: $var.index
                                                duration: $var.duration
                                    - actionType: builtIn
                                      funcName: redraw
                                      viewTag: timeSlot
                                  path: delete.png
                                  style:
                                    left: "0.2"
                                    top: "0.015"
                                    height: "0.02"
                - type: view
                  style:
                    top: "0.2"
                    left: "0.6"
                    width: "0.25"
                    height: "0.25"
                    # backgroundColor: "#8dd35f"
                  children:
                    - type: view
                      style:
                        top: "0"
                        left: "0"
                        width: "0.15"
                        height: "0.2"
                        # backgroundColor: "#ffe680"
                      viewTag: selectStartAndEndTag
                      children:
                        - type: label
                          text: Start Date
                          style:
                            top: "0"
                            left: "0.05"
                            width: "0.05"
                            fontSize: "15"  
                        - type: textField
                          placeholder: YYYY-MM-DD
                          dataKey: newAppointment.edge.name.setting.startDate
                          onClick:
                            - actionType: popUp
                              popUpView: startDateTag
                          style:
                            top: "0.03"
                            left: "0.05"
                            width: "0.1"
                            height: "0.03"
                            fontSize: "15"    
                            border: 
                              style: "3"
                            borderWidth: "1"
                            borderRadius: "3"
                        - type: label
                          text: Repeat weeks
                          style:
                            top: "0.09"
                            left: "0.05"
                            width: "0.12"
                            fontSize: "15"  
                        - type: textField
                          # placeholder: YYYY-MM-DD
                          dataKey: newAppointment.edge.name.setting.forwardRepeatWeeks
                          style:
                            top: "0.12"
                            left: "0.05"
                            width: "0.1"
                            height: "0.03"
                            fontSize: "15"    
                            border: 
                              style: "3"
                            borderWidth: "1"
                            borderRadius: "3"
                        - .AddButton:
                          text: Update Availability
                          onClick:
                            - actionType: evalObject
                              object: 
                                - if:  # 判断是什么类型，并根据类型决定预约的edge的bvid
                                  - =.builtIn.string.equal:
                                      dataIn:
                                        string1: =..newAppointment.edge.name.visitType
                                        string2: "Telemedicine"
                                  - .Global.jwt.edge.bvid@: =.Global.currentFacility.id 
                                  - .Global.jwt.edge.bvid@: =.Global.formData.scheduleLocationId
                                - =.Global.jwt.edgeAPI.store: ""
                                - =.ScheduleSettingsDisplay.newAppointment.edgeAPI.store: ""
                                # - .Global.jwt.edge.bvid@: =.Global.currentUser.vertex.id
                                # - =.Global.jwt.edgeAPI.store: ""
                            - actionType: popUp
                              popUpView: setting
                            - goto: SchduleSetting
                          style:
                            top: "0.2"
                            left: "0.05"
                            width: "0.1"
                            height: "0.042"
                            fontSize: "1.6vh"
                            border: 
                              style: "3"
                            borderWidth: "1"
                            borderColor: "#004779"
                            borderRadius: "5"
    - .BaseCheckView:
      viewTag: setting
      message: "setting successfully"
      # style:
      #   width: "0.4"
      #   left: "0.3"
    - type: popUp
      viewTag: startDateTag
      style:
        left: "0.57"
        top: "0.5"
        width: "0.24"
        height: "0.4" 
        zIndex: "1000000"
      children:
        - .BaseDate.calendar:
          children:
            - .BaseDate.calendarHeader:
              children:
                - .BaseDate.monthView:
                - .BaseDate.yearView:
                - .BaseDate.weekView:
            - .BaseDate.dayView:
            - .BaseDate.addButton:
              onClick:
                - actionType: evalObject
                  object:
                    - ..newAppointment.edge.name.setting.startDate@: =.BaseDate.calendarDate.todayDate
                - actionType: builtIn
                  funcName: redraw
                  viewTag: selectStartAndEndTag
                - actionType: popUpDismiss
                  popUpView: startDateTag
