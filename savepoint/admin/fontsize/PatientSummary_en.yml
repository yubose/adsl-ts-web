PatientSummary: 
  # title: "Visit Summary"
  init: 
    # - ..listData.get

    - ..everypatientInfo.edgeAPI.get
    - ..inMeeting.edgeAPI.get: ""
    - actionType: evalObject
      object:
        - =.builtIn.string.concat:
            dataIn:
              - =..docResponse.doc.0.name.data.firstName
              - " "
              - =..docResponse.doc.0.name.data.lastName
            dataOut: PatientSummary.patientName
    - if: 
      - =.builtIn.string.equal:
          dataIn:
            string1: =..inMeeting.edgeResp.edge.0.bvid
            string2: =..inMeeting.edgeResp.edge.0.name.facilityId
      - ..profile.docIn.id@: =..inMeeting.edgeResp.edge.0.evid
      - continue
    - if: 
      - =.builtIn.string.equal:
          dataIn:
            string1: =..inMeeting.edgeResp.edge.0.vvid
            string2: =..inMeeting.edgeResp.edge.0.name.facilityId
      - ..profile.docIn.id@: =..inMeeting.edgeResp.edge.0.bvid
      - continue
    - =..profile.docAPI.get: ""
    - ..dataObject@: =..inMeeting.edgeResp.edge.0
    - actionType: evalObject
      object:
        - =.builtIn.string.concat:
            dataIn:
              - =..dataObject.name.providerName     
              - " 、 "
              - =..dataObject.name.patientName     
            dataOut: PatientSummary.participants
    - actionType: evalObject
      object:
        - =.builtIn.date.getDurationByMinute:
            dataIn:
              stime: =..dataObject.stime
              etime: =..dataObject.etime
            dataOut: PatientSummary.duration
  dataObject: ""
  duration: ""
  participants: ""

  inMeeting:  # 同意预约后，正在开会的40000那条边（subtype为6或者100）
    edgeResp: ""
    edge:
      .Edge: ""
      id: .Global.formData.patientHistoryInfo.id
      xfname: "id"
      obfname: "ctime"
      _nonce: .Global._nonce
      maxcount: "100"
    edgeAPI: 
      get: 
        api: re
        dataIn: inMeeting.edge
        dataOut: PatientSummary.inMeeting.edgeResp

  everypatientInfo: 
    list: ""
      # type: .EdgeType.Accept
    edge:
      type: .EdgeType.Accept
      xfname: bvid
      maxcount: "1"
      id: =.Global.formData.patientHistoryId
      obfname: ctime
      dataKey: everypatientInfo.list
      _nonce: =.Global._nonce
    edgeAPI:
      get:
        api: re
        _nonce: =.Global._nonce
        dataIn: everypatientInfo.edge
        dataOut: everypatientInfo.list
  profile:
    docResponse: ""
    docIn: 
      id: .Global.formData.patientHistoryInfo.id
      xfname: E.id
      type: .DocType.Profile #  type: "257"
      obfname: "mtime"
      ObjType: 12
      sCondition: "E.type=40000"
      maxcount: "1"
      _nonce: =.Global._nonce
    docAPI: 
      get:
        .DocAPI.get: "" 
        api: rd
        dataIn: profile.docIn
        dataOut: PatientSummary.profile.docResponse
  docResponse: 
    doc:
      - type: .DocType.Profile # - type: "257" # private profile
        ovid: .Global.formData.patientHistoryId
        name: 
          data: 
            firstName: ""
            lastName: ""
    error: ""
    jwt: ""  
  avatar:
    url: ava.png
    showdocument: ""
    docRes: ""
    docAPI: 
      get:
        .DocAPI.get: "" 
        api: rd
        id: .Global.formData.patientHistoryId
        xfname: ovid
        type: .DocType.UserAvatar
        dataKey: avatar.docRes
        maxcount: "1"
        obfname: "mtime"
  patientName: ""
  # pagePath: VisitQuestionnaire
  Infor: 
    - img: remotehealth.png
      title: Vital Signs
      bgc: "#f4f8fa"
      pageName: VitalSigns
    - img: visitquestionaire.jpg
      title: Visit Questionnaire
      bgc: "#ffffff"
      pageName: VisitQuestionnaire
    - img: PatientChart.png
      title: Patient Chart
      bgc: "#ffffff"
      pageName: PatientChart
    - img: medical.records.png
      title: Medical Records
      bgc: "#ffffff"
      pageName: MedicalRecords

  components:
    - .SideMenuBar:
      children:
        - .aitLogo:
        - .MenuBar:
    - .TopBar:
    - .BodyView:
      children:
        - type: view
          style: 
            left: "0.05"
            width: "0.73"
            height: "0.2"
            top: "0.05"
            border:   
              style: "5"
            borderRadius: "5"
            boxShadow: "#dededf 0px 0px 10px"
            backgroundColor: "0xffffff"
          children: 
            - type: label
              text: Patient Infomation
              style: 
                left: '0.015'
                top: "0.01"
                width: "0.12"
                height: "0.035"
                fontSize: "2.2vh"
                color: "#517086"
            - type: image
              path: 
                emit:
                  actions:
                    - if:
                      - =..avatar.showdocument.name.data
                      - ..avatar.url
                      - ava.png  
              style: 
                left: "0.02"
                width: "0.075"
                top: "0.05"
            - type: view
              style: 
                left: "0.13"
                width: "0.3"
                height: "0.15"
                top: "0.025"
                # backgroundColor: "0xffffff"
              children: 
                - .PatientHistoryText: 
                  dataKey: profile.docResponse.doc.0.name.data.fullName
                - .PatientHistoryText: 
                  dataKey: profile.docResponse.doc.0.name.data.birth
                  style: 
                    top: "0.0375"
                - .PatientHistoryText: 
                  dataKey: profile.docResponse.doc.0.name.data.phone1
                  style: 
                    top: "0.075"
                - .PatientHistoryText: 
                  dataKey: profile.docResponse.doc.0.name.data.email
                  style: 
                    top: "0.11"
            - type: button
              text: Done
              onClick: 
                - actionType: builtIn
                  funcName: goBack
                  reload: true
                - actionType: evalObject
                  object: 
                    - .Global.formData.patientHistoryInfo@: "1"
                # - actionType: updateObject
                #   dataKey: Global.formData.patientHistoryInfo
                #   dataObject: []

              style: 
                left: "0.62"
                top: "0.05"
                width: "0.09" 
                height: "0.05" 
                backgroundColor: "0x005795"
                color: "0xffffff"
                fontSize: "1.8vh"
                border: 
                  style: '5'
                borderRadius: "5"
        - type: view
          style: 
            left: "0.05"
            width: "0.73"
            height: "0.6"
            top: "0.28"
            border:   
              style: "5"
            borderRadius: "5"
            boxShadow: "#dededf 0px 0px 10px"
            backgroundColor: "0xffffff"
          children: 
            - type: view
              style: 
                left: "0"
                width: "0.38"
                height: "0.6"
                top: "0"
                border:   
                  style: "5"
                borderRadius: "5"
                boxShadow: "#dededf 0px 0px 10px"
                backgroundColor: "0xffffff"
              children:
                - type: label
                  text: Visit Summary
                  style: 
                    left: '0.015'
                    top: "0.02"
                    width: "0.12"
                    height: "0.035"
                    fontSize: "2.1vh"
                    color: "#517086"
                - type: view
                  style: 
                    left: "0.03"
                    width: "0.32"
                    top: "0.07"
                    height: "0.32"
                  children: 
                    - .PatientSummaryTitle: 
                      text: Provider Name
                    - .PatientSummaryText: 
                      dataKey: dataObject.name.providerName
                    - .PatientSummaryTitle: 
                      style: 
                        top: "0.08"
                      text: Participants
                    - .PatientSummaryText: 
                      style: 
                        top: "0.11"
                      dataKey: participants
                    - .PatientSummaryTitle: 
                      style: 
                        top: "0.16"
                      text: Date and Time
                    - .PatientSummaryText: 
                      style: 
                        top: "0.19"
                      text=func: .builtIn.string.formatUnixtime_en
                      dataKey: dataObject.stime    
                    - .PatientSummaryTitle: 
                      style: 
                        top: "0.24"
                      text: Duration
                    - .PatientSummaryText: 
                      style: 
                        top: "0.27"
                      dataKey: duration
                    - type: label
                      text: min
                      style: 
                        left: "0.03"
                        width: "0.02"
                        top: "0.27"
                        height: "0.03"
                        fontSize: "1.65vh"
                        paddingBottom: "2px"
                        textAlign: 
                          x: left
                - type: label
                  text: Shared Information
                  style: 
                    left: '0.015'
                    top: "0.4"
                    width: "0.12"
                    height: "0.035"
                    fontSize: "2.1vh"
                    color: "#517086"
                - type: view
                  style: 
                    left: "0.02"
                    width: "0.34"
                    top: "0.45"
                    height: "0.15"
                  children: 
                    - type: list
                      contentType: listObject
                      listObject: ..Infor
                      iteratorVar: itemObject
                      style:
                        width: '0.34'
                        left: "0"
                        top: "0"
                        height: "0.105"
                        axis: horizontal
                        margin: '0'
                      children:
                        - type: listItem
                          itemObject: ""
                          viewTag: infoView
                          onClick: 
                            - emit: 
                                dataKey: 
                                  var: itemObject
                                actions: 
                                  - if: 
                                    - true
                                    - .Global.formData.patientPage@: $var.pageName
                                    - .Global.formData.patientPage@: $var.pageName
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: pageView
                            - actionType: refresh
                          style:
                            width: '0.072'
                            height: '0.105'
                            marginLeft: "17px"
                            boxShadow: "#dededf 0px 0px 10px"
                            # backgroundColor: itemObject.bgc
                            border: 
                              style: "5"
                            borderRadius: "5"
                          children:
                            - type: image
                              path: 
                                emit:
                                  dataKey:
                                    var: itemObject
                                  actions:
                                    - if:
                                      - true
                                      - $var.img
                                      - $var.img
                              style: 
                                left: "0.022"
                                width: "0.028"
                                top: "0.01"
                            - type: label
                              dataKey: itemObject.title
                              style: 
                                left: "0"
                                width: "0.072"
                                top: "0.07"
                                height: "0.025"
                                fontSize: "1.5vh"
                                textAlign: 
                                  x: center
            - type: scrollView
              viewTag: pageView
              style: 
                left: '0.38'
                width: "0.35"
                top: "0"
                height: "0.6"
                overflow: scroll
                border:   
                  style: "5"
                borderRadius: "5"
              children: 
                - type: page
                  path: =.Global.formData.patientPage
                  style: 
                    left: "0"
                    width: "0.35"
                    height: "0.6"
                    top: "0"
                    border: 
                      style: "1"


