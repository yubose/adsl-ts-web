Inbox:
  title: "Inbox"
  viewPort: top
  pageNumber: "61"
  init:
    - actionType: updateObject 
      dataKey: Inbox.contactList
      dataObject: []
    - =..providerList.docAPI.get: ""
    - =..patientList.docAPI.get: ""
    - if: # 如果patient的list为空，就让显示的联系人列表为provider的list
      - =.builtIn.string.equal:
          dataIn:   
            string1: =..patientList.list
            string2: ""
      - ..contactList@: =..providerList.list.doc
      - continue
    - if: # 如果provider的list为空，就让显示的联系人列表为patient的list
      - =.builtIn.string.equal:
          dataIn:   
            string1: =..providerList.list
            string2: ""
      - ..contactList@: =..patientList.list.doc
      - continue
    - if: # 如果两个array都不为空，就拼接成一个
      - =.builtIn.string.equal:
          dataIn:
            string1: =..patientList.list.doc
            string2: =..providerList.list.doc
      - continue
      - =.builtIn.array.concatArray:
          dataIn:
            array1: =..patientList.list.doc
            array2: =..providerList.list.doc
            sortby: "mtime"
            orders: "desc"
          dataOut: Inbox.contactList
    - actionType: evalObject
      object:
        - =.builtIn.string.concat:
            dataIn:
              - =..emailList.docReq.sCondition
              - " AND D.ovid != from_base64('"
              - =.Global.currentFacility.id
              - "')"
            dataOut: Inbox.emailList.docReq.sCondition
    - ..emailList.docAPI.get
  SelectedInbox: []
  lastTop: "0.0"
  contactList: ""
  inbox: ""
  inboxMessage:
  formData:
    isDoctorProfile: ""
    inboxContact: ""
  emailList:
    docRes: ""
    docReq:
      ObjType: 8
      id: .Global.currentFacility.id
      xfname: E.bvid|E.evid
      sCondition: E.type=10002 AND (D.type & 0xFF00 = 1280)
      # sCondition: E.type=10002 AND D.type = 1283
      maxcount: 200 
      obfname: ctime
      _nonce: =..Global._nonce
    docAPI:
      get:
        api: rd
        dataIn: Inbox.emailList.docReq
        dataOut: Inbox.emailList.docRes
  emailmessage:
    document:
      id: "=.Global.email.id"
      # id: "7QJgWGB8SACX5Qx1YfoH2g=="
      xfname: eid
      type: .DocType.InboxMessage
      maxcount : "10"
      obfname : "mtime"
      _nonce: =.Global._nonce 
    response: ""
    get:
      .DocAPI.get : ""
      api: rd
      dataIn: emailmessage.document
      dataOut: emailmessage.response
  providerList:
    list: ""
    docReq: 
      ObjType: 12
      type: .DocType.DoctorProfile
      id: .Global.currentFacility.id
      xfname: E.bvid|E.evid
      sCondition: E.type=10002 AND E.tage=1
      maxcount: "10000"
      _nonce: =.Global._nonce
    docAPI:
      get: 
        api: rd
        dataIn: providerList.docReq
        dataOut: Inbox.providerList.list
  patientList:
    list: ""
    docReq: 
      ObjType: 8
      type: .DocType.Profile
      id: .Global.currentFacility.id
      xfname: E.bvid|E.evid
      sCondition: "E.type=10002"
      maxcount: "10000"
      _nonce: =.Global._nonce
    docAPI:
      get:
        api: rd
        dataIn: patientList.docReq
        dataOut: Inbox.patientList.list
  newemail:
    docRes: ""
    docReq: 
      type: .DocType.InboxMessage 
      name: 
        title: ""
        data: 
          content: ""
          receiverName: ""
          senderName: .Global.currentFacility.name.basicInfo.medicalFacilityName
      eid: ""
    docAPI:
      store:
        api: cd
        dataIn: Inbox.newemail.docReq
        dataOut: Inbox.newemail.docRes
  newinboxmessage:
    document:
      .Global.inboxMessage: ""
      # # .Document: ""
      eid: ""
      type: .DocType.InboxMessage
      name:
        title: "message"
        type: "application/json"
        data:
          content: ""
    docAPI:
      .DocAPI: ""
      store:
        api: cd
        dataKey: newinboxmessage.document
        subtype:
          mediaType: "application/json"
  relation:
    edgeReq:
      xfname: bvid,evid
      id: []
      type: .EdgeType.Email
    edgeRes: ""
    edgeAPI:
      get:
        api: re 
        dataIn: Inbox.relation.edgeReq
        dataOut: Inbox.relation.edgeRes
  MessageList:
    - key: yellowM.png
      name: "Mellissa West"
      label1: "Appointment Request"
      label2: "Congratulations, You have an appoint..."
      time: "3:35pm"
      link: link.png
      star: emptyStar2.png
    - key: yellowM.png
      name: "Jane Tanner"
      label1: "X-Ray Report"
      label2: "Good evening Dr. Grenz, I have an rtho..."
      time: "2:27pm"
      link: link.png
      star: emptyStar2.png
    - key: yellowM.png
      name: "Dr. Gary Chen"
      label1: "Patient Census for June"
      label2: "I attached the patient census for June..."
      time: "2:20pm"
      link: link.png
      star: emptyStar2.png
    - key: yellowM.png
      name: "Ted"
      label1: "A&C Urgent Care Marketing"
      label2: "Here are some examples of the market..."
      time: "2:12pm"
      link: link.png
      star: emptyStar2.png
  components:
    - .SideMenuBar:
      children:
        - .aitLogo:
        - .MenuBar:
    - .TopBar:
      style:
        boxSizing: "border-box"
        borderWidth: "1"
        borderBottom: "solid 1px  #7070704f"
      children:
        - type: view
          style:
            width: "0.22"
            height: "0.07"
            border: "solid 1px #7070704f"
            boxSizing: "border-box"
          children:
            - type: view
              style: 
                top: "0.015"
                width: "0.2"
                height: "0.04"
                left: "0.03"
                # borderWidth: "1"
                # border:
                #   style: "2"
                #   color: "0x517086"
                # border: "solid 1px #517086"
                # borderColor: "0x517086"
              children:
                - type: image
                  path: "search.png"
                  style:
                    top: "0.01"
                    height: "0.03"
                - type: textField
                  placeholder: "Search..."
                  style:
                    top: "0.013"
                    left: "0.02"
                    width: "0.07"
                    fontSize: "12"
                    color: "0x517086"
                    borderWidth: "0"
            - type: view
              style:
                top: "0.015"
                left: "0.13"
                width: "0.08"
                height: "0.04"
                # backgroundColor: "#b2e3c0"
                borderRadius: "5"
              children:
                # - type: image
                #   path: "IconColor.png"
                #   style:
                #     left: "0.005"
                #     top: "0.0125"
                #     height: "0.015"
                - type: button
                  text: "+ New Message"
                  onClick:
                    - actionType: evalObject
                      object:
                        - ..SelectedInbox@: []
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: SelectedInboxTag
                    - actionType: saveObject
                      object: ..saveEmail
                    - actionType: evalObject
                      object:
                        - ..newemail.edge@: =..newemail.response.edge
                        - actionType: builtIn
                          funcName: show
                          viewTag:  NewMessageTag
                  style:
                    fontSize: "1.5vh"
                    fontFamily: "Poppins"
                    width: "0.08"
                    height: "0.04"
                    left: "0.004"
                    color: "0x003D68"
                    backgroundColor: "0xb1e2bf"
                    border: 
                      style: "3"
                    borderColor: "0xb1e2bf"
                    borderWidth: "1"
                    borderRadius: "5"
                    textAlign: 
                      y : center
                      x: center
    - type: view
      style:
        top: "0.16"
        left: "0.16"
        width: "0.84"
        height: "0.84"
        backgroundColor: '0xF4F8FA'
    - type: view
      style:
        width: '0.84'
        left: '0.16'
        top: "0.07"
        # height: "0.93"
        backgroundColor: '0xF4F8FA'
        display: flex
        flexFlow: "column wrap"
      children:
        - type: view
          style:
            top: "0"
            display: block
            position: static
            width: "0.22"
            height: "0.06"
            boxSizing: 'border-box'
            borderRight: 'solid 1px #7070704f'
            backgroundColor: '0xffffff'
          children:
            - type: label
              text: "All"
              style:
                top: "0.01"
                left: "0.01"
                fontSize: "15"
                height: "0.03"
                width: "0.02"
                fontWeight: "400"
                textDecoration: "underline"
                textAlign:
                  y: center
            - type: label
              text: "Unread"
              style:
                top: "0.01"
                left: "0.05"
                fontSize: "15"
                height: "0.03"
                width: "0.02"
                fontWeight: "400"
                # textDecoration: "underline"
                textAlign:
                  y: center
            - type: label
              text: "Edit"
              style:
                top: "0.01"
                left: "0.19"
                fontSize: "15"
                height: "0.03"
                width: "0.02"
                fontWeight: "400"
                # textDecoration: "underline"
                textAlign:
                  y: center
        # - type: view
        #   style: 
        #     left: "0"
        #     top: "0.06"
        #     width: "0.22"  
        #     height: "0.9"    
        #     backgroundColor: "#ffe680"   
        #   children:
        #     - type: list
        #       listObject: ..folderColor
        #       contentType: listObject
        #       iteratorVar: itemObject
        #       style: 
        #         left: "0"
        #         width: "0.22"
        #         height: "0.8"
        #         top: "0"
        #       children:
        # - type: view
        #   style: 
        #     left: "0"
        #     top: "0"
        #     width: "0.22"
        #     height: "0.72"
            # backgroundColor: "#ff8080"
        - type: scrollView
          style:
            left: "0"
            top: "0.038"
            width: "0.22"
            height: "0.87"
            overflow: scroll
          viewTag: emailList
          children:
            - type: list
              contentType: listObject
              listObject: ..emailList.docRes.doc
              iteratorVar: itemObject
              style: 
                left: "0"
                width: "0.22"
                height: '0.9'
                margin: "0"
                backgroundColor: "0xffffff"
              children:   
                - type: listItem
                  onClick:
                    - actionType: evalObject
                      object: 
                        .Global._nonce@: 
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - ..inboxMessage@: ""
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - =.builtIn.array.appendUnique:
                              dataIn:
                                messages: =..SelectedInbox
                                newMessage: $var
                                uniqueKey: "id"
                          - =.builtIn.array.addColor:
                              dataIn:
                                messages: =..SelectedInbox
                                id: $var.id
                                currentBackgroundColor: "0xffffff"
                                backgroundColor: "0xEFEFEF"
                                fontColor: "0x000000"
                                currentFontColor: "0x000000"
                          - .Global.email@: ""
                          - .Global.email.id@: $var.id
                          - ..inbox@: $var
                          - =..emailmessage.get: ""
                          - if:
                            - =..emailmessage.response.doc.0.id
                            - ..inboxMessage@: =..emailmessage.response.doc.0
                            - continue
                    - actionType: evalObject
                      object:
                        - actionType: builtIn
                          funcName: hide
                          viewTag:  NewMessageTag 
                    - actionType: evalObject
                      object:
                        - actionType: builtIn
                          funcName: hide
                          viewTag:  EmptyInboxTag                      
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: InboxShowTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: SelectedInboxTag
                  itemObject: ""
                  style: 
                    left: "0"
                    # display: block
                    # position: static
                    width: "0.22"
                    height: "0.12"
                    backgroundColor: "0xffffffff"
                    borderWidth: "1"
                    borderRight: "solid 1px  #7070704f"
                    borderBottom: "solid 1px  #7070704f"
                    boxSizing: "border-box"
                    # border:
                    #   style: "2"
                    #   color: "0xdcdcdc" 
                    # backgroundColor: "0x388ECC"
                  children: 
                    - type: label
                      text=func: .builtIn.string.getFirstChar
                      dataKey: itemObject.name.data.senderName
                      style:
                        left: "0.01"
                        top: "0.028"
                        height: "0.05874"
                        width: '0.033'
                        color: '0xffffff'
                        fontSize: "25"
                        fontWeight: '700'
                        backgroundColor: "0xffd25a"
                        border:   
                          style: "3"
                        borderColor: "0xffd25a"
                        borderRadius: "50"
                        textAlign: 
                          x: center
                          y: center
                    - type: image
                      path: longSquare.png
                      style:
                        left: "0"
                        top: "0"
                        height: "0.118"
                    - type: label
                      text: " "
                      dataKey: itemObject.name.data.senderName
                      # dataKey: itemObject.name
                      style:  
                        left: "0.05"
                        top: "0.025"
                        width: "0.08"
                        height: "0.022"
                        fontWeight: "400"
                        fontSize: "1.5vh"
                        color: "#212121"
                        textAlign: 
                          x: left
                    - type: label
                      # text: "Phase 2 Design"
                      dataKey: itemObject.name.title
                      # dataKey: itemObject.label1
                      style:  
                        left: "0.05"
                        top: "0.052"
                        width: "0.12"
                        fontWeight: "400"
                        height: "0.022"
                        fontSize: "12"
                        color: "#212121"
                        textAlign: 
                          x: left
                    - type: label
                      text: "Hey!Had a question about"
                      dataKey: itemObject.name.data.content    #Temporarily invalid Waiting for repair no data
                      style:  
                        left: "0.05"
                        top: "0.075"
                        width: "0.15"
                        height: "0.022"
                        fontWeight: "400"
                        fontSize: "12"
                        color: "#212121"
                        textAlign: 
                          x: left
                        # fontFamily: PMingLiU
                    
                    - type: label
                      # text: 1:30 PM
                      text=func: .builtIn.string.formatUnixtime_en
                      dataKey: itemObject.ctime
                      # dataKey: itemObject.time
                      style: 
                        left: "0.145"
                        top: "0.042"
                        width: "0.04"
                        height: "0.02"
                        fontSize: "10"
                        color: "#666666"
                        textAlign: 
                          x: left
                        fontFamily: PMingLiU
                    - type: image
                      path: link.png
                      # path:
                      #   emit:
                      #     dataKey: 
                      #       var: itemObject
                      #     actions:
                      #       - if:
                      #         - =$var.link
                      #         - $var.link
                      #         - $var.link
                      style:
                        left: "0.13"
                        top: "0.052"
                        height: "0.02"
                    - type: image
                      # path:
                      #   emit:
                      #     dataKey: 
                      #       var: itemObject
                      #     actions:
                      #       - if:
                      #         - =$var.star
                      #         - $var.star
                      #         - $var.star
                      viewTag: select
                      path:
                        emit:
                          dataKey:
                            var: itemObject
                          actions:
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: 40
                                      string2: $var.subtype       
                                - starInbox.png
                                - emptyStar2.png
                      onClick:
                        - emit:
                            dataKey:
                              var: itemObject
                            actions:
                              - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: 40
                                      string2: $var.subtype
                                - =.builtIn.object.set:
                                    dataIn:
                                      object: $var
                                      key: subtype
                                      value: 30
                                - =.builtIn.object.set:
                                    dataIn:
                                      object: $var
                                      key: subtype
                                      value: 40
                        - actionType: updateObject
                          dataKey: InboxDashboard.emailInfo.edge
                          dataObject: itemObject 
                        # - actionType: evalObject
                        #   object:
                        #     - if:
                        #       - ..emailInfo.edge.name.isStar
                        #       - ..emailInfo.edge.subtype@: 40
                        #       - ..emailInfo.edge.subtype@: 20   
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: emailList
                      style:
                        left: "0.19"
                        top: "0.045"
                        height: "0.025"
                        zIndex: "1000"
            
        - type: view
          style:
            top: "0"
            left: "0.22"
            width: "0.579"
            height: "0.04"
            boxSizing: "border-box"
            backgroundColor: "0xF4F8FA"
            color: "0x000000"
          viewTag: SelectedInboxTag
          children:
            - type: list
              contentType: listObject
              listObject: ..SelectedInbox
              # listObject: ..MessageList
              iteratorVar: itemObject
              viewTag: emailList
              style: 
                margin: "0"
                left: "0"
                top: "0"
                width: "0.579"
                height: "0.04"
                backgroundColor: "0xF4F8FA"
                boxSizing: "border-box"
              children:   
                - type: listItem
                  itemObject: ""
                  style: 
                    margin: "0"
                    left: "0"
                    width: "0.08"
                    height: "0.04"
                    display: "inline-block"
                    backgroundColor: "0xffffffff"
                    borderWidth: "1"
                    borderRight: "solid 1px  #7070704f"
                    borderBottom: "solid 1px  #7070704f"
                    boxSizing: "border-box"
                  children:
                    - type: label
                      # text: "2021/1/29 21:42"
                      dataKey: itemObject.name.title
                      onClick:
                        - actionType: evalObject
                          object: 
                            .Global._nonce@: 
                              =.builtIn.math.random: ""
                        - actionType: evalObject
                          object:
                            - ..inboxMessage@: ""
                        - emit:
                            dataKey:
                              var: itemObject
                            actions:
                              - .Global.eamil@: ""
                              - .Global.email.id@: $var.id
                              - ..inbox@: $var
                              - =..emailmessage.get: ""
                              - =.builtIn.array.addColor:
                                  dataIn:
                                    messages: =..SelectedInbox
                                    id: $var.id
                                    currentBackgroundColor: "0xffffff"
                                    backgroundColor: "0xEFEFEF"
                                    fontColor: "0x000000"
                                    currentFontColor: "0x000000"
                              - if:
                                - =..emailmessage.response.doc.0.id
                                - ..inboxMessage@: =..emailmessage.response.doc.0
                                - ..inboxMessage@: ""
              
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: InboxShowTag
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: SelectedInboxTag
                      style:
                        width: '0.08'
                        height: "0.04"
                        paddingLeft: "30px"
                        fontSize: "12"
                        boxSizing: "border-box"
                        top: '0'
                        # backgroundColor: "0xffffff"
                        backgroundColor: itemObject.backgroundColor
                        color: "0x000000"
                        # borderWidth: "1"
                        # border: "solid 1px  #7070704f"
                        borderRadius: "5px"
                        textAlign:
                          y: center
                    - type: image
                      path: close1.png
                      onClick: 
                        - emit:
                            dataKey:
                              var: itemObject
                            actions:
                              - =.builtIn.array.removeById:
                                  dataIn:
                                    object: =..SelectedInbox
                                    id: $var.id
                              - =.builtIn.array.addColor:
                                  dataIn:
                                    messages: =..SelectedInbox
                                    id: =..SelectedInbox.0.id
                                    currentBackgroundColor: "0xffffff"
                                    backgroundColor: "0xEFEFEF"
                                    fontColor: "0x000000"
                                    currentFontColor: "0x000000"
                              # - if:
                              #   - =..SelectedInbox.0.id
                              #   - .Global.email.id@: =..SelectedInbox.0.id
                              #   - ..emailmessage@: ""
                              # - if:
                              #   - =..SelectedInbox.0.id
                              #   - ..inbox@: =..SelectedInbox.0
                              #   - ..inbox@: ""
                              # - if:
                              #   - =..SelectedInbox.0.id
                              #   - =..emailmessage.get: ""
                              #   - ..inboxMessage@: ""
                              # - if:
                              #   - =..emailmessage.response.doc.0.id
                              #   - ..inboxMessage@: =..emailmessage.response.doc.0
                              #   - continue
                        - actionType: evalObject
                          object: 
                            - if:
                              - =..SelectedInbox.0.id
                              - actionType: evalObject
                                object:
                                  - .Global.email.id@: =..SelectedInbox.0.id
                                  - ..inbox@: =..SelectedInbox.0
                                  - =..emailmessage.get: ""
                              - actionType: evalObject
                                object:
                                  - ..inboxMessage@: ""
                                  - ..inbox@: ""
                                  - ..emailmessage@: ""
                                  - actionType: builtIn
                                    funcName: show
                                    viewTag:  EmptyInboxTag  
                            - if:
                                - =..emailmessage.response.doc.0.id
                                - ..inboxMessage@: =..emailmessage.response.doc.0
                                - continue  
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: InboxShowTag
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: SelectedInboxTag
                      style:
                        top: "0.01"
                        height: "0.02"
                        marginLeft: "0.2"

        - type: view
          viewTag: EmptyInboxTag
          style:
            left: "0.22"
            top: "0"
            width: "0.58"
            display: flex
            flexFlow: "column wrap"
            backgroundColor: "0xF4F8FA"
            boxSizing: "border-box"
            borderTop: "solid 1px #7070704f"
            borderRight: "solid 1px #7070704f"
            height: "0.87"
            zIndex: 10
            isHidden: "false"
        - type: view
          viewTag: NewMessageTag
          style:
            left: "0.22"
            top: "0"
            width: "0.58"
            display: flex
            flexFlow: "column wrap"
            backgroundColor: "0xffffff"
            boxSizing: "border-box"
            borderTop: "solid 1px #7070704f"
            borderRight: "solid 1px #7070704f"
            height: "0.87"
            zIndex: 10
            isHidden: "true"
          children:
            - type: view
              style:
                top: "0.015"
                width: "0.15"
                height: "0.045"
                left: "0.45"
              children:
                - type: image
                  path: pin.png
                  onClick: 
                    - goto: AddDocument
                  style:
                    top: "0.01"
                    height: "0.04"
                - type: image
                  path: redExclamation.png
                  style:
                    top: "0.01"
                    left: "0.03"
                    height: "0.04"
                - type: image
                  path: discard.png
                  style:
                    top: "0.01"
                    left: "0.06"
                    height: "0.04"
            - type: image
              path: send.png
              style:
                top: "0.09"
                left: "0.025"
                width: "0.05"
            - type: label
              text: "To:"
              style:
                top: "0.09"
                left: "0.08"
                width: "0.03"
                height: "0.03"
                fontSize: "14"
                fontWeight: "400"
            - type: textField
              placeholder: 'e.g jane@adobe.com'
              dataKey: newemail.docReq.name.data.receiverName
              style:
                top: "0.09"
                left: "0.13"
                width: "0.36"
                height: "0.03"
                borderWidth: "1"
                borderColor: "0xEAEAEA"
            - type: label
              text: "+ Contact"
              onClick:
                - actionType: popUp
                  popUpView: Contacts
              style:
                top: "0.09"
                left: "0.5"
                width: "0.06"
                height: "0.03"
                borderWidth: "0"
                backgroundColor: "0xffffff"
                color: "0x008BEC"

            - type: label
              text: "Subject:"
              style:
                top: "0.17"
                left: "0.08"
                width: "0.03"
                height: "0.03"
                fontSize: "14"
                fontWeight: "400"
            - type: textField
              placeholder: 'Enter Subject'
              dataKey: newemail.docReq.name.title
              style:
                top: "0.17"
                left: "0.13"
                width: "0.425"
                height: "0.03"
                borderWidth: "1"
                borderColor: "0xEAEAEA"
            - type: label
              text: "Message"
              style:
                top: "0.23"
                left: "0.025"
                width: "0.05"
                fontWeight: "500"
            - type: textView
              placeholder: ""
              dataKey: newemail.docReq.name.data.content
              style:
                top: "0.27"
                left: "0.025"
                width: "0.53"
                height: "0.55"
                borderWidth: "1"
                borderColor: "0xEAEAEA"
            - .BigButton:
              text: "Send"
              onClick:
                - actionType: evalObject
                  object:
                    - if:
                      - =.builtIn.string.equal:
                          dataIn:
                            string1: =..formData.inboxContact.type
                            string2: .DocType.Profile
                      - ..newemail.docReq.eid@: =..formData.inboxContact.eid
                      - actionType: evalObject
                        object:
                          - =.builtIn.array.add:
                              dataIn:
                                object: =..relation.edgeReq.id
                                value: =.Global.currentFacility.id
                          - =.builtIn.array.add:
                              dataIn:
                                object: =..relation.edgeReq.id
                                value: =..formData.inboxContact.bsig
                          - =..relation.edgeAPI.get: ""
                          - if:
                            - =..relation.edgeRes.edge.0
                            - continue
                            - actionType: evalObject
                              object:
                                - ..relation.edgeReq.xfname@: "evid,bvid"
                                - =..relation.edgeAPI.get: "" 
                          - ..newemail.docReq.eid@: =..relation.edgeRes.edge.0.id    
                          - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
                          - =.Global.jwt.edgeAPI.store: ""   
                          - =..newemail.docAPI.store: ""
                - actionType: builtIn
                  funcName: redraw
                  viewTag: SelectedInboxTag
                - actionType: evalObject
                  object:
                    - actionType: builtIn
                      funcName: hide
                      viewTag:  NewMessageTag
                - actionType: evalObject
                  object:
                    - actionType: builtIn
                      funcName: show
                      viewTag:  EmptyInboxTag
                - actionType: builtIn
                  funcName: redraw
                  viewTag: emailList
              style:
                top: "0.84"
                width: "0.08"
                height: "0.04"
                left: "0.05"
                borderRadius: "2"
                backgroundColor: "0x003254"
                color: "0xffffff"
            - .BigButton:
              text: "Save to Draft"
              onClick:
                - actionType: evalObject
                  object:
                    - ..newinboxmessage.document.eid@: =..newemail.response.edge.id
                - actionType: saveObject
                  object: ..saveEmail
                - actionType: saveObject
                  object: ..saveInbox
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""
                - actionType: evalObject
                  object:
                    - ..emailList.email.edge@: []
                    - ..emailList.emailInfo.sCondition@: "subtype=10"
                    - ..emailList.emailInfo.xfname@: "bvid"
                    - =..emailList.get: ""
                    - ..SelectedInbox@: []
                - actionType: builtIn
                  funcName: redraw
                  viewTag: SelectedInboxTag
                - actionType: evalObject
                  object:
                    - actionType: builtIn
                      funcName: hide
                      viewTag:  NewMessageTag
                - actionType: evalObject
                  object:
                    - actionType: builtIn
                      funcName: show
                      viewTag:  EmptyInboxTag
                - actionType: builtIn
                  funcName: redraw
                  viewTag: emailList

              style:
                top: "0.84"
                width: "0.08"
                height: "0.04"
                left: "0.455"
                borderRadius: "2"
                backgroundColor: "0x003254"
                color: "0xffffff"
        - type: view
          style:
            left: "0.22"
            top: "0.04"
            width: "0.58"
            display: flex
            flexFlow: "column wrap"
            backgroundColor: "0xffffff"
            boxSizing: "border-box"
            borderTop: "solid 1px #7070704f"
            borderRight: "solid 1px #7070704f"
            height: "0.87"
          viewTag: InboxShowTag
          children:
            - type: view
              style:
                # top: "0.175"
                width: "0.58"
                height: "0.16"
                display: "block"
                boxShadow: "0px 15px 10px -15px #0000002f"
              children:
                - type: button
                  text=func: .builtIn.string.getFirstChar
                  dataKey: inbox.name.data.senderName
                  style:
                    top: "0.05"
                    left: "0.015"
                    height: "0.06"
                    border: none
                    width: "0.0337"
                    color: "0xffffff"
                    backgroundColor: "0xffd25a"
                - type: label
                  text: "From:"
                  style:
                    left: "0.07"
                    top: "0.025"
                    height: "0.035"
                    fontSize: "15"
                    textAlign:
                      x: left
                - type: label
                  # text: Blair Zhang
                  dataKey: inbox.name.data.senderName
                  style:
                    fontSize: "15"
                    fontWeight: "450"
                    height: "0.035"
                    color: "0x707070"
                    left: "0.11"
                    top: "0.025"
                    textAlign:
                      x: left
                - type: label
                  text: "To:"
                  style:
                    left: "0.07"
                    top: "0.055"
                    height: "0.035"
                    fontSize: "15"
                    textAlign:
                      x: left
                - type: label
                  # text: Christopher Grenz
                  dataKey: inbox.name.data.receiverName
                  style:
                    fontSize: "15"
                    fontWeight: "450"
                    height: "0.035"
                    color: "0x707070"
                    left: "0.11"
                    top: "0.055"
                    textAlign:
                      x: left
                - type: label
                  text: Anaheim Marketing Plan
                  dataKey: inbox.name.title
                  style:
                    fontSize: "15"
                    fontWeight: "500"
                    # color: "0x707070"
                    left: "0.07"
                    top: "0.09"
                - type: view
                  style:
                    left: "0.07"
                    top: "0.12"
                    width: "0.2"
                    # display: flex
                    # flexFlow: "row wrap"
                    height: "0.04"
                    borderRadius: "2"
                    # backgroundColor: "0xEBEBEB"
                  children:
                    - type: list
                      contentType: listObject
                      listObject: ..attachmentList.doc
                      iteratorVar: itemObject
                      style:
                        top: "0"
                        width: "0.2"
                        height: "0.04"
                        left: "0"
                        # display: block
                        # position: static
                        marginTop: "0"
                      children: 
                        - type: listItem
                          itemObject: ""
                          onClick:
                            - actionType: updateObject 
                              dataKey: Global.DocReference.document
                              dataObject: itemObject 
                            - goto:  ViewMedicalRecord
                          style: 
                            left: "0"
                            width: "0.2"
                            height: "0.04"
                            # display: block
                            # position: static
                            border: 
                              style: "2"
                            borderColor: "0xffffff"
                            borderWidth: "0.001px"
                          children: 
                            - type: image
                              path: pin.png
                              style:
                                left: "0"
                                height: "0.02"
                                top: "0.01"
                            - type: label
                              # text: Anaheim Urgent Care List for
                              dataKey: itemObject.name.title
                              style:
                                fontSize: "12"
                                fontWeight: 200
                                left: "0.08"
                                width: "0.4"
                                height: "0.04"
                                color: "0x4A91C4"
                                textAlign:
                                  y: center
                
                - type: view
                  style:
                    top: "0.02"
                    left: "0.3"
                    width: "0.06"
                    height: "0.08"
                    # backgroundColor: "0x707070"
                    # boxShadow: "1px 1px 2px #000"
                  children:
                    - type: image
                      path: addfolder.png
                      style:
                        left: "0.02"
                        top: "0.01"
                        height: "0.03"
                      onClick:
                        - actionType: popUp
                          popUpView: testView   
                    - type: popUp           
                      viewTag: testView  
                      style:
                        left: "-0.02"     
                        top: "0.09"
                        width: "0.12"
                        height: "0.049" 
                        backgroundColor: "white" 
                        border:
                          style: "3"       
                        borderColor: "#eff0f0" 
                        boxShadow: "0px 0px 1px 0px grey" 
                      children:  
                        - type: select
                          style: 
                            top: "0"
                            left: "0"
                            height: "0.05"
                            width: "0.121"
                            fontSize: "5"
                            borderColor: "#eff0f0" 
                            boxShadow: "0px 0px 1px 0px grey" 
                          options:  
                            - Select Folder
                            - Business Team
                            - Engineers
                          children: 
                            - type: image
                              path: approve2.png
                              style: 
                                top: ""
                                width: "0.001"
                                left: "0.1"  
                    - type: label
                      text: "Add to Folder"
                      style:
                        color: "0x517086"
                        top: "0.06"
                        fontFamily: "Poppins"
                        fontSize: "8"
                        fontWeight: "400"
                        width: "0.06"
                        textAlign:
                          x: center
                - type: view
                  style:
                    top: "0.02"
                    left: "0.36"
                    width: "0.06"
                    height: "0.08"
                    # backgroundColor: "0x707070"
                    # boxShadow: "1px 1px 2px #000"
                  onClick:
                    - actionType: evalObject
                      object:
                        - ..SelectedInbox@: []
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: SelectedInboxTag
                    - actionType: evalObject
                      object:
                        - ..newemail.edge.evid@: =..inbox.evid
                        - ..newemail.edge.name.receiveName@: =..inbox.name.receiveName
                    - actionType: saveObject
                      object: ..saveEmail
                    - actionType: evalObject
                      object:
                        - ..newemail.edge@: =..newemail.response.edge
                    - actionType: builtIn
                      funcName: redraw
                      viewTag:  NewMessageTag
                    - actionType: builtIn
                      funcName: show
                      viewTag:  NewMessageTag
                  children:
                    - type: image
                      path: reply.png
                      style:
                        left: "0.02"
                        top: "0.01"
                        height: "0.03"
                    - type: label
                      text: "Reply"
                      style:
                        color: "0x517086"
                        top: "0.06"
                        fontFamily: "Poppins"
                        fontSize: "8"
                        fontWeight: "400"
                        width: "0.06"
                        textAlign:
                          x: center
                - type: view
                  style:
                    top: "0.02"
                    left: "0.42"
                    width: "0.06"
                    height: "0.08"
                    # backgroundColor: "0x707070"
                    # boxShadow: "1px 1px 2px #000"
                  children:
                    - type: image
                      path: replyall.png
                      style:
                        left: "0.02"
                        top: "0.01"
                        height: "0.03"
                    - type: label
                      text: "Reply All"
                      style:
                        color: "0x517086"
                        top: "0.06"
                        fontFamily: "Poppins"
                        fontSize: "8"
                        fontWeight: "400"
                        width: "0.06"
                        textAlign:
                          x: center
                - type: view
                  style:
                    top: "0.02"
                    left: "0.48"
                    width: "0.06"
                    height: "0.08"
                    # backgroundColor: "0x707070"
                    # boxShadow: "1px 1px 2px #000"
                  children:
                    - type: image
                      path: forward.png
                      style:
                        left: "0.02"
                        top: "0.01"
                        height: "0.03"
                    - type: label
                      text: "Forward"
                      style:
                        color: "0x517086"
                        top: "0.06"
                        fontFamily: "Poppins"
                        fontSize: "8"
                        fontWeight: "400"
                        width: "0.06"
                        textAlign:
                          x: center
                - type: label
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: inbox.ctime
                  # text: "May 5, 2020 at 10:30 AM"
                  style:
                    top: "0.12"
                    height: "0.02"
                    textAlign:
                      y: center
                    left: "0.45"
                    fontSize: "10"
                    color: "0x707070"
                - type: label
                  text: Details
                  style:
                    top: "0.095"
                    height: "0.02"
                    left: "0.21"
                    fontSize: "12"
                    color: "0x4A91C4"
                    textAlign:
                      y: center

            - type: view
              style:
                top: "0.17"
                # left: "0.02"
                width: "0.58"
                height: "0.4"
                # backgroundColor: "0xcdcdcd"
              children:
                - type: label
                  dataKey: inbox.name.data.content
                  # text: " Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum porttitor iaculis velit, sit amet interdum risus lacinia at. Praesent porta ac lorem gravida commodo. Aliquam dictum volutpat justo, sit amet interdum leo elementum eu. Aenean varius dolor at pellentesque sagittis. Cras consectetur leo nec libero ultricies malesuada. Suspendisse sem nisi, sagittis a placerat sit amet, imperdiet id tellus. Praesent fermentum volutpat neque. Nulla elit arcu, tincidunt pellentesque varius ut, vehicula ut augue. Fusce dignissim libero felis, ac scelerisque metus pellentesque eu. Suspendisse aliquet orci non mauris interdum vulputate."
                  style:
                    width: "0.54"
                    left: "0.02"
                    fontSize: "16"
                    fontFamily: "Poppins"
                    height: "0.42"
                    color: "0x2C2731"
                    fontWeight: 300
                    isEditable: "false"
                    border: 
                      style: '1'
        
        - type: view
          onClick:
            - actionType: evalObject
              object:
                .Global._nonce@:
                  =.builtIn.math.random: ""
            - actionType: evalObject
              object:
                - ..emailList.email.edge@: []
                - ..emailList.emailInfo.sCondition@: "subtype=40"
                - =..emailList.get: ""
                - ..SelectedInbox@: []
            - actionType: builtIn
              funcName: redraw
              viewTag: SelectedInboxTag
            - actionType: evalObject
              object:
                - actionType: builtIn
                  funcName: hide
                  viewTag:  NewMessageTag
            - actionType: evalObject
              object:
                - actionType: builtIn
                  funcName: show
                  viewTag:  EmptyInboxTag
            - actionType: builtIn
              funcName: redraw
              viewTag: emailList
          style:
            top: "0"
            left: "0.8"
            width: "0.04"
            height: "0.1"
            backgroundColor: "0xffffff"
            boxShadow: "1px 1px 2px #000"
          children:
            - type: image
              path: "star.png"
              style:
                top: "0.015"
                height: "0.03"
                left: "0.0125"
            - type: label
              text: "Starred"
              style:
                top: "0.05"
                width: "0.04"
                fontSize: "10"
                color: "0x707070"
                fontFamily: "Poppins"
                textAlign:
                  x: center
        - type: view
          style:
            top: "0.1"
            left: "0.8"
            width: "0.04"
            height: "0.1"
            backgroundColor: "0xffffff"
            boxShadow: "1px 1px 2px #000"
          onClick:
            - actionType: evalObject
              object:
                .Global._nonce@:
                  =.builtIn.math.random: ""
            - actionType: evalObject
              object:
                - ..emailList.email.edge@: []
                - ..emailList.emailInfo.xfname@: "bvid"
                - ..emailList.emailInfo.sCondition@: "subtype=10"
                - =..emailList.get: ""
                - ..SelectedInbox@: []
            - actionType: builtIn
              funcName: redraw
              viewTag: SelectedInboxTag
            - actionType: evalObject
              object:
                - actionType: builtIn
                  funcName: hide
                  viewTag:  NewMessageTag
            - actionType: evalObject
              object:
                - actionType: builtIn
                  funcName: show
                  viewTag:  EmptyInboxTag
            - actionType: builtIn
              funcName: redraw
              viewTag: emailList
          children:
            - type: image
              path: "drafts1.png"
              style:
                top: "0.015"
                height: "0.03"
                left: "0.0125"
            - type: label
              text: "Drafts"
              style:
                top: "0.05"
                width: "0.04"
                fontSize: "10"
                color: "0x707070"
                fontFamily: "Poppins"
                textAlign:
                  x: center
        - type: view
          style:
            top: "0.2"
            left: "0.8"
            width: "0.04"
            height: "0.1"
            backgroundColor: "0xffffff"
            boxShadow: "1px 1px 2px #000"
          onClick:
            - actionType: evalObject
              object:
                - =.builtIn.string.concat:
                    dataIn:
                      - "E.type=10002 AND (D.type & 0xFF00 = 1280) AND D.ovid = from_base64('"
                      - =.Global.currentFacility.id
                      - "')"
                    dataOut: Inbox.emailList.docReq.sCondition      
            - actionType: evalObject
              object:
                .Global._nonce@:
                  =.builtIn.math.random: ""
            - actionType: evalObject
              object:
                - =..emailList.docAPI.get: ""
                - ..SelectedInbox@: []
            - actionType: builtIn
              funcName: redraw
              viewTag: SelectedInboxTag
            - actionType: evalObject
              object:
                - actionType: builtIn
                  funcName: hide
                  viewTag:  NewMessageTag
            - actionType: evalObject
              object:
                - actionType: builtIn
                  funcName: show
                  viewTag:  EmptyInboxTag
            - actionType: builtIn
              funcName: redraw
              viewTag: emailList
          children:
            - type: image
              path: "sent1.png"
              style:
                top: "0.015"
                height: "0.03"
                left: "0.0125"
            - type: label
              text: "Sent"
              style:
                top: "0.05"
                width: "0.04"
                fontSize: "10"
                color: "0x707070"
                fontFamily: "Poppins"
                textAlign:
                  x: center
        - type: view
          style:
            top: "0.3"
            left: "0.8"
            width: "0.04"
            height: "0.1"
            backgroundColor: "0xffffff"
            boxShadow: "1px 1px 2px #000"
          onClick:
            - actionType: evalObject
              object:
                .Global._nonce@:
                  =.builtIn.math.random: ""
            - actionType: evalObject
              object:
                - ..emailList.email.edge@: []
                - ..emailList.emailInfo.xfname@: "bvid"
                - ..emailList.emailInfo.sCondition@: "subtype=60"
                - =..emailList.get: ""
                - ..SelectedInbox@: []
            - actionType: builtIn
              funcName: redraw
              viewTag: SelectedInboxTag
            - actionType: evalObject
              object:
                - actionType: builtIn
                  funcName: hide
                  viewTag:  NewMessageTag
            - actionType: evalObject
              object:
                - actionType: builtIn
                  funcName: show
                  viewTag:  EmptyInboxTag
            - actionType: builtIn
              funcName: redraw
              viewTag: emailList
          children:
            - type: image
              path: "trash1.png"
              style:
                top: "0.015"
                height: "0.03"
                left: "0.0125"
            - type: label
              text: "Trash"
              style:
                top: "0.05"
                width: "0.04"
                fontSize: "14"
                color: "0x707070"
                fontFamily: "Poppins"
                textAlign:
                  x: center
        - type: view
          style:
            top: "0.4"
            left: "0.8"
            width: "0.04"
            height: "0.1"
            backgroundColor: "0xffffff"
            boxShadow: "1px 1px 2px #000"
          children:
            - type: image
              path: "folder1.png"
              style:
                top: "0.015"
                height: "0.03"
                left: "0.0125"
            - type: label
              text: "Virtual Folder"
              style:
                top: "0.05"
                width: "0.04"
                fontSize: "10"
                color: "0x707070"
                fontFamily: "Poppins"
                textAlign:
                  x: center
    - .BasePopUp:
      viewTag: Contacts
      style:
        zIndex: "20"
      children:
        - .PopUphead:
          style:
            left: "0.6"
          children:
            - .CreateLabel:
              text: 'Invite'
            - .Closebutton:
              onClick:
                - actionType: popUpDismiss
                  popUpView: Contacts     
        - type: view
          style:
            height: '0.91'
            width: '0.4'
            left: "0.6"
            top: '0.08'
            backgroundColor: '0xffffff'
          children:
            - type: view
              text: 'Contacts'
              style: 
                left: '0.015'
                marginTop: "0.02"
                fontWeight: '500'
                fontFamily: sans-serif
                fontSize: '26'
            - .BaseList:
              listObject: ..providerList.list.doc
              style:
                width: '0.4'
                height: 'auto'  
                margin: "0"
                marginTop: '0.01'   
                left: '0'
                # backgroundColor: 'red'
                # borderBottom: '1px solid #f3f3f3'
              children:
                - .BaseListItem:
                  style:
                    height: '0.05'
                    width: '0.4'
                    border: 
                      style: "2"
                    borderWidth: "1"
                    borderColor: "0xe9e9e9"
                    borderRadius: ""
                    display: inline-block
                  onClick:
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - ..formData.inboxContact@: $var
                          - ..newemail.docReq.name.data.receiverName@: $var.name.data.fullName
                          - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: $var.type
                                  string2: 35841
                            - ..formData.isDoctorProfile@: true
                            - ..formData.isDoctorProfile@: false
                    - actionType: evalObject
                      object:
                        - if:
                          - =..formData.isDoctorProfile
                          - actionType: evalObject
                            object:
                              - =.builtIn.array.add:
                                  dataIn:
                                    object: =..relation.edgeReq.id
                                    value: =.Global.currentFacility.id
                              - =.builtIn.array.add:
                                  dataIn:
                                    object: =..relation.edgeReq.id
                                    value: =..formData.inboxContact.bsig   
                              - =..relation.edgeAPI.get: ""
                              - if:
                                - =..relation.edgeRes.edge.0
                                - continue
                                - actionType: evalObject
                                  object:
                                    - ..relation.edgeReq.xfname@: "evid,bvid"
                                    - =..relation.edgeAPI.get: "" 
                          - continue
                        - ..newemail.docReq.eid@: =..relation.edgeRes.edge.0.id   
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: NewMessageTag
                    - actionType: builtIn
                      funcName: show
                      viewTag:  NewMessageTag 
                    - actionType: popUpDismiss
                      popUpView: Contacts
                  children:
                    - .Label1:
                      dataKey: itemObject.name.data.fullName
                      style: 
                        top: "0"
                        height: '0.05'
                        textAlign:
                          y: center
                        left: '0.06'
                        fontSize: '14'
                    - .Label1:
                      dataKey: itemObject.name.data.phone
                      style:  
                        top: "0"
                        height: '0.05'
                        textAlign:
                          y: center
                        left: '0.26'
                        fontSize: '14' 
            - .BaseList:
              listObject: ..patientList.list.doc
              style:
                width: '0.4'
                height: 'auto'  
                # top: '0.06'  
                marginTop: "0" 
                left: '0'
                display: flex
                margin: "0"
                # backgroundColor: 'red'
                #borderBottom: '1px solid #f3f3f3'
              children:
                - .BaseListItem:
                  style:
                    height: '0.05'
                    width: '0.4'
                    border: 
                      style: "2"
                    borderWidth: "1"
                    borderColor: "0xe9e9e9"
                    borderRadius: ""
                
                    display: inline-block
                  onClick:
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - ..formData.inboxContact@: $var
                          - ..newemail.docReq.name.data.receiverName@: $var.name.data.fullName
                          - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: $var.type
                                  string2: 35841
                            - ..formData.isDoctorProfile@: true
                            - ..formData.isDoctorProfile@: false
                    - actionType: evalObject
                      object:
                        - if:
                          - =..formData.isDoctorProfile
                          - actionType: evalObject
                            object:
                              - =.builtIn.array.add:
                                  dataIn:
                                    object: =..relation.edgeReq.id
                                    value: =.Global.currentFacility.id
                              - =.builtIn.array.add:
                                  dataIn:
                                    object: =..relation.edgeReq.id
                                    value: =..formData.inboxContact.bsig   
                              - =..relation.edgeAPI.get: ""
                              - if:
                                - =..relation.edgeRes.edge.0
                                - continue
                                - actionType: evalObject
                                  object:
                                    - ..relation.edgeReq.xfname@: "evid,bvid"
                                    - =..relation.edgeAPI.get: "" 
                          - continue
                        - ..newemail.docReq.eid@: =..relation.edgeRes.edge.0.id   
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: NewMessageTag
                    - actionType: builtIn
                      funcName: show
                      viewTag:  NewMessageTag 
                    - actionType: popUpDismiss
                      popUpView: Contacts
                  children:
                    - .Label1:
                      dataKey: itemObject.name.data.fullName
                      style: 
                        top: "0"
                        height: '0.05'
                        textAlign:
                          y: center
                        left: '0.06'
                        fontSize: '14'
                    - .Label1:
                      dataKey: itemObject.name.data.phone1
                      style:  
                        top: "0"
                        height: '0.05'
                        textAlign:
                          y: center
                        left: '0.26'
                        fontSize: '14' 