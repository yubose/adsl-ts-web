UploadDocuments:
  pageNumber: "415"
  title: "My Directory"
  init:
    - .SignInCheck
    - ..listData.get 
  listData:
    personalDoc:
      doc:
        isSelected: false
    get:
      .DocAPI.get : ""
      api: rd
      dataKey: listData.personalDoc
      ObjType: 4
      ids: 
        - .Global.rootNotebookID
      type: .DocType.UploadFile
      xfname: eid
      obfname : "mtime" 
      maxcount : "20"
      _nonce: =.Global._nonce
  sharedDoc: ""
  selectedDoc: 
    isSelected: false
  generalInfo:
    value: true      
  components: 
    - .BaseCheckView: ""
      message: "Uploading in progress ..."
      viewTag: uploading
    - .BaseHeader3:
    - .HeaderLeftButton:
    # - .HeaderRightImg:
    #         path: sideNav2.png
    #         onClick:
    #           - goto: SideMenuBar
    - type: view
      style:
        top: "0.1"
        left: "0.05"
        width: "0.9"
        height: "0.08"
      children:
        - .SearchField:
          placeholder: "  Search Documents"
          style:
            left: "0.2"
            top: "0.025"
        - .SearchDoc: 
          style:
            top: "0.025"
        - type: image
          path: add.png
          onClick:
            - goto: AddDocuments
          style:
            top: "0.03"
            left: "0.85"
            height: "0.02"
    - type: view
      style:
        top: "0.17"
      children:
        - type: list
          contentType: listObject
          listObject: ..listData.personalDoc.doc
          iteratorVar: itemObject
          style:
            color: "0x000000"
            backgroundColor: "0xFFFFFF"
            left: "0.05"
            top: "0"
            width: "0.9"
            height: "0.7"
          children:
          - type: listItem
            itemObject: ""
            viewTag: select
            style:
              color: "0x000000"
              backgroundColor: "0xFFFFFF"
              left: "0"
              top: "0"
              width: "1"
              height: "0.07"
              border:
                style: "2"
              borderWidth: "1"
              borderColor: "0x00000011"
              textAlign:
                x: left
                y: center
            children:
              - type: image
                path:
                  emit:
                    dataKey:
                        var: itemObject
                    actions:                        
                      - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..generalInfo.value
                              string2: $var.isSelected
                        - https://public.aitmed.com/commonRes/selectOn.png
                        - https://public.aitmed.com/commonRes/selectOff.png
                onClick:
                  - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                    dataKey: UploadDocuments.selectedDoc
                    dataObject: itemObject 
                  - emit:
                      dataKey:
                        var: itemObject
                      actions:
                        - if:
                          - =.builtIn.string.equal:
                              dataIn:
                                string1: =..generalInfo.value
                                string2: $var.isSelected
                          - =.builtIn.object.clear:
                              dataIn:
                                object: $var
                                key: isSelected
                          - =.builtIn.object.set:
                              dataIn:
                                object: $var
                                key: isSelected
                                value: true
                        # - if:
                        #     - =.UploadDocuments.selectedDoc.isSelected
                        #     - .UploadDocuments.selectedDoc.isSelected@: false
                        #     - .UploadDocuments.selectedDoc.isSelected@: true
                  - actionType: builtIn
                    funcName: redraw
                    viewTag: select

                style:
                  top: "0.02"
                  left: "0.01"
                  height: "0.03"
              - type: label
                text: Urgent Care Evaluation Report
                dataKey: itemObject.name.title
                onClick:
                  - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                    dataKey: Global.DocReference.document
                    dataObject: itemObject # this must be a rootRoom
                  - goto: DocumentDetail
                style:
                  left: "0.1"
                  top: "0.02"
                  width: "0.7"
                  height: "0.02"
                  fontSize: "13"
                  fontWeight: "500" 
                  textAlign:
                    y: center
              - type: label
                text: 10.30am
                text=func: .builtIn.string.formatUnixtime_en
                dataKey: itemObject.ctime # Mon Day, Year hh:mm:ss
                style:
                  color: "0x808080"
                  left: "0.7"
                  top: "0.01"
                  width: "0.2"
                  height: "0.02"
                  fontSize: "12"
                textAlign:
                  y: center
              # - type: label
              #   text: July 4,2020
              #   text=func:  .builtIn.string.formatDurationInSecond
              #   dataKey: itemObject.tage # hh:mm'ss"
              #   style:
              #     color: "0x808080"
              #     left: "0.05"
              #     top: "0.04"
              #     width: "0.6"
              #     height: "0.02"
              #     fontSize: "12"
              #     textAlign:
              #       y: center
    - type: button
      onClick:
        - actionType: popUp
          popUpView: uploading  
        - actionType: evalObject     # to download the selected document and using target edge id 
          object:                    # to encrypt new document with the same content
            =.builtIn.ecos.shareDoc: 
              dataIn:                
                sourceDoc: =.UploadDocuments.selectedDoc
                targetEdgeID: =.Global.rootRoomInfo.edge.id
              dataOut: =.UploadDocuments.sharedDoc
        # - actionType: evalObject    
        #   object:     
        #     - ..shareDocuments.document@: =.UploadDocuments.selectedDoc
        #     # - ..shareDocuments.document.id@: "" 
        #     - ..shareDocuments.document.eid@: =.Global.rootRoomInfo.edge.id    
        # - actionType: evalObject    
        #   object: ..save 
        - actionType: evalObject
          object: 
            .Global._nonce@: 
              =.builtIn.math.random: ""               
        - actionType: builtIn
          funcName: goBack
          reload: true
      text: "Share one document in meeting"
      style:
        color: "0xFFFFFF"
        background: "0x388eccff"
        left: "0.2"
        top: "0.85"
        width: "0.6"
        height: "0.05"
        border:
          style: "5"
        borderRadius: "0"
        display: inline
        textAlign:
          x: center
          y: center
                
