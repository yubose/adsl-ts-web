MeetingRoomCreate:
  # key start with "_" will be fitered out when it is sent out from front-end context
  #_nonce: 0
  module: meetingroom
  pageNumber: "90" # xd page 5
  title: "Meeting Rooms"
  init:
    - .SignInCheck
    - ..listData.get
    - if:
        - =..listData.hostroom.edge.0
        - continue
        - =.builtIn.checkField:
            dataIn:
              contentType: messageHidden
              wait: 100
    - actionType: evalObject
      object:
        =.builtIn.string.concat:
          dataIn:
            - =.Global.currentUser.vertex.name.firstName
            - " "
            - =.Global.currentUser.vertex.name.lastName
          dataOut: Global.currentUser.vertex.name.fullName               
  save:
    - ..newRoomInfo.edgeAPI.store
    # - .VideoChat.nonce@: =.builtIn.math.random
  lastTop: "0.0" # keep updated for list rendering.
  listData:
    hostroom:
      edge:
    get:
      .EdgeAPI.get : ""
      api: re
      dataKey: listData.hostroom
      id: .Global.currentUser.vertex.id
      type : "40000"
      xfname : bvid
      #sCondition: "refid IS NULL AND tage=0 AND ctime>UNIX_TIMESTAMP()-7200"
      sCondition: "refid IS NULL AND tage=0 AND ctime>UNIX_TIMESTAMP()-86400"
      maxcount : "20"
      obfname : "mtime"
      _nonce: =.Global._nonce
  newRoomInfo:
    edge:
      .Edge: ""
      id: ""
      type: 40000
      bvid: .Global.currentUser.vertex.id
      name:
        roomName: "New Room"
        videoProvider: .Global.currentUser.vertex.name.userName
        fullName: .Global.currentUser.vertex.name.fullName
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: newRoomInfo.edge
        dataOut: createdRoomInfo.edge
  createdRoomInfo:
     edge:
       .Edge: ""
  components:
    - type: view
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        position: "fixed"
      children:
        - .MenuHeader:
        - .SubMenuView:
          children:
            - .SubMenuButton:
            - .SubMenuButton:
              text: "Created"
              style:
                left: "0.34"
                color: "0xffffffff"
              onClick:
                - goto: MeetingRoomCreate
            - .SubMenuButton:
              text: "History"
              style:
                left: "0.67"
              onClick:
                - goto: MeetingRoomHistory
        - type: label
          contentType: messageHidden
          text: "No meetings created"
          style:
            left: "0.31"
            top: "0.25"
            width: "0.72"
            height: "0.04"
            color: "0x000058"
            fontSize: "16"
            isHidden: "true"

        - type: list # hardcoded listObject
          contentType: listObject
          listObject: ..listData.hostroom.edge # to dataObject to enumerate the list
          iteratorVar: itemObject
          #for (itemObject in listObject) do something
          #  ..messageDoc@ = itemObject
          style:
            left: "0"
            top: "0.2"
            width: "1"
            height: "0.8"
          #for loop through listObject, we got each itemObject
          children:
            - type: listItem
              itemObject: ""
              onClick:
                - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                  dataKey: Global.rootRoomInfo.edge
                  dataObject: itemObject # this must be a rootRoom
                - goto: MeetingLobby # create room
              style:
                left: "0"
                top: "0"
                width: "1"
                height: "0.15"
                border:
                  style: "2"
                backgroundColor: "0xFAFAFA"
                borderWidth: "1"
                borderColor: "0x00000011"
              children:
                - type: label
                  dataKey: itemObject.name.roomName
                  #text: "Room 1"
                  style:
                    left: "0.08"
                    top: "0.02"
                    width: "0.8"
                    height: "0.04"
                    fontSize: "16"
                    fontWeight: 400
                    color: "0x000000"
                    display: inline
                    textAlign:
                      x: left
                      y: center
                - type: label
                  text=func: =.builtIn.string.formatUnixtime_en
                  dataKey: itemObject.ctime # Mon Day, Year hh:mm:ss
                  style:
                    left: "0.08"
                    top: "0.08"
                    width: "0.9"
                    fontWeight: 400
                    height: "0.03"
                    fontSize: "16"
                    color: "0x00000058"
                # - type: image
                #   path: rightArrow.png
                #   style:
                #     left: "0.88"
                #     top: "0.02"
                #     width: "0.08"
                #     height: "0.04"
        - type: image
          zIndex: 1
          path: addMeeting.png
          onClick:
            - actionType: popUp
              popUpView: confirmView
          style:
            left: "0.8"
            top: "0.82"
            width: "0.13"
            backgroundColor: "0x388eccff"
            border:
              style: "5"
            borderRadius: "100"
        - type: popUp # view
          viewTag: confirmView
          style:
            left: "0"
            top: "0"
            width: "1"
            height: "1"
            backgroundColor: "0x00000066"
          children:
            - type: view
              style:
                left: "0.05"
                top: "0.15"
                width: "0.88"
                height: "0.35"
                backgroundColor: "0xeeeeeeff"
                border:
                  style: "5"
                borderRadius: "15"
              children:
                - type: label
                  text: "Create Room Name"
                  style:
                    .LabelStyle:
                      left: "0"
                      top: "0.04"
                      width: "0.88"
                      height: "0.05"
                      color: "0x00000088"
                      fontSize: "20"
                      fontStyle: bold
                      display: inline
                      textAlign:
                        x: center
                        y: center
                - type: textField
                  contentType: text
                  placeholder: "New Room"
                  dataKey: newRoomInfo.edge.name.roomName
                  required: "true"
                  style:
                    .LabelStyle:
                      left: "0.085"
                      top: "0.13"
                      width: "0.7"
                      height: "0.05"
                      color: "0x00000088"
                      fontSize: "20"
                      display: inline
                      textAlign:
                        x: center
                        y: center
                - type: divider
                  style:
                    .DividerStyle:
                      left: "0"
                      top: "0.25436"
                      width: "0.88"
                      height: "0.001"
                      backgroundColor: "0x00000088"
                - type: button
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: confirmView
                  text: Cancel
                  style:
                    .LabelStyle:
                      left: "0"
                      top: "0.275"
                      width: "0.42"
                      height: "0.06812"
                      color: "0x007affff"
                      fontSize: "17"
                      display: inline
                      textAlign:
                        x: center
                        y: center
                      border:
                        style: "5"
                      borderRadius: "15"
                - type: button
                  onClick:
                    - actionType: saveObject
                      object: ..save
                    - actionType: evalObject
                      object:
                        - .Global._nonce@:
                            =.builtIn.math.random: ""
                        - .Global.rootRoomInfo@: =..createdRoomInfo.edge
                    - actionType: popUpDismiss
                      popUpView: confirmView
                    - goto: MeetingLobby
                  text: Confirm
                  style:
                    .LabelStyle:
                      left: "0.45"
                      top: "0.275"
                      width: "0.42"
                      height: "0.06812"
                      color: "0x007affff"
                      fontSize: "17"
                      display: inline
                      textAlign:
                        x: center
                        y: center
                      border:
                        style: "5"
                      borderRadius: "15"
                - type: divider
                  style:
                    .DividerStyle:
                      left: "0.45"
                      top: "0.26"
                      width: "0.001"
                      height: "0.07"
                      backgroundColor: "0x00000088"
