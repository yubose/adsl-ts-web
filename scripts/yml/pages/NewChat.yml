NewChat:
  init:
    - if:
        - .builtIn.SignInOk
        - continue
        - goto: SignIn
    - ..bufferChat@: ""
    - ..rootChat@: ""
    - ..phoneInput@: ""
    - ..contacts.list@: ""
  emptyObj: ""
  bufferChat: ""
  rootChat: ""
  oneToOneChatEdge: ""
  phoneInput: ""
  bufferContent:
    edge:
      name:
        InviteePhoneNumber: ""
  bufferAsList:
    - name: ""
  contacts:
    list: ""
    get:
      .EdgeAPI.get: ""
      dataKey: contacts.list
      id: ""
      type: 1091
      xfname: refid | id
      maxcount: "20"
      obfname: mtime
  create1To1Edge:
    - .CreateChatRelation.fun_create1To1ChatEdge.parameter.name.InviteePhoneNumber@: =..bufferChat.edge.name.InviteePhoneNumber
    - .CreateChatRelation.fun_create1To1ChatEdge.parameter.name.InviterName@: =.Global.currentUser.vertex.name.userName
    - =.CreateChatRelation.fun_create1To1ChatEdge.execute
    - ..oneToOneChatEdge@: =.CreateChatRelation.createChatEdge.edge
    - ..bufferChat@: ""
  createGroupChatRootEdge:
    - .CreateChatRelation.fun_createGroupChatRootEdge.parameter.name.InviteePhoneNumber@: =..bufferChat.edge.name.InviteePhoneNumber
    - .CreateChatRelation.fun_createGroupChatRootEdge.parameter.name.InviterName@: =.Global.currentUser.vertex.name.userName
    - =.CreateChatRelation.fun_createGroupChatRootEdge.execute
    - ..rootChat@: =.CreateChatRelation.createChatEdge.edge
    - ..contacts.get.id@: =..rootChat.id
    - ..bufferChat@: ""
  createGroupChatInviteEdge:
    - .CreateChatRelation.fun_createGroupChatInviteEdge.parameter.refid@: =..rootChat.id
    - .CreateChatRelation.fun_createGroupChatInviteEdge.parameter.name.InviteePhoneNumber@: =..phoneInput
    - .CreateChatRelation.fun_createGroupChatInviteEdge.parameter.name.InviterName@: =.Global.currentUser.vertex.name.userName
    - =.CreateChatRelation.fun_createGroupChatInviteEdge.execute
    - ..bufferChat@: ""
  updateChatPageEdge:
    if:
      - =..rootChat
      - .ChatPage.chatEdge@: =..rootChat
      - .ChatPage.chatEdge@: =..oneToOneChatEdge
  createBuffer:
    - ..bufferContent.edge.name.InviteePhoneNumber@: =..phoneInput
    - ..bufferChat@: =..bufferContent
  displayBufferInList:
    - ..bufferAsList.0.name@: =..bufferContent.edge.name
    - ..contacts.list@: =..bufferAsList
  onAddMemberClicked:
    - if:
        - =..rootChat
        - trueCase:
            - =..createGroupChatInviteEdge
            - =..contacts.get
        - falseCase:
            - if:
                - =..bufferChat
                - trueCase:
                    - =..createGroupChatRootEdge
                    - =..createGroupChatInviteEdge
                    - =..contacts.get
                - falseCase:
                    - =..createBuffer
                    - =..displayBufferInList
  onStartChatClicked:
    - if:
        - =..bufferChat
        - =..create1To1Edge
        - continue
    - =..updateChatPageEdge
    - goto: ChatPage
  components:
    - type: view
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
      children:
        - type: view
          style:
            left: "0"
            top: "0"
            width: "1"
            height: "0.08"
            backgroundColor: "0x388eccff"
          children:
            - type: view
              style:
                left: "0.0582"
                top: "0.01"
                width: "0.18667"
                height: "0.05"
              onClick:
                - actionType: pageJump
                  destination: ChatList
              children:
                - type: image
                  path: ~/assets/backWhiteArrow.png
                  style:
                    left: "0"
                    top: "0.01"
                    width: "0.053333"
                    height: "0.03"
                    color: "0xffffffff"
                    backgroundColor: "0x388eccff"
                - type: label
                  text: Back
                  style:
                    left: "0.0667"
                    top: "0.0"
                    width: "0.12"
                    height: "0.05"
                    fontSize: "18"
                    color: "0xffffffff"
                    backgroundColor: "0x388eccff"
            - type: label
              text: NewChat
              style:
                left: "0.25"
                top: "0.02"
                width: "0.5"
                height: "0.03405"
                fontSize: "18"
                display: inline
                color: "0xffffffff"
                backgroundColor: "0x388eccff"
                textAlign:
                  x: center
                  y: center
        - type: textField
          contentType: phoneNumber
          placeholder: InviteePhoneNumber
          dataKey: phoneInput
          style:
            textAlign:
              x: left
            fontSize: "14"
            left: "0.1"
            top: "0.1"
            width: "0.8"
            height: "0.04"
            required: "true"
            borderWidth: "1"
            border:
              style: "2"
        - type: button
          text: Add Member
          style:
            color: "0xffffffff"
            fontSize: "16"
            fontStyle: bold
            left: "0.1"
            top: "0.15"
            width: "0.35"
            height: "0.06"
            backgroundColor: "0x388eccff"
            border:
              style: "1"
            display: inline
            textAlign:
              x: center
              y: center
          onClick:
            - =..onAddMemberClicked
        - type: button
          text: Start Chat
          style:
            color: "0xffffffff"
            fontSize: "16"
            fontStyle: bold
            left: "0.5"
            top: "0.15"
            width: "0.35"
            height: "0.06"
            backgroundColor: "0x388eccff"
            border:
              style: "1"
            display: inline
            textAlign:
              x: center
              y: center
          onClick:
            - goto: ChatPage
        - type: list
          contentType: listObject
          listObject: ..contacts.list
          iteratorVar: itemObject
          style:
            left: "0"
            top: "0.25"
            width: "1"
            height: "0.72"
          children:
            - type: listItem
              itemObject: ""
              style:
                left: "0"
                top: "0"
                width: "1"
                height: "0.15"
                border:
                  style: "2"
                borderWidth: "1"
                borderColor: "0x00000011"
              children:
                - type: label
                  dataKey: itemObject.name.InviteePhoneNumber
                  style:
                    left: "0.25"
                    top: "0.06"
                    width: "0.74"
                    height: "0.03"
                    fontSize: "18"
                    color: "0x000000ff"
    - type: popUp
      viewTag: completeView
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "0.7"
        backgroundColor: "0x00000066"
      children:
        - type: view
          style:
            left: "0.05"
            top: "0.2"
            width: "0.89333"
            height: "0.3"
            backgroundColor: "0xeeeeeeff"
            border:
              style: "5"
            borderRadius: "15"
          children:
            - type: label
              text: Edge 1091 is created
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.04"
                  width: "0.89333"
                  height: "0.027247"
                  color: "0x00000088"
                  fontSize: "20"
                  fontStyle: bold
                  display: inline
                  textAlign:
                    x: center
                    y: center
            - type: divider
              style:
                .DividerStyle:
                  left: "0"
                  top: "0.20436"
                  width: "0.89333"
                  backgroundColor: "0x00000088"
            - type: button
              onClick:
                - actionType: popUpDismiss
                  popUpView: completeView
                - goto: ChatList
              text: OK
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.225"
                  width: "0.89333"
                  height: "0.06812"
                  color: "0x007affff"
                  fontSize: "17"
                  display: inline
                  textAlign:
                    x: center
                    y: center
                  border:
                    style: "5"
                  borderRadius: "15"
