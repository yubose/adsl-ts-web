CreateNewAccount:
  # This is page name

  module: patient

  title: Create New Account # Title

  pageNumber: "3" # Page Number

  init:
    # Page initialization
    - if:
        - ..apiRequest.newAccountFlag.vertex.name.phoneNumber
        - continue
        - goto: SignUp

  formData:
    # Input data here
    target: false
    tar: false
    confirm: ""
    rvCondition: ""
    checkOk: ""

  formDataTemp: # Input data temp here

  apiRequest:
    # Input data request here
    newAccountFlag:
      response: ""
      vertex:
        # inherit from BaseDataModel_en.yml
        .Vertex: ""
        type: .Global.newAccountFlag
        name:
          countryCode: .SignUp.formData.countryCode
          phoneNumber: .Global.phoneNumber
          userName: ""
          firstName: ""
          lastName: ""
          password: ""
          confirmPassword: ""
          avatar: "https://public.aitmed.com/avatar/JohnDoe.jpg"
          verificationCode: .SignUp.formData.code
          signature: ""
      vertexAPI:
        .VertexAPI: ""
        store:
          api: builtIn.createNewAccount # construct uid, pk, esk .. for new account
          dataIn: CreateNewAccount.apiRequest.newAccountFlag.vertex
          dataOut: CreateNewAccount.apiRequest.newAccountFlag.response
    getVertex:
      response: ""
      vertex:
        xfname: none
        type: 1
        sCondition: =..formData.rvCondition
        _nonce: =.Global._nonce
      vertexAPI:
        get:
          api: rv
          dataIn: CreateNewAccount.apiRequest.getVertex.vertex
          dataOut: CreateNewAccount.apiRequest.getVertex.response

  style: # Input style fragment here 

  save:
    - ..apiRequest.newAccountFlag.vertexAPI.store #
    # - .Global.rootNotebook.edgeAPI.store

  update:
    - .Global.currentUser.vertex@: =..apiRequest.newAccountFlag.response.vertex # set {".Global.currentUser.vertex":".builtIn.UserVertex"}
    - .Global.currentUser.vertex.name.firstName@: =..apiRequest.newAccountFlag.vertex.name.firstName
    - .Global.currentUser.vertex.name.lastName@: =..apiRequest.newAccountFlag.vertex.name.lastName
    - .Global.currentUser.JWT@: =..apiRequest.newAccountFlag.response.jwt
    - .Global.rootNotebookID@: =.Global.currentUser.vertex.deat.rnb64ID
    - .Global.currentUser.dataCache.loadingDateTime@: =.Global.currentDateTime

  components:
    - type: view
      style:
        width: "1"
        height: "1"
        margin: auto
      children:
        - type: view
          style:
            width: "0.55"
            height: "1"
            top: "0"
            # backgroundColor: "0xff0000"
          children:
            - type: image
              path: signBg.svg
              style:
                height: "1"
                left: "0"
                top: "0"
            - type: label
              textBoard:
                - text: Welcome To
                - br:
                - text: AiTmed
              style:
                color: "0xffffff"
                textAlign:
                  x: center
                fontSize: "3.4vw"
                lineHeight: "90px"
                marginTop: "0.315"
            - type: label
              text: "WWW.AITMED.COM"
              style:
                color: "0xffffff"
                textAlign:
                  x: center
                fontSize: "1.46vw"
                marginTop: "0.39"
        - type: view
          style:
            left: "0.55"
            width: "0.45"
            height: "1"
            zIndex: "100"
            display: flex
            flex-direction: column
            justify-content: center
            align-items: center
          children:
            - type: image
              path: aitmedBlack.svg
              style:
                top: "0.09"
                width: "0.0624"
                height: "0.121"
                left: "0.19"
            - type: view
              style:
                top: "0.255"
                width: "0.37128"
                height: "0.7"
                borderRadius: "8"
                boxShadow: "0px 3px 10px #dedede"
                display: flex
                flex-direction: column
                justify-content: flex-start
                align-items: center
              children:
                # InCorrect - PopUp
                - .IncorrectPopUp:
                  viewTag: inputPassword
                  msg: "Please complete required fields"
                  style:
                    width: "0.37128"
                - .IncorrectPopUp:
                  viewTag: noSelected
                  msg: "Please check the box"
                  style:
                    width: "0.37128"
                - .IncorrectPopUp:
                  viewTag: invaliduserid
                  msg: "Invalid username: required length should be 6 to 16"
                  style:
                    width: "0.37128"
                - .IncorrectPopUp:
                  viewTag: sameuserid
                  msg: "Username has been used"
                  style:
                    width: "0.37128"
                - .IncorrectPopUp:
                  viewTag: samePassword
                  msg: "Password should be same"
                  style:
                    width: "0.37128"
                - type: view
                  style:
                    top: "0.048"
                    width: "0.31824"
                    height: "0.6"
                  children:
                    # Create Your Account
                    - type: label
                      text: "Create A New Admin Account"
                      style:
                        marginTop: "0"
                        width: "0.31824"
                        fontSize: .Nfont.nf6
                        color: "0x333333"
                        fontWeight: "500"
                    # Number
                    - type: view
                      style:
                        marginTop: "0.03"
                        width: "0.1534"
                        height: "auto"
                        isHidden: false
                        display: flex
                        flex-direction: column
                        align-content: center
                      children:
                        # Country Phone
                        - type: view
                          style:
                            width: "0.1534"
                            height: "auto"
                            display: flex
                            flex-direction: row
                            align-content: flex-start
                          children:
                            - type: label
                              text: Country
                              style:
                                color: "0x333333"
                                width: "0.0364"
                                fontSize: .Nfont.nf1
                                fontWeight: "600"
                            - type: label
                              text: Phone
                              style:
                                color: "0x333333"
                                marginLeft: "0.006"
                                width: "0.11"
                                fontSize: .Nfont.nf1
                                fontWeight: "600"
                        # Select TextField       
                        - type: view
                          style:
                            marginTop: "0.008"
                            width: "0.1534"
                            height: "auto"
                            display: flex
                            flex-direction: row
                            align-content: center
                          children:
                            - type: select
                              contentType: countryCode
                              placeholder: ..apiRequest.newAccountFlag.vertex.name.countryCode
                              dataKey: apiRequest.newAccountFlag.vertex.name.countryCode # formData.countryCode : inputValue
                              options: .CountryCode
                              required: "true"
                              style:
                                width: "0.0364"
                                height: "0.0405"
                                fontSize: .Nfont.nf2
                                fontWeight: "500"
                                textIndent: "0.5em"
                                color: "0x333333"
                                border:
                                  style: "3"
                                borderColor: "0xdedede"
                                borderWidth: "1"
                                borderRadius: "4"
                                boxSizing: "border-box"
                                backgroundColor: "0xffffff00"
                            - type: label
                              # contentType: phoneNumber
                              # placeholder: "Enter here"
                              dataKey: apiRequest.newAccountFlag.vertex.name.phoneNumber # formData.countryCode : inputValue
                              # required: "true"
                              style:
                                marginLeft: "0.006"
                                width: "0.11"
                                height: "0.0405"
                                fontSize: .Nfont.nf2
                                color: "0x333333"
                                border:
                                  style: "3"
                                borderColor: "0xdedede"
                                borderWidth: "1"
                                borderRadius: "4"
                                boxSizing: "border-box"
                                textIndent: "0.5em"
                                backgroundColor: "0xffffff00"
                                textAlign:
                                  y: center
                    # Info
                    - type: view
                      style:
                        marginTop: "0.007"
                        width: "0.3172"
                        height: "0.254"
                        display: flex
                        flex-direction: row
                        flex-wrap: wrap
                        justify-content: space-between
                        align-content: space-around
                      children:
                        # First Name
                        - type: view
                          style:
                            width: "0.1534"
                            height: "auto"
                            display: flex
                            flex-direction: column
                          children:
                            - type: label
                              text: First Name
                              style:
                                width: "0.1534"
                                fontSize: .Nfont.nf1
                                fontWeight: "600"
                            - type: textField
                              contentType: text
                              placeholder: "Enter here"
                              dataKey: apiRequest.newAccountFlag.vertex.name.firstName # formData.countryCode : inputValue
                              required: "true"
                              style:
                                marginTop: "0.008"
                                height: "0.0405"
                                fontSize: .Nfont.nf2
                                border:
                                  style: "3"
                                borderColor: "0xdedede"
                                borderWidth: "1"
                                borderRadius: "4"
                                boxSizing: "border-box"
                                textIndent: "0.5em"
                                backgroundColor: "0xffffff00"
                        # Last Name
                        - type: view
                          style:
                            width: "0.1534"
                            height: "auto"
                            display: flex
                            flex-direction: column
                          children:
                            - type: label
                              text: Last Name
                              style:
                                width: "0.1534"
                                fontSize: .Nfont.nf1
                                fontWeight: "600"
                            - type: textField
                              contentType: text
                              placeholder: "Enter here"
                              dataKey: apiRequest.newAccountFlag.vertex.name.lastName # formData.countryCode : inputValue
                              required: "true"
                              style:
                                marginTop: "0.008"
                                height: "0.0405"
                                fontSize: .Nfont.nf2
                                border:
                                  style: "3"
                                borderColor: "0xdedede"
                                borderWidth: "1"
                                borderRadius: "4"
                                boxSizing: "border-box"
                                textIndent: "0.5em"
                                backgroundColor: "0xffffff00"
                        # Username
                        - type: view
                          style:
                            width: "0.1534"
                            height: "auto"
                            display: flex
                            flex-direction: column
                          children:
                            - type: label
                              text: Username
                              style:
                                width: "0.1534"
                                fontSize: .Nfont.nf1
                                fontWeight: "600"
                            - type: textField
                              contentType: text
                              placeholder: "Enter here"
                              dataKey: apiRequest.newAccountFlag.vertex.name.userName # formData.countryCode : inputValue
                              required: "true"
                              style:
                                marginTop: "0.008"
                                height: "0.0405"
                                fontSize: .Nfont.nf2
                                border:
                                  style: "3"
                                borderColor: "0xdedede"
                                borderWidth: "1"
                                borderRadius: "4"
                                boxSizing: "border-box"
                                textIndent: "0.5em"
                                backgroundColor: "0xffffff00"
                        # Email
                        - type: view
                          style:
                            width: "0.1534"
                            height: "auto"
                            display: flex
                            flex-direction: column
                          children:
                            - type: label
                              text: Email
                              style:
                                width: "0.1534"
                                fontSize: .Nfont.nf1
                                fontWeight: "600"
                            - type: textField
                              contentType: text
                              placeholder: "Enter here"
                              dataKey: apiRequest.newAccountFlag.vertex.name.email # formData.countryCode : inputValue
                              required: "true"
                              style:
                                marginTop: "0.008"
                                height: "0.0405"
                                fontSize: .Nfont.nf2
                                border:
                                  style: "3"
                                borderColor: "0xdedede"
                                borderWidth: "1"
                                borderRadius: "4"
                                boxSizing: "border-box"
                                textIndent: "0.5em"
                                backgroundColor: "0xffffff00"
                        # Password
                        - type: view
                          style:
                            width: "0.1534"
                            height: "auto"
                            display: flex
                            flex-direction: column
                          children:
                            - type: label
                              text: Password
                              style:
                                width: "0.1534"
                                fontSize: .Nfont.nf1
                                fontWeight: "600"
                            - type: view
                              style:
                                marginTop: "0.008"
                                height: "0.0405"
                                border: '1px solid #000000'
                                borderWidth: "1px"
                                borderRadius: "4"
                                borderColor: "0xdedede"
                              children:
                                - type: textField
                                  contentType: password
                                  placeholder: "Enter here"
                                  dataKey: apiRequest.newAccountFlag.vertex.name.password # formData.countryCode : inputValue
                                  required: "true"
                                  style:
                                    height: "0.0405"
                                    fontSize: .Nfont.nf2
                                    border: none
                                    textAlign:
                                      x: left
                                      y: center
                                    textIndent: "0.5em"
                                    backgroundColor: "0xffffff00"
                                    box-sizing: border-box
                                    borderRadius: "4"
                        # Confirm Password
                        - type: view
                          style:
                            width: "0.1534"
                            height: "auto"
                            display: flex
                            flex-direction: column
                          children:
                            - type: label
                              text: Confirm Password
                              style:
                                width: "0.1534"
                                fontSize: .Nfont.nf1
                                fontWeight: "600"
                            - type: view
                              style:
                                marginTop: "0.008"
                                height: "0.0405"
                                border: '1px solid #000000'
                                borderWidth: "1px"
                                borderRadius: "4"
                                borderColor: "0xdedede"
                              children:
                                - type: textField
                                  contentType: password
                                  placeholder: "Enter here"
                                  dataKey: apiRequest.newAccountFlag.vertex.name.confirmPassword # formData.countryCode : inputValue
                                  required: "true"
                                  style:
                                    height: "0.0405"
                                    fontSize: .Nfont.nf2
                                    border: none
                                    textAlign:
                                      x: left
                                      y: center
                                    textIndent: "0.5em"
                                    backgroundColor: "0xffffff00"
                                    box-sizing: border-box
                                    borderRadius: "4"
                    # Policy                
                    - type: view
                      style:
                        width: "0.31824"
                        height: auto
                      children:
                        - type: view
                          style:
                            marginTop: "0.008"
                            width: "0.31824"
                          children:
                            - type: image
                              viewTag: select
                              onClick:
                                - emit:
                                    actions:
                                      - if:
                                          - =.CreateNewAccount.formData.target
                                          - .CreateNewAccount.formData.target@: false
                                          - .CreateNewAccount.formData.target@: true
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: select
                              path:
                                emit:
                                  actions:
                                    - if:
                                        - =.CreateNewAccount.formData.target
                                        - selectBlue.svg
                                        - selectGray.svg
                              style:
                                width: "0.00832"
                                height: "0.01472"
                                display: inline-block
                            - type: label
                              style:
                                color: "0x333333"
                                display: inline-block
                                marginLeft: "0.005"
                                fontSize: .Nfont.nf0
                                textAlign:
                                  x: left
                              onClick:
                                - ..fromData.flag@: "1"
                                - goto: UserAgreement
                              textBoard:
                                - text: "I agree to "
                                - text: "&nbsp;"
                                - text: "AiTmed Terms of Use Agreement"
                                  color: "0x005795"
                                - text: "&nbsp;"
                                - text: " and "
                            - type: label
                              style:
                                color: "0x333333"
                                display: inline-block
                                marginLeft: "0.005"
                                fontSize: .Nfont.nf0
                                textAlign:
                                  x: left
                              onClick:
                                - ..fromData.flag@: "2"
                                - goto: SubscriptionAgreement
                              textBoard:
                                - text: "AiTmed Master Subscription Agreement"
                                  color: "0x005795"
                        - type: view
                          style:
                            marginTop: "0.008"
                            width: "0.31824"
                          children:
                            - type: image
                              viewTag: select
                              onClick:
                                - emit:
                                    actions:
                                      - if:
                                          - =.CreateNewAccount.formData.tar
                                          - .CreateNewAccount.formData.tar@: false
                                          - .CreateNewAccount.formData.tar@: true
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: select
                              path:
                                emit:
                                  actions:
                                    - if:
                                        - =.CreateNewAccount.formData.tar
                                        - selectBlue.svg
                                        - selectGray.svg
                              style:
                                width: "0.00832"
                                height: "0.01472"
                                display: inline-block
                            - type: label
                              onClick:
                                - ..fromData.flag@: "3"
                                - goto: PrivacyPolicy
                              textBoard:
                                - text: "I also agree to"
                                - text: "&nbsp;"
                                - text: " AiTmed Privacy Policy"
                                  color: "0x005795"
                              style:
                                color: "0x333333"
                                display: inline-block
                                marginLeft: "0.005"
                                fontSize: .Nfont.nf0
                                textAlign:
                                  x: left
                    # Sign Up
                    - type: view
                      style:
                        marginTop: "0.024"
                        width: "0.3172"
                        height: "0.0405"
                        display: flex
                        justifyContent: center
                      children:
                        - type: button
                          text: Sign Up
                          style:
                            color: "0xffffff"
                            fontSize: .Nfont.nf3
                            width: "0.1976"
                            height: "0.0405"
                            fontFamily: "Roboto"
                            backgroundColor: "0x005795"
                            border:
                              style: "1"
                            display: inline
                            borderRadius: "4"
                            textAlign:
                              x: center
                              y: center
                          onClick:
                            - actionType: evalObject
                              object:
                                - if:
                                    - =..formData.target
                                    - continue
                                    - actionType: popUp
                                      popUpView: noSelected
                                      popUpDismiss: 3000
                                      wait: true
                            - actionType: evalObject
                              object:
                                - if:
                                    - =..formData.tar
                                    - continue
                                    - actionType: popUp
                                      popUpView: noSelected
                                      popUpDismiss: 3000
                                      wait: true
                            - actionType: evalObject
                              object:
                                - if:
                                    - =..apiRequest.newAccountFlag.vertex.name.password
                                    - continue
                                    - actionType: popUp
                                      popUpView: inputPassword
                                      popUpDismiss: 3000
                                      wait: true
                            - actionType: evalObject
                              object:
                                - if:
                                    - =..apiRequest.newAccountFlag.vertex.name.userName
                                    - continue
                                    - actionType: popUp
                                      popUpView: inputPassword
                                      popUpDismiss: 3000
                                      wait: true
                            - actionType: evalObject
                              object:
                                - if:
                                    - =..apiRequest.newAccountFlag.vertex.name.firstName
                                    - continue
                                    - actionType: popUp
                                      popUpView: inputPassword
                                      popUpDismiss: 3000
                                      wait: true
                            - actionType: evalObject
                              object:
                                - if:
                                    - =..apiRequest.newAccountFlag.vertex.name.lastName
                                    - continue
                                    - actionType: popUp
                                      popUpView: inputPassword
                                      popUpDismiss: 3000
                                      wait: true
                            - actionType: evalObject
                              object:
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..apiRequest.newAccountFlag.vertex.name.password
                                          string2: =..apiRequest.newAccountFlag.vertex.name.confirmPassword
                                    - continue
                                    - actionType: popUp
                                      popUpView: samePassword
                                      popUpDismiss: 3000
                                      wait: true
                            - actionType: evalObject
                              object:
                                .Global._nonce@:
                                  =.builtIn.math.random: ""
                            - actionType: evalObject
                              object:
                                - =.builtIn.typeCheck.userName:
                                    dataIn: =..apiRequest.newAccountFlag.vertex.name.userName
                                    dataOut: CreateNewAccount.formData.checkOk
                                - if:
                                    - =..formData.checkOk
                                    - continue
                                    - actionType: popUp
                                      popUpView: invaliduserid
                                      popUpDismiss: 3000
                                      wait: true
                            - actionType: evalObject
                              object:
                                - =.builtIn.string.concat:
                                    dataIn:
                                      - "uid like '"
                                      - =..apiRequest.newAccountFlag.vertex.name.userName
                                      - "%'"
                                    dataOut: CreateNewAccount.formData.rvCondition
                                - =..apiRequest.getVertex.vertexAPI.get: ""
                                - if:
                                    - =..apiRequest.getVertex.response.vertex.0.id
                                    - actionType: popUp
                                      popUpView: sameuserid
                                      popUpDismiss: 3000
                                      wait: true
                                    - continue
                            - actionType: saveObject
                              object: ..save
                            - actionType: evalObject
                              object:
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..apiRequest.newAccountFlag.response.code
                                          string2: 1031
                                    - actionType: popUp
                                      popUpView: sameuserid
                                      popUpDismiss: 3000
                                      wait: true
                                    - continue
                            - actionType: evalObject
                              object: ..update
                            - actionType: evalObject
                              object:
                                =.builtIn.eccNaCl.decryptAES:
                                  dataIn:
                                    key: =..apiRequest.newAccountFlag.vertex.name.password
                                    message: =..apiRequest.newAccountFlag.response.vertex.esk
                                  dataOut: Global.currentUser.vertex.sk
                            - actionType: evalObject
                              object:
                                - if:
                                    - =..apiRequest.newAccountFlag.response.vertex.pk
                                    - goto: SelectOrganization
                                    - actionType: popUp
                                      popUpView: wrongCode
                            - actionType: evalObject
                              object:
                                - if:
                                    - =..apiRequest.newAccountFlag.response.vertex.pk
                                    - continue
                                    - goto: SignUp
                    # OR
                    - type: view
                      style:
                        marginTop: "0.035"
                        width: "0.31824"
                      children:
                        - type: view
                          style:
                            height: "0.0001"
                            width: "0.151"
                            # marginTop: "0.01"
                            backgroundColor: "0xdedede"
                        - type: view
                          style:
                            height: "0.0001"
                            width: "0.151"
                            marginLeft: "0.168"
                            backgroundColor: "0xdedede"
                    - type: label
                      text: OR
                      style:
                        fontSize: .Nfont.nf0
                        zIndex: "2"
                        left: "0.154"
                        top: "0.544"
                        color: "0x333333"
                    # Already have an account?
                    - type: view
                      style:
                        marginTop: "0.03"
                        width: "0.31824"
                        display: flex
                        justify-content: center
                      children:
                        - type: label
                          text: "Already have an account?"
                          style:
                            fontSize: .Nfont.nf2
                            color: "0x333333"
                            fontFamily: "Roboto"
                        - type: Label
                          text: Sign In Now
                          style:
                            marginLeft: "0.003"
                            color: "0x005795"
                            fontSize: .Nfont.nf2
                            fontWeight: "700"
                            fontFamily: "Roboto"
                          onClick:
                            - goto: SignIn
        - .BaseWarningView: ""
          viewTag: wrongCode
          msg2: "Incorrect verificationCode"
