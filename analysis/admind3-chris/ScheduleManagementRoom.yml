ScheduleManagementRoom:
  #xd page number: 1080
  pageNumber: "450"
  viewPort: top
  title: "ScheduleManagementRoom"
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - actionType: updateObject
      dataKey: Global.formData.appointment
      dataObject: {}
    - actionType: updateObject
      dataKey: Global.formData.visitQuestionnaire
      dataObject: {}
    - actionType: updateObject
      dataKey: Global.formData.patientChart
      dataObject: {}

    #生成年份
    - =.builtIn.date.generateYear:
        dataIn:
          last: 40
          next: 10
        dataOut: BaseDate.year
    # 注释了 patient预约的入口
    # - if: 
    #   - =.Global.patientAll
    #   - ..formData.parseProfile@: =.Global.patientAll
    #   - continue
    - actionType: evalObject
      object: .BaseDate.getDate
    # - if: 
    #   - =.Global.formData.currentUpdateConditionRoom
    #   - actionType: evalObject
    #     object: .BaseDate.getDateNoRegetDate
    #   - actionType: evalObject
    #     object: .BaseDate.getDate

    - =.builtIn.date.getTimeStampOfDate:
        dataIn:
          date: =.BaseDate.calendarDate.todayDate
        dataOut: BaseDate.calendarDate.todayStamp
    - =.builtIn.string.concat:
        dataIn:
          - "E2.type=40000 AND E2.subtype&0xff in (1,9) AND E.type = 40000 AND
            E.subtype&0xff in (6,100)"
          - " AND "
          # - "(E.stime<"
          # - =.BaseDate.calendarDate.todayStamp.start
          # - " AND "
          - "E.etime>"
          - =.BaseDate.calendarDate.todayStamp.start
          # - " OR "
          # - "E.stime>"
          # - =.BaseDate.calendarDate.todayStamp.start
          # - " AND "
          # - "E.etime<"
          # - =.BaseDate.calendarDate.todayStamp.end
          # - " OR "
          # - "E.stime<"
          # - =.BaseDate.calendarDate.todayStamp.end
          # - " AND "
          # - "E.etime>"
          # - =.BaseDate.calendarDate.todayStamp.end
          # - ")"
        dataOut: ScheduleManagementRoom.inMeetingRoom.edge.sCondition
    - ..formData.timeTable.response@: "" #表格置空
    #  FOR LOCATION OPTIONS
    - =.builtIn.array.selectOneToArr:
        # 获取所有的address
        dataIn:
          arr: =.Global.locationAll
          key: "medicalFacilityName"
        dataOut: ScheduleManagementRoom.addressName
    - ..formData.locationSendList@: =..addressName
    - =.builtIn.array.push:
        dataIn:
          messages: =..addressName
          newMessage: "All Locations"
    # FOR ADD APPOINTMENT    
    - =.builtIn.array.push:
        dataIn:
          messages: =..formData.locationSendList
          newMessage: "Select Location"
    - ..formData.roomSendList@: [ "Select Room" ]
    - ..formData.reasonSendList@: [ "Select Reason" ]
    - ..formData.roomSelect@: [ "All Rooms" ]

    # - actionType: evalObject
    #   object: 
    - ..selectDate@: .BaseDate.calendarDate.todayDate
    - .Global.currentSubtype@: '655361'
    - .Global.visitType@: "Telemedicine"
    - ..newAppointment.edge.name.visitType@: "Covid19Test"
    - ..newAppointment.edge.name.visitTypeShow@: "Covid19Test"
    # location
    # - =.builtIn.array.selectOneToArr:   
    #     dataIn:
    #       arr: =.Global.locationAll
    #       key: "id"
    #     dataOut: Global.alllocationID
    - ..formData.addressName@: "All Locations"
    # GET ALL LOCATIONS ID
    - =.builtIn.array.selectOneToArr:
        dataIn:
          arr: =.Global.locationAll
          key: "id"
        dataOut: ScheduleManagementRoom.formData.locIds
    # - ..formData.locIds@: ["jg+RvG+bQUggC0NCgM6IAA=="]    
    # 每次进这个页面会get vertex 为了减少这个处理 我们把其放到 切换 机构的时候
    # - ..roomList.vertexIn.id@: =..formData.locIds
    # - =..roomList.vertexAPI.get: ""
    # GET ROOM SELECT OPTIONS
    - =.builtIn.object.extractArray:
        dataIn:
          obj: =.Global.roomAll
          arr:
            - id
            - name.basicInfo.roomName
            - name.basicInfo.service
        dataOut: ScheduleManagementRoom.formData.roomInfo # id + roomName + service       
    - =.builtIn.array.selectOneToArr:
        dataIn:
          arr: =..formData.roomInfo
          key: "roomName"
        dataOut: ScheduleManagementRoom.formData.roomRequestName
    - =.builtIn.array.push:
        dataIn:
          messages: =..formData.roomRequestName
          newMessage: "All Rooms"
    - ..formData.roomSelect@: =..formData.roomRequestName
    # GET ALL ROOMS ID
    - =.builtIn.array.selectOneToArr:
        dataIn:
          arr: =.Global.roomAll
          key: "id"
        dataOut: ScheduleManagementRoom.formData.roomIds # 获取所有的roomIds
    # concat locIds + roomIds
    - =.builtIn.array.concat:
        dataIn:
          array1: =..formData.locIds
          array2: =..formData.roomIds
        dataOut: ScheduleManagementRoom.formData.allId # store locIds + roomIds          
    - ..inMeetingRoom.edge.id@: =..formData.allId
    - =..inMeetingRoom.edgeAPI.get: ""
    - =.builtIn.object.extractArray:
        dataIn:
          obj: =..inMeetingRoom.edgeResp.edge
          arr:
            - stime
            - etime
            - name.visitReason
            - name.patientName
            - name.visitType
            - id
            - name.duration
            - tage
            - subtype
        dataOut: ScheduleManagementRoom.formData.timeTable.chartData
    - ..formData.allAppointmentRoom@: =..inMeetingRoom.edgeResp.edge
    - ..formData.appointment@: =..formData.allAppointmentRoom

    - =.builtIn.array.arrTageTypeIsValid:
        dataIn:
          docs: =..formData.appointment
          local: 9
          binary: 1
        dataOut: ScheduleManagementRoom.formData.filterAppointment
    - =.builtIn.array.arrTageTypeIsValid:
        dataIn:
          docs: =..formData.filterAppointment
          local: 4
          binary: 1
        dataOut: ScheduleManagementRoom.formData.filterAppointment
    - ..formData.appointment@: =..formData.filterAppointment

    - =.builtIn.array.getListLength:
        dataIn:
          object: =..formData.appointment
        dataOut: ScheduleManagementRoom.formData.appointmentLength
    # 判断是否从patient Profile页面回来
    - if:
        - =.Global.formData.createAppStatusRoom
        - actionType: evalObject
          object:
            - .Global.formData.createAppStatusRoom@: false
            - ..formData.createAppInfo@: "block"
            - ..newAppointment.edge@: =.Global.formData.newAppointmentRoom
            - ..formData.parseProfile.0@: =.Global.formData.patientInfo
        - continue

  roomList:
    vertexResp: ""
    vertexIn:
      ObjType: "4"
      id: []
      xfname: E.Bvid
      sCondition: "E.type=1100 AND V.type=30"
      _nonce: =.Global._nonce
    vertexAPI:
      get:
        api: rv
        dataIn: roomList.vertexIn
        dataOut: ScheduleManagementRoom.roomList.vertexResp
  getRooms:
    vertexResp:
    vertex:
      ObjType: "4"
      id: ""
      xfname: E.bvid
      sCondition: "E.type=1100 AND V.type=30"
      maxcount: "1000"
      _nonce: =.Global._nonce
    vertexAPI:
      get:
        api: rv
        dataIn: getRooms.vertex
        dataOut: getRooms.vertexResp
  schedule:
    # 获取avilability，可用时间的
    response: ""
    scheduleList: ""
    get:
      api: re
      dataIn: ScheduleManagementRoom.schedule.edge
      dataOut: ScheduleManagementRoom.schedule.scheduleList
    edge:
      type: 40000
      id: []
      sCondition: "=.Global.scheduleScondition"
      xfname: "evid,bvid"
      maxcount: "1000"
      obfname: "stime"
      asc: true
      _nonce: =.Global._nonce
  visitReason:
    docResp: ""
    document:
    docIn:
      type: .DocType.VisitReason
      id: ""
      xfname: "ovid"
      obfname: "ctime"
      _nonce: =.Global_nonce
      maxcount: "1"
    docAPI:
      get:
        .DocAPI.get: ""
        api: rd
        dataIn: visitReason.docIn
        dataOut: ScheduleManagementRoom.visitReason.docResp

  inMeetingRoom:
    edgeResp:
      edge: []
    edge:
      .Edge: ""
      # id include: location id ,room id
      id: []
      ObjType: "20"
      xfname: E2.Bvid,E2.Evid
      # type: .EdgeType.WaitingRoom
      sCondition: ""
      obfname: "ctime"
      _nonce: =.Global._nonce
      maxcount: "1000"
    edgeAPI:
      get:
        api: re
        dataIn: inMeetingRoom.edge
        dataOut: ScheduleManagementRoom.inMeetingRoom.edgeResp
  invite:
    # 1053那条边，将其他人邀请进入会议
    edge:
      type: .EdgeType.InviteInfo
      refid: ""
      bvid: ""
      # bvid: .MyActiveProvider.providerId
      evid: ""
      _nonce: =.Global._nonce
      # evid: "NzczFCtoRgYkcD3yEvGhRA=="
      name:
        firstName: ""
        lastName: ""
        roomName: ""
        date: ""
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: invite.edge
  isContact:
    # 判断是否为好友
    response: ""
    edge:
      id: []
      xfname: evid,bvid
      type: 10002
      _nonce: =.Global._nonce
    edgeAPI:
      get:
        api: re
        dataIn: ScheduleManagementRoom.isContact.edge
        dataOut: ScheduleManagementRoom.isContact.response
  #获取E2边上的文档
  accept:
    #如果不是好友，直接成为好友
    response: ""
    edge:
      type: .EdgeType.Accept
      evid: .Global.currentFacility.id
      name: ""
      refid: ""
    edgeAPI:
      store:
        api: ce
        dataIn: ScheduleManagementRoom.accept.edge
        dataOut: ScheduleManagementRoom.accept.response
  invite2:
    #发送邀请 patient provider
    response: ""
    edge:
      # .Edge: ""
      type: .EdgeType.InviteInfo
      bvid: ""
      _nonce: =.Global._nonce
      subtype: 65536
      name:
        phoneNumber: ""
        inviterPhoneNumber: ""
        inviteeName: ""
        inviterName: ""
        data:
          phone: ""
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: ScheduleManagementRoom.invite2.edge
        dataOut: ScheduleManagementRoom.invite2.response
      # get: 
      #   api: re
      #   id: .Global.currentUser.vertex.id
      #   xfname: bvid
      #   type: 1053
      #   _nonce: =.Global._nonce
      #   dataKey: data         
  getPatientProfile:
    response: ""
    docIn:
      type: 102401
      id: =..formData.appointmentInfo.id
      xfname: eid
    docOut: ""
    docAPI:
      get:
        api: rd
        dataIn: ScheduleManagementRoom.getPatientProfile.docIn
        dataOut: ScheduleManagementRoom.getPatientProfile.docOut
  apiRequest:
    # get 当前Patient 和facility之间10002上的profile的hashCode以及新建hashtag
    patientHash:
      docQueryResp:
        doc: []
      docQueryReq:
        id: ""
        xfname: reid
        obfname: mtime
        type: .DocType.HashTag
        maxcount: "1"
        _nonce: =.Global._nonce
      docStoreResp: ""
      docStoreReq:
        eid: ""
        reid: ""
        type: .DocType.HashTag
        name:
          data:
            hashFields:
              - name
              - mtime
              - type
            hashCode: "" # sha256 
      docAPI:
        get:
          api: rd
          dataIn: apiRequest.patientHash.docQueryReq
          dataOut: ScheduleManagementRoom.apiRequest.patientHash.docQueryResp
        store:
          api: cd
          dataIn: apiRequest.patientHash.docStoreReq
          dataOut: ScheduleManagementRoom.apiRequest.patientHash.docStoreResp
    # 根据号码获取Patient
    getPatientByPhone:
      docIn:
        ObjType: 28
        xfname: none
        sfname: "{\"result\":\"D.*\", \"join\": \"INNER JOIN Vertex V on V.id = D.ovid
          INNER JOIN Edge E ON E.id=D.eid\"}"
        sCondition: ""
        type: 102401
        obfname: mtime
        maxcount: "1"
      docResp:
        doc: []
      docAPI:
        get:
          api: rd
          dataIn: apiRequest.getPatientByPhone.docIn
          dataOut: ScheduleManagementRoom.apiRequest.getPatientByPhone.docResp
    # 预约自动同意（subtype=5）
    autoApprove:
      edgeResp: ""
      edge:
        .Edge: ""
        evid: ""
        refid: ""
        type: 40000
        subtype: 5
        stime: ""
        etime: ""
      edgeAPI:
        store:
          api: ce
          dataIn: apiRequest.autoApprove.edge
          dataOut: ScheduleManagementRoom.apiRequest.autoApprove.edgeResp
    # 创建新的预约邀请参与者
    inviteParticipant:
      edgeResp: ""
      edge:
        .Edge: ""
        evid: ""
        refid: ""
        type: 1053
        stime: ""
        etime: ""
      edgeAPI:
        store:
          api: ce
          dataIn: apiRequest.inviteParticipant.edge
          dataOut: ScheduleManagementRoom.apiRequest.inviteParticipant.edgeResp
    currentApproveRequest:
      storeEdge: ""
      edgeAPI:
        store:
          api: ce
          dataIn: apiRequest.currentApproveRequest.storeEdge
          dataOut: PatientSummaryRoom.apiRequest.currentApproveRequest.response
    #获取最近可预约时间段
    getFirstAvail:
      response: ""
      edge:
        type: 40000
        id: []
        sCondition: "=.Global.scheduleScondition2"
        maxcount: "1"
        xfname: "evid,bvid"
        obfname: "stime"
        asc: true
        _nonce: =.Global._nonce
      edgeAPI:
        get:
          .EdgeAPI.get: ""
          api: re
          dataIn: ScheduleManagementRoom.apiRequest.getFirstAvail.edge
          dataOut: ScheduleManagementRoom.apiRequest.getFirstAvail.response
    financialInfo:
      docStoreResp: ""
      docStoreReq:
        type: .DocType.FinancialInfo
        reid: ""
        eid: ""
        name:
          data:
            paymentInfo:
              fee: ""
              checkoutBalance: "" # due to other medical balance
            payerInfo:
              employerInfo: ""
              attorneyInfo: ""
              insuranceInfo: ""
              individualInfo: ""
      docAPI:
        store:
          api: cd
          dataIn: apiRequest.financialInfo.docStoreReq
          dataOut: ScheduleManagementRoom.apiRequest.financialInfo.docStoreResp

  visitType: "COVID-19 Testing"
  splitTime: []     
  locationId: .Global.locationAll.0.id # 创建预约时候location要使用的
  requestLocationId: .Global.locationAll.0.id # 获取所有病人给location的预约请求时候location要使用的
  requestAddress: ""
  addressName: "All Locations"
  clock: {}
  # roomReqView
  selectDate: ""
  appointmentTime: ""
  selectData:
    reason:
    duration: ""
    fee: ""
    document: []
  formData:
    patShareProfile: "" # patient profile share后
    createAppInfo: "none" # 创建预约详情页面是否显示
    appointmentTemp: []
    noCheckedInAppointment: []
    parseProfile: []
    nextBtnColor: "0xd3dde9" # 预约时不选时间就不许下一步
    allAppointImage: 'Yes'
    locationSendList: []       
    locationSend: "" # location datakey in "add a appointment" 
    locationSendId: ""
    roomSendList: []       
    roomSend: "" # room datakey in "add a appointment"
    roomSendId: ""
    roomSendInfo: "" #after selecting location , get the room of this location's info
    roomSendService: ""
    roomSendServiceType: ""
    reasonSendList: []       
    reasonSend: "" # reason datakey in "add a appointment" 
    alllocationID: []       
    roomServiceType: ""
    roomInfo: ""
    roomName: "All Rooms"
    pageName: ""
    roomRequestId: ""
    roomRequestName: []
    roomSelect: []
    addressName: ""
    inviteMessage: ""
    currentVisitType: "COVID-19 Testing"
    locationHidden: "true"
    locationList: ""
    dataStruc:
      - reason
      - duration
    appointmentInfo: ""
    scheduleInfoAppointment: ""
    providerList: []
    providerName: ""
    providerId:
    durationMinutes: ""
    timeTable:
      chartType: "calendarTable"
      chartData: []         
      response: ""
    allId: []       
    locId: []       
    locIds: []       
    # roomId: []
    roomIds: []       
    allAppointmentRoom: []       
    checkedInAppointment: []       
    isDisplayAllAppointment: block
    isDisplayCheckedInAppointment: none
    appointmentLength: "0"
    appointmentLengthLabel: "New Appointment"
    appointment: []       
  formDataTemp:
    appointmentTitleNew:
      title: "New Request"
      fontColor: "0x005795"
      fontWeight: "600"
      bdColor: "0x005795"
    appointmentTitleCheck:
      title: "Checked in"
      fontColor: "0x000000"
      fontWeight: "500"
      bdColor: "0xf2f2f2"
    appointmentTitleData:
      - title: "New Request"
        fontColor: "0x005795"
        fontWeight: "600"
        bdColor: "0x005795"
      - title: "Checked in"
        fontColor: "0x000000"
        fontWeight: "500"
        bdColor: "0xf2f2f2"
  newAppointment:
    response: ""
    edge:
      .Edge: ""
      evid: ""
      bvid: .Global.currentFacility.id
      subtype: "" # 预约的时候会根据不同的类型给不同的subtype:  telemedicine: 0x20002
      type: 40000
      tage: 1
      name:
        patientName: "" #"" #病人名字
        visitType: "COVID-19 Testing" # visitType 用于判定
        visitTypeShow: "" # visitType 用于显示 ，避免和判定冲突
        providerName: "" # 医生名字
        visitReason: "" # 看病原因
        blockColor: "" #背景色
        fontColor: "" #字体颜色
        Reason: "" # 看病原因的拼接，用于展示
        fee: ""
        duration: ""
        document: "" # 看病原因要填写的vaccin
        finishDoc: []
        location: ""
        locationName: ""
        providerFullInfo: ""
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: newAppointment.edge
        dataOut: newAppointment.response
  components:
    - type: view
      style:
        width: '1'
        height: '1'
        # top: "0"
        margin: auto
      children:
        - .BasePopUp:
          viewTag: inviteSuccess
          children:
            - .PopUphead:
              style:
                left: '0.6'
                borderRadius: "5"
              children:
                - .CreateLabel:
                  text: 'Appointment Details'
                - .Closebutton:
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: inviteSuccess
            - type: view
              style:
                height: '0.92'
                width: '0.4'
                top: '0.075'
                left: '0.6'
                backgroundColor: '0xffffff'
              children:
                - type: image
                  path: popUpSuccess.svg
                  style:
                    width: '0.1'
                    top: '0.12'
                    left: '0.155'
                - type: label
                  text: 'Success!'
                  style:
                    width: '0.1'
                    height: '0.05'
                    left: '0.17'
                    top: '0.37'
                    fontSize: '28'
                - type: label
                  text: 'Appointment has been scheduled successfully for'
                  style:
                    width: '0.25'
                    height: '0.03'
                    left: '0.11'
                    top: '0.5'
                    fontSize: '16'
                - type: label
                  dataKey: newAppointment.edge.name.patientName
                  style:
                    width: '0.3'
                    height: '0.05'
                    left: '0.05'
                    top: '0.55'
                    fontSize: '16'
                    textAlign:
                      x: center
                      y: center
                - .BottomButton:
                  text: 'Done'
                  style:
                    width: '0.12'
                    left: '0.15'
                    top: '0.7'
                    backgroundColor: '#005795'
                    color: '0xffffff'
                  onClick:
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - ..appointment.list.edge@: []
                        # - ..appointment.edge.id@: =..formData.providerId
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - =..appointment.edgeAPI.get: ""
                        - =.builtIn.array.getListLength:
                            dataIn:
                              object: =..appointment.list.edge
                            dataOut: ScheduleManagementRoom.formData.appointmentLength
                        - ..appointment.list.edge@: []
                        - =..appointment.edgeAPI.get: ""
                        - actionType: updateObject
                          dataKey: Global.formData.newAppointmentRoom
                          dataObject: {}
                        - actionType: updateObject
                          dataKey: Global.formData.patientInfo
                          dataObject: {}
                        - =.builtIn.goto:
                            dataIn:
                              destination: ScheduleManagementRoom
                              pageReload: true

                    - actionType: builtIn
                      funcName: redraw
                      viewTag: appointmentTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: appointmentLengthTag
                    - actionType: popUpDismiss
                      popUpView: inviteSuccess
                    # - goto: ScheduleManagementRoom    
        - .BaseCheckView: ""
          message: "You don't have the authority to create a new appointment"
          viewTag: scheduleInfoAuthCreate
          style:
            zIndex: "100"
        - .SideMenuBar:
          children:
            - .aitLogo:
            - .MenuBar:
        - .TopBar:
        - .BodyView:
          children:
            - type: view
              style:
                left: "0.03"
                width: "0.8"
                height: "0.08"
                display: flex
                boxSizing: border-box
                alignItems: center
                justifyContent: space-between
              children:
                - type: label
                  text: Schedule Management
                  style:
                    fontSize: .Nfont.n5
                    fontWeight: "600"
                    width: "0.3"
            # 下拉框
            - type: view
              viewTag: selectTypeAndDocView
              style:
                width: '0.35'
                height: '0.04'
                top: '0.08'
                left: '0.25'
              children:
                # FOR SELECT LOCATION
                - .Scselect1:
                  dataKey: formData.addressName
                  style:
                    top: "0"
                    left: "0"
                  options: ..addressName
                  onChange:
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - ..formData.roomName@: "All Rooms" # change room select dataKey
                        - ..formData.roomRequestName@: []
                        - ..formData.allAppointmentRoom@: []
                        - ..formData.roomIds@: []                             
                        - ..formData.locId@: []
                        - ..formData.allId@: []
                        - ..roomList.vertexResp.vertex@: []
                        - ..inMeetingRoom.edgeResp.edge@: []
                    - actionType: evalObject
                      object:
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =..formData.addressName
                                  string2: "All Locations"
                            # All Locations begin
                            - actionType: evalObject
                              object:
                                - =.builtIn.array.selectOneToArr:
                                    dataIn:
                                      arr: =.Global.locationAll
                                      key: "id"
                                    dataOut: ScheduleManagementRoom.formData.locIds
                                - =.builtIn.array.concat:
                                    dataIn:
                                      array1: =..formData.allId
                                      array2: =..formData.locIds
                                    dataOut: ScheduleManagementRoom.formData.allId # store locIds                          
                                - ..roomList.vertexIn.id@: =..formData.allId # get all rooms behind all locIds
                            # All Locations end
                            # One Location begin
                            - actionType: evalObject
                              object:
                                - =.builtIn.array.matchInArray:
                                    dataIn:
                                      arr: =.Global.locationAll
                                      value: =..formData.addressName
                                      key: medicalFacilityName
                                      key1: "id"
                                    dataOut: ScheduleManagementRoom.formData.locId # locId is a value
                                - =.builtIn.array.add:
                                    dataIn:
                                      object: =..formData.allId
                                      value: =..formData.locId # store locId
                                - ..roomList.vertexIn.id@: =..formData.allId # locId should be an array
                                # - ..roomList.vertexIn.id@: "jg+RvG+bQUggC0NCgM6IAA=="
                                # One Location end
                        - =..roomList.vertexAPI.get: ""
                        # CHANGE ROOM SELECT OPTIONS
                        - if:
                            - =..roomList.vertexResp.vertex.0
                            - actionType: evalObject
                              object:
                                - =.builtIn.object.extractArray:
                                    dataIn:
                                      obj: =..roomList.vertexResp.vertex
                                      arr:
                                        - id
                                        - name.basicInfo.roomName
                                        - name.basicInfo.service
                                    dataOut: ScheduleManagementRoom.formData.roomInfo
                                - =.builtIn.array.selectOneToArr:
                                    dataIn:
                                      arr: =..formData.roomInfo
                                      key: "roomName"
                                    dataOut: ScheduleManagementRoom.formData.roomRequestName
                                - =.builtIn.array.push:
                                    dataIn:
                                      messages: =..formData.roomRequestName
                                      newMessage: "All Rooms"
                                    dataOut: ScheduleManagementRoom.formData.roomRequestName
                                - ..formData.roomSelect@: =..formData.roomRequestName
                                # GET ALL ROOMS ID
                                - =.builtIn.array.selectOneToArr:
                                    dataIn:
                                      arr: =..roomList.vertexResp.vertex
                                      key: "id"
                                    dataOut: ScheduleManagementRoom.formData.roomIds # 获取所有的roomIds                                          
                            - actionType: evalObject
                              object:
                                - ..formData.roomName@: "All Rooms"
                                - ..formData.roomSelect@: [ "All Rooms" ]                                     
                        # concat locId + roomIds
                        - =.builtIn.array.concat:
                            dataIn:
                              array1: =..formData.allId
                              array2: =..formData.roomIds
                            dataOut: ScheduleManagementRoom.formData.allId # store locId + roomIds                          
                        - ..inMeetingRoom.edge.id@: =..formData.allId
                        - =..inMeetingRoom.edgeAPI.get: ""
                        - ..formData.allAppointmentRoom@: =..inMeetingRoom.edgeResp.edge
                        - =.builtIn.object.extractArray:
                            dataIn:
                              obj: =..inMeetingRoom.edgeResp.edge
                              arr:
                                - stime
                                - etime
                                - name.visitReason
                                - name.patientName
                                - name.visitType
                                - id
                                - name.duration
                                - tage
                                - subtype
                            dataOut: ScheduleManagementRoom.formData.timeTable.chartData
                    # 切换则置为 New Request
                    - actionType: evalObject
                      object:
                        - ..formDataTemp.appointmentTitleData.0@: =..formDataTemp.appointmentTitleNew
                        - ..formDataTemp.appointmentTitleData.1@: =..formDataTemp.appointmentTitleCheck
                        - ..formData.appointmentLengthLabel@: "New Appointment"
                        - ..formData.isDisplayAllAppointment@: block
                        - ..formData.isDisplayCheckedInAppointment@: none
                        - ..formData.appointment@: =..formData.allAppointmentRoom

                        - =.builtIn.array.arrTageTypeIsValid:
                            dataIn:
                              docs: =..formData.appointment
                              local: 9
                              binary: 1
                            dataOut: ScheduleManagementRoom.formData.filterAppointment
                        - =.builtIn.array.arrTageTypeIsValid:
                            dataIn:
                              docs: =..formData.filterAppointment
                              local: 4
                              binary: 1
                            dataOut: ScheduleManagementRoom.formData.filterAppointment
                        - ..formData.appointment@: =..formData.filterAppointment

                        - =.builtIn.array.getListLength:
                            dataIn:
                              object: =..formData.appointment
                            dataOut: ScheduleManagementRoom.formData.appointmentLength
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: appointmentTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: calenderTableView
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: appointmentLengthTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: roomReqView
                # FOR SELECT ROOM
                - .Scselect1:
                  dataKey: formData.roomName
                  viewTag: roomReqView
                  options: ..formData.roomSelect
                  onChange:
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        # - ..formData.roomName@: "All Rooms"
                        - ..formData.allAppointmentRoom@: []
                        - ..formData.roomIds@: []                             
                        # - ..formData.locId@: []
                        - ..formData.allId@: []
                        - ..inMeetingRoom.edgeResp.edge@: []
                          # - =.builtIn.array.add: 
                          #     dataIn: 
                          #       object: =..formData.allId
                          #       value: =..formData.locId                          # store locId
                          # store locId                                                      
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =..formData.roomName
                                  string2: "All Rooms"
                            # All Rooms begin
                            - actionType: evalObject
                              object:
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..formData.addressName
                                          string2: "All Locations"
                                    - =.builtIn.array.selectOneToArr:
                                        dataIn:
                                          arr: =.Global.locationAll
                                          key: "id"
                                        dataOut: ScheduleManagementRoom.formData.locIds
                                    - actionType: evalObject
                                      object:
                                        - ..formData.locIds@: []
                                        - =.builtIn.array.add:
                                            dataIn:
                                              object: =..formData.locIds # 更新为单个location
                                              value: =..formData.locId
                                - ..roomList.vertexIn.id@: =..formData.locIds
                                - =..roomList.vertexAPI.get: ""
                                - =.builtIn.array.selectOneToArr:
                                    dataIn:
                                      arr: =..roomList.vertexResp.vertex
                                      key: "id"
                                    dataOut: ScheduleManagementRoom.formData.roomIds # 更新为all rooms                                    
                            # All Rooms end
                            # One Rooms begin
                            - actionType: evalObject
                              object:
                                - =.builtIn.array.matchInArray:
                                    dataIn:
                                      arr: =..formData.roomInfo
                                      value: =..formData.roomName
                                      key: roomName
                                      key1: "id"
                                    dataOut: ScheduleManagementRoom.formData.roomId
                                - ..formData.roomIds@: []
                                # concat locId + roomIds
                                - =.builtIn.array.add:
                                    dataIn:
                                      object: =..formData.roomIds # 更新为单个room
                                      value: =..formData.roomId
                            # One Rooms end

                            # concat locId + roomIds
                        - =.builtIn.array.concat:
                            dataIn:
                              array1: =..formData.locIds
                              array2: =..formData.roomIds
                            dataOut: ScheduleManagementRoom.formData.allId # store locIds + roomIds                          
                        - ..inMeetingRoom.edge.id@: =..formData.allId
                        - =..inMeetingRoom.edgeAPI.get: ""
                        - ..formData.allAppointmentRoom@: =..inMeetingRoom.edgeResp.edge
                        - =.builtIn.object.extractArray:
                            dataIn:
                              obj: =..inMeetingRoom.edgeResp.edge
                              arr:
                                - stime
                                - etime
                                - name.visitReason
                                - name.patientName
                                - name.visitType
                                - id
                                - name.duration
                                - tage
                                - subtype
                            dataOut: ScheduleManagementRoom.formData.timeTable.chartData
                        - =.builtIn.array.getListLength:
                            dataIn:
                              object: =..formData.allAppointmentRoom
                            dataOut: ScheduleManagementRoom.formData.appointmentLength
                    # 切换则置为 New Request
                    - actionType: evalObject
                      object:
                        - ..formDataTemp.appointmentTitleData.0@: =..formDataTemp.appointmentTitleNew
                        - ..formDataTemp.appointmentTitleData.1@: =..formDataTemp.appointmentTitleCheck
                        - ..formData.appointmentLengthLabel@: "New Appointment"
                        - ..formData.isDisplayAllAppointment@: block
                        - ..formData.isDisplayCheckedInAppointment@: none
                        - ..formData.appointment@: =..formData.allAppointmentRoom

                        - =.builtIn.array.arrTageTypeIsValid:
                            dataIn:
                              docs: =..formData.appointment
                              local: 9
                              binary: 1
                            dataOut: ScheduleManagementRoom.formData.filterAppointment
                        - =.builtIn.array.arrTageTypeIsValid:
                            dataIn:
                              docs: =..formData.filterAppointment
                              local: 4
                              binary: 1
                            dataOut: ScheduleManagementRoom.formData.filterAppointment
                        - ..formData.appointment@: =..formData.filterAppointment

                        - =.builtIn.array.getListLength:
                            dataIn:
                              object: =..formData.appointment
                            dataOut: ScheduleManagementRoom.formData.appointmentLength
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: appointmentTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: calenderTableView
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: appointmentLengthTag
                  style:
                    left: "0.17"
                    top: "0"
            - type: view
              style:
                left: "0.69"
                top: "0.08"
                width: '0.11'
                height: '0.04'
                borderRadius: "5"
                boxSizing: border-box
                backgroundColor: "0x0b4a7e"
                textAlign:
                  y: center
                  x: center
              children:
                - type: image
                  path: addCircle.svg
                  style:
                    width: "0.012"
                - type: label
                  text: Add Appointment
                  dataKey:
                  style:
                    marginLeft: "0.005"
                    fontSize: .Nfont.nf2
                    fontFamily: "Roboto"
                    color: "0xffffff"
              onClick:
                - actionType: evalObject
                  object:
                    - ..formData.nextBtnColor@: "0xd3dde9"
                - actionType: builtIn
                  funcName: redraw
                  viewTag: btnView
                - actionType: popUp
                  popUpView: create1

            - type: view
              style:
                left: "0.69"
                top: '0.02'
                width: '0.11'
                height: '0.04'
                border:
                  style: "3"
                borderColor: "0x2960a4"
                borderRadius: "5"
                boxSizing: border-box
                textAlign:
                  y: center
                  x: center
              children:
                - type: image
                  path: setting.svg
                  style:
                    width: "0.012"
                - type: label
                  text: 'Room Management'
                  onClick:
                    - goto: RoomManagement
                  style:
                    marginLeft: "0.005"
                    fontSize: .Nfont.nf2
                    fontFamily: "Roboto"
                    color: "0x2888e6"
        - type: view
          viewTag: appointmentTag
          style:
            left: "0.18"
            width: "0.22"
            height: "0.83"
            top: "0.149"
            # backgroundColor: "0xffffff"
          children:
            - type: view
              style:
                top: "0"
                width: "0.22"
                height: "0.12"
                left: "0"
                backgroundColor: "0xffffff"
              children:
                - type: label
                  text: "Room Appointments"
                  style:
                    left: "0"
                    width: "0.22"
                    height: "0.04"
                    top: "0.02"
                    textAlign:
                      x: center
                    fontSize: .Nfont.nf4
                    fontWeight: "500"
                    fontFamily: "Popins"
                - type: label
                  viewTag: appointmentLengthTag
                  dataKey: formData.appointmentLength
                  style:
                    left: "0"
                    width: "0.22"
                    height: "0.04"
                    top: "0.065"
                    textAlign:
                      x: center
                    fontWeight: "600"
                    fontSize: "3vh"
                    color: "0x30b354"
                    fontFamily: "Popins"
            - type: view
              style:
                width: '0.22'
                height: '0.7'
                left: '0'
                top: "0.13"
                backgroundColor: "0xffffff"
              children:
                - type: view
                  style:
                    width: '0.22'
                    # height: '0.08'
                    left: '0'
                    marginTop: "0"
                    backgroundColor: "0xffffff"
                  viewTag: appointmentLengthTag
                  children:
                    - type: list
                      contentType: listObject
                      listObject: ..formDataTemp.appointmentTitleData
                      iteratorVar: itemObject
                      style:
                        width: '0.18'
                        margin: '0'
                        left: '0.02'
                        height: "0.045"
                        axis: horizontal
                        display: flex
                        alignItems: center
                        justifyContent: space-evenly
                        border:
                          style: "2"
                        borderColor: "0xf2f2f2"
                        borderWidth: "2"
                      children:
                        - type: listItem
                          itemObject:
                          style:
                            width: '0.08'
                            height: "0.045"
                            marginTop: ''
                          onClick:
                            - emit:
                                dataKey:
                                  var: itemObject
                                actions:
                                  - ..formData.appointmentTitle@: $var.title
                                  - =.builtIn.object.setProperty:
                                      dataIn:
                                        obj: =..formDataTemp.appointmentTitleData
                                        label: "title"
                                        text: $var.title
                                        arr: [ "fontColor", "fontWeight", "bdColor" ]
                                        valueArr: [ "0x005795", "600", "0x005795" ]
                                        errorArr: [ "0x000000", "500", "0xf2f2f2" ]
                            - actionType: evalObject
                              object:
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..formData.appointmentTitle
                                          string2: "New Request"
                                    - actionType: evalObject
                                      object:
                                        - ..formData.appointment@: =..formData.filterAppointment
                                        - ..formData.appointmentLengthLabel@: "New Appointment"
                                        - ..formData.isDisplayAllAppointment@: block
                                        - ..formData.isDisplayCheckedInAppointment@: none
                                    - actionType: evalObject
                                      object:
                                        # - =.builtIn.array.filterArrayByPath:
                                        #     dataIn:
                                        #       objArr: =..formData.allAppointmentRoom
                                        #       path: tage
                                        #       compareStr: [11]
                                        #     dataOut: ScheduleManagementRoom.formData.checkedInAppointment  
                                        - =.builtIn.array.arrTageTypeIsValid:
                                            dataIn:
                                              docs: =..formData.allAppointmentRoom
                                              local: 4
                                              binary: 1
                                            dataOut: ScheduleManagementRoom.formData.noCheckedInAppointment
                                        - =.builtIn.array.removeByArray:
                                            dataIn:
                                              parentObject: =..formData.allAppointmentRoom
                                              subObject: =..formData.noCheckedInAppointment
                                              key: "id"
                                            dataOut: ScheduleManagementRoom.formData.checkedInAppointment
                                        - =.builtIn.array.arrTageTypeIsValid:
                                            dataIn:
                                              docs: =..formData.checkedInAppointment
                                              local: 9
                                              binary: 1
                                            dataOut: ScheduleManagementRoom.formData.appointmentTemp

                                        # - =.builtIn.array.removeByArray: 
                                        #     dataIn:
                                        #       parentObject: =..formData.checkedInAppointment
                                        #       subObject: =..formData.appointmentTemp  
                                        #       key: "id"
                                        #     dataOut: ScheduleManagementRoom.formData.checkedInAppointment                          
                                        - ..formData.appointment@: =..formData.appointmentTemp
                                        - ..formData.appointmentLengthLabel@: "Checked in"
                                        - ..formData.isDisplayAllAppointment@: none
                                        - ..formData.isDisplayCheckedInAppointment@: block
                                - =.builtIn.array.getListLength:
                                    dataIn:
                                      object: =..formData.appointment
                                    dataOut: ScheduleManagementRoom.formData.appointmentLength
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: appointmentLengthTag
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: allAppointTag
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: checkedInAppointTag
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: appointmentViewTag
                          children:
                            - type: label
                              dataKey: itemObject.title
                              style:
                                width: "0.08"
                                fontSize: .Nfont.nf4
                                lineHeight: "4.5vh"
                                display: inline-block
                                fontFamily: "Roboto"
                                border:
                                  style: "2"
                                borderColor: itemObject.bdColor
                                color: itemObject.fontColor
                                fontWeight: itemObject.fontWeight
                                textAlign:
                                  x: center
                    - type: view
                      viewTag: allAppointTag
                      style:
                        marginTop: "0.01"
                        width: "0.22"
                        # height: "0.035"
                        display: ..formData.isDisplayAllAppointment
                        textAlign:
                          y: center
                      children:
                        - type: label
                          dataKey: formData.appointmentLength
                          style:
                            marginLeft: "0.027"
                            color: '0x0063A8'
                            fontSize: .Nfont.nf2
                            display: inline-block
                        - type: label
                          text: New Appointment
                          style:
                            color: '0x0063A8'
                            marginLeft: "0.008"
                            fontSize: .Nfont.nf2
                            display: inline-block
                        - type: label
                          text: View Appointment Overview
                          dataKey:
                          style:
                            textDecoration: underline
                            color: "0x2988e6"
                            fontSize: .Nfont.nf3
                            fontWeight: "600"
                            left: "0.028"
                            width: "0.2"
                          onClick:
                            - actionType: evalObject
                              object:
                                - goto: AppointmentOverviewRoom
                    - type: view
                      viewTag: checkedInAppointTag
                      style:
                        marginTop: "0.01"
                        width: "0.22"
                        # height: "0.02"
                        display: ..formData.isDisplayCheckedInAppointment
                      children:
                        - type: label
                          dataKey: formData.appointmentLength
                          style:
                            marginLeft: "0.027"
                            color: '0x0063A8'
                            fontSize: .Nfont.nf2
                            display: inline-block
                        - type: label
                          dataKey: formData.appointmentLengthLabel
                          style:
                            color: '0x0063A8'
                            marginLeft: "0.008"
                            fontSize: .Nfont.nf2
                            display: inline-block
                        - type: label
                          text: View Appointment History
                          dataKey:
                          style:
                            textDecoration: underline
                            color: "0x2988e6"
                            fontSize: .Nfont.nf3
                            fontWeight: "600"
                            left: "0.028"
                            width: "0.11"
                          onClick:
                            - actionType: evalObject
                              object:
                                - goto: AppointmentOverviewRoom
                    # - .Label1:
                    #   text: New Appointment
                    #   style:
                    #     left: '0.01'
                    #     fontSize: .Nfont.nf5
                    #     top: '0.015'
                    # - .Label1:
                    #   dataKey: formData.appointmentLength
                    #   style:
                    #     left: '0.01'
                    #     color: '#0063A8'
                    #     top: '0.05'
                    # - .Label1:
                    #   text: pending request
                    #   style:
                    #     left: '0.02'
                    #     color: '#0063A8'
                    #     fontSize: "14"
                    #     top: '0.05'
                    # Appointment Lobby
                - type: scrollView
                  viewTag: appointmentViewTag
                  style:
                    width: "0.22"
                    left: "0"
                    marginTop: "0"
                    height: "0.6"
                    overflow: scroll
                    backgroundColor: "0xffffff"
                  children:
                    - .BaseList: # viewTag: appointmentTag

                      listObject: ..formData.appointment
                      style:
                        width: '0.22'
                        left: '0'
                        height: 'auto'
                        # top: '0.22'
                        top: "0"
                        margin: "0"
                        # position: fixed
                      children:
                        - .BaseListItem:
                          onClick:
                            - emit:
                                dataKey:
                                  var: itemObject
                                actions:
                                  - .Global.formData.patientHistoryInfo.id@: $var.id
                                  - .Global.formData.appointment@: $var
                                  - if:
                                      - =.builtIn.number.typeIsValid:
                                          dataIn:
                                            docType: $var.tage
                                            localArr: [ 9 ]
                                            binaryArr: [ 1 ]
                                      - goto: PatientVisitHistoryRoom
                                      - goto: PatientSummaryRoom
                          style:
                            width: '0.2'
                            left: '0.01'
                            height: '0.13'
                            marginTop: "0.01"
                            display: inline-block
                            backgroundColor: '0xf4f8fa'
                            borderRadius: '10'
                            overflow: hidden
                          children:
                            - type: view
                              style:
                                width: "0.05"
                                height: "0.1"
                                # backgroundColor: "0xff000033"
                              children:
                                - type: image
                                  path: roomProfile.svg
                                  # dataKey: itemObject.name.patientAvatarId
                                  # path=func: .builtIn.util.prepareDocToPath
                                  style:
                                    left: "0.008"
                                    top: "0.02"
                                    width: "0.034"
                                    height: "0.064"
                            - type: view
                              style:
                                left: '0.05'
                                width: "0.14"
                                height: "0.03"
                                top: "0.02"
                              children:
                                - .Label1:
                                  dataKey: itemObject.name.roomName
                                  text: Sevice Room
                                  style:
                                    fontSize: .Nfont.nf4
                                    fontWeight: "600"
                                    color: "#143459"
                                    textDecoration: underline
                                    display: inline-block

                            # Reason 
                            - type: label
                              text:
                              dataKey: itemObject.name.visitType
                              style:
                                left: "0.05"
                                top: "0.05"
                                fontSize: .Nfont.nf2
                            ##     
                            - type: view
                              style:
                                width: "0.2"
                                height: "0.03"
                                top: "0.095"
                                left: "0"
                              children:
                                - type: view
                                  style:
                                    marginLeft: "0.005"
                                    width: "0.06"
                                    display: inline-block
                                    borderRight: "1px solid #999999"
                                  children:
                                    - type: image
                                      path: schedule.svg
                                      style:
                                        width: '0.01'
                                        marginLeft: "0.003"
                                        display: inline-block
                                    - .Label1:
                                      text=func: .builtIn.string.formatUnixtimeL_en
                                      dataKey: itemObject.stime
                                      style:
                                        marginLeft: '0.003'
                                        color: '#000000'
                                        fontSize: .Nfont.nf2
                                        display: inline-block
                                # - type: view
                                #   style:
                                #     marginLeft: "0.005"
                                #     width: "0.0008"
                                #     height: "0.025"
                                #     backgroundColor: "#999999"
                                #     display: inline-block

                                - type: view
                                  style:
                                    marginLeft: "0.003"
                                    width: "0.053"
                                    display: inline-block
                                    borderRight: "1px solid #999999"
                                  children:
                                    - type: image
                                      path: history.svg
                                      style:
                                        width: '0.01'
                                        marginLeft: "0.003"
                                        display: inline-block
                                    - .Label1:
                                      text=func: .builtIn.string.formatUnixtimeLT_en
                                      dataKey: itemObject.stime
                                      style:
                                        marginLeft: '0.003'
                                        color: '#000000'
                                        fontSize: .Nfont.nf2
                                        display: inline-block
                                # - type: view
                                #   style:
                                #     marginLeft: "0.005"
                                #     width: "0.0008"
                                #     height: "0.025"
                                #     backgroundColor: "#999999"
                                #     display: inline-block
                                - type: view
                                  style:
                                    marginLeft: "0.003"
                                    width: "0.072"
                                    display: inline-block
                                    # borderRight: "1px solid #999999"
                                  children:
                                    - type: image
                                      path: doctor.svg
                                      style:
                                        width: '0.01'
                                        marginLeft: "0.003"
                                        display: inline-block
                                    - type: label
                                      dataKey: itemObject.name.patientName
                                      style:
                                        marginLeft: '0.003'
                                        width: "0.054"
                                        color: '#000000'
                                        fontSize: .Nfont.nf2
                                        display: inline-block
                                        overflow: hidden
                                        textOverflow: ellipsis
                                        whiteSpace: nowrap
        - type: scrollView
          style:
            width: '0.55'
            height: '0.78'
            top: '0.2'
            left: '0.41'
            backgroundColor: "0xffffff"
            overflowY: scroll
          children:
            - type: chart
              dataKey: formData.timeTable
              viewTag: calenderTableView
              onClick:
                - actionType: evalObject
                  object:
                    - .Global.formData.patientHistoryInfo.id@: =..formData.timeTable.response
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..formData.timeTable.response
                              string2: ""
                        - continue
                        - actionType: evalObject
                          object:
                            - =.builtIn.array.getObjectByArray:
                                dataIn:
                                  array: =..inMeetingRoom.edgeResp.edge
                                  key: id
                                  value: =..formData.timeTable.response
                                dataOut: Global.formData.appointment
                            - if:
                                - =.builtIn.number.typeIsValid:
                                    dataIn:
                                      docType: =.Global.formData.appointment.tage
                                      localArr: [ 9 ]
                                      binaryArr: [ 1 ]
                                - goto: PatientVisitHistoryRoom
                                - goto: PatientSummaryRoom

              style:
                width: "0.55"
                height: "0.7"
                left: "0"
                top: "0"
        - .BasePopUp:
          viewTag: Contacts
          style:
            zIndex: "1000"
          children:
            - .PopUphead:
              style:
                left: "0.6"
              children:
                - .CreateLabel:
                  text: 'Invite'
                - .Closebutton:
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: Contacts
            - type: view
              style:
                height: '0.92'
                width: '0.4'
                left: "0.6"
                top: '0.08'
                backgroundColor: '0xffffff'
              viewTag: ContactsTag
              children:
                - type: view
                  style:
                    left: "0.03"
                    width: "0.34"
                    top: "0.02"
                    height: "0.04"
                    border:
                      style: "3"
                    borderWidth: "1"
                    borderColor: "0xbbbbbb"
                    borderRadius: "10"
                  children:
                    - type: textField
                      placeholder: Search
                      style:
                        left: "0.007"
                        width: "0.2"
                        top: "0"
                        height: "0.038"
                        fontSize: .Nfont.nf2
                        border:
                          style: "1"
                    - type: button
                      text: Search
                      style:
                        left: "0.28"
                        width: "0.06"
                        height: "0.04"
                        fontSize: .Nfont.nf2
                        color: "0xffffff"
                        backgroundColor: "0x2988e6"
                        border:
                          style: "3"
                        borderWidth: "1"
                        borderColor: "0x2988e6"
                        borderRadius: "10"
                - type: label
                  text: Patient List
                  style:
                    left: "0.03"
                    width: "0.34"
                    top: "0.08"
                    height: "0.04"
                    fontSize: .Nfont.nf4
                    fontFamily: sans-serif
                    fontWeight: "500"
                    textAlign:
                      y: center
                - type: scrollView
                  style:
                    width: '0.36'
                    height: '0.78'
                    top: '0.12'
                    left: '0.02'
                    overflow: scroll
                  children:
                    - .BaseList:
                      listObject: ..formData.parseProfile
                      style:
                        width: '0.36'
                        height: "auto"
                        display: flex
                        margin: "0"
                      children:
                        - .BaseListItem:
                          style:
                            height: '0.05'
                            width: '0.36'
                            display: inline-block
                            border:
                              style: "2"
                            borderWidth: "1"
                            borderColor: "0xbbbbbb"
                          onClick:
                            - emit:
                                dataKey:
                                  var: itemObject
                                actions:
                                  - ..newAppointment.edge.evid@: $var.bsig
                                  - ..newAppointment.edge.name.patientName@: $var.name.data.basicInfo.fullName
                                  - ..newAppointment.edge.name.patientPhoneNumber@: $var.name.data.basicInfo.phone
                                  # - ..invite.edge.bvid@: =.Global.currentFacility.id
                                  - ..invite.edge.name.phoneNumber@: $var.name.data.basicInfo.phone
                                  - =.builtIn.string.concat:
                                      dataIn:
                                        - $var.name.data.basicInfo.fullName
                                        - "-"
                                        - =.ScheduleManagementRoom.selectData.reason
                                      dataOut: ScheduleManagementRoom.newAppointment.edge.name.visitReason
                            - actionType: popUpDismiss
                              popUpView: Contacts
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: Detials
                            - actionType: popUp
                              popUpView: Detials
                          children:
                            - .Label1:
                              dataKey: itemObject.name.data.basicInfo.fullName
                              style:
                                height: '0.05'
                                width: "0.2"
                                textAlign:
                                  y: center
                                left: '0.04'
                                fontSize: .Nfont.nf1
                            - .Label1:
                              text=func: .builtIn.string.formatUnixtimeL_en
                              dataKey: itemObject.ctime
                              # dataKey: 'itemObject.time'
                              style:
                                top: "0"
                                height: '0.05'
                                textAlign:
                                  y: center
                                left: '0.25'
                                fontSize: .Nfont.nf1

        - type: view
          style:
            width: '1'
            height: '1'
            top: '0'
            left: '0'
            backgroundColor: '0x00000033'
            zIndex: "10"
            display: ..formData.createAppInfo
          viewTag: Detials
          children:
            - .PopupLightPromptRight:
              viewTag: noPatientTag
              msg: You don't add a patient
              style:
                zIndex: "20"
            - type: view
              style:
                top: "0"
                left: "0.6"
                width: "0.4"
                height: "1"
                # backgroundColor: "0xffffff"
                # zIndex: "1000"
              children:
                - .PopUphead:
                  children:
                    - .CreateLabel:
                    - .Closebutton:
                      onClick:
                        - actionType: evalObject
                          object:
                            - ..formData.createAppInfo@: "none"
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: Detials
                - type: view
                  style:
                    height: '0.92'
                    width: '0.4'
                    top: '0.08'
                    backgroundColor: '0xffffff'
                  children:
                    - type: view
                      style:
                        left: "0.05"
                        width: "0.3"
                        height: "0.355"
                      children:
                        - type: view
                          style:
                            width: "0.3"
                            height: "0.07"
                            margin: "0"
                          children:
                            - type: label
                              text: Appointment info
                              dataKey:
                              style:
                                width: "0.15"
                                display: inline-block
                                lineHeight: "4.1"
                                verticalAlign: middle
                                fontSize: .Nfont.nf4
                                fontFamily: "Arial"
                                color: "0x333333"
                                fontWeight: "600"
                            - type: view
                              onClick:
                                - actionType: popUpDismiss
                                  popUpView: Detials
                                - actionType: popUp
                                  popUpView: create1
                              style:
                                width: "0.15"
                                display: inline-block
                                height: "0.07"
                                lineHeight: "4.1"
                                verticalAlign: middle
                                textAlign:
                                  x: right
                              children:
                                - type: image
                                  path: editPenMainBlue.svg
                                  style:
                                    display: inline-block
                                    verticalAlign: middle
                                    width: "0.01"
                                - type: label
                                  text: Change Details
                                  dataKey:
                                  style:
                                    marginLeft: "0.005"
                                    display: inline-block
                                    verticalAlign: middle
                                    textDecoration: underline
                                    fontSize: .Nfont.nf2
                                    fontFamily: "Arial"
                                    color: "0x005795"
                                    fontWeight:
                        - type: view
                          style:
                            margin: "0"
                            height: "0.285"
                            width: "0.3"
                            backgroundColor: "0xf4f4f4"
                          children:
                            - .AppDetailView:
                              children:
                                - .AppDetailKey:
                                  text: Date
                                - .AppDetailValue:
                                  dataKey: newAppointment.edge.stime
                                  text=func: .builtIn.string.formatUnixtimeL_en
                            - .AppDetailView:
                              children:
                                - .AppDetailKey:
                                  text: Time
                                - .AppDetailValue:
                                  dataKey: newAppointment.edge
                                  text=func: .builtIn.date.ShowTimeSpan
                            - .AppDetailView:
                              children:
                                - .AppDetailKey:
                                  text: Service Type
                                - .AppDetailValue:
                                  dataKey: newAppointment.edge.name.visitType
                            - .AppDetailView:
                              children:
                                - .AppDetailKey:
                                  text: Reason for visit
                                - .AppDetailValue:
                                  dataKey: newAppointment.edge.name.Reason
                            - .AppDetailView:
                              children:
                                - .AppDetailKey:
                                  text: Location
                                - .AppDetailValue:
                                  dataKey: newAppointment.edge.name.locationName
                            - .AppDetailView:
                              children:
                                - .AppDetailKey:
                                  text: Room
                                - .AppDetailValue:
                                  dataKey: newAppointment.edge.name.roomName
                            - .AppDetailView:
                              children:
                                - .AppDetailKey:
                                  text: Fee
                                - .AppDetailValue:
                                  dataKey: newAppointment.edge.name.fee
                                  text=func: .builtIn.string.dollarFormat
                    - type: view
                      style:
                        height: '0.4'
                        width: '0.35'
                        marginTop: '0.03'
                        left: '0.05'
                      children:
                        - type: view
                          style:
                            display: flex
                            width: '0.3'
                            justifyContent: space-between
                            alignItems: center
                          children:
                            - type: label
                              text: Add Patient
                              style:
                                fontSize: .Nfont.nf4
                                fontFamily: "Arial"
                                color: "0x333333"
                                fontWeight: "600"
                                width: '0.2'
                        - type: view
                          style:
                            width: "0.3"
                            height: "0.05"
                            marginTop: "0.02"
                          children:
                            - type: view
                              style:
                                display: inline-block
                                verticalAlign: middle
                                width: "0.23"
                                height: "0.04"
                                boxSizing: border-box
                                border:
                                  style: "3"
                                borderWidth: "1"
                                borderColor: "0xDEDEDE"
                                borderRadius: "4"
                              children:
                                - type: image
                                  path: searchGray.svg
                                  style:
                                    width: "0.01"
                                    display: "inline-block"
                                    verticalAlign: middle
                                    lineHeight: "2.6"
                                    marginLeft: "0.01"
                                - type: textField
                                  placeholder: Search patient
                                  dataKey: formData.patientPhone
                                  style:
                                    border:
                                      style: "1"
                                    marginLeft: "0.005"
                                    display: inline-block
                                    verticalAlign: middle
                                    lineHeight: "2.6"
                            - type: button
                              text: Search
                              onClick:
                                - actionType: evalObject
                                  object:
                                    - ..formData.parseProfile@: []
                                    - =.builtIn.string.concat:
                                        dataIn:
                                          - "V.uid like"
                                          - " '%"
                                          - =..formData.patientPhone
                                          - "%"
                                          - "' AND E.type=10002 AND V.type=1"
                                        dataOut: ScheduleManagementRoom.apiRequest.getPatientByPhone.docIn.sCondition
                                    - =..apiRequest.getPatientByPhone.docAPI.get: ""
                                    - =.builtIn.array.keepLatestDoc:
                                        dataIn:
                                          docList: =..apiRequest.getPatientByPhone.docResp.doc
                                          path: bsig
                                        dataOut: ScheduleManagementRoom.apiRequest.getPatientByPhone.docResp.doc
                                    - if:
                                        - =..apiRequest.getPatientByPhone.docResp.doc
                                        - =.builtIn.array.formatProfile:
                                            dataIn:
                                              objArr: =..apiRequest.getPatientByPhone.docResp.doc
                                            dataOut: ScheduleManagementRoom.formData.parseProfile
                                        - continue
                                    - ..newAppointment.edge.evid@: =..formData.parseProfile.0.bsig
                                    - ..newAppointment.edge.name.patientName@: =..formData.parseProfile.0.name.data.basicInfo.fullName
                                    - ..newAppointment.edge.name.patientPhoneNumber@: =..formData.parseProfile.0.name.data.basicInfo.phone
                                    # - ..invite.edge.bvid@: =.Global.currentFacility.id
                                    - ..invite.edge.name.phoneNumber@: =..formData.parseProfile.0.name.data.basicInfo.phone
                                    - =.builtIn.string.concat:
                                        dataIn:
                                          - =..formData.parseProfile.0.name.data.basicInfo.fullName
                                          - "-"
                                          - =.ScheduleManagementRoom.selectData.reason
                                        dataOut: ScheduleManagementRoom.newAppointment.edge.name.visitReason # - ..formData.currentPatient.patientName@: =..apiRequest.getPatientByPhone.docResp.doc.0.name.data.basic
                                    # - ..formData.currentPatient.patientPhoneNumber@: =..apiRequest.getPatientByPhone.docResp.doc.0.name.phoneNumber
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: patientInfoTag
                              style:
                                marginLeft: "0.01"
                                width: "0.06"
                                display: inline-block
                                verticalAlign: middle
                                lineHeight: "2.7"
                                color: "0xffffff"
                                fontSize: .Nfont.nf3
                                fontFamily: "Arial"
                                fontWeight: "500"
                                backgroundColor: "0x005795"
                                border: none
                                borderRadius: "4"
                                textAlign:
                                  x: center
                                  y: center
                        - type: view
                          viewTag: patientInfoTag
                          style:
                            width: "0.3"
                            height: "0.1"
                            marginTop: "0.02"
                            backgroundColor: "0xF4F4F4"
                            border:
                              style: "3"
                            borderWidth: "1"
                            borderColor: "0xF4F4F4"
                          children:
                            - .AppDetailView:
                              style:
                                marginTop: "0.01"

                              children:
                                - .AppDetailKey:
                                  text: Patient name
                                - .AppDetailValue:
                                  dataKey: newAppointment.edge.name.patientName
                                  style:
                                    width: "0.1"
                                - .AppDetailValue:
                                  text: View
                                  onClick:
                                    - actionType: evalObject
                                      object:
                                        - if:
                                            - =.builtIn.string.equal:
                                                dataIn:
                                                  string1: =..newAppointment.edge.name.patientName
                                                  string2: ""
                                            - actionType: popUp
                                              popUpView: noPatientTag
                                              wait: true
                                              popUpDismiss: 2000
                                            - continue
                                        - .Global.formData.createAppStatusRoom@: true
                                        - .Global.formData.newAppointmentRoom@: =..newAppointment.edge
                                        - .Global.formData.patientInfo@: =..apiRequest.getPatientByPhone.docResp.doc.0
                                        - goto: PatientProfile
                                  style:
                                    color: "0x005795"
                                    width: "0.05"
                                    textDecoration: underline
                                    textAlign:
                                      x: center
                            - .AppDetailView:
                              children:
                                - .AppDetailKey:
                                  text: Phone Number
                                - .AppDetailValue:
                                  dataKey: newAppointment.edge.name.patientPhoneNumber
                    - type: button
                      text: "Create Appointment"
                      onClick:
                        - actionType: evalObject
                          object:
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..newAppointment.edge.name.patientName
                                      string2: ""
                                - actionType: popUp
                                  popUpView: noPatientTag
                                  wait: true
                                  popUpDismiss: 2000
                                - continue
                        - actionType: evalObject
                          object:
                            # 用facility 的jwt 创建预约，以及邀请，尽可能少切jwt
                            - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
                            - =.Global.jwt.edgeAPI.store: ""

                            - ..approveAppointment10.edge.bvid@: =..newAppointment.edge.bvid
                            - ..invite.edge.evid@: =..formData.roomSendId
                            - ..invite.edge.bvid@: =..formData.locationSendId
                            - =..newAppointment.edgeAPI.store: ""
                            # create financial Doc 
                            - ..apiRequest.financialInfo.docStoreReq.eid@: =..newAppointment.response.edge.id
                            - ..apiRequest.financialInfo.docStoreReq.reid@: =..newAppointment.response.edge.id
                            - =..apiRequest.financialInfo.docAPI.get: ""
                            # 预约的自动同意（ ce: E5）
                            - ..apiRequest.autoApprove.edge.evid@: =..newAppointment.response.edge.evid
                            - ..apiRequest.autoApprove.edge.refid@: =..newAppointment.response.edge.id
                            - ..apiRequest.autoApprove.edge.stime@: =..newAppointment.response.edge.stime
                            - ..apiRequest.autoApprove.edge.etime@: =..newAppointment.response.edge.etime
                            - =..apiRequest.autoApprove.edgeAPI.store: ""
                            # 邀请room(ce: E10)
                            - ..apiRequest.inviteParticipant.edge.evid@: =..formData.roomSendId
                            - ..apiRequest.inviteParticipant.edge.refid@: =..newAppointment.response.edge.id
                            - ..apiRequest.inviteParticipant.edge.stime@: =..newAppointment.response.edge.stime
                            - ..apiRequest.inviteParticipant.edge.etime@: =..newAppointment.response.edge.etime
                            - ..apiRequest.inviteParticipant.edge.name.roleName@: =..newAppointment.response.edge.name.roomName
                            - ..apiRequest.inviteParticipant.edge.name.role@: "Room"
                            - =..apiRequest.inviteParticipant.edgeAPI.store: ""
                            # 邀请Location(ce: E10)
                            # - ..apiRequest.inviteParticipant.edge.evid@: =..formData.locationSendId
                            # - ..apiRequest.inviteParticipant.edge.refid@: =..newAppointment.response.edge.id
                            # - ..apiRequest.inviteParticipant.edge.stime@: =..newAppointment.response.edge.stime
                            # - ..apiRequest.inviteParticipant.edge.etime@: =..newAppointment.response.edge.etime
                            # - ..apiRequest.inviteParticipant.edge.name.role@: "Location"
                            # - ..apiRequest.inviteParticipant.edge.name.roleName@: =..newAppointment.response.edge.name.locationName
                            # - =..apiRequest.inviteParticipant.edgeAPI.store: ""

                            # - ..invite.edge.refid@: =..newAppointment.response.edge.id
                            # - ..approveAppointment10.edge.refid@: =..newAppointment.response.edge.id
                            # - =..approveAppointment10.edgeAPI.store: ""
                            # - =..invite.edgeAPI.store: ""
                            - if:
                                - =..formData.parseProfile.0.id
                                - =.builtIn.ecos.shareDoc:
                                    dataIn:
                                      sourceDoc: =..formData.parseProfile.0
                                      targetEdgeID: =..newAppointment.response.edge.id
                                    dataOut: ScheduleManagementRoom.formData.patShareProfile
                                - continue
                            - ..apiRequest.patientHash.docQueryReq.id@: =..formData.parseProfile.0.id
                            - =..apiRequest.patientHash.docAPI.get: ""
                            - if:
                                - =..apiRequest.patientHash.docQueryResp.doc.0
                                - actionType: evalObject
                                  object:
                                    - ..apiRequest.patientHash.docStoreReq.name.data.hashCode@: =..apiRequest.patientHash.docQueryResp.doc.0.name.data.hashCode
                                    - ..apiRequest.patientHash.docStoreReq.name.data.hashTime@: =..apiRequest.patientHash.docQueryResp.doc.0.name.data.hashTime
                                    - ..apiRequest.patientHash.docStoreReq.eid@: =..newAppointment.response.edge.id
                                    - ..apiRequest.patientHash.docStoreReq.reid@: =..formData.patShareProfile.doc.id
                                    - =..apiRequest.patientHash.docAPI.store: ""
                                - continue
                            - ..formData.createAppInfo@: "none"
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: Detials
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: inviteSuccess
                        - actionType: popUp
                          popUpView: inviteSuccess
                      style:
                        left: "0.05"
                        height: "0.04"
                        top: "0.83"
                        width: "0.3"
                        fontSize: .Nfont.nf4
                        backgroundColor: "#005795"
                        boxSizing: border-box
                        borderRadius: "3"
                        border:
                          style: "6"
                        color: "#ffffff"
                        textAlign:
                          x: center

        - .BasePopUp:
          style:
            top: "0"
            left: "0"
            height: "1"
            width: "1"
            zIndex: "1000"
          viewTag: create1
          children:
            - .PopUphead:
              style:
                left: '0.6'
              children:
                - .CreateLabel:
                - .Closebutton:
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: create1

            - type: view
              style:
                height: '0.92'
                width: '0.4'
                top: '0.08'
                left: '0.6'
                backgroundColor: '0xffffff'
              viewTag: DataTag
              children:
                - type: label
                  text: Complete fields below
                  style:
                    left: '0.02'
                    top: '0.01'
                    fontSize: .Nfont.nf3
                    color: '#000000'
                - type: label
                  text: Select Location
                  style:
                    left: '0.06'
                    top: '0.07'
                    fontSize: .Nfont.nf1
                - type: select
                  options: ..formData.locationSendList
                  dataKey: formData.locationSend
                  onChange:
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - ..formData.reasonSendList@: [ "Select Reason" ]
                        - ..selectData.duration@: ""
                        - ..selectData.reason@: ""
                        - ..schedule.edge.id@: []
                        - ..splitTime@: []
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =..formData.locationSend
                                  string2: "Select Location"
                            - actionType: evalObject
                              object:
                                - ..formData.roomSendList@: [ "Select Room" ]
                                - ..formData.roomSend@: ""
                            - actionType: evalObject
                              object:
                                - ..getRooms.vertexResp.vertex@: []
                                - =.builtIn.array.matchInArray:
                                    dataIn:
                                      arr: =.Global.locationAll
                                      value: =..formData.locationSend
                                      key: medicalFacilityName
                                      key1: "id"
                                    dataOut: ScheduleManagementRoom.formData.locationSendId
                                - =.builtIn.array.matchInArray:
                                    dataIn:
                                      arr: =.Global.locationAll
                                      value: =..formData.locationSend
                                      key: medicalFacilityName
                                      key1: "location"
                                    dataOut: ScheduleManagementRoom.newAppointment.edge.name.location
                                - ..schedule.edge.id.1@: =..formData.locationSendId
                                #添加id
                                - ..apiRequest.getFirstAvail.edge.id.1@: =..formData.locationSendId
                                - ..newAppointment.edge.name.facilityId@: =.Global.currentFacility.id
                                # - ..newAppointment.edge.bvid@: =..formData.locationSendId
                                - ..getRooms.vertex.id@: =..formData.locationSendId
                                - =..getRooms.vertexAPI.get: ""
                                - if:
                                    - ..getRooms.vertexResp.vertex.0
                                    - actionType: evalObject
                                      object:
                                        - =.builtIn.object.extractArray:
                                            dataIn:
                                              obj: =..getRooms.vertexResp.vertex
                                              arr:
                                                - id
                                                - name.basicInfo.roomName
                                                - name.basicInfo.service
                                            dataOut: ScheduleManagementRoom.formData.roomSendInfo
                                        - =.builtIn.array.selectOneToArr:
                                            dataIn:
                                              arr: =..formData.roomSendInfo
                                              key: "roomName"
                                            dataOut: ScheduleManagementRoom.formData.roomSendList
                                        - =.builtIn.array.push:
                                            dataIn:
                                              messages: =..formData.roomSendList
                                              newMessage: "Select Room"
                                            dataOut: ScheduleManagementRoom.formData.roomSendList
                                    - ..formData.roomSendList@: [ "Select Room" ]
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: selectRoomTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: reasonTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: durationTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: splitTimeTag
                  style:
                    left: '0.06'
                    top: '0.1'
                    fontSize: .Nfont.nf1
                    borderColor: "#EAEAEA"
                    width: '0.08'
                    height: '0.046'
                    textIndent: 10px
                - type: label
                  text: Select Room
                  style:
                    left: '0.15'
                    top: '0.07'
                    fontSize: .Nfont.nf1
                    width: "0.1"
                - type: select
                  options: ..formData.roomSendList
                  dataKey: formData.roomSend
                  viewTag: selectRoomTag
                  onChange:
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - ..selectData.duration@: ""
                        - ..selectData.reason@: ""
                        - ..visitReason.docResp.0.doc.0.name.data.reasonForVisit.OfficeVisits@: []
                        # - ..schedule.edge.id@: []
                        - ..splitTime@: []
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =..formData.roomSend
                                  string2: "Select Room"
                            - continue
                            - actionType: evalObject
                              object:
                                - =.builtIn.array.matchInArray:
                                    dataIn:
                                      arr: =..formData.roomSendInfo
                                      value: =..formData.roomSend
                                      key: roomName
                                      key1: "service"
                                    dataOut: ScheduleManagementRoom.formData.roomSendService
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..formData.roomSendService
                                          string2: "COVID-19 Testing"
                                    - ..formData.roomSendServiceType@: "655361"
                                    - continue
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..formData.roomSendService
                                          string2: "COVID-19 Vaccine"
                                    - ..formData.roomSendServiceType@: "393217"
                                    - continue
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..formData.roomSendService
                                          string2: "Flu Shot"
                                    - ..formData.roomSendServiceType@: "786433"
                                    - continue
                                - =.builtIn.array.matchInArray:
                                    dataIn:
                                      arr: =..formData.roomSendInfo
                                      value: =..formData.roomSend
                                      key: roomName
                                      key1: "id"
                                    dataOut: ScheduleManagementRoom.formData.roomSendId
                                # - ..newAppointment.edge.bvid@: =..formData.roomSendId
                                - ..newAppointment.edge.name.visitType@: =..formData.roomSendService
                                - ..newAppointment.edge.name.visitTypeShow@: =..formData.roomSendService
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..newAppointment.edge.name.visitType
                                          string2: "COVID-19 Testing"
                                    - actionType: evalObject
                                      object:
                                        - ..newAppointment.edge.subtype@: "0xa0002"
                                        - ..newAppointment.edge.name.fontColor@: "0x388ecc"
                                        - ..newAppointment.edge.name.blockColor@: "0xdfecf7"
                                    - continue
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..newAppointment.edge.name.visitType
                                          string2: "COVID-19 Vaccine"
                                    - actionType: evalObject
                                      object:
                                        - ..newAppointment.edge.subtype@: "0x60002"
                                        - ..newAppointment.edge.name.fontColor@: "0xd81e06"
                                        - ..newAppointment.edge.name.blockColor@: "0xf8dbd7"
                                    - continue
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..newAppointment.edge.name.visitType
                                          string2: "Flu Shot"
                                    - actionType: evalObject
                                      object:
                                        - ..newAppointment.edge.subtype@: "0xc0002"
                                        - ..newAppointment.edge.name.fontColor@: "0x516a7a"
                                        - ..newAppointment.edge.name.blockColor@: "0xb4a6a5"
                                    - continue
                                - ..schedule.edge.id.0@: =..formData.roomSendId
                                #添加id
                                - ..apiRequest.getFirstAvail.edge.id.0@: =..formData.roomSendId
                                #获取前一天的时间戳
                                - =.builtIn.date.getTime:
                                    dataIn:
                                    dataOut: ScheduleManagementRoom.formData.nowTimeStamp
                                #获取当前时间的unix时间戳
                                - =.builtIn.date.getNowLocalUnixTime:
                                    dataIn: ""
                                    dataOut: ScheduleManagementRoom.formData.currentLocalTime
                                #设置可预约时间的scondition
                                - =.builtIn.string.concat:
                                    dataIn:
                                      - "(etime>"
                                      - =..formData.currentLocalTime
                                      - " OR "
                                      - "stime>="
                                      - =..formData.currentLocalTime
                                      - ")"
                                      - " AND "
                                      - "subtype="
                                      - =.Global.currentSubtype
                                    dataOut: Global.scheduleScondition2
                                - =.ScheduleManagementRoom.apiRequest.getFirstAvail.edgeAPI.get: ""
                                - if:
                                    - =..apiRequest.getFirstAvail.response.edge.0.id
                                    - actionType: evalObject
                                      object:
                                        #获取最近可预约时间，刷新BaseDate和calendar         
                                        - =.builtIn.date.stampToDay:
                                            dataIn:
                                              timeStamp: =..apiRequest.getFirstAvail.response.edge.0.stime
                                            dataOut: ScheduleManagementRoom.formData.adjacentEdgeTime
                                        - .BaseDate.calendarDate.year@: =.ScheduleManagementRoom.formData.adjacentEdgeTime.year
                                        - .BaseDate.calendarDate.month@: =.ScheduleManagementRoom.formData.adjacentEdgeTime.month
                                        - .BaseDate.calendarDate.day@: =.ScheduleManagementRoom.formData.adjacentEdgeTime.day
                                    - continue
                                - =.builtIn.date.ShowDateByNumber:
                                    dataIn:
                                      year: =.BaseDate.calendarDate.year
                                      month: =.BaseDate.calendarDate.month
                                      day: =.BaseDate.calendarDate.day
                                      formatType: "Y-M-D"
                                    dataOut: BaseDate.calendarDate.todayDate
                                - =.builtIn.date.miniWeeklyCalendarArray:
                                    dataIn:
                                      year: =.BaseDate.calendarDate.year
                                      month: =.BaseDate.calendarDate.month
                                      today: =.BaseDate.calendarDate.day
                                      markDay: =.BaseDate.calendarDate.day
                                      color: "0x000000"
                                      backgroundColor: "0xFFFFFF6f"
                                      todayColor: "0xffffff"
                                      todayBackgroundColor: "0x2988E6"
                                    dataOut: BaseDate.calendarDate.minidayLable
                                - ..visitReason.docIn.id@: =..formData.roomSendId
                                - =..visitReason.docAPI.get: ""
                                - =.builtIn.array.selectOneToArr:
                                    dataIn:
                                      arr: =..visitReason.docResp.0.doc.0.name.data.reasonForVisit.OfficeVisits
                                      key: "reason"
                                    dataOut: ScheduleManagementRoom.formData.reasonSendList
                                - =.builtIn.array.push:
                                    dataIn:
                                      messages: =..formData.reasonSendList
                                      newMessage: "Select Reason"
                                    dataOut: ScheduleManagementRoom.formData.reasonSendList
                                - =.builtIn.date.transformMonth:
                                    dataIn:
                                      month: =.BaseDate.calendarDate.month
                                    dataOut: BaseDate.calendarDate.monthName
                                - =.builtIn.date.getTimeStampOfDate:
                                    dataIn:
                                      date: =.BaseDate.calendarDate.todayDate
                                    dataOut: BaseDate.calendarDate.todayStamp
                                - =.builtIn.string.concat:
                                    dataIn:
                                      - "(stime<"
                                      - =.BaseDate.calendarDate.todayStamp.start
                                      - " AND "
                                      - "etime>"
                                      - =.BaseDate.calendarDate.todayStamp.start
                                      - " OR "
                                      - "stime>"
                                      - =.BaseDate.calendarDate.todayStamp.start
                                      - " AND "
                                      - "etime<"
                                      - =.BaseDate.calendarDate.todayStamp.end
                                      - " OR "
                                      - "stime<"
                                      - =.BaseDate.calendarDate.todayStamp.end
                                      - " AND "
                                      - "etime>"
                                      - =.BaseDate.calendarDate.todayStamp.end
                                      - ")"
                                      - " AND "
                                      - "subtype="
                                      - =..formData.roomSendServiceType
                                      # - " AND "
                                      # - "name like '%"
                                      # - =..selectData.reason
                                      # - "%'"
                                    dataOut: Global.scheduleScondition
                        - ..formData.nextBtnColor@: "0xd3dde9"
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: btnView
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: reasonTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: durationTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: splitTimeTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: calendarTag
                  style:
                    left: '0.15'
                    top: '0.1'
                    fontSize: .Nfont.nf1
                    borderColor: "#EAEAEA"
                    width: '0.083'
                    height: '0.046'
                    textIndent: 10px
                - type: label
                  text: Reason for visit(notes)
                  style:
                    left: '0.06'
                    top: '0.18'
                    fontSize: .Nfont.nf1
                - type: select
                  dataKey: selectData.reason
                  options: ..formData.reasonSendList
                  viewTag: reasonTag
                  style:
                    width: '0.12'
                    left: '0.06'
                    top: '0.21'
                    borderColor: "#EAEAEA"
                    fontSize: .Nfont.nf1
                    height: '0.046'
                    backgroundColor: "0xffffff"
                  onChange:
                    - emit:
                        actions:
                          - ..schedule.scheduleList.edge@: []
                          - =.builtIn.array.getByKey:
                              dataIn:
                                array: =..visitReason.docResp.0.doc.0.name.data.reasonForVisit.OfficeVisits
                                key1: reason
                                value: =..selectData.reason
                                key2: duration
                              dataOut: ScheduleManagementRoom.selectData.duration
                          - =.builtIn.array.getByKey:
                              dataIn:
                                array: =..visitReason.docResp.0.doc.0.name.data.reasonForVisit.OfficeVisits
                                key1: reason
                                value: =..selectData.reason
                                key2: fee
                              dataOut: ScheduleManagementRoom.selectData.fee
                          - =.builtIn.array.getByKey:
                              dataIn:
                                array: =..visitReason.docResp.0.doc.0.name.data.reasonForVisit.OfficeVisits
                                key1: reason
                                value: =..selectData.reason
                                key2: document
                              dataOut: ScheduleManagementRoom.selectData.document
                          - =.builtIn.string.retainNumber:
                              dataIn:
                                value: =..selectData.duration
                              dataOut: ScheduleManagementRoom.formData.duration
                          - .BaseDate.formData.duration@: =.ScheduleManagementRoom.formData.duration
                          - ..newAppointment.edge.name.Reason@: =..selectData.reason
                          - ..newAppointment.edge.name.fee@: =..selectData.fee
                          - ..newAppointment.edge.name.document@: =..selectData.document
                          - ..newAppointment.edge.name.duration@: =..formData.duration
                          - =..schedule.get: ""
                    - actionType: evalObject
                      object:
                        - if:
                            - ..schedule.scheduleList.edge.0
                            - =.builtIn.date.splitTime:
                                dataIn:
                                  object2: =..schedule.scheduleList.edge
                                  timeSlot: =..formData.duration
                                  year: =.BaseDate.calendarDate.year
                                  month: =.BaseDate.calendarDate.month
                                  day: =.BaseDate.calendarDate.day
                                  isSplitCurrent: true
                                dataOut: ScheduleManagementRoom.splitTime
                            - ..splitTime@: []
                        - =.builtIn.object.setObjectKey:
                            dataIn:
                              objectArr: =.ScheduleManagementRoom.splitTime
                              key: fontColor
                              value: "0x4b4b4b"
                            dataOut: ScheduleManagementRoom.splitTime
                        - =.builtIn.object.setObjectKey:
                            dataIn:
                              objectArr: =.ScheduleManagementRoom.splitTime
                              key: borColor
                              value: "0xebebeb"
                            dataOut: ScheduleManagementRoom.splitTime
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: calendarTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: splitTimeTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: durationTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: feeTag
                - type: label
                  text: Duration
                  style:
                    left: '0.19'
                    top: '0.18'
                    fontSize: .Nfont.nf1
                - type: textField
                  # placeholder: Virtual Care
                  dataKey: ScheduleManagementRoom.selectData.duration
                  isEditable: "false"
                  viewTag: durationTag
                  style:
                    left: '0.19'
                    top: '0.21'
                    fontSize: .Nfont.nf1
                    border:
                      style: "3"
                    borderColor: "0xEAEAEA"
                    boxSizing: "border-box"
                    width: '0.07'
                    height: '0.046'
                    textIndent: 10px
                # fee
                - type: label
                  text: Fee
                  style:
                    left: '0.27'
                    top: '0.18'
                    fontSize: .Nfont.n6_1_1
                - .TextField1:
                  dataKey: selectData.fee
                  text=func: .builtIn.string.dollarFormat
                  isEditable: "false"
                  viewTag: feeTag
                  style:
                    left: "0.27"
                    top: "0.21"
                    height: "0.046"
                    width: "0.07"
                    boxSizing: "border-box"
                - .BaseDate.calendar:
                  style:
                    left: "0"
                    top: "0.29"
                    width: "0.4"
                    height: "0.19"
                    backgroundColor: "0xf7f9fa"
                    border:
                      style: "1"
                  children:
                    - .BaseDate.calendarHeader:
                      style:
                        top: "0.02"
                        left: "0.06"
                        width: "0.28"
                        height: "0.05"
                        border:
                          style: "1"
                      children:
                        # monthView
                        - type: view
                          style:
                            top: "0"
                            left: "0.06"
                            width: "0.06"
                            height: "0.045"
                          children:
                            - type: image
                              path: blueLeft.svg
                              onClick:
                                - emit:
                                    actions:
                                      - .BaseDate.calendarDate.day@: 1
                                      - =.builtIn.date.loopMonth:
                                          dataIn:
                                            month: =.BaseDate.calendarDate.month
                                            step: -1
                                          dataOut: BaseDate.calendarDate.month
                                      - =.builtIn.date.transformMonth:
                                          dataIn:
                                            month: =.BaseDate.calendarDate.month
                                          dataOut: BaseDate.calendarDate.monthName
                                      - =.builtIn.date.miniWeeklyCalendarArray:
                                          dataIn:
                                            year: =.BaseDate.calendarDate.year
                                            month: =.BaseDate.calendarDate.month
                                            today: 32
                                            markDay: =.BaseDate.calendarDate.day
                                            color: "0x000000"
                                            backgroundColor: "0xFFFFFF6f"
                                            todayColor: "0xffffff"
                                            todayBackgroundColor: "0x2988E6"
                                          dataOut: BaseDate.calendarDate.minidayLable
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: calendarTag
                              style:
                                height: "0.015"
                                top: "0.0175"
                            - type: label
                              dataKey: BaseDate.calendarDate.monthName
                              style:
                                width: "0.02"
                                height: "0.02"
                                left: "0.019"
                                top: "0.01"
                                fontSize: .Nfont.nf3
                                color: "0x003254"
                                textAlign:
                                  x: center
                            - type: image
                              path: blackRight.svg
                              onClick:
                                - emit:
                                    actions:
                                      - .BaseDate.calendarDate.day@: 1
                                      - =.builtIn.date.loopMonth:
                                          dataIn:
                                            month: =.BaseDate.calendarDate.month
                                            step: 1
                                          dataOut: BaseDate.calendarDate.month
                                      - =.builtIn.date.transformMonth:
                                          dataIn:
                                            month: =.BaseDate.calendarDate.month
                                          dataOut: BaseDate.calendarDate.monthName
                                      - =.builtIn.date.miniWeeklyCalendarArray:
                                          dataIn:
                                            year: =.BaseDate.calendarDate.year
                                            month: =.BaseDate.calendarDate.month
                                            today: 32
                                            markDay: =.BaseDate.calendarDate.day
                                            color: "0x000000"
                                            backgroundColor: "0xFFFFFF6f"
                                            todayColor: "0xffffff"
                                            todayBackgroundColor: "0x2988E6"
                                          dataOut: BaseDate.calendarDate.minidayLable
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: calendarTag
                              style:
                                left: "0.055"
                                height: "0.015"
                                top: "0.0175"
                        # yearView
                        - type: view
                          style:
                            top: "0"
                            left: "0.16"
                            width: "0.06"
                            height: "0.045"
                          children:
                            - type: image
                              path: blueLeft.svg
                              onClick:
                                - emit:
                                    actions:
                                      - .BaseDate.calendarDate.month@: 1
                                      - .BaseDate.calendarDate.day@: 1
                                      - =.builtIn.number.Subtraction:
                                          dataIn:
                                            num: =.BaseDate.calendarDate.year
                                            step: 1
                                          dataOut: BaseDate.calendarDate.year
                                      - =.builtIn.date.miniWeeklyCalendarArray:
                                          dataIn:
                                            year: =.BaseDate.calendarDate.year
                                            month: =.BaseDate.calendarDate.month
                                            today: 32
                                            markDay: =.BaseDate.calendarDate.day
                                            color: "0x000000"
                                            backgroundColor: "0xFFFFFF6f"
                                            todayColor: "0xffffff"
                                            todayBackgroundColor: "0x2988E6"
                                          dataOut: BaseDate.calendarDate.minidayLable
                                - actionType: evalObject
                                  object:
                                    - =.builtIn.date.transformMonth:
                                        dataIn:
                                          month: =.BaseDate.calendarDate.month
                                        dataOut: BaseDate.calendarDate.monthName
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: calendarTag

                              style:
                                height: "0.015"
                                top: "0.0175"
                            - type: label
                              dataKey: BaseDate.calendarDate.year
                              style:
                                width: "0.02"
                                height: "0.02"
                                left: "0.019"
                                top: "0.01"
                                fontSize: .Nfont.nf3
                                color: "0x003254"
                                textAlign:
                                  x: center
                            - type: image
                              path: blackRight.svg
                              onClick:
                                - emit:
                                    actions:
                                      - .BaseDate.calendarDate.month@: 1
                                      - .BaseDate.calendarDate.day@: 1
                                      - =.builtIn.number.addition:
                                          dataIn:
                                            num: =.BaseDate.calendarDate.year
                                            step: 1
                                          dataOut: BaseDate.calendarDate.year
                                      - =.builtIn.date.miniWeeklyCalendarArray:
                                          dataIn:
                                            year: =.BaseDate.calendarDate.year
                                            month: =.BaseDate.calendarDate.month
                                            today: 32
                                            markDay: =.BaseDate.calendarDate.day
                                            color: "0x000000"
                                            backgroundColor: "0xFFFFFF6f"
                                            todayColor: "0xffffff"
                                            todayBackgroundColor: "0x2988E6"
                                          dataOut: BaseDate.calendarDate.minidayLable
                                - actionType: evalObject
                                  object:
                                    - =.builtIn.date.transformMonth:
                                        dataIn:
                                          month: =.BaseDate.calendarDate.month
                                        dataOut: BaseDate.calendarDate.monthName
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: calendarTag
                              style:
                                left: "0.055"
                                height: "0.015"
                                top: "0.0175"
                        - type: list
                          contentType: listObject
                          listObject:
                            - key: SU
                            - key: MO
                            - key: TU
                            - key: WE
                            - key: TH
                            - key: FR
                            - key: SA
                          iteratorVar: itemObject
                          style:
                            top: "0.065"
                            width: "0.21"
                            left: "0.035"
                            height: "0.03"
                            justifyContent: "space-between"
                          children:
                            - type: listItem
                              itemObject: ""
                              style:
                                width: "0.03"
                                height: "0.03"
                                boxSizing: "border-box"
                                border: "none"
                                padding: "0"
                                display: "inline-block"
                              children:
                                - type: label
                                  dataKey: itemObject.key
                                  style:
                                    color: "0x003254"
                                    width: "0.03"
                                    height: "0.03"
                                    fontSize: .Nfont.nf2
                                    fontFamily: Poppins
                                    # backgroundColor: "0xffffff"
                                    textAlign:
                                      x: center
                                      y: center
                        - type: list
                          contentType: listObject
                          listObject: =.BaseDate.calendarDate.minidayLable
                          iteratorVar: itemObject
                          style:
                            top: "0.085"
                            left: "0.035"
                            width: "0.21"
                            margin: "0"
                          children:
                            - type: listItem
                              itemObject: ""
                              onClick:
                                - emit:
                                    dataKey:
                                      var: itemObject
                                    actions:
                                      - =.builtIn.date.miniWeeklyCalendarArray:
                                          dataIn:
                                            year: $var.year
                                            month: $var.month
                                            today: $var.day
                                            markDay: $var.day
                                            color: "0x000000"
                                            backgroundColor: "0xFFFFFF6f"
                                            todayColor: "0xffffff"
                                            todayBackgroundColor: "0x2988E6"
                                          dataOut: BaseDate.calendarDate.minidayLable
                                      - .BaseDate.calendarDate.year@: $var.year
                                      - .BaseDate.calendarDate.month@: $var.month
                                      - .BaseDate.calendarDate.day@: $var.day
                                      - =.builtIn.date.ShowDateByNumber:
                                          dataIn:
                                            year: =.BaseDate.calendarDate.year
                                            month: =.BaseDate.calendarDate.month
                                            day: =.BaseDate.calendarDate.day
                                            formatType: "Y-M-D"
                                          dataOut: BaseDate.calendarDate.todayDate
                                      - =.builtIn.date.transformMonth:
                                          dataIn:
                                            month: =.BaseDate.calendarDate.month
                                          dataOut: BaseDate.calendarDate.monthName
                                      - =.builtIn.date.getTimeStampOfDate:
                                          dataIn:
                                            date: =.BaseDate.calendarDate.todayDate
                                          dataOut: BaseDate.calendarDate.todayStamp
                                      - =.builtIn.string.concat:
                                          dataIn:
                                            - "(stime<"
                                            - =.BaseDate.calendarDate.todayStamp.start
                                            - " AND "
                                            - "etime>"
                                            - =.BaseDate.calendarDate.todayStamp.start
                                            - " OR "
                                            - "stime>"
                                            - =.BaseDate.calendarDate.todayStamp.start
                                            - " AND "
                                            - "etime<"
                                            - =.BaseDate.calendarDate.todayStamp.end
                                            - " OR "
                                            - "stime<"
                                            - =.BaseDate.calendarDate.todayStamp.end
                                            - " AND "
                                            - "etime>"
                                            - =.BaseDate.calendarDate.todayStamp.end
                                            - ")"
                                            - " AND "
                                            - "subtype="
                                            - =..formData.roomSendServiceType
                                            # - " AND "
                                            # - "name like '%"
                                            # - =..selectData.reason
                                            # - "%'"
                                          dataOut: Global.scheduleScondition
                                - actionType: evalObject
                                  object:
                                    #如果选择过去的时候，进行提示
                                    - if:
                                        - =.builtIn.math.greater:
                                            dataIn:
                                              num1: =.BaseDate.calendarDate.todayStamp.end
                                              num2: =.ScheduleManagementRoom.formData.nowTimeStamp
                                        - continue
                                        - actionType: popUp
                                          popUpView: dateCheck
                                          wait: true
                                    - .BaseDate.schedule.scheduleList.edge@: []
                                    - ..splitTime@: []
                                - actionType: updateObject
                                  dataKey: ScheduleManagementRoom.schedule.scheduleList.edge
                                  dataObject: []                                     
                                - actionType: evalObject
                                  object:
                                    .Global._nonce@:
                                      =.builtIn.math.random: ""
                                - actionType: evalObject
                                  object:
                                    - =..schedule.get: ""
                                - actionType: evalObject
                                  object:
                                    - if:
                                        - ..schedule.scheduleList.edge.0
                                        - =.builtIn.date.splitTime:
                                            dataIn:
                                              object2: =..schedule.scheduleList.edge
                                              timeSlot: =..formData.duration
                                              year: =.BaseDate.calendarDate.year
                                              month: =.BaseDate.calendarDate.month
                                              day: =.BaseDate.calendarDate.day
                                              isSplitCurrent: true
                                            dataOut: ScheduleManagementRoom.splitTime
                                        - ..splitTime@: []
                                    #如果没有avail，进行提示
                                    - if:
                                        - =.ScheduleManagementRoom.splitTime.0.stime
                                        - continue
                                        - actionType: popUp
                                          popUpView: noAvailableTag
                                          wait: true
                                    - =.builtIn.object.setObjectKey:
                                        dataIn:
                                          objectArr: =.ScheduleManagementRoom.splitTime
                                          key: fontColor
                                          value: "0x4b4b4b"
                                        dataOut: ScheduleManagementRoom.splitTime
                                    - =.builtIn.object.setObjectKey:
                                        dataIn:
                                          objectArr: =.ScheduleManagementRoom.splitTime
                                          key: borColor
                                          value: "0xebebeb"
                                        dataOut: ScheduleManagementRoom.splitTime
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: calendarTag
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: splitTimeTag
                              style:
                                width: "0.03"
                                height: "0.02"
                                # boxSizing: "border-box"
                                # border: "none"
                                padding: "0"
                                margin: "0"
                                display: "inline-block"
                                # flex: "auto"
                                marginTop: "0.02"
                              children:
                                - type: label
                                  dataKey: itemObject.day
                                  style:
                                    top: "0"
                                    left: "0.0065"
                                    width: "0.017"
                                    height: "0.03"
                                    color: itemObject.color
                                    backgroundColor: itemObject.backgroundColor
                                    borderRadius: "50"
                                    fontSize: .Nfont.nf4
                                    textAlign:
                                      x: center
                                      y: center
                    - .BaseDate.leftWeek:
                      style:
                        left: "0.06"
                        top: "0.088"
                    - .BaseDate.nextWeek:
                      style:
                        left: "0.34"
                        top: "0.038"
                - type: label
                  text: Availability
                  style:
                    top: "0.5"
                    left: "0.06"
                    width: "0.28"
                    fontSize: .Nfont.nf2
                    fontWeight: "600"
                - type: scrollView
                  style:
                    top: "0.52"
                    height: "0.28"
                    width: "0.32"
                    left: "0.06"
                    overflow: scroll
                  children:
                    # - type: label
                    #   dataKey: splitTime.0.showTime
                    #   style:
                    #     top: "0"
                    - type: list
                      viewTag: splitTimeTag
                      contentType: listObject
                      listObject: =.ScheduleManagementRoom.splitTime
                      iteratorVar: itemObject
                      style:
                        top: "0"
                        width: "0.32"
                        left: "0"
                        margin: "0"
                        display: inline-block
                      children:
                        - type: listItem
                          itemObject: ""
                          onClick:
                            - emit:
                                dataKey:
                                  var: itemObject
                                actions:
                                  - =.builtIn.object.setProperty:
                                      dataIn:
                                        obj: =.ScheduleManagementRoom.splitTime
                                        label: "showTime"
                                        text: $var.showTime
                                        arr: [ "fontColor", "bgColor", "borColor" ]
                                        valueArr: [ "0x005795", "0xeaf1f6", "0xeaf1f6" ]
                                        errorArr: [ "0x4b4b4b", "0xffffff", "0xebebeb" ]
                                  - =.builtIn.string.concat:
                                      dataIn:
                                        - =.BaseDate.calendarDate.monthName
                                        - " "
                                        - =.BaseDate.calendarDate.day
                                        - ","
                                        - =.BaseDate.calendarDate.year
                                        - " "
                                        - "at"
                                        - " "
                                        - $var.showTime
                                      dataOut: ScheduleManagementRoom.appointmentTime
                                  - ..clock@: $var
                                  - ..newAppointment.edge.stime@: =..clock.stime
                                  - ..newAppointment.edge.etime@: =..clock.etime
                                  - ..newAppointment.edge.refid@: =..clock.refid
                                  - ..newAppointment.edge.name.locationName@: =..formData.locationSend
                                  - ..newAppointment.edge.name.roomName@: =..formData.roomSend
                                  - ..newAppointment.edge.name.providerFullInfo@: =..formData.roomSend
                                  - ..formData.nextBtnColor@: "0x005795"
                                  # - =.builtIn.array.getByKey:
                                  #     dataIn:
                                  #       array: =..visitReason.docResp.0.doc.0.name.data.reasonForVisit
                                  #       key1: reason
                                  #       value: =..selectData.reason
                                  #       key2: document
                                  #     dataOut: ScheduleManagementRoom.newAppointment.edge.name.document
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: btnView
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: splitTimeTag
                          style:
                            width: '0.058'
                            height: '0.032'
                            marginRight: "0.015"
                            float: left
                            marginTop: "0.02"
                            backgroundColor: itemObject.bgColor
                            border:
                              style: '3'
                            borderColor: itemObject.borColor
                            borderRadius: "3"
                          children:
                            - type: label
                              dataKey: itemObject.showTime
                              style:
                                left: "0"
                                height: "0.03"
                                color: itemObject.fontColor
                                fontSize: .Nfont.nf2
                                textAlign:
                                  x: center
                                  y: center
                - type: button
                  text: Next
                  viewTag: btnView
                  onClick:
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: Detials
                    - actionType: evalObject
                      object:
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =..formData.nextBtnColor
                                  string2: "0x005795"
                            - actionType: popUpDismiss
                              popUpView: create1
                            - continue
                    - actionType: evalObject
                      object:
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =..formData.nextBtnColor
                                  string2: "0x005795"
                            - ..formData.createAppInfo@: block
                            - continue
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: Detials
                  style:
                    top: "0.83"
                    width: "0.28"
                    height: "0.043"
                    left: "0.06"
                    color: "0xffffff"
                    fontSize: .Nfont.nf4
                    fontFamily: "Roboto"
                    backgroundColor: =..formData.nextBtnColor
                    border:
                      style: "1"
                    borderRadius: "3"
                    textAlign:
                      x: center
                      y: center
    - type: popUp
      viewTag: noAvailableTag
      message: "There is no appointment available"
      path: aboutBlue.svg
      style:
        width: "0.3"
        height: "0.4"
        top: "0.3"
        left: "0.415"
        zIndex: "100000"
        backgroundColor: "0xffffff"
        borderRadius: "7"
        border:
          style: "3"
        borderColor: "#f4f8fa"
        boxShadow: "0px 0px  5px 2px #f4f8fa"
      children:
        - type: image
          path: __.path
          style:
            left: "0.12"
            width: "0.06"
            top: "0.04"
        - type: label
          text: __.message
          text2: _.text3 # "v'
          text3: "v"
          text4: __.children.1.text # "ok"
          style:
            .LabelStyle:
              left: "0"
              top: "0.18"
              width: "0.3"
              height: "0.06"
              color: "0x000000"
              fontSize: .Nfont.nf4
              # fontStyle: "bold"
              fontFamily: "sans-serif"
              textAlign:
                x: center
                y: center
        - type: button
          text: ok
          style:
            width: "0.06"
            left: "0.12"
            height: "0.04"
            top: "0.3"
            color: "0xffffff"
            backgroundColor: "#005795"
            fontSize: .Nfont.nf4
            border:
              style: "3"
              color: "#005795"
            borderRadius: "5"
          onClick:
            - actionType: popUpDismiss
              popUpView: noAvailableTag
    - type: popUp
      viewTag: dateCheck
      message: "Please don't choose the past time"
      path: aboutBlue.svg
      style:
        width: "0.3"
        height: "0.4"
        top: "0.3"
        left: "0.415"
        zIndex: "100000"
        backgroundColor: "0xffffff"
        borderRadius: "7"
        border:
          style: "3"
        borderColor: "#f4f8fa"
        boxShadow: "0px 0px  5px 2px #f4f8fa"
      children:
        - type: image
          path: __.path
          style:
            left: "0.12"
            width: "0.06"
            top: "0.04"
        - type: label
          text: __.message
          text2: _.text3 # "v'
          text3: "v"
          text4: __.children.1.text # "ok"
          style:
            .LabelStyle:
              left: "0"
              top: "0.18"
              width: "0.3"
              height: "0.06"
              color: "0x000000"
              fontSize: .Nfont.nf4
              # fontStyle: "bold"
              fontFamily: "sans-serif"
              textAlign:
                x: center
                y: center
        - type: button
          text: ok
          style:
            width: "0.06"
            left: "0.12"
            height: "0.04"
            top: "0.3"
            color: "0xffffff"
            backgroundColor: "#005795"
            fontSize: .Nfont.nf4
            border:
              style: "3"
              color: "#005795"
            borderRadius: "5"
          onClick:
            - actionType: popUpDismiss
              popUpView: dateCheck
