SelectOrganization:
  #xd page number 7
  pageNumber: "70"
  init:
    - .SignInCheck
    - .Global.formData.firstLogin@: true
    - .Global.menuBar.listData@: =.SideMenuBarDM.ScheduleManagement
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - actionType: updateObject
      dataKey: Global.currentFacility
      dataObject: {}
    - .Global.jwt.edge.bvid@: =.Global.currentUser.vertex.id
    - actionType: evalObject
      object:
        - =.Global.jwt.edgeAPI.store: ""
    - ..listData.get
    - if:
        - =..listData.organization.vertex.0
        - continue
        - =.builtIn.checkField:
            dataIn:
              contentType: messageHidden
              wait: 100
    - actionType: updateObject
      dataKey: Global.auth
      dataObject: {}
    - .Global.locationAll@: []
    - .Global.alllocationID@: []
    - .Global.roomAll@: []
    - .Global.patientAll@: []
    - .Global.providerAll@: []
    - .Global.fac_rootNotebook@: ""
    - .Global.formData.reply.eid@: ""
  formData:
    status: true
    extractData:
      - id
      - name.basicInfo.medicalFacilityName
      - name.basicInfo.phoneNumber
      - name.basicInfo.location
      - name.basicInfo.locationID
  apiRequest:
    # 获取所有的选中的facility的所有的location
    locationList:
      list: ""
      vertexIn:
        ObjType: 4
        id: ""
        xfname: "E.bvid"
        sCondition: "E.type=1100 AND V.type=21"
        maxcount: "100"
        obfname: "ctime"
        asc: true
        _nonce: =.Global._nonce
      vertexAPI:
        get:
          api: rv
          dataIn: apiRequest.locationList.vertexIn
          dataOut: SelectOrganization.apiRequest.locationList.list
    # 把所有的location的简略信息放在该Doc 里面
    locationAll:
      docResp: "" # get到的值
      docIn:
        # for geting all of the location
        type: .DocType.LocationOfFacility
        id: ""
        xfname: ovid
        obfname: mtime
        maxcount: "1"
        name:
          data:
            allLocation: []
      document:
        # for store some info of location 
        type: .DocType.LocationOfFacility
        eid: ""
        name:
          data:
            allLocation: []
      docAPI:
        .DocAPI: ""
        store:
          api: cd
          dataIn: apiRequest.locationAll.document
          subtype:
            mediaType: "application/json"
        get:
          api: rd
          dataIn: SelectOrganization.apiRequest.locationAll.docIn
          dataOut: SelectOrganization.apiRequest.locationAll.docResp
    # 获取当前facility的头像，放在Global下
    getAvatarID:
      # 获取facility头像的id 放入global里，随时调用（给provide，patient添加好友）
      docResp:
        doc: []
      docIn:
        ObjType: 12
        type: .DocType.BusinessLogoPicture
        id: ""
        xfname: E.bvid
        sCondition: E.type=10000
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: apiRequest.getAvatarID.docIn
          dataOut: SelectOrganization.apiRequest.getAvatarID.docResp
    roomList:
      # 获取所有的room 
      vertexResp: ""
      vertexIn:
        ObjType: "4"
        id: []
        xfname: E.Bvid
        sCondition: "E.type=1100 AND V.type=30"
        _nonce: =.Global._nonce
      vertexAPI:
        get:
          api: rv
          dataIn: apiRequest.roomList.vertexIn
          dataOut: SelectOrganization.apiRequest.roomList.vertexResp
  # 如果是staff，获取边上设置的权限
  relation:
    edgeStore: ""
    info: ""
    edge:
      xfname: bvid,evid
      id: []
      type: .EdgeType.StaffToFacility
      obfname: "ctime"
      _nonce: =.Global._nonce
      asc: false
    edgeAPI:
      get:
        api: re
        dataIn: SelectOrganization.relation.edge
        dataOut: SelectOrganization.relation.info
  # 获取当前Facility的权限
  relation1:
    edge: ""
    edgeReq:
      xfname: bvid,evid
      id: []
      type: 1100
      _nonce: =.Global._nonce
    edgeAPI:
      get:
        api: re
        dataIn: SelectOrganization.relation1.edgeReq
        dataOut: SelectOrganization.relation1.edge
  listData:
    organization:
      vertex: ""
    vertex:
      ObjType: "4"
      ids:
        - .Global.currentUser.vertex.id
      xfname: "E.bvid"
      sCondition: "E.type in (1100,1200) AND V.type=20"
      maxcount: "100"
      obfname: "ctime"
      _nonce: =.Global._nonce
    get:
      api: rv
      dataOut: listData.organization
      dataIn: listData.vertex
  components:
    - .BaseCheckView: ""
      message: "You have no authority to enter the facility"
      viewTag: statusTag
      style:
        zIndex: "100000"
    - .MainView:
      children:
        - .Head0:
        - type: label
          text: 'LogOut'
          onClick:
            - goto: LogOut
          style:
            width: '0.08'
            height: '0.06'
            fontSize: .Nfont.nf3
            fontWeight: '500'
            color: "#235591"
            left: '0.9'
            top: '0'
            textAlign:
              x: center
              y: center
        - .CenterView:
          style:
            width: "0.84"
            left: "0.08"
            height: "0.86"
            top: "0.1"
            backgroundColor: "#ffffff"
          children:

            - type: label
              text: Select Organization
              style:
                fontSize: 2.2vh
                fontWeight: "600"
                top: "0.0626"
                left: "0.025"
                color: "0x000000"
            - type: label
              text: Existing Organizations
              style:
                fontSize: 1.8vh
                fontWeight: "400"
                top: "0.12"
                left: "0.075"
                color: "#517086"
            - type: label
              text: Create a new organization
              style:
                fontSize: 1.8vh
                fontWeight: "400"
                top: "0.12"
                left: "0.485"
                color: "#517086"
            - type: scrollView
              style:
                height: "0.63"
                width: '0.42'
                top: '0.16'
                left: "0"
                marginTop: '0'
                overflowY: scroll
                overflowX: hidden
              children:
                - type: list
                  contentType: listObject
                  listObject: ..listData.organization.vertex
                  iteratorVar: itemObject
                  style:
                    width: "0.28"
                    left: "0.075"
                    height: auto
                    margin: "0"
                  children:
                    - type: listItem
                      itemObject:
                      onClick:
                        - emit:
                            dataKey:
                              var: itemObject
                            actions:
                              - .Global.currentFacility@: $var
                              - ..apiRequest.locationAll.docIn.id@: $var.id
                              - ..apiRequest.locationAll.document.eid@: $var.deat.rnb64ID
                              - ..apiRequest.locationList.vertexIn.id@: $var.id
                              - ..apiRequest.getAvatarID.docIn.id@: $var.id
                              - .Global.fac_rootNotebook@: $var.deat.rnb64ID
                              - .Global.formData.reply.eid@: $var.deat.rnb64ID # 给reply的eid赋值                                  
                              - =.builtIn.string.concat:
                                  dataIn:
                                    - =.Config.searchLink
                                    - "/index.html?FacilityDetailLink&id="
                                    - $var.name.basicInfo.locationID
                                    - " "
                                  dataOut: Global.formData.facilityLink
                              - =.builtIn.storeCredential:
                                  dataIn:
                                    key: "facility_vid"
                                    value: $var.id
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: ""
                        #  此处与权限有关， 暂时注释，勿删（张锐 12.31）
                        # - actionType: evalObject
                        #   object:
                        #     - =.builtIn.array.add:
                        #         dataIn:
                        #           object: =..relation.edge.id
                        #           value: =.Global.currentUser.vertex.id
                        #     - =.builtIn.array.add:
                        #         dataIn:
                        #           object: =..relation.edge.id
                        #           value: =.Global.currentFacility.id
                        #     - =..relation.edgeAPI.get: ""
                        #     - if:
                        #       - =..relation.info.edge.0
                        #       - .Global.auth@: =..relation.info.edge.0.name.auth
                        #       - actionType: evalObject
                        #         object:
                        #           - =.builtIn.array.add:
                        #               dataIn:
                        #                 object: =..relation1.edgeReq.id
                        #                 value: =.Global.currentUser.vertex.id
                        #           - =.builtIn.array.add:
                        #               dataIn:
                        #                 object: =..relation1.edgeReq.id
                        #                 value: =.Global.currentFacility.id
                        #           - =..relation1.edgeAPI.get: ""
                        #     - if:
                        #       - =..relation.info.edge.0
                        #       - continue
                        #       - .Global.auth@: =..relation1.edge.edge.0.name.auth
                        # - actionType: evalObject
                        #   object:
                        #     - if:
                        #       - =..relation.info.edge.0
                        #       - actionType: evalObject
                        #         object:
                        #           - if: 
                        #             - =.builtIn.string.equal:
                        #                 dataIn:
                        #                   string1: =..relation.info.edge.0.name.status
                        #                   string2: Inactive
                        #             - ..formData.status@: false
                        #             - ..formData.status@: true
                        #       - continue
                        #     - if:
                        #       - =..formData.status
                        #       - continue
                        #       - actionType: popUp
                        #         popUpView: statusTag
                        #         wait: true
                        - actionType: evalObject
                          object:
                            - =..apiRequest.locationAll.docAPI.get: ""
                            - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
                            - =.Global.jwt.edgeAPI.store: ""
                            - if:
                                - =..apiRequest.locationAll.docResp.doc.0
                                - ..apiRequest.locationAll.document@: =..apiRequest.locationAll.docResp.doc.0
                                - actionType: evalObject
                                  object:
                                    - =..apiRequest.locationList.vertexAPI.get: ""
                                    - =.builtIn.object.extractArray:
                                        dataIn:
                                          obj: =..apiRequest.locationList.list.vertex
                                          arr: =..formData.extractData
                                        dataOut: SelectOrganization.apiRequest.locationAll.document.name.data.allLocation
                                    - =..apiRequest.locationAll.docAPI.store: ""
                            - .Global.locationAll@: =..apiRequest.locationAll.document.name.data.allLocation
                            - .Global.formData.locationId@: =.Global.locationAll.0.id # initial account management id
                            # 提取出所有的room 整个facility的 然后存放在 global.alllocationID 里面
                            - =.builtIn.array.selectOneToArr:
                                dataIn:
                                  arr: =.Global.locationAll
                                  key: "id"
                                dataOut: Global.alllocationID
                            # 提取所有的room信息 并存放在Global里面
                            - ..apiRequest.roomList.vertexIn.id@: =.Global.alllocationID
                            - =..apiRequest.roomList.vertexAPI.get: ""
                            - .Global.roomAll@: =..apiRequest.roomList.vertexResp.vertex
                            - =..apiRequest.getAvatarID.docAPI.get: ""
                            - if:
                                - ..apiRequest.getAvatarID.docResp.doc.0
                                - .Global.facilityAvatarID@: =..apiRequest.getAvatarID.docResp.doc.0.id
                                - continue
                            - goto: ScheduleManagement
                      style:
                        width: '0.28'
                        height: '0.18'
                        left: '0'
                        marginTop: '0.02'
                        border:
                          style: "3"
                        borderColor: "#008080"
                        borderWidth: "1"
                        # boxShadow: "0px 2px 9px 1px #a6bbca" 
                        borderRadius: "5"
                      children:
                        - type: label
                          dataKey: itemObject.name.basicInfo.medicalFacilityName
                          style:
                            width: "0.217"
                            fontSize: .Nfont.nf5
                            fontWeight: "500"
                            top: "0.015"
                            left: "0.012"
                            textOverflow: ellipsis
                            overflow: hidden
                            color: "0x0063a5"
                        - type: image
                          path: "office-building.svg"
                          style:
                            width: "0.03"
                            top: "0.06"
                            left: "0.11"
                        - type: label
                          text: "Registered Date:"
                          style:
                            fontSize: .Nfont.nf2
                            fontWeight: "400"
                            top: "0.14"
                            left: "0.012"
                            width: "0.077"
                            color: "#517086"
                        - type: label
                          text=func: .builtIn.string.formatUnixtime_en
                          dataKey: itemObject.ctime
                          style:
                            fontSize: .Nfont.nf2
                            fontWeight: "500"
                            top: "0.14"
                            left: "0.089"
                            color: "#517086"
                        - type: view
                          style:
                            top: "0"
                            width: "0.05"
                            height: "0.18"
                            left: "0.23"
                            backgroundColor: "0x008080"
                            borderRadius: "5"
                            boxShadow: "0px 0px 1px 1px #a6bbca"
                          children:
                            - type: image
                              path: "enter.svg"
                              style:
                                width: "0.03"
                                top: "0.052"
                                left: "0.01"
                            - type: label
                              text: Enter
                              style:
                                fontSize: .Nfont.nf4
                                fontWeight: "500"
                                top: "0.115"
                                left: "0.015"
                                color: "#FFFFFF"
                # - type: label
                #   text: Medical Facility
                #   style:
                #     fontSize: "25"
                #     fontWeight: "500"
                #     top: "0.07"
                #     left: "0.11"
            - type: view
              contentType: messageHidden
              style:
                top: "0.1"
                left: "0"
                isHidden: "true"
                textAlign:
                  x: center
              children:
                - type: label
                  text: No existing Organization
                  style:
                    fontSize: .Nfont.nf6
                    fontWeight: "800"
                    top: "0.52"
                    left: "0"
                    width: "0.42"
                    color: "#0063A8"
                - type: label
                  text: Create a new Organization
                  style:
                    fontSize: .Nfont.h4
                    fontWeight: "400"
                    top: "0.58"
                    left: "0"
                    width: "0.42"
                    color: "#0063A8"
                # - type: label
                #   text: Create a new Organization
                #   style:
                #     fontSize: .Nfont.nf4
                #     fontWeight: "400"
                #     top: "0.12"
                #     left: "0"    
                #     color: "#517086"
                - type: image
                  path: "office-building.svg"
                  style:
                    width: "0.15"
                    left: "0.135"
                    top: "0.16"
            - type: view
              onClick:
                - goto: MedicalFacility1
              style:
                height: "0.18"
                width: "0.28"
                left: "0.485"
                border:
                  style: "3"
                boxShadow: "0px 1px 5px 0.1px #5b88a8"
                top: "0.18"
                backgroundColor: "#ffffff"
                borderRadius: "5"
                fontFamily: "Poppins"
                textAlign:
                  y: center
              children:
                - type: image
                  path: "add1.svg"
                  style:
                    width: "0.05"
                    top: "0.05"
                    left: "0.04"
                - type: label
                  text: Organization
                  style:
                    fontSize: .Nfont.nf6
                    fontWeight: "500"
                    # top: "0.055"
                    left: "0.1"
                    textAlign:
                      y: center
