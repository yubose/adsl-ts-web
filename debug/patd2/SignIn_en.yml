SignIn: # xd page number:4
  pageNumber: "30"
  init:
    - if:
        - =.Global.currentUser.vertex.sk
        - actionType: evalObject
          object:
            - ..listData.vertex.id@: =.Global.currentUser.vertex.id
            - .Global.loginUser.vertex.id@: =.Global.currentUser.vertex.id
            - =..listData.get: ""
            - if:
                - =..listData.family.vertex.0.id
                - goto: ChooseUser #PatientDashboard
                - goto: PatientDashboard
        - continue
    - if:
        - .builtIn.isIOSBrowser # 'true', 'false'
        - actionType: evalObject
          object: ..setIOS
        - continue
    - if:
        - .builtIn.isAndroidBrowser # 'true', 'false'
        - actionType: evalObject
          object: ..setAndroid
        - continue
    - if:
        - =..appLink.url
        - goto: ..appLink.url
        - continue
    - =.builtIn.FCM.getAPPID:
        dataIn:
          appName: =.AppName
        dataOut: FirebaseToken.edge.evid
  setIOS:
    - ..appLink.url@: https://apps.apple.com/us/app/aitmed-care/id1566010358
    - ..appLink.img@: https://public.aitmed.com/commonRes/appstore.png
  setAndroid:
    - ..appLink.url@: https://play.google.com/store/apps/details?id=com.aitmed.care
    - ..appLink.img@: https://public.aitmed.com/commonRes/google-play.png
  appLink:
    url: ""
    img: ""
  save:
    - =.builtIn.eccNaCl.decryptAES:
        dataIn:
          key: =..formData.password
          message: =.Global.currentUser.vertex.esk
        dataOut: SignIn.formData.sk
    - =.builtIn.eccNaCl.skCheck:
        dataIn:
          pk: =.Global.currentUser.vertex.pk
          sk: =..formData.sk
        dataOut: SignIn.formData.pass
    - if:
        - =..formData.pass
        - .Global.currentUser.vertex.sk@: =..formData.sk
        - actionType: popUp
          popUpView: WrongInformation
          wait: true
  verify:
    - actionType: evalObject
      object:
        - =.builtIn.eccNaCl.decryptAES:
            dataIn:
              key: =..formData.password
              message: =..loginNewDevice.response.edge.deat.esk
            dataOut: SignIn.formData.sk
        - =.builtIn.eccNaCl.skCheck:
            dataIn:
              pk: =..loginNewDevice.response.edge.deat.pk
              sk: =..formData.sk
            dataOut: SignIn.formData.pass
        - if:
            - =..formData.pass
            - .Global.currentUser.vertex.sk@: =..formData.sk
            - actionType: evalObject
              object:
                - ..formData.wrongPassword@: true
                - actionType: popUp
                  popUpView: wrongPassword
                  wait: true
  check:
    - =.SignIn.loginNewDevice.edgeAPI.store: ""
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =..loginNewDevice.response.code
              string2: 0
        - continue
        - actionType: popUp
          popUpView: wrongCode
          wait: true

  update:
    - =.builtIn.date.currentDateTime:
        dataOut: Global.currentDateTime
    - =.SignIn.retrieveVertex.vertexAPI.get: ""
    # prepare data for the future 1031 jwt exchange, and save the vertex contains JWT
    - .Global.sigVertexResp@: =.SignIn.retrieveVertex.response.vertex.0
    - ..myLoginTime@: =.Global.currentDateTime
    # - ..myLoginTime@: =.builtIn.currentDateTime
    - =.builtIn.string.concat:
        dataIn:
          - =.SignIn.loginUser2.edge.bvid
          - " "
          - =..myLoginTime
        dataOut: SignIn.loginMessage
    - =.builtIn.storeCredentials:
        dataIn:
          sk: =.Global.currentUser.vertex.sk
    - =.builtIn.eccNaCl.signature:
        dataIn:
          message: =..loginMessage
          sk: =.Global.currentUser.vertex.sk
          eskSign: =..retrieveVertex.response.vertex.0.name.eskSign
        dataOut: SignIn.loginUser2.edge.name.sig
    - .SignIn.loginUser2.edge.name.ctime@: =..myLoginTime
    - =.SignIn.loginUser2.edgeAPI.store: ""
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - =.SignIn.retrieveVertex.vertexAPI.get: ""
    - .Global.loginUser.vertex@: =..retrieveVertex.response.vertex.0
    - .Global.loginUser.JWT@: =..loginUser2.response.jwt
    - .Global.currentUser.vertex@: =..retrieveVertex.response.vertex.0
    - .Global.currentUser.JWT@: =..loginUser2.response.jwt
    - .Global.phoneNumber@: =..formData.phoneNumber
    - =.builtIn.storeCredentials:
        dataIn:
          sk: =.Global.currentUser.vertex.sk
          pk: =.Global.currentUser.vertex.pk
          userId: =.Global.currentUser.vertex.id
          esk: =.Global.currentUser.vertex.esk
    - .Global.currentUser.dataCache.loadingDateTime@: =.Global.currentDateTime
    - .Global.rootNotebookID@: =.Global.currentUser.vertex.deat.rnb64ID
    - .Global.currentUser.dataCache.loadingDateTime@: =.Global.currentDateTime
  formData:
    checkOk: "false"
    checkMessage: "no message"
    countryCode: "+1"
    phoneNumber: ""
    password: ""
    code: ""
    sk: ""
    pass: ""
    wrongPassword: false
  retrieveVertex:
    response: ""
    vertex:
      id: =..loginNewDevice.response.edge.deat.user_id
      _nonce: =.Global._nonce
    vertexAPI:
      get:
        api: rv
        dataIn: SignIn.retrieveVertex.vertex
        dataOut: SignIn.retrieveVertex.response
  getVertex:
    response: ""
    vertex:
      id: ""
      xfname: none
      type: 1
      sCondition: =..rvCondition
      _nonce: =.Global._nonce
    vertexAPI:
      get:
        api: rv
        dataIn: SignIn.getVertex.vertex
        dataOut: SignIn.getVertex.response
  listData:
    family:
      vertex: ""
    vertex:
      ObjType: "4"
      id: =.Global.loginUser.vertex.id
      xfname: "E.bvid"
      sCondition: "E.type in (1100,1200) AND V.type=10"
      maxcount: "100"
      obfname: "ctime"
      _nonce: =.Global._nonce
    get:
      api: rv
      dataOut: listData.family
      dataIn: listData.vertex
  verificationCode:
    response: ""
    edge:
      .Edge: ""
      type: 1010
      _nonce: =.Global._nonce
      evid: =.FirebaseToken.edge.evid
      name:
        AndroidSMSCode: ""
        phone_number: =..apiData.phoneNumber
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: SignIn.verificationCode.edge
        dataOut: SignIn.verificationCode.response
  loginNewDevice:
    response: ""
    edge:
      .Edge: ""
      type: 1040
      _nonce: =.Global._nonce
      name:
        phone_number: =..apiData.phoneNumber
        verification_code: =..formData.code
      # deat:
      #   UserId: ""
      #   Pk: ""
      #   Esk: ""
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: SignIn.loginNewDevice.edge
        dataOut: SignIn.loginNewDevice.response
  #  loginUser:
  #    response: ""
  #    edge:
  #      .Edge: ""
  #      type: 1030
  #      _nonce: =.Global._nonce
  #      bvid: =..loginNewDevice.response.edge.deat.user_id
  #      evid: =.FirebaseToken.edge.evid
  #    edgeAPI:
  #      .EdgeAPI: ""
  #      store:
  #        api: ce
  #        dataIn: SignIn.loginUser.edge
  #        dataOut: SignIn.loginUser.response
  loginMessage: ""
  myLoginTime: ""
  loginUser2:
    response: ""
    edge:
      .Edge: ""
      type: 1031
      name:
        ctime: ""
        sig: ""
        # encrypt: ssha256(bvid+ctime)+spk+currentUser.sk
        # server: decrypt sig with (currentUser.pk and ssk) = ssha256(ctime+bvid)
        #bvid in base64 format, ctime in unix timestamp
      _nonce: =.Global._nonce
      bvid: =..loginNewDevice.response.edge.deat.user_id
      evid: =.FirebaseToken.edge.evid
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: SignIn.loginUser2.edge
        dataOut: SignIn.loginUser2.response
  apiData:
    phoneNumber: ""
  changeColor:
    phone:
      color: "0xffffff"
      backgroundColor: "0x2988e6"
      borderColor: "0xF4F4F5"
    userName:
      color: "0x4B4B4B"
      borderColor: "0xF4F4F5"
      backgroundColor: "0xE9F2FC"
    password:
      borderColor: "0xF4F4F5"
  baseColor:
    blueBgColor: "0x2988e6"
    otherBgColor: "0xE9F2FC"
    blueColor: "0xffffff"
    otherColor: "0x4B4B4B"
  basePhoneWeight: "600"
  baseUserWeight: "400"
  sigInColor: "0xC1C1C1"

  rvCondition: ""
  userNameRv: ""

  initFocus: phoneNumberVT
  tt:
    - actionType: popUp
      popUpView: WrongPhoneNum
      wait: true
  components:
    - type: view
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        overflow: hidden
        # position: "fixed"
      children:
        - type: image
          path: back.png
          style:
            left: "0"
            width: "1"
            top: "0"
        - type: view
          style:
            left: "0"
            width: "1"
            textAlign:
              x: center
          children:
            - type: image
              path: aitmedLogo.svg
              style:
                marginTop: "0.08"
                width: "0.3"
            - type: label
              text: CARE
              style:
                left: "0"
                width: "1"
                color: "0xFFFFFF"
                fontSize: .Nfont.h7
                fontStyle: bold
                textShadow: "0 2px #0000001a"
                letterSpacing: "0.1em"
                textIndent: "0.2em"

                textAlign:
                  x: center
        - type: view
          style:
            width: "1"
            marginTop: "0.028"
            backgroundColor: "0xffffff"
            border:
              style: "3"
            borderColor: "0xffffff"
            borderRadius: "40px 40px 0 0"
            height: "1"

            boxSizing: "border-box"
          children:
            - type: label
              text: Welcome back!
              style:
                color: "0x033333"
                marginLeft: "0.09"
                marginTop: "0.04" #32.48px
                width: "0.72"
                fontSize: .Nfont.h4

                fontStyle: bold
                textAlign:
                  x: left
                  y: center
            - type: label
              text: Sign in to continue
              style:
                color: "0x999999"
                left: "0.1"
                width: "0.72"
                marginTop: "0.0025" #2px
                fontSize: ".Nfont.h14"
                fontWeight: "500"
            # user name input area
            - type: view
              viewTag: userOrPhone
              style:
                marginTop: "0.0221" #17.95px
                borderRadius: "20"
                width: "auto"
                marginLeft: "0.1"
              children:
                - type: view
                  style:
                    display: inline-block
                    backgroundColor: "0xE9F2FC"
                    borderRadius: "20px 0 0 20px"
                  children:
                    - type: label
                      text: "Phone"
                      style:
                        # paddingLeft: "12px"
                        # paddingRight: "12px"
                        # paddingTop: "7.5px"
                        # paddingBottom: "7.5px"
                        paddingLeft: "0.04"
                        paddingRight: "0.04"
                        paddingTop: "0.009"
                        paddingBottom: "0.009"
                        fontWeight: ..basePhoneWeight
                        color: ..changeColor.phone.color
                        fontSize: .Nfont.h14
                        backgroundColor: ..changeColor.phone.backgroundColor
                        borderRadius: "20"
                      onClick:
                        - actionType: builtIn
                          funcName: show
                          viewTag: usePhoneNumber
                        - actionType: builtIn
                          funcName: hide
                          viewTag: useUserName
                        - actionType: evalObject
                          object:
                            - ..apiData.phoneNumber@: ""
                            - ..formData.phoneNumber@: ""
                            - ..userNameRv@: ""
                            - ..formData.password@: ""
                            - ..formData.checkOk@: false
                        - actionType: evalObject
                          object:
                            - ..changeColor.phone.backgroundColor@: =..baseColor.blueBgColor
                            - ..changeColor.phone.color@: =..baseColor.blueColor
                            - ..changeColor.userName.backgroundColor@: =..baseColor.otherBgColor
                            - ..changeColor.userName.color@: =..baseColor.otherColor
                            - ..baseUserWeight@: "400"
                            - ..basePhoneWeight@: "600"
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: userOrPhone
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: phoneNumberVT
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: passwordVT
                - type: view
                  style:
                    display: inline-block
                    backgroundColor: "0xE9F2FC"
                    borderRadius: "0 20px 20px 0"
                  children:
                    - type: label
                      text: "User Name"
                      style:
                        # paddingLeft: "12px"
                        # paddingRight: "12px"
                        # paddingTop: "7.5px"
                        # paddingBottom: "7.5px"
                        paddingLeft: "0.04"
                        paddingRight: "0.04"
                        paddingTop: "0.009"
                        paddingBottom: "0.009"
                        fontWeight: ..baseUserWeight
                        backgroundColor: ..changeColor.userName.backgroundColor
                        fontSize: .Nfont.h14
                        color: ..changeColor.userName.color
                        borderRadius: "20"
                      onClick:
                        - actionType: builtIn
                          funcName: hide
                          viewTag: usePhoneNumber
                        - actionType: builtIn
                          funcName: show
                          viewTag: useUserName
                        - actionType: evalObject
                          object:
                            - ..apiData.phoneNumber@: ""
                            - ..formData.phoneNumber@: "8888888888"
                            - ..formData.checkOk@: true
                            - ..formData.password@: ""
                            #- ..rvCondition@: ""
                        - actionType: evalObject
                          object:
                            - ..baseUserWeight@: "600"
                            - ..basePhoneWeight@: "400"
                            - ..changeColor.userName.backgroundColor@: =..baseColor.blueBgColor
                            - ..changeColor.userName.color@: =..baseColor.blueColor
                            - ..changeColor.phone.backgroundColor@: =..baseColor.otherBgColor
                            - ..changeColor.phone.color@: =..baseColor.otherColor
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: userOrPhone
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: phoneNumberVT
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: passwordVT
                        # - actionType: evalObject
                        #   object:
                        #     - ..apiData.phoneNumber@: ""
                        #     - ..formData.phoneNumber@: ""
                        #     - ..userNameRv@: ""
                        # - actionType: builtIn
                        #   funcName: hide
                        #   viewTag: useUserName
                        # - actionType: builtIn
                        #   funcName: show
                        #   viewTag: usePhoneNumber
                        # - actionType: builtIn
                        #   funcName: redraw
                        #   viewTag: usePhoneNumber
                    # - type: label
                    #   text: "Username"
                    #   style:
                    #     color: "0x00000058"
                    #     width: "0.18"
                    #     height: "0.041"
                    #     top: "0"
                    #     fontSize: "1.8vh"
                    #     textAlign:
                    #       x: left
                    #       y: center
                    # - type: textField
                    #   dataKey: apiData.phoneNumber
                    #   onChange:
                    #     - emit:
                    #         actions:
                    #           - =.builtIn.string.concat:
                    #               dataIn:
                    #                 - "uid like '"
                    #                 - =.SignIn.apiData.phoneNumber
                    #                 - "%'"
                    #               dataOut: SignIn.userNameRv
                    #   style:
                    #     textAlign:
                    #       x: left
                    #     fontSize: .Nfont.h2
                    #     left: "0"
                    #     top: "0.045"
                    #     width: "0.5"
                    #     height: "0.041"
                    #     required: "true"
                    #     borderWidth: "1"
                    #     box-sizing: "border-box"
                    #     border:
                    #       style: "2"
            - type: view
              style:
                height: "auto"
                marginTop: "0.0296" #24.04px
              children:
                # user name input area
                - type: view
                  viewTag: useUserName
                  style:
                    left: "0.1"
                    width: "0.8"
                    # height: "0.09"
                    display: none
                    isHidden: true
                  children:
                    - type: label
                      textBoard:
                        - text: "UserName"
                        - text: "&nbsp;*"
                          color: "0xFB5051"
                      style:
                        color: "0x333333"
                        fontWeight: "500"

                        fontSize: ".Nfont.h14"
                    - type: textField
                      viewTag: userNameVT
                      placeholder: "Enter here"
                      dataKey: apiData.phoneNumber
                      style:
                        textAlign:
                          x: left
                        fontSize: .Nfont.h1
                        borderRadius: "4"
                        width: "0.8"
                        marginTop: "0.005"
                        borderColor: ..changeColor.userName.borderColor
                        textIndent: "1em"
                        height: "0.049"
                        borderWidth: "1"
                        box-sizing: "border-box"
                        backgroundColor: "0xF4F4F5"
                        border:
                          style: "3"
                      onChange:
                        - emit:
                            actions:
                              - =.builtIn.string.concat:
                                  dataIn:
                                    - "uid like '"
                                    - =.SignIn.apiData.phoneNumber
                                    - "%'"
                                  dataOut: SignIn.userNameRv
                        - actionType: evalObject
                          object:
                            - ..changeColor.userName.borderColor@: "0xF4F4F5"
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: userNameVT
                      onInput:
                        - actionType: evalObject
                          object:
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..apiData.phoneNumber
                                      string2: ""
                                - ..sigInColor@: "0xC1C1C1"

                                - actionType: evalObject
                                  object:
                                    - if:
                                        - =.builtIn.string.equal:
                                            dataIn:
                                              string1: =..formData.password
                                              string2: ""
                                        - ..sigInColor@: "0xC1C1C1"
                                        - ..sigInColor@: "0x2988e6ff"
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: SignInVT
                # This phone number input area
                - type: view
                  viewTag: usePhoneNumber
                  style:
                    marginLeft: "0.1"

                    isHidden: false
                  children:
                    - type: view
                      style:
                        display: "inline-block"
                      children:
                        - type: label
                          textBoard:
                            - text: Country
                            - text: "&nbsp;*"
                              color: "0xFB5051"
                          style:
                            color: "0x333333"
                            fontWeight: "500"

                            fontSize: ".Nfont.h14"
                        - type: select
                          contentType: countryCode
                          placeholder: ..formData.countryCode
                          dataKey: formData.countryCode # formData.countryCode : inputValue
                          options: .CountryCode
                          required: "true"
                          onChange:
                            - actionType: evalObject
                              object:
                                - =.builtIn.string.concat:
                                    dataIn:
                                      - =.SignIn.formData.countryCode
                                      - " "
                                      - =.SignIn.formData.phoneNumber
                                    dataOut: SignIn.apiData.phoneNumber
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..formData.countryCode
                                          string2: "+965" # Kuwait
                                    - ..formData.checkOk@: true
                                    - =.builtIn.string.phoneVerification:
                                        dataIn:
                                          phoneNumber: =..formData.phoneNumber
                                          countryCode: =..formData.countryCode
                                        dataOut: SignIn.formData.checkOk
                                - =.builtIn.string.concat:
                                    dataIn:
                                      - "uid like '%"
                                      - =.SignIn.formData.countryCode
                                      - " "
                                      - =.SignIn.formData.phoneNumber
                                      - "'"
                                    dataOut: SignIn.rvCondition
                            - actionType: evalObject
                              object:
                                - if:
                                    - =..formData.checkOk
                                    - actionType: evalObject
                                      object:
                                        - if:
                                            - =.builtIn.string.equal:
                                                dataIn:
                                                  string1: =..formData.password
                                                  string2: ""
                                            - ..sigInColor@: "0xC1C1C1"
                                            - ..sigInColor@: "0x2988e6ff"
                                    - ..sigInColor@: "0xC1C1C1"
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: SignInVT
                          style:
                            width: "0.2"
                            marginTop: "0.005"
                            height: "0.049"
                            backgroundColor: "0xF4F4F5"
                            fontSize: .Nfont.h1
                            boxSizing: "border-box"
                            borderWidth: "1"
                            color: "0x000000"
                            borderRadius: "4"
                            textIndent: "1em"
                            box-sizing: "border-box"
                            border:
                              style: "1"
                              #color: "0x00000058"
                    - type: view
                      style:
                        display: "inline-block"
                        marginLeft: "0.045"
                      children:
                        - type: label
                          textBoard:
                            - text: Phone
                            - text: "&nbsp;*"
                              color: "0xFB5051"
                          style:
                            color: "0x333333"
                            fontWeight: "500"

                            fontSize: ".Nfont.h14"
                        - type: textField # take users' input
                          viewTag: phoneNumberVT
                          contentType: phoneNumber
                          placeholder: "Enter here"
                          dataKey: formData.phoneNumber # users' input will be saved to this key
                          required: "true"
                          debounce: 200
                          onInput:
                            - actionType: evalObject
                              object:
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..formData.countryCode
                                          string2: "+965" # Kuwait
                                    - ..formData.checkOk@: true
                                    - =.builtIn.string.phoneVerification:
                                        dataIn:
                                          phoneNumber: =..formData.phoneNumber
                                          countryCode: =..formData.countryCode
                                        dataOut: SignIn.formData.checkOk
                            - actionType: evalObject
                              object:
                                - if:
                                    - =..formData.checkOk
                                    - actionType: evalObject
                                      object:
                                        - if:
                                            - =.builtIn.string.equal:
                                                dataIn:
                                                  string1: =..formData.password
                                                  string2: ""
                                            - ..sigInColor@: "0xC1C1C1"
                                            - ..sigInColor@: "0x2988e6ff"
                                    - ..sigInColor@: "0xC1C1C1"
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: SignInVT
                          onChange:
                            - emit:
                                actions:
                                  - actionType: evalObject
                                    object:
                                      - if:
                                          - =.builtIn.string.equal:
                                              dataIn:
                                                string1: =..formData.countryCode
                                                string2: "+965" # Kuwait
                                          - ..formData.checkOk@: true
                                          - =.builtIn.string.phoneVerification:
                                              dataIn:
                                                phoneNumber: =..formData.phoneNumber
                                                countryCode: =..formData.countryCode
                                              dataOut: SignIn.formData.checkOk
                                      - if:
                                          - =..formData.checkOk
                                          - continue
                                          - ..formData.checkMessage@: "Unacceptible phone number format example: 888-999-0000"
                                  - =.builtIn.string.concat:
                                      dataIn:
                                        - =.SignIn.formData.countryCode
                                        - " "
                                        - =.SignIn.formData.phoneNumber
                                      dataOut: SignIn.apiData.phoneNumber
                                  - =.builtIn.string.concat:
                                      dataIn:
                                        - "uid like '%"
                                        - =.SignIn.formData.countryCode
                                        - " "
                                        - =.SignIn.formData.phoneNumber
                                        - "'"
                                      dataOut: SignIn.rvCondition
                                  - ..formData.wrongPassword@: false
                                  - ..changeColor.phone.borderColor@: "0xF4F4F5"
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: phoneNumberVT
                          style:
                            textAlign:
                              x: left
                            fontSize: .Nfont.h1
                            left: "0"
                            width: "0.555"
                            height: "0.049"
                            marginTop: "0.005"

                            required: "true"
                            borderColor: ..changeColor.phone.borderColor
                            borderRadius: "4"
                            borderWidth: "1"
                            backgroundColor: "0xF4F4F5"
                            border:
                              style: "3"
                            box-sizing: "border-box"
                            textIndent: "1em"
                # - type: label
                #   text: Username SignIn
                #   style:
                #     left: "0.52"
                #     top: "0.04"
                #     width: "0.25"
                #     height: "0.046"
                #     color: "0xffffff"
                #     backgroundColor: "0x388eccff"
                #     fontSize: '12'
                #     border:
                #       style: "3"
                #     borderWidth: "1.5"
                #     borderRadius: "5"
                #     borderColor: "0xffffff"
                #     textAlign:
                #       x: center
                #       y: center
                #   onClick:
                #     - actionType: evalObject
                #       object:
                #         - ..apiData.phoneNumber@: ""
                #         - ..formData.phoneNumber@: "8888888888"
                #     - actionType: builtIn
                #       funcName: hide
                #       viewTag: usePhoneNumber
                #     - actionType: builtIn
                #       funcName: show
                #       viewTag: useUserName
                #     - actionType: builtIn
                #       funcName: redraw
                #       viewTag: useUserName
            - type: label
              textBoard:
                - text: Password
                - text: "&nbsp;*"
                  color: "0xFB5051"
              style:
                left: "0.1"
                marginTop: "0.02"
                color: "0x333333"
                fontWeight: "500"

                fontSize: ".Nfont.h14"
                width: "auto"
                textAlign:
                  x: left
                  y: center
            - type: view
              viewTag: "passwordVT"
              style:
                backgroundColor: "0xF4F4F5"
                width: "0.8"
                borderColor: ..changeColor.password.borderColor
                borderWidth: "1"
                marginLeft: "0.1"
                borderRadius: "4"
                marginTop: "0.005"
                border:
                  style: "3"
              children:
                - type: textField
                  contentType: password
                  placeholder: "Enter here"
                  dataKey: formData.password
                  required: "true"
                  style:
                    textAlign:
                      x: left
                    fontSize: .Nfont.h1
                    borderRadius: "4"
                    width: "0.8"

                    height: "0.049"
                    textIndent: "1em"
                    borderWidth: "1"
                    backgroundColor: "0xF4F4F5"
                    border:
                      style: "1"
                  onChange:
                    - actionType: evalObject
                      object:
                        - ..changeColor.password.borderColor@: "0xF4F4F5"
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: passwordVT
                  onInput:
                    - actionType: evalObject
                      object:
                        - if:
                            - =..formData.checkOk
                            - actionType: evalObject
                              object:
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..formData.password
                                          string2: ""
                                    - ..sigInColor@: "0xC1C1C1"
                                    - ..sigInColor@: "0x2988e6ff"
                            - ..sigInColor@: "0xC1C1C1"
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: SignInVT
            # - type: label
            #   text: Forgot password?
            #   onClick:
            #     - goto: .Config.prResetUrl
            #   style:
            #     color: "0x00000058"
            #     left: "0.56"
            #     top: "0.38"
            #     width: "0.32"
            #     height: "0.041"
            #     fontSize: "14"
            #     display: inline
            #     textAlign:
            #       x: right
            #       y: center
            - type: view
              style:
                width: "0.9"
                textAlign:
                  x: right
                  y: center
              children:
                - type: view
                  children:
                    - type: label
                      text: Forget password?
                      onClick:
                        - goto: .Config.prResetUrl
                      style:
                        color: "0x00000058"
                        fontSize: .Nfont.n3
                        marginTop: "0.015"
    - type: view
      style:
        top: "0.8"
      children:
        - type: button
          viewTag: SignInVT
          text: Sign In
          style:
            color: "0xffffffff"
            fontSize: ".Nfont.h18"
            fontStyle: bold
            marginLeft: "0.1"

            width: "0.8"
            marginTop: "0.045"
            borderRadius: "8"
            height: "0.05"
            backgroundColor: ..sigInColor #0x2988e6ff
            border:
              style: "1"
            display: inline
            textAlign:
              x: center
          onClick:
            - actionType: evalObject
              object:
                - if:
                    - =..formData.phoneNumber
                    - continue
                    - actionType: popUp
                      popUpView: NoPhoneNum
                      wait: true
            - actionType: evalObject
              object:
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =..formData.countryCode
                          string2: "+965" # Kuwait
                    - ..formData.checkOk@: true
                    - =.builtIn.string.phoneVerification:
                        dataIn:
                          phoneNumber: =..formData.phoneNumber
                          countryCode: =..formData.countryCode
                        dataOut: SignIn.formData.checkOk
                - if:
                    - ..formData.checkOk
                    - continue
                    - actionType: popUp
                      popUpView: WrongPhoneNum
                      wait: true
            - actionType: evalObject
              object:
                - if:
                    - =..formData.password
                    - continue
                    - actionType: popUp
                      popUpView: NoPassword
                      wait: true

            - actionType: evalObject
              object:
                - if:
                    - =.Global.currentUser.vertex.esk
                    - actionType: evalObject
                      object: ..save
                    - continue
            - actionType: evalObject
              object:
                - if:
                    - =.Global.currentUser.vertex.sk
                    - actionType: evalObject
                      object:
                        - =..listData.get: ""
                        - if:
                            - =..listData.family.vertex.0.id
                            - goto: ChooseUser #PatientDashboard
                            - goto: PatientDashboard
                    - continue
                - =.builtIn.string.concat:
                    dataIn:
                      - "uid like '%"
                      - =.SignIn.formData.countryCode
                      - " "
                      - =.SignIn.formData.phoneNumber
                      - "'"
                    dataOut: SignIn.rvCondition
            - actionType: evalObject
              object:
                - ..getVertex.response.vertex@: []
                - if:
                    - =..userNameRv
                    - ..rvCondition@: =..userNameRv
                    - continue
                - =..getVertex.vertexAPI.get: ""
                - if:
                    - =..getVertex.response.vertex.0.id
                    - actionType: evalObject
                      object:
                        - if:
                            - =..getVertex.response.vertex.0.pk
                            - continue
                            - actionType: popUp
                              popUpView: inviteUser
                              wait: true
                    - actionType: popUp
                      popUpView: userCannotfind
                      wait: true
            - actionType: evalObject
              object:
                - if:
                    - .builtIn.isAndroid
                    - actionType: evalObject
                      object:
                        - ..verificationCode.edge.name.AndroidSMSCode@: "B+ltrHEpySn"
                    - continue
                - if:
                    - =..formData.wrongPassword
                    - actionType: evalObject
                      object:
                        - =.builtIn.eccNaCl.decryptAES:
                            dataIn:
                              key: =..formData.password
                              message: =..loginNewDevice.response.edge.deat.esk
                            dataOut: SignIn.formData.sk
                        - =.builtIn.eccNaCl.skCheck:
                            dataIn:
                              pk: =..loginNewDevice.response.edge.deat.pk
                              sk: =..formData.sk
                            dataOut: SignIn.formData.pass
                        - if:
                            - =..formData.pass
                            - .Global.currentUser.vertex.sk@: =..formData.sk
                            - actionType: evalObject
                              object:
                                - ..formData.wrongPassword@: true
                                - actionType: popUp
                                  popUpView: WrongInformation
                                  wait: true
                        - =.builtIn.date.currentDateTime:
                            dataOut: Global.currentDateTime
                        - =.SignIn.retrieveVertex.vertexAPI.get: ""
                        - .Global.sigVertexResp@: =.SignIn.retrieveVertex.response.vertex.0
                        - ..myLoginTime@: =.Global.currentDateTime
                        - =.builtIn.string.concat:
                            dataIn:
                              - =.SignIn.loginUser2.edge.bvid
                              - " "
                              - =..myLoginTime
                            dataOut: SignIn.loginMessage
                        - =.builtIn.storeCredentials:
                            dataIn:
                              sk: =.Global.currentUser.vertex.sk
                        - =.builtIn.eccNaCl.signature:
                            dataIn:
                              message: =..loginMessage
                              sk: =.Global.currentUser.vertex.sk
                              eskSign: =..retrieveVertex.response.vertex.0.name.eskSign
                            dataOut: SignIn.loginUser2.edge.name.sig
                        - .SignIn.loginUser2.edge.name.ctime@: =..myLoginTime
                        - =.SignIn.loginUser2.edgeAPI.store: ""
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: ""
                        - =.SignIn.retrieveVertex.vertexAPI.get: ""
                        - .Global.loginUser.vertex@: =..retrieveVertex.response.vertex.0
                        - .Global.loginUser.JWT@: =..loginUser2.response.jwt
                        - .Global.currentUser.vertex@: =..retrieveVertex.response.vertex.0
                        - .Global.currentUser.JWT@: =..loginUser2.response.jwt
                        - .Global.phoneNumber@: =..formData.phoneNumber
                        - =.builtIn.storeCredentials:
                            dataIn:
                              sk: =.Global.currentUser.vertex.sk
                              pk: =.Global.currentUser.vertex.pk
                              userId: =.Global.currentUser.vertex.id
                              esk: =.Global.currentUser.vertex.esk
                        - .Global.currentUser.dataCache.loadingDateTime@: =.Global.currentDateTime
                        - .Global.rootNotebookID@: =.Global.currentUser.vertex.deat.rnb64ID
                        - .Global.currentUser.dataCache.loadingDateTime@: =.Global.currentDateTime
                        - if:
                            - =.Global.currentUser.vertex.sk
                            - actionType: evalObject
                              object:
                                - ..formData.wrongPassword@: false
                                - =..listData.get: ""
                                - if:
                                    - =..listData.family.vertex.0.id
                                    - goto: ChooseUser #PatientDashboard
                                    - goto: PatientDashboard
                            - continue
                        # - actionType: evalObject
                        #   object: ..verify
                        # - actionType: evalObject
                        #   object: ..update
                        # - actionType: evalObject
                        #   object: ..getFac
                        # - actionType: evalObject
                        #   object:
                        #     - if:
                        #       - =.Global.currentUser.vertex.sk
                        #       - actionType: evalObject
                        #         object:
                        #           - ..formData.wrongPassword@: "false"
                        #           - goto: Dashboard
                        #       - continue
                    - =.SignIn.verificationCode.edgeAPI.store: ""
            - actionType: evalObject
              object:
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =..verificationCode.response.code
                          string2: 1052
                    - actionType: popUp
                      popUpView: invaliduserid
                      wait: true
                    - continue
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =..verificationCode.response.code
                          string2: 3004
                    - actionType: popUp
                      popUpView: userCannotfind
                      wait: true
                    - continue
            - actionType: evalObject
              object:
                .Global._nonce@:
                  =.builtIn.math.random: ""
            - actionType: evalObject
              object:
                # - if:
                #   - =.builtIn.string.equalsLenString:
                #       dataIn:
                #         stringOne: =..formData.phoneNumber
                #         stringTwo: "888"
                #         len: 3
                #   - ..formData.code@: =.SignIn.verificationCode.response.edge.deat.verification_code
                #   - ..formData.code@: ""
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =..verificationCode.response.edge.tage
                          string2: "0"
                    - ..formData.code@: ""
                    - ..formData.code@: =.SignIn.verificationCode.response.edge.tage # - continue
            - actionType: evalObject
              object:
                .Global._nonce@:
                  =.builtIn.math.random: ""
            - actionType: builtIn
              funcName: redraw
              viewTag: inputVerificationCode
            - actionType: popUp
              popUpView: inputVerificationCode
              wait: true
        - type: view
          style:
            marginTop: "0.0375"
            width: "0.98"
            textAlign:
              x: center
          children:
            - type: view
              style:
                height: "auto"
                width: "auto"
              children:
                - type: label
                  text: New to AiTmed?
                  style:
                    color: "0xb1b1b1"
                    fontSize: .Nfont.h1
                    display: inline-block

                    # backgroundColor: "0xcdcdcd"
                - type: label
                  text: Sign Up
                  style:
                    color: "0x2988E6"
                    fontSize: .Nfont.h1
                    fontWeight: "400"

                    marginLeft: "0.02"
                    display: inline-block
                    border:
                      style: "1"
                  onClick:
                    - goto: SignUp

    - .TipsMultiLine:
      message: "Incorrect phone number and password"
      viewTag: WrongInformation

    - .TipsMultiLine:
      viewTag: "NoPhoneNum"
      message: Phone number or UserName and password required
      onClick:
        - actionType: evalObject
          object:
            - ..changeColor.phone.borderColor@: "0xFB5051"
            - ..changeColor.password.borderColor@: "0xFB5051"
            - ..changeColor.userName.borderColor@: "0xFB5051"
        - actionType: builtIn
          funcName: redraw
          viewTag: userNameVT
        - actionType: builtIn
          funcName: redraw
          viewTag: passwordVT
        - actionType: builtIn
          funcName: redraw
          viewTag: phoneNumberVT
        - actionType: popUpDismiss
          popUpView: __.viewTag

    - .TipsMultiLine:
      viewTag: "NoPassword"
      message: No password entered. Password required
      onClick:
        - actionType: evalObject
          object:
            - ..changeColor.password.borderColor@: "0xFB5051"
        - actionType: builtIn
          funcName: redraw
          viewTag: passwordVT
        - actionType: popUpDismiss
          popUpView: __.viewTag

    - .TipsMultiLine:
      viewTag: "WrongPhoneNum"
      message: Invalid phone number format Use numbers only, 10 digits required
      onClick:
        - actionType: evalObject
          object:
            - ..changeColor.phone.borderColor@: "0xFB5051"
        - actionType: builtIn
          funcName: redraw
          viewTag: phoneNumberVT
        - actionType: popUpDismiss
          popUpView: __.viewTag
    - .TipsOneLine:
      message: "Incorrect Password"
      viewTag: wrongPassword

    - .TipsOneLine:
      message: "Incorrect verificationCode"
      viewTag: wrongCode

    - .TipsOneLine:
      message: "Cannot Find the User"
      viewTag: userCannotfind

    - .TipsMultiLine:
      message: "Invalid Username: Required length should be 6 to 16"
      viewTag: invaliduserid

    - type: popUp
      viewTag: resetUser
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
        zIndex: "50"
        textAlign:
          y: center
      children:
        - type: view
          style:
            width: "0.7"
            marginLeft: "0.15"
            backgroundColor: "0xE6E6E6"
            borderRadius: "14px"
            textAlign:
              x: center
          children:
            - type: label
              text: Forget your password?
              style:
                marginLeft: "0.062"
                marginTop: "0.027"
                fontSize: .Nfont.n1_1
                fontWeight: "600"
                width: "0.576"

                color: "0x333333"
                textAlign:
                  x: center
            - type: label
              text: When using blockchain technology, there is no way for us at AiTmed to recover your password. It is blockchain-encrypted for your security and privacy.
              style:
                width: "0.576"
                marginLeft: "0.062"
                marginTop: "0.018"
                fontSize: .Nfont.n2

                textAlign:
                  x: center
                color: "0x333333"
            - type: label
              text: To reset your password, you must create a new account.
              style:
                width: "0.576"
                marginLeft: "0.062"
                marginTop: "0.018"
                fontSize: .Nfont.n2

                textAlign:
                  x: center
                color: "0x333333"
            - type: label
              text: THIS WILL RESET YOUR ACCOUNT AND DELETE ANY PREVIOUSLY STORED INFORMATION
              style:
                width: "0.576"
                marginLeft: "0.062"
                marginTop: "0.018"
                fontSize: .Nfont.n2

                textAlign:
                  x: center
                color: "0x333333"
            - type: label
              text: This action cannot be undone.
              style:
                width: "0.576"
                marginLeft: "0.062"
                marginTop: "0.018"
                fontSize: .Nfont.n2

                textAlign:
                  x: center
                color: "0x333333"
            - type: view
              style:
                height: "0.015"
                width: "0.7"
                border:
                  style: 2
                  color: "0x919192"
                borderWidth: "1"
            - type: view
              style:
                width: "0.7"
              children:
                - type: button
                  text: "Cancel"
                  style:
                    color: "0x007AFF"
                    backgroundColor: "0xE6E6E6"
                    display: inline-block
                    width: "0.349"
                    borderRadius: "0 0 0 14px"
                    fontSize: .Nfont.n2
                    height: "0.054"
                    border:
                      style: "1"
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: resetUser
                - type: view
                  style:
                    width: "0.002"
                    backgroundColor: "0x919192"
                    display: inline-block
                    height: "0.054"
                - type: button
                  text: "Sign Up"
                  style:
                    color: "0x007AFF"
                    fontWeight: "850"
                    backgroundColor: "0xE6E6E6"
                    display: inline-block
                    width: "0.349"
                    fontSize: .Nfont.n2
                    borderRadius: "0 0 14px 0"
                    height: "0.054"
                    border:
                      style: "1"
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: resetUser
                    - goto: SignUp
    - type: popUp # view
      viewTag: inviteUser
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
        zIndex: "50"
        textAlign:
          y: center
      children:
        - type: view
          style:
            width: "0.7"
            marginLeft: "0.15"
            backgroundColor: "0xE6E6E6"
            borderRadius: "14px"
            textAlign:
              x: center
          children:
            - type: label
              text: "This phone number has been invited, but not registered yet"
              style:
                width: "0.576"
                marginLeft: "0.062"
                marginTop: "0.018"
                fontSize: .Nfont.n2

                textAlign:
                  x: center
                color: "0x333333"
            - type: label
              text: "Would you like to sign up now?"
              style:
                width: "0.576"
                marginLeft: "0.062"
                marginTop: "0.018"
                fontSize: .Nfont.n2

                textAlign:
                  x: center
                color: "0x333333"
            - type: view
              style:
                height: "0.015"
                width: "0.7"
                border:
                  style: 2
                  color: "0x919192"
                borderWidth: "1"
            - type: view
              style:
                width: "0.7"
              children:
                - type: button
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: inviteUser
                  text: CANCEL
                  style:
                    color: "0x007AFF"
                    backgroundColor: "0xE6E6E6"
                    display: inline-block
                    width: "0.349"
                    borderRadius: "0 0 0 14px"
                    fontSize: .Nfont.n2
                    height: "0.054"
                    border:
                      style: "1"
                - type: view
                  style:
                    width: "0.002"
                    backgroundColor: "0x919192"
                    display: inline-block
                    height: "0.054"
                - type: button
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: inviteUser
                    - goto: SignUp
                  text: OKAY
                  style:
                    color: "0x007AFF"
                    fontWeight: "850"
                    backgroundColor: "0xE6E6E6"
                    display: inline-block
                    width: "0.349"
                    fontSize: .Nfont.n2
                    borderRadius: "0 0 14px 0"
                    height: "0.054"
                    border:
                      style: "1"

    - type: popUp
      viewTag: inputVerificationCode
      message: "Enter the 6-digit verification code"
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
        zIndex: "50"
        textAlign:
          y: center
      children:
        - type: view
          style:
            width: "0.72"
            marginLeft: "0.14"
            backgroundColor: "0xE6E6E6"
            borderRadius: "14px"
          children:
            - type: label
              text: ___.message
              style:
                width: "0.616"
                marginLeft: "0.052"
                fontWeight: "550"
                marginTop: "0.029"
                fontSize: .Nfont.h14

                textAlign:
                  x: center
                color: "0x333333"
            - type: textField
              contentType: text
              dataKey: formData.code
              required: "true"
              style:
                height: "0.035"
                width: "0.616"
                marginTop: "0.02"
                marginLeft: "0.052"
                backgroundColor: "0xffffff"
                border:
                  style: "1"
                borderRadius: "5"
                fontSize: .Nfont.n2
                textAlign:
                  x: center
                  y: center
            - type: view
              style:
                height: "0.02"
                border:
                  style: 2
                  color: "0x919192"
                borderWidth: "1"
                width: "0.72"
            - type: view
              style:
                width: "0.72"
              children:
                - type: button
                  text: "Cancel"
                  style:
                    color: "0x007AFF"
                    backgroundColor: "0xE6E6E6"
                    display: inline-block
                    width: "0.359"
                    borderRadius: "0 0 0 14px"
                    fontSize: .Nfont.n2
                    height: "0.054"
                    border:
                      style: "1"
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: inputVerificationCode
                - type: view
                  style:
                    width: "0.002"
                    backgroundColor: "0x919192"
                    display: inline-block
                    height: "0.054"
                - type: button
                  text: "OK"
                  style:
                    color: "0x007AFF"
                    fontWeight: "850"
                    backgroundColor: "0xE6E6E6"
                    display: inline-block
                    width: "0.359"
                    fontSize: .Nfont.n2
                    borderRadius: "0 0 14px 0"
                    height: "0.054"
                    border:
                      style: "1"
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: inputVerificationCode
                    - actionType: evalObject
                      object: ..check
                    - actionType: evalObject
                      object: ..verify
                    - actionType: evalObject
                      object: ..update
                    - actionType: evalObject
                      object:
                        - .Global.nonFirstProfile@: true
                    - actionType: evalObject
                      object:
                        - if:
                            - =.Global.currentUser.vertex.sk
                            - actionType: evalObject
                              object:
                                - =..listData.get: ""
                                - if:
                                    - =..listData.family.vertex.0.id
                                    - goto: ChooseUser #PatientDashboard
                                    - goto: PatientDashboard
                            - continue
