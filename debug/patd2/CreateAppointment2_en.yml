CreateAppointment2:
  title: "Create Appointment"
  pageNumber: "1960"
  init:
    - .SignInCheck
    - ..visitQuestionnaire.docAPI.get
    - actionType: evalObject
      object:
        .CreateAppointment2.visitQuestionnaireObject.document@: =..docResponse.doc.0
    - ..newAppointment.edge.name.duration@: =.Global.formData.appointment.duration
    - actionType: evalObject
      object:
        - =.builtIn.array.getListLength:
            dataIn:
              object: =.Global.formData.appointment.docu
            dataOut: CreateAppointment2.localDocuLength
    - actionType: evalObject
      object:
        - =.builtIn.array.getListLength:
            dataIn:
              object: =.Global.vaccine
            dataOut: CreateAppointment2.globalDocuLength
    - actionType: evalObject
      object:
        - =.builtIn.string.equal:
            dataIn:
              string1: =..localDocuLength
              string2: =..globalDocuLength
            dataOut: CreateAppointment2.otherFormRead
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =..localDocuLength
              string2: "0"
        - ..otherFormHid@: "true"
        - continue
    - =.builtIn.string.concat:
        dataIn:
          - =..selectDate
          - " at "
          - =.Global.clock.showTime
        dataOut: CreateAppointment2.selectDate
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.formData.appointment.visitType
              string2: "Telemedicine"
        - ..newAppointment.edge.name.fontColor@: "#30b354"
        - ..newAppointment.edge.name.fontColor@: "#ffc02d"
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.formData.appointment.visitType
              string2: "Telemedicine"
        - ..newAppointment.edge.name.blockColor@: "#e4f5e9"
        - ..newAppointment.edge.name.blockColor@: "#fff7e3"
    - actionType: evalObject
      object:
        - .Global.flag.isMeetingPatientchart@: flase
        - .Global.formData.selectCategory@: CreateAppointment2
    # - if:
    #   - .Global.middleInformation.PatientVisitInfo
    #   - continue
    #   - newAppointment.edge.name.patientName@: =..patient.name
  formData:
    cov19Test: ""
    pifzerBioNTech: ""
    moderna: ""
    gotoPage: ""
  selectDate: .Global.formData.appointment.selectDate
  patient: .Global.middleInformation.PatientVisitInfo
  localDocuLength: ""
  globalDocuLength: ""
  otherFormRead: ""
  otherForm: ""
  otherFormHid: "false"
  data:
    purpose: ""
    anythingElse: ""
    isPrescribed: ""
    isProblems: ""
    problems: ""
    isToEmergency: ""
    toEmergency: ""
    isFamilyHistoryChanges: ""
    familyHistoryChanges: ""
    isNewDrug: ""
    newDrug: ""
    notes: ""
  visitQuestionnaireObject:
    document:
      type: .DocType.VisitQuestionnaire
      eid: .Global.rootNotebookID
      name:
        type: "application/json"
        data:
          purpose: ""
          anythingElse: ""
          isPrescribed: ""
          isProblems: ""
          problems: ""
          isToEmergency: ""
          toEmergency: ""
          isFamilyHistoryChanges: ""
          familyHistoryChanges: ""
          isNewDrug: ""
          newDrug: ""
          notes: ""
    docAPI:
      .DocAPI: ""
      store:
        api: cd
        dataKey: visitQuestionnaireObject.document
        subtype:
          mediaType: "application/json"
  visitQuestionnaire:
    # document:
    docAPI:
      .DocAPI: ""
      get:
        dataKey: docResponse
        id: .Global.rootNotebookID
        xfname: "eid"
        type: .DocType.VisitQuestionnaire
        _nonce: =.Global._nonce
  # subvisitQuestionnaire:

  docResponse:
    doc:
      - type: .DocType.VisitQuestionnaire # - type: "257" # private profile
        eid: .Global.rootNotebookID
        name: ""
    error: ""
    jwt: ""
  inviteInfo:
    edge:
      .Edge: ""
      type: .EdgeType.InviteInfo
      refid: ""
      bvid: .Global.currentUser.vertex.id
      # evid: "NzczFCtoRgYkcD3yEvGhRA=="
      name:
        phoneNumber: ""
        firstName: ""
        lastName: ""
        name: ""
        hostName: =.Global.Profile.name.data.basicInfo.fullName
        roomName: ""
        date: ""
    edgeAPI:
      # .EdgeAPI: ""
      store:
        api: ce
        dataKey: inviteInfo.edge
  flag: "" # to judge whether the PatientChart and VisitQuestionnaire have been both filled in.
  newAppointment:
    response: ""
    edge:
      .Edge: ""
      # evid: .Global.currentUser.vertex.id
      evid: .MobileContacts1.roomId
      bvid: .Global.currentUser.vertex.id
      id: ""
      refid: "" #the_selected_time_slot_edge.id
      subtype: .Global.E2Subtype
      type: 40000
      name:
        patientName: =.Global.Profile.name.data.basicInfo.fullName
        patientPhoneNumber: .Global.currentUser.vertex.name.phoneNumber
        providerName: .Global.ActiveProvider.name.data.fullName
        patientAvatarId: .Global.Profile.name.data.avatar
        visitType: ""
        visitTypeShow: ""
        visitReason: ""
        Reason: "Cold"
        blockColor: ""
        fontColor: ""
        duration: ""
        date: ""
        facilityId: .Global.clock.bvid
        # document
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: newAppointment.edge
        dataOut: newAppointment.response
  save:
    - =.CreateAppointment2.newAppointment.edgeAPI.store: ""
  components:
    - .ProgressCheckView: ""
      message: "loading ..."
      viewTag: uploading
    - .BaseHeader:
    - .HeaderLeftButton:
      onClick:
        - actionType: builtIn
          funcName: goBack
    - type: view
      style:
        width: "1"
        height: "0.4"
        left: "0"
        backgroundColor: "0x2988e6"
        top: "0.1"
      children:
        - .CA1label:
          text: "Date & Time selected:"
          style:
            top: "0"
            width: "0.485"
            height: "0.035"
            border:
              style: "2"
            borderWidth: "2"
            borderColor: "0xffffff99"
        - .CA1label:
          dataKey: selectDate
          # text: February 12,2021 at 9:45 AM
          style:
            fontSize: .Nfont.h1
            # left: '0.08'
            top: "0.05"
            fontWeight: "600"
        - .CA1label:
          text: "Type"
          style:
            top: "0.1"
            width: "0.38"
            height: "0.035"
            border:
              style: "2"
            borderWidth: "2"
            borderColor: "0xffffff99"
        - .CA1label:
          dataKey: Global.formData.appointment.visitType
          # text: Office Visit
          style:
            top: "0.14"
            fontSize: "19"
        - .CA1label:
          text: "Duration"
          style:
            top: "0.1"
            left: "0.6"
            width: "0.18"
            height: "0.035"
            border:
              style: "2"
            borderWidth: "2"
            borderColor: "0xffffff99"
        - .CA1label:
          dataKey: newAppointment.edge.name.duration
          style:
            top: "0.14"
            fontSize: "19"
            left: "0.6"
        - .CA1label:
          text: "Reason for Visit"
          style:
            top: "0.19"
            width: "0.38"
            height: "0.035"
            border:
              style: "2"
            borderWidth: "2"
            borderColor: "0xffffff99"
        - .CA1label:
          dataKey: Global.formData.appointment.reason
          # text: "Follow-UP"
          style:
            top: "0.23"
            fontSize: "19"
        - .CA1label:
          text: Provider
          style:
            top: "0.19"
            width: "0.38"
            left: "0.6"
            height: "0.035"
            border:
              style: "2"
            borderWidth: "2"
            borderColor: "0xffffff99"
        - .CA1label:
          dataKey: Global.ActiveProvider.name.data.fullName
          # text: Aomas Mueller
          style:
            top: "0.23"
            fontSize: "19"
            left: "0.6"
        - type: button
          text: "Change details"
          onClick:
            - actionType: builtIn
              funcName: goBack
          style:
            width: "0.5"
            height: "0.05"
            top: "0.3"
            left: "0.25"
            borderRadius: "50"
            color: "0xff0000"
            backgroundColor: "0xffffff"
            border:
              style: "3"
              width: "1"
              color: "0xff0000"
            borderColor: "0xff0000"
            fontSize: "18"

            textAlign:
              x: center

    - type: view
      style:
        top: "0.5"
        height: "0.6"
        width: "1"
        left: "0"
      children:
        - type: view
          style:
            top: "0"
            width: "1"
            left: "0"
            height: "0.15"
          children:
            - type: label
              text: Please complete visit questionnaire
              style:
                left: "0.1"
                top: "0.04"
                height: "0.06"
                width: "0.9"
                color: "0x2988e6"
                fontSize: "18"
            - type: view
              onClick:
                - goto: VisitQuestionnaire
              style:
                left: "0"
                width: "1"
                top: "0.085"
                height: "0.035"
              children:
                - type: image
                  path:
                    emit:
                      actions:
                        - if:
                            - =.Global.visitQuestionnaireDoc
                            - selectBlueOn.svg
                            - selectOff.svg
                  style:
                    left: "0.1"
                    top: "0"
                    width: "0.055"
                - type: label
                  text: Visit Questionnaire
                  style:
                    left: "0.2"
                    top: "0"
                    width: "0.6"
                    height: "0.035"
                    fontSize: "18"
                    color: "0x2988e6"
        - type: view
          style:
            top: "0.13"
            width: "1"
            left: "0"
            height: "0.2"
          children:
            - type: label
              text: Optional Forms
              style:
                left: "0.1"
                top: "0"
                height: "0.06"
                width: "0.9"
                color: "0x2988e6"
                fontSize: "18"
            - type: view
              onClick:
                - goto: PatientChart
              style:
                left: "0"
                width: "1"
                top: "0.045"
                height: "0.035"
              children:
                - type: image
                  path:
                    emit:
                      actions:
                        - if:
                            - =.Global.formData.patientDoc.status.sharePatientChart
                            - selectBlueOn.svg
                            - selectOff.svg
                  style:
                    left: "0.1"
                    top: "0"
                    width: "0.055"
                - type: label
                  text: Patient Chart
                  style:
                    left: "0.2"
                    top: "0"
                    width: "0.4"
                    height: "0.035"
                    fontSize: "18"
                    color: "0x2988e6"
        - type: view
          style:
            top: "0.26"
            width: "1"
            left: "0"
            height: "0.15"
            isHidden: ..otherFormHid
          children:
            - type: label
              text: "Vaccines:"
              style:
                left: "0.2"
                top: "0.01"
                height: "0.03"
                width: "0.8"
                color: "0x2988e6"
                fontSize: "18"
            - type: image
              path:
                emit:
                  actions:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..localDocuLength
                              string2: =..globalDocuLength
                        - selectBlueOn.svg
                        - selectOff.svg
              style:
                left: "0.1"
                top: "0.012"
                width: "0.055"

            - type: list
              contentType: listObject
              listObject: .Global.formData.appointment.docu
              iteratorVar: itemObject
              style:
                top: "0.04"
                left: "0"
                width: "1"
                height: "0.1"
                margin: "0"
              children:
                - type: listItem
                  itemObject: ""
                  style:
                    left: "0"
                    marginTop: "0.01"
                    width: "1"
                    height: "0.035"
                  children:
                    - type: label
                      dataKey: itemObject
                      onClick:
                        - emit:
                            dataKey:
                              var: itemObject
                            actions:
                              - ..formData.gotoPage@: $var
                              - if:
                                  - =.builtIn.string.equal:
                                      dataIn:
                                        string1: $var
                                        string2: COVID-19 Testing
                                  # - goto: Cov19Test
                                  - ..formData.gotoPage@: Cov19Test
                                  - continue
                              - if:
                                  - =.builtIn.string.equal:
                                      dataIn:
                                        string1: $var
                                        string2: New Patient Forms
                                  # - goto: NewPatFormEditPage1
                                  - ..formData.gotoPage@: NewPatFormEditPage1
                                  - continue
                        - actionType: evalObject
                          object:
                            - goto: =..formData.gotoPage
                      style:
                        top: "0"
                        color: "0x2988e6"
                        fontSize: "18"
                        width: "0.35"
                        left: "0.2"
                        height: "0.035"
                        textAlign:
                          x: left
                        # top: '0.015'
                        # textIndent: '25px'
                        lineHeight: "2"
        - type: button
          text: "Create Appointment"
          onClick:
            - actionType: evalObject
              object:
                - ..newAppointment.edge.stime@: ""
                - ..newAppointment.edge.etime@: ""
                - ..newAppointment.edge.refid@: ""
                - ..newAppointment.edge.name.Reason@: ""
                - ..newAppointment.edge.stime@: =.Global.clock.stime
                - ..newAppointment.edge.etime@: =.Global.clock.etime
                - ..newAppointment.edge.refid@: =.Global.clock.refid
                - ..newAppointment.edge.name.Reason@: =.Global.formData.appointment.reason
                - ..newAppointment.edge.name.document@: =.Global.formData.appointment.docu
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =.Global.formData.appointment.visitType
                          string2: "Covid19Test"
                    - ..newAppointment.edge.name.fontColor@: "0x30b354"
                    - continue
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =.Global.formData.appointment.visitType
                          string2: "Office Visit"
                    - ..newAppointment.edge.name.fontColor@: "0xff8c00"
                    - continue
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =.Global.formData.appointment.visitType
                          string2: "Covid19Test"
                    - ..newAppointment.edge.name.blockColor@: "0xe4f5e9"
                    - continue
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =.Global.formData.appointment.visitType
                          string2: "Office Visit"
                    - ..newAppointment.edge.name.blockColor@: "0xfff7e3"
                    - continue
            - actionType: evalObject
              object:
                - =.builtIn.string.concat:
                    dataIn:
                      - =.Global.formData.appointment.reason
                    dataOut: CreateAppointment2.newAppointment.edge.name.visitReason
                - ..newAppointment.edge.name.visitType@: =.Global.formData.appointment.visitType
                - ..newAppointment.edge.name.visitTypeShow@: =.Global.formData.appointment.visitType
            - actionType: evalObject
              object:
                - if:
                    - =.Global.visitQuestionnaireDoc
                    - continue
                    - actionType: popUp
                      popUpView: judgeVisitQuestionnaire
            - actionType: popUp
              popUpView: uploading
            - actionType: evalObject
              object:
                - if:
                    - =.Global.visitQuestionnaireDoc
                    - actionType: evalObject
                      object: ..save
                    - continue
                - if:
                    - =.Global.visitQuestionnaireDoc
                    - =.builtIn.ecos.shareDoc:
                        dataIn:
                          sourceDoc: =.VisitQuestionnaire.visitQuestionnaireObject.document.doc
                          targetEdgeID: =..newAppointment.response.edge.id
                    - continue
                - if:
                    - =.Global.formData.patientDoc.status.sharePatientChart
                    - =.builtIn.ecos.shareDoc:
                        dataIn:
                          sourceDoc: =.PatientChart.PatientChartObject
                          targetEdgeID: =..newAppointment.response.edge.id
                    - continue
                - if:
                    - =.builtIn.array.has:
                        dataIn:
                          object: =.Global.vaccine
                          value: "PifzerBioNTech"
                    - =.builtIn.ecos.shareDoc:
                        dataIn:
                          sourceDoc: =.Global.formData.pifzerBioNTech
                          targetEdgeID: =..newAppointment.response.edge.id
                        dataOut: CreateAppointment2.formData.pifzerBioNTech
                    - continue
                - if:
                    - =.builtIn.array.has:
                        dataIn:
                          object: =.Global.vaccine
                          value: "PifzerBioNTech"
                    - actionType: evalObject
                      object:
                        - if:
                            - =.Global.formData.signature_pifzerBioNTech.id
                            - =.builtIn.ecos.shareDoc:
                                dataIn:
                                  sourceDoc: =.Global.formData.signature_pifzerBioNTech
                                  targetEdgeID: =..newAppointment.response.edge.id
                                  targetRoomName: "meetingRoom"
                                  targetFileID: =.CreateAppointment2.formData.pifzerBioNTech.doc.id
                            - continue
                    - continue
                - if:
                    - =.builtIn.array.has:
                        dataIn:
                          object: =.Global.vaccine
                          value: "Moderna"
                    - =.builtIn.ecos.shareDoc:
                        dataIn:
                          sourceDoc: =.Global.formData.moderna
                          targetEdgeID: =..newAppointment.response.edge.id
                        dataOut: CreateAppointment2.formData.moderna
                    - continue
                # - if:
                #   - =.builtIn.array.has:
                #       dataIn:
                #         object: =.Global.vaccine
                #         value: "Moderna"
                #   - actionType: evalObject
                #     object:
                #       - if:
                #         - =.Global.formData.signature_moderna.doc
                #         - =.builtIn.ecos.shareDoc:
                #             dataIn:
                #               sourceDoc: =.Global.formData.signature_moderna.doc
                #               targetEdgeID: =..newAppointment.response.edge.id
                #               targetRoomName: "meetingRoom"
                #               targetFileID: =.CreateAppointment2.formData.moderna.doc.id
                #         - continue
                #   - continue
            - actionType: evalObject
              object:
                - if:
                    - =.Global.formData.cov19Test.doc
                    - =.builtIn.ecos.shareDoc:
                        dataIn:
                          sourceDoc: =.Global.formData.cov19Test.doc
                          targetEdgeID: =..newAppointment.response.edge.id
                          targetRoomName: "meetingRoom"
                        dataOut: CreateAppointment2.formData.cov19Test
                    - continue
            - actionType: evalObject
              object:
                - if:
                    - =.Global.formData.front_IDCard.doc
                    - =.builtIn.ecos.shareDoc:
                        dataIn:
                          sourceDoc: =.Global.formData.front_IDCard.doc
                          targetEdgeID: =..newAppointment.response.edge.id
                          targetRoomName: "meetingRoom"
                          # targetFileID: =.CreateAppointment2.formData.cov19Test.doc.id
                    - continue
                - if:
                    - =.Global.formData.front_InsuranceCard.doc
                    - =.builtIn.ecos.shareDoc:
                        dataIn:
                          sourceDoc: =.Global.formData.front_InsuranceCard.doc
                          targetEdgeID: =..newAppointment.response.edge.id
                          targetRoomName: "meetingRoom"
                          # targetFileID: =.CreateAppointment2.formData.cov19Test.doc.id
                    - continue
                - if:
                    - =.Global.formData.back_InsuranceCard.doc
                    - =.builtIn.ecos.shareDoc:
                        dataIn:
                          sourceDoc: =.Global.formData.back_InsuranceCard.doc
                          targetEdgeID: =..newAppointment.response.edge.id
                          targetRoomName: "meetingRoom"
                          # targetFileID: =.CreateAppointment2.formData.cov19Test.doc.id
                    - continue
                - =.builtIn.ecos.shareDoc:
                    dataIn:
                      sourceDoc: =.Global.Profile
                      targetEdgeID: =..newAppointment.response.edge.id
            - actionType: evalObject
              object:
                - if:
                    - =.Global.visitQuestionnaireDoc
                    - actionType: evalObject
                      object:
                        - ..visitQuestionnaireObject.document.name.data@: =..data
                        - =.CreateAppointment2.visitQuestionnaireObject.docAPI.store: ""
                    - continue
            - actionType: popUpDismiss
              popUpView: uploading
            - actionType: popUp
              popUpView: createSuccessView
          style:
            width: "0.7"
            left: "0.15"
            height: "0.05"
            top: "0.4"
            fontSize: "18"
            color: "0xffffff"
            backgroundColor: "0x2988e6"
            borderRadius: "3"

            textAlign:
              x: center
    - .BaseCheckView: ""
      message: "You have not filled in the Patient Chart"
      viewTag: judgePatientChart
      colorChange: "0x2988e6"
      imgPath: aboutBlue.svg
      children:
        - type: view
          style:
            width: "0.8"
            height: "0.3"
            top: "0.3"
            left: "0.1"
            zIndex: "100"
            backgroundColor: "0xffffff"
            borderRadius: "7"
            border:
              style: "3"
            borderColor: "#f4f8fa"
            borderWidth: "3"
          children:
            - .BaseCheckViewImg:
            - .BaseCheckViewLabel:
            - .BaseCheckViewButton:
              onClick:
                - actionType: popUpDismiss
                  popUpView: ____.viewTag
    - .TipsMultiLine:
      viewTag: judgeVisitQuestionnaire
      message: "You have not filled in the Visit Questionnaire"
    # - .BaseCheckView: ""
    #   message: "You have not filled in the Visit Questionnaire"
    #   viewTag: judgeVisitQuestionnaire
    #   colorChange: "0x2988e6"
    #   imgPath: aboutBlue.svg
    #   children:
    #     - type: view
    #       style:
    #         width: "0.8"
    #         height: "0.3"
    #         top: "0.3"
    #         left: "0.1"
    #         zIndex: "100"
    #         backgroundColor: "0xffffff"
    #         borderRadius: "7"
    #         border:
    #           style: "3"
    #         borderColor: "#f4f8fa"
    #         borderWidth: "3"
    #       children:
    #         - .BaseCheckViewImg:
    #         - .BaseCheckViewLabel:
    #         - .BaseCheckViewButton:
    #           onClick:
    #             - actionType: popUpDismiss
    #               popUpView: ____.viewTag
    - .BaseCheckView: ""
      message: "You have not filled in the other forms"
      viewTag: judgeOtherForm
      colorChange: "0x2988e6"
      imgPath: aboutBlue.svg
      children:
        - type: view
          style:
            width: "0.8"
            height: "0.3"
            top: "0.3"
            left: "0.1"
            zIndex: "100"
            backgroundColor: "0xffffff"
            borderRadius: "7"
            border:
              style: "3"
            borderColor: "#f4f8fa"
            borderWidth: "3"
          children:
            - .BaseCheckViewImg:
            - .BaseCheckViewLabel:
            - .BaseCheckViewButton:
              onClick:
                - actionType: popUpDismiss
                  popUpView: ____.viewTag
    - type: popUp
      viewTag: createSuccessView
      style:
        width: "0.88"
        height: "0.3"
        top: "0.3"
        left: "0.06"
        borderRadius: "20"
        zIndex: "100"
        backgroundColor: "0xeaeaea"
      children:
        - type: label
          text: You have created an appointment successfully
          style:
            .LabelStyle:
              left: "0"
              top: "0.08"
              width: "0.89333"
              height: "0.05"
              color: "0x000000"
              fontSize: "19"
              display: inline
              # fontStyle: "bold"

              textAlign:
                x: center
                y: center
        - type: button
          text: ok
          style:
            width: "0.6"
            left: "0.14"
            height: "0.05"
            top: "0.2"
            fontSize: "20"
            color: "0x000000"
            textAlign:
              x: center
            border:
              style: "1"
              color: "0x000000"
          onClick:
            - goto: PatientDashboard
