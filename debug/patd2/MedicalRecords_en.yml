MedicalRecords:
  pageNumber: "310"
  title: Medical Documents
  init:
    - .SignInCheck
    # put time delay to fix get is fast than create problem
    - actionType: evalObject
      object:
        - =.builtIn.utils.setTimer:
            dataIn:
              timeUnix: =.Global.timeDelay
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - ..apiRequest.medicalRecords.docAPI.get
    # - actionType: evalObject
    #   object:
    #     - =.builtIn.array.getListLength:
    #         dataIn:
    #           object: =..apiRequest.medicalRecords.docQueryResp.doc
    #         dataOut: MedicalRecords.formData.docLength

    # - actionType: evalObject
    #   object:
    #     - if:
    #         - =.builtIn.string.equal:
    #             dataIn:
    #               string1: =..formData.docLength
    #               string2: "0"
    #         - continue
    #         - ..formData.flag@: "none"
    - ..formData.docList@: =..apiRequest.medicalRecords.docQueryResp.doc
    - =.builtIn.array.concatArray:
        dataIn:
          array1: =..formData.docList
          array2: []
          sortby: ctime
          orders: desc
        dataOut: MedicalRecords.formData.docList

    - =.builtIn.array.setFormJumpPage:
        dataIn:
          objArry: =..formData.docList
          docFormObj: =.DocumentList
        dataOut: MedicalRecords.formData.docJumpList

  apiRequest:
    # get all documents which create by patient
    # medicalRecords:
    #   docQueryResp: ""
    #   docQueryReq:
    #     ObjType: 12
    #     id: .Global.currentUser.vertex.id
    #     xfname: E.bvid
    #     obfname: ctime
    #     _nonce: =.Global._nonce
    #     sCondition: D.type in (151041,153601,163841) AND D.reid is not null
    #   docAPI:
    #     get:
    #       api: rd
    #       dataIn: MedicalRecords.apiRequest.medicalRecords.docQueryReq
    #       dataOut: MedicalRecords.apiRequest.medicalRecords.docQueryResp
    # medicalRecords:
    #   docQueryResp: ""
    #   docQueryReq:
    #     ObjType: 8
    #     id: .Global.currentUser.vertex.id
    #     xfname: E.bvid | E.evid
    #     obfname: ctime
    #     _nonce: =.Global._nonce
    #     maxcount: "100"
    #     sCondition: D.type in (153601) AND E.type=40000
    #   docAPI:
    #     get:
    #       api: rd
    #       dataIn: MedicalRecords.apiRequest.medicalRecords.docQueryReq
    #       dataOut: MedicalRecords.apiRequest.medicalRecords.docQueryResp

    #Query using ObjType8 so slow, changed to use 1344.
    #get all doc related to patient, need to filter out profile and categorize into diff types
    medicalRecords:
      docQueryResp: ""
      docQueryReq:
        ObjType: 1344
        id: .Global.currentUser.vertex.id
        xfname: E.bvid | E.evid
        obfname: ctime
        _nonce: =.Global._nonce
        maxcount: "100"
        sCondition: .DocumentQuery.PatientAllMeetingDocumentsFor1344
      docAPI:
        get:
          api: rd
          dataIn: MedicalRecords.apiRequest.medicalRecords.docQueryReq
          dataOut: MedicalRecords.apiRequest.medicalRecords.docQueryResp
  formData:
    flag: "block"
    docLength: ""
    tempTitle: ""
    docList: []
    docJumpList: []
    searchContent: ""
    searchList: []
    displaySearchFlag: "none"
    displayEmptyFlag: "none"
    displayAllFlag: "block"
    displayDeleFlag: "hidden"
  formDataTemp:
    tabTemp:
      - title: Documents
        fontColor: "0x2988e6"
        fontWeight: "500"
        block: "block"
      - title: History
        fontColor: "0x4b4b4b"
        fontWeight: "400"
        block: "none"
    titleData:
      - title: All
        fontColor: "0x2988e6"
        borderColor: "0x2988e6"
        backgroundColor: "0xe6effc"
        tagCategory: ""
      - title: Patient
        fontColor: "0xf8ae29"
        borderColor: "0xfff4e0"
        backgroundColor: "0xfff4e0"
        tagCategory: classTag
      - title: Provider
        fontColor: "0x30b354"
        borderColor: "0xe4f5e9"
        backgroundColor: "0xe4f5e9"
        tagCategory: classTag
      - title: Admin
        fontColor: "0x005795"
        borderColor: "0xe9f2fc"
        backgroundColor: "0xe9f2fc"
        tagCategory: classTag
  components:
    - .BasePublicHeader:
      children:
        - .BasePublicHeaderLeft:
        - .BasePublicHeaderTitle:
    - type: view
      style:
        width: "1"
        height: "auto"
        backgroundColor: "0x2887e5"
        overflow: hidden

      children:
        - type: view
          style:
            marginTop: "0.01"
            marginLeft: "0.04"
            width: "0.92"
            height: "0.0418"
            boxSizing: "border-box"
          children:
            - type: view
              style:
                display: "inline-block"
                # width: "0.768"
                width: "0.92"
                height: "0.0418"
                backgroundColor: "0xffffff"
                borderRadius: "4"
                boxSizing: "border-box"
                overflow: hidden
                verticalAlign: middle
              children:
                - type: image
                  path: search.svg
                  style:
                    marginLeft: "0.04"
                    display: "inline-block"
                    height: "0.02"
                    verticalAlign: middle

                - type: textField
                  viewTag: searchContentTag
                  placeholder: Search
                  dataKey: formData.searchContent
                  onInput:
                    - ..event.searchEvent
                  style:
                    marginLeft: "0.02"
                    verticalAlign: middle
                    display: "inline-block"
                    border:
                      style: 1
                    height: "0.041"
                    boxSizing: "border-box"
                    # width: "0.65"
                    width: "0.573333"
                - type: image
                  viewTag: searchVT
                  path: searchCancel.svg
                  onClick:
                    - ..event.clearClick
                  style:
                    height: "0.018"
                    marginLeft: "0.012"
                    display: inline-block
                    verticalAlign: "middle"
                    visibility: ..formData.displayDeleFlag
                - type: label
                  text: Search
                  onClick:
                    - ..event.searchClick
                  style:
                    height: auto
                    fontSize: .Nfont.h14
                    width: auto
                    color: "0x2988E6"
                    marginLeft: "0.032"
                    verticalAlign: "middle"
                    display: inline-block
            # - type: label
            #   text: Edit
            #   onClick:
            #     - goto: MedicalRecordsEdit
            #   style:
            #     marginLeft: "0.048"
            #     verticalAlign: middle
            #     display: "inline-block"
            #     fontSize: .Nfont.h14
            #     width: "auto"
            #     height: "auto"
            #     color: "0xffffff"
            #     fontWeight: "700"
        - type: view
          style:
            marginTop: "0.0147"
    # 暂时注释
    # - type: view
    #   viewTag: filterTag
    #   style:
    #     marginTop: "0"
    #     width: "1"
    #     height: " 0.0628"
    #     border:
    #       style: 2
    #     borderWidth: "1"
    #     borderColor: "0xdedede"
    #     boxSizing: "border-box"
    #     # backgroundColor: "pink"
    #     overflow: hidden
    #   children:
    #     - type: list
    #       androidGrid: true
    #       contentType: listObject
    #       listObject: ..formDataTemp.titleData
    #       iteratorVar: itemObject
    #       style:
    #         margin: "0"
    #         width: "1"
    #         height: "auto"
    #         boxSizing: "border-box"
    #         overflow: hidden
    #       children:
    #         - type: listItem
    #           itemObject:
    #           style:
    #             width: "0.2"
    #             height: "auto"
    #             display: "inline-block"
    #             boxSizing: "border-box"
    #             overflow: hidden
    #           onClick:
    #             - emit:
    #                 dataKey:
    #                   var: itemObject
    #                 actions:
    #                   - =.builtIn.object.setProperty:
    #                       dataIn:
    #                         obj: =..formDataTemp.titleData
    #                         label: "title"
    #                         text: $var.title
    #                         arr: ["borderColor"]
    #                         valueArr: $var.fontColor
    #                         errorArr: ["0x00000000"]
    #                   - =.builtIn.array.filterByTag:
    #                       dataIn:
    #                         sourceDoc: =..formData.docList
    #                         tagCategory: $var.tagCategory
    #                         tagName: $var.title
    #                       dataOut: MedicalRecords.formData.tempList
    #             - actionType: evalObject
    #               object:
    #                 - =.builtIn.array.concatArray:
    #                     dataIn:
    #                       array1: =..formData.tempList
    #                       array2: []
    #                       sortby: ctime
    #                       orders: desc
    #                     dataOut: MedicalRecords.formData.tempList
    #             - actionType: builtIn
    #               funcName: redraw
    #               viewTag: filterTag
    #             - actionType: builtIn
    #               funcName: redraw
    #               viewTag: docListTag
    #           children:
    #             - type: label
    #               dataKey: itemObject.title
    #               style:
    #                 marginTop: "0.02"
    #                 marginLeft: "0.04"
    #                 height: "0.025"
    #                 width: "0.16"
    #                 fontSize: .Nfont.h12
    #                 color: itemObject.fontColor
    #                 border:
    #                   style: 3
    #                 borderColor: itemObject.borderColor
    #                 backgroundColor: itemObject.backgroundColor
    #                 fontWeight: "600"
    #                 boxSizing: "border-box"
    #                 borderRadius: "3"
    #                 textAlign:
    #                   x: center
    #                   y: center
    - type: view
      style:
        width: "1"
        height: "auto"
      children:
        - type: view
          viewTag: emptyTag
          style:
            margin: "0"
            height: "auto"
            width: "1"
            display: ..formData.displayEmptyFlag
          children:
            - type: image
              path: emptyPage.svg
              style:
                width: "0.8"
                marginLeft: "0.1"
                marginTop: "0.15"
            - type: label
              text: "There is no result now."
              style:
                fontSize: .Nfont.h14
                width: "0.9"
                marginTop: "0.03"
                marginLeft: "0.05"
                height: "0.05"
                color: "#666666"
                textAlign:
                  x: center
                  y: center
        - type: view
          viewTag: docListTag
          style:
            height: "0.87"
            display: ..formData.displayAllFlag
          children:
            - type: list
              contentType: listObject
              listObject: ..formData.docJumpList
              iteratorVar: itemObject
              style:
                width: "1"
                margin: "0"
                height: "0.87"
                overflow: scroll
              children:
                - type: listItem
                  itemObject:
                  style:
                    width: "1"
                    height: "auto"
                    left: "0"
                    marginTop: "0"
                    boxSizing: "border-box"
                    overflow: hidden
                  children:
                    - type: view
                      style:
                        marginTop: "0.0173"
                        marginLeft: "0.04"
                        width: "0.92"
                        height: "auto"
                        overflow: hidden
                        boxSizing: "border-box"
                      children:
                        - type: label
                          dataKey: itemObject.name.title
                          style:
                            display: "inline-block"
                            width: "0.7"
                            height: "auto"
                            fontSize: .Nfont.h16
                            fontWeight: "600"
                            verticalAlign: middle
                            wordBreak: break-word
                        - type: view
                          style:
                            marginLeft: "0.058"
                            display: "inline-block"
                            verticalAlign: middle
                            width: "0.16"
                            height: "auto"
                          children:
                            - type: label
                              dataKey: itemObject.name.data.classTag.name
                              style:
                                height: "0.025"
                                width: "0.16"
                                fontSize: .Nfont.h12
                                color: itemObject.name.data.classTag.fontColor
                                border:
                                  style: 1
                                backgroundColor: itemObject.name.data.classTag.backgroundColor
                                fontWeight: "600"
                                boxSizing: "border-box"
                                borderRadius: "3"
                                textAlign:
                                  x: center
                                  y: center

                    - type: view
                      style:
                        marginTop: "0.001"
                        marginLeft: "0.04"
                        width: "0.92"
                        height: "auto"
                        overflow: hidden
                        boxSizing: "border-box"
                      children:
                        - type: label
                          dataKey: itemObject.name.user
                          style:
                            display: "inline-block"
                            width: "0.42"
                            height: "auto"
                            fontSize: .Nfont.h12
                            verticalAlign: middle
                            wordBreak: break-word
                            color: "0x666666"
                        - type: label
                          text=func: .builtIn.string.formatUnixtime_en
                          dataKey: itemObject.mtime
                          style:
                            marginLeft: "0.08"
                            display: "inline-block"
                            width: "0.42"
                            height: "auto"
                            fontSize: .Nfont.h12
                            verticalAlign: middle
                            wordBreak: break-word
                            color: "0x999999"
                            textAlign:
                              x: right

                    - type: view
                      style:
                        marginTop: "0.0173"
                        width: "1"
                        height: "1px"
                        backgroundColor: "0xdedede"
                        boxSizing: "border-box"
                  onClick:
                    - actionType: updateObject
                      dataKey: Global.Note
                      dataObject: itemObject
                    - actionType: updateObject
                      dataKey: Global.DocReference.document
                      dataObject: itemObject
                    - actionType: evalObject
                      object:
                        - .Global.formData.pageName@: MedicalRecords
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - goto: $var.pageName
        - type: view
          viewTag: SearchFlag
          style:
            height: "0.87"
            display: ..formData.displaySearchFlag
          children:
            - type: list
              contentType: listObject
              listObject: ..formData.searchList
              iteratorVar: itemObject
              style:
                width: "1"
                margin: "0"
                height: "0.87"
                overflow: scroll
              children:
                - type: listItem
                  itemObject:
                  style:
                    width: "1"
                    height: "auto"
                    left: "0"
                    marginTop: "0"
                    boxSizing: "border-box"
                    overflow: hidden
                  children:
                    - type: view
                      style:
                        marginTop: "0.0173"
                        marginLeft: "0.04"
                        width: "0.92"
                        height: "auto"
                        overflow: hidden
                        boxSizing: "border-box"
                      children:
                        - type: label
                          dataKey: itemObject.name.title
                          style:
                            display: "inline-block"
                            width: "0.7"
                            height: "auto"
                            fontSize: .Nfont.h16
                            fontWeight: "600"
                            verticalAlign: middle
                            wordBreak: break-word
                        - type: view
                          style:
                            marginLeft: "0.058"
                            display: "inline-block"
                            verticalAlign: middle
                            width: "0.16"
                            height: "auto"
                          children:
                            - type: label
                              dataKey: itemObject.name.data.classTag.name
                              style:
                                height: "0.025"
                                width: "0.16"
                                fontSize: .Nfont.h12
                                color: itemObject.name.data.classTag.fontColor
                                border:
                                  style: 1
                                backgroundColor: itemObject.name.data.classTag.backgroundColor
                                fontWeight: "600"
                                boxSizing: "border-box"
                                borderRadius: "3"
                                textAlign:
                                  x: center
                                  y: center

                    - type: view
                      style:
                        marginTop: "0.001"
                        marginLeft: "0.04"
                        width: "0.92"
                        height: "auto"
                        overflow: hidden
                        boxSizing: "border-box"
                      children:
                        - type: label
                          dataKey: itemObject.name.user
                          style:
                            display: "inline-block"
                            width: "0.42"
                            height: "auto"
                            fontSize: .Nfont.h12
                            verticalAlign: middle
                            wordBreak: break-word
                            color: "0x666666"
                        - type: label
                          text=func: .builtIn.string.formatUnixtime_en
                          dataKey: itemObject.mtime
                          style:
                            marginLeft: "0.08"
                            display: "inline-block"
                            width: "0.42"
                            height: "auto"
                            fontSize: .Nfont.h12
                            verticalAlign: middle
                            wordBreak: break-word
                            color: "0x999999"
                            textAlign:
                              x: right

                    - type: view
                      style:
                        marginTop: "0.0173"
                        width: "1"
                        height: "1px"
                        backgroundColor: "0xdedede"
                        boxSizing: "border-box"
                  onClick:
                    - actionType: updateObject
                      dataKey: Global.Note
                      dataObject: itemObject
                    - actionType: updateObject
                      dataKey: Global.DocReference.document
                      dataObject: itemObject
                    - actionType: evalObject
                      object:
                        - .Global.formData.pageName@: MedicalRecords
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - goto: $var.pageName

    - .SoftTips:
      message: You need to write before search next
      style:
        zIndex: "100"
      viewTag: errorVT
  event:
    searchEvent:
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..formData.searchContent
                    string2: ""
              - ..formData.displayDeleFlag@: "hidden"
              - ..formData.displayDeleFlag@: "visible"
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..formData.searchContent
                    string2: ""
              - actionType: builtIn
                funcName: hide
                viewTag: SearchFlag
              - continue
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..formData.searchContent
                    string2: ""
              - actionType: builtIn
                funcName: hide
                viewTag: emptyTag
              - continue
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..formData.searchContent
                    string2: ""
              - actionType: builtIn
                funcName: show
                viewTag: docListTag
              - continue
      - actionType: builtIn
        funcName: redraw
        viewTag: searchVT
    clearClick:
      - actionType: evalObject
        object:
          - ..formData.searchContent@: ""
          - ..formData.displayDeleFlag@: "hidden"
          - ..formData.displaySearchFlag@: "none"
          - ..formData.displayEmptyFlag@: "none"
          - ..formData.displayAllFlag@: "block"
      - actionType: builtIn
        funcName: redraw
        viewTag: searchVT
      - actionType: builtIn
        funcName: redraw
        viewTag: searchContentTag
      - actionType: builtIn
        funcName: redraw
        viewTag: docListTag
      - actionType: builtIn
        funcName: redraw
        viewTag: SearchFlag
      - actionType: builtIn
        funcName: redraw
        viewTag: emptyTag
    searchClick:
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..formData.searchContent
                    string2: ""
              - actionType: popUp
                popUpView: errorVT
                wait: true
                popUpDismiss: 2000
              - actionType: evalObject
                object:
                  - =.builtIn.object.matchSearchValue:
                      dataIn:
                        objArr: =..formData.docJumpList
                        paths:
                          - name.title
                          - name.user
                        value: =..formData.searchContent
                      dataOut: MedicalRecords.formData.searchList
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.array.judgeListLength:
                  dataIn:
                    array: =..formData.searchList
                    len: 0
              - actionType: evalObject
                object:
                  - ..formData.displaySearchFlag@: "none"
                  - ..formData.displayEmptyFlag@: "block"
                  - ..formData.displayAllFlag@: "none"
              - actionType: evalObject
                object:
                  - ..formData.displaySearchFlag@: "block"
                  - ..formData.displayEmptyFlag@: "none"
                  - ..formData.displayAllFlag@: "none"
      - actionType: builtIn
        funcName: redraw
        viewTag: searchContentTag
      - actionType: builtIn
        funcName: redraw
        viewTag: docListTag
      - actionType: builtIn
        funcName: redraw
        viewTag: SearchFlag
      - actionType: builtIn
        funcName: redraw
        viewTag: emptyTag
