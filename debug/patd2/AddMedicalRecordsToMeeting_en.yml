AddMedicalRecordsToMeeting:
  title: Medical Documents
  init:
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - .SignInCheck
    - ..apiRequest.medicalRecords.docAPI.get
  apiRequest:
    # get all documents which create by patient
    medicalRecords:
      docQueryResp: ""
      docQueryReq:
        ObjType: 12
        id: .Global.currentUser.vertex.id
        xfname: E.bvid&D.ovid
        obfname: ctime
        _nonce: =.Global._nonce
        sCondition: D.type in (1025,153601) AND D.reid is not null
      docAPI:
        get:
          api: rd
          dataIn: AddMedicalRecordsToMeeting.apiRequest.medicalRecords.docQueryReq
          dataOut: AddMedicalRecordsToMeeting.apiRequest.medicalRecords.docQueryResp
  formData:
    selectDoc: []
    attachments: []
  components:
    - .BaseHeader:
    - .HeaderLeftBack:
        # - .HeaderRightImg:
        #   path: addWhite.svg
        #   onClick:
        #     - goto: AddDocuments
    - type: list
      contentType: listObject
      listObject: ..apiRequest.medicalRecords.docQueryResp.doc
      iteratorVar: itemObject
      viewTag: select
      style:
        top: "0.1"
        left: "0"
        width: "1"
        height: "0.89"
        overflow: scroll

      children:
        - type: listItem
          itemObject: ""
          viewTag: select
          style:
            width: "1"
            height: "auto"
            border:
              style: "2"
            borderColor: "0xf3f3f3"
            backgroundColor: "0xffffffff"
            overflow: hidden
          children:
            - type: view
              style:
                marginTop: "0.02"
                marginLeft: "0.05"
                width: "0.9"
                height: "auto"
              children:
                - type: view
                  style:
                    display: "inline-block"
                    width: "0.7"
                    height: "auto"
                  children:
                    - type: label
                      dataKey: itemObject.name.title
                      style:
                        width: "0.8"
                        height: "auto"
                        fontWeight: "600"
                        fontSize: .Nfont.h14
                        wordWrap: break-word
                    - type: label
                      text=func: .builtIn.string.formatUnixtimeL_en
                      dataKey: itemObject.ctime
                      style:
                        marginTop: "0.01"
                        display: "inline-block"
                        width: "0.8"
                        height: "auto"
                        fontSize: .Nfont.h14
                - type: label
                  text=func: .builtIn.string.formatUnixtimeLT_en
                  dataKey: itemObject.ctime
                  style:
                    display: "inline-block"
                    width: "0.2"
                    height: "auto"
                    fontSize: .Nfont.h14
            - type: view
              style:
                marginTop: "0.02"
          onClick:
            - emit:
                dataKey:
                  var: itemObject
                actions:
                  - =.builtIn.array.add:
                      dataIn:
                        object: =..formData.selectDoc
                        value: $var
                  - =.builtIn.ecos.copyDocToAttachment:
                      dataIn:
                        sourceDocList: =..formData.selectDoc
                        newType: =.DocType.Attachment
                      dataOut: AddMedicalRecordsToMeeting.formData.attachments
                  - =.builtIn.object.extract:
                      dataIn:
                        array: =..formData.attachments
                        field: doc
                      dataOut: AddMedicalRecordsToMeeting.formData.attachments
                  - =.builtIn.array.concat:
                      dataIn:
                        array1: =..formData.attachments
                        array2: =.Global.formData.attachments
                      dataOut: Global.formData.attachments
            - actionType: builtIn
              funcName: goBack
              reload: true
