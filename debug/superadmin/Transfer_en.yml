Transfer:
  title:  Transfer
  init:
    - =.builtIn.array.setList: 
        dataIn:
          arr: =.SideMenuBarDM.SourceData
          level: 1
          title: Payment
        dataOut: Global.menuBar.listData
    # - .Global.menuBar.listData@: =.SideMenuBarDM.Payment
    - ..apiRequest.squareFacility.edgeAPI.get: ""
    - ..formData.transferList@: =..apiRequest.squareFacility.edgeResp.edge
    - =.builtIn.array.splitTableList: 
        dataIn: 
          arrObj: =..formData.transferList
          numX: "12"
          numY: "1"
        dataOut: Transfer.formData.tableData
    - ..formData.tableList@: =..formData.tableData.0
    - =.builtIn.string.concat:
        dataIn:
          - =..formData.tablePageNum # page num
          - " / "
          - =..formData.tableData.1 # total page
        dataOut: Transfer.formData.tableCurrentPage # current page                           
    - =.builtIn.number.addition: # get totalPage+1 to verify legitimacy of gotoPageNum
        dataIn:
          num: =..formData.tableData.1
          step: "1"
        dataOut: Transfer.formData.totalPageMore # update page num       
    - =.builtIn.array.setPropertyInterlacedChange:
        dataIn:
          arrIn: =..formData.tableList
          arr: ["backgroundColor"]
          valueArr: ["0xf5f5f5"]
          errorArr: ["0xffffff"]    
  formData: 
    searchFacility: ""
    searchFacilityArray: []  # 筛选需要输入数组，把当前的facility放进数组里
    transferList: []
    tableData: [] # sdk 返回的数组,包括当前显示第几页的数据list 和 被切分成总共多少页面
    tableList: [] # sdk 返回的数组的第一项，list真正打印的数据
    tablePageNum: "1" # previous和next 中间的文本显示的数据
    tableCurrentPage: "1" # 当前显示的当前页面/总页面
    gotoPageNum: "" # goto 后面的文本显示
    totalPageMore: "" # totalPage(tableData.1) + 1 
  apiRequest:
    # 当前所有开启了支付功能的Facility的列表
    squareFacility:
      edgeResp: "" 
      edgeIn: 
        id: .Global.currentUser.vertex.id
        xfname: bvid
        type: 1113
        maxcount: "1000"
        _nonce: =.Global._nonce
        obfname: ctime
      edgeAPI: 
        get: 
          api: re
          dataIn: apiRequest.squareFacility.edgeIn
          dataOut: Transfer.apiRequest.squareFacility.edgeResp    
    # 被点击的facility的payment setting。获取提前方式
    paymentSetting: 
      docResp: ""
      docIn: 
        type: .DocType.PaymentSettings
        xfname: eid
        id: ""
        maxcount: "1"
      docAPI: 
        get: 
          api: rd
          dataIn: apiRequest.paymentSetting.docIn
          dataOut: CashOut.apiRequest.paymentSetting.docResp
    # the default cashout document
    createCashout:
      docResp: ""
      docIn:
        eid: "" # when click cash out button give the type=1113 edge id
        type: 2003
        name: 
          title: "" # let user input the value 
          data: 
            orderInfo:    # 订单信息 
              squareID: ""
              squareURL: ""
              amount: ""
              # balance: "" in deat 
              # status: ""  in deat
              processFee: ""    # 手续费
              payer: "AiTmed"
            appointmentInfo:   # 预约信息/会议信息
              reason: "--"
              providerName: "--"
              visitType: "--" # appointment type: egg.Telemedicine,Office Visit
              appTime: "--"
            cashOutInfo: 
              payee: ""
              upToDateTGI: ""
              lcoDate: "--"     # last cash out Date
              lcoAmount: "--"   # last cash out amount
              minBalance: "5000"  # minimal balance
              lsBal: ""       # last statement balance
              ncoDate: "01/12/2022"     # next cash out date
              ACHorCheckNumber: ""    # ACH Or Check number
              status: ""        # Statement status
              statusColor: ""   # Statement status color
      docAPI: 
        store:
          api: cd
          dataIn: apiRequest.createCashout.docIn
          dataOut: CashOut.apiRequest.createCashout.docResp
  components:
    - .TotalView: 
      children: 
        - .SideMenuBar: 
          children:
            - .aitLogo:
            - .MenuBar:        
        - .TopBar: 
        - .InnerBodyView:
          children:
            - .TransactionsAndMoneyView: 
              children:
                - .PageTitleLabelHasReceivedMoney:
            - .ContentBar:
              viewTag: statementMainTag
              children:
                - type: view
                  style:
                    width: "0.76"
                    left: "0.028"
                    marginTop: "0.032"
                    display: flex
                    justifyContent: space-between
                  children:
                    - type: view
                      viewTag: searchTag
                      style:
                        height: "0.032"
                        display: inline-block
                      children: 
                        - type: image
                          path: searchGray.svg
                          style:
                            width: "0.01"
                            top: "0.008"
                            left: "0.008"
                            zIndex: "10"
                        - type: textField
                          placeholder: Search facility
                          dataKey: formData.searchFacility
                          style:
                            width: "0.64"
                            height: "0.032"
                            border: 
                              style: "3"
                            borderColor: "0xdedede"
                            borderRadius: "5px"
                            textIndent: 3em

                    - type: view
                      style:
                        display: flex
                        justifyContent: space-around
                        alignItems: center
                        width: "0.11"
                      children: 
                        # Update 按钮
                        - type: button
                          text: Update
                          style:
                            width: "0.06"
                            height: "0.036"
                            display: inline-block                        
                            backgroundColor: "0x0063a8"
                            color: "0xffffff"
                            fontWeight: "500"
                            borderRadius: "3"
                            fontSize: .Nfont.n6_1_1
                            border: 
                              style: "1"
                            textAlign:
                              x: center
                              y: center
                          onClick:
                            - actionType: evalObject
                              object:
                                - =.builtIn.array.vagueFilterArrayByPath:
                                    dataIn:
                                      objArr: =..formData.transferList
                                      path: name.facilityName
                                      compareStr: =..formData.searchFacility
                                    dataOut: Transfer.formData.transferList
                                - =.builtIn.array.splitTableList: 
                                    dataIn: 
                                      arrObj: =..formData.transferList
                                      numX: "12"
                                      numY: "1"
                                    dataOut: Transfer.formData.tableData
                                - ..formData.tableList@: =..formData.tableData.0
                                - =.builtIn.string.concat:
                                    dataIn:
                                      - =..formData.tablePageNum # page num
                                      - " / "
                                      - =..formData.tableData.1 # total page
                                    dataOut: Transfer.formData.tableCurrentPage # current page                           
                                - =.builtIn.number.addition: # get totalPage+1 to verify legitimacy of gotoPageNum
                                    dataIn:
                                      num: =..formData.tableData.1
                                      step: "1"
                                    dataOut: Transfer.formData.totalPageMore # update page num       
                                - =.builtIn.array.setPropertyInterlacedChange:
                                    dataIn:
                                      arrIn: =..formData.tableList
                                      arr: ["backgroundColor"]
                                      valueArr: ["0xf5f5f5"]
                                      errorArr: ["0xffffff"]                                       
                                # - ..formData.searchFacility@: ""
                                # - ..formData.searchFacilityArray@: []
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: searchTag
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableView
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableFooter
                        - type: button
                          text: Revise
                          onClick:
                            - actionType: evalObject
                              object:
                                - ..formData.transferList@: =..apiRequest.squareFacility.edgeResp.edge
                                - =.builtIn.array.splitTableList: 
                                    dataIn: 
                                      arrObj: =..formData.transferList
                                      numX: "12"
                                      numY: "1"
                                    dataOut: Transfer.formData.tableData
                                - ..formData.tableList@: =..formData.tableData.0
                                - =.builtIn.string.concat:
                                    dataIn:
                                      - =..formData.tablePageNum # page num
                                      - " / "
                                      - =..formData.tableData.1 # total page
                                    dataOut: Transfer.formData.tableCurrentPage # current page                           
                                - =.builtIn.number.addition: # get totalPage+1 to verify legitimacy of gotoPageNum
                                    dataIn:
                                      num: =..formData.tableData.1
                                      step: "1"
                                    dataOut: Transfer.formData.totalPageMore # update page num       
                                - =.builtIn.array.setPropertyInterlacedChange:
                                    dataIn:
                                      arrIn: =..formData.tableList
                                      arr: ["backgroundColor"]
                                      valueArr: ["0xf5f5f5"]
                                      errorArr: ["0xffffff"]                                       
                                - ..formData.searchFacility@: ""
                                - ..formData.searchFacilityArray@: []
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: searchTag
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableView
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableFooter                                
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableView
                          style:
                            textDecoration: underline
                            display: inline-block   
                            fontSize: .Nfont.n6_1_1
                            backgroundColor: "0xffffff"
                            color: "0x0063a8"
                            textAlign:
                              x: center
                              y: center
                            border: 
                              style: "1"
                # 表格
                - type: scrollView
                  style:
                    width: "0.8"
                    height: "0.7"
                    left: "0.02"
                    borderRadius: "5"
                    marginTop: "0.01"
                  children: 
                    - type: list
                      contentType: listObject
                      listObject: ..formData.tableList
                      iteratorVar: itemObject
                      viewTag: tableView
                      style:
                        width: '0.79'
                        left: "0.008"
                        height: "auto"
                        margin: "0"
                        float: left
                      children:
                        - type: listItem
                          itemObject: 
                          style:
                            marginTop: "0.02"
                            display: inline-block
                            width: '0.195'
                            height: '0.17'
                            boxSizing: border-box
                            boxShadow: "1px "
                            marginBottom: "0.01"
                          children:
                            - .ScheduleSettingsLiView:
                              children:
                                - type: label
                                  dataKey: itemObject.name.facilityName
                                  style:
                                    left: "0.01"
                                    top: "0.01"
                                    width: "0.156"
                                    height: "0.05"
                                    fontSize: .Nfont.nf4
                                    fontWeight: "600"                        
                                    color: "0x000000"
                                - type: view
                                  style:
                                    top: "0.065"
                                    left: "0.01"
                                    width: "0.156"    
                                  children:                        
                                    - type: image
                                      path: addLoc.svg
                                      path=func: .builtIn.utils.prepareDocToPath
                                      dataKey: itemObject.name.facilityAvatarID
                                      style: 
                                        left: "0"
                                        top: "0"
                                        height: "0.076"
                                        width: "0.043"
                                        backgroundColor: "0xf0f2f4"
                                        borderRadius: "5"
                                        textAlign:  
                                          x: center
                                          y: center
                                    - type: label
                                      dataKey: itemObject.name.fullAddress
                                      style:  
                                        left: "0.053"
                                        top: "0"
                                        width: "0.103"
                                        height: "0.065"
                                        fontSize: .Nfont.nf1
                                        fontFamily: "sans-serif"
                                        color: "0x666666"
                                    - type: view
                                      style:  
                                        left: "0.053"
                                        width: "0.103"
                                        height: "0.03"
                                        top: "0.065"
                                        # backgroundColor: "0xff0000"
                                      children: 
                                        - type: button
                                          text: View
                                          onClick:
                                            - emit: 
                                                dataKey: 
                                                  var: itemObject
                                                actions:
                                                  - .Global.formData.paymentEdgeID@: $var.id
                                            - goto: TransactionsAngle
                                          style:
                                            width: "0.047"
                                            height: "0.025"
                                            fontSize: .Nfont.nf1
                                            fontFamily: "Arial"
                                            boxSizing: border-box
                                            display: inline-block
                                            color: "0x005795"
                                            backgroundColor: "0xffffff"
                                            border: 
                                              style: "3"
                                            borderWidth: "1"
                                            borderColor: "0x005795"
                                            borderRadius: "3"
                                            textAlign:
                                              x: center
                                              y: center
                                        - type: button
                                          text: Record
                                          onClick:  
                                            - emit: 
                                                dataKey: 
                                                  var: itemObject
                                                actions:
                                                  - .Global.formData.paymentEdgeID@: $var.id                                      
                                            - goto: CashOut                               
                                          style:
                                            marginLeft: "0.009"
                                            width: "0.047"
                                            height: "0.025"
                                            fontSize: .Nfont.nf1
                                            fontFamily: "Arial"                                    
                                            boxSizing: border-box
                                            color: "0x005795"
                                            backgroundColor: "0xffffff"
                                            display: inline-block
                                            border: 
                                              style: "3"
                                            borderWidth: "1"
                                            borderColor: "0x005795"
                                            borderRadius: "5"
                                            textAlign:
                                              x: center
                                              y: center
                                       
            # TableFooter
            - type: view
              viewTag: tableFooter
              style:
                .TableFooterView:
                top: "0.857"
              children:   
                - type: view
                  style:
                    top: "0.005"
                    width: "0.08"
                    height: "0.0155"
                  children:
                    - type: label
                      text: "Current page:"
                      style:
                        display: inline-block
                        fontSize: .Nfont.nf0
                        color: "0x333333"
                        textAlign:
                          x: "center"
                          y: "center"
                    - type: label
                      dataKey: formData.tableCurrentPage
                      style:
                        marginLeft: "0.005"
                        display: inline-block
                        fontSize: .Nfont.nf0
                        color: "0x333333"
                        textAlign:
                          x: "center"
                          y: "center"
                # Previous & Next
                - type: view
                  style:
                    top: "0"
                    left: "0.076"
                    width: "0.05168"
                    height: "0.02576"
                  children:
                    - type: image
                      path: tableLeft.svg
                      onClick:
                        - actionType: evalObject
                          object:
                            - if: 
                              - =.builtIn.number.less: 
                                  dataIn: 
                                    num1: =..formData.tablePageNum
                                    num2: 2
                              - continue
                              - actionType: evalObject
                                object:
                                  # num - step
                                  - =.builtIn.number.Subtraction: 
                                      dataIn:
                                        num: =..formData.tablePageNum
                                        step: "1"
                                      dataOut: Transfer.formData.tablePageNum
                                  - =.builtIn.array.splitTableList: 
                                      dataIn: 
                                        arrObj: =..formData.transferList
                                        numX: "12"
                                        numY: =..formData.tablePageNum
                                      dataOut: Transfer.formData.tableData
                                  - ..formData.tableList@: =..formData.tableData.0
                                  - =.builtIn.string.concat: # re-concat
                                      dataIn:
                                        - =..formData.tablePageNum # page num
                                        - " / "
                                        - =..formData.tableData.1 # total page
                                      dataOut: Transfer.formData.tableCurrentPage # current page                                       
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: tableView
                        - actionType: builtIn 
                          funcName: redraw
                          viewTag: tableFooter                               
                      style:
                        top: "0"
                        width: "0.01456"
                        height: "0.02576"
                    - type: label
                      viewTag: pageNumView
                      dataKey: formData.tablePageNum
                      style:
                        top: "0"
                        left: "0.01856"
                        width: "0.01446"
                        height: "0.02576"
                        fontSize: .Nfont.nf0
                        fontWeight: "500"
                        color: "0xffffff"
                        backgroundColor: "0x005795"
                        borderRadius: "3"
                        textAlign:
                          x: center
                          y: center
                    - type: image
                      path: tableRight.svg
                      onClick:
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: "" 
                        - actionType: evalObject
                          object:
                            - if: 
                              - =.builtIn.number.less: 
                                  dataIn: 
                                    num1: =..formData.tablePageNum
                                    num2: =..formData.tableData.1
                              - actionType: evalObject
                                object:
                                  - =.builtIn.number.addition: 
                                      dataIn:
                                        num: =..formData.tablePageNum
                                        step: "1"
                                      dataOut: Transfer.formData.tablePageNum # update page num
                                  - =.builtIn.array.splitTableList: 
                                      dataIn: 
                                        arrObj: =..formData.transferList
                                        numX: "12"
                                        numY: =..formData.tablePageNum
                                      dataOut: Transfer.formData.tableData
                                  - ..formData.tableList@: =..formData.tableData.0
                                  - =.builtIn.string.concat: # re-concat
                                      dataIn:
                                        - =..formData.tablePageNum # page num
                                        - " / "
                                        - =..formData.tableData.1 # total page
                                      dataOut: Transfer.formData.tableCurrentPage # current page 
                              - continue                           
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: tableView  
                        - actionType: builtIn 
                          funcName: redraw
                          viewTag: tableFooter
                      style:
                        top: "0"
                        left: "0.03712"
                        height: "0.02576"
                        width: "0.01456"
                # Go to
                - type: view
                  style:
                    top: "0"
                    left: "0.14"
                    width: "0.05"
                    height: "0.02496"
                  children:
                    - type: textField
                      viewTag: gotoView
                      dataKey: formData.gotoPageNum
                      style:
                        width: "0.02496"
                        top: "0"
                        height: "0.02576"
                        borderRadius: "3"
                        borderWidth: "1"
                        border:
                          style: "3"
                        boxSizing: border-box
                        borderColor: "0xd8d8d8"
                        fontSize: .Nfont.nf0
                        fontWeight: "500"
                        color: "0x333333"
                        textAlign: 
                          x: center 
                          y: center 
                    - type: button
                      text: "Go to"
                      style:
                        textDecoration: underline
                        left: "0.029"
                        top: "0"
                        height: "0.02576"
                        border:
                          style: "1"
                        fontSize: .Nfont.nf0
                        color: "0x333333"
                        backgroundColor: "0xffffff00"
                      onClick:
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: ""                           
                        - actionType: evalObject
                          object:
                            # gotoPageNum ?> 1
                            - if:
                              - =.builtIn.number.less: 
                                  dataIn: 
                                    num1: =..formData.gotoPageNum
                                    num2: 1
                              - continue
                              - actionType: evalObject
                                object:
                                  # gotoPageNum ?< totalPage+1
                                  - if: 
                                    - =.builtIn.number.less: 
                                        dataIn: 
                                          num1: =..formData.gotoPageNum
                                          num2: =..formData.totalPageMore
                                    - actionType: evalObject
                                      object:
                                        - =.builtIn.array.splitTableList: 
                                            dataIn: 
                                              arrObj: =..formData.transferList
                                              numX: "12"
                                              numY: =..formData.gotoPageNum
                                            dataOut: Transfer.formData.tableData
                                        - ..formData.tableList@: =..formData.tableData.0
                                        - =.builtIn.string.concat: # re-concat
                                            dataIn:
                                              - =..formData.gotoPageNum # page num
                                              - " / "
                                              - =..formData.tableData.1 # total page
                                            dataOut: Transfer.formData.tableCurrentPage # current page
                                        - ..formData.tablePageNum@: =..formData.gotoPageNum
                                        - ..formData.gotoPageNum@: ""
                                    - continue                        
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: tableView 
                        - actionType: builtIn 
                          funcName: redraw
                          viewTag: tableFooter      