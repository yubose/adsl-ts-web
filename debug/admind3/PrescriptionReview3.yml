PrescriptionReview3:
  pageNumber: "181"
  title: "Prescription"
  appointmentInfo: .Global.formData.appointment
  init:
    - .SignInCheck
    - if:
        - =.Global.Note.id
        - actionType: evalObject
          object:
            ..prescription.document.name@: =.Global.Note.name
        - continue
    # 判断是否签名
    - actionType: evalObject
      object:
        - if:
            - =.Prescription3.prescription.document.name.data.whetherSign
            - continue
            # 非空修改显示的标识,刷新签名区域
            - actionType: evalObject
              object:
                - ..formData.temporarySignature@: =.Prescription3.prescription.document.name.data.signatureId
                - ..formData.flag@: "block"
                - actionType: builtIn
                  funcName: redraw
                  viewTag: signatureShowTag
        - if:
            - =.builtIn.string.equal:
                dataIn:
                  string1: =..prescription.document.name.data.authority
                  string2: "Private"
            - ..formData.signIsHidden@: false
            - continue
    - actionType: builtIn
      funcName: redraw
      viewTag: signTag

  suggestDrug:
    - name: "Please enter 3 or more characters"
  suggestRoute: []
  suggestStrength: []
  routeName: []
  strengthName: []
  delete:
    - =.Prescription3.prescription.docAPI.delete: ""
  newSign:
    docRes: ""
    document:
      #DOC
      .Document: ""
      type: .DocType.DocumentSignature
      name:
        title: ""
        type: ..newSign.document.subtype.mediaType
        data: ""
      eid: .Global.rootNotebookID
      fid: ""
      subtype:
        mediaType: "" # mediaType : "image/jpeg"
    docAPI:
      # DOCAPI
      .DocAPI: ""
      store:
        api: cd
        dataIn: newSign.document
        dataOut: Prescription3.newSign.docRes
  prescription:
    response: ""
    document:
      .Global.Note: ""
      type: .DocType.Prescription # "6" # meeting notes for all participants
      subtype:
        mediaType: "text/plain" # mediaType : 
      name:
        data:
          signatureId: ""
          whetherSign: ""
          prescriptionArray: []
    docAPI:
      .DocAPI: ""
      store:
        api: cd
        dataIn: prescription.document
        dataOut: prescription.response
        subtype:
          mediaType: "text/plain"
      get:
        api: rd
        dataKey: prescription.response
        id: .Global.Note.id
        xfname: eid
        type: .DocType.Prescription
        maxcount: "1"
      delete:
        api: dx
        dataIn: prescription.document
  prescriptionTemp:
    title: ""
    strength: ""
    amount: ""
    route: ""
    frequency: ""
    disp: ""
    refills: ""
  list: []
  # 签名显示,默认为none
  formData:
    flag: "none"
    temporarySignature: ""
    whetherSign: ""
    signIsHidden: true
  components:
    - type: view
      style:
        width: '1'
        height: '1'
        margin: auto
      children:
        - .SideMenuBar: null
          children:
            - .aitLogo: null
            - .MenuBar: null
        - .TopBar: null
        - .BodyView: null
          style:
            height: "0.93"
          children:
            - .AppointmentLobby: null
            - .GotoBack: null
            - type: view
              style:
                left: "0.008"
                width: "0.824"
                height: "0.74"
                top: "0.1"
                overflow: hidden
                backgroundColor: "0xffffff"
              children:
                - type: view
                  style:
                    width: "0.39"
                    margin: "auto"
                    # backgroundColor: "0xff000033"
                  children:
                    - type: scrollView
                      style:
                        width: "0.39"
                        height: "0.74"
                        overflow: scroll

                      children:
                        - type: view
                          style:
                            height: "0.08"
                            width: "0.39"
                            display: flex
                            justifyContent: space-between
                            alignItems: center
                          children:
                            - type: image
                              path: rx0.svg
                              style:
                                width: "0.03"
                            - type: label
                              text=func: .builtIn.string.formatUnixtime_en
                              dataKey: appointmentInfo.stime
                              text: Oct 27, 2021 2:00 PM
                              style:
                                height: "0.03"
                        - type: view
                          style:
                            marginTop: "0.01"
                            # left: "0.05"
                            width: "0.39"
                          children:
                            - .PrescriptionListBox: null
                              children:
                                - .PrescriptionLabel: null
                                - .PrescriptionDatakey: null
                                  dataKey: Global.formData.medicalRecords.name.data.patientInfo.name
                            - .PrescriptionListBox: null
                              style: null
                              children:
                                - .PrescriptionLabel: null
                                  text: DOB
                                - .PrescriptionDatakey: null
                                  dataKey: Global.formData.medicalRecords.name.data.patientInfo.dob
                            - .PrescriptionListBox: null
                              style: null
                              children:
                                - .PrescriptionLabel: null
                                  text: Phone
                                - .PrescriptionDatakey: null
                                  dataKey: Global.formData.medicalRecords.name.data.patientInfo.phoneNumber
                            - .PrescriptionListBox: null
                              style: null
                              children:
                                - .PrescriptionLabel: null
                                  text: Email
                                - .PrescriptionDatakey: null
                                  dataKey: Global.formData.medicalRecords.name.data.patientInfo.email

                        - type: view
                          viewTag: prescriptionTag
                          style:
                            height: "0.27"
                            width: "0.39"
                            marginTop: "0.015"
                            # backgroundColor: "pink"
                            border:
                              style: 3
                            boxSizing: border-box
                            borderColor: "0xd4d4d4"
                          children:
                            - type: list
                              contentType: listObject
                              listObject: .Global.formData.medicalRecords.name.data.prescriptionArray # ..prescription.document.name.data.prescriptionArray
                              iteratorVar: itemObject
                              style:
                                width: "0.39"
                                left: "0.01"
                                height: "auto"
                                ma        rgin: "0"
                              children:
                                - type: listItem
                                  style:
                                    width: "0.37"
                                    height: "0.2"
                                    left: "0"
                                    marginTop: "0.02"
                                    border:
                                      style: "1"
                                    borderWidth: "1"
                                    borderColor: "0x000000ad"
                                    boxSizing: border-box
                                  children:
                                    # Drug
                                    - .PrescriptionReviewInputText: null
                                      text: Drug
                                      style:
                                        top: "0.01"
                                        left: "0"
                                    - .PrescriptionReviewInputTextField: null
                                      dataKey: itemObject.title
                                      style:
                                        width: "0.2"

                                    # Route
                                    - .PrescriptionReviewInputText: null
                                      text: Route
                                      style:
                                        top: "0.01"
                                        left: "0.24"
                                    - .PrescriptionReviewInputTextField: null
                                      dataKey: itemObject.route
                                      style:
                                        left: "0.24"

                                    # Strength
                                    - .PrescriptionReviewInputText: null
                                      text: Strength
                                      style:
                                        top: "0.09"
                                    - .PrescriptionReviewInputTextField: null
                                      dataKey: itemObject.strength
                                      style:
                                        top: "0.12"
                                        width: "0.2"
                                        #Quantity
                                    - .PrescriptionReviewInputText: null
                                      text: Quantity
                                      style:
                                        top: "0.17"
                                        left: "0"
                                    - .PrescriptionReviewInputTextField: null
                                      dataKey: itemObject.frequency
                                      style:
                                        top: "0.2"
                                        left: "0"
                                        # Sig
                                    - .PrescriptionReviewInputText: null
                                      text: Sig
                                      style:
                                        top: "0.17"
                                        left: "0.13"

                                    - .PrescriptionReviewInputTextField: null # isEditable: false
                                      dataKey: itemObject.disp
                                      style:
                                        top: "0.2"
                                        left: "0.13"
                                        #Refills
                                    - .PrescriptionReviewInputText: null
                                      text: Refills
                                      style:
                                        top: "0.17"
                                        left: "0.258"

                                    - .PrescriptionReviewInputTextField: null # isEditable: false
                                      dataKey: itemObject.refills
                                      style:
                                        top: "0.2"
                                        left: "0.258"

                        - type: view
                          style:
                            height: "0.06"
                            width: "0.39"
                            marginTop: "0.04"
                          children:
                            - type: label
                              text: "Prescription is VOID if the number of drugs prescribed is not noted."
                              style:
                                width: "0.39"
                                height: "0.05"
                                top: "0"
                            - type: view
                              style:
                                left: "0.3"
                                height: "0.04"
                                width: "0.085"
                              children:
                                - type: textField
                                  dataKey: Global.formData.medicalRecords.name.data.prescriptionCount
                                  isEditable: "false"
                                  style:
                                    top: "0"
                                    width: "0.04"
                                    borderRadius: "5"
                                    height: "0.035"
                                    border:
                                      style: "3"
                                    borderWidth: "1"

                        - type: view
                          style:
                            marginTop: "0"
                            width: "0.39"
                            height: "0.2"
                          children:
                            - type: label
                              text: "Signature:"
                              style:
                                top: "0.01"
                                width: "0.3"
                                fontSize: .Nfont.nf4
                                height: auto
                                color: "0x000000"
                                fontWeight: "600"
                                textAlign:
                                  y: center
                            - type: view
                              style:
                                top: "0.04"
                                width: "0.39"
                                height: "0.15"
                                boxSizing: border-box
                                border:
                                  style: "4"
                                  width: "1.5"
                                  color: "0xacacac"
                              children:
                                # - type: canvas
                                #   dataKey: Prescription3.newSign.document.name.data
                                #   viewTag: signatureTag
                                #   style:
                                #     left: "0"
                                #     width: "0.3"
                                #     top: "0"
                                #     height: "0.19"
                                #     overflow: scroll
                                #     zIndex: "1000"
                                # 显示暂存的签名
                                - type: image
                                  viewTag: signatureShowTag
                                  path=func: .builtIn.utils.prepareDocToPath
                                  # 传入签名文档的id
                                  dataKey: Global.formData.medicalRecords.name.data.signatureId
                                  style:
                                    # 控制显示
                                    display: ..formData.flag
                                    left: "0"
                                    width: "0.385"
                                    top: "0"
                                    height: "0.15"
                                    overflow: scroll
                                    zIndex: "1000"

                        - type: view
                          style:
                            marginTop: "0.015"
                            width: "0.39"
                            height: "auto"
                          children:
                            - type: label
                              text: This prescription is void 14 days ofter prescribed date
                              dataKey: null
                              style:
                                # left: "0.02"
                                height: "auto"
                                width: "0.39"
                                fontSize: .Nfont.nf4
                                color: "0xb7b7b7"
                                textAlign:
                                  x: center

                        - type: view
                          style:
                            marginTop: "0.02"
                            width: "0.39"
                            height: "auto"
                          children:
                            - type: label
                              text: Thomas Mueller, MD
                              dataKey: Global.formData.medicalRecords.name.data.providerInfo.providerFullName
                              style:
                                height: "auto"
                                width: "0.2"
                                fontSize: .Nfont.nf5
                            - type: label
                              text: Family Medicine
                              dataKey: null
                              style:
                                height: "auto"
                                marginTop: "0.01"
                                width: "0.39"
                                fontSize: .Nfont.nf4
                            - type: view
                              style:
                                marginTop: "0.02"
                                width: "0.39"
                                height: "auto"
                                display: flex
                                justifyContent: space-between
                                alignItems: center
                              children:
                                - type: label
                                  text: LIC#
                                  dataKey: null
                                  style:
                                    height: "auto"
                                    fontSize: .Nfont.nf4
                                - type: label
                                  text: CA 311231231
                                  dataKey: Global.formData.medicalRecords.name.data.providerInfo.LIC
                                  style:
                                    fontSize: .Nfont.nf4
                                    wordBreak: break-all
                            - type: view
                              style:
                                marginTop: "0.01"
                                width: "0.39"
                                height: "auto"
                                display: flex
                                justifyContent: space-between
                                alignItems: center
                              children:
                                - type: label
                                  text: NPI#
                                  dataKey: null
                                  style:
                                    height: "auto"
                                    fontSize: .Nfont.nf4
                                - type: label
                                  text: "123123"
                                  dataKey: Global.formData.medicalRecords.name.data.providerInfo.NPI
                                  style:
                                    fontSize: .Nfont.nf4
                                    wordBreak: break-all
                            - type: view
                              style:
                                marginTop: "0.01"
                                width: "0.39"
                                height: "auto"
                                display: flex
                                justifyContent: space-between
                                alignItems: center
                              children:
                                - type: label
                                  text: "DEA #"
                                  dataKey: null
                                  style:
                                    height: "auto"
                                    fontSize: .Nfont.nf4
                                - type: label
                                  text: OT14KLvVw
                                  dataKey: Global.formData.medicalRecords.name.data.providerInfo.DEA
                                  style:
                                    fontSize: .Nfont.nf4
                                    wordBreak: break-all
                            - type: view
                              style:
                                marginTop: "0.01"
                                width: "0.39"
                                height: "auto"
                                display: flex
                                justifyContent: space-between
                                alignItems: center
                              children:
                                - type: label
                                  text: "AiTmed ID:"
                                  dataKey: null
                                  style:
                                    height: "auto"
                                    fontSize: .Nfont.nf4
                                - type: label
                                  dataKey: Global.formData.medicalRecords.name.data.providerInfo.aitmedId
                                  style:
                                    fontSize: .Nfont.nf4
                                    wordBreak: break-all

                            - type: view
                              style:
                                marginTop: "0.01"
                                width: "0.39"
                                height: "auto"
                                display: flex
                                justifyContent: space-between
                                alignItems: center
                              children:
                                - type: label
                                  text: "Email:"
                                  dataKey: null
                                  style:
                                    height: "auto"
                                    fontSize: .Nfont.nf4
                                - type: label
                                  # text: CA 311231231
                                  dataKey: Global.formData.medicalRecords.name.data.providerInfo.email
                                  style:
                                    fontSize: .Nfont.nf4
                                    wordBreak: break-all
                            - type: view
                              style:
                                marginTop: "0.01"
                                width: "0.39"
                                height: "auto"
                                display: flex
                                justifyContent: space-between
                                alignItems: center
                              children:
                                - type: label
                                  text: "Phone:"
                                  dataKey: null
                                  style:
                                    height: "auto"
                                    fontSize: .Nfont.nf4
                                - type: label
                                  text: +1 (657) 220-120
                                  dataKey: Global.formData.medicalRecords.name.data.providerInfo.phone
                                  style:
                                    fontSize: .Nfont.nf4
                                    wordBreak: break-all
                            - type: view
                              style:
                                marginTop: "0.01"
                                width: "0.39"
                                height: "auto"
                                display: flex
                                justifyContent: space-between
                                alignItems: center
                              children:
                                - type: label
                                  text: "Fax:"
                                  dataKey: null
                                  style:
                                    height: "auto"
                                    fontSize: .Nfont.nf4
                                - type: label
                                  text: ""
                                  dataKey: Global.formData.medicalRecords.name.data.providerInfo.fax
                                  style:
                                    fontSize: .Nfont.nf4
                                    wordBreak: break-all
                            - type: view
                              style:
                                marginTop: "0.01"
                                width: "0.39"
                                display: flex
                                justifyContent: space-between
                                alignItems: center
                              children:
                                - type: label
                                  text: "Admin Address:"
                                  dataKey: null
                                  style:
                                    height: "auto"
                                    fontSize: .Nfont.nf4
                                - type: label
                                  text: "CCAC MILTON HALL. 808 RID GE AVE"
                                  dataKey: Global.formData.medicalRecords.name.data.adminInfo.address
                                  style:
                                    fontSize: .Nfont.nf4
                                    wordBreak: break-all

                            - type: view
                              style:
                                marginTop: "0.02"
                                height: "0.004"
                                width: "0.39"
                                backgroundColor: "0xbababa"
                            - type: view
                              style:
                                marginTop: "0.01"
                                height: "auto"
                                width: "0.39"
                              children:
                                - type: label
                                  text: www.Aitmed.com
                                  dataKey: null
                                  style:
                                    height: "auto"
                                    color: "0xbababa"
                                    width: "0.39"
                                    display: flex
                                    justifyContent: center
                                    fontSize: .Nfont.nf2
                        # - type: view
                        #   style:
                        #     height: "0.01"
                        #     width: "0.39"
                        #     marginTop: "0.01"
                        #     backgroundColor: "pink"

                        # - type: view
                        #   style:
                        #     height: "0.1"
                        #     width: "0.39"
                        #     marginTop: "0.01"
                        #     backgroundColor: "0xffffff"
                        #   children:
                        #     - type: button
                        #       viewTag: signTag
                        #       text: "Sign"
                        #       style:
                        #         isHidden: =..formData.signIsHidden
                        #         left: "0.1"
                        #         width: "0.12"
                        #         height: "0.04"
                        #         backgroundColor: "0x2fb355"
                        #         border:
                        #           style: "5"
                        #         borderRadius: "5"
                        #         fontSize: .Nfont.nf4
                        #         color: "0xffffff"
                        #         textAlign:
                        #           x: center

                        # - type: popUp
                        #   viewTag: drugTag
                        #   style:
                        #     left: "0"
                        #     width: "0.9"
                        #     height: "1"
                        #     top: "0"
                        #     backgroundColor: "0x00000033"
                        #     zIndex: "10"
                        #   onClick:
                        #     - actionType: popUpDismiss
                        #       popUpView: drugTag
                        #   children:
                        #     - type: scrollView
                        #       style:
                        #         width: "0.94"
                        #         height: "0.3"
                        #         top: "0.48"
                        #         left: "0.03"
                        #         zIndex: "100"
                        #         backgroundColor: "0xe9e9e9"
                        #         borderRadius: "7"
                        #       viewTag: drugsData
                        #       children:
                        #         - type: list
                        #           contentType: listObject
                        #           listObject: ..suggestDrug
                        #           iteratorVar: itemObject
                        #           # viewTag: documentView
                        #           style:
                        #             width: "0.9"
                        #             height: "auto"
                        #             backgroundColor: "0xffffff"
                        #           children:
                        #             - type: listItem
                        #               itemObject: ""
                        #               onClick:
                        #                 - emit:
                        #                     dataKey:
                        #                       var: itemObject
                        #                     actions:
                        #                       - =.builtIn.apiRequest.drugBank:
                        #                           dataIn:
                        #                             id: $var.drugbank_pcid
                        #                             type: "Route"
                        #                           dataOut: Prescription3.suggestRoute
                        #                       - =.builtIn.array.selectOneToArr:
                        #                           dataIn:
                        #                             arr: =.Prescription3.suggestRoute
                        #                             key: "name"
                        #                           dataOut: Prescription3.routeName
                        #                       - =.builtIn.array.addSelect:
                        #                           dataIn:
                        #                             array: =.Prescription3.routeName
                        #                           dataOut: Prescription3.routeName
                        #                       - ..prescriptionTemp.title@: $var.name
                        #                 - actionType: builtIn
                        #                   funcName: redraw
                        #                   viewTag: drugShowTag
                        #                 - actionType: builtIn
                        #                   funcName: redraw
                        #                   viewTag: routesData
                        #                 - actionType: popUpDismiss
                        #                   popUpView: drugTag
                        #               style:
                        #                 left: "0"
                        #                 # display: block
                        #                 # position: static
                        #                 width: "0.94"
                        #                 height: "0.06"
                        #                 backgroundColor: "0xffffffff"
                        #                 borderWidth: "1"
                        #                 borderRight: "solid 1px  #7070704f"
                        #                 borderBottom: "solid 1px  #7070704f"
                        #                 boxSizing: "border-box"
                        #               children:
                        #                 - type: label
                        #                   text: "123"
                        #                   dataKey: itemObject.name
                        #                   style:
                        #                     left: "0.01"
                        #                     width: "0.92"
                        #                     height: "0.06"
                        #                     textAlign:
                        #                       y: center


            - .FormsBottomView: null
              children:
                - .FormsBottomButtons: null
                  children:
                    - .FormsBottomMiddleButton: null
                      text: Done
                      onClick:
                        - actionType: evalObject
                          object:
                            - if:
                                - =.Global.formData.previewFromProvider
                                - goto: PatientSummary
                                - goto: PatientSummaryRoom

        - .BaseWarningView: null
        - .BaseWarningView: null
          viewTag: checkView
          message: "The count of prescriptions is inconformity"
