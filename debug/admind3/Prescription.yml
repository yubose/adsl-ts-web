Prescription:
  title: "Prescription"
  viewPort: top
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    # To Do: judge the business type
    # - =..apiRequest.pharmacyProviderEdge.edgeAPI.get: ""
    # To Do: loop the edge id to receive from diff doctors 
    # - ..apiRequest.prescriptionList.doc.id@: =..apiRequest.pharmacyProviderEdge.response.edge.0.id
    - =..apiRequest.prescriptionList.docAPI.get: ""
    - ..formData.receivedList@: =..apiRequest.prescriptionList.response.doc
  formData:
    receivedList: []
    curRx: "" # current clicked prescription
    curRxId: ""
  apiRequest:
    pharmacyProviderEdge:
      response: ""
      edge:
        .Edge: ""
        type: .EdgeType.PubEmail
        bvid: .Global.currentFacility.id
        evid: ""
        _nonce: =.Global._nonce
      edgeAPI:
        store:
          api: ce
          dataIn: Prescription.apiRequest.pharmacyProviderEdge.edge
          dataOut: Prescription.apiRequest.pharmacyProviderEdge.response
        get:
          api: re
          id: .Global.currentFacility.id
          xfname: evid
          maxcount: "100"
          type: .EdgeType.PubEmail
          obfname: "ctime"
          asc: true
          _nonce: =.Global._nonce
          dataKey: apiRequest.pharmacyProviderEdge.response
    # prescriptionList:
    #   response: ""
    #   doc:
    #     id: ""
    #     xfname: eid
    #     type: 2049
    #     _nonce: =.Global._nonce
    #   docAPI:
    #     get:
    #       api: rd
    #       dataIn: Prescription.apiRequest.prescriptionList.doc
    #       dataOut: Prescription.apiRequest.prescriptionList.response
    prescriptionList:
      response: ""
      doc:
        ids:
          - .Global.currentFacility.id
        sCondition: .EdgeType.PubEmail
        xfname: "E.evid"
        type: 2049
        ObjType: 8
        obfname: "mtime"
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: Prescription.apiRequest.prescriptionList.doc
          dataOut: Prescription.apiRequest.prescriptionList.response

  components:
    - type: view
      style:
        width: '1'
        height: '1'
        margin: auto
      children:
        - .SideMenuBar:
          children:
            - .aitLogo:
            - .MenuBar:
        - .TopBar:
        - .BodyView:
          style:
            height: "0.93"
          children:
            - type: view
              viewTag: searchView
              style:
                backgroundColor: "0xffffff"
                left: "0.008"
                width: "0.255"
                height: "0.07"
                marginTop: "0.015"
                borderRadius: "5px"
              children:
                - type: view
                  style:
                    left: "0.007"
                    top: "0.017"
                    height: "0.036"
                    width: "0.18"
                    border:
                      style: "3"
                    borderColor: "0xcecece"
                    borderRadius: "3px"
                  children:
                    - type: image
                      path: search.svg
                      style:
                        top: "0.008"
                        left: "0.005"
                        width: "0.012"
                        height: "0.02"
                    - type: textField
                      placeholder: Search
                      dataKey:
                      style:
                        boxSizing: content-box
                        width: "0.155"
                        left: "0.022"
                        top: "0"
                        height: "0.034"
                        border: none
                        borderRadius: "3px"
                        fontSize: .Nfont.nf2
                - type: view
                  onClick: # - goto: 
                  style:
                    top: "0.017"
                    width: "0.05"
                    height: "0.038"
                    left: "0.197"
                    backgroundColor: "0x005795"
                    borderRadius: "3px"
                    textAlign:
                      x: center
                      y: center
                  children:
                    - type: image
                      path: editPen.svg
                      style:
                        width: "0.012"
                        height: "0.02"
            - type: view
              viewTag: messageView
              style:
                left: "0.008"
                width: "0.255"
                height: "0.83"
                marginTop: "0"
              children:
                - type: scrollView
                  style:
                    left: "0"
                    width: "0.255"
                    height: "0.812"
                    marginTop: "0.018"
                    borderRadius: "5px"
                    backgroundColor: "0xffffff"
                  children:
                    - type: list
                      contentType: listObject
                      listObject: ..formData.receivedList
                      iteratorVar: itemObject
                      viewTag: rxList
                      style:
                        width: "0.255"
                        margin: "0"
                        left: "0"
                        height: auto
                      children:
                        - type: listItem
                          itemObject:
                          style:
                            width: "0.255"
                            height: "0.1"
                            left: "0"
                            marginTop: "0"
                            backgroundColor: itemObject.backgroundColor
                          children:
                            - type: view
                              style:
                                left: "0"
                                width: "0.255"
                                height: "0.1"
                                marginTop: "0"
                                boxSizing: border-box
                                borderLeft: itemObject.borderLeft
                              children:
                                - type: view
                                  style:
                                    width: "0.22"
                                    height: "0.1"
                                    left: "0.021"
                                    marginTop: "0"
                                    borderBottom: "1px solid #afc6d6"
                                    boxSizing: border-box
                                  onClick:
                                    - actionType: popUp
                                      popUpView: uploadingTag
                                    - actionType: evalObject
                                      object:
                                        .Global._nonce@:
                                          =.builtIn.math.random: ""
                                    - actionType: updateObject
                                      dataKey: Prescription.formData.curRx
                                      dataObject: itemObject
                                    #ã€€borderLeft backgroundColor
                                    - emit:
                                        dataKey:
                                          var: itemObject
                                        actions:
                                          - =.builtIn.object.setProperty:
                                              dataIn:
                                                obj: =..formData.receivedList
                                                label: "id"
                                                text: $var.id
                                                arr: [ "borderLeft", "backgroundColor" ]
                                                valueArr: [ "5px solid #005795", "0xe2edf5" ]
                                                errorArr: [ "none", "0xffffff" ]
                                          - ..formData.curRxId@: $var.id
                                    - actionType: builtIn
                                      funcName: show
                                      viewTag: mainView
                                    - actionType: builtIn
                                      funcName: hide
                                      viewTag: noInbox
                                    - actionType: builtIn
                                      funcName: redraw
                                      viewTag: mainView
                                    - actionType: builtIn
                                      funcName: redraw
                                      viewTag: rxList
                                    - actionType: popUpDismiss
                                      popUpView: uploadingTag
                                  children:
                                    # - type: image
                                    #   path: #redDot.svg
                                    #     emit:
                                    #       dataKey: 
                                    #         var: itemObject
                                    #       actions:
                                    #         - if:
                                    #           - =.builtIn.number.typeIsValid:
                                    #               dataIn:
                                    #                 docType: $var.type
                                    #                 localArr: [1,2,6]
                                    #                 binaryArr: [1,1,0]
                                    #           - null.png       
                                    #           - dot.svg 
                                    #   style:
                                    #     top: "0.028"
                                    #     left: "0.023"
                                    #     width: "0.008"
                                    #     height: "0.012"
                                    #     zIndex: "10"                                    
                                    - type: image
                                      path: rx.png
                                      # path=func: .builtIn.utils.prepareDocToPath
                                      # dataKey: itemObject.name.providerInfo.providerAvatar
                                      style:
                                        top: "0.025"
                                        left: "0"
                                        width: "0.03"
                                        height: "0.048"
                                    - type: view
                                      style:
                                        width: "0.16"
                                        top: "0.015"
                                        height: "0.07"
                                        left: "0.041"
                                      children:
                                        - type: label
                                          dataKey: itemObject.name.data.providerInfo.fullName
                                          style:
                                            top: "0"
                                            left: "0"
                                            height: "0.02"
                                            width: "0.07"
                                            fontSize: .Nfont.nf2
                                            color: "0x000000"
                                            textAlign:
                                              y: center
                                        - type: label
                                          dataKey: itemObject.name.title
                                          style:
                                            top: "0.026"
                                            left: "0"
                                            height: "0.02"
                                            width: "0.16"
                                            fontSize: .Nfont.nf2
                                            color: "0x000000"
                                            textAlign:
                                              y: center
                                        - type: label
                                          dataKey: itemObject.name.data.patientInfo.fullName
                                          style:
                                            top: "0.048"
                                            left: "0"
                                            height: "0.02"
                                            width: "0.16"
                                            fontSize: .Nfont.nf2
                                            color: "0x333333"
                                            overflow: hidden
                                            textOverflow: ellipsis
                                            whiteSpace: nowrap
                                            textAlign:
                                              y: center
                                    - type: label
                                      dataKey: itemObject.ctime
                                      text=func: .builtIn.string.formatUnixtime_en
                                      style:
                                        top: "0.015"
                                        left: "0.156"
                                        width: "calc(7vw)"
                                        height: "0.02"
                                        fontSize: .Nfont.nf0
                                        color: "0x333333"
                                        textAlign:
                                          x: right
            # rxcontent, mainbody
            - .ContentView:
              viewTag: mainView
              style:
                left: "0.27"
                width: "0.562"
                height: "0.9"
                top: "0.015"
                borderRadius: "5px"
              children:
                - type: scrollView
                  style:
                    width: "0.5"
                    height: "0.87"
                    margin: auto
                    overflow: scroll
                  children:
                    - type: view
                      style:
                        marginTop: "0"
                        width: "0.5"
                        left: "0"
                        height: "0.12"
                      children:
                        - type: view
                          style:
                            height: "0.12"
                            width: "0.2"
                            display: "inline-block"
                          children:
                            - type: image
                              path: rx0.svg
                              style:
                                top: "0.02"
                                left: "0.05"
                                width: "0.16"
                                height: "0.08"
                        - type: view
                          style:
                            height: "0.12"
                            width: "0.3"
                            display: "inline-block"
                          children:
                            - type: label
                              text=func: .builtIn.string.formatUnixtime_en
                              dataKey: formData.curRx.mtime
                              style:
                                marginTop: "0.03"
                                height: "auto"
                                width: "0.3"
                                fontSize: .Nfont.nf5
                                wordBreak: break-all
                    - type: view
                      style:
                        marginTop: "0.01"
                        width: "0.5"
                        left: "0"
                        height: "auto"
                        overflow: hidden
                      children:
                        - .PresListView:
                          children:
                            - .PresLabelLeft:
                              text: Patient Name
                            - .PresLabelRight:
                              dataKey: formData.curRx.name.data.patientInfo.fullName
                        - .PresListView:
                          children:
                            - .PresLabelLeft:
                              text: Date of Birth
                            - .PresLabelRight:
                              dataKey: formData.curRx.name.data.patientInfo.dob
                        - .PresListView:
                          children:
                            - .PresLabelLeft:
                              text: "Phone"
                            - .PresLabelRight:
                              dataKey: formData.curRx.name.data.patientInfo.phoneNumber
                        - .PresListView:
                          children:
                            - .PresLabelLeft:
                              text: "Email"
                            - .PresLabelRight:
                              dataKey: formData.curRx.name.data.patientInfo.email
                        - .PresListView:
                          children:
                            - .PresLabelLeft:
                              text: "Patient Address"
                            - .PresLabelRight:
                              dataKey: formData.curRx.name.data.patientInfo.address

                    - type: view
                      viewTag: drugShowTag
                      style:
                        marginTop: "0.03"
                        width: "0.5"
                        left: "0"
                        height: "auto"
                      children:
                        - type: list
                          viewTag: prescriptionTag
                          contentType: listObject
                          listObject: ..formData.curRx.name.data.prescriptionArray
                          iteratorVar: itemObject
                          style:
                            width: "0.5"
                            left: "0"
                            height: "auto"
                          children:
                            - type: listItem
                              style:
                                marginTop: "0.02"
                                width: "0.48"
                                height: "auto"
                                border:
                                  style: "3"
                                borderWidth: "2"
                                borderColor: "0xeeeeee"
                                overflow: hidden
                              children:
                                - type: view
                                  style:
                                    marginLeft: "0.02"
                                    marginTop: "0.01"
                                    width: "0.46"
                                    height: "auto"
                                  children:
                                    - type: view
                                      style:
                                        display: "inline-block"
                                        height: "auto"
                                        width: "0.2"
                                      children:
                                        - type: label
                                          text: Drug
                                          style:
                                            height: "auto"
                                            width: "0.2"
                                            fontSize: .Nfont.nf4
                                            fontWeight: "600"
                                            color: "0x000000"
                                            textAlign:
                                              x: left
                                        - type: label
                                          dataKey: itemObject.drugName
                                          style:
                                            marginTop: "0.01"
                                            width: "0.2"
                                            height: "auto"
                                            textAlign:
                                              x: left
                                            fontSize: .Nfont.nf2
                                            fontWeight: "700"
                                            wordBreak: break-all
                                    - type: view
                                      style:
                                        marginLeft: "0.05"
                                        display: "inline-block"
                                        height: "auto"
                                        width: "0.2"
                                      children:
                                        - type: label
                                          text: Generic Name
                                          style:
                                            height: "auto"
                                            width: "0.2"
                                            fontSize: .Nfont.nf4
                                            fontWeight: "600"
                                            color: "0x000000"
                                            textAlign:
                                              x: left
                                        - type: label
                                          dataKey: itemObject.genericName
                                          style:
                                            marginTop: "0.01"
                                            width: "0.2"
                                            height: "auto"
                                            textAlign:
                                              x: left
                                            fontSize: .Nfont.nf2
                                            fontWeight: "700"
                                            wordBreak: break-all
                                - type: view
                                  style:
                                    marginTop: "0.02"
                                    marginLeft: "0.02"
                                    width: "0.46"
                                    height: "auto"
                                  children:
                                    - type: label
                                      text: Strength
                                      style:
                                        height: "auto"
                                        width: "0.4"
                                        fontSize: .Nfont.nf4
                                        fontWeight: "600"
                                        color: "0x000000"
                                        textAlign:
                                          x: left
                                    - type: label
                                      dataKey: itemObject.strength
                                      style:
                                        marginTop: "0.01"
                                        width: "0.4"
                                        height: "auto"
                                        textAlign:
                                          x: left
                                        fontSize: .Nfont.nf2
                                        fontWeight: "700"
                                        wordBreak: break-all
                                    - type: label
                                      text: Dosage Form
                                      style:
                                        marginTop: "0.01"
                                        height: "auto"
                                        width: "0.4"
                                        fontSize: .Nfont.nf4
                                        fontWeight: "600"
                                        color: "0x000000"
                                        textAlign:
                                          x: left
                                    - type: label
                                      dataKey: itemObject.dosage
                                      style:
                                        marginTop: "0.01"
                                        width: "0.4"
                                        height: "auto"
                                        textAlign:
                                          x: left
                                        fontSize: .Nfont.nf2
                                        fontWeight: "700"
                                        wordBreak: break-all
                                    - type: label
                                      text: Route
                                      style:
                                        marginTop: "0.01"
                                        height: "auto"
                                        width: "0.4"
                                        fontSize: .Nfont.nf4
                                        fontWeight: "600"
                                        color: "0x000000"
                                        textAlign:
                                          x: left
                                    - type: label
                                      dataKey: itemObject.route
                                      style:
                                        marginTop: "0.01"
                                        width: "0.4"
                                        height: "auto"
                                        textAlign:
                                          x: left
                                        fontSize: .Nfont.nf2
                                        fontWeight: "700"
                                        wordBreak: break-all
                                - type: view
                                  style:
                                    marginTop: "0.02"
                                    width: "0.46"
                                    marginLeft: "0.02"
                                    height: "auto"
                                  children:
                                    - type: view
                                      style:
                                        display: "inline-block"
                                        height: "auto"
                                        width: "0.13"
                                      children:
                                        - type: label
                                          text: Quantity
                                          style:
                                            height: "auto"
                                            width: "0.13"
                                            fontSize: .Nfont.nf4
                                            fontWeight: "600"
                                            color: "0x000000"
                                            textAlign:
                                              x: left
                                        - type: label
                                          dataKey: itemObject.frequency
                                          style:
                                            marginTop: "0.01"
                                            width: "0.13"
                                            height: "auto"
                                            textAlign:
                                              x: left
                                            fontSize: .Nfont.nf2
                                            fontWeight: "700"
                                            wordBreak: break-all
                                    - type: view
                                      style:
                                        marginLeft: "0.02"
                                        display: "inline-block"
                                        height: "auto"
                                        width: "0.13"
                                      children:
                                        - type: label
                                          text: Directions
                                          style:
                                            height: "auto"
                                            width: "0.13"
                                            fontSize: .Nfont.nf4
                                            fontWeight: "600"
                                            color: "0x000000"
                                            textAlign:
                                              x: left
                                        - type: label
                                          dataKey: itemObject.disp
                                          style:
                                            marginTop: "0.01"
                                            width: "0.13"
                                            height: "auto"
                                            textAlign:
                                              x: left
                                            fontSize: .Nfont.nf2
                                            fontWeight: "700"
                                            wordBreak: break-all
                                    - type: view
                                      style:
                                        marginLeft: "0.02"
                                        display: "inline-block"
                                        height: "auto"
                                        width: "0.13"
                                      children:
                                        - type: label
                                          text: Refills
                                          style:
                                            height: "auto"
                                            width: "0.13"
                                            fontSize: .Nfont.nf4
                                            fontWeight: "600"
                                            color: "0x000000"
                                            textAlign:
                                              x: left
                                        - type: label
                                          dataKey: itemObject.refills
                                          style:
                                            marginTop: "0.01"
                                            width: "0.13"
                                            height: "auto"
                                            textAlign:
                                              x: left
                                            fontSize: .Nfont.nf2
                                            fontWeight: "700"
                                            wordBreak: break-all
                                - type: view
                                  style:
                                    marginTop: "0.02"
                                    width: "0.5"
                                    height: "auto"

                    - type: view
                      style:
                        marginTop: "0.03"
                        width: "0.5"
                        left: "0"
                        height: "auto"
                      children:
                        - type: label
                          text: Prescription is VOID if the number of drugs prescribed is not noted.
                          style:
                            display: "inline-block"
                            height: "auto"
                            width: "0.45"
                            fontSize: .Nfont.nf4
                        - type: textField
                          isEditable: "false"
                          dataKey: formData.curRx.name.data.prescriptionCount
                          style:
                            marginTop: "0.01"
                            display: "inline-block"
                            height: "0.03"
                            border:
                              style: "3"
                            width: "0.08"
                            fontSize: .Nfont.nf4
                            textAlign:
                              x: center
                    - type: view
                      style:
                        marginTop: "0.03"
                        width: "0.5"
                        left: "0"
                        height: "auto"
                        # backgroundColor: "pink"
                        overflow: hidden
                      children:
                        - type: view
                          style:
                            height: "auto"
                            width: "0.5"
                          children:
                            - type: label
                              text: "Signature:"
                              style:
                                display: "inline-block"
                                width: "0.3"
                                fontSize: .Nfont.nf4
                                height: "auto"
                                color: "0x000000"
                                textAlign:
                                  x: left
                        - type: view
                          style:
                            marginTop: "0.02"
                            height: "0.15"
                            width: "0.48"
                            border:
                              style: "4"
                              width: "0.8"
                              color: "0xacacac"
                          children:
                            - type: image
                              viewTag: signatureShowTag
                              path=func: =.builtIn.utils.prepareDocToPath
                              dataKey: formData.curRx.name.data.signatureId
                              style:
                                display: "block"
                                width: "0.48"
                                top: "0"
                                height: "0.15"
                                overflow: scroll

                        - type: label
                          text: This prescription is void 14 days after prescribed date
                          style:
                            marginTop: "0"
                            width: "0.5"
                            height: "auto"
                            color: "0xb7b7b7"
                            fontSize: .Nfont.nf2
                            textAlign:
                              x: center

                    - type: view
                      style:
                        marginTop: "0.03"
                        width: "0.5"
                        left: "0"
                        height: "auto"
                        overflow: hidden
                      children:
                        - type: label
                          text: Thomas Mueller, MD
                          dataKey: formData.curRx.name.data.providerInfo.fullName
                          style:
                            height: "auto"
                            width: "0.4"
                            fontSize: .Nfont.nf6
                        - type: label
                          text: Family Medicine
                          dataKey: formData.curRx.name.data.providerInfo.specialty
                          style:
                            height: "auto"
                            width: "0.4"
                            fontSize: .Nfont.nf5
                        - .PresListView:
                          style:
                            marginTop: "0.03"
                          children:
                            - .PresLabelLeft:
                              text: "LIC#"
                            - .PresLabelRight:
                              dataKey: formData.curRx.name.data.providerInfo.lic
                        - .PresListView:
                          children:
                            - .PresLabelLeft:
                              text: "NPI#"
                            - .PresLabelRight:
                              dataKey: formData.curRx.name.data.providerInfo.npi
                        - .PresListView:
                          children:
                            - .PresLabelLeft:
                              text: "DEA#"
                            - .PresLabelRight:
                              dataKey: formData.curRx.name.data.providerInfo.dea
                        # - .PresListView:
                        #   children:
                        #     - .PresLabelLeft:
                        #       text: "AiTmed ID:"
                        #     - .PresLabelRight:
                        #       dataKey: formData.curRx.name.data.providerInfo.aitmedId
                        - .PresListView:
                          children:
                            - .PresLabelLeft:
                              text: "Email"
                            - .PresLabelRight:
                              dataKey: formData.curRx.name.data.providerInfo.email
                        - .PresListView:
                          children:
                            - .PresLabelLeft:
                              text: "Phone:"
                            - .PresLabelRight:
                              dataKey: formData.curRx.name.data.providerInfo.phone
                        - .PresListView:
                          children:
                            - .PresLabelLeft:
                              text: "Fax:"
                            - .PresLabelRight:
                              dataKey: formData.curRx.name.data.facilityInfo.fax
                        - .PresListView:
                          children:
                            - .PresLabelLeft:
                              text: "Admin Address:"
                            - .PresLabelRight:
                              dataKey: formData.curRx.name.data.facilityInfo.address

                    - type: view
                      style:
                        marginTop: "0.02"
                        height: "0.004"
                        width: "0.5"
                        left: "0"
                        backgroundColor: "0xbababa"
                    - type: label
                      text: www.Aitmed.com
                      style:
                        marginTop: "0"
                        width: "0.5"
                        left: "0"
                        height: "auto"
                        color: "0xbababa"
                        fontSize: .Nfont.nf2
                        textAlign:
                          x: center
                          y: center
            - .ContentView:
              viewTag: noInbox
              style:
                left: "0.27"
                width: "0.562"
                height: "0.9"
                top: "0.015"
                borderRadius: "5px"
              children:
                - type: image
                  path: noRx.png
                  style:
                    width: "0.25"
                    left: "0.15"
                    top: "0.12"
                - type: label
                  text: "Welcome to Check Your Prescription!"
                  dataKey:
                  style:
                    fontSize: .Nfont.nf6
                    fontWeight: "700"
                    left: "0.15"
                    top: "0.6"
