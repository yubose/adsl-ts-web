SchduleSetting:
  title: "Availability Setting"
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - actionType: updateObject
      dataKey: Global.currentSchedule
      dataObject: []
    - actionType: evalObject
      object:
        - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
        - =.Global.jwt.edgeAPI.store: ""
    - =.builtIn.array.selectOneToArr:
        dataIn:
          arr: =.Global.locationAll
          key: "medicalFacilityName"
        dataOut: SchduleSetting.addressName
    # - ..formDataOfficeVisisAddress@: =..addressName.0
    - =.builtIn.array.matchInArray:
        dataIn:
          arr: =.Global.locationAll
          value: =..addressName.0
          key: medicalFacilityName
          key1: "id"
        dataOut: SchduleSetting.locationId
    - =.builtIn.array.add:
        dataIn:
          object: =..getScheduleOfficeVisit.edgeReq.id
          value: =..locationId
    - =..getScheduleTelemedicine.get: ""
    - =..getScheduleOfficeVisit.get: ""
    - actionType: evalObject
      object:
        - ..formDataTelemedicine@: =..getScheduleTelemedicine.schedule.edge.0
        - ..formDataOfficeVisit@: =..getScheduleOfficeVisit.schedule.edge.0
    - actionType: evalObject
      object:
        - if:
            - =.SchduleSetting.getScheduleTelemedicine.schedule.edge.0.id
            - =.builtIn.array.WeekSchedule:
                dataIn:
                  planObject: =.SchduleSetting.getScheduleTelemedicine.schedule.edge.0.name.setting.day
                dataOut: SchduleSetting.dayTelemedicine
            - continue
        - if:
            - =.SchduleSetting.getScheduleOfficeVisit.schedule.edge.0.id
            - =.builtIn.array.WeekSchedule:
                dataIn:
                  planObject: =.SchduleSetting.getScheduleOfficeVisit.schedule.edge.0.name.setting.day
                dataOut: SchduleSetting.dayOfficeVisit
            - continue
  getScheduleTelemedicine:
    schedule:
      edge:
        name:
          setting:
            day: []
    get:
      .EdgeAPI.get: ""
      api: re
      dataKey: SchduleSetting.getScheduleTelemedicine.schedule
      type: 40000
      id:
        - .Global.acceptInfo.bsig
        - .Global.currentFacility.id
      # sCondition: "subtype=131075"
      sCondition: "subtype=196611"
      xfname: "evid,bvid"
      maxcount: "1"
      obfname: "ctime"
      _nonce: =.Global._nonce
  getScheduleOfficeVisit:
    edgeReq:
      type: 40000
      id:
        - .Global.acceptInfo.bsig
        # - .Global.currentFacility.id
      sCondition: "subtype=131075"
      # sCondition: "subtype=196611"
      xfname: "evid,bvid"
      maxcount: "1"
      obfname: "ctime"
      _nonce: =.Global._nonce
    schedule:
      edge:
        name:
          setting:
            day: []
    get:
      .EdgeAPI.get: ""
      api: re
      dataIn: SchduleSetting.getScheduleOfficeVisit.edgeReq
      dataOut: SchduleSetting.getScheduleOfficeVisit.schedule

  weekLabel:
    - key: Sunday
    - key: Monday
    - key: Tuesday
    - key: Wednesday
    - key: Thursday
    - key: Friday
    - key: Saturday
  formDataTelemedicine: ""
  dayTelemedicine: ""
  formDataOfficeVisit: ""
  formDataOfficeVisisAddress: ..addressName.0 # 给select的dataKey一个初始值，如果不赋值，dataKey在未选择之前都是空的
  locationId: ""
  dayOfficeVisit: ""
  components:
    - .BaseCheckView: ""
      message: "You don't have the authority to edit"
      viewTag: pATAuthEdit
      style:
        zIndex: "100000"
    - .TotalView:
      children:
        - .SideMenuBar:
          children:
            - .aitLogo:
            - .MenuBar:
        - .TopBar:
        - .InnerBodyView:
          children:
            - .PageTitleLabel:
            - .GotoBack:
              style:
                top: "0.045"
              onClick:
                - actionType: builtIn
                  funcName: goBack
                  reload: true
            - .ContentBar:
              children:
                - type: view
                  style:
                    width: "0.78"
                    marginTop: "0.05"
                    left: "0.04"
                    display: flex
                    # alignItems: center
                  children:
                    - type: image
                      path: providerDefault.svg
                      path=func: .builtIn.utils.prepareDocToPath
                      dataKey: Global.acceptInfo.name.data.avatar
                      style:
                        width: "0.058"
                    - type: view
                      style:
                        width: "auto"
                        height: "auto"
                      children:
                        - type: label
                          dataKey: Global.acceptInfo.name.data.fullName
                          style:
                            display: inline-block
                            marginLeft: "0.013"
                            fontSize: .Nfont.nf6
                            textDecoration: underline
                            color: "0x005795"
                            fontWeight: "700"
                            marginTop: "0.01"
                        - type: view
                          style:
                            marginLeft: "0.013"
                            marginTop: "0.004"
                          children:
                            - type: label
                              text: "User Name: "
                              dataKey:
                              style:
                                display: inline-block
                                marginRight: "0.01"
                                fontWeight: "600"
                            - type: label
                              text:
                              dataKey: Global.acceptInfo.name.data.userName
                              style:
                                display: inline-block
                        - type: view
                          style:
                            marginLeft: "0.013"
                            marginTop: "0.004"
                          children:
                            - type: label
                              text: "Phone #: "
                              dataKey:
                              style:
                                display: inline-block
                                marginRight: "0.01"
                                fontWeight: "600"
                            - type: label
                              text:
                              dataKey: Global.acceptInfo.name.data.phone
                              style:
                                display: inline-block

                - type: view
                  style:
                    width: "0.78"
                    height: "0.6"
                    top: "0.17"
                    left: "0.02"
                  children:
                    - type: view
                      style:
                        left: "0"
                        width: "0.39"
                        top: "0"
                        height: "0.6"
                        # backgroundColor: "0xff000033"
                      children:
                        - type: view
                          style:
                            left: "0"
                            width: "0.4"
                            top: "0"
                            height: "0.5"
                          children:
                            - type: view
                              style:
                                marginTop: "0.045"
                                width: "0.35"
                                left: "0.02"
                                height: "0.045"
                              children:
                                - type: label
                                  text: Telemedicine
                                  dataKey:
                                  style:
                                    height: "0.045"
                                    fontWeight: "700"
                                    textAlign:
                                      y: center
                                    fontSize: .Nfont.nf5
                                    display: inline-block
                                - type: view
                                  style:
                                    display: inline-block
                                    marginLeft: "0.015"
                                  onClick:
                                    - actionType: evalObject
                                      object:
                                        - .Global.formData.scheduleType@: Telemedicine
                                        - .Global.currentSchedule@: =..getScheduleTelemedicine.schedule.edge.0
                                        - .Global.setSchedule.scheduleTypeNumber@: "196611"
                                    - goto: ScheduleSettingsDisplay
                                  children:
                                    - type: image
                                      path: editBlue.svg
                                      style:
                                        width: "0.011"
                                        display: inline-block
                                        marginTop: "0.004"
                                        marginRight: "0.004"
                                    - type: label
                                      text: Edit
                                      dataKey:
                                      style:
                                        textDecoration: underline
                                        fontSize: .Nfont.n6
                                        color: "0x005795"
                                        display: inline-block
                                        fontWeight: "600"
                            - type: view
                              style:
                                marginTop: "0.007"
                                width: "0.35"
                                left: "0.02"
                                height: "0.08"
                              children:
                                - type: view
                                  style:
                                    display: inline-block
                                  children:
                                    - type: label
                                      text: Start date
                                      dataKey:
                                      style:
                                        fontSize: .Nfont.n6_1_1
                                        fontWeight: "600"
                                    - type: view
                                      style:
                                        height: auto
                                        width: "0.165"
                                      children:
                                        - type: textField
                                          placeholder:
                                          isEditable: false
                                          dataKey: formDataTelemedicine.name.setting.startDate
                                          style:
                                            width: "0.165"
                                            height: "0.045"
                                            borderWidth: "2"
                                            borderRadius: "5"
                                            textIndent: 1em
                                            backgroundColor: "0xffffff"
                                            marginTop: "0.005"
                                            border:
                                              style: "3"
                                            borderColor: "0xeeeeee"
                                            display: inline-block
                                        - type: image
                                          path: calendarPoint.svg
                                          style:
                                            top: "0.02"
                                            left: "0.145"
                                            width: "0.012"
                                            zIndex: "5"

                                - type: view
                                  style:
                                    display: inline-block
                                    marginLeft: "0.02"
                                  children:
                                    - type: label
                                      text: Repeat weeks
                                      dataKey:
                                      style:
                                        fontSize: .Nfont.n6_1_1
                                        fontWeight: "600"
                                    - type: view
                                      style:
                                        height: "0.045"
                                        width: "0.08"
                                        border:
                                          style: "3"
                                        borderColor: "0xeeeeee"
                                        borderRadius: "5"
                                        borderWidth: "2"
                                        marginTop: "0.005"
                                      children:
                                        - type: textField
                                          placeholder:
                                          isEditable: false
                                          dataKey: formDataTelemedicine.name.setting.forwardRepeatWeeks
                                          style:
                                            width: "0.05"
                                            height: "0.045"
                                            textIndent: 1em
                                            fontSize: .Nfont.n6
                                            backgroundColor: "0xffffff"
                                            border:
                                              style: "1"
                                            display: inline-block
                                        - type: label
                                          text: Weeks
                                          dataKey:
                                          style:
                                            fontSize: .Nfont.n6_1
                                            top: "0.012"
                                            left: "0.052"
                                            color: "0x333333"

                            - type: view
                              style:
                                marginTop: "0.025"
                                width: "0.35"
                                left: "0.02"
                                height: "0.33"
                                # overflow: scroll
                              children:
                                - type: list
                                  contentType: listObject
                                  listObject: ..dayTelemedicine
                                  iteratorVar: itemObject
                                  style:
                                    width: '0.35'
                                    left: "0"
                                    margin: '0'
                                    height: auto
                                  children:
                                    - type: listItem
                                      itemObject: ""
                                      style:
                                        width: '0.349'
                                        height: '0.045'
                                        left: '0'
                                        border:
                                          style: "3"
                                        borderWidth: "1"
                                        borderColor: "#ccdae4"
                                        borderRadius: "2"
                                      children:
                                        - type: label
                                          dataKey: itemObject.weekDay
                                          style:
                                            left: "0"
                                            width: "0.1"
                                            top: "0"
                                            height: "0.045"
                                            fontWeight: "500"
                                            fontSize: .Nfont.nf2
                                            backgroundColor: "0xf7f7f7"
                                            textAlign:
                                              x: center
                                              y: center
                                        - type: label
                                          dataKey: itemObject.info
                                          style:
                                            left: "0.1"
                                            width: "0.24"
                                            top: "0"
                                            height: "0.045"
                                            fontSize: .Nfont.nf2
                                            textAlign:
                                              x: center
                                              y: center
                    - type: view
                      style:
                        left: "0.39"
                        width: "0.39"
                        top: "0"
                        height: "0.6"
                        # backgroundColor: "0xcdcdcd"
                      children:
                        - type: view
                          style:
                            left: "0"
                            width: "0.39"
                            top: "0"
                            height: "0.5"
                          children:
                            - type: view
                              style:
                                marginTop: "0.045"
                                left: "0.02"
                                height: "0.045"
                              children:
                                - type: label
                                  text: Office Visit
                                  dataKey:
                                  style:
                                    height: "0.045"
                                    fontWeight: "700"
                                    textAlign:
                                      y: center
                                    fontSize: .Nfont.nf5
                                    display: inline-block
                                - type: view
                                  style:
                                    display: inline-block
                                    marginLeft: "0.015"
                                  onClick:
                                    - actionType: evalObject
                                      object:
                                        - .Global.formData.scheduleType@: Office Visits
                                        - .Global.formData.scheduleAddress@: =..formDataOfficeVisisAddress
                                        - .Global.formData.scheduleLocationId@: =..locationId
                                        - .Global.currentSchedule@: =..getScheduleOfficeVisit.schedule.edge.0
                                        - .Global.setSchedule.scheduleTypeNumber@: "131075"
                                    - goto: ScheduleSettingsDisplay
                                  children:
                                    - type: image
                                      path: editBlue.svg
                                      style:
                                        width: "0.011"
                                        display: inline-block
                                        marginTop: "0.004"
                                        marginRight: "0.004"
                                    - type: label
                                      text: Edit
                                      dataKey:
                                      style:
                                        textDecoration: underline
                                        fontSize: .Nfont.n6
                                        color: "0x005795"
                                        display: inline-block
                                        fontWeight: "600"

                            - type: view
                              viewTag: availabilityView
                              style:
                                marginTop: "0.007"
                                width: "0.35"
                                left: "0.02"
                                height: "0.08"
                              children:
                                - type: view
                                  style:
                                    display: inline-block
                                  children:
                                    - type: label
                                      text: Start date
                                      dataKey:
                                      style:
                                        fontSize: .Nfont.n6_1_1
                                        fontWeight: "600"
                                    - type: view
                                      style:
                                        height: auto
                                        width: "0.1"
                                      children:
                                        - type: textField
                                          placeholder:
                                          isEditable: false
                                          dataKey: formDataOfficeVisit.name.setting.startDate
                                          style:
                                            width: "0.1"
                                            height: "0.045"
                                            borderWidth: "2"
                                            borderRadius: "5"
                                            textIndent: 1em
                                            backgroundColor: "0xffffff"
                                            marginTop: "0.005"
                                            border:
                                              style: "3"
                                            borderColor: "0xeeeeee"
                                            display: inline-block
                                        - type: image
                                          path: calendarPoint.svg
                                          style:
                                            top: "0.02"
                                            left: "0.08"
                                            width: "0.012"
                                            zIndex: "5"

                                - type: view
                                  style:
                                    display: inline-block
                                    marginLeft: "0.015"
                                  children:
                                    - type: label
                                      text: Repeat weeks
                                      dataKey:
                                      style:
                                        fontSize: .Nfont.n6_1_1
                                        fontWeight: "600"
                                    - type: view
                                      style:
                                        height: "0.045"
                                        width: "0.08"
                                        border:
                                          style: "3"
                                        borderColor: "0xeeeeee"
                                        borderRadius: "5"
                                        borderWidth: "2"
                                        marginTop: "0.005"
                                      children:
                                        - type: textField
                                          placeholder:
                                          isEditable: false
                                          dataKey: formDataOfficeVisit.name.setting.forwardRepeatWeeks
                                          style:
                                            width: "0.05"
                                            height: "0.045"
                                            textIndent: 1em
                                            fontSize: .Nfont.n6
                                            backgroundColor: "0xffffff"
                                            border:
                                              style: "1"
                                            display: inline-block
                                        - type: label
                                          text: Weeks
                                          dataKey:
                                          style:
                                            fontSize: .Nfont.n6_1
                                            top: "0.012"
                                            left: "0.052"
                                            color: "0x333333"

                                - type: view
                                  style:
                                    display: inline-block
                                    marginLeft: "0.015"
                                  children:
                                    - type: label
                                      text: Address
                                      dataKey:
                                      style:
                                        fontSize: .Nfont.n6_1_1
                                        fontWeight: "600"
                                    - type: view
                                      style:
                                        height: "0.045"
                                        width: "0.08"
                                      children:
                                        - type: select
                                          dataKey: formDataOfficeVisisAddress
                                          onChange:
                                            - actionType: evalObject
                                              object:
                                                - =.builtIn.array.matchInArray:
                                                    dataIn:
                                                      arr: =.Global.locationAll
                                                      value: =..formDataOfficeVisisAddress
                                                      key: medicalFacilityName
                                                      key1: "id"
                                                    dataOut: SchduleSetting.locationId
                                                - ..getScheduleOfficeVisit.edgeReq.id@: []
                                                - ..getScheduleOfficeVisit.schedule.edge@: []
                                                - =.builtIn.array.add:
                                                    dataIn:
                                                      object: =..getScheduleOfficeVisit.edgeReq.id
                                                      value: =.Global.acceptInfo.bsig
                                                - =.builtIn.array.add:
                                                    dataIn:
                                                      object: =..getScheduleOfficeVisit.edgeReq.id
                                                      value: =..locationId
                                            - actionType: evalObject
                                              object:
                                                .Global._nonce@:
                                                  =.builtIn.math.random: ""
                                            - actionType: evalObject
                                              object:
                                                - =..getScheduleOfficeVisit.get: ""
                                                - ..formDataOfficeVisit@: =..getScheduleOfficeVisit.schedule.edge.0
                                                - if:
                                                    - =.SchduleSetting.getScheduleOfficeVisit.schedule.edge.0.id
                                                    - =.builtIn.array.WeekSchedule:
                                                        dataIn:
                                                          planObject: =.SchduleSetting.getScheduleOfficeVisit.schedule.edge.0.name.setting.day
                                                        dataOut: SchduleSetting.dayOfficeVisit
                                                    - ..dayOfficeVisit@: []
                                                - if:
                                                    - =.SchduleSetting.getScheduleOfficeVisit.schedule.edge.0
                                                    - continue
                                                    - actionType: evalObject
                                                      object:
                                                        - ..formDataOfficeVisit.name.setting.startDate@: ""
                                                        - ..formDataOfficeVisit.name.setting.forwardRepeatWeeks@: ""
                                            - actionType: builtIn
                                              funcName: redraw
                                              viewTag: timeView
                                            - actionType: builtIn
                                              funcName: redraw
                                              viewTag: availabilityView
                                          options: ..addressName
                                          style:
                                            boxSizing: content-box
                                            textAlign:
                                              y: center
                                            textIndent: "10px"
                                            height: "0.045"
                                            width: "0.135"
                                            border:
                                              style: "3"
                                            borderColor: "0xeeeeee"
                                            borderRadius: "5"
                                            borderWidth: "2"
                                            marginTop: "0.005"

                            - type: view
                              viewTag: timeView
                              style:
                                marginTop: "0.025"
                                width: "0.35"
                                left: "0.02"
                                height: "0.33"
                                # overflow: scroll
                              children:
                                - type: list
                                  contentType: listObject
                                  listObject: ..dayOfficeVisit
                                  iteratorVar: itemObject
                                  style:
                                    width: '0.35'
                                    left: "0"
                                    margin: '0'
                                    height: auto
                                  children:
                                    - type: listItem
                                      itemObject: ""
                                      style:
                                        width: '0.349'
                                        height: '0.045'
                                        left: '0'
                                        border:
                                          style: "3"
                                        borderWidth: "1"
                                        borderColor: "#ccdae4"
                                        borderRadius: "2"
                                      children:
                                        - type: label
                                          dataKey: itemObject.weekDay
                                          style:
                                            left: "0"
                                            width: "0.1"
                                            top: "0"
                                            height: "0.045"
                                            fontWeight: "500"
                                            fontSize: .Nfont.nf2
                                            backgroundColor: "0xf7f7f7"
                                            textAlign:
                                              x: center
                                              y: center
                                        - type: label
                                          dataKey: itemObject.info
                                          style:
                                            left: "0.1"
                                            width: "0.24"
                                            top: "0"
                                            height: "0.045"
                                            fontSize: .Nfont.nf2
                                            textAlign:
                                              x: center
                                              y: center
