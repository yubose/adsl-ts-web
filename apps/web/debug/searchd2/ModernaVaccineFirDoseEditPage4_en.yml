ModernaVaccineFirDoseEditPage4:
  viewPort: top
  title: "ModernaVaccineFirDoseEditPage4"
  init:
    - .Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.facilityName@: =.Global.FacilityInfos.name.data.basicInfo.medicalFacilityName
    - ..formDataTemp.facilityName@: =.Global.FacilityInfos.name.data.basicInfo.medicalFacilityName
    
       
    # 判断是否签名
    - actionType: evalObject
      object:
        - if:
          - =.Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.whetherConsentSignature
          - continue
          - actionType: evalObject
            object:
              - ..formDataTemp.single.0.consent@: =.Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.isAgree
              
              - ..whetherSignature@: =.Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.whetherConsentSignature
          
    - if:
      - =.Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.signatureTime
      - ..signatureTime@: =.Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.signatureTime
      - continue
    - if:
      - =.Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.recipientName
      - ..recipientName@: =.Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.recipientName
      - continue   
    - if:
      - =.Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.signaturePfizerVaccine
      - ..temporarySignature@: =.Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.signaturePfizerVaccine
      - continue
    # 判断显示签名的id是否为空
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =..temporarySignature
              string2: ""
        - continue
        # 非空修改显示的标识,刷新签名区域
        - actionType: evalObject
          object:
            - ..flag@: "block"
            - actionType: builtIn
              funcName: redraw
              viewTag: signatureShowTag
    - actionType: evalObject
      object: .BaseDate.miniWeekGet
    - actionType: evalObject
      object: .BaseDate.getDate
    - if:
      - =.Global.isSignIn
      - actionType: evalObject
        object:
          - ..isPersonal@: "false"
          - ..isSignIn@: "true"
      - actionType: evalObject
        object:
          - ..isPersonal@: "true"
          - ..isSignIn@: "false"
    - ..profile.docAPI.get
    - if:
      - =..profile.docResponse.doc.0
      - actionType: evalObject
        object:
          - ..profile.c@: =..profile.docResponse.doc.0
          - =.builtIn.utils.prepareDoc:
              dataIn:
                doc: =..profile.docResponse.doc.0
              dataOut: ModernaVaccineFirDoseEditPage4.profile.patientdocument
      - continue
  medicalFacilityName: ""
  isPersonal:
  isSignIn:
    
  profile:
    docResponse: ""
    patientdocument: ""
    document:
      type: .DocType.PatientProfile
      eid: .Global.rootNotebookID
      name:
        # .Global.Profile: ""
        data:
          insurance: 
            insuranceProvider: ""
            policyHolderName: ""
            groupOrPolicy: ""
            memberID: ""
          phone: .Global.currentUser.vertex.uid
          phone2: ""
          avatarUrl: ava.png
          avatar: ""
          gender: ""
          email: ""
          firstName: .Global.currentUser.vertex.name.firstName
          middleName: ""
          lastName: .Global.currentUser.vertex.name.lastName
          birth: ""
          userName: .Global.currentUser.vertex.name.userName
          address: ""
          fullName: .ModernaVaccineFirDoseEditPage4.formData.showName
          Address:
            St: ""
            city: ""
            state: ""
            line2: ""
            zip: ""
          name: ""
          relation: ""
        type: .ModernaVaccineFirDoseEditPage4.profile.docAPI.store.subtype.mediaType
    docAPI:
      get:
        .DocAPI.get: "" 
        api: rd
        id: .Global.rootNotebookID
        xfname: eid
        type: .DocType.PatientProfile
        obfname: mtime
        dataKey: profile.docResponse
        _nonce: =.Global._nonce 
      
  # 签名文档
  newSign:
    docRes: ""
    docReq:
      type: .DocType.DocumentSignature
      id: .Global.rootNotebookID
      xfname: eid
    document: #DOC
      type: .DocType.DocumentSignature
      name:
        title: ""
        type: ..newSign.document.subtype.mediaType
        data: "" 
      reid: .Global.formData.modernaVaccineFirDoseForm.id
      eid: .Global.rootNotebookID
      # reid: .Global.formData.modernaVaccineFirDoseForm.id
      subtype:
        mediaType: "" # mediaType : "image/jpeg"        
    docAPI: # DOCAPI 
      store:
        api: cd
        dataIn: ModernaVaccineFirDoseEditPage4.newSign.document 
        dataOut: ModernaVaccineFirDoseEditPage4.newSign.docRes
  recipientName: ""
  # 获取暂存的签名的id
  temporarySignature: ""
  # 签名的显示,默认为none
  flag: "none"
  # 是否签名 true 表示未签 false 表示已签
  whetherSignature: ""
  signatureTime: ""
  formData: 
    consent: 
      - key: consent
        value: "1"
        text1: "I GIVE CONSENT to&nbsp;"
        text2: "&nbsp;to vaccinate me with the COVID-19. You must electronically sign this consent to receive the COVID-19 Vaccine."
      - key: consent
        value: "0"
        text1: "I DO NOT GIVE CONSENT to&nbsp;"
        text2: "&nbsp;to be vaccinated."
    countryCode: "+1"   
    phoneNumber: "8881307128"
    password: "123456"
    code: ""
    sk: ""
    pass: ""
    showName: ""
  
  formDataTemp: 
    single:
      - consent: ""
  components:
    - type: view
      style:
        width: '1'
        margin: 'auto'
        display: flex
        flexDirection: column
        justifyContent: center
        fontFamily: "Arial"
      children: 
        - .baseTopBar:
          children:
            - .baseTopMenu:
              children:
                - .AitmedLogo
                - .BaseUserBar
        - .ViewRow:
          style: 
            width: 89.8vw
            height: 4.5vw
            margin: "auto"
            marginTop: "6vw"
            justifyContent: center
          children:
            - .ViewRow:
              style: 
                marginLeft: 5vw
                width: 4vw
                top: 1vw
                height: 2vw
                justifyContent: flex-start
                alignItems: center
              children:
                - type: image
                  path: left_blue_arrow.png
                  style:
                    width: 1.5vw
                    height: 2vw
                  onClick: 
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - .Global.editProfile@: false   
                    
                    - actionType: builtIn
                      funcName: goBack
                      reload: true
                - .Label1:
                  text: "Back"
                  autocomplete: "off"
                  style: 
                    fontSize: .Nfonr.h1         
                    color: "#2988e6"
                    fontWeight: 550
                    marginLeft: 0.5vw
                  onClick: 
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - .Global.editProfile@: false   
                    
                    - actionType: builtIn
                      funcName: goBack
                      reload: true
            - type: view
              style:
                marginTop: 1.5vw
                height: 3.5vw
                width: 40vw
                borderBottom: "4px solid #005795"
                borderWidth: 4px
                display: flex
                flexDirection: row
                justifyContent: space-between
              children:  
                - type: label
                  text: "Moderna Vaccine - First Dose"
                  style:
                    marginTop: 0.5vw
                    color: "#005795"
                    fontSize: .Nfont.h6
                    fontWeight: 580
                    height: 3vw
                    textAlign: 
                      y: center
                - type: label
                  text: "4/5"
                  style:
                    marginTop: 1vw
                    width: 3vw
                    height: "2vw"
                    borderRadius: 5px
                    backgroundColor: "#1263A8"
                    color: "#ffffff"
                    fontSize: .Nfont.h3
                    fontWeight: 580
                    textAlign: 
                      x: center
                      y: center
        
        - type: view 
          style:
            width: 89.8vw
            height: 39vw
            margin: "auto"
            marginTop: "0.5vw"
          children:
            - type: scrollView
              style:
                width: 89.8vw
                height: 39vw
                marginTop: 0.5vw
              children:   
                - type: view
                  style:
                    width: 40vw
                    height: 39vw
                    backgroundColor: "#ffffff"
                    marginTop: 0.1vw
                    margin: auto
                    justifyContent: flex-start
                  children:
                    - type: view
                      style:
                        width: 40vw
                        backgroundColor: "#ffffff"
                        marginTop: 0.1vw
                        justifyContent: flex-start
                      children:
                        - .NewFirstTitle:
                          text: Pifzer-BioNTech COVID-19 Vaccine Consent Form
                          style:
                            marginTop: "1vw"
                            fontSize: .Nfont.h1
                            textAlign: 
                                x: center
                                y: center
                        - .NewFirstTitle:
                          text: 2.Consent for Vaccination
                          style:
                            marginTop: "1vw"
                            fontSize: .Nfont.h0
                            textAlign: 
                                x: center
                                y: center
                  
                        - type: view
                          style: 
                            width: "40vw"
                            height: auto
                            # backgroundColor: "red"
                          children:  
                            - .VaccineTextView:
                              style:
                                width: "40vw"
                                marginTop: 0.5vw
                                height: 3vw
                              children: 
                                - .VaccineTextDot:
                                  text: a.
                                  style:
                                    fontSize: .Nfont.h0 
                                    color: "#143459"                
                                - .VaccineText:
                                  text: The Fact Sheet for Patients and Parents / Caregivers for the Pfizer-BioNTech COVID-19 Vaccine I am receiving (sometimes hereafter, the COVID-19 Vaccine) has been offered to me.
                                  style:
                                    marginTop: '0'
                                    left: "0.8vw"
                                    # height: "3vw"
                                    width: "40vw"
                                    color: "#333333"
                                    fontSize: .Nfont.h0
                                    lineHeight: 1.2vw
                            - .VaccineTextView:
                              style:
                                width: "40vw"
                                marginTop: 1vw
                                height: 3vw
                              children: 
                                - .VaccineTextDot:
                                  text: b.
                                  style:
                                    fontSize: .Nfont.h0 
                                    color: "#143459" 
                                - .VaccineText:
                                  text: I have read or had explained to me the Pfizer-BioNTech Fact Sheet for Patients and Parents / Caregivers for the COVID-19 Vaccine and I understand the risks and benefits.
                                  style:
                                    marginTop: '0'
                                    left: "0.8vw"
                                    # height: "3vw"
                                    width: "40vw"
                                    color: "#333333"
                                    fontSize: .Nfont.h0
                                    lineHeight: 1.2vw
                            - .VaccineTextView:
                              style:
                                width: "40vw"
                                marginTop: 1vw
                                height: 3vw
                              children: 
                                - .VaccineTextDot:
                                  text: c.
                                  style:
                                    fontSize: .Nfont.h0 
                                    color: "#143459" 
                                - .VaccineText:
                                  text: I understand the COVID-19 Vaccine has been approved by an emergency use authorization (EUA) process and has not fully been FDA reviewed or approved.
                                  style:
                                    marginTop: '0'
                                    left: "0.8vw"
                                    # height: "3vw"
                                    width: "40vw"
                                    color: "#333333"
                                    fontSize: .Nfont.h0
                                    lineHeight: 1.2vw
                            - .VaccineTextView:
                              style:
                                width: "40vw"
                                height: 3vw
                              children: 
                                - .VaccineTextDot:
                                  text: d.
                                  style:
                                    fontSize: .Nfont.h0 
                                    color: "#143459" 
                                - .VaccineText:
                                  text: I understand the potential risks from the therapy including serious allergic reactions (anaphylaxis). Other adverse reactions that have been reported include injection site pain, fatigue, headache, muscle pain, chills, joint pain, fever, injection site swelling, injection site redness, nausea, malaise, and lymphadenopathy.
                                  style:
                                    marginTop: '0'
                                    left: "0.8vw"
                                    # height: "3vw"
                                    width: "40vw"
                                    color: "#333333"
                                    fontSize: .Nfont.h0
                                    lineHeight: 1.2vw
                            - .VaccineTextView:
                              style:
                                width: "40vw"
                                height: 3vw
                                marginTop: 2vw
                              children: 
                                - .VaccineTextDot:
                                  text: e.
                                  style:
                                    fontSize: .Nfont.h0 
                                    color: "#143459" 
                                    marginTop: '0.03'
                                - .VaccineText:
                                  text: I understand that there may be other potential options to prevent COVID-19.
                                  style:
                                    marginTop: '0.03'
                                    left: "0.8vw"
                                    # height: "2.7vw"
                                    width: "40vw"
                                    color: "#333333"
                                    fontSize: .Nfont.h0
                            - .VaccineTextView:
                              style:
                                width: "40vw"
                                height: 3vw
                              children: 
                                - .VaccineTextDot:
                                  text: f.
                                  style:
                                    fontSize: .Nfont.h0 
                                    color: "#143459" 
                                    marginTop: '0.02'
                                - .VaccineText:
                                  text: I was offered the opportunity to ask questions and all questions were answered.
                                  style:
                                    marginTop: '0.02'
                                    left: "0.8vw"
                                    # height: "3vw"
                                    width: "40vw"
                                    color: "#333333"
                                    fontSize: .Nfont.h0
                            - .VaccineTextView:
                              style:
                                width: "40vw"
                                height: 3vw
                              children: 
                                - .VaccineTextDot:
                                  text: g.
                                  style:
                                    fontSize: .Nfont.h0 
                                    color: "#143459"
                                    marginTop: '0.02'
                                - .VaccineText:
                                  text: I agree to proceed with receiving the Pfizer-BioNTech COVID-19 Vaccine.
                                  style:
                                    marginTop: '0.02'
                                    left: "0.8vw"
                                    # height: "3vw"
                                    width: "40vw"
                                    color: "#333333"
                                    fontSize: .Nfont.h0
                    
                    - type: view
                      style: 
                        left: "0"
                        marginTop: "0.02"
                        width: "40vw"
                        height: "0.1" 
                      children: 
                        - type: list
                          contentType: listObject
                          listObject: ..formData.consent
                          iteratorVar: itemObject
                          viewTag: consentView
                          style: 
                            margin: "0"
                            top: "0"
                            width: "40vw"
                            left: "0"
                          children: 
                            - type: listItem
                              itemObject: ""
                              style: 
                                left: "0"
                                width: "40vw"
                                marginTop: "0.01"
                              children: 
                                - type: image
                                  path: 
                                    emit:
                                      dataKey:
                                          var: itemObject
                                      actions:                        
                                        - if:
                                          - =.builtIn.string.equal:
                                              dataIn:
                                                string1: =..formDataTemp.single.0.consent
                                                string2: $var.value
                                          - selectOnblue.svg
                                          - selectBlack.svg
                                  style:
                                    left: "0.2vw"
                                    width: 1vw
                                    top: "0.0035"
                                  onClick: 
                                    - emit:
                                        dataKey:
                                          var: itemObject
                                        actions: 
                                          - =.builtIn.string.equal:
                                              dataIn:
                                                string1: =..formDataTemp.single.0.consent
                                                string2: $var.value
                                          - =.builtIn.object.set:
                                              dataIn:
                                                object: =..formDataTemp.single.0
                                                key: $var.key
                                                value: ""
                                          - =.builtIn.object.set:
                                              dataIn:
                                                object: =..formDataTemp.single.0
                                                key: $var.key
                                                value: $var.value
                                    - actionType: builtIn
                                      funcName: redraw
                                      viewTag: consentView
                                - .VQSecondTitle:
                                  textBoard:
                                    - text:
                                      dataKey: itemObject.text1
                                    - text: ""
                                      dataKey: formDataTemp.facilityName
                                    - text: ""
                                      dataKey: itemObject.text2
                                  style: 
                                    left: 2vw
                                    width: "40vw"
                                    marginTop: "0.005"
                                    fontSize: .Nfont.h0
                                    lineHeight: 1.2vw
                                    textAlign: 
                                      x: left
                                    
                                    height: "auto"
                                    color: "#333333"   
                    - type: view
                      style:
                        marginTop: 1vw
                        width: 29vw
                        height: "3.5vw"
                        # backgroundColor: "red"
                      children:
                        - type: label
                          text: "Name of Recipient/Healthcare Proxy"
                          style:
                            marginTop: '0.02'
                            fontSize: .Nfont.h0_1
                            color: "#333333"
                            fontWeight: 550
                        - type: textField
                          dataKey: recipientName
                          placeholder: " Enter here"
                          style: 
                            textIndent: 0.5em
                            height: "2.5vw"
                            width: 20vw
                            fontSize: .Nfont.h0_1
                            border: 
                              style: "3"
                            borderRadius: "5"
                            borderColor: "#DEDEDE"
                        - type: view
                          style: 
                            marginTop: 1vw
                            width: "40vw"
                            border:
                              style: "1"
                              width: "1"
                              color: "#DEDEDE"
                            # backgroundColor: "red"
                          children:
                            - .VQSecondTitle:
                              text: Signature
                              style: 
                                marginTop: 2vw
                                fontSize: .Nfont.h0_1
                                color: "#333333"
                                fontWeight: 550
                            - .ViewRow:
                              style:
                                justifyContent: space-between
                                alignItems: center
                                width: "30vw"
                              children:
                                - .VQSecondTitle:
                                  text: "Click on the signature box below to finger sign"
                                  style:
                                    marginTop: 0.5vw
                                - type: button
                                  text: "Clear"
                                  onClick:
                                    # 移除签名
                                    - actionType: removeSignature
                                      dataObject: BLOB
                                      dataKey: ModernaVaccineFirDoseEditPage4.newSign.document.name.data   
                                      viewTag: signatureTag   
                                    - actionType: evalObject
                                      object:
                                        - ..temporarySignature@: ""
                                        - ..signatureTime@: ""
                                        - .Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.whetherConsentSignature@: true
                                    # 显示签名区域隐藏
                                    - actionType: builtIn
                                      funcName: hide
                                      viewTag: signatureShowTag
                                    - actionType: builtIn
                                      funcName: show
                                      viewTag: signatureTag         
                                  style:
                                    marginTop: 0.5vw
                                    width: "4vw"
                                    fontSize: .Nfont.h0_1
                                    height: '1vw'
                                    color: "#E24445"
                                    border: 'none'
                                    borderRadius: "2"
                                    backgroundColor: '0xffffff'
                                    textAlign:
                                      y: center
                                      x: center 
                            - type: view
                              style: 
                                marginTop: "0.01"
                                width: "28.9vw"
                                height: "0.2"
                                border:
                                  style: "4"
                                  width: "1.5"
                                  color: "0xDEDEDE"
                              children:
                                - .ViewRow:
                                  style:
                                    margin: "auto"
                                    marginTop: "0.16"
                                    width: "24vw"
                                  children:
                                    - type: label
                                      text: "x"
                                      style:
                                        height: "1vw"
                                    - type: label
                                      style:
                                        height: "1vw"
                                        width: "24vw"
                                        borderBottom: "1px solid #666666"
                                        borderWidth: "1px"
                                - type: image
                                  viewTag: signatureShowTag
                                  path=func: .builtIn.utils.prepareDocToPath
                                  # 传入签名文档的id
                                  dataKey: ModernaVaccineFirDoseEditPage4.temporarySignature
                                  style:
                                    # 控制显示
                                    display: ..flag
                                    top: "0"
                                    width: "25.9vw"
                                    height: "0.15"
                                    overflow: scroll  
                                - type: canvas
                                  dataKey: ModernaVaccineFirDoseEditPage4.newSign.document.name.data 
                                  viewTag: signatureTag    
                                  style: 
                                    left: "0"
                                    top: "0"
                                    width: "25.9vw"
                                    height: "0.15"
                                    overflow: scroll  
                                # 显示暂存的签名
                                
                        - .ViewColumn:
                          style:
                            marginTop: 1vw
                            width: 29vw
                          children:
                            - .ViewRow:
                              style:
                                justifyContent: flex-start
                              children:
                                - .VQSecondTitle: 
                                  text: "Patient Name"
                                - .VQSecondTitle:
                                  dataKey: profile.docResponse.doc.0.name.data.basicInfo.fullName
                                  style:
                                    color: "#333333"
                                    marginLeft: 1vw
                            - .ViewRow:
                              style: 
                                marginTop: 1vw
                                justifyContent: flex-start
                              children:
                                - .VQSecondTitle: 
                                  text: "Date"
                                - .VQSecondTitle:
                                  text=func: .builtIn.string.formatUnixtimeL_en
                                  dataKey: Global.formData.modernaVaccineFirDoseForm.ctime
                                  style:
                                    color: "#333333"
                                    marginLeft: 1vw

            - type: view
              style:
                height: 2.3vw
                left: 15.5vw
                top: 15.5vw
              children:
                - type: image
                  path: Leftbutton.svg
                  style:
                    height: 3vw
                  onClick: 
                    - actionType: evalObject
                      object: 
                        - .Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.whetherConsentSignature@: true
                    - goto: ModernaVaccineFirDoseEditPage3
                        
            - type: view
              style:
                height: 2.3vw
                left: 60.3vw
                top: 15.5vw
              children:
                - type: image
                  path: Rightbutton.svg
                  style:
                    height: 3vw
                    left: 10vw
                    textAlign:
                      x: center
                      y: center
                  onClick:
                    - actionType: evalObject
                      object:
                        - if: 
                          - =.builtIn.string.equal:
                              dataIn:
                                string1: =..formDataTemp.single.0.consent
                                string2: "1"
                          - continue
                          - actionType: popUp
                            popUpView: agreeView
                            wait: true 
                    # 签名处理
                    - actionType: saveSignature
                      dataObject: BLOB
                      dataKey: ModernaVaccineFirDoseEditPage4.newSign.document.name.data  
                      isEmpty: ModernaVaccineFirDoseEditPage4.whetherSignature
                    - actionType: evalObject
                      object:
                        - if:
                          - =.builtIn.string.equal:
                              dataIn:
                                string1: =..newSign.document.name.data.size
                                string2: 980
                          - continue
                          - =..newSign.docAPI.store: "" 
                        # 存放签名的id
                        - if: 
                          - =..whetherSignature
                          - .Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.whetherConsentSignature@: =..whetherSignature
                          - actionType: evalObject
                            object:
                              - .Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.isAgree@: =..formDataTemp.single.0.consent
                              - .Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.recipientName@: =..recipientName
                              - .Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.signatureTime@: =..newSign.docRes.doc.ctime
                              - .Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.signaturePfizerVaccine@: =..newSign.docRes.doc.id
                              # 保存签名判断状态
                              - .Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.whetherConsentSignature@: =..whetherSignature
                        - if: 
                          - =.builtIn.string.equal:
                              dataIn:
                                string1: =..temporarySignature
                                string2: ""
                          - continue 
                          - actionType: evalObject
                            object:
                              - .Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.signaturePfizerVaccine@: =..temporarySignature
                              - .Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.signatureTime@: =..signatureTime
                              # 保存签名判断状态
                              - .Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.whetherConsentSignature@: false   
                        - if: 
                          - =.Global.formData.modernaVaccineFirDoseForm.name.data.signatureConsent.whetherConsentSignature
                          - actionType: popUp
                            popUpView: warningView
                            wait: true
                          - continue
                    - goto: ModernaVaccineFirDoseEditPage5
        - .NewBaseWarningView: 
          message: "You haven’t signed the form"
        - .NewBaseWarningView:
          viewTag: agreeView  
        