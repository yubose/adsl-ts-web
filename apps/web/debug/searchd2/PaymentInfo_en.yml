PaymentInfo:
  title: PaymentInfo
  pageNumber:
  init:
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - actionType: evalObject  
      object: 
        - .BaseComponents.calendarDate.year@: ""
        - .BaseComponents.calendarDate.month@: ""
        - .BaseComponents.calendarDate.day@: ""
        - .BaseComponents.calendarDate.monthName@: ""
        - .BaseComponents.calendarDate.todayDate@: ""
        - .BaseComponents.calendarDate.flag@: ""
        - .BaseComponents.calendarDate.dayLable@: []
        - .BaseComponents.year@: []
        - .BaseComponents.flag: ""
        #生成年份
        - =.builtIn.date.generateYear:
            dataIn:
              last: 80
              next: 10
            dataOut: BaseComponents.year
    - actionType: evalObject 
      object: 
        .BaseComponents.getDate
    - actionType: evalObject
      object: 
        .BaseComponents.getShow
    - =..squareCheckout.edgeAPI.store: ""
    - actionType: evalObject
      object:
        - ..website@: =..squareCheckout.response.edge.deat.squareID          
  squareCheckout:
    response: ""
    # 所有与预约有关的信息都在Global.roomInfo.edge
    edge:
      .Edge: ""
      type: .EdgeType.SquareCheckout
      bvid: .Global.currentUser.vertex.id
      refid: .Global.newAppointment.id
      evid: .Global.newAppointment.name.facilityId
      name:
        amount: .Global.newAppointment.name.fee
        url:  "https://patd3.aitmed.io/index.html?PaymentConfirmation"
        quantity: "1"
        itemName: "Appointment fee"
        note: "for testing"
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: squareCheckout.edge
        dataOut: squareCheckout.response
  squareOrder:
    docReq:
      type: .DocType.CheckOrder 
      eid: "" 
      name:
        data:
          orderInfo:    # 订单信息 
            squareID: ""
            squareURL: ""
            amount: ""
            # balance: "" in deat 
            # status: ""  in deat
            processFee: ""    # 手续费
            payer: .Global.currentUser.vertex.name.userName
          appointmentInfo:   # 预约信息/会议信息
            reason: .Global.newAppointment.name.visitReason
            providerName: .Global.newAppointment.name.providerName
            visitType: .Global.newAppointment.name.visitType    # appointment type: egg.Telemedicine,Office Visit
            appTime: .Global.newAppointment.stime
        nonce: ""
      subtype: 
        isEncrypted: "0"
        isOnServer: "1"     
    docRes: ""
    docAPI:
      store:
        api: cd
        dataIn: squareOrder.docReq
        dataOut: squareOrder.docRes    
  website: ""

  components:
    # Appointment Summary
    - type: view
      viewTag: AppointmentSummary
      style:
        backgroundColor: 'white'
        border:
          style: '3'
        borderColor: "#4b9ae7"
        borderRadius: "5px"
        width: "0.362"
        height: "0.8"
        top: 4vw
      children:
        - type: view
          style: 
            marginTop: 0
            width: "0.362"
            height: "0.084"
            borderBottom: "1.5px solid  #dfe1e5"
            borderWidth: 2  
            display: flex
            flexDirection: row
            alignItems: center
            justifyContent: space-between
            boxShadow: "0px 10px 10px -10px #d1d1d1"
          children: 
            - .ViewRow:
              style:
                width: 32vw
                marginLeft: 1vw
                justifyContent: space-between
              children:
                - .PerDetTitle:
                  text: Appointment Summary
                  style: 
                    fontSize: 1.2vw
                - .ViewRow:
                  style:
                    alignItems: flex-end
                  children:
                    - .PDScheduleButton:
                      style:
                        backgroundColor: "#f8ae29"
                    - .PDScheduleButton:
                      style:
                        backgroundColor: "#f8ae29"
                    - .PDScheduleButton:
                      style:
                        backgroundColor: "#f8ae29"
                    - .PDScheduleButton:
                      style:
                        backgroundColor: "#f8ae29"
        - .ViewColumn:
          style:
            height: 36vw
            width: "0.362"
            marginTop: 0
            justifyContent: flex-start
            alignItems: center
          children:
            - type: view
              style:
                width: "0.322"
                margin: auto
                justifyContent: space-between
                alignItems: baseline
              children:
                - .ViewColumn:
                  style:
                    marginTop: 2vw
                    width: 5vw
                    marginLeft: 12.5vw
                  children:
                    - .PerDetTitle:
                      text: "Success!"
                      style: 
                        color: "#30B354"
                        fontSize: 1.2vw
                        width: 5vw
                        textAlign:
                          x: center 
                    - type: image
                      path: Flat.png
                      style: 
                        width: 5vw
                      
                - .ViewColumn:
                  style:
                    width: "0.322"
                    marginTop: 2vw
                  children:
                    - .ViewRow:
                      style:
                        width: "0.322"
                        marginTop: 0.5vw
                        justifyContent: space-between
                        alignItems: flex-start
                      children:
                        - .PerDetTitle:
                          text: Date & Time Selected
                        - .PerDetTitle:
                          text=func: .builtIn.string.formatUnixtime_en
                          dataKey: apiRequest.newAppointment.edge.stime
                          style:
                            color: "#6f7070"
                            wordBreak: break-all
                            fontWeight: "lighter"
                    - .ViewRow:
                      style:
                        width: "0.322"
                        marginTop: 0.5vw
                        justifyContent: space-between
                        alignItems: flex-start
                      children:
                        - .PerDetTitle:
                          text: Reason for Visit
                        - .PerDetTitle:
                          dataKey: apiRequest.newAppointment.edge.name.visitReason
                          style:
                            color: "#6f7070"
                            wordBreak: break-all
                            fontWeight: "lighter"
                    - .ViewRow:
                      style:
                        width: "0.322"
                        marginTop: 0.5vw
                        justifyContent: space-between
                        alignItems: flex-start
                      children:
                        - .PerDetTitle:
                          text: Appointment Type
                        - .PerDetTitle:
                          dataKey: apiRequest.newAppointment.edge.name.visitType
                          style:
                            color: "#6f7070"
                            wordBreak: break-all
                            fontWeight: "lighter"
                    - .ViewRow:
                      style:
                        width: "0.322"
                        marginTop: 0.5vw
                        alignItems: flex-start
                        justifyContent: space-between
                      children:
                        - .PerDetTitle:
                          text: Provider
                        - .PerDetTitle:
                          dataKey: formData.appointmentProviderName
                          style:
                            color: "#6f7070"
                            fontWeight: "lighter"
                    - .ViewRow:
                      style:
                        width: "0.322"
                        marginTop: 0.5vw
                        justifyContent: space-between
                        alignItems: flex-start
                      children:
                        - .PerDetTitle:
                          text: Facility
                        - .PerDetTitle:
                          dataKey: Global.FacilityInfos.name.data.basicInfo.medicalFacilityName
                          style:
                            color: "#6f7070"
                            fontWeight: "lighter"
                    
                    - .ViewRow:
                      style:
                        width: "0.322"
                        marginTop: 0.5vw
                        justifyContent: space-between
                        alignItems: flex-start
                      children:
                        - .PerDetTitle:
                          text: "Payment Status"
                        - .PerDetTitle:
                          dataKey: Global.FacilityInfos.name.data.basicInfo.medicalFacilityName
                          style:
                            color: "#6f7070"
                            fontWeight: "lighter"
                    - type: view
                      style:
                        width: "0.322"
                        height: "0.001"
                        backgroundColor: "#DEDEDE"
                        marginTop: 0.5vw
                    - .ViewRow:
                      style:
                        width: "0.322"
                        marginTop: 0.5vw
                        justifyContent: space-between
                        alignItems: flex-start
                      children:
                        - .PerDetTitle:
                          text: "Fee"
                        - .PerDetTitle:
                          dataKey: Global.FacilityInfos.name.data.basicInfo.medicalFacilityName
                          style:
                            color: "#6f7070"
                            fontWeight: "lighter"
                - .PerDetTitle:
                  text: Edit or view appointments, change your profile in AiTmed Care App.
                  style:  
                    width: 23vw
                    marginLeft: 3.5vw
                    color: "#43ba63"
                    fontSize: 1.1vw
                    fontWeight: 400
                    marginTop: 3vw

                    textAlign: 
                      x: center
            
            - type: button
              text: Pay Now
              style: 
                top: "0.64"
                marginLeft: "0.25"
                width: "0.08"
                height: "0.037"
                borderRadius: 5px
                backgroundColor: "#ffffff"
                
                # backgroundColor: "#0a5795"
                border:
                  style: 3
                  color: "#2988E6"
                color: "#2988E6"
                fontSize: 1vw
                textAlign:
                  x: center
                  y: center
              onClick:
                - actionType: evalObject
                  object:
                    - ..squareOrder.docReq.eid@: =..squareCheckout.response.edge.id
                    - ..squareOrder.docReq.name.data.orderInfo.squareURL@: =..squareCheckout.response.edge.deat.squareURL
                    - ..squareOrder.docReq.name.data.orderInfo.squareID@: =..squareCheckout.response.edge.deat.squareID
                    - ..squareOrder.docReq.name.data.orderInfo.amount@: =..squareCheckout.response.edge.deat.balance
                    - ..squareOrder.docReq.name.nonce@: =..squareCheckout.response.edge.deat.squareID
                    - .Global.paymentCheck.id@: =..squareCheckout.response.edge.id
                    - =..squareOrder.docAPI.store: "" 
                    - .Global.paymentOrder.document@: =..squareOrder.docRes.doc                                         
                - goto: =..squareCheckout.response.edge.deat.squareURL #website
                - actionType: updateObject
                  dataKey: Global.newAppointment
                  dataObject: {}
