Cov19TestFormEditPage3:
  viewPort: top
  title: Cov19TestFormEditPage3
  init: 
    - .Global.formData.cov19TestForm.name.data.signatureIsolation.facilityName@: =.Global.FacilityInfos.name.data.basicInfo.medicalFacilityName

    # 判断是否签名
    - actionType: evalObject
      object:
        - if:
            - =.Global.formData.cov19TestForm.name.data.signatureIsolation.whetherIsolationSignature
            - continue
            - actionType: evalObject
              object:
                - ..signatureTime@: =.Global.formData.cov19TestForm.name.data.signatureHippa.signatureTime
                - ..whetherSignature@: =.Global.formData.cov19TestForm.name.data.signatureIsolation.whetherIsolationSignature
    - if:
      - =.Global.formData.cov19TestForm.name.data.signatureIsolation.recipientName
      - ..recipientName@: =.Global.formData.cov19TestForm.name.data.signatureIsolation.recipientName
      - continue        
    - if:
      - =.Global.formData.cov19TestForm.name.data.signatureIsolation.id
      - ..temporarySignature@: =.Global.formData.cov19TestForm.name.data.signatureIsolation.id
      - continue
    # 判断显示签名的id是否为空
    # 判断显示签名的id是否为空
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =..temporarySignature
              string2: ""
        - continue
        # 非空修改显示的标识,刷新签名区域
        - actionType: evalObject
          object:
            - ..flag@: "block"
            - actionType: builtIn
              funcName: redraw
              viewTag: signatureShowTag
    - actionType: evalObject
      object: .BaseDate.miniWeekGet
    - actionType: evalObject
      object: .BaseDate.getDate
    - if:
      - =.Global.isSignIn
      - actionType: evalObject
        object:
          - ..isPersonal@: "false"
          - ..isSignIn@: "true"
      - actionType: evalObject
        object:
          - ..isPersonal@: "true"
          - ..isSignIn@: "false"
    - ..profile.docAPI.get
    - if:
      - =..profile.docResponse.doc.0
      - actionType: evalObject
        object:
          - ..profile.patientdocument@: =..profile.docResponse.doc.0
          - =.builtIn.utils.prepareDoc:
              dataIn:
                doc: =..profile.docResponse.doc.0
              dataOut: PersonalDetail.profile.patientdocument
      - continue
  isPersonal:
  isSignIn:
    
  profile:
    docResponse: ""
    patientdocument: ""
    document:
      type: .DocType.PatientProfile
      eid: .Global.rootNotebookID
      name:
        # .Global.Profile: ""
        data:
          insurance: 
            insuranceProvider: ""
            policyHolderName: ""
            groupOrPolicy: ""
            memberID: ""
          phone: .Global.currentUser.vertex.uid
          phone2: ""
          avatarUrl: ava.png
          avatar: ""
          gender: ""
          email: ""
          firstName: .Global.currentUser.vertex.name.firstName
          middleName: ""
          lastName: .Global.currentUser.vertex.name.lastName
          birth: ""
          userName: .Global.currentUser.vertex.name.userName
          address: ""
          fullName: .Cov19TestFormEditPage3.formData.showName
          Address:
            St: ""
            city: ""
            state: ""
            line2: ""
            zip: ""
          name: ""
          relation: ""
        type: .Cov19TestFormEditPage3.profile.docAPI.store.subtype.mediaType
    docAPI:
      get:
        .DocAPI.get: "" 
        api: rd
        id: .Global.rootNotebookID
        xfname: eid
        type: .DocType.PatientProfile
        obfname: mtime
        dataKey: profile.docResponse
        _nonce: =.Global._nonce 
  experienceSelect: 
    - key: fever
      value: Fever
    - key: muscieAches
      value: Muscie aches
    - key: cough
      value: Cough
    - key: nausea
      value: Nausea and vomiting
    - key: shortBreath
      value: Shortness of breath
    - key: diarrhea
      value: Diarrhea
    - key: soreThroat
      value: Sore throat
    - key: tiredness
      value: Tiredness,Fatigue
    - key: headache
      value: Headache
    - key: other
      value: "Other:"
    - key: none
      value: None
  symptomProfile: 
      experience: []
  QuestionList:
    isLiveInGroup:
      - key: isLiveInGroup
        value: 'Yes'
      - key: isLiveInGroup
        value: 'No'
    isWorkInHospital:
      - key: isWorkInHospital
        value: 'Yes'
      - key: isWorkInHospital
        value: 'No'
    haveTraveledOutside:
      - key: haveTraveledOutside
        value: 'Yes'
      - key: haveTraveledOutside
        value: 'No'
    haveContactPatient:
      - key: haveContactPatient
        value: 'Yes'
      - key: haveContactPatient
        value: 'No'
  # 签名文档
  newSign:
    docRes: ""
    docReq:
      type: .DocType.DocumentSignature
      id: .Global.rootNotebookID
      xfname: eid
    document: #DOC
      type: .DocType.DocumentSignature
      name:
        title: ""
        type: ..newSign.document.subtype.mediaType
        data: ""
      eid: .Global.rootNotebookID
      reid: .Global.formData.cov19TestForm.id
      subtype:
        mediaType: "" # mediaType : "image/jpeg"
    docAPI: # DOCAPI
      store:
        api: cd
        dataIn: Cov19TestFormEditPage3.newSign.document
        dataOut: Cov19TestFormEditPage3.newSign.docRes
  cov19TestForm:
    docResp: ""
    docReq:
      id: ""
      eid: .Global.rootNotebookID
      type: .DocType.Cov19TestForm
      name:
        data: ""
        title: "COVID-19 Testing Consent Form"
        user: .Global.Profile.name.data.basicInfo.fullName
    docAPI:
      store:
        api: cd
        dataIn: Cov19TestFormEditPage3.cov19TestForm.docReq
        dataOut: Cov19TestFormEditPage3.cov19TestForm.docResp
  recipientName: ""
  # 获取暂存的签名的id
  temporarySignature: ""
  # 签名的显示,默认为none
  flag: "none"
  # 是否签名 true 表示未签 false 表示已签
  whetherSignature: ""
  signatureTime: ""
  formData: # Input data here
    doc: []
    countryCode: "+1"   
    phoneNumber: "8881307128"
    password: "123456"
    code: ""
    sk: ""
    pass: ""
    showName: ""
  components:
    - type: view
      style:
        width: '1'
        margin: 'auto'
        display: flex
        flexDirection: column
        justifyContent: center
        fontFamily: "Arial"
      children: 
        - .baseTopBar:
          children:
            - .baseTopMenu:
              children:
                - .AitmedLogo
                - .BaseUserBar
        - .ViewRow:
          style: 
            width: 90vw
            height: 4.5vw
            margin: "auto"
            marginTop: "6vw"
            justifyContent: center
            right: 0
          children:
            - .ViewRow:
              style: 
                marginLeft: 5vw
                width: 4vw
                top: 1vw
                height: 2vw
                justifyContent: flex-start
                alignItems: center
              children:
                - type: image
                  path: left_blue_arrow.png
                  style:
                    width: 1.5vw
                    height: 2vw
                  onClick: 
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - .Global.editProfile@: false   
                    
                    - actionType: builtIn
                      funcName: goBack
                      reload: true
                - .Label1:
                  text: "Back"
                  autocomplete: "off"
                  style: 
                    fontSize: .Nfont.h1         
                    color: "#2988e6"
                    fontWeight: 550
                    marginLeft: 0.5vw
                  onClick: 
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - .Global.editProfile@: false   
                    
                    - actionType: builtIn
                      funcName: goBack
                      reload: true
            - type: view
              style:
                marginTop: 1.5vw
                height: 3.5vw
                width: 40vw
                borderBottom: "4px solid #005795"
                borderWidth: 4px
                display: flex
                flexDirection: row
                justifyContent: space-between
              children:  
                - type: label
                  text: "Covid-19 Testing Consent"
                  style:
                    marginTop: 0.5vw
                    color: "#005795"
                    fontSize: .Nfont.h6
                    fontWeight: 580
                    height: 3vw
                    textAlign: 
                      y: center
                - type: label
                  text: "3/3"
                  style:
                    marginTop: 1vw
                    width: 3vw
                    height: "2vw"
                    borderRadius: 5px
                    backgroundColor: "#1263A8"
                    color: "#ffffff"
                    fontSize: .Nfont.h3
                    fontWeight: 580
                    textAlign: 
                      x: center
                      y: center
        - type: view
          style:
            width: 89.8vw
            height: 39vw
            margin: "auto"
            marginTop: "0.5vw"
          children:
            - type: scrollView
              style:
                width: 89.8vw
                height: 39vw
                marginTop: 0.5vw
              children:
                - type: view
                  style:
                    width: 40vw
                    height: 39vw
                    backgroundColor: "#ffffff"
                    marginTop: 0.1vw
                    margin: auto
                    justifyContent: flex-start
                  children:
                    - type: view
                      style:
                        width: 40vw
                        backgroundColor: "#ffffff"
                        marginTop: 0.1vw
                        justifyContent: flex-start
                      children:
                        - .NewFirstTitle:
                          text: Agreement For Self-Isolation
                          style:
                            marginTop: "1vw"
                            fontSize: .Nfont.h1
                            textAlign: 
                                x: center
                                y: center
                        - type: label
                          text: The local health jurisdiction has determined that if you are under suspicion for having COVID-19 due to symptoms and testing request, that it is necessary to be placed in isolation in order to prevent the transmission of this infection. It is important for you to comply with this Isolation Agreement in order to protect the public’s health. Thank you for agreeing to cooperate.
                          style:
                            width: "40vw"
                            # left: '0.07'
                            marginTop: '0.02'
                            fontSize: .Nfont.h0_1
                            color: "0x666666"
                        - type: label
                          text: "Please carefully read the following informed consent:"
                          style:
                            marginTop: "0.025"
                            fontSize: .Nfont.h0_1
                            fontWeight: "550"
                            color: "#333333"
                        - type: label
                          text: a. I understand that I may be infected with the virus causing COVID-19 and that I meet criteria for isolation.
                          style:
                            width: "40vw"
                            # left: '0.07'
                            marginTop: '0.02'
                            fontSize: .Nfont.h0_1
                            color: "0x666666"
                        - type: label
                          text: b. I agree that while I wait for my COVID-19 test results, I will remain in self-isolation. 
                          style:
                            width: "40vw"
                            # left: '0.07'
                            marginTop: '0.02'
                            fontSize: .Nfont.h0_1
                            color: "0x666666"
                        - type: label
                          text: c. I agree that if my COVID-19 test results are positive, I will remain isolated for 7 days from this day of testing OR until at least 72 hours after my symptoms have resolved, whichever is longer. 
                          style:
                            width: "40vw"
                            # left: '0.07'
                            marginTop: '0.02'
                            fontSize: .Nfont.h0_1
                            color: "0x666666"
                        - type: label
                          text: d. I agree that if my COVID-19 test results are negative, I will remain isolated until at least 72 hours after my symptoms have resolved.
                          style:
                            width: "40vw"
                            # left: '0.07'
                            marginTop: '0.02'
                            fontSize: .Nfont.h0_1
                            color: "0x666666"
                        - type: label
                          text: e. I understand that if I am not isolated while ill, I could pose a substantial threat to the health of other persons. 
                          style:
                            width: "40vw"
                            # left: '0.07'
                            marginTop: '0.02'
                            fontSize: .Nfont.h0_1
                            color: "0x666666"
                        - type: label
                          text: f. I agree that I will not come into contact with any other person who is not isolated or ill due to potential COVID- 19 infection.  
                          style:
                            width: "40vw"
                            # left: '0.07'
                            marginTop: '0.02'
                            fontSize: .Nfont.h0_1
                            color: "0x666666"
                        - type: label
                          text: g. I understand that if I test positive for IgM antibody, I may need to take a COVID-19 swab test for active virus confirmation.  
                          style:
                            width: "40vw"
                            # left: '0.07'
                            marginTop: '0.02'
                            fontSize: .Nfont.h0_1
                            color: "0x666666"
                        - type: label
                          text: h. I understand that testing positive for antibody does not mean immunity to COVID-19.  
                          style:
                            width: "40vw"
                            # left: '0.07'
                            marginTop: '0.02'
                            fontSize: .Nfont.h0_1
                            color: "0x666666"
                        - type: label
                          textBoard:
                            - text: "I, the undersigned, have been informed about the test purpose, procedures, possible benefits and risks, and I have received a copy of this Informed consent. I have been given the opportunity to ask questions before I sign, and I have been told that I can ask other questions at any time. I voluntarily agree to antibody screening and/or testing for COVID-19 and to self-isolation.  If "
                            - text: "A&C Urgent Care"
                              dataKey: Global.FacilityInfos.name.data.basicInfo.medicalFacilityName
                              color: "0x005795"
                              fontWeight: 550
                            - text: " Urgent Care does not accept my insurance I consent to being financially responsible for the testing. If my insurance denies covering the cost of the testing I consent to being financially responsible for the testing."   
                          style:
                            width: "40vw"
                            # left: '0.07'
                            marginTop: '0.02'
                            fontSize: .Nfont.h0_1
                            color: "0x666666"
                    - type: view
                      style:
                        marginTop: 1vw
                        width: 29vw
                        height: "3.5vw"
                      children:
                        - type: label
                          text: "Name of Recipient/Healthcare Proxy"
                          style:
                            marginTop: '0.02'
                            fontSize: .Nfont.h0_1
                            color: "#333333"
                            fontWeight: 550
                        - type: textField
                          dataKey: recipientName
                          placeholder: " Enter here"
                          style: 
                            textIndent: 0.5em
                            height: "2.5vw"
                            width: 20vw
                            fontSize: .Nfont.h0_1
                            border: 
                              style: "3"
                            borderRadius: "5"
                            borderColor: "#DEDEDE"
                    - type: view
                      style:
                       # left: "0.085"
                        marginTop: 1vw
                        width: "40vw"
                        border:
                          style: "1"
                          width: "1"
                          color: "#DEDEDE"
                        # backgroundColor: "red"
                      children:
                        - .VQSecondTitle:
                          text: Signature
                          style: 
                            marginTop: 2vw
                            fontSize: .Nfont.h0_1
                            color: "#333333"
                            fontWeight: 550
                        - .ViewRow:
                          style:
                            justifyContent: space-between
                            alignItems: center
                            width: "30vw"
                          children:
                            - .VQSecondTitle:
                              text: "Click on the signature box below to finger sign"
                              style: 
                                marginTop: 0.5vw
                            - type: label
                              text: "Clear"
                              style:
                                marginTop: 0.5vw
                                width: "4vw"
                                fontSize: .Nfont.h0_1
                                height: '1vw'
                                color: "#E24445"
                                border: 'none'
                                borderRadius: "2"
                                backgroundColor: '0xffffff'
                                textAlign:
                                  y: center
                                  x: center
                              onClick:
                                # 移除签名
                                - actionType: removeSignature
                                  dataObject: BLOB
                                  dataKey: Cov19TestFormEditPage3.newSign.document.name.data   
                                  viewTag: signatureTag   
                                # 重置临时签名
                                - actionType: evalObject
                                  object:
                                    - ..temporarySignature@: ""
                                    - ..signatureTime@: ""
                                    - .Global.formData.cov19TestForm.name.data.signatureIsolation.whetherIsolationSignature@: true
                                # 显示签名区域隐藏
                                - actionType: builtIn
                                  funcName: hide
                                  viewTag: signatureShowTag
                                - actionType: builtIn
                                  funcName: show
                                  viewTag: signatureTag         
                              
                        - type: view
                          style: 
                            marginTop: "0.01"
                            width: "28.9vw"
                            height: "0.2"
                            border:
                              style: "4"
                              width: "1.5"
                              color: "0xDEDEDE"
                          children:
                            - .ViewRow:
                              style:
                                margin: "auto"
                                marginTop: "0.16"
                                width: "24vw"
                              children:
                                - type: label
                                  text: "x"
                                  style:
                                    height: "1vw"
                                - type: label
                                  style:
                                    height: "1vw"
                                    width: "24vw"
                                    borderBottom: "1px solid #666666"
                                    borderWidth: "1px"
                            - type: image
                              viewTag: signatureShowTag
                              path=func: .builtIn.utils.prepareDocToPath
                              # 传入签名文档的id
                              dataKey: Cov19TestFormEditPage3.temporarySignature
                              style:
                                # 控制显示
                                display: ..flag
                                left: "0"
                                width: "25.9vw"
                                top: "0"
                                height: 7.5vw  
                            - type: canvas
                              dataKey: Cov19TestFormEditPage3.newSign.document.name.data 
                              viewTag: signatureTag   
                              style: 
                                left: "0"
                                width: "25.9vw"
                                top: "0"
                                height: 7.5vw
                                overflow: scroll  
                            # 显示暂存的签名
                            
                            
                        - .ViewColumn:
                          style:
                            marginTop: 1vw
                            width: 29vw
                          children:
                            - .ViewRow:
                              style:
                                justifyContent: flex-start
                              children:
                                - .VQSecondTitle: 
                                  text: "Patient Name"
                                - .VQSecondTitle:
                                  dataKey: profile.docResponse.doc.0.name.data.basicInfo.fullName
                                  style:
                                    color: "#333333"
                                    marginLeft: 1vw
                            - .ViewRow:
                              style: 
                                marginTop: 1vw
                                justifyContent: flex-start
                                marginBottom: 1vw
                              children:
                                - .VQSecondTitle: 
                                  text: "Date"
                                - .VQSecondTitle:
                                  text=func: .builtIn.string.formatUnixtimeL_en
                                  dataKey: Global.formData.cov19TestForm.ctime
                                  style:
                                    color: "#333333"
                                    marginLeft: 1vw
            - type: view
              style:
                height: 2.3vw
                left: 15.5vw
                top: 15.5vw
              children:
                - type: image
                  path: Leftbutton.svg
                  style:
                    height: 3vw
                  onClick: 
                    - actionType: evalObject
                      object: 
                        - .Global.formData.cov19TestForm.name.data.signatureIsolation.whetherIsolationSignature@: true
                    - goto: Cov19TestFormEditPage2
            - type: view
              style:
                width: "90vw"
                height: 4.5vw
                borderTop: "2px solid #E3E3E3"
                borderWidth: 2px
                margin: auto
              children:
                - type: button
                  text: Done
                  style:
                    width: 12.3vw
                    height: 2.3vw
                    margin: auto
                    marginTop: 1.5vw
                    borderRadius: 5px
                    backgroundColor: "#1263A8"
                    color: "#ffffff"
                    fontSize: .Nfont.h1
                    textAlign:
                      x: center
                      y: center
                  onClick:
                    # 签名处理
                    - actionType: saveSignature
                      dataObject: BLOB
                      dataKey: Cov19TestFormEditPage3.newSign.document.name.data
                      isEmpty: Cov19TestFormEditPage3.whetherSignature
                    - actionType: evalObject
                      object:
                        - =..newSign.docAPI.store: ""
                        # 存放签名的id
                        - if:
                            # - =..newSign.docRes.doc.id
                            - =..whetherSignature
                            # 保存签名判断状态
                            - .Global.formData.cov19TestForm.name.data.signatureIsolation.whetherIsolationSignature@: =..whetherSignature
                            - actionType: evalObject
                              object:
                                - .Global.formData.cov19TestForm.name.data.signatureIsolation.recipientName@: =..recipientName
                                - .Global.formData.cov19TestForm.name.data.signatureIsolation.id@: =..newSign.docRes.doc.id
                                - .Global.formData.cov19TestForm.name.data.signatureIsolation.signatureTime@: =..newSign.docRes.doc.ctime
                                # 保存签名判断状态
                                - .Global.formData.cov19TestForm.name.data.signatureIsolation.whetherIsolationSignature@: =..whetherSignature
                        - if:
                            - =..temporarySignature
                            - actionType: evalObject
                              object:
                                - .Global.formData.cov19TestForm.name.data.signatureIsolation.id@: =..temporarySignature
                                - .Global.formData.cov19TestForm.name.data.signatureIsolation.signatureTime@: =..signatureTime
                                # 保存签名判断状态
                                - .Global.formData.cov19TestForm.name.data.signatureIsolation.whetherIsolationSignature@: false
                            - continue
                        - if:
                            - =.Global.formData.cov19TestForm.name.data.signatureIsolation.whetherIsolationSignature
                            - actionType: popUp
                              popUpView: warningView
                              wait: true
                            - continue
                        - ..cov19TestForm.docReq@: =.Global.formData.cov19TestForm
                        - =..cov19TestForm.docAPI.store: ""
                        - =.builtIn.array.add:
                            dataIn: 
                              object: =.Global.vaccine
                              value: "COVID-19 Testing Consent Form"
                        - =.builtIn.array.elementUnique: 
                            dataIn: 
                              arr: =.Global.vaccine
                            dataOut: Cov19TestFormEditPage3.formData.doc
                        - .Global.vaccine@: =..formData.doc 
                    - actionType: evalObject
                      object:
                        - .Global.ProfilePop@: "block"
                        - .Global.editProfile@: true
                    - goto: .Global.FormGoUrl
        - .NewBaseWarningView:
          message: "You haven’t signed the form" 