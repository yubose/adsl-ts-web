ProviderScheduleSettingsDisplay: #xd page number: 65
  pageNumber: "380"
  init:
  #   - .SignInCheck
    - =.builtIn.date.generateYear:
        dataIn:
          last: 80
          next: 10
        dataOut: BaseDate.year
    - actionType: evalObject 
      object: 
        .BaseDate.getDate
    - actionType: evalObject
      object: 
        .BaseDate.getShow
    - actionType: evalObject
      object:
        .BaseDate.calendarDate.year@:
          =.builtIn.date.getYear: ""
    - actionType: evalObject
      object:
        .BaseDate.calendarDate.month@:
          =.builtIn.date.getMonth: ""
    - actionType: evalObject
      object:
        .BaseDate.calendarDate.day@:
          =.builtIn.date.getDate: ""
    - =.builtIn.date.calendarArray:
          dataIn:
            year: =.BaseDate.calendarDate.year
            month: =.BaseDate.calendarDate.month
            today: =.BaseDate.calendarDate.day
          dataOut: BaseDate.calendarDate.dayLable
    - =.builtIn.date.transformMonth:
        dataIn:
          month: =.BaseDate.calendarDate.month
        dataOut: BaseDate.calendarDate.monthName
    - =.builtIn.date.ShowDateByNumber:
          dataIn:
            year: =.BaseDate.calendarDate.year
            month: =.BaseDate.calendarDate.month
            day: =.BaseDate.calendarDate.day
            formatType: "Y-M-D"
          dataOut: BaseDate.calendarDate.todayDate
    - actionType: evalObject
      object:
        - =.builtIn.date.LoopToGenerate:
            dataIn:
              span: =..newAppointment.edge.name.setting.bookingTimeSpan
            dataOut: ProviderScheduleSettingsDisplay.scheduleSettingsTemp.TimeSpan
    - actionType: evalObject
      object:
        .ProviderScheduleSettingsDisplay.newAppointment.edge.name.setting.timezoneOffsetInMinute@:
          =.builtIn.date.getTimezoneOffset: ""

    - actionType: evalObject
      object:
        - if:
          - =.Global.currentSchedule.id
          - ..newAppointment.edge@: =.Global.currentSchedule
          - ..newAppointment.edge@: =..newBackup
        - if:
          - =.Global.currentSchedule.id
          - =.builtIn.array.transformNull:
              dataIn:
                dayObject: =..newAppointment.edge.name.setting.day
          - continue
        - ..newAppointment.edge.id@: ""
        - if:
          - =.Global.currentSchedule.id
          - =.builtIn.date.transformSelectWeek:
              dataIn:
                object: =.Global.currentSchedule.name.setting.day
              dataOut: ProviderScheduleSettingsDisplay.formData.res
          - continue
        - if:
          - =.ProviderScheduleSettingsDisplay.formData.res.addWeek.0
          - ..addWeek@: =.ProviderScheduleSettingsDisplay.formData.res.addWeek
          - continue
        - if:
          - =.ProviderScheduleSettingsDisplay.formData.res.selectWeek.0
          - ..scheduleSettingsTemp.weekDaySelect@: =.ProviderScheduleSettingsDisplay.formData.res.selectWeek
          - continue
    - ..newAppointment.edge.name.visitType@: =.Global.formData.scheduleType
    - ..newAppointment.edge.name.setting.Address@: =.Global.formData.scheduleAddress
    - if:  # 判断是什么类型，并根据类型决定预约的edge的bvid
      - =.builtIn.string.equal:
          dataIn:
            string1: =..newAppointment.edge.name.visitType
            string2: "Telemedicine"
      - ..newAppointment.edge.bvid@: =.Global.currentFacility.id 
      - ..newAppointment.edge.bvid@: =.Global.formData.scheduleLocationId

      
    - ..newAppointment.edge.name.setting.startDate@: =.BaseDate.calendarDate.todayDate
    - if:  # 判断是什么类型，并根据类型决定是否可编辑地址
      - =.builtIn.string.equal:
          dataIn:
            string1: =..newAppointment.edge.name.visitType
            string2: "Telemedicine"
      - continue
      - =.builtIn.checkField:
          dataIn:
            contentType: messageHidden
            wait: 100 


  viewPort: top
  # WeekData: 
  newAppointment:
    response:
    edge:
      .Edge: ""
      id: ""
      subtype: .Global.setSchedule.scheduleTypeNumber #   0x10003 3<<16 + 1  3*65536 +1  0x30000|1 196609   online ,  +2 in office  0x20000|1    2<<16 + 1  131073,  0x10000|1 1<<16+1 65537
      type: 40000
      # bvid: .Global.currentFacility.id 
      bvid: ""  
      # evid: .Global.acceptInfo.bsig
      evid: .Global.currentUser.vertex.id
      name:
        roomName: ""
        visitType: ""
        setting:
          day:
            -
            -
            -
            -
            -
            -
            -
          forwardRepeatWeeks: '10'
          blockDays: []
          governmentHolidays: ''
          businessHolidays: ''
          # advanceBookingLimit: '1'
          bookingTimeSpan: '30'
          timeSlotBackColor: "#ffffff"
          timeSlotColor: "#333333"
          timezoneOffsetInMinute: "" 
          startDate: ""
          endDate: ""  
          Address: ""
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: newAppointment.edge
        dataOut: newAppointment.response
  AvailableTime: 
    timeStart: ""
    timeEnd: ""
    timeResult: ""
  addWeek: []
  formData:
    start: ""
    end: ""
    flag: ""
  scheduleSettingsTemp:
    weekdayTemp:
      - key: Su
        index: 0        
      - key: M
        index: 1
      - key: T
        index: 2
      - key: W
        index: 3
      - key: Th
        index: 4
      - key: F
        index: 5
      - key: Sa
        index: 6
    weekDaySelect:
      - key: M
        index: 1
      - key: T
        index: 2
      - key: W
        index: 3
    TimeSpan:  
      - 00:00
      - 12:00
  date:
    - day: Sunday
    - day: Monday
    - day: Tuesday
    - day: Wednesday
    - day: Thursday
    - day: Friday
    - day: Saturday
  
  components:
    - type: view
      style:
        width: "1"
        height: "1"
        margin: auto
      children:
        - type: view
          style:
            background-image: 'linear-gradient(#0063a8, #004371)'   
            height: "1"
            width: "0.16"
          children:
            - .aitLogo:
            - .Menu:

        - .TopBar:
        - .BodyView:
          style:
            backgroundColor: "#f4f8fa"
            width: "0.84"
            height: "0.92"
            left: '0.16'
            top: "0.0705"
          children:
            - .ContentView:
              style:
                height: "0.88"
                top: "0.05"
              children:
                - type: view
                  style:
                    width: "80vw"
                    height: "7.5vw"
                    top: "0"
                    left: "0"
                    border: 
                      style: "2"
                    borderWidth: "1"
                    borderColor: "#cfcfcf"
                  children:
                    - type: image
                      path=func: .builtIn.utils.prepareDocToPath
                      dataKey: Global.MyProfile.name.data.avatar
                      path: ava.png
                      style:
                        top: "4.5vw"
                        left: "4vw"
                        width: "6vw"
                        borderRadius: "70px"
                    - type: label
                      text: "Active"
                      style:
                        top: "6vw"
                        left: "12vw"
                        fontSize: "1vw"
                        fontFamily: "Arial"
                        color: "#30B354"
                    - type: label
                      dataKey: Global.acceptInfo.name.inviteeName
                      style:
                        display: "inline-block"
                        # top: "0.1"
                        # left: "0.16"
                        fontSize: "2.4vh"
                        fontFamily: "Arial"
                        color: "#646D82"   
                    - type: label
                      dataKey: Global.acceptInfo.name.inviteeCategory
                      style:
                        display: "inline-block"
                        # top: "0.14"
                        # left: "0.16"
                        fontSize: "1.7vh"
                        fontFamily: "Arial"
                        color: "#A6B1C2"   
                    - type: label
                      text: Availability Settings
                      style:
                        display: "inline-block"
                        width: "20vw"
                        marginTop: "6vw"
                        marginLeft: "30vw"
                        fontSize: .Nfont.h3
                        fontFamily: sans-serif
                        color: "#333333"  
                        textAlign:
                          x: center
                    - type: label
                      text: Cancel
                      onClick:
                        - actionType: builtIn
                          funcName: goBack
                          reload: true
                      style:
                        display: "inline-block"
                        float: right
                        width: "5vw"
                        marginTop: "6vw"
                        fontSize: .Nfont.h0
                        color: "#1492e6"                         
                - type: view
                  style:
                    width: "80vw"
                    height: "33vw"
                    top: "10vw"
                    left: "0"
                    border: 
                      style: "2"
                    borderColor: "#cfcfcf"
                  children:
                    - type: view
                      style:
                        margin: auto
                      children:
                        - type: view
                          style:
                            marginLeft: "4vw"
                            marginTop: "3vw"
                            width: "63vw"
                            height: "5vw"
                          children:
                            - type: view
                              style:
                                left: "0"
                                display: "inline-block"
                                width: "24vw"
                                height: "5vw"
                              children: 
                                - type: label
                                  text: "Appointment Type"
                                  style:
                                    left: "0"
                                    width: "18vw"
                                    height: "2vw"
                                    fontSize: .Nfont.h1
                                - type: label
                                  dataKey: newAppointment.edge.name.visitType
                                  onChange:
                                    - actionType: evalObject
                                      object:
                                        
                                        - if: 
                                          - =.builtIn.string.equal:
                                              dataIn:
                                                string1: =..newAppointment.edge.name.visitType
                                                string2: Telemedicine
                                          - ..newAppointment.edge.subtype@: 196611
                                          - continue
                                        - if: 
                                          - =.builtIn.string.equal:
                                              dataIn:
                                                string1: =..newAppointment.edge.name.visitType
                                                string2: Office Visit
                                          - ..newAppointment.edge.subtype@: 131075
                                          - continue
                                        - if: 
                                          - =.builtIn.string.equal:
                                              dataIn:
                                                string1: =..newAppointment.edge.name.visitType
                                                string2: Covid19Test
                                          - ..newAppointment.edge.subtype@: 655363
                                          - continue
                                  style:
                                    top: "2vw"
                                    left: "0"
                                    width: "20vw"
                                    height: "2vw"
                                    border: 
                                      style: "3"
                                    borderWidth: "1"
                                    fontSize: .Nfont.h1
                                    borderColor: "#DEDEDE"
                                    boxSizing: border-box
                                    textIndent: 1em
                                    textAlign: 
                                      y: center
                            - type: view
                              contentType: messageHidden
                              style:
                                display: "inline-block"
                                width: "26.5vw"
                                height: "5.2vw"
                                isHidden: "true"
                              children: 
                                - type: label
                                  text: "Address location"
                                  style:
                                    left: "0"
                                    width: "26.5vw"
                                    height: "2vw"
                                    fontSize: .Nfont.h1
                                - type: label
                                  dataKey: Global.locationAll.0.medicalFacilityName
                                  style:
                                    top: "2vw"
                                    left: "0"
                                    width: "19vw"
                                    fontSize: .Nfont.h1
                                    height: "2vw"
                                    textIndent: 1em
                                    borderColor: "#DEDEDE"
                                    border: 
                                      style: "3"
                                    textAlign: 
                                      y: center
                        - type: label
                          text: "Select the available days that patient can be scheduled"
                          style:
                            marginLeft: "4vw"
                            marginTop: "0.02"
                            fontSize: .Nfont.h1
                    - .ViewRow:
                      style:
                        marginLeft: 4vw
                        justifyContent: space-between
                        width: 76vw
                        marginTop: 1vw
                      children:
                        - type: view
                          viewTag: AvailableTimeTag
                          style:
                            width: "26.5vw"
                            height: "24vw"
                            border:
                              style: "3"
                            borderColor: "#DEDEDE"
                          children:
                            - type: view
                              style:
                                top: "0"
                                left: "0"
                                width: "26.5vw"
                                height: "3vw"
                                backgroundColor: "#004779"
                              children:
                                - type: label
                                  text: Availability Setting
                                  style:
                                    top: "0"
                                    left: "1.8vw"
                                    height: "3vw"
                                    textAlign: 
                                      y: center
                                    fontFamily: "Arial" 
                                    fontSize: .Nfont.h1
                                    color: "0xFFFFFF"
                            - .BaseList:
                              listObject: ..scheduleSettingsTemp.weekdayTemp
                              style:
                                top: "3vw"
                                width: "26.5vw"
                                margin: "0"
                              children:
                                - .BaseListItem:
                                  style:
                                    width: "26.5vw"
                                    height: "2.95vw"
                                    border: 
                                      style: "2"
                                    borderWidth: "1"
                                    borderColor: "#DEDEDE"
                                  children:
                                    - type: label
                                      dataKey: itemObject.key
                                      style:
                                        top: "0.8vw"
                                        left: "2.1vw"
                                        fontFamily: "Arial" 
                                        fontSize: .Nfont.h0
                                    - type: select
                                      dataKey: AvailableTime.timeStart
                                      options:
                                        ..scheduleSettingsTemp.TimeSpan
                                      style: 
                                        top: "0.5vw"
                                        width: "5.5vw"
                                        height: "2vw"
                                        fontSize: .Nfont.h0
                                        left: "6.2vw"
                                        boxSizing: border-box
                                        borderColor: "#DEDEDE" 
                                    - type: select
                                      dataKey: AvailableTime.timeEnd
                                      options:
                                        ..scheduleSettingsTemp.TimeSpan
                                      style: 
                                        top: "0.5vw"
                                        width: "5.5vw"
                                        height: "2vw"
                                        left: "14vw"
                                        fontSize: .Nfont.h0
                                        boxSizing: border-box
                                        borderColor: "#DEDEDE"   
                                    - type: label
                                      text: +
                                      onClick:
                                        - actionType: evalObject
                                          object: 
                                            - .ProviderScheduleSettingsDisplay.WeekData@: ""
                                        - emit:
                                            dataKey:
                                              var: itemObject
                                            actions:
                                              - ..formData.start@: $var.AvailableTime.timeStart
                                              - ..formData.end@: $var.AvailableTime.timeEnd
                                              - if: 
                                                - =.builtIn.date.compareDate: 
                                                    dataIn:   
                                                      comTime: $var
                                                      pareTime: =..addWeek
                                                      timeStart: "AvailableTime.timeStart"
                                                      timeEnd: "AvailableTime.timeEnd"
                                                - ..formData.judgeTimeOverlap@: true
                                                - ..formData.judgeTimeOverlap@: false 
                                        - actionType: evalObject
                                          object: 
                                            - =.builtIn.date.DateCompare:
                                                dataIn:
                                                  startTime: =..formData.start
                                                  endTime: =..formData.end
                                                dataOut: ProviderScheduleSettingsDisplay.formData.flag
                                        - actionType: evalObject
                                          object:
                                            - if: 
                                              - =.builtIn.date.DateCompare: 
                                                  dataIn: 
                                                    startTime: =..formData.start
                                                    endTime: =..formData.end
                                              - continue
                                              - actionType: popUp
                                                popUpView: timeErrorView
                                                wait: true
                                            - if:
                                              - =..formData.judgeTimeOverlap
                                              - continue
                                              - actionType: popUp
                                                popUpView: timeOverlapView
                                                wait: true   
                                            - ..formData.start@: ""
                                            - ..formData.end@: ""
                                            - ..formData.judgeTimeOverlap@: true
                                        - emit:
                                            dataKey:
                                              var: itemObject
                                            actions:
                                              - if:
                                                - ..formData.flag
                                                - =.builtIn.string.concat:
                                                    dataIn:
                                                      - $var.AvailableTime.timeStart 
                                                      - "-"
                                                      - $var.AvailableTime.timeEnd
                                                    dataOut: ProviderScheduleSettingsDisplay.AvailableTime.timeResult
                                                - continue
                                              - if:
                                                - ..formData.flag
                                                - =.builtIn.array.addByIndex:
                                                    dataIn:
                                                      object: =..newAppointment.edge.name.setting.day
                                                      value: =..AvailableTime.timeResult
                                                      index: $var.index
                                                - continue
                                              - if:
                                                - ..formData.flag
                                                - =.builtIn.array.AddWeek:
                                                    dataIn:
                                                      object: =..addWeek
                                                      duration: =.ProviderScheduleSettingsDisplay.AvailableTime.timeResult
                                                      Address: ""
                                                      index: $var.index
                                                      key: $var.key
                                                - continue
                                              # - ..formData.start@: ""
                                              # - ..formData.end@: ""
                                        - actionType: evalObject
                                          object: 
                                            - if:
                                              - ..formData.flag
                                              - actionType: evalObject
                                                object: 
                                                  - =.builtIn.date.TransformWeekDate:
                                                      dataIn:
                                                        object: =..addWeek
                                                      dataOut: ProviderScheduleSettingsDisplay.WeekData
                                                  - =.builtIn.array.SortBy:
                                                      dataIn:
                                                        object: =..addWeek 
                                                        iterate: "index"
                                                        orders: "asc"
                                                      dataOut: ProviderScheduleSettingsDisplay.addWeek
                                              - continue
                                        - actionType: evalObject
                                          object:
                                            - actionType: builtIn
                                              funcName: redraw
                                              viewTag: timeSlot
                                      style: 
                                        top: "0"
                                        left: "22.7vw"
                                        height: "2.5vw"
                                        fontSize: "1.5vw"
                                        color: "0x004779"
                                        textAlign: 
                                          y: center
                        
                        - type: view
                          style:
                            width: "26.5vw"
                            height: "auto"
                          children:
                            - type: view
                              style:
                                top: "0"
                                left: "0"
                                width: "26.5vw"
                                height: "3vw"
                                backgroundColor: "#004779"
                              children:
                                - type: label
                                  text: Availability
                                  style:
                                    top: "0"
                                    left: "1.5vw"
                                    fontFamily: "Arial" 
                                    fontSize: .Nfont.h1
                                    height: "3vw"
                                    color: "0xFFFFFF"
                                    textAlign: 
                                      y: center
                            - type: scrollView
                              style:
                                top: "3vw"
                                width: "26.5vw"
                                height: "21.2vw"
                                left: "0"
                                overflow: scroll
                              children: 
                                - type: list
                                  contentType: listObject
                                  listObject: ..addWeek
                                  iteratorVar: itemObject
                                  viewTag: timeSlot
                                  style:
                                    top: "0"
                                    width: "26.5vw"
                                    height: "auto"
                                    left: "0"
                                    margin: "0"
                                    border:
                                      style: "3"
                                    borderColor: "#DEDEDE"
                                    boxSizing: border-box
                                  children:
                                    - type: listItem
                                      itemObject: ""
                                      style:
                                        height: "2.95vw"
                                        width: "26.5vw"
                                        left: "0"
                                        border: 
                                          style: "2"
                                        borderWidth: "1"
                                        borderColor: "#DEDEDE"
                                      children:
                                        - type: label
                                          dataKey: itemObject.key
                                          style:
                                            width: "0"
                                            left: "2.6vw"
                                            fontSize: .Nfont.h0
                                            top: "0"
                                            height: "3vw"
                                            textAlign: 
                                              y: center
                                              
                                        - type: label
                                          dataKey: itemObject.duration
                                          style:
                                            width: "10vw"
                                            left: "10vw"
                                            fontSize: .Nfont.h0
                                            top: "0"
                                            height: "3vw"
                                            textAlign: 
                                              y: center
                                        - type: image
                                          onClick:
                                            - emit:
                                                dataKey:
                                                  var: itemObject
                                                actions:
                                                  - =.builtIn.array.removeWeekByIndexs:
                                                      dataIn:
                                                        object1: =..addWeek
                                                        object2: =..newAppointment.edge.name.setting.day
                                                        index: $var.index
                                                        duration: $var.duration
                                            - actionType: builtIn
                                              funcName: redraw
                                              viewTag: timeSlot
                                          path: delete.png
                                          style:
                                            left: "23vw"
                                            top: "0.8vw"
                                            height: "1.4vw"
                        - type: view
                          style:
                            width: "18vw"
                            height: "14vw"
                          children:
                            - type: view
                              style:
                                top: "0"
                                left: "0"
                                width: "17vw"
                                height: "14vw"
                              viewTag: selectStartAndEndTag
                              children:
                                - type: label
                                  text: Start Date
                                  style:
                                    top: "0"
                                    left: "4.5vw"
                                    width: "7vw"
                                    fontSize: .Nfont.h1
                                    color: "#333333" 
                                - type: textField
                                  placeholder: YYYY-MM-DD
                                  dataKey: newAppointment.edge.name.setting.startDate
                                  onClick:
                                    - actionType: popUp
                                      popUpView: startDateTag
                                  style:
                                    top: "1.5vw"
                                    left: "4.5vw"
                                    width: "9vw"
                                    height: "2vw"
                                    fontSize: .Nfont.h0    
                                    border: 
                                      style: "3"
                                    borderWidth: "1"
                                    borderRadius: "2"
                                    borderColor: "#dedede"
                                - type: label
                                  text: Repeat weeks
                                  style:
                                    top: "4.5vw"
                                    left: "4.5vw"
                                    width: "8vw"
                                    fontSize: .Nfont.h1  
                                - type: textField
                                  dataKey: newAppointment.edge.name.setting.forwardRepeatWeeks
                                  style:
                                    top: "6vw"
                                    left: "4.5vw"
                                    width: "9vw"
                                    height: "2vw"
                                    fontSize: .Nfont.h0    
                                    border: 
                                      style: "3"
                                    borderWidth: "1"
                                    borderRadius: "2"
                                    borderColor: "#dedede"
                                - .AddButton:
                                  text: Update Availability
                                  onClick:
                                    - actionType: evalObject
                                      object: 
                                        - if:  # 判断是什么类型，并根据类型决定预约的edge的bvid
                                          - =.builtIn.string.equal:
                                              dataIn:
                                                string1: =..newAppointment.edge.name.visitType
                                                string2: "Telemedicine"
                                          - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
                                          - .Global.jwt.edge.bvid@: =.Global.formData.scheduleLocationId
                                        - =.Global.jwt.edgeAPI.store: ""
                                        - =.ProviderScheduleSettingsDisplay.newAppointment.edgeAPI.store: ""
                                        - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
                                        - =.Global.jwt.edgeAPI.store: ""
                                        - =.builtIn.search.updateEsData:
                                            dataIn:
                                              id: =..newAppointment.edge.evid
                                              type: '40000'
                                              bvid: =..newAppointment.edge.bvid
                                            dataOut: ProviderScheduleSettingsDisplay.res
                                    - actionType: popUp
                                      popUpView: setting
                                    # - goto: SchduleSetting
                                    - actionType: builtIn
                                      funcName: goBack
                                      reload: true
                                  style:
                                    top: "9.5vw"
                                    left: "4.5vw"
                                    width: "0.1"
                                    height: "0.042"
                                    fontSize: .Nfont.h0_1
                                    backgroundColor: '#005795'
                                    color: '#FFFFFF'
                                    border: 
                                      style: "3"
                                    borderWidth: "1"
                                    borderColor: "#004779"
                                    borderRadius: "5"
                                    textAlign:
                                      x: center
                                      y: center
            
        
        - .BaseWarningViewOne: 
          msg2: "Please select or change appropriate start & end time"
          viewTag: timeErrorView
          style:
            width: "1"
            height: "1"
        - .BaseWarningViewOne: 
          msg2: "The start time is after end time"
          viewTag: compareTimeView
          style:
            width: "1"
            height: "1"
        - .BaseSuccessfulView:
          viewTag: setting
          msg: "Successfully!"
          style:
            width: "1"
            height: "1"
            position: fixed
            zIndex: 100
            margin: auto
            left: none
            marginLeft: 5vw    
        - .BaseWarningViewOne:
          viewTag: timeOverlapView
          msg2: The selected time overlaps,please select again
          style:
            width: "1"
            height: "1"
        - type: popUp
          viewTag: startDateTag
          style:
            top: "0"
            backgroundColor: "0x1e1e1e20"
            height: "1"
            width: "1"
            zIndex: "10000"
            left: "0.056"
            position: fixed
          children:
            - .BaseDate.calendar:
              children:
                - .BaseDate.calendarHeader:
                - .BaseDate.weekView:
                - .BaseDate.dayView:
                - .BaseDate.addButton:
                  onClick:
                    - actionType: evalObject
                      object:
                        - ..newAppointment.edge.name.setting.startDate@: =.BaseDate.calendarDate.todayDate
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: selectStartAndEndTag
                    - actionType: popUpDismiss
                      popUpView: startDateTag
