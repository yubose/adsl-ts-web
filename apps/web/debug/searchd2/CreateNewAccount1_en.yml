CreateNewAccount1: # This is page name
  module: provider
  title: Create New Account
  pageNumber: "45"
  init:
    - if:
        - ..formData.vertex.name.phoneNumber
        - continue
        - goto: SignUp
  formData:
    response: ""
    vertex : # inherit from BaseDataModel_en.yml
      .Vertex: ""
      type : 1
      name:
        countryCode: .Global.providerSign.countryCode
        phoneNumber: .Global.providerSign.phoneNumber
        userName: ""
        firstName: ""
        lastName: ""
        password: ""
        email: ""
        confirmPassword: ""
        avatar : "https://public.aitmed.com/avatar/JohnDoe.jpg"
        verificationCode: .Global.providerSign.key
        signature: ""
    vertexAPI:
      .VertexAPI: ""
      store:
        api: builtIn.createNewAccount # construct uid, pk, esk .. for new account
        dataIn: formData.vertex
        dataOut: formData.response
    target: false
    tar: false
    confirm: ""
  # init: 
    # - if:
    #   - =.ServicesAgreement.agreement.servicesAgreement
    #   - ..selectData.tar@: "selectOn.png"
    #   - ..selectData.tar@: "selectOff.png"
  rvCondition: ""
  checkOk: ""
  getVertex:
    response: ""
    vertex:
      xfname: none
      type: 1
      sCondition: =..rvCondition
      _nonce: =.Global._nonce
    vertexAPI:
      get:
        api: rv
        dataIn: CreateNewAccount1.getVertex.vertex
        dataOut: CreateNewAccount1.getVertex.response
  save: 
    - ..formData.vertexAPI.store #
    # - .Global.rootNotebook.edgeAPI.store
  update: 
    - .Global.currentUser.vertex@ : =..formData.response.vertex # set {".Global.currentUser.vertex":".builtIn.UserVertex"}
    - .Global.currentUser.vertex.name.email@ : =..formData.vertex.name.email
    # - .Global.currentUser.vertex.name.lastName@ : =..formData.vertex.name.lastName 
    # - .Global.currentUser.vertex.name.userName@ : =..formData.vertex.name.userName      
    - .Global.currentUser.JWT@ : =..formData.response.jwt
    - .Global.rootNotebookID@: =.Global.currentUser.vertex.deat.rnb64ID
    - .Global.currentUser.dataCache.loadingDateTime@ : =.Global.currentDateTime   
    - .Global.formData.profile@: =..formData.response.vertex.name
  components:
    - type: view
      style:
        width: "1"
        margin: auto
        height: "1"
      children:
        - .BaseWarningViewOne: ""
          style: 
            margin: auto
            height: "1"
            width: "1"
          msg2: "Incorrect verificationCode"
          viewTag: wrongCode
        - .BaseWarningViewOne: ""
          style: 
            margin: auto
            height: "1"
            width: "1"
            zIndex: 10000
          msg2: "Password should be same"
          viewTag: samePassword
        - .BaseWarningViewOne: ""
          style: 
            margin: auto
            height: "1"
            width: "1"
          msg2: "Please fill out required fields"
          viewTag: inputPassword
        - .BaseWarningViewOne: ""
          style: 
            margin: auto
            height: "1"
            width: "1"
          msg2: "Please check the box"
          viewTag: noSelected
        - .BaseWarningViewOne: ""
          style: 
            margin: auto
            height: "1"
            width: "1"
            zIndex: 10000
          msg2: "Username has been used"
          viewTag: sameuserid
        - .BaseWarningViewOne: ""
          style: 
            margin: auto
            height: "1"
            width: "1"
            zIndex: 10000
          msg2: "Invalid Username: Required length should be 6 to 16"
          viewTag: invaliduserid
        - type: view
          style:
            width: "0.56"
            height: "1"
          children:
            - type: view
              style:
                width: "0.56"
                height: "1"
                top: "0"
                # backgroundColor: red
              children:
                - type: image
                  path: bg.png
                  style:
                    top: 0
                    width: "0.555"
                    height: "1"
                - type: image
                  path: bgColor.svg
                  style:
                    top: 0
                    width: "0.555"
                    height: "1"
                - type: image
                  path: white.svg
                  style:
                    width: "0.013"
                    hieght: "0.013"
                    left: "0.05"
                    top: "0.04"
                    zIndex: 1000
                  onClick:
                    - actionType: builtIn
                      funcName: goBack
                - type: label
                  text: "Back"
                  style:
                    width: "0.1"
                    height: "0.05"
                    left: "0.068"
                    top: "0.036"
                    color: "#ffffff"
                    fontSize: .Nfont.h3
                    fontWeight: 500
                  onClick:
                    - actionType: builtIn
                      funcName: goBack
                # - type: image
                #   path: Logo.png
                #   style:
                #     width: "0.16"
                #     left: "0.25"
                #     top: '0.23'
                #     zIndex: 1000
                - type: label
                  textBoard: 
                    - text: Welcome To 
                    - br: 
                    - text: Aitmed
                      fontWeight: 700
                  style: 
                    left: "0.06"
                    width: "0.46"
                    top: "0.35"
                    color: "0xffffff"
                    textAlign: 
                      x: center
                    fontSize: "6.6vh"
                    lineHeight: "1.5"
                    letterSpacing: "2.5px"
                - type: label
                  text: "WWW.AITMED.COM"
                  style: 
                    left: "0.05"
                    width: "0.46"
                    top: "0.9"
                    color: "0xffffff"
                    textAlign: 
                      x: center
                    fontSize: "2.5vh"
                    lineHeight: "1.5"
                    letterSpacing: "2.5px"
        - type: view
          style:
            left: "0.58"
            top: "0"
            width: "0.41"
            height: "1"
          children:
            - type: view
              style:
                width: "0.3"
                height: "0.9"
                marginTop: "0.05"
                marginLeft: "0.055"
                backgroundColor: "#ffffff"
                borderRadius: "7px"
                border: 
                  style: "3"
                borderColor: "#EEF6FD"
                boxShadow: "0px 0px  8px 5px #EEF6FD"
              children:
                - type: view
                  style:
                    width: "0.26"
                    height: auto
                    marginTop: 2vw
                    marginLeft: 3.8vw
                  children:
                    - type: view
                      style:
                        width: "0.05"
                        height: "0.08"
                      children:
                        - type: label
                          textBoard: 
                            - text: Country
                              fontWeight: 600
                            - text: "*"
                              color: "0xFB5051"
                          style:
                            color: "0x333333"
                            left: "0"
                            top: "0"
                            width: "0.05"
                            fontSize: .Nfont.h0
                            fontWeight: 600
                            textAlign: 
                              x: left
                              y: center
                        - type: select
                          contentType: countryCode
                          placeholder: ..formData.vertex.name.countryCode
                          dataKey: formData.vertex.name.countryCode # formData.countryCode : inputValue
                          options:
                            .CountryCode
                          required: "true"
                          style:
                            left: "0"
                            top: "0.031"
                            width: "0.05"
                            height: "0.041"
                            fontSize: .Nfont.h0
                            placeholder: "US +1"
                            borderWidth: "2"
                            border:
                              style: "3"
                              color: "0xDEDEDE"  
                            borderRadius: "7px"      
                    - type: view
                      style:
                        top: "0"
                        marginLeft: "0.06"
                        width: "0.18"
                        height: "0.08"
                      children:
                        - type: label
                          textBoard: 
                            - text: Phone
                              fontWeight: 600
                            - text: "*"
                              color: "0xFB5051"
                          style:
                            color: "0x333333"
                            left: "0"
                            top: "0"
                            width: "0.1"
                            height: "0.03"
                            fontSize: .Nfont.h0
                            fontWeight: 600
                            textAlign: 
                              x: left
                              y: center
                        - type: textField
                          # contentType: phoneNumber
                          # placeholder: ..formData.vertex.name.phoneNumber
                          dataKey: formData.vertex.name.phoneNumber # formData.countryCode : inputValue
                          # required: "true"
                          style:
                            textIndent: 0.5em
                            fontSize: .Nfont.h0
                            left: "0"
                            top: "0.031"
                            width: "0.16"
                            height: "0.041"
                            borderWidth: "2"
                            border:
                              style: "3"
                              color: "0xDEDEDE"  
                            borderRadius: "7px"     
                            textAlign: 
                              x: left
                              y: center
                    - type: view
                      style:
                        height: "0.08"
                      children:
                        - type: label
                          textBoard: 
                            - text: First Name
                              fontWeight: 600
                            - text: "*"
                              color: "0xFB5051"
                          style:
                            color: "0x333333"
                            left: "0"
                            top: "0"
                            width: "0.2"
                            height: "0.03"
                            fontSize: .Nfont.h0
                            fontWeight: 600
                            textAlign: 
                              x: left
                              y: center
                        - type: textField
                          contentType: text
                          placeholder: " Enter here"
                          dataKey: formData.vertex.name.firstName # formData.countryCode : inputValue
                          required: "true"
                          style:
                            fontSize: .Nfont.h0
                            textIndent: 0.5em
                            left: "0"
                            backgroundColor: "0xffffff"
                            top: "0.031"
                            width: "0.22"
                            height: "0.041"
                            borderWidth: "2"
                            border:
                              style: "3"
                              color: "0xDEDEDE"  
                            borderRadius: "7px"  
                            textAlign: 
                              x: left
                              y: center
                    - type: view
                      style:
                        height: "0.08"
                        width: "0.1"
                      children:
                        - type: label
                          textBoard: 
                            - text: Last Name
                              fontWeight: 600
                            - text: "*"
                              color: "0xFB5051"
                          style:
                            color: "0x333333"
                            left: "0"
                            top: "0"
                            width: "0.1"
                            height: "0.03"
                            fontSize: .Nfont.h0
                            fontWeight: 600
                            textAlign: 
                              x: left
                              y: center
                        - type: textField
                          contentType: text
                          placeholder: " Enter here"
                          dataKey: formData.vertex.name.lastName # formData.countryCode : inputValue
                          required: "true"
                          style:
                            fontSize: .Nfont.h0
                            textIndent: 0.5em
                            left: "0"
                            backgroundColor: "0xffffff"
                            top: "0.031"
                            width: "0.22"
                            height: "0.041"
                            borderWidth: "2"
                            border:
                              style: "3"
                              color: "0xDEDEDE"  
                            borderRadius: "7px"  
                            textAlign: 
                              x: left
                              y: center                    
                    - type: view
                      style:
                        height: "0.08"
                      children:
                        - type: label
                          textBoard: 
                            - text: Username
                              fontWeight: 600
                            - text: "*"
                              color: "0xFB5051"
                          style:
                            color: "0x333333"
                            left: "0"
                            top: "0"
                            width: "0.2"
                            height: "0.03"
                            fontSize: .Nfont.h0
                            textAlign: 
                              x: left
                              y: center
                        - type: textField
                          contentType: text
                          placeholder: "Create your own"
                          dataKey: formData.vertex.name.userName # formData.countryCode : inputValue
                          required: "true"
                          style:
                            fontSize: .Nfont.h0
                            textIndent: 0.5em
                            left: "0"
                            backgroundColor: "0xffffff"
                            top: "0.031"
                            width: "0.22"
                            height: "0.041"
                            borderWidth: "2"
                            border:
                              style: "3"
                              color: "0xDEDEDE"  
                            borderRadius: "7px"  
                            textAlign: 
                              x: left
                              y: center
                    - type: view
                      style:
                        height: "0.08"
                      children:
                        - type: label
                          textBoard: 
                            - text: Email
                              fontWeight: 600
                            - text: "*"
                              color: "0xFB5051"
                          style:
                            color: "0x333333"
                            left: "0"
                            top: "0"
                            width: "0.14"
                            height: "0.03"
                            fontSize: .Nfont.h0
                            fontWeight: 600
                            textAlign: 
                              x: left
                              y: center
                        - type: textField
                          contentType: text
                          placeholder: " Enter here"
                          dataKey: formData.vertex.name.email # formData.countryCode : inputValue
                          required: "true"
                          style:
                            fontSize: .Nfont.h0
                            textIndent: 0.5em
                            left: "0"
                            backgroundColor: "0xffffff"
                            top: "0.031"
                            width: "0.22"
                            height: "0.041"
                            borderWidth: "2"
                            border:
                              style: "3"
                              color: "0xDEDEDE"  
                            borderRadius: "7px"  
                            textAlign: 
                              x: left
                              y: center   
                    - type: view
                      style:
                        height: "0.08"
                      children:
                        - type: label
                          textBoard: 
                            - text: New Password
                              fontWeight: 600
                            - text: "*"
                              color: "0xFB5051"
                          style:
                            color: "0x333333"
                            left: "0"
                            top: "0"
                            width: "0.2"
                            height: "0.03"
                            fontSize: .Nfont.h0
                            fontWeight: 600
                            textAlign: 
                              x: left
                              y: center 
                        - type: view
                          style: 
                            left: "0"
                            backgroundColor: "0xffffff"
                            top: "0.031"
                            width: "0.22"
                            height: "0.041"
                            borderWidth: "2"
                            border:
                              style: "3"
                              color: "0xDEDEDE"  
                            borderRadius: "7px"  
                          children: 
                            - type: textField
                              contentType: password
                              placeholder: " Enter here"
                              dataKey: formData.vertex.name.password # formData.countryCode : inputValue
                              required: "true"
                              style:
                                fontSize: .Nfont.h0
                                textIndent: 0.5em
                                backgroundColor: "0xffffff"
                                top: "0.002"
                                width: "0.22"
                                height: "0.038"
                                border:
                                  style: "1"
                                textAlign: 
                                  x: left
                                  y: center
                    - type: view
                      style:
                        height: "0.08"
                      children:
                        - type: label
                          textBoard:
                            - text: Confirm Password
                              fontWeight: 600
                            - text: "*"
                              color: "0xFB5051"
                          style:
                            color: "0x333333"
                            left: "0"
                            top: "0"
                            width: "0.14"
                            height: "0.03"
                            fontSize: .Nfont.h0
                            textAlign: 
                              x: left
                              y: center
                        - type: view
                          style: 
                            left: "0"
                            backgroundColor: "0xffffff"
                            top: "0.031"
                            width: "0.22"
                            height: "0.041"
                            borderWidth: "2"
                            border:
                              style: "3"
                              color: "0xDEDEDE"  
                            borderRadius: "7px"
                          children: 
                            - type: textField
                              contentType: password
                              placeholder: " Enter here"
                              dataKey: formData.vertex.name.confirmPassword # formData.countryCode : inputValue
                              required: "true"
                              style:
                                fontSize: .Nfont.h0
                                textIndent: 0.5em
                                left: "0.002"
                                backgroundColor: "0xffffff"
                                top: "0.002"
                                width: "0.22"
                                height: "0.038"
                                border:
                                  style: "1"
                                textAlign: 
                                  x: left
                                  y: center   
                - type: view 
                  style:
                    marginTop: "1vw"
                    marginLeft: 3.8vw
                    width: "0.25"
                  children:
                    - type: image
                      viewTag: select
                      onClick:
                        - emit:
                            actions:
                              - if:
                                - =.CreateNewAccount1.formData.target
                                - .CreateNewAccount1.formData.target@: false
                                - .CreateNewAccount1.formData.target@: true    
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: select
                      path: 
                        emit:
                          actions:
                            - if:
                                - =.CreateNewAccount1.formData.target
                                - selectOnblue.svg
                                - selectBlack.svg
                      # path: selectOff.png
                      # pathSelected: selectOn.png
                      style:
                        width: "0.01"
                        top: "0.0065"
                    - type: label
                      style:
                        color: "0x333333"
                        marginLeft: 1.5vw
                        top: "0.005"
                        fontSize: .Nfont.h0
                        height: "0.03"
                        textAlign: 
                          x: left
                      onClick:
                        - ..fromData.flag@: "1"
                        - goto: ProviderUserAgreement
                      textBoard:
                        - text: "I agree to "
                        - text: "&nbsp;"
                        - text: "Aitmed Terms of Use Agreement"
                          color: "#333333"
                          fontWeight: 700
                        - text: "&nbsp;"
                        - text: " and "
                    - type: label
                      style:
                        color: "0x333333"
                        marginLeft: 1.5vw
                        top: "0.03"
                        height: "0.03"
                        fontSize: .Nfont.h0
                        textAlign: 
                          x: left
                      onClick:
                        - ..fromData.flag@: "2"
                        - goto: ProviderSubscriptionAgreement
                      textBoard:
                        - text: "AiTmed Master Subscription Agreement"
                          color: "#333333"
                          fontWeight: 700
                    - type: image
                      viewTag: select
                      onClick:
                        - emit:
                            actions:
                              - if:
                                - =.CreateNewAccount1.formData.tar
                                - .CreateNewAccount1.formData.tar@: false
                                - .CreateNewAccount1.formData.tar@: true    
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: select
                      path:
                        emit:
                          actions:
                            - if:
                                - =.CreateNewAccount1.formData.tar
                                - selectOnblue.svg
                                - selectBlack.svg
                      style:
                        width: "0.01"
                        marginTop: 3.7vw
                    - type: label
                      onClick:
                        - ..fromData.flag@: "3"
                        - goto: ProviderPrivacyPolicy
                      textBoard: 
                        - text: "I also agree to"
                        - text: "&nbsp;"
                        - text: " AiTmed Privacy Policy"
                          color: "#333333"
                          fontWeight: 700
                      style:
                        color: "0x333333"
                        marginLeft: 1.5vw
                        top: "0.065"
                        width: "0.22"
                        height: "0.03"
                        fontSize: .Nfont.h0
                        lineHeight: "1.3"
                        textAlign: 
                          x: left
                
                - type: view
                  style:
                    left: "0"
                    width: "0.3"
                    marginTop: 1.5vw
                  children:
                    - type: button
                      text: Sign Up
                      style:
                        color: "0xffffffff"
                        fontSize: .Nfont.h0
                        fontWeight: 600
                        width: "0.22"
                        height: "0.045"
                        margin: auto
                        backgroundColor: "#2988E6"
                        border:
                          style: "1"
                        borderRadius: "7px"
                        textAlign:
                          x: center
                          y: center
                      onClick:                     
                        - actionType: evalObject
                          object:
                            - .Global.providerFirstSignIn@: false
                            - if:
                              - =..formData.target
                              - continue
                              - actionType: popUp
                                popUpView: noSelected
                                wait: true
                        - actionType: evalObject
                          object:
                            - if:
                              - =..formData.tar
                              - continue
                              - actionType: popUp
                                popUpView: noSelected
                                wait: true 
                        - actionType: evalObject
                          object:
                            - if:
                              - =..formData.vertex.name.password
                              - continue
                              - actionType: popUp
                                popUpView: inputPassword
                                wait: true
                        - actionType: evalObject
                          object:
                            - if:
                              - =..formData.vertex.name.firstName
                              - continue
                              - actionType: popUp
                                popUpView: inputPassword
                                wait: true                      
                        - actionType: evalObject
                          object:
                            - if:
                              - =..formData.vertex.name.lastName
                              - continue
                              - actionType: popUp
                                popUpView: inputPassword
                                wait: true                     
                        - actionType: evalObject
                          object:
                            - if:
                              - =..formData.vertex.name.userName
                              - continue
                              - actionType: popUp
                                popUpView: inputPassword
                                wait: true                          
                        - actionType: evalObject
                          object:
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..formData.vertex.name.password
                                      string2: =..formData.vertex.name.confirmPassword
                                - continue
                                - actionType: popUp
                                  popUpView: samePassword
                                  wait: true  
                        - actionType: evalObject
                          object:
                            - =.builtIn.typeCheck.userName:
                                dataIn:
                                  =..formData.vertex.name.userName
                                dataOut: CreateNewAccount1.checkOk
                            - if:
                                - =..checkOk
                                - continue
                                - actionType: popUp
                                  popUpView: invaliduserid
                                  wait: true     
                        - actionType: evalObject
                          object:
                            - =.builtIn.string.concat:
                                dataIn:
                                  - "uid like '"
                                  - =..formData.vertex.name.userName
                                  - "%'"
                                dataOut: CreateNewAccount1.rvCondition   
                            - =..getVertex.vertexAPI.get: ""
                            - if:
                                - =..getVertex.response.vertex.0.id
                                - actionType: popUp
                                  popUpView: sameuserid
                                  wait: true
                                - continue

                        - actionType: saveObject
                          object: ..save 
                        - actionType: evalObject
                          object: 
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..formData.response.code
                                      string2: 1031
                                - actionType: popUp
                                  popUpView: sameuserid
                                  wait: true
                                - continue 
                        - actionType: evalObject
                          object: ..update  
                        - actionType: evalObject
                          object:
                            =.builtIn.eccNaCl.decryptAES:
                              dataIn:
                                key: =..formData.vertex.name.password
                                message: =..formData.response.vertex.esk
                              dataOut: Global.currentUser.vertex.sk
                        # # - actionType: evalObject
                        # #   object:
                        # #     # - =..profile.docAPI.store: ""
                        # #     - =.builtIn.eccNaCl.decryptAES:
                        # #         dataIn:
                        # #           key: =..formData.vertex.name.password
                        # #           message: =..formData.response.vertex.esk
                        # #         dataOut: Global.currentUser.vertex.sk
                        # #     - .Global.clock@: =.PersonalDetail.clock 
                        # #     - .Global.newAppointment@: =.PersonalDetail.newAppointment
                        # #     - .Global.isCreateAppointment@: false 
                        - actionType: evalObject
                          object:
                            - .Global.organizations@: []
                            - .Global.dashboardName@: ""
                        - actionType: evalObject
                          object:
                            - if:
                                - =..formData.response.vertex.pk
                                - goto: ProviderDetail
                                - actionType: popUp
                                  popUpView: wrongCode 
                        # - actionType: evalObject
                        #   object:
                        #     - if:
                        #       - =..formData.response.vertex.pk
                        #       - continue
                        #       - goto: SignIn
                        - actionType: evalObject
                          object:
                            - =.builtIn.search.updateEsData:
                                dataIn:
                                  id: =.Global.currentUser.vertex.id
                                  type: '35841'
                                dataOut: CreateNewAccount1.res
                            - if:
                              - =..formData.response.vertex.pk
                              - continue
                              - goto: SignUp  
                - .ViewRow:
                  style:
                    alignItems: center
                    width: 22vw
                    justifyContent: space-between
                    marginTop: 1.5vw
                    marginLeft: 4vw
                  children: 
                    - type: label
                      style:
                        height: 0.1vw
                        width: 9vw
                        backgroundColor: "#C4C4C4"      
                    - type: label
                      text: OR
                      style:
                        fontSize: .Nfont.h0_0
                        color: "#333333"                 
                    - type: label
                      style:
                        height: 0.1vw
                        width: 9vw
                        backgroundColor: "#C4C4C4"
                
                - type: view 
                  style:
                    marginTop: 0.5vw
                    marginLeft: 6vw
                    width: "0.22"
                    height: "0.1"
                  children:
                    - type: label
                      text: Already have an account? 
                      style:
                        width: "0.15"
                        top: "0"
                        height: "0.03"
                        fontSize: .Nfont.h0
                        textAlign: 
                          x: center
                          y: center
                    - type: button
                      text: Sign In
                      style:
                        color: "0x143459"
                        fontSize: .Nfont.h0
                        left: "0.125"
                        width: "0.04"
                        height: "0.03"
                        textAlign: 
                          x: center
                          y: center
                        fontStyle: "bold"
                        backgroundColor: "0xffffff00"
                        border:
                          style: "1"
                      onClick: 
                        - goto: SignIn
