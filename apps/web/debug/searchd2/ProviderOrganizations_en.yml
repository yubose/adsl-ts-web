ProviderOrganizations: 
  pageNumber: "451" 
  viewPort: top
  title: "ProviderSchedule"
  init:
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - =..invite.edgeAPI.get: ""
    - =..facilityInvite.edgeAPI.get: ""
    - =..connections.docAPI.get: ""
    - =.builtIn.array.getListLength:
        dataIn:
          object: =..facilityInvite.inviteList.edge
        dataOut: ProviderOrganizations.formData.appointmentLength
        
    - =.builtIn.array.getListLength:
        dataIn:
          object: =..connections.connectionList.doc
        dataOut: ProviderOrganizations.formData.connectLength
    - actionType: evalObject
      object:
        - ..organizations@: =.Global.organizations
    - .Global.jwt.edge.bvid@: =.Global.currentUser.vertex.id #change provider jwt
    - =.Global.jwt.edgeAPI.store: ""        
  
  getVertex:
    response: ""
    vertex:
      id: ""
      xfname: "id"
    get:
      api: rv
      dataIn: getVertex.vertex
      dataOut: getVertex.response
  invite:
    inviteList: 
      edge: ""
    edgeAPI:
      get:
        api: re
        type: .EdgeType.InviteInfo
        xfname: evid
        id: .Global.currentUser.vertex.id
        maxcount: "10000"
        dataKey: invite.inviteList
        sCondition: subtype in (262144,327680)
        _nonce: =.Global._nonce
      delete: 
        api: dx
        dataIn: NewConnections.dataObject
  connections:
    connectionList: ""
    docIn: 
      type: .DocType.FacilityProfile
      xfname: E.bvid|E.evid
      id: .Global.currentUser.vertex.id
      ObjType: 12
      sCondition: E.type=10002 AND E.tage=1
      _nonce: =.Global._nonce
    docAPI:
      get:
        api: rd
        dataIn: connections.docIn
        dataOut: ProviderOrganizations.connections.connectionList
  dataObject: ""
  facilityInvite:
    inviteList: 
      edge: ""
    edgeAPI:
      get:
        api: re
        type: .EdgeType.InviteInfo
        xfname: evid
        id: .Global.currentUser.vertex.id
        maxcount: "10000"
        dataKey: facilityInvite.inviteList
        sCondition: subtype in (196624,196608)
        _nonce: =.Global._nonce
  accept:
    edge:
      .Edge: ""
      type: .EdgeType.Accept
      bvid: .Global.currentUser.vertex.id
      name:
        inviteeAvatar: ""
    edgeAPI: 
      store:
        api: ce
        dataIn: accept.edge
  refuse:
    edge:
      .Edge: ""
      type: .EdgeType.Refuse
      bvid: .Global.currentUser.vertex.id
      name: ""
    edgeAPI: 
      store:
        api: ce
        dataIn: refuse.edge
  formData:
    appointmentLength: ""
    connectLength: ""
    connectionList: []
    connection: ""
  components:
    - type: view
      style:
        width: "1"
        height: "1"
        margin: auto
      children:
        - type: view
          style:
            background-image: 'linear-gradient(#0063a8, #004371)'   
            height: "1"
            width: "0.16"
          children:
            - .aitLogo:
            - .Menu:
        - .TopBar:
        - .BodyView:
          style: 
            backgroundColor: "#f4f8fa"
            width: "0.84"
            height: "0.92"
            left: '0.16'
            top: "0.08"
          children:
            - .Label1:
              type: label
              text: "My Connections"
              style:
                left: "2.694vw"
                fontSize: "1.5vw"
                top: "1.008vw"
            - type: view
              style:
                width: 20vw
                left: 1.1vw
                height: "0.15"
                top: "4vw"
                backgroundColor: "0xffffff"
                boxShadow: "0px 0px 3px 3px #e9ebec"
              children:
                - type: label
                  text: My Organizations
                  style: 
                    left: "0"
                    marginTop: "1.008vw"
                    width: "19.756vw"
                    height: "2.52vw"
                    fontSize: "1vw"
                    color: '0x333333'
                    fontFamily: "Poppins"
                    display: flex
                    justify-content: center
                    textAlign:
                      x: center
                - type: label
                  dataKey: formData.connectLength
                  style:
                    left: "9.429vw"
                    marginTop: "0.252vw"
                    width: "4.49vw"
                    height: "2.52vw"
                    color: "#fed25a"
                    fontSize: "2vw"
                    fontFamily: "Arial"
            - type: view
              style: 
                left: 1.1vw
                width: 20vw
                height: "38vw"
                top: "13vw"
                backgroundColor: "#ffffff"
                boxShadow: "0px 0px 3px 3px #e9ebec"
              children: 
                - .Label1: 
                  text: New Organizations
                  style: 
                    left: "1vw"
                    color: "#030303"
                    top: "0.8vw"
                    fontWeight: 400
                    fontSize: 1vw
                    display: flex
                    flexFlow: row wrap
                    
                - .Label1:
                  dataKey: ProviderOrganizations.formData.appointmentLength
                  style: 
                    left: '1vw'
                    color: '#0063A8'
                    top: '2.6vw'
                    fontWeight: 300
                    fontSize: 0.8vw
                - .Label1:
                  text: pending request
                  style:
                    left: '2vw'
                    color: '#0063A8'
                    fontSize: 0.8vw
                    top: '2.5vw'
                - type: scrollView
                  style: 
                    left: "1vw"
                    top: "4vw"
                    width: "20vw"
                    height: "28vw"
                    # backgroundColor: "red"
                  children: 
                    - type: list
                      contentType: listObject
                      listObject: ..facilityInvite.inviteList.edge
                      iteratorVar: itemObject
                      viewTag: inviteTag
                      style: 
                        width: "17.96vw"
                        height: "50.4vw"
                        borderBottom: "1px solid #0c5599"
                        borderWidth: 1px
                        # backgroundColor: "red"
                      children: 
                        - type: listItem
                          itemObject: ""
                          style: 
                            marginTop: "1vw"
                            width: "17.96vw"
                            height: "6.048vw"
                            border: 
                              style: 3
                            borderWidth: 1px
                            borderRight: "1px solid #d0dce5"
                            borderColor: "#d0dce5"
                          children:
                            - type: view
                              style: 
                                height: "4.032vw"
                                width: "17.96vw"
                                
                              children: 
                                - type: image
                                  path: Urgentcare.png
                                  path=func: =.builtIn.utils.prepareDocToPath
                                  dataKey: itemObject.name.facilityAvatarID
                                  style: 
                                    height: "3.024vw"
                                    left: "0.898vw"
                                    top: "0.504vw"
                                - type: label
                                  dataKey: itemObject.name.inviterName
                                  style: 
                                    top: "1.152vw"
                                    left: "4.49vw"
                                    height: "1.008vw"
                                    textAlign: 
                                      y: center
                                    color: "#1484cd"
                                    fontWeight: 500
                                    borderBottom: "solid 1px  #1484cd"
                                    borderWidth: "1px"
                            - type: view 
                              style: 
                                top: "4.032w"
                                width: "17.96vw"
                                height: "2.016vw"
                              children:
                                - type: button
                                  style: 
                                    left: "0vw"
                                    width: "8.98vw"
                                    height: "2.016vw"
                                    top: "0vw"
                                    border: 
                                      style: 3
                                    borderWidth: "2px"
                                    borderColor: "#e6eaeb"
                                    textAlign: 
                                      y: center
                                  onClick: 
                                    - actionType: evalObject
                                      object:
                                        - if:
                                          - =.Global.organizations.0.id
                                          - ..flag: true
                                          - ..flag@: false
                                    - actionType: updateObject
                                      dataKey: Global.organizations
                                      dataObject: .EmptyObj
                                    - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                                      dataKey: ProviderOrganizations.dataObject
                                      dataObject: itemObject 
                                    - emit:
                                        dataKey:
                                          var: itemObject
                                        actions: 
                                          - ..accept.edge.evid@: $var.bvid
                                          - ..accept.edge.name@: $var.name
                                          # - ..accept.edge.name.inviteeAvatar@: =.Global.formData.avatar
                                          - ..accept.edge.refid@: $var.id
                                          - ..getVertex.vertex.id@: $var.bvid
                                          - =..getVertex.get: ""
                                          - if:
                                            - =.builtIn.array.isExist:
                                                dataIn:
                                                  array: =.Global.formData.connectionList
                                                  phoneNumber: $var.name.inviterPhoneNumber
                                            - =..invite.edgeAPI.delete: ""
                                            - continue
                                          - if:
                                            - =.builtIn.array.isExist:
                                                dataIn:
                                                  array: =.Global.formData.connectionList
                                                  phoneNumber: $var.name.inviterPhoneNumber
                                            - continue
                                            - =..accept.edgeAPI.store: ""
                                          - if:
                                            - =.builtIn.array.isExist:
                                                dataIn:
                                                  array: =.Global.formData.connectionList
                                                  phoneNumber: $var.name.inviterPhoneNumber
                                            - continue
                                            - =.builtIn.array.append:
                                                dataIn:
                                                  newMessage: =..getVertex.response.vertex.0
                                                  messages: =..organizations
                                    - actionType: evalObject
                                      object:
                                        - .Global.organizations@: =.ProviderOrganizations.organizations
                                        - .Global.hasOrganization: true
                                    - actionType: evalObject
                                      object:
                                        - if:
                                          - =..flag
                                          - continue
                                          - actionType: evalObject
                                            object:
                                              - .Global.currentFacility@: =.Global.organizations.0
                                              - .Global.organizations.0.isSelected@: true
                                              - .Global.dashboardName@: =.Global.organizations.0.name.basicInfo.medicalFacilityName
                                    - actionType: evalObject
                                      object:
                                        .Global._nonce@:
                                          =.builtIn.math.random: ""
                                    - actionType: evalObject
                                      object: 
                                        - actionType: builtIn
                                          funcName: redraw
                                          viewTag: inviteTag
                                    - actionType: evalObject
                                      object:
                                        - =..connections.docAPI.get: ""
                                    - actionType: evalObject
                                      object:
                                        - actionType: builtIn
                                          funcName: redraw
                                          viewTag: showFacility
                                    - actionType: evalObject
                                      object:
                                        - .Global.hasOrganization@: true
                                    - actionType: evalObject
                                      object:
                                        - =.builtIn.goto:
                                            dataIn:
                                              destination: ProviderOrganizations
                                              pageReload: true
                                  
                                  children: 
                                    - type: image
                                      path: Icon awesome-check.png
                                      style: 
                                        left: " 1.796vw"
                                        height: "1.008vw"
                                        width: "0.898vw"
                                    - type: label
                                      text: Approve
                                      style: 
                                        left: "2.694vw"
                                        width: "3.592vw"
                                        color:  "#8e95a5"
                                        fontSize: "1vh"
                                        # backgroundColor: "red"
                                - type: button
                                  style: 
                                    left: "8.98vw"
                                    width: "8.98vw"
                                    height: "2.016vw"
                                    top: "0vw"
                                    border: 
                                      style: 3
                                    borderWidth: "2px"
                                    borderColor: "#e6eaeb"
                                    textAlign: 
                                      y: center
                                  onClick:
                                    - actionType: updateObject
                                      dataKey: Global.organizations
                                      dataObject: .EmptyObj                  
                                    - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                                      dataKey: ProviderOrganizations.dataObject
                                      dataObject: itemObject 
                                    - emit:
                                        dataKey:
                                          var: itemObject
                                        actions: 
                                          - ..refuse.edge.evid@: $var.bvid
                                          - ..refuse.edge.name@: $var.name
                                          - ..refuse.edge.refid@: $var.id
                                          - ..getVertex.vertex.id@: $var.bvid
                                          - =..getVertex.get: ""
                                          - if:
                                            - =.builtIn.array.isExist:
                                                dataIn:
                                                  array: =.Global.formData.connectionList
                                                  phoneNumber: $var.name.inviterPhoneNumber
                                            - =..invite.edgeAPI.delete: ""
                                            - continue
                                          - if:
                                            - =.builtIn.array.isExist:
                                                dataIn:
                                                  array: =.Global.formData.connectionList
                                                  phoneNumber: $var.name.inviterPhoneNumber
                                            - continue
                                            - =..refuse.edgeAPI.store: ""
                                          - if:
                                            - =.builtIn.array.isExist:
                                                dataIn:
                                                  array: =.Global.formData.connectionList
                                                  phoneNumber: $var.name.inviterPhoneNumber
                                            - continue
                                            - =.builtIn.array.append:
                                                dataIn:
                                                  newMessage: =..getVertex.response.vertex.0
                                                  messages: =..organizations
                                    - actionType: evalObject
                                      object:
                                        - .Global.organizations@: =.ProviderOrganizations.organizations
                                    - actionType: evalObject
                                      object:
                                        .Global._nonce@:
                                          =.builtIn.math.random: ""
                                    - actionType: evalObject
                                      object:    
                                        - =..invite.edgeAPI.get: ""
                                    - actionType: builtIn
                                      funcName: redraw
                                      viewTag: inviteTag
                                    - actionType: evalObject
                                      object:
                                        - =..connections.docAPI.get: ""
                                    - actionType: evalObject
                                      object:
                                        - actionType: builtIn
                                          funcName: redraw
                                          viewTag: showFacility
                                    - actionType: evalObject
                                      object:
                                        - =.builtIn.goto:
                                            dataIn:
                                              destination: ProviderOrganizations
                                              pageReload: true
                                  children: 
                                    - type: image
                                      path: Icon material-close.png
                                      style: 
                                        left: " 1.796vw"
                                        height: "1.008vw"
                                        width: "0.898vw"
                                    - type: label
                                      text: Deny
                                      style: 
                                        left: "2.694vw"
                                        width: "3.592vw"
                                        color:  "#8e95a5"
                                        fontSize: "1vh"
                                  
            - type: view
              viewTag: chartContent
              style:
                width: '60vw'
                height: '47vw'
                top: '4.032vw'
                left: 22vw
                backgroundColor: "0xffffff"
                overflowY: scroll
                isHidden: false
                boxShadow: "0px 0px 3px 3px #e9ebec"
              children: 
                - type: view 
                  style: 
                    marginLeft: 1vw
                    width: 57vw
                    marginTop: 1vw
                    height: "auto"
                    display: flex
                    flexDirection: column
                  children: 
                    - type: view
                      style:
                        width: 57vw
                        height: 2.5vw
                        background-image: 'linear-gradient(#378fcd, #054b90)' 
                      children: 
                        - .Label1: 
                          text: Organization List
                          style: 
                            marginLeft: 1vw
                            height: "2.5vw"
                            color: "#ffffff"
                            fontSize: "1.1vw"
                            textAlign:
                              y: center
                    - type: view
                      style: 
                        height: 2.5vw
                        marginTop: 0
                        width: 57vw
                        backgroundColor: "#f3f3f3"
                        display: flex
                        flexDirection: row
                      children: 
                        - type: view
                          style: 
                            width: 18vw
                            height: 2.5vw
                            border:
                              style: 3
                            borderWidth: 1px
                            borderColor: "#d0dce5"
                          children: 
                            - .Label1: 
                              text: Organization Name
                              style: 
                                height: 2.5vw
                                left: 1vw
                                fontSize: "0.9vw"
                                textAlign:
                                  y: center
                        - type: view
                          style: 
                            width: 18vw
                            height: 2.5vw
                            border:
                              style: 3
                            borderWidth: 1px
                            borderColor: "#d0dce5"
                          children: 
                            - .Label1: 
                              text: "Phone Number"
                              style: 
                                height: 2.5vw
                                left: 1vw
                                fontSize: "0.9vw"
                                textAlign:
                                  y: center
                        - type: view
                          style: 
                            width: 21vw
                            height: 2.5vw
                            border:
                              style: 3
                            borderWidth: 1px
                            borderColor: "#d0dce5"
                          children: 
                            - .Label1: 
                              text: Address
                              style: 
                                height: 2.5vw
                                left: 1vw
                                fontSize: "0.9vw"
                                textAlign:
                                  y: center
                    - type: scroll
                      style: 
                        marginTop: 0
                        width: 57vw
                        height: auto
                      children: 
                        - type: list
                          contentType: listObject
                          listObject: ..connections.connectionList.doc
                          iteratorVar: itemObject
                          style: 
                            width: 57vw
                          children: 
                            - type: listItem
                              itemObject: ""
                              viewTag: showFacility
                              style: 
                                marginTop: "0"
                                width: 57vw
                                backgroundColor: "#ffffff"
                                height: 2.5vw
                                display: flex
                                flexDirection: row
                                alignItems: center
                              children: 
                                - type: view
                                  style: 
                                    width: 18vw
                                    height: 2.5vw
                                    border:
                                      style: 3
                                    borderWidth: 1px
                                    borderColor: "#d0dce5"
                                  children: 
                                    - .Label1: 
                                      dataKey: itemObject.name.data.basicInfo.medicalFacilityName
                                      style: 
                                        height: 2.5vw
                                        left: 1vw
                                        fontSize: "0.85vw"
                                        textAlign:
                                          y: center
                                - type: view
                                  style: 
                                    width: 18vw
                                    height: 2.5vw
                                    border:
                                      style: 3
                                    borderWidth: 1px
                                    borderColor: "#d0dce5"
                                  children: 
                                    - .Label1: 
                                      dataKey: itemObject.name.data.basicInfo.phoneNumber
                                      style: 
                                        height: 2.5vw
                                        left: 1vw
                                        fontSize: "0.85vw"
                                        textAlign:
                                          y: center
                                - type: view
                                  style: 
                                    width: 21vw
                                    border:
                                      style: 3
                                    borderWidth: 1px
                                    borderColor: "#d0dce5"
                                  children: 
                                    - .Label1: 
                                      dataKey: itemObject.name.data.basicInfo.fullInfo
                                      style: 
                                        left: 1vw
                                        width: 19vw
                                        height: 2.5vw
                                        wordBreak: break-word
                                        fontSize: "0.85vw"
                                        textAlign:
                                          y: center
              
                