PaymentConfirmation:
  title: "Payment Confirmation"
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
  checkOrder:
    docReq:
      .Global.paymentOrder.document: ""
    docRes: ""
    getdocument:
      id: .Global.paymentCheck.id
      xfname: eid
      type: .DocType.CheckOrder #  type: "257"
      obfname: "mtime"
      maxcount: "1"
      _nonce: =.Global._nonce
    docAPI:
      store:
        api: cd
        dataIn: checkOrder.docReq
        dataOut: PaymentConfirmation.checkOrder.docRes
      get:
        .DocAPI.get: ""
        api: rd
        dataIn: checkOrder.getdocument
        dataOut: PaymentConfirmation.checkOrder.document

  components:
    - type: view
      style:
        width: 1
        height: 1
      children:
        - .BaseHeader:
        - .HeaderLeftButton:
            onClick:
              - goto: FinancialResponsibility
        - type: view
          style:
            width: "1"
            height: "0.75"
            top: "0.1"
          children:
            - type: label
              text: "Payment is processing, please click the button for the next step"
              style:
                width: "0.92"
                marginLeft: "0.05"
                marginTop: "0.1"
                color: "0x6E6E6E"
                fontSize: .Nfont.h5
                fontWeight: "550"

                textAlign:
                  x: center
            - type: image
              path: confirmCashOutImage.svg
              style:
                width: "0.4"
                marginLeft: "0.3"
                marginTop: "0.15"
        - type: view
          style:
            width: "1"
            height: "0.1"
            top: "0.75"
          children:
            - type: button
              text: confirm
              style:
                width: "0.8"
                height: "0.05"
                borderRadius: "5px"
                backgroundColor: "0x2887e5"
                color: "0xffffff"
                fontSize: .Nfont.h3
                marginLeft: "0.1"
              onClick:
                - actionType: evalObject
                  object:
                    - =..checkOrder.docAPI.get: ""
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..checkOrder.document.doc.0.deat.state
                              string2: "COMPLETED"
                        - actionType: popUp
                          popUpView: PaymentSuccessful
                          wait: true
                        - continue
                    - if:
                        - =.Global.paymentOrder.document.id
                        - =..checkOrder.docAPI.store: ""
                        - continue
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..checkOrder.docRes.doc.deat.state
                              string2: "COMPLETED"
                        - actionType: popUp
                          popUpView: PaymentSuccessful
                          wait: true
                        - actionType: popUp
                          popUpView: PaymentFailed
                          wait: true
    # 支付成功弹框
    - .BackgroundColorGray:
      viewTag: PaymentSuccessful
      onClick:
        - actionType: popUpDismiss
          popUpView: PaymentSuccessful
        - goto: AppointmentLobby
      children:
        - type: view
          style:
            width: "0.5"
            height: "0.186"
            backgroundColor: "0xe5e5e5"
            borderRadius: "12"
            marginTop: "0.4"
            marginLeft: "0.25"
            textAlign:
              x: center
          children:
            - type: image
              path: deleteTrue.svg
              style:
                width: "0.106"
                marginTop: "0.03"
            - type: label
              text: "Success!"
              dataKey:
              style:
                color: "0x333333"
                fontSize: .Nfont.h1_1
                width: "0.5"
                height: "0.03"

                word-break: break-word
                margin: auto
                marginTop: "0.005"
            - type: label
              text: "Your payment has been processed"
              dataKey:
              style:
                color: "0x555555"
                fontSize: .Nfont.h1_1
                width: "0.5"
                height: "0.06"
                word-break: break-word
                margin: auto
                marginTop: "0.005"

    - .BackgroundColorGray:
      viewTag: PaymentFailed
      onClick:
        - actionType: popUpDismiss
          popUpView: PaymentFailed
      children:
        - type: view
          style:
            width: "0.5"
            height: "0.186"
            backgroundColor: "0xe5e5e5"
            borderRadius: "12"
            marginTop: "0.4"
            marginLeft: "0.25"
            textAlign:
              x: center
          children:
            - type: image
              path: aboutRed.svg
              style:
                width: "0.106"
                marginTop: "0.03"
            - type: label
              text: "Payment Declined"
              dataKey:
              style:
                color: "0x333333"
                fontSize: .Nfont.h1_1
                width: "0.5"
                height: "0.03"

                word-break: break-word
                margin: auto
                marginTop: "0.005"
            - type: label
              text: "Please check your payment information
                and try again"
              dataKey:
              style:
                color: "0x555555"
                fontSize: .Nfont.h1_1
                width: "0.5"
                height: "0.06"
                word-break: break-word
                margin: auto
                marginTop: "0.005"
