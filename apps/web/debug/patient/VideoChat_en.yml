VideoChat:
  pageNumber: "190"
  init:
    - .SignInCheck
    # - if:
    #     - =.Global.roomInfoDoc.document.deat.roomID # 'true', 'false'
    #     - continue
    #     - goto: PatientDashboard
    # meeting time
    - actionType: evalObject
      object:
        - ..cameraOn@: .Global.cameraOn
        - ..micOn@: .Global.micOn
    #join in meeting
    - actionType: builtIn
      funcName: videoChat
      roomId: .Global.roomInfoDoc.document.deat.roomID
      accessToken: .Global.roomInfoDoc.document.deat.accessToken
      timerTag: videoTimer
      timer: .Global.timer # timer object is to be removed after web and iOS implemented builtIn
    - .Global.MiddlePage.visitDetialbackPage@: "PatientDashboard"
    # - actionType: builtIn
    #   funcName: initExtend
    #   timePerExtendSeconds: 180 # 3 mins
    #   numberofExtensions: 3
    #   popUpWaitSeconds: 30
    #   meetingEndTime: .Global.roomInfo.edge.etime
    # AutoDC is for patient auto disconnect
    - actionType: builtIn
      funcName: initAutoDC
      popUpWaitSeconds: 30
      meetingEndTime: .Global.roomInfo.edge.etime
    - actionType: builtIn
      funcName: initConnectTimeout
      timeoutSeconds: 10
    - if:
        - .builtIn.isAndroid
        - ..isWorkingStethoscope@: block
        - ..isWorkingStethoscope@: none         
  isWorkingStethoscope: ""  
  formData:
    currentTime: ""
  apiRequest:
    appointment:
      edgeQueryResp: ""
      edgeQueryReq:
        id: .Global.roomInfo.edge.id
        _nonce: =.Global._nonce
      edgeAPI:
        get:
          api: re
          dataIn: VideoChat.apiRequest.appointment.edgeQueryReq
          dataOut: VideoChat.apiRequest.appointment.edgeQueryResp
    # change meetingTag
    appointmentTag:
      docCreateResp: ""
      docCreateReq:
        name:
          data: ""
        type: .DocType.GroupBitOrTage
        eid: .Global.currentRoom.edge.id
        reid: .Global.currentRoom.edge.id
        tage: "0"
      docAPI:
        store:
          api: cd
          dataIn: VideoChat.apiRequest.appointmentTag.docCreateReq
          dataOut: VideoChat.apiRequest.appointmentTag.docCreateResp
    # join meeting
    # newVideoMessage:
    #   response: ""
    #   document:
    #     eid: .Global.roomInfo.edge.id
    #     reid: .Global.roomInfo.edge.id
    #     subtype:
    #       isOnServer: 1
    #       isZipped: 0
    #       isBinary: 0
    #       isEncrypted: 0
    #       isExtraKeyNeeded: 0
    #       isEditable: 0
    #       applicationDataType: 8
    #       # 7 th bit
    #       notification: 1
    #       ringToneNotify: 0
    #       sendtoSelf: 0
    #       # 10 bit
    #       textMessage: 0
    #       mediaType: 8
    #     type: 770
    #     tage: 0
    #     name:
    #       title: textMessage
    #       senderId: .Global.currentUser.vertex.id
    #       senderName: .Global.currentUser.vertex.name.userName
    #       data:
    #         text: ""
    #       notification:
    #         title: Patient In Appointment Room Now
    #         context: click to get into virtual room
    #         body: click to get into virtual room
    #         onClickLandingPage: AppointmentLobby
    #         targetApp: =.FirebaseToken.response.edge.evid
    #   docAPI:
    #     store:
    #       api: cd
    #       dataIn: apiRequest.newVideoMessage.document
    #       dataOut: apiRequest.newVideoMessage.response

  sendNotification:
    document:
      .Document: ""
      eid: ""
      subtype:
        isOnServer: 1
        isZipped: 0
        isBinary: 0
        isEncrypted: 0
        isExtraKeyNeeded: 0
        isEditable: 0
        applicationDataType: 0
        # 7 th bit
        notification: 1
        ringToneNotify: 1
        sendtoSelf: 0
        # 10 bit
        textMessage: 0
        mediaType: 8
      type: .DocType.Notification
      tage: 2
      name:
        data: ""
        notification:
          title: Patient In Virtual Room
          context: Click to jump to Appointment Lobby
          body: Click to jump to Appointment Lobby
          landingPage: RingTonePage
          onClickLandingPage: RingTonePage
          #targetApp: =.FirebaseToken.response.edge.evid
          caller: =.Global.Profile.name.data.basicInfo.fullName
    docAPI:
      store:
        api: cd
        dataIn: sendNotification.document
  cameraOn: "true"
  micOn: "true"
  miuAutoMicOffTimespan: "3" # seconds
  miuAutoMicOffThresdhold: "3" # mic volume calibrate between 0 to 9, <= 3 will turn micOff Automatically if user set the mic is on. Mic will not turn on automatically within the minAutoMicOffTimespan even a higher level of volumn detectec.

  emptyId: ""
  listData:
    participants:
      - 1
      - 2
      - 3
      - 4
      - 5
      - 6
  popUpList:
    # - text: "Participants / Invite"
    #   pageName: "ParticipantsInvite" # 待修改
    - text: "Appointment Lobby"
      pageName: "AppointmentLobby"
    - text: "Medical Document"
      pageName: "MedicalDocuments"
    - text: "Invite Participants"
      pageName: "ChooseInvite" # 待修改
    # - text: "Meeting Notes"
    #   pageName: "ProviderNotes"
    # - text: "Share your screen"
    #   pageName: "ScreenShare"
  popUpListTemp: ""
  components:
    - type: popUp
      viewTag: underconstruction
      style:
        width: "1"
        height: "1"
        top: "0"
        left: "0"
        zIndex: "100"
        backgroundColor: "0x00000033"
      children:
        - type: view
          style:
            left: "0.14"
            top: "0.27"
            width: "0.72"
            height: "0.35"
            backgroundColor: "0xe1e1e1"
            borderRadius: "10"
          children:
            - type: image
              path: aitmedLogoBlack.svg
              style:
                left: "0.25"
                top: "0.02"
                width: "0.18"
            - type: label
              text: Start Screen Share
              style:
                left: "0"
                top: "0.13"
                width: "0.72"
                height: "0.05"
                fontSize: "18"
                fontWeight: "400"
                textAlign:
                  x: center
            - type: label
              text: Everything on your screen will be recorded,including any notifications.Enable Do Not Disturb to avoid notifications being seen.
              style:
                left: "0.08"
                top: "0.17"
                width: "0.56"
                height: "0.13"
                fontSize: "13"
                fontWeight: "400"
                textAlign:
                  x: center
            - type: divider
              style:
                left: "0"
                top: "0.28"
                width: "0.72"
                height: "0.001"
                backgroundColor: "0x8f8f8f"
            - type: divider
              style:
                left: "0.358"
                top: "0.28"
                width: "0.004"
                height: "0.07"
                backgroundColor: "0x8f8f8f"
            - type: button
              text: Cancel
              style:
                width: "0.358"
                left: "0"
                height: "0.068"
                top: "0.282"
                backgroundColor: "0xe1e1e1"
                fontSize: "18"
                color: "0x007bff"
                borderRadius: "10"
                borderWeight: "0"
                textAlign:
                  x: center
              onClick:
                - actionType: popUpDismiss
                  popUpView: underconstruction
            - type: button
              text: Start
              style:
                width: "0.358"
                left: "0.362"
                height: "0.068"
                top: "0.282"
                backgroundColor: "0xe1e1e1"
                fontSize: "18"
                color: "0x007bff"
                borderRadius: "10"
                borderWeight: "0"
                textAlign:
                  x: center
              onClick:
                - actionType: builtIn
                  funcName: screenShare
    - type: register
      onEvent: twilioOnPeopleShowRoom
      actions:
        - actionType: evalObject
          object:
            - ..sendNotification.document.fid@: =.Global.prodAPPID
            - ..sendNotification.document.eid@: =.Global.roomInfo.edge.id
            - =..sendNotification.docAPI.store: ""
    #            - =.builtIn.FCM.getAPPID:
    #                dataIn:
    #                  appName: =.TargetApp.provider
    #                dataOut: FirebaseToken.edge.evid
    #            - actionType: evalObject
    #              object: .Global.updateJwt
    # - =.Global.jwt.edgeAPI.store: ""
    # - ..sendNotification.document.fid@: =.Global.prodAPPID
    # - ..sendNotification.document.eid@: =.Global.roomInfo.edge.id
    # - =..sendNotification.docAPI.store: ""
    # check if the patient is late, if late, then do not send notification.
    # - if:
    #     - =.builtIn.notification.validNotification:
    #         dataIn:
    #           stime: =.Global.currentRoom.edge.stime
    #           etime: =.Global.currentRoom.edge.etime
    #     - =..sendNotification.docAPI.store: ""
    #     - continue
    #            - =.builtIn.FCM.getAPPID:
    #                dataIn:
    #                  appName: =.AppName
    #                dataOut: FirebaseToken.edge.evid
    #            - actionType: evalObject
    #              object: .Global.updateJwt
    # - =.Global.jwt.edgeAPI.store: ""
    - type: register
      onEvent: twilioOnPeopleJoin
      actions:
        - actionType: builtIn
          funcName: hide
          viewTag: waitForOtherTag
    # - type: register
    #   onEvent: twilioOnNoParticipant
    #   actions:
    #     - actionType: builtIn
    #       funcName: show
    #       viewTag: waitForOtherTag
    # invoke when you need to disconnect the meeting in sdk
    - type: register
      onEvent: onDisconnect
      actions:
        # dismiss the popup
        # - actionType: popUpDismiss
        #   popUpView: providerLeftWarningView
        - actionType: popUpDismiss
          popUpView: exitWarningView
        - actionType: popUpDismiss
          popUpView: minimizeVideoChat
        - actionType: builtIn
          funcName: disconnectMeeting
        # clear roomDoc
        - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
          dataKey: Global.roomInfoDoc.document
          dataObject: {}
        - actionType: evalObject
          object:
            - .Global.timer@: 0
            - .Global.micOn@: "true"
            - .Global.cameraOn@: "true"
        - actionType: builtIn
          funcName: show
          viewTag: leftTag
        - actionType: popUp
          popUpView: timeIsOver
          wait: true
        # - goto: VisitDetial
    # invoke when the provider disconnects the meeting
    # can customize the actions to be different
    - type: register
      onEvent: onProviderDisconnect
      actions:
        # dismiss the popup
        - actionType: popUpDismiss
          popUpView: exitWarningView
        # - actionType: popUp
        #   popUpView: providerLeftWarningView
    - type: register
      onEvent: showExitWarningView
      actions:
        - actionType: popUp
          popUpView: exitWarningView
          popUpDismiss: 30000
          wait: true
    - type: register
      onEvent: showTimeoutPopup
      actions:
        - actionType: popUp
          popUpView: timeoutPopup
          wait: true
    - type: view
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        backgroundColor: "0xffffff"
        zIndex: 10
      children:
        - type: view
          viewTag: "waitForOtherTag"
          style:
            width: "1"
            top: "0"
            height: "0.8"
            textAlign:
              y: center
          children:
            - type: view
              style:
                width: auto
                height: auto
                textAlign:
                  x: center
              children:
                - type: image
                  path: aitmedLogoBlack.svg
                  style:
                    width: "0.326"
                    height: "auto"
                - type: label
                  text: Connecting...
                  style:
                    width: "1"
                    fontSize: ".Nfont.h16"
                    color: "#333333"
                    fontWeight: "600"
                    marginTop: "0.027"
                    textAlign: 
                      x: center
        - type: view
          viewTag: "leftTag"
          style:
            width: "1"
            top: "0"
            height: "0.8"
            display: "none"
            textAlign:
              y: center
          children:
            - type: view
              style:
                width: auto
                height: auto
                textAlign:
                  x: center
              children:
                - type: image
                  path: aitmedLogoBlack.svg
                  style:
                    width: "0.326"
                    height: "auto"
                - type: label
                  text: Leaving...
                  style:
                    width: "1"
                    fontSize: ".Nfont.h16"
                    color: "#333333"
                    fontWeight: "600"
                    marginTop: "0.027"
                    textAlign: 
                      x: center
        # 主视频对应区域
        - type: view
          viewTag: mainStream
          style:
            left: "0"
            top: "0"
            width: "1"
            height: "1"
            backgroundColor: "0x00000000"
        # 自身视频对应区域
        # - type: view
        #   viewTag: selfStream
        #   style:
        #     left: "0.04"
        #     top: "0.13"
        #     width: "0.2"
        #     height: "0.15"
        #     backgroundColor: "0x00000000"
        # - type: view
        #   style:
        #     left: "0"
        #     top: "0"
        #     width: "1"
        #     height: "0.1"
        #     backgroundColor: "0x000000"
        #     zIndex: 10
        #   children:
        #     # - type: label
        #     #   dataKey: roomInfo.edge.name.roomName
        #     #   style:
        #     #     left: "0"
        #     #     top: "0.05"
        #     #     width: "1"
        #     #     fontSize: "20"
        #     #     fontStyle: bold
        #     #     color: "0xFFFFFF"
        #     #     textAlign:
        #     #       x: center
        #     - type: image
        #       viewTag: switchCamera
        #       path: cameraSwitch.svg
        #       style:
        #         left: "0.87"
        #         top: "0.03"
        #         width: "0.12"
        #         height: "0.05"
        #         lineHeight: "55px"
        #         #height: "0.07"
        #         fontSize: "14"
        #         color: "0xFFFFFF"
        #         textAlign:
        #           x: right
        #       onClick:
        #         actionType: builtIn
        #         funcName: switchCamera
        #     - type: image
        #       viewTag: stethoscopeTag
        #       path: cameraSwitch.svg
        #       style:
        #         left: "0.76"
        #         top: "0.03"
        #         width: "0.12"
        #         height: "0.05"
        #         lineHeight: "55px"
        #         #height: "0.07"
        #         fontSize: "14"
        #         color: "0xFFFFFF"
        #         textAlign:
        #           x: right
        #       onClick:
        #         - actionType: evalObject
        #           object:
        #             - if:
        #                 - .builtIn.isAndroid
        #                 - actionType: builtIn
        #                   funcName: handleStethoscope
        #                 - continue
        #       #onClick:
        # - type: image
        #   path: logo.png # 图已删
        #   viewTag: waitForOtherTag
        #   style:
        #     left: "0.4"
        #     top: "0.15"
        #     width: "0.2"
        #     border:
        #       style: "5"
        #   borderRadius: 32
        # - type: label
        #   contentType: hidden # passwordHidden
        #   viewTag: waitForOtherTag
        #   text: "Waiting for others to join"
        #   #viewTag: needHidden
        #   style:
        #     left: "0"
        #     top: "0.3"
        #     width: "1"
        #     height: "0.04"
        #     fontSize: .Nfont.h3
        #     fontStyle: bold
        #     color: "0x000000"
        #     textAlign:
        #       x: center
        # - type: list # hardcoded listObject
        #   viewTag: videoSubStream
        #   contentType: videoSubStream # listObject
        #   listObject: "" # provide by twilio API ..listData.participants # to dataObject to enumerate the list
        #   iteratorVar: itemObject
        #   #for (itemObject in listObject) do something
        #   #  ..messageDoc@ = itemObject
        #   style:
        #     axis: horizontal
        #     left: "0.04"
        #     top: "0.62"
        #     width: "0.92"
        #     height: "0.15"
        #     zIndex: 20
        #   #for loop through listObject, we got each itemObject
        #   children:
        #     - type: listItem
        #       itemObject: ""
        #       style:
        #         left: "0"
        #         # top: "0"
        #         width: "0.18"
        #         height: "0.15"
        #         border:
        #           style: "1"
        #       children:
        #         - type: view
        #           viewTag: subStream
        #           # twilio API(js sdk) provides subStream html element.
        #           style:
        #             left: "0.015"
        #             top: "0"
        #             width: "0.15"
        #             height: "0.15"
        #             border:
        #               style: "5"
        #             borderRadius: "5"

        # - type: image
        #   path: Notes.png
        #   style:
        #     width: "0.12"
        #     top: "0.45"
        #     left: "0.76"
        #   onClick:
        #     - goto: MeetingDocumentsNotes
        - type: view
          style:
            width: "0.968"
            textAlign:
              x: right
          children:
            - type: view
              style:
                width: auto
                height: auto
              children:
                # - type: image
                #   viewTag: otoscopeTag
                #   path: otoscope.svg
                #   style:
                #     width: "0.12"
                #     height: "0.05"
                #     marginTop: "0.02"
                #     display: inline-block
                - type: image
                  viewTag: stethoscopeTag
                  path: stethoscope.svg
                  style:
                    width: "0.12"
                    display: ..isWorkingStethoscope
                    height: "0.05"
                    marginTop: "0.02"
                  onClick:
                    - actionType: builtIn
                      funcName: handleStethoscope

                # - type: image
                #   # viewTag: stethoscopeTag
                #   path: videoBlueTooth.svg
                #   style:
                #     width: "0.12"
                #     height: "0.05"
                #     marginTop: "0.02"
                #     display: inline-block
                #   onClick:
                # - actionType: evalObject
                #   object:
                #     - if:
                #         - .builtIn.isAndroid
                #         - actionType: builtIn
                #           funcName: handleStethoscope
                #         - continue
        - type: view
          style:
            width: "1"
            height: "0.312"
            top: "0.688"
            background: "linear-gradient(to top,#545454,#00000000)"
          children:
            - type: view
              viewTag: allParticipants
              style:
                width: "auto"
                marginTop: "0.0123"
                display: none
              children:
                - type: image
                  path: arrowLeftgrey.svg
                  style:
                    width: "0.064"
                    marginLeft: "0.0213"
                    display: inline-block
                    verticalAlign: middle
                  onClick:
                    - actionType: builtIn
                      funcName: hide
                      viewTag: allParticipants
                    - actionType: builtIn
                      funcName: show
                      viewTag: selfView
                - type: view
                  style:
                    display: inline-block
                    verticalAlign: middle
                  children:
                    - type: list # hardcoded listObject
                      viewTag: videoSubStream
                      contentType: videoSubStream # listObject
                      listObject: #..listData.participants # provide by twilio API ..listData.participants # to dataObject to enumerate the list
                      iteratorVar: itemObject
                      #for (itemObject in listObject) do something
                      #  ..messageDoc@ = itemObject
                      style:
                        axis: horizontal
                        marignLeft: "0.04"
                        display: inline-block
                        width: "0.88"
                        height: "0.123"
                        zIndex: 20
                        overflow-x: scroll
                        overflow-y: hidden
                      #for loop through listObject, we got each itemObject
                      children:
                        - type: listItem
                          itemObject: ""
                          style:
                            marginRight: "0.0427"
                            # top: "0"
                            # width: "0.213"
                            # height: "0.123"
                            border:
                              style: "1"
                            borderRadius: "5"
                          children:
                            - type: view
                              viewTag: subStream
                              # twilio API(js sdk) provides subStream html element.
                              style:
                                width: "0.213"
                                height: "0.123"
                                backgroundColor: "0xffffff00"

            - type: view
              viewTag: selfView
              style:
                width: "auto"
                marginTop: "0.0123"
              children:
                - type: view
                  viewTag: selfStream
                  style:
                    width: "0.213"
                    height: "0.123"
                    marginLeft: "0.0907"
                    display: inline-block
                    verticalAlign: middle
                    marginTop: "0"
                    border:
                      style: "5"
                    borderRadius: "5"
                    backgroundColor: "0xffffff00"
                # - type: image
                #   path: arrowRightgrey.svg
                #   style:
                #     width: "0.064"
                #     # marginLeft: "0.0213"

                #     display: inline-block
                #     verticalAlign: middle
                #   onClick:
                #     - actionType: builtIn
                #       funcName: show
                #       viewTag: allParticipants
                #     - actionType: builtIn
                #       funcName: hide
                #       viewTag: selfView

            - type: view
              style:
                width: "1"
                height: auto
                marginTop: "0.0197"
                textAlign:
                  x: center
                  y: center
              children:
                - type: label
                  #text: "1:10"
                  contentType: timer
                  viewTag: "videoTimer"
                  text=func: =.builtIn.string.formatTimer
                  dataKey: Global.timer # to be remove after implemented builtIn
                  style:
                    fontSize: ".Nfont.h18"
                    color: "0xffffff"

                    width: "1"
                    fontWeight: "500"
                    textAlign:
                      x: center
            - type: view
              style:
                width: "0.846"
                heightt: "0.074"
                marginTop: "0.012"
                marginLeft: "0.077"
                textAlign:
                  x: center
              children:
                # 麦克风
                - type: image
                  viewTag: microphone
                  # path: micOn.svg
                  # pathSelected: micOff.svg
                  path:
                    emit:
                      actions:
                        - if:
                            - =.VideoChat.micOn
                            - micOn.svg
                            - micOff.svg
                  onClick:
                    # - actionType: builtIn
                    #  funcName: toggleMicrophoneOnOff
                    - actionType: builtIn
                      funcName: toggleFlag
                      dataKey: VideoChat.micOn
                    - actionType: evalObject
                      object:
                        - if:
                            - =.VideoChat.micOn
                            - .VideoChat.micOn@: false
                            - .VideoChat.micOn@: true
                        - .Global.micOn@: =..micOn
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: microphone
                  style:
                    width: "0.117"
                    display: inline-block
                    verticalAlign: middle
                # 摄像头
                - type: image
                  viewTag: camera
                  #path: cameraOn.svg
                  #pathSelected: cameraOff.svg
                  path:
                    emit:
                      actions:
                        - if:
                            - =.VideoChat.cameraOn
                            - cameraOn.svg
                            - cameraOff.svg
                  onClick:
                    # - actionType: builtIn
                    #  funcName: toggleCameraOnOff
                    - actionType: builtIn
                      funcName: toggleFlag
                      dataKey: VideoChat.cameraOn
                    - actionType: evalObject
                      object:
                        - if:
                            - =.VideoChat.cameraOn
                            - .VideoChat.cameraOn@: false
                            - .VideoChat.cameraOn@: true
                        - .Global.cameraOn@: =..cameraOn
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: camera
                  style:
                    width: "0.117"
                    marginLeft: "0.053"
                    display: inline-block
                    verticalAlign: middle

                # 挂断
                - type: image
                  path: hangUp.svg
                  onClick:
                    # # change roomInfo tage
                    # - actionType: evalObject
                    #   object:
                    #     - =.builtIn.number.inhx:
                    #         dataIn:
                    #           intHex: =..apiRequest.appointmentTag.docCreateReq.tage
                    #           index: 9
                    #           hex: 1
                    #         dataOut: VideoChat.apiRequest.appointmentTag.docCreateReq.tage
                    #     - =..apiRequest.appointmentTag.docAPI.store: ""
                    #     - =..apiRequest.appointment.edgeAPI.get: ""
                    #     - .Global.roomInfo.edge@: =..apiRequest.appointment.edgeQueryResp.edge.0
                    # leave the meeting
                    - actionType: builtIn
                      funcName: disconnectMeeting
                    # clear roomDoc
                    - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                      dataKey: Global.roomInfoDoc.document
                      dataObject: {}
                    - actionType: evalObject
                      object:
                        - .Global.timer@: 0
                        - .Global.micOn@: "true"
                        - .Global.cameraOn@: "true"
                        - =..apiRequest.appointment.edgeAPI.get: ""
                        - .Global.roomInfo.edge@: =..apiRequest.appointment.edgeQueryResp.edge.0

                    - actionType: evalObject
                      object:
                        # 判断会议是否超时，如果未超时，则返回appointmentlobby，否则返回visit detail
                        - =.builtIn.date.getTime:
                            dataIn:
                            dataOut: VideoChat.formData.currentTime
                        - if:
                            - =.builtIn.math.greater:
                                dataIn:
                                  num1: =.VideoChat.formData.currentTime
                                  num2: =.Global.roomInfo.edge.etime
                            - goto: VisitDetial
                            - goto: AppointmentLobby
                  style:
                    width: "0.16"
                    backgroundColor: "0xd81e06"
                    display: inline-block
                    marginLeft: "0.053"
                    verticalAlign: middle
                    borderRadius: "100"
                # 切换摄像头
                - type: image
                  viewTag: switchCamera
                  path: cameraSwitch.svg
                  style:
                    width: "0.117"
                    marginLeft: "0.053"
                    display: inline-block
                    verticalAlign: middle
                  onClick:
                    actionType: builtIn
                    funcName: switchCamera

                # 功能
                - type: image
                  path: navIcMore.svg
                  style:
                    width: "0.117"
                    marginLeft: "0.053"
                    display: inline-block
                    verticalAlign: middle
                  onClick:
                    - actionType: builtIn
                      funcName: show
                      viewTag: selectView
                    - actionType: builtIn
                      funcName: dismissOnTouchOutside
                      viewTag: selectView
                    # - actionType: popUp
                    #   popUpView: selectView
                    #   dismissOnTouchOutside: true

    - type: popUp
      viewTag: minimizeVideoChat
      global: true
      style:
        left: "0.1"
        top: "0"
        width: "0.2"
        height: "0.15"
        zIndex: 10
      image: chat.png
      audioStream: true
      videoStream: true
      onClick:
        - actionType: popUpDismiss
          popUpView: minimizeVideoChat
        - actionType: evalObject
          object:
            - goto:
                dataIn:
                  destination: VideoChat
                  reload: true

    - type: popUp # view
      viewTag: confirmView
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        zIndex: 10
      children:
        - type: view
          style:
            left: "0.1"
            top: "0.325"
            width: "0.8"
            height: "0.35"
            backgroundColor: "0xeeeeeeff"
            border:
              style: "5"
            borderRadius: "15"
          children:
            - type: image
              onClick:
                - actionType: popUpDismiss
                  popUpView: confirmView
              path: cancel.svg
              style:
                .LabelStyle:
                  left: "0.025"
                  top: "0.01"
                  width: "0.03"
                  height: "0.03"
                  #backgroundColor: "0xe5e5e5"
                  color: "0x388eccff"
                  fontSize: "15"
                  display: inline
                  textAlign:
                    x: center
                    y: center
                  border:
                    style: "5"
                  borderRadius: "15"
            - type: label
              text: "LEAVING MEETING..."
              style:
                .LabelStyle:
                  left: "0.05"
                  top: "0.02"
                  width: "0.7"
                  height: "0.04"
                  color: "0x00000088"
                  fontSize: "20"
                  fontWeight: "500"
                  display: inline
                  textAlign:
                    x: center
                    y: center
            - type: label
              text: "Close this meeting room?"
              style:
                .LabelStyle:
                  left: "0.05"
                  top: "0.06"
                  width: "0.7"
                  height: "0.04"
                  color: "0x00000088"
                  fontSize: "20"
                  fontWeight: "500"
                  display: inline
                  textAlign:
                    x: center
                    y: center
            - type: label
              text: "Closing the room will generate a Summary for each participant."
              style:
                .LabelStyle:
                  left: "0.05"
                  top: "0.11"
                  width: "0.7"
                  height: "0.04"
                  color: "0x00000088"
                  fontSize: "16"
                  display: inline
                  textAlign:
                    x: center
                    y: center
            - type: label
              text: "If you desire to return to this meeting, keep this room open"
              style:
                .LabelStyle:
                  left: "0.05"
                  top: "0.18"
                  width: "0.7"
                  height: "0.04"
                  color: "0x00000088"
                  fontSize: "16"
                  display: inline
                  textAlign:
                    x: center
                    y: center
            - type: divider
              style:
                .DividerStyle:
                  left: "0"
                  top: "0.25436"
                  width: "0.8"
                  height: "0.001"
                  backgroundColor: "0x00000088"
            - type: button
              onClick:
                - actionType: popUpDismiss
                  popUpView: confirmView
                - actionType: evalObject
                  object:
                    ..roomInfo.edge@: =..roomInfo.response.edge
                - actionType: evalObject
                  object:
                    - ..roomInfo.edge.tage@: 1
                # - actionType: evalObject
                #   object:
                #     .Global.rootRoomInfo.edge@: =..roomInfo.response.edge
                - actionType: evalObject
                  object: ..save
                # - actionType: builtIn
                #   funcName: disconnectMeeting #wangchen 11/20 2021 Keep Open Should not disconnect Meeting
                - actionType: evalObject
                  object:
                    - ..roomInfo.edge@: =.Global.VideoChatObjStore.reference.edge
                    - ..roomInfo.edge.name.duration@: =.Global.timer
                    - ..roomInfo.edge.refid@: ""
                - actionType: evalObject
                  object: ..save
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""
                - actionType: popUp
                  popUpView: minimizeVideoChat #wangchen 11/20 2021 Show minizevideochat before goto
                - goto: AppointmentHistory
                # - goto: VisitHistory
                # - goto:
                #     dataIn:
                #       destination: AppointmentHistory
              text: Keep Open
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.275"
                  width: "0.4"
                  height: "0.06812"
                  color: "0x2988e6ff"
                  fontSize: "17"
                  display: inline
                  textAlign:
                    x: center
                    y: center
                  border:
                    style: "5"
                  borderRadius: "15"

            - type: button
              onClick:
                - actionType: evalObject
                  object:
                    ..roomInfo.edge@: =..roomInfo.response.edge
                - actionType: evalObject
                  object:
                    - ..roomInfo.edge.tage@: 1
                    # - ..roomInfo.edge.name.duration@: =.Global.timer
                - actionType: evalObject
                  object: ..save
                - actionType: evalObject
                  object:
                    - ..roomInfo.edge@: =.Global.VideoChatObjStore.reference.edge
                    - ..roomInfo.edge.refid@: =.EmptyObj
                    - ..roomInfo.edge.tage@: -1
                - actionType: builtIn
                  funcName: disconnectMeeting
                - actionType: evalObject
                  object: ..save
                - actionType: evalObject
                  object:
                    - .Global.rootRoomInfo.edge@: =..roomInfo.response.edge
                    # - .Global.DocChat.document.id@: =.EmptyObj
                    - .Global.timer@: 0
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""
                - goto: VisitDetial
              text: Close Meeting
              style:
                .LabelStyle:
                  left: "0.4"
                  top: "0.275"
                  width: "0.4"
                  height: "0.06812"
                  color: "0x2988e6ff"
                  fontSize: "17"
                  display: inline
                  textAlign:
                    x: center
                    y: center
                  border:
                    style: "5"
                  borderRadius: "15"
            - type: divider
              style:
                .DividerStyle:
                  left: "0.4"
                  top: "0.26"
                  width: "0.001"
                  height: "0.07"
                  backgroundColor: "0x00000088"

    - type: view
      viewTag: selectView
      style:
        display: none
        top: "0.697"
        left: "0.5"
        fontSize: "0"
        zIndex: 10
      children:
        - type: list
          contentType: listObject
          listObject: ..popUpList
          iteratorVar: itemObject
          style:
            border:
              style: "3"
            borderColor: "0xDEDEDE"
            borderWidth: "1"
            borderRadius: "5"
            width: "0.45"
            overflow: hidden
          children:
            - type: listItem
              itemObject: ""
              style:
                width: "0.45"
                height: "0.054"
                # border:
                #   style: "2"
                # borderColor: "0x00000066"
                box-sizing: border-box
                backgroundColor: "0xffffff"
                # borderWidth: "1.5"
              children:
                - type: label
                  dataKey: itemObject.text
                  style:
                    width: "0.45"
                    height: "0.054"
                    fontWeight: "500"
                    textAlign:
                      x: center
                      y: center
                    fontSize: ".Nfont.h14"
                  onClick:
                    - actionType: evalObject
                      object:
                        .Global.rootRoomInfo.edge.name.duration@: =.Global.timer
                    - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                      dataKey: VideoChat.popUpListTemp
                      dataObject: itemObject
                    - actionType: popUp
                      popUpView: minimizeVideoChat #wangchen 11/20 2021 Show minizevideochat before goto
                    - actionType: builtIn
                      funcName: hide
                      viewTag: selectView
                    - actionType: evalObject
                      object:
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =.VideoChat.popUpListTemp.pageName
                                  string2: "ScreenShare"
                            - actionType: popUp
                              popUpView: underconstruction
                            - goto: .VideoChat.popUpListTemp.pageName
        - type: image
          path: triangleWhite.svg
          style:
            marginLeft: "0.345"
            width: "0.0347"
    # auto disconnect extension confirm view
    - type: popUp
      viewTag: exitWarningView
      global: true
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "1"
        zIndex: "50"
        textAlign:
          y: center
      leftButton:
        - actionType: popUpDismiss
          popUpView: exitWarningView
      onClick:
        - actionType: popUpDismiss
          popUpView: exitWarningView
      children:
        - type: view
          style:
            width: "0.72"
            marginLeft: "0.14"

            backgroundColor: "0xf4f3f3"
            borderRadius: "14px"
          children:
            - type: label
              text: "Virtual room time's up"
              style:
                width: "0.72"
                color: "0x333333"
                fontSize: .Nfont.h16
                marginTop: "0.0271"
                fontWeight: "600"
                textAlign:
                  x: center
                  y: center
            - type: label
              text: The appointment is about to end in 30 seconds. If you need further treatment, the provider can create a follow-up appointment.
              style:
                marginLeft: "0.069"
                width: "0.582"
                color: "#333333"
                fontSize: .Nfont.h14
                lineHeight: "2.58vh"
                marginTop: "0.0185"
            - type: label
              # text: "1:10"
              contentType: timerLabelPopUp
              viewTag: videoTimer
              text=func: =.builtIn.string.formatTimer
              #dataKey: Global.timer # to be remove after implemented builtIn
              style:
                marginLeft: "0.069"
                marginTop: "0.02"
                width: "0.582"
                color: "#333333"
                height: "0.03"
                fontSize: 2.5vh
                lineHeight: "2.58vh"
                textAlign:
                  x: center
                  y: center
            - type: view
              style:
                height: "0.035"
                border:
                  style: 2
                  color: "0x919192"
                borderWidth: "1"
                width: "0.72"
            - type: view
              style:
                width: "0.72"
              children:
                - type: button
                  text: "OK"
                  style:
                    color: "0x007AFF"
                    backgroundColor: "0xf4f3f3"
                    display: inline-block
                    width: "0.72"
                    borderRadius: "0 0 14px 14px"
                    fontSize: .Nfont.h14
                    height: "0.054"
                    border:
                      style: "1"
                  onClick: ____.leftButton
    # auto-disconnect when provider left the room
    # - type: popUp
    #   # viewTag: providerLeftWarningView
    #   global: true
    #   style:
    #     left: "0"
    #     top: "0"
    #     width: "1"
    #     height: "1"
    #     zIndex: 10
    #   children:
    #     - type: view
    #       style:
    #         left: "0.1"
    #         top: "0.325"
    #         width: "0.8"
    #         height: "0.35"
    #         backgroundColor: "0xeeeeeeff"
    #         border:
    #           style: "5"
    #         borderRadius: "15"
    #       children:
    #         - type: image
    #           onClick:
    #             - actionType: popUpDismiss
    #               popUpView: providerLeftWarningView
    #           path: cancel.svg
    #           style:
    #             .LabelStyle:
    #               left: "0.025"
    #               top: "0.01"
    #               width: "0.03"
    #               height: "0.03"
    #               color: "0x388eccff"
    #               fontSize: "15"
    #               display: inline
    #               textAlign:
    #                 x: center
    #                 y: center
    #               border:
    #                 style: "5"
    #               borderRadius: "15"
    #         - type: label
    #           text: "TIME'S UP..."
    #           style:
    #             .LabelStyle:
    #               left: "0.05"
    #               top: "0.02"
    #               width: "0.7"
    #               height: "0.04"
    #               color: "0x00000088"
    #               fontSize: "20"
    #               fontWeight: "500"
    #               display: inline
    #               textAlign:
    #                 x: center
    #                 y: center
    #         - type: label
    #           text: "The proider has left the chat. Please schedule a follow up appointment if you need further treatment."
    #           style:
    #             left: "0.05"
    #             top: "0.11"
    #             width: "0.7"
    #             height: "0.05"
    #             color: "0x00000088"
    #             fontSize: .Nfont.h16
    #             textAlign:
    #               x: center
    #               y: center
    #         - type: label
    #           #text: "1:10"
    #           contentType: timerLabelPopUp1
    #           viewTag: videoTimer
    #           text=func: =.builtIn.string.formatTimer
    #           #dataKey: Global.timer # to be remove after implemented builtIn
    #           style:
    #             left: "0.05"
    #             top: "0.18"
    #             width: "0.7"
    #             height: "0.03"
    #             color: "0x00000088"
    #             fontSize: .Nfont.h16
    #             textAlign:
    #               x: center
    #               y: center
    #         - type: divider
    #           style:
    #             .DividerStyle:
    #               left: "0"
    #               top: "0.25436"
    #               width: "0.8"
    #               height: "0.001"
    #               backgroundColor: "0x00000088"
    #         - type: button
    #           onClick:
    #             # dismiss the popup
    #             - actionType: popUpDismiss
    #               popUpView: providerLeftWarningView
    #             - actionType: builtIn
    #               funcName: disconnectMeeting
    #             # clear roomDoc
    #             - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
    #               dataKey: Global.roomInfoDoc.document
    #               dataObject: {}
    #             - actionType: evalObject
    #               object:
    #                 - .Global.timer@: 0
    #                 - .Global.micOn@: "true"
    #                 - .Global.cameraOn@: "true"
    #             - goto: VisitDetial
    #           text: OK
    #           style:
    #             .LabelStyle:
    #               left: "0.2"
    #               top: "0.275"
    #               width: "0.4"
    #               height: "0.06812"
    #               color: "0x2988e6ff"
    #               fontSize: "17"
    #               display: inline
    #               textAlign:
    #                 x: center
    #                 y: center
    #               border:
    #                 style: "5"
    #               borderRadius: "15"
    #auto-disconnect when time is over
    - type: popUp
      viewTag: timeIsOver
      global: true
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "1"
        zIndex: "50"
        textAlign:
          y: center
      leftButton:
        - actionType: popUpDismiss
          popUpView: timeIsOver
        - goto: VisitDetial
      children:
        - type: view
          style:
            width: "0.72"
            marginLeft: "0.14"

            backgroundColor: "0xf4f3f3"
            borderRadius: "14px"
          children:
            - type: label
              text: The provider has left the chat.
              style:
                marginLeft: "0.069"
                width: "0.582"
                color: "#333333"
                fontSize: .Nfont.h14
                lineHeight: "2.58vh"
                marginTop: "0.0185"
            - type: view
              style:
                height: "0.035"
                border:
                  style: 2
                  color: "0x919192"
                borderWidth: "1"
                width: "0.72"
            - type: view
              style:
                width: "0.72"
              children:
                - type: button
                  text: "OK"
                  style:
                    color: "0x007AFF"
                    backgroundColor: "0xf4f3f3"
                    display: inline-block
                    width: "0.72"
                    borderRadius: "0 0 14px 14px"
                    fontSize: .Nfont.h14
                    height: "0.054"
                    border:
                      style: "1"
                  onClick: ____.leftButton
    - .Normal:
      viewTag: timeoutPopup
      message: "This connection took longer than usual, please check your network connection and re-enter the room."
      leftText: "Retry"
      rightText: "Go Back"
      leftButton:
        - actionType: refresh
        - actionType: popUpDismiss
          popUpView: timeoutPopup
      rightButton:
        - actionType: builtIn
          funcName: goBack
          reload: true
        - actionType: popUpDismiss
          popUpView: timeoutPopup
