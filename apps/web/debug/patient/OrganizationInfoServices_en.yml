OrganizationInfoServices: 
  title: Organization Info
  # pageNumber:
  init: 
    - .SignInCheck

    - ..facility.vertexAPI.get
    - ..locationsProfile.docAPI.get
    - ..roomsProfile.docAPI.get

  # 获取facilityInfo
    - ..facilityInfo.vertexAPI.get
    #使用formData.roomList存储当前location的room信息,便于后面对数据的展示与重置
    - .OrganizationInfoServices.formData.roomList@: =..roomsProfile.docResp.doc
    #获取当前facility第一个location的medicalFacilityName
    - .OrganizationInfoServices.formData.location@: =..locationsProfile.docResp.doc.0.name.data.allLocation.0.medicalFacilityName
    #获取当前facility所有location的medicalFacilityName
    - actionType: evalObject
      object:
        - =.builtIn.object.extract:
            dataIn:
              array: =..locationsProfile.docResp.doc.0.name.data.allLocation
              field: medicalFacilityName
            dataOut: OrganizationInfoServices.formData.locations

  formData:
    locationID: "" #存储当前location的ID
    locations: "" #存储所有location的medicalFacilityName
    location: "" #存储当前location的medicalFacilityName
    roomList: "" #存储当前location所有的room

  # 查询facilityInfo
  facilityInfo:
    vertex: 
      ObjType: "4"
      id: .Global.currentFacility.bsig
      xfname: "E.bvid"
      type: 271361
      sCondition: "E.type=10000"
      _nonce: =.Global._nonce
    facilityInfoResp: ""
    vertexAPI:
      get: 
        api: rd
        dataIn: OrganizationInfoServices.facilityInfo.vertex
        dataOut: OrganizationInfoServices.facilityInfo.facilityInfoResp

  #获取当前的facility
  facility:
    vertexResp: ""
    vertex:
      ObjType: 4
      id: .Global.currentFacility.bsig
      xfname: "E.bvid"
      sCondition: "E.type=1100 AND V.type!=1 AND V.type!=21"
      maxcount: "100"
      obfname: "ctime"
      asc: true
      _nonce: =.Global._nonce
    vertexAPI:
      get:
        api: rv
        dataIn: OrganizationInfoServices.facility.vertex
        dataOut: OrganizationInfoServices.facility.vertexResp

  #获取当前facility下所有location的信息
  locationsProfile:
    docResp: ""
    doc:
      ObjType: 12
      id: .OrganizationInfoServices.facility.vertexResp.vertex.0.id
      xfname: "E.bvid"
      sCondition: "E.type=1100 AND D.type=38401"
      maxcount: "1"
      obfname: "ctime"
      _nonce: =.Global._nonce
    docAPI:
      get:
        api: rd
        dataIn: OrganizationInfoServices.locationsProfile.doc
        dataOut: OrganizationInfoServices.locationsProfile.docResp
        subtype:
          mediaType: ""

  #获取当前location下所有room的信息
  roomsProfile:
    docResp: 
      doc: []
    doc:
      ObjType: 12
      type: "273921"
      id: .OrganizationInfoServices.locationsProfile.docResp.doc.0.name.data.allLocation.0.id
      xfname: "E.bvid"
      sCondition: "E.type=1100 AND E.tage>=0"
      maxcount: "1000"
      obfname: "ctime"
      _nonce: =.Global._nonce
    docAPI:
      get:
        api: rd
        dataIn: OrganizationInfoServices.roomsProfile.doc
        dataOut: OrganizationInfoServices.roomsProfile.docResp
        subtype:
          mediaType: ""

  components: 
    - .BaseHeader:
    - .HeaderLeftButton:
      onClick: 
        - actionType: builtIn
          funcName: goBack
    - type: view
      style:
        left: "0"
        width: "1"
        top: "0.1"
        height: "0.9"
      children: 
        - type: view
          style: 
            left: "0"
            width: "1"
            top: "0"
            height: "0.26"
            border: 
              style: "2"
            borderWidth: "3"
            borderColor: "0xdededf"
          children: 
            # Facility 头像
            - type: image
              style:                               
                top: "0.03"
                width: "0.1"
                left: "0.45"
              path: office-building.svg
              path=func: =.builtIn.utils.prepareDocToPath
              dataKey: facilityInfo.facilityInfoResp.doc.0.name.data.basicInfo.businessLogo              
              viewTag: businessLogo
              contentType: file
            # 二维码
            - type: image
              path: qr.svg
              style: 
                left: "0.85"
                width: "0.08"
                top: "0.03"
              # Facility 名称
            - type: label
              dataKey: OrganizationInfoServices.facility.vertexResp.vertex.0.name.basicInfo.medicalFacilityName
              text: A&C Urgent Care
              style:
                left: "0"
                width: "1"
                top: "0.09"
                height: "0.04"
                fontSize: .Nfont.h4
                color: "0x4b4b4b"
                textAlign: 
                  x: center
                fontWeight: "600"
            - type: label
              dataKey: OrganizationInfoServices.facility.vertexResp.vertex.0.name.basicInfo.state
              text: Anaheim
              style:
                left: "0"
                width: "1"
                top: "0.13"
                height: "0.025"
                fontSize: .Nfont.h1
                color: "0x4b4b4b"
                fontWeight: "600"
                textAlign: 
                  x: center
            - type: view
              onClick: 
                - goto: InboxDashboard
              style:
                width: "1"
                left: "0"
                height: "0.1"
                top: "0.16"
              children:
                - type: image
                  path: mailIcon.svg
                  style:
                    left: "0.425"
                    width: "0.15"
                - type: label
                  text: AiTmail
                  style:
                    left: "0.425"
                    width: "0.15"
                    top: "0.06"
                    fontSize: .Nfont.h15
                    color: "0x4b4b4b"
                    textAlign:
                      x: center
        - type: view
          style: 
            top: "0.265"  
            width: '1'
            left: "0"
            height: "0.635"
          children:      
            - type: view
              style: 
                left: "0"
                width: "1"
                top: "0"
                height: "0.05"
                border: 
                  style: "2"
                borderWidth: "1"
                borderColor: "0xdededf"
              children: 
                - type: label
                  text: About
                  onClick: 
                    - goto: OrganizationInfoAbout           
                  style: 
                    left: "0.13"
                    width: "0.24"
                    top: "0.01"
                    height: "0.039"
                    fontSize: .Nfont.h2
                    color: "0x2988e6"
                    textAlign: 
                      x: center
                      y: center
                - type: label
                  text: Providers
                  onClick:
                    - goto: OrganizationInfoProviders
                  style: 
                    left: "0.38"
                    width: "0.24"
                    top: "0.01"
                    height: "0.039"
                    fontSize: .Nfont.h2
                    color: "0x2988e6"
                    textAlign: 
                      x: center
                      y: center 
                - type: label
                  text: Services
                  onClick: 
                    - goto:  
                  style: 
                    left: "0.63"
                    width: "0.24"
                    top: "0.01"
                    height: "0.039"
                    fontSize: .Nfont.h2
                    fontWeight: "600"
                    color: "0x2988e6"
                    border: 
                      style: "2"
                    borderWidth: "3"
                    borderColor: "0x2988e6"
                    textAlign: 
                      x: center
                      y: center
            - type: select
              dataKey: formData.location
              options:
                ..formData.locations
              style:
                top: "0.06"
                width: "0.8"
                left: "0.1"
                height: "0.04"
                fontSize: "12"
                borderWidth: "1"
                backgroundColor: "0xf8f9f9"
                border:
                  style: "3"
                borderColor: "0xdededf" 
              onChange:
                - actionType: evalObject
                  object: 
                    .Global._nonce@: 
                      =.builtIn.math.random: ""
                - actionType: evalObject  
                  object:
                    - ..roomsProfile.docResp.doc@: []
                    - ..formData.roomList@: ""
                    #当location下medicalFacilityName与value相等时提取当前location的ID
                    - =.builtIn.array.matchInArray:
                        dataIn:
                          arr: =..locationsProfile.docResp.doc.0.name.data.allLocation
                          value: =..formData.location
                          key: medicalFacilityName
                          key1: "id"
                        dataOut: OrganizationInfoServices.formData.locationID
                    - .OrganizationInfoServices.roomsProfile.doc.id@: =..formData.locationID   
                    - =..roomsProfile.docAPI.get: "" 
                    - .OrganizationInfoServices.formData.roomList@: =..roomsProfile.docResp.doc
                - actionType: builtIn
                  funcName: redraw
                  viewTag: roomlist

            - type: scrollView
              style: 
                left: "0"
                width: '1'
                top: "0.1"
                height: "0.52"
                overflow: scroll
              children:
                - type: list
                  contentType: listObject
                  listObject: ..formData.roomList
                  iteratorVar: itemObject
                  viewTag: roomlist
                  style:
                    width: '1'
                    top: "0"
                    left: "0"
                    margin: '0'
                    height: auto
                  children:
                    - type: listItem
                      itemObject: ""
                      style:
                        width: '1'
                        height: '0.08'
                        left: '0'
                        border: 
                          style: "2"
                        borderWidth: "1"
                        borderColor: "0xdededf"
                      children:
                        - type: image
                          path: medicalBox.svg
                          style:
                            top: "0.0175"
                            left: "0.08"
                            height: "0.045"
                            width: "0.1"
                            border:
                              style: "1"
                            textAlign:
                              x: center
                              y: center
                            zIndex: 100
                        - type: label
                          dataKey: itemObject.name.data.service
                          style:
                            left: "0.23"
                            height: '0.03'
                            top: "0.01"
                            textAlign:
                              y: center
                            width: "0.7"
                            fontSize: .Nfont.h2
                            zIndex: 100
                        - type: label
                          dataKey: itemObject.name.data.roomName
                          style:
                            left: "0.23"
                            height: '0.03'
                            top: "0.045"
                            textAlign:
                              y: center
                            width: "0.7"
                            fontSize: .Nfont.h1
                            zIndex: 100