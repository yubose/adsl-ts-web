OrderConfirmation:
  title: Order Confirmation
  pageNumber:
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    # 查回默认购物地址
    - =..apiRequest.shopAddress.docAPI.get: ""
    - if:
        #  判断是否跳转到square页面进行付款过并返回该页面
        - =.Global.formData.commerceOrder.havePay
        - actionType: evalObject
          object:
            # 拿回3001
            - =..apiRequest.commerceCheckOrder.docAPI.get: ""
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =..apiRequest.commerceCheckOrder.docQueryResp.doc.0.deat.state
                      string2: "COMPLETED"
                - ..formData.display.success@: "block"
                - ..formData.display.success@: "none"
            - ..apiRequest.commerceCheckOrder.docCreateReq@: =..apiRequest.commerceCheckOrder.docQueryResp.doc.0
        - ..formData.display.success@: "none"
    # 初始化订单信息
    - =.builtIn.math.toFixedNum:
        dataIn:
          num: =.Global.formData.production.name.data.shipping.fourHourPriceShipping
        dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCost
    - if:
        - =.Global.formData.commerceOrder.paymentInfo.isUpdated
        - actionType: evalObject
          object:
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type@: =.Global.formData.commerceOrder.paymentInfo.deliveryMethod
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingTime@: =.Global.formData.commerceOrder.paymentInfo.shippingTime
        - continue
    # 判断是否从购物车页面进入
    - if:
        - =.Global.formData.whetherShoppingCart
        - actionType: evalObject
          object:
            - ..formData.display.multiOrder@: block
            - ..formData.display.singleOrder@: none
            - =..apiRequest.orderInshoppingCart.docAPI.get: ""
            - =.builtIn.object.extract:
                dataIn:
                  array: =..apiRequest.orderInshoppingCart.docQueryResp.doc
                  field: name.data.orderList
                dataOut: OrderConfirmation.formData.shoppingCart
            - =.builtIn.array.mergeAttributes:
                dataIn:
                  arr: =..formData.shoppingCart
                  path: inventorName
                dataOut: OrderConfirmation.formData.shoppingCart
            - =.builtIn.object.extract:
                dataIn:
                  array: =..formData.shoppingCart
                  field: productionList.0.shipping.isPhysicalProduct
                dataOut: OrderConfirmation.formData.isPhysicalProduct
            - =.builtIn.object.extract:
                dataIn:
                  array: =..formData.shoppingCart
                  field: productionList.0.shipping.isPickUp
                dataOut: OrderConfirmation.formData.isPickUp
            - ..apiRequest.appointment.edgeQueryReq.id@: =..formData.shoppingCart.0.productionList.0.appointmentId
            - =..apiRequest.appointment.edgeAPI.get: ""
            - .Global.roomInfo.edge@: =..apiRequest.appointment.edgeQueryResp.edge.0
            - .Global.currentRoomInfo.edge@: =..apiRequest.appointment.edgeQueryResp.edge.0
            # 求出pickup数组
            - =.builtIn.object.extract:
                dataIn:
                  array: =..formData.shoppingCart
                  field: productionList
                dataOut: OrderConfirmation.formData.productionList
            - =.builtIn.array.flatArray:
                dataIn:
                  param: =..formData.productionList
                dataOut: OrderConfirmation.formData.productionList
            - =.builtIn.array.requireValues:
                dataIn:
                  arr: =..formData.productionList
                  params: ["title", "pickUpLocation"]
                dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.pickupLocation
            # 求出所有产品中最高的shopping cost
            - =.builtIn.object.extract:
                dataIn:
                  array: =..formData.productionList
                  field: shipping.fourHourPriceShipping
                dataOut: OrderConfirmation.formData.fourHourPriceShippingList
            - =.builtIn.object.extract:
                dataIn:
                  array: =..formData.productionList
                  field: shipping.twentyFourHourPriceShipping
                dataOut: OrderConfirmation.formData.twentyFourHourPriceShippingList
            - =.builtIn.object.extract:
                dataIn:
                  array: =..formData.productionList
                  field: shipping.threeDaysPriceShipping
                dataOut: OrderConfirmation.formData.threeDaysPriceShippingList
            - =.builtIn.object.extract:
                dataIn:
                  array: =..formData.productionList
                  field: shipping.oneWeekPriceShipping
                dataOut: OrderConfirmation.formData.oneWeekPriceShipping

            - =.builtIn.math.maxFun:
                dataIn:
                  arrNum: =..formData.twentyFourHourPriceShippingList
                dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCostTemp.twentyFourHours
            - =.builtIn.math.maxFun:
                dataIn:
                  arrNum: =..formData.threeDaysPriceShippingList
                dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCostTemp.threeDays
            - =.builtIn.math.maxFun:
                dataIn:
                  arrNum: =..formData.oneWeekPriceShipping
                dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCostTemp.oneWeeks
            # 计算总数量
            - =.builtIn.object.extract:
                dataIn:
                  array: =..formData.productionList
                  field: "num"
                dataOut: OrderConfirmation.formData.numList
            - =.builtIn.utils.addArrayValue:
                dataIn:
                  array: =..formData.numList
                dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq.name.quantity
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.quantity@: =..apiRequest.shopOrder.edgeCreateReq.name.quantity
            # 计算总价格
            - =.builtIn.object.extract:
                dataIn:
                  array: =..formData.productionList
                  field: "totalMoney"
                dataOut: OrderConfirmation.formData.totalPriceList
            - =.builtIn.utils.addArrayValue:
                dataIn:
                  array: =..formData.totalPriceList
                dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq.name.amount
            - =.builtIn.math.toFixedNum:
                dataIn:
                  num: =..apiRequest.shopOrder.edgeCreateReq.name.amount
                dataOut: OrderConfirmation.formData.totalMoney
            - =.builtIn.array.getByKey:
                dataIn:
                  array: =..formDataTemp.timeTemp
                  key1: key
                  value: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingTime
                  key2: value2
                dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCost
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type
                      string2: "Pick up"
                - ..apiRequest.shopOrder.edgeCreateReq.name.amount@: =..formData.totalMoney
                - =.builtIn.number.addition:
                    dataIn:
                      num: =..formData.totalMoney
                      step: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCost
                    dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq.name.amount
            - =.builtIn.math.toFixedNum:
                dataIn:
                  num: =..apiRequest.shopOrder.edgeCreateReq.name.amount
                dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq.name.amount
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.amount@: =..apiRequest.shopOrder.edgeCreateReq.name.amount
            - ..formData.pickupLocation.pickUpLocation@: =.Global.formData.production.name.data.shipping.pickUpLocation.fullAddress
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.pickupLocation@: []
            - =.builtIn.array.pushAny:
                dataIn:
                  newMessage: =..formData.pickupLocation
                  messages: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.pickupLocation
                dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.pickupLocation
        - actionType: evalObject
          object:
            # 根据superadmin选择的method来更改样式
            # 1.ship,pick up两种都有
            # 2.只有ship
            # 3.只有pick up
            - if:
                - =.builtIn.string.judgeAllTrue:
                    dataIn:
                      str1: =.Global.formData.production.name.data.shipping.isPhysicalProduct
                      str2: =.Global.formData.production.name.data.shipping.isPickUp
                      str3: true
                - actionType: evalObject
                  object:
                    - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type@: Ship
                    - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingTime@: "24 hours"
                    - ..formDataTemp.deliveryTemp@:
                        - key: type
                          value: Ship
                          display: "block"
                        - key: type
                          value: Pick up
                          display: "block"
                - actionType: evalObject
                  object:
                    # 只有ship
                    - if:
                        - =.Global.formData.production.name.data.shipping.isPhysicalProduct
                        - actionType: evalObject
                          object:
                            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type@: Ship
                            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingTime@: "24 hours"
                            - ..formDataTemp.deliveryTemp@:
                                - key: type
                                  value: Ship
                                  display: "block"
                        - continue
                    # 只有pick up
                    - if:
                        - =.Global.formData.production.name.data.shipping.isPickUp
                        - actionType: evalObject
                          object:
                            - if:
                                - =.Global.formData.production.name.data.shipping.isPhysicalProduct
                                - continue
                                - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type@: Pick up
                            - ..formDataTemp.deliveryTemp@:
                                - key: type
                                  value: Pick up
                                  display: "block"
                        - continue
            # 判断deliveryTemp的数量
            - if:
                - =.builtIn.array.judgeListLength:
                    dataIn:
                      array: =..formDataTemp.deliveryTemp
                      len: 1
                - actionType: evalObject
                  object:
                    - ..formData.singleType@: "block"
                    - ..formData.multipleType@: "none"
                - actionType: evalObject
                  object:
                    - ..formData.singleType@: "none"
                    - ..formData.multipleType@: "block"
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCostTemp.twentyFourHours@: =.Global.formData.production.name.data.shipping.twentyFourHourPriceShipping
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCostTemp.threeDays@: =.Global.formData.production.name.data.shipping.threeDaysPriceShipping
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCostTemp.oneWeeks@: =.Global.formData.production.name.data.shipping.oneWeekPriceShipping
            - ..formData.totalMoney@: =.Global.formData.orderDetail.productionList.0.totalMoney
            - ..formData.pickupLocation.pickUpLocation@: =.Global.formData.production.name.data.shipping.pickUpLocation.fullAddress
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.pickupLocation@: []
            - =.builtIn.array.pushAny:
                dataIn:
                  newMessage: =..formData.pickupLocation
                  messages: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.pickupLocation
                dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.pickupLocation
            - =.builtIn.array.getByKey:
                dataIn:
                  array: =..formDataTemp.timeTemp
                  key1: key
                  value: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingTime
                  key2: value2
                dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCost
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type
                      string2: "Pick up"
                - ..apiRequest.shopOrder.edgeCreateReq.name.amount@: =..formData.totalMoney
                - =.builtIn.number.addition:
                    dataIn:
                      num: =..formData.totalMoney
                      step: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCost
                    dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq.name.amount
            - =.builtIn.math.toFixedNum:
                dataIn:
                  num: =..apiRequest.shopOrder.edgeCreateReq.name.amount
                dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq.name.amount
            - ..apiRequest.shopOrder.edgeCreateReq.name.quantity@: =.Global.formData.orderDetail.productionList.0.num
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.quantity@: =..apiRequest.shopOrder.edgeCreateReq.name.quantity
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.amount@: =..apiRequest.shopOrder.edgeCreateReq.name.amount
            - ..formData.display.multiOrder@: none
            - ..formData.display.singleOrder@: block
            - =.builtIn.array.pushAny:
                dataIn:
                  newMessage: =.Global.formData.orderDetail
                  messages: =..apiRequest.order.docCreateReq.name.data.orderList
                dataOut: OrderConfirmation.apiRequest.order.docCreateReq.name.data.orderList
    # 自动代入地址
    # 如果是切出去选择的地址，则将选中的地址代入,否则判断是否有默认地址，有的话就代入默认地址
    - if:
        - =.Global.formData.selectAddress.id
        - actionType: evalObject
          object:
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.contactInfomation.name@: =.Global.formData.selectAddress.name.data.userName
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.contactInfomation.phone@: =.Global.formData.selectAddress.name.data.phone.fullPhone
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.contactInfomation.email@: =.Global.formData.selectAddress.name.data.email
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.contactInfomation.address@: =.Global.formData.selectAddress.name.data.address.fullAddress
            - ..formData.display.contactInfomation@: block
        - actionType: evalObject
          object:
            - if:
                - =.builtIn.array.judgeListLength:
                    dataIn:
                      array: =..apiRequest.shopAddress.docQueryResp.doc
                      len: 0
                - ..formData.display.contactInfomation@: none
                - actionType: evalObject
                  object:
                    - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.contactInfomation.name@: =..apiRequest.shopAddress.docQueryResp.doc.0.name.data.userName
                    - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.contactInfomation.phone@: =..apiRequest.shopAddress.docQueryResp.doc.0.name.data.phone.fullPhone
                    - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.contactInfomation.email@: =..apiRequest.shopAddress.docQueryResp.doc.0.name.data.email
                    - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.contactInfomation.address@: =..apiRequest.shopAddress.docQueryResp.doc.0.name.data.address.fullAddress
                    - ..formData.display.contactInfomation@: block

    # 如果delivery method值为Pick up，则隐藏Shipping Address
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type
              string2: "Pick up"
        - actionType: evalObject
          object:
            - ..formData.display.allContactInformaton@: none
            # 如果有多个pick up location，则展示列表，否则展示单个location
            - if:
                - =.builtIn.array.judgeListLength:
                    dataIn:
                      array: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.pickupLocation
                      len: 1
                - actionType: evalObject
                  object:
                    - ..formData.display.singlePickUpLocation@: block
                    - ..formData.display.mutilPickUpLocation@: none
                    - ..formData.display.ship@: none
                    - ..formData.display.pickUp@: block
                - actionType: evalObject
                  object:
                    - ..formData.display.singlePickUpLocation@: none
                    - ..formData.display.mutilPickUpLocation@: block
                    - ..formData.display.ship@: none
                    - ..formData.display.pickUp@: block
        - actionType: evalObject
          object:
            - ..formData.display.allContactInformaton@: block
            - ..formData.display.singlePickUpLocation@: none
            - ..formData.display.mutilPickUpLocation@: none
    # 查回provider和patient之间的10002
    - =.builtIn.array.pushAny:
        dataIn:
          newMessage: =.Global.currentRoomInfo.edge.name.providerId
          messages: =..apiRequest.relation.edgeQueryReq.id
        dataOut: OrderConfirmation.apiRequest.relation.edgeQueryReq.id
    - =..apiRequest.relation.edgeAPI.get: ""
    - ..apiRequest.email.docCreateReq.eid@: =..apiRequest.relation.edgeQueryResp.edge.0.id
  formData:
    # 控制单一类型展示
    singleType: "none"
    # 控制多种类型展示
    multipleType: "block"
    isPhysicalProduct: []
    isPickUp: []
    pickupLocation:
      pickUpLocation: ""
    fourHourPriceShippingList: []
    twentyFourHourPriceShippingList: []
    threeDaysPriceShippingList: []
    oneWeekPriceShipping: []
    productionList: []
    totalMoney: ""
    totalPriceList: []
    numList: []
    shoppingCart: []
    display:
      # 展示单个产品的pick up location
      singlePickUpLocation: none
      # 展示多个产品的pick up location列表
      mutilPickUpLocation: none
      success: "none"
      singleOrder: block
      multiOrder: none
      contactInfomation: none
      ship: block
      pickUp: none
      allContactInformaton: none
    currentId: ""
    currentSecondList: []
    addressType: "Set as billing address"
    currentAddress: "none"
    billAddressShow: "none"
  formDataTemp:
    deliveryTemp:
      - key: type
        value: Ship
        display: "block"
      - key: type
        value: Pick up
        display: "block"

    timeTemp:
      # - key: "4 hours"
      #   value1: "4 hours/$"
      #   value2: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCostTemp.fourHours
      - key: "24 hours"
        value1: "24 hours/$"
        value2: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCostTemp.twentyFourHours
      - key: "3 days"
        value1: "3 days/$"
        value2: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCostTemp.threeDays
      - key: "1 weeks"
        value1: "1 weeks/$"
        value2: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCostTemp.oneWeeks
    addressTemp:
      - key: addressType
        value: Set as billing address
        display: "none"
      - key: addressType
        value: Select other address
        display: "block"
  apiRequest:
    appointment:
      edgeQueryResp: ""
      edgeQueryReq:
        id: ""
        _nonce: .Global._nonce
      edgeAPI:
        get:
          api: re
          dataIn: OrderConfirmation.apiRequest.appointment.edgeQueryReq
          dataOut: OrderConfirmation.apiRequest.appointment.edgeQueryResp
    relation:
      edgeQueryResp: ""
      edgeQueryReq:
        id:
          - .Global.currentUser.vertex.id
        xfname: (bvid,evid)|(evid,bvid)
        type: .EdgeType.Email
        obfname: mtime
        maxcount: 1
        _nonce: .Global._nonce
      edgeAPI:
        get:
          api: re
          dataIn: OrderConfirmation.apiRequest.relation.edgeQueryReq
          dataOut: OrderConfirmation.apiRequest.relation.edgeQueryResp
    email:
      docCreateResp: ""
      docCreateReq:
        #邮件类型，默认1281
        type: .DocType.InboxMessage
        #邮件所挂载的edge(10002)
        eid: ""
        tage: 2
        name:
          data:
            # 订单（2113）id
            orderId: ""
            #邮件内容
            content: "Hello,Thank you for shopping at AiTmed. Please allow us up to two business days to process your order. Below,  you can check the order details.If you have any questions regarding your order,  please contact A&C Urgentcare at +1 88888888."
            #收件人姓名
            receiverName: .Global.Profile.name.data.basicInfo.fullName
            #发送人姓名
            senderName: automatic-reply@aitmed.com
            #发件人头像的id,这里不给，默认是aitmed logo。
            senderAvatarId: ""
          #邮件标题
          title: "Order Confirmation"
          #收件人头像的id
          user: ""
          #数量
          nonce: ""
      docAPI:
        store:
          api: cd
          dataIn: OrderConfirmation.apiRequest.email.docCreateReq
          dataOut: OrderConfirmation.apiRequest.email.docCreateResp

    # 购物车中的商品
    orderInshoppingCart:
      docQueryResp: ""
      docQueryReq:
        id: .Global.formData.productionIdsSelectedInShoppingCart
        _nonce: .Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: OrderConfirmation.apiRequest.orderInshoppingCart.docQueryReq
          dataOut: OrderConfirmation.apiRequest.orderInshoppingCart.docQueryResp
    order:
      docQueryResp: ""
      docQueryReq:
        id: ""
        _nonce: .Global._nonce
      docCreateResp: ""
      docCreateReq:
        eid: .Global.currentRoomInfo.edge.id
        type: .DocType.Order
        name:
          title: ""
          data:
            orderList: []
      docAPI:
        get:
          api: rd
          dataIn: OrderConfirmation.apiRequest.order.docQueryReq
          dataOut: OrderConfirmation.apiRequest.order.docQueryResp
        store:
          api: cd
          dataIn: OrderConfirmation.apiRequest.order.docCreateReq
          dataOut: OrderConfirmation.apiRequest.order.docCreateResp
    shopAddress:
      docQueryResp:
        doc: []
      docQueryReq:
        id: .Global.Profile.name.data.shoppingAddressId
        _nonce: .Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: OrderConfirmation.apiRequest.shopAddress.docQueryReq
          dataOut: OrderConfirmation.apiRequest.shopAddress.docQueryResp
    shopOrder:
      edgeQueryResp: ""
      edgeQueryReq:
        id:
          - .Global.currentUser.vertex.id
          - .Config.superAdminID
        xfname: bvid,evid
        type: .EdgeType.Order
        _nonce: .Global._nonce
        obfname: mtime
        maxcount: 1
      edgeCreateResp: ""
      edgeCreateReq:
        bvid: .Global.currentUser.vertex.id
        evid: .Config.superAdminID
        type: .EdgeType.Order
        name:
          amount: ""
          currency: "USD"
          url: ""
          quantity: ""
          itemName: "appointment"
          note: "for testing"
      edgeAPI:
        store:
          api: ce
          dataIn: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq
          dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateResp
        get:
          api: re
          dataIn: OrderConfirmation.apiRequest.shopOrder.edgeQueryReq
          dataOut: OrderConfirmation.apiRequest.shopOrder.edgeQueryResp
    commerceCheckOrder:
      docQueryResp: ""
      docQueryReq:
        id: .Global.currentUser.vertex.id
        xfname: ovid
        type: .DocType.CommerceCheckOrder
        obfname: mtime
        maxcount: 1
        _nonce: .Global._nonce
      docCreateResp: ""
      docCreateReq:
        eid: ""
        type: .DocType.CommerceCheckOrder
        name:
          data:
            # 运费模版
            shippingCostTemp:
              fourHours: ""
              twentyFourHours: ""
              threeDays: ""
              oneWeeks: ""
            appointmentTime: ""
            serviceType: ""
            providerFullName: ""
            facilityName: ""
            totalMoney: ""
            customerName: .Global.Profile.name.data.basicInfo.fullName
            shippingTime: "24 hours"
            shippingCost: ""
            amount: ""
            quantity: ""
            deliveryMethod:
              type: "Ship"
              # 自提地址类型——single和multi
              category: ""
              pickupLocation: []
            contactInfomation:
              name: ""
              phone: ""
              email: ""
              address: ""
            orderStatus: Undelivered
            orderStatusColor: "#f88f00"
          title: ""
      docAPI:
        store:
          api: cd
          dataIn: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateReq
          dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateResp
        get:
          api: rd
          dataIn: OrderConfirmation.apiRequest.commerceCheckOrder.docQueryReq
          dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docQueryResp
  components:
    - .BasePublicHeader:
        children:
          - .BasePublicHeaderLeft:
            leftClick:
              - actionType: evalObject
                object:
                  - .Global.formData.commerceOrder.paymentInfo.isUpdated@: false
                  - .Global.formData.selectAddress@: ""
                  - .Global.formData.currentAddressStatus@: true
              - actionType: builtIn
                funcName: goBack
                reload: true
          - .BasePublicHeaderTitle:
    - type: scrollView
      style:
        ..style.scrollBox:
      children:
        # 订单区域
        - type: list
          viewTag: orderTag
          contentType: listObject
          listObject: ..apiRequest.order.docCreateReq.name.data.orderList
          iteratorVar: itemObject
          style:
            display: ..formData.display.singleOrder
            ..style.list:
          children:
            - type: listItem
              itemObject:
              style:
                ..style.listItem:
              children:
                - type: label
                  dataKey: itemObject.inventorName
                  style:
                    ..style.titleLabel:
                - type: list
                  contentType: listObject
                  listObject: itemObject.productionList
                  iteratorVar: itemObject
                  style:
                    ..style.secondList:
                  children:
                    - type: listItem
                      itemObject:
                      style:
                        ..style.secondListItem:
                      children:
                        - type: view
                          style:
                            ..style.blockBox:
                          children:
                            - type: image
                              path: good.svg
                              path=func: .builtIn.utils.prepareDocToPath
                              dataKey: itemObject.coverImgId
                              style:
                                ..style.productAvatar:
                                display: "inline-block"
                            - type: view
                              style:
                                ..style.topBox:
                              children:
                                - type: label
                                  dataKey: itemObject.title
                                  style:
                                    ..style.productTitle:
                                - type: label
                                  dataKey: itemObject.type
                                  style:
                                    color: itemObject.typeColor
                                    fontSize: .Nfont.h12
                                    width: "0.656"
                                    fontWeight: "600"
                                    verticalAlign: middle
                                    display: block
                                - type: view
                                  style:
                                    ..style.productInfoBox:
                                  children:
                                    - type: label
                                      dataKey: itemObject.productInfo
                                      style:
                                        ..style.productInfo:
                                    - type: view
                                      style:
                                        display: "inline-block"
                                        width: "0.283333"
                                        textAlign:
                                          x: right
                                      children:
                                        - type: view
                                          style:
                                            width: auto
                                            height: auto
                                          children:
                                            - type: label
                                              textBoard:
                                                - text: "x"
                                                - text: "0"
                                                  dataKey: itemObject.num
                                              style:
                                                ..style.productNum:
                                    # - type: view
                                    #   viewTag: numTag
                                    #   style:
                                    #     ..style.numBox:
                                    #   children:
                                    #     - type: button
                                    #       text: "—"
                                    #       style:
                                    #         ..style.reduceBox:
                                    #       onClick:
                                    #         - ..event.reduceClick
                                    #     - type: textField
                                    #       viewTag: inputTag
                                    #       contentType: phoneNumber
                                    #       dataKey: itemObject.num
                                    #       isEditable: "false"
                                    #       style:
                                    #         ..style.num:
                                    #     - type: button
                                    #       text: "+"
                                    #       onClick:
                                    #         - ..event.addClick
                                    #       style:
                                    #         ..style.addBox:
                        - type: view
                          style:
                            marginTop: "0.0160098"
                          children:
                            - type: label
                              text: Price
                              style:
                                ..style.priceLabel:
                            - type: label
                              text=func: .builtIn.string.dollarFormat
                              dataKey: itemObject.price
                              style:
                                ..style.priceValue:

        - type: list
          viewTag: orderTag
          contentType: listObject
          listObject: ..formData.shoppingCart
          iteratorVar: itemObject
          style:
            display: ..formData.display.multiOrder
            ..style.list:
          children:
            - type: listItem
              itemObject:
              style:
                ..style.listItem:
              children:
                - type: label
                  dataKey: itemObject.inventorName
                  style:
                    ..style.titleLabel:
                - type: list
                  contentType: listObject
                  listObject: itemObject.productionList
                  iteratorVar: itemObject
                  style:
                    ..style.secondList:
                  children:
                    - type: listItem
                      itemObject:
                      style:
                        ..style.secondListItem:
                      children:
                        - type: view
                          style:
                            ..style.blockBox:
                          children:
                            - type: image
                              path: good.svg
                              path=func: .builtIn.utils.prepareDocToPath
                              dataKey: itemObject.coverImgId
                              style:
                                ..style.productAvatar:
                                display: "inline-block"
                            - type: view
                              style:
                                ..style.topBox:
                              children:
                                - type: label
                                  dataKey: itemObject.title
                                  style:
                                    ..style.productTitle:
                                - type: label
                                  dataKey: itemObject.type
                                  style:
                                    color: itemObject.typeColor
                                    fontSize: .Nfont.h12
                                    width: "0.656"
                                    fontWeight: "600"
                                    verticalAlign: middle
                                    display: block
                                - type: view
                                  style:
                                    ..style.productInfoBox:
                                  children:
                                    - type: label
                                      dataKey: itemObject.productInfo
                                      style:
                                        ..style.productInfo:
                                    - type: view
                                      style:
                                        display: "inline-block"
                                        width: "0.283333"
                                        textAlign:
                                          x: right
                                      children:
                                        - type: view
                                          style:
                                            width: auto
                                            height: auto
                                          children:
                                            - type: label
                                              textBoard:
                                                - text: "x"
                                                - text: "0"
                                                  dataKey: itemObject.num
                                              style:
                                                ..style.productNum:
                                    # - type: view
                                    #   viewTag: numTag
                                    #   style:
                                    #     ..style.numBox:
                                    #   children:
                                    #     - type: button
                                    #       text: "—"
                                    #       style:
                                    #         ..style.reduceBox:
                                    #       onClick:
                                    #         - ..event.reduceClick
                                    #     - type: textField
                                    #       viewTag: inputTag
                                    #       contentType: phoneNumber
                                    #       dataKey: itemObject.num
                                    #       isEditable: "false"
                                    #       style:
                                    #         ..style.num:
                                    #     - type: button
                                    #       text: "+"
                                    #       onClick:
                                    #         - ..event.addClick
                                    #       style:
                                    #         ..style.addBox:
                        - type: view
                          style:
                            marginTop: "0.0160098"
                          children:
                            - type: label
                              text: Price
                              style:
                                ..style.priceLabel:
                            - type: label
                              text=func: .builtIn.string.dollarFormat
                              dataKey: itemObject.price
                              style:
                                ..style.priceValue:

        # 支付方式
        - type: view
          style:
            ..style.payBox:
          children:
            - type: view
              style:
                ..style.blockBox:
              children:
                - type: label
                  text: Payment method
                  style:
                    ..style.methodStyle:
                    width: "0.6"
                - type: image
                  path: selectOnBlue.svg
                  style:
                    ..style.checkPath:
                    marginLeft: "0.0453333"
                - type: label
                  text: Square
                  style:
                    ..style.methodLabel:

            - type: view
              style:
                ..style.blockBox:
                marginTop: "0.024630"
              children:
                - type: label
                  text: Delivery method
                  style:
                    ..style.methodStyle:
                    width: "0.45333333"
                - type: view
                  style:
                    ..style.deliveryBox:
                  children:
                    # 显示一种
                    - type: list
                      androidFlex: true
                      contentType: listObject
                      listObject: ..formDataTemp.deliveryTemp
                      iteratorVar: itemObject
                      style:
                        ..style.deliveryList:
                        marginLeft: "0.1893333"
                        axis: horizontal
                        display: ..formData.singleType
                      children:
                        - type: listItem
                          itemObject:
                          style:
                            ..style.deliveryListItem:
                          children:
                            - type: image
                              viewTag: radioDeliveryTag
                              path:
                                ..event.radioDeliveryPath:
                              style:
                                ..style.radioImg:
                            - type: label
                              dataKey: itemObject.value
                              style:
                                ..style.radioValue:
                    # 全部显示
                    - type: list
                      androidFlex: true
                      contentType: listObject
                      listObject: ..formDataTemp.deliveryTemp
                      iteratorVar: itemObject
                      style:
                        ..style.deliveryList:
                        axis: horizontal
                        display: ..formData.multipleType
                      children:
                        - type: listItem
                          itemObject:
                          style:
                            ..style.deliveryListItem:
                          children:
                            - type: image
                              viewTag: radioDeliveryTag
                              path:
                                ..event.radioDeliveryPath:
                              style:
                                ..style.radioImg:
                              onClick:
                                - ..event.radioDeliveryClick
                            - type: label
                              dataKey: itemObject.value
                              style:
                                ..style.radioValue:
            - type: view
              viewTag: shipTag
              style:
                ..style.blockBox:
                marginTop: "0.028325"
                display: ..formData.display.ship
              children:
                - type: label
                  text: Time
                  style:
                    ..style.timeLabel:
                - type: list
                  androidFlex: true
                  contentType: listObject
                  listObject: ..formDataTemp.timeTemp
                  iteratorVar: itemObject
                  style:
                    ..style.timeList:
                  children:
                    - type: listItem
                      itemObject:
                      style:
                        ..style.timeListItem:
                      children:
                        - type: image
                          viewTag: radioTimeTag
                          path:
                            ..event.radioTimePath:
                          style:
                            ..style.radioImg:
                            marginTop: "0.018472"
                          onClick:
                            - ..event.radioTimeClick
                        - type: label
                          textBoard:
                            - text: ""
                              dataKey: itemObject.value1
                            - text: "&nbsp;"
                            - text: ""
                              dataKey: itemObject.value2
                          style:
                            ..style.radioValue:
                            marginTop: "0.018472"
            - type: view
              viewTag: pickUpTag
              style:
                ..style.blockBox:
                marginTop: "0.028325"
                display: ..formData.display.pickUp
              children:
                - type: label
                  text: Pick up location
                  style:
                    ..style.timeLabel:
                - type: label
                  dataKey: apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.pickupLocation.0.pickUpLocation
                  style:
                    display: ..formData.display.singlePickUpLocation
                    ..style.addressLabel:
                - type: list
                  contentType: listObject
                  listObject: ..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.pickupLocation
                  iteratorVar: itemObject
                  style:
                    display: ..formData.display.mutilPickUpLocation
                    width: "1"
                    margin: "0"
                    height: auto
                  children:
                    - type: listItem
                      itemObject:
                      style:
                        width: "1"
                        height: "auto"
                        left: "0"
                        marginTop: "0"
                      children:
                        - type: label
                          textBoard:
                            - text: "&#8226 &nbsp;&nbsp;"
                            - text: ""
                              dataKey: itemObject.title
                          style:
                            ..style.pickUpLoactionListTitle:
                        - type: label
                          dataKey: itemObject.pickUpLocation
                          style:
                            ..style.pickUpLoactionListContent:

        # 地址区域
        - type: view
          viewTag: allContactInformaton
          style:
            ..style.payBox:
            display: ..formData.display.allContactInformaton
          children:
            - type: label
              text: Contact Information
              style:
                ..style.contactLable:
            - type: view
              style:
                ..style.blockSecondBox:
                marginTop: "0.0221674"
              children:
                - type: label
                  text: Shipping Address
                  style:
                    ..style.rightLabel:
                - type: label
                  text: Select
                  style:
                    ..style.selectLabel:
                  onClick:
                    - ..event.shippAddressClick
                - type: image
                  path: rightEnter.svg
                  style:
                    ..style.selectImg:
            - type: view
              style:
                ..style.blockSecondBox:
                display: ..formData.display.contactInfomation
              children:
                - type: view
                  style:
                    ..style.deliveryList:
                  children:
                    - type: label
                      text: Name
                      style:
                        ..style.rigthTitle:
                    - type: label
                      dataKey: apiRequest.commerceCheckOrder.docCreateReq.name.data.contactInfomation.name
                      style:
                        ..style.leftValue:
                - type: view
                  style:
                    ..style.deliveryList:
                    marginTop: "0.01"
                  children:
                    - type: label
                      text: "Phone#"
                      style:
                        ..style.rigthTitle:
                    - type: label
                      dataKey: apiRequest.commerceCheckOrder.docCreateReq.name.data.contactInfomation.phone
                      style:
                        ..style.leftValue:
                - type: view
                  style:
                    ..style.deliveryList:
                    marginTop: "0.01"
                  children:
                    - type: label
                      text: "Email"
                      style:
                        ..style.rigthTitle:
                    - type: label
                      dataKey: apiRequest.commerceCheckOrder.docCreateReq.name.data.contactInfomation.email
                      style:
                        ..style.leftValue:
                - type: view
                  style:
                    ..style.deliveryList:
                    marginTop: "0.01"
                  children:
                    - type: label
                      text: "Address"
                      style:
                        ..style.rigthTitle:
                        display: "block"
                    - type: label
                      dataKey: apiRequest.commerceCheckOrder.docCreateReq.name.data.contactInfomation.address
                      style:
                        ..style.addressLabel:
                        marginTop: "0.01"
        - type: view
          style:
            marginTop: "0.03"
    - type: view
      style:
        width: "auto"
        height: "auto"
      children:
        - type: view
          style:
            ..style.btnBox:
          children:
            - type: label
              viewTag: displayTotalMoney
              text=func: .builtIn.string.dollarFormat
              dataKey: apiRequest.shopOrder.edgeCreateReq.name.amount
              style:
                ..style.payValue:
            - type: button
              text: Pay now
              style:
                ..style.payBtn:
              onClick:
                - ..event.payClick
    # 弹窗区域
    - type: popUp
      viewTag: stockTag
      message: "The purchase amount cannot exceed stock."
      path: aboutRed.svg
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "0.2"
        zIndex: "101"
        overflow: hidden
      children:
        - type: view
          style:
            marginTop: "0.0923"
            width: "0.84"
            marginLeft: "0.08"
            # backgroundColor: "0xE6E6E6"
            borderRadius: "4px"
            overflow: hidden
          children:
            - type: view
              style:
                marginTop: "0.0123"
                width: "0.84"
                height: "auto"
              children:
                - type: image
                  path: ____.path
                  style:
                    marginLeft: "0.08"
                    display: "inline-block"
                    height: "0.023"
                    verticalAlign: middle
                - type: label
                  text: ____.message
                  style:
                    display: "inline-block"
                    verticalAlign: middle
                    width: "0.65"
                    marginLeft: "0.0186"
                    fontSize: .Nfont.h14

                    color: "0x333333"
                    wordWrap: break-word
                    textAlign:
                      x: left
            - type: view
              style:
                marginTop: "0.0123"
    - type: view
      viewTag: successTag
      message: "Successfully!"
      style:
        display: ..formData.display.success
        top: "0"
        left: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
        zIndex: "50"
        overflow: hidden
      leftText: "Homepage"
      rightText: "View order"
      leftButton:
        - actionType: evalObject
          object:
            - .Global.formData.commerceOrder.havePay@: false
            - goto: PatientDashboard
      rightButton:
        - actionType: evalObject
          object:
            - .Global.formData.commerceOrder.havePay@: false
            - goto: OrderDetails
      children:
        - type: view
          style:
            width: "1"
            height: "1"
            textAlign:
              y: center
              x: center
          children:
            - type: view
              style:
                width: "0.7"
                backgroundColor: "0xE6E6E6"
                borderRadius: "14px"
                overflow: hidden
                textAlign:
                  x: center
              children:
                - type: image
                  path: deleteTrue.svg
                  style:
                    marginTop: "0.029"
                    width: "0.13"
                - type: label
                  text: ____.message
                  style:
                    width: "0.576"
                    marginLeft: "0.062"
                    marginTop: "0.006"
                    fontSize: .Nfont.h14

                    textAlign:
                      x: center
                    color: "0x333333"
                - type: view
                  style:
                    height: "0.027"
                    width: "0.7"
                    border:
                      style: 2
                      color: "0x919192"
                    borderWidth: "1"
                - type: view
                  style:
                    width: "0.7"
                  children:
                    - type: button
                      text: _____.leftText
                      style:
                        color: "0x007AFF"
                        display: inline-block
                        width: "0.349"
                        borderRadius: "0 0 0 14px"
                        height: "0.054"
                        fontSize: .Nfont.h14
                        backgroundColor: "0xE6E6E6"
                        border:
                          style: "1"
                      onClick: _____.leftButton
                    - type: view
                      style:
                        width: "0.002"
                        backgroundColor: "0x919192"
                        display: inline-block
                        height: "0.054"
                        zIndex: "50"
                    - type: button
                      text: _____.rightText
                      style:
                        color: "0x007AFF"
                        fontWeight: "850"
                        display: inline-block
                        width: "0.349"
                        borderRadius: "0 0 14px 0"
                        height: "0.054"
                        fontSize: .Nfont.h14
                        backgroundColor: "0xE6E6E6"
                        border:
                          style: "1"
                      onClick: _____.rightButton
    - .BaseWarningView:
      message: "Please select a shipping address"
      viewTag: addressWarnTag
  event:
    reduceClick:
      - emit:
          dataKey:
            var: itemObject
            var2: listAttr
          actions:
            - if:
                - =.builtIn.number.less:
                    dataIn:
                      num1: $var.num
                      num2: 2
                - ..formData.currentNum@: 1
                - =.builtIn.number.Subtraction:
                    dataIn:
                      num: $var.num
                      step: 1
                    dataOut: OrderConfirmation.formData.currentNum
            - =.builtIn.array.setObjectByKey:
                dataIn:
                  objectArr: $var2.parent.productionList
                  keyOne: "inventoryId"
                  keyTwo: "num"
                  valueOne: $var.inventoryId
                  valueTwo: =..formData.currentNum
                dataOut: OrderConfirmation.formData.currentSecondList
            - ..formData.currentId@: $var2.parent.inventorName
      - actionType: evalObject
        object:
          - =.builtIn.array.setObjectByKey:
              dataIn:
                objectArr: =..apiRequest.order.docCreateReq.name.data.orderList
                keyOne: "inventorName"
                keyTwo: "productionList"
                valueOne: =..formData.currentId
                valueTwo: =..formData.currentSecondList
              dataOut: OrderConfirmation.apiRequest.order.docCreateReq.name.data.orderList
          # 修改总金额
          - =.builtIn.number.multiply:
              dataIn:
                number: =..apiRequest.order.docCreateReq.name.data.orderList.0.productionList.0.price
                multiple: =..formData.currentNum
              dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq.name.amount
          - =.builtIn.string.concat:
              dataIn:
                - "$"
                - =..apiRequest.shopOrder.edgeCreateReq.name.amount
              dataOut: OrderConfirmation.formData.displayTotalMoney
      - actionType: builtIn
        funcName: redraw
        viewTag: displayTotalMoney
      - actionType: builtIn
        funcName: redraw
        viewTag: orderTag
    addClick:
      - emit:
          dataKey:
            var: itemObject
            var2: listAttr
          actions:
            # 是否开启超出库存售卖
            # Global.formData.production.name.data.inventory.isOutStockContinueSell
            - =.builtIn.number.addition:
                dataIn:
                  num: $var.num
                  step: 1
                dataOut: OrderConfirmation.formData.currentNum
            - =.builtIn.array.setObjectByKey:
                dataIn:
                  objectArr: $var2.parent.productionList
                  keyOne: "inventoryId"
                  keyTwo: "num"
                  valueOne: $var.inventoryId
                  valueTwo: =..formData.currentNum
                dataOut: OrderConfirmation.formData.currentSecondList
            - ..formData.currentId@: $var2.parent.inventorName
      - actionType: evalObject
        object:
          - =.builtIn.array.setObjectByKey:
              dataIn:
                objectArr: =..apiRequest.order.docCreateReq.name.data.orderList
                keyOne: "inventorName"
                keyTwo: "productionList"
                valueOne: =..formData.currentId
                valueTwo: =..formData.currentSecondList
              dataOut: OrderConfirmation.apiRequest.order.docCreateReq.name.data.orderList
          # 修改总金额
          - =.builtIn.number.multiply:
              dataIn:
                number: =..apiRequest.order.docCreateReq.name.data.orderList.0.productionList.0.price
                multiple: =..formData.currentNum
              dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq.name.amount
          - =.builtIn.string.concat:
              dataIn:
                - "$"
                - =..apiRequest.shopOrder.edgeCreateReq.name.amount
              dataOut: OrderConfirmation.formData.displayTotalMoney
      - actionType: builtIn
        funcName: redraw
        viewTag: displayTotalMoney
      - actionType: builtIn
        funcName: redraw
        viewTag: orderTag
    payClick:
      # 判断地址是否存在
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type
                    string2: "Pick up"
              - continue
              - actionType: evalObject
                object:
                  - if:
                      - =..apiRequest.commerceCheckOrder.docCreateReq.name.data.contactInfomation.name
                      - continue
                      - actionType: popUp
                        popUpView: addressWarnTag
                        wait: true
                        popUpDismiss: 2000
      - actionType: evalObject
        object:
          - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.appointmentTime@: =.Global.currentRoomInfo.edge.stime
          - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.serviceType@: =.Global.currentRoomInfo.edge.name.visitType
          - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.providerFullName@: =.Global.currentRoomInfo.edge.name.providerName
          - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.facilityName@: =.Global.currentRoomInfo.edge.name.locationName
          - .Global.formData.commerceOrder.paymentInfo.isUpdated@: false
          - =.builtIn.utils.getUrl:
              dataIn:
              dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq.name.url
          - =.builtIn.math.toFixedNum:
              dataIn:
                num: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCost
              dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCost
          - ..apiRequest.order.docCreateReq.name.title@: =..apiRequest.order.docCreateReq.name.data.orderList.0.productionList.0.inventoryId
          - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.totalMoney@: =..formData.totalMoney
          - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.amount@: =..apiRequest.shopOrder.edgeCreateReq.name.amount
          # 如果选的是pickup,则将shipping cost置为0，将shippingTime置为Pick up
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type
                    string2: "Pick up"
              - actionType: evalObject
                object:
                  - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCost@: "0.00"
                  - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingTime@: "Pick up"
              - continue
          # 判断是否从购物车进入
          - if:
              - =.Global.formData.whetherShoppingCart
              - actionType: evalObject
                object:
                  - =..apiRequest.shopOrder.edgeAPI.store: ""
                  - ..apiRequest.email.docCreateReq.name.data.orderId@: =..apiRequest.shopOrder.edgeCreateResp.edge.id
                  - .Global.createjwt.edge.bvid@: =.Global.currentRoomInfo.edge.name.providerId
                  - =.Global.createjwt.edgeAPI.store: ""
                  - =..apiRequest.email.docAPI.store: ""
                  - .Global.createjwt.edge.bvid@: =.Global.currentUser.vertex.id
                  - =.Global.createjwt.edgeAPI.store: ""
                  - ..apiRequest.commerceCheckOrder.docCreateReq.eid@: =..apiRequest.shopOrder.edgeCreateResp.edge.id
                  - =..apiRequest.commerceCheckOrder.docAPI.store: ""
                  - =.builtIn.array.setArrObjAttri:
                      dataIn:
                        arr: =..apiRequest.orderInshoppingCart.docQueryResp.doc
                        path: name.data.orderList.0.productionList.0.orderId
                        value: =..apiRequest.shopOrder.edgeCreateResp.edge.id
                      dataOut: OrderConfirmation.apiRequest.orderInshoppingCart.docQueryResp.doc
                  - =.builtIn.array.setArrObjAttri:
                      dataIn:
                        arr: =..apiRequest.orderInshoppingCart.docQueryResp.doc
                        path: name.data.orderList.0.productionList.0.squareId
                        value: =..apiRequest.shopOrder.edgeCreateResp.edge.deat.squareID
                      dataOut: OrderConfirmation.apiRequest.orderInshoppingCart.docQueryResp.doc
                  - =.builtIn.ecos.shareDocList:
                      dataIn:
                        sourceDocList: =..apiRequest.orderInshoppingCart.docQueryResp.doc
                        targetEdgeID: =..apiRequest.shopOrder.edgeCreateResp.edge.id
                        fidPointToSelf: true
                  - .Global.formData.commerceOrder.commerceCheckOrder@: =..apiRequest.commerceCheckOrder.docCreateResp.doc
                  - .Global.formData.commerceOrder.havePay@: true
                  - .Global.formData.currentOrder@: []
                  - =.builtIn.object.extract:
                      dataIn:
                        array: =..apiRequest.orderInshoppingCart.docQueryResp.doc
                        field: name.data.orderList
                      dataOut: Global.formData.currentOrder
                  - =.builtIn.array.mergeAttributes:
                      dataIn:
                        arr: =.Global.formData.currentOrder
                        path: inventorName
                      dataOut: Global.formData.currentOrder
                  - goto: =..apiRequest.shopOrder.edgeCreateResp.edge.deat.squareURL
              - actionType: evalObject
                object:
                  - =..apiRequest.shopOrder.edgeAPI.store: ""
                  - =.builtIn.string.concat:
                      dataIn:
                        - =..apiRequest.shopOrder.edgeCreateReq.name.quantity
                      dataOut: OrderConfirmation.apiRequest.order.docCreateReq.name.nonce
                  - =.builtIn.array.setArrObjAttri:
                      dataIn:
                        arr: =..apiRequest.order.docCreateReq.name.data.orderList.0.productionList
                        path: orderId
                        value: =..apiRequest.shopOrder.edgeCreateResp.edge.id
                      dataOut: OrderConfirmation.apiRequest.order.docCreateReq.name.data.orderList.0.productionList
                  - =.builtIn.array.setArrObjAttri:
                      dataIn:
                        arr: =..apiRequest.order.docCreateReq.name.data.orderList.0.productionList
                        path: squareId
                        value: =..apiRequest.shopOrder.edgeCreateResp.edge.deat.squareID
                      dataOut: OrderConfirmation.apiRequest.order.docCreateReq.name.data.orderList.0.productionList
                  # 应晨哥要求，将220161的fid指向源productionId
                  - ..apiRequest.order.docCreateReq.fid@: =..apiRequest.order.docCreateReq.name.data.orderList.0.productionList.0.productionId
                  - =..apiRequest.order.docAPI.store: ""
                  - ..apiRequest.order.docQueryReq.id@: =..apiRequest.order.docCreateResp.doc.id
                  - =..apiRequest.order.docAPI.get: ""
                  - ..apiRequest.email.docCreateReq.name.data.orderId@: =..apiRequest.shopOrder.edgeCreateResp.edge.id
                  - .Global.createjwt.edge.bvid@: =.Global.currentRoomInfo.edge.name.providerId
                  - =.Global.createjwt.edgeAPI.store: ""
                  - =..apiRequest.email.docAPI.store: ""
                  - .Global.createjwt.edge.bvid@: =.Global.currentUser.vertex.id
                  - =.Global.createjwt.edgeAPI.store: ""
                  - ..apiRequest.commerceCheckOrder.docCreateReq.eid@: =..apiRequest.shopOrder.edgeCreateResp.edge.id
                  - =..apiRequest.commerceCheckOrder.docAPI.store: ""
                  - =.builtIn.ecos.shareDoc:
                      dataIn:
                        sourceDoc: =..apiRequest.order.docQueryResp.doc.0
                        targetEdgeID: =..apiRequest.shopOrder.edgeCreateResp.edge.id
                        targetFileID: =..apiRequest.order.docQueryResp.doc.0.id
                  - .Global.formData.commerceOrder.commerceCheckOrder@: =..apiRequest.commerceCheckOrder.docCreateResp.doc
                  - .Global.formData.commerceOrder.havePay@: true
                  - .Global.formData.currentOrder@: []
                  - =.builtIn.array.pushAny:
                      dataIn:
                        newMessage: =..apiRequest.order.docQueryResp.doc.0.name.data.orderList
                        messages: =.Global.formData.currentOrder
                      dataOut: Global.formData.currentOrder
                  - goto: =..apiRequest.shopOrder.edgeCreateResp.edge.deat.squareURL
    radioDeliveryPath:
      emit:
        dataKey:
          var: itemObject
        actions:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type
                    string2: $var.value
              - radioOn.svg
              - radioOff.svg
    radioDeliveryClick:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type
                      string2: $var.value
                - continue
                - =.builtIn.object.set:
                    dataIn:
                      object: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod
                      key: $var.key
                      value: $var.value
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type
                      string2: "Pick up"
                - ..formData.display.allContactInformaton@: none
                - ..formData.display.allContactInformaton@: block
            - =.builtIn.object.setProperty:
                dataIn:
                  obj: =..formDataTemp.deliveryTemp
                  label: "value"
                  text: $var.value
                  arr: ["display"]
                  valueArr: ["block"]
                  errorArr: ["none"]
            - ..formData.display.ship@: =..formDataTemp.deliveryTemp.0.display
            - ..formData.display.pickUp@: =..formDataTemp.deliveryTemp.1.display
      - actionType: evalObject
        object:
          # 如果选择pick up，则忽略运输费用
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type
                    string2: "Pick up"
              - actionType: evalObject
                object:
                  - ..apiRequest.shopOrder.edgeCreateReq.name.amount@: =..formData.totalMoney
                  # 如果有多个pick up location，则展示列表，否则展示单个location
                  - if:
                      - =.builtIn.array.judgeListLength:
                          dataIn:
                            array: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.pickupLocation
                            len: 1
                      - actionType: evalObject
                        object:
                          - ..formData.display.singlePickUpLocation@: block
                          - ..formData.display.mutilPickUpLocation@: none
                      - actionType: evalObject
                        object:
                          - ..formData.display.singlePickUpLocation@: none
                          - ..formData.display.mutilPickUpLocation@: block
              - actionType: evalObject
                object:
                  - ..formData.display.singlePickUpLocation@: none
                  - ..formData.display.mutilPickUpLocation@: none
                  - =.builtIn.number.addition:
                      dataIn:
                        num: =..formData.totalMoney
                        step: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCost
                      dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq.name.amount
                  - =.builtIn.math.toFixedNum:
                      dataIn:
                        num: =..apiRequest.shopOrder.edgeCreateReq.name.amount
                      dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq.name.amount
      - actionType: builtIn
        funcName: redraw
        viewTag: radioDeliveryTag
      - actionType: builtIn
        funcName: redraw
        viewTag: shipTag
      - actionType: builtIn
        funcName: redraw
        viewTag: pickUpTag
      - actionType: builtIn
        funcName: redraw
        viewTag: allContactInformaton
      - actionType: builtIn
        funcName: redraw
        viewTag: displayTotalMoney
    radioTimePath:
      emit:
        dataKey:
          var: itemObject
        actions:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingTime
                    string2: $var.key
              - radioOn.svg
              - radioOff.svg
    radioTimeClick:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingTime
                      string2: $var.key
                - continue
                - =.builtIn.object.set:
                    dataIn:
                      object: =..apiRequest.commerceCheckOrder.docCreateReq.name.data
                      key: shippingTime
                      value: $var.key
            - =.builtIn.array.getByKey:
                dataIn:
                  array: =..formDataTemp.timeTemp
                  key1: key
                  value: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingTime
                  key2: value2
                dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCost
            - =.builtIn.math.toFixedNum:
                dataIn:
                  num: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCost
                dataOut: OrderConfirmation.apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCost
            - =.builtIn.number.addition:
                dataIn:
                  num: =..formData.totalMoney
                  step: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingCost
                dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq.name.amount
            - =.builtIn.math.toFixedNum:
                dataIn:
                  num: =..apiRequest.shopOrder.edgeCreateReq.name.amount
                dataOut: OrderConfirmation.apiRequest.shopOrder.edgeCreateReq.name.amount
            - ..apiRequest.commerceCheckOrder.docCreateReq.name.data.amount@: =..apiRequest.shopOrder.edgeCreateReq.name.amount
      - actionType: builtIn
        funcName: redraw
        viewTag: radioTimeTag
      - actionType: builtIn
        funcName: redraw
        viewTag: displayTotalMoney
    # checkBoxPath:
    #   emit:
    #     dataKey:
    #       var: itemObject
    #     actions:
    #       - if:
    #           - =.builtIn.string.equal:
    #               dataIn:
    #                 string1: =..formData.addressType
    #                 string2: $var.value
    #           - radioOn.svg
    #           - radioOff.svg
    # checkBoxClick:
    #   - emit:
    #       dataKey:
    #         var: itemObject
    #       actions:
    #         - ..formData.currentAddress@: $var.display
    #         - if:
    #             - =.builtIn.string.equal:
    #                 dataIn:
    #                   string1: =..formData.addressType
    #                   string2: $var.value
    #             - continue
    #             - =.builtIn.object.set:
    #                 dataIn:
    #                   object: =.OrderConfirmation.formData
    #                   key: $var.key
    #                   value: $var.value
    #   - actionType: builtIn
    #     funcName: redraw
    #     viewTag: addressTag
    #   - actionType: builtIn
    #     funcName: redraw
    #     viewTag: billiSelectTag
    shippAddressClick:
      - actionType: evalObject
        object:
          - .Global.formData.commerceOrder.paymentInfo.isUpdated@: true
          - .Global.formData.commerceOrder.paymentInfo.deliveryMethod@: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.deliveryMethod.type
          - .Global.formData.commerceOrder.paymentInfo.shippingTime@: =..apiRequest.commerceCheckOrder.docCreateReq.name.data.shippingTime
          - .Global.formData.currentAddressStatus@: false
          - goto: AddressManagement
    # billingAddressClick:
    #   - actionType: evalObject
    #     object:
    #       - .Global.formData.currentAddressStatus@: false
    #       - goto: AddressManagement
  style:
    pickUpLoactionListTitle:
      fontSize: .Nfont.h14
    pickUpLoactionListContent:
      fontSize: .Nfont.h14
      lineHeight: "2.58vh"
      color: "#666666"
      word-break: break-word
      width: "0.73333"
      marginLeft: "0.048"
    scrollBox:
      width: "1"
      height: "0.84729"
      boxSizing: "border-box"
      overflow: "scroll"
      color: "#333333"
      fontSize: .Nfont.h16
      backgroundColor: "#f5f5f5"
    btnBox:
      width: "1"
      height: "0.0972"
      boxSizing: "border-box"
      overflow: "scroll"
      backgroundColor: "#ffffff"
      boxShadow: "1px 1px 4px 1px #dededf"
      textAlign:
        x: center
    list:
      width: "0.92"
      margin: "0"
      marginLeft: "0.04"
      marginTop: "0.014778"
      height: auto
      boxSizing: border-box
      backgroundColor: "0xffffff"
      paddingBottom: "0.0172413"
      borderRadius: "4"
    listItem:
      width: "0.92"
      height: "auto"
      boxSizing: border-box
    titleLabel:
      paddingTop: "0.0172413"
      paddingLeft: "0.04"
      paddingRight: "0.04"
      paddingBottom: "0.0160098"
      fontSize: .Nfont.h16
      fontWeight: "600"
      boxSizing: border-box
      wordBreak: break-word
    secondList:
      width: "0.92"
      margin: "0"
      height: auto
      boxSizing: border-box
    secondListItem:
      width: "0.84"
      height: "auto"
      marginLeft: "0.04"
      paddingBottom: "0.019704"
      paddingTop: "0.019704"
      boxSizing: border-box
      borderTop: "1px solid #dedede"
    blockBox:
      width: "auto"
      height: "auto"
      boxSizing: border-box
    productAvatar:
      width: "0.1546666"
      height: "0.0714285"
      border: "1px solid #dedede"
      boxSizing: border-box
      borderRadius: "4"
      verticalAlign: middle
    topBox:
      display: "inline-block"
      marginLeft: "0.02133333"
      width: "auto"
      height: "auto"
      overflow: hidden
      verticalAlign: middle
    productTitle:
      fontSize: .Nfont.h14
      fontWeight: "600"
      boxSizing: "border-box"
      -webkit-line-clamp: 2
      display: -webkit-box
      -webkit-box-orient: vertical
      overflow: hidden
      text-overflow: ellipsis
      wordBreak: break-word
      width: "0.656"
    productType:
      display: "inline-block"
      color: itemObject.typeColor
      fontSize: .Nfont.h12
      width: "0.656"
      fontWeight: "600"
      verticalAlign: middle
    productInfoBox:
      marginTop: "0.006157"
      width: "auto"
      height: "auto"
      boxSizing: border-box
    productInfo:
      display: "inline-block"
      paddingLeft: "0.021333"
      width: "0.37"
      height: "0.033251"
      backgroundColor: "#f8f8f8"
      color: "#666666"
      borderRadius: "4"
      boxSizing: border-box
      fontSize: .Nfont.h12
      lineHeight: "3.3251vh"
      overflow: hidden
      text-overflow: ellipsis
      whiteSpace: nowrap
      verticalAlign: middle
    numBox:
      marginLeft: "0.032"
      display: "inline-block"
      width: "auto"
      height: "auto"
      verticalAlign: middle
    reduceBox:
      display: "inline-block"
      color: "#999999"
      fontSize: .Nfont.h12
      width: "0.08"
      height: "0.036945"
      border: "none"
      borderRadius: "2"
      boxSizing: "border-box"
      backgroundColor: "#f8f8f8"
      textAlign:
        x: center
    num:
      marginLeft: "0.008"
      color: "#333333"
      display: "inline-block"
      fontSize: .Nfont.h12
      width: "0.08"
      height: "0.036945"
      border: "none"
      borderRadius: "2"
      boxSizing: "border-box"
      backgroundColor: "#f8f8f8"
      textAlign:
        x: center
    addBox:
      marginLeft: "0.008"
      display: "inline-block"
      color: "#999999"
      width: "0.08"
      height: "0.036945"
      border: "none"
      borderRadius: "2"
      boxSizing: "border-box"
      backgroundColor: "#f8f8f8"
      textAlign:
        x: center
      fontSize: .Nfont.h16
    priceLabel:
      display: "inline-block"
      fontSize: .Nfont.h14
      color: "#333333"
      width: "0.3"
      boxSizing: border-box
    priceValue:
      display: "inline-block"
      fontSize: .Nfont.h14
      color: "#333333"
      width: "0.538"
      boxSizing: border-box
      fontWeight: "600"
      textAlign:
        x: right
    payValue:
      marginTop: "0.0123"
      color: "#fb5051"
      fontSize: .Nfont.h20
      fontWeight: "700"
      display: "inline-block"
      verticalAlign: middle
      width: "0.416"
      textAlign:
        x: right
    payBtn:
      marginTop: "0.0123"
      marginLeft: "0.08266"
      display: "inline-block"
      verticalAlign: middle
      width: "0.4"
      height: "0.044334"
      border: "none"
      borderRadius: "4"
      backgroundColor: "#2988e6"
      fontSize: .Nfont.h14
      fontWeight: "600"
      color: "#fff"
    payBox:
      marginTop: "0.01477832"
      marginLeft: "0.04"
      width: "0.92"
      borderRadius: "4"
      backgroundColor: "0xffffff"
      paddingTop: "0.02463054"
      paddingBottom: "0.02463054"
      paddingLeft: "0.04"
      paddingRight: "0.04"
      boxSizing: border-box
    methodStyle:
      display: "inline-block"
      fontSize: .Nfont.h14
      width: "0.648"
      height: "auto"
      verticalAlign: middle
      fontWeight: "600"
    checkPath:
      display: "inline-block"
      height: "0.01970"
      verticalAlign: middle
    methodLabel:
      marginLeft: "0.0213333"
      display: "inline-block"
      fontSize: .Nfont.h14
      width: "auto"
      height: "auto"
      verticalAlign: middle
    deliveryBox:
      ..style.blockBox:
      verticalAlign: middle
      display: "inline-block"
    deliveryList:
      width: "auto"
      margin: "0"
      height: auto
    deliveryListItem:
      display: itemObject.display
      width: "0.193"
      height: "auto"
    radioImg:
      display: "inline-block"
      # width: "0.0442"
      height: "4.42vw"
      verticalAlign: middle
    radioValue:
      marginLeft: "0.0213333"
      display: "inline-block"
      fontSize: .Nfont.h14
      color: "#333333"
      verticalAlign: middle
    timeLabel:
      fontSize: .Nfont.h14
      fontWeight: "600"
    timeList:
      width: "0.84"
      margin: "0"
      height: auto
    timeListItem:
      display: "inline-block"
      width: "0.419"
      height: "auto"
    contactLable:
      fontSize: .Nfont.h14
      color: "#333333"
      width: "0.84"
      fontWeight: "600"
      paddingBottom: "0.017241"
      borderBottom: "1px solid #dedede"
    blockSecondBox:
      marginTop: "0.017241"
      width: "0.84"
      height: "auto"
    rightLabel:
      display: "inline-block"
      fontSize: .Nfont.h14
      color: "#333333"
      fontWeight: "600"
      verticalAlign: middle
      width: "0.68533333"
    selectLabel:
      display: "inline-block"
      fontSize: .Nfont.h14
      color: "#2988e6"
      fontWeight: "600"
      verticalAlign: middle
      textDecoration: underline
    selectImg:
      display: "inline-block"
      verticalAlign: middle
      height: "0.01970"
      marginLeft: "0.010666"
    rigthTitle:
      display: "inline-block"
      width: "0.3"
      height: "auto"
      color: "#333333"
      fontSize: .Nfont.h14
      fontWeight: "600"
      boxSizing: border-box
      wordBreak: break-word
    leftValue:
      display: "inline-block"
      width: "0.54"
      boxSizing: border-box
      fontSize: .Nfont.h14
      color: "#333333"
      wordBreak: break-word
      textAlign:
        x: right
    addrssList:
      width: "0.84"
      margin: "0"
      height: auto
    addrssListItem:
      width: "0.84"
      height: "auto"
      marginTop: "0.020935"
    itemValue:
      display: "inline-block"
      marginLeft: "0.026666"
      height: "auto"
      width: "auto"
      fontSize: .Nfont.h14
      color: "#333333"
      fontWeight: "700"
      verticalAlign: middle
    addressLabel:
      ..style.timeLabel:
      fontWeight: "400"
      marginTop: "0.008"
      width: "0.84"
      lineHeight: "2.58vh"
      wordBreak: break-word
    productNum:
      marginLeft: "0.02133333"
      display: "inline-block"
      fontSize: .Nfont.h12
      color: "#333333"
      boxSizing: border-box
      border: "1px solid #c1c1c1"
      borderRadius: "2"
      padding: "2px 4px"
      verticalAlign: middle
    auto:
      width: auto
      height: auto
