MessageShow:
  pageNumber: "220"
  title: "Message"
  init:
    - .SignInCheck
    - actionType: updateObject
      dataKey: Global.formData.replyEmail
      dataObject: .EmptyObj
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - actionType: evalObject
      object:
        - actionType: evalObject
          async: true
          object:
            #获取tag
            - =..apiRequest.emailTag.docAPI.get: ""
            #获取附件
            - =..apiRequest.attachment.docAPI.get: ""
            # 获取文件夹
            - =..apiRequest.folder.docAPI.get: ""
            - =..apiRequest.emailTypeTag.docAPI.get: ""
    - if:
        - =.builtIn.number.typeIsValid:
            dataIn:
              docType: =..apiRequest.emailTag.docQueryResp.doc.0.type
              localArr: [3]
              binaryArr: [1]
        - ..isStar@: 0
        - ..isStar@: 1

    - actionType: evalObject
      object:
        .MessageShow.docDetail.document@: =.Global.email
    - if:
        - =.Global.email.fid
        - ..NewPasswordHelper.docAPI.get
        - continue
    - if:
        - =..docResponse.doc.0
        - ..userData.get
        - continue
    - if:
        - =..userData.userVertex.vertex.0.pk
        - actionType: evalObject
          object:
            - =.builtIn.eccNaCl.decryptASK:
                dataIn:
                  eData: =..docResponse.doc.0.name.aesk
                  recvSk: =.Global.currentUser.vertex.sk
                  sendPk: =..userData.userVertex.vertex.0.pk
                dataOut: MessageShow.formData.password #aesk
            - =.builtIn.string.split16Dkey:
                dataIn: =.MessageShow.formData.password
                dataOut: MessageShow.formData.split
            - .MessageShow.docDetail.document.name.data@: =..formData.split
        - continue
    - ..formData.display.normalType@: block
    # 是否是recommendation推荐邮件
    - if:
        - =.builtIn.number.typeIsValid:
            dataIn:
              docType: =.Global.email.tage
              localArr: [1]
              binaryArr: [1]
        - actionType: evalObject
          object:
            - ..formData.display.recommendationNotification@: block
            - ..formData.display.normalType@: none
            - ..apiRequest.appointment.edgeQueryReq.id@: =.Global.email.name.data.appointmentId
            - =..apiRequest.appointment.edgeAPI.get: ""
            - .Gloabl.roomInfo.edge@: =..apiRequest.appointment.edgeQueryResp.edge.0
            - .Global.currentRoomInfo.edge@: =..apiRequest.appointment.edgeQueryResp.edge.0
        - continue
    # 是否是order邮件
    - if:
        - =.builtIn.number.typeIsValid:
            dataIn:
              docType: =.Global.email.tage
              localArr: [2]
              binaryArr: [1]
        - actionType: evalObject
          object:
            - ..formData.display.order@: block
            - ..formData.display.normalType@: none
        - continue
    # 是否是amendment accept邮件
    - if:
        - =.builtIn.number.typeIsValid:
            dataIn:
              docType: =.Global.email.tage
              localArr: [4]
              binaryArr: [1]
        - actionType: evalObject
          object:
            - ..formData.display.acceptAmendment@: block
            - ..formData.display.normalType@: none
        - continue
    # 是否是amendment deny邮件
    - if:
        - =.builtIn.number.typeIsValid:
            dataIn:
              docType: =.Global.email.tage
              localArr: [5]
              binaryArr: [1]
        - actionType: evalObject
          object:
            - ..formData.display.denyAmendment@: block
            - ..formData.display.normalType@: none
        - continue
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =..apiRequest.emailTypeTag.docQueryResp.doc
              len: 0
        - continue
        - actionType: evalObject
          object:
            - ..formData.display.normalType@: none
            - if:
                - =.builtIn.number.typeIsValid:
                    dataIn:
                      docType: =..apiRequest.emailTypeTag.docQueryResp.doc.0.tage
                      localArr: [3]
                      binaryArr: [1]
                - ..formData.display.updatePatientProfile@: block
                - continue
  NewPasswordHelper:
    document:
    docAPI:
      .DocAPI: ""
      get:
        .DocAPI.get: ""
        api: rd
        ids:
          - =.Global.email.fid
        xfname: id
        type: .DocType.PasswordHelper
        maxcount: "1"
        obfname: "mtime"
        dataKey: docResponse
        _nonce: =.Global._nonce
  docResponse:
    doc:
    error: ""
    jwt: ""
  userData:
    userVertex:
      vertex:
    request:
      id: =..docResponse.doc.0.bsig # the ovid of document
      xfname: id
      type: 1
    get:
      api: rv
      dataIn: userData.request
      dataOut: userData.userVertex
  formData:
    docJumpList: ""
    appointmentTypeJudge: 0
    password: ""
    split: ""
    display:
      denyAmendment: none
      acceptAmendment: none
      normalType: none
      updatePatientProfile: none
      recommendationNotification: none
      order: none
  docDetail:
    document: ""
    docAPI:
      .DocAPI: ""
      store:
        dataIn: MessageShow.docDetail.document
      delete:
        api: dx
        dataIn: MessageShow.docDetail.document
  requestListHidden: "true"
  subject: ""
  inboxFolder: ""
  isStar: 1
  apiRequest:
    roomInfo:
      edgeQueryResp: ""
      edgeQueryReq:
        id: ""
        _nonce: .Global._nonce
      edgeAPI:
        get:
          api: re
          dataIn: MessageShow.apiRequest.roomInfo.edgeQueryReq
          dataOut: MessageShow.apiRequest.roomInfo.edgeQueryResp
    currentRoom:
      edgeQueryResp: ""
      edgeQueryReq:
        id: ""
        _nonce: .Global._nonce
      edgeAPI:
        get:
          api: re
          dataIn: MessageShow.apiRequest.currentRoom.edgeQueryReq
          dataOut: MessageShow.apiRequest.currentRoom.edgeQueryResp
    diagnosesDoc:
      docResp: ""
      docReq:
        id: []
        xfname: "eid,reid"
        type: .DocType.Diagnoses
        obfname: "mtime"
        maxcount: "1"
        _nonce: .Global._nonce
      docAPI:
        .DocAPI: ""
        get:
          api: rd
          dataIn: MessageShow.apiRequest.diagnosesDoc.docReq
          dataOut: MessageShow.apiRequest.diagnosesDoc.docResp
    getIsCancel:
      cancelEdge: 
        edge: []
      edgeReq:
        type: 40000
        id: =..apiRequest.appointment.edgeQueryResp.edge.0.id
        xfname: refid
        maxcount: "1"
        sCondition: "subtype=7"
        _nonce: =.Global._nonce
      edgeAPI:
        get:
          api: re
          dataIn: MessageShow.apiRequest.getIsCancel.edgeReq
          dataOut: MessageShow.apiRequest.getIsCancel.cancelEdge
    amendent:
      docQueryResp: ""
      docQueryReq:
        id: ""
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.amendent.docQueryReq
          dataOut: MessageShow.apiRequest.amendent.docQueryResp
    providerNote:
      docQueryResp: ""
      docQueryReq:
        id: ""
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.providerNote.docQueryReq
          dataOut: MessageShow.apiRequest.providerNote.docQueryResp
    commerceCheckOrder:
      docQueryResp: ""
      docQueryReq:
        id: .Global.email.name.data.orderId
        xfname: eid
        type: .DocType.CommerceCheckOrder
        _nonce: .Global._nonce
        obfname: mtime
        maxcount: 1
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.commerceCheckOrder.docQueryReq
          dataOut: MessageShow.apiRequest.commerceCheckOrder.docQueryResp
    order:
      docQueryResp: ""
      docQueryReq:
        id: .Global.email.name.data.orderId
        xfname: eid
        type: .DocType.Order
        _nonce: .Global._nonce
        obfname: mtime
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.order.docQueryReq
          dataOut: MessageShow.apiRequest.order.docQueryResp
    medicalRecommendation:
      docQueryResp: ""
      docQueryReq:
        id: ""
        xfname: eid
        type: .DocType.MedicalRecommend
        obfname: mtime
        maxcount: 1
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.medicalRecommendation.docQueryReq
          dataOut: MessageShow.apiRequest.medicalRecommendation.docQueryResp
    appointment:
      edgeQueryResp: ""
      edgeQueryReq:
        id: ""
        _nonce: .Global._nonce
      edgeAPI:
        get:
          api: re
          dataIn: MessageShow.apiRequest.appointment.edgeQueryReq
          dataOut: MessageShow.apiRequest.appointment.edgeQueryResp
    hashTagFromRelationProfile:
      docQueryResp: ""
      docQueryReq:
        id: ""
        xfname: reid
        maxcount: 1
        obfname: mtime
        type: .DocType.HashTag
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.hashTagFromRelationProfile.docQueryReq
          dataOut: MessageShow.apiRequest.hashTagFromRelationProfile.docQueryResp
    profileFromRelation:
      docQueryResp: ""
      docQueryReq:
        ObjType: 8
        type: .DocType.PatientProfile
        maxcount: 1
        obfname: mtime
        id:
          - .Global.currentUser.vertex.id
          - .Global.email.bsig
        xfname: (E.bvid,E.evid)|(E.evid,E.bvid)
        sConditon: E.type=10002 AND E.tage>0
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.profileFromRelation.docQueryReq
          dataOut: MessageShow.apiRequest.profileFromRelation.docQueryResp
    emailTypeTag:
      docQueryResp:
        doc: []
      docQueryReq:
        id: .Global.email.id
        xfname: reid
        type: .DocType.MailTypeTag
        maxcount: "1"
        obfname: mtime
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.emailTypeTag.docQueryReq
          dataOut: MessageShow.apiRequest.emailTypeTag.docQueryResp
    #get attachment
    attachment:
      docQueryResp: ""
      docQueryReq:
        type: .DocType.Attachment
        id: .Global.email.id
        xfname: reid
        obfname: "ctime"
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.attachment.docQueryReq
          dataOut: MessageShow.apiRequest.attachment.docQueryResp
    emailTag:
      docQueryResp: ""
      docQueryReq:
        sCondition: type & 0xFF00 = 0xE00
        ids:
          - .Global.rootNotebookID
          - .Global.email.id
        xfname: eid,reid
        _nonce: =.Global._nonce
      docCreateResp: ""
      docCreateReq:
        type: .DocType.MailTag
        eid: .Global.rootNotebookID
        name:
          data: ""
        reid: ""
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.emailTag.docQueryReq
          dataOut: MessageShow.apiRequest.emailTag.docQueryResp
        store:
          api: cd
          dataIn: MessageShow.apiRequest.emailTag.docCreateReq
          dataOut: MessageShow.apiRequest.emailTag.docCreateResp
    folder:
      docGetResp: ""
      docCreateReq:
        type: .DocType.MailFolder
        eid: .Global.rootNotebookID
        name:
          data: ""
          title: ""
      docGetReq:
        type: .DocType.MailFolder
        id: .Global.rootNotebookID
        xfname: eid
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.folder.docGetReq
          dataOut: MessageShow.apiRequest.folder.docGetResp
        store:
          api: cd
          dataIn: MessageShow.apiRequest.folder.docCreateReq
    folderTag:
      docCreateResp: ""
      docCreateReq:
        type: .DocType.MailFolderTag
        eid: .Global.rootNotebookID
        fid: ""
        reid: .Global.email.id
        name:
          data: ""
      docAPI:
        store:
          api: cd
          dataIn: MessageShow.apiRequest.folderTag.docCreateReq
          dataOut: MessageShow.apiRequest.folderTag.docCreateResp
  components:
    - .BasePublicHeader:
      children:
        - .BasePublicHeaderLeft:
        - .BasePublicHeaderTitle:
    - type: view
      style:
        width: "1"
        height: "0.8"
        # top: "0.1"
        left: "0"
        display: "block"
      viewTag: funbar
      children:
        - type: view
          style:
            width: "1"
            left: "0"
            height: "0.15"
            zIndex: "10"
            border:
              style: "2"
            borderColor: "0xe9e9eb"
            borderWidth: "1"
            position: "relative"
          children:
            - type: label
              text=func: .builtIn.string.formatUnixtime_en
              dataKey: Global.email.ctime
              style:
                top: "0.02"
                height: "auto"
                width: "0.7"
                textAlign:
                  y: center
                left: "0.05"
                fontSize: .Nfont.h12
                color: "0xBCC5D3"
            - type: label
              dataKey: Global.email.name.title
              style:
                fontSize: .Nfont.h16
                # fontWeight: "500"

                left: "0.05"
                top: "0.045"
                width: "0.9"
            - type: label
              text: "From:"
              style:
                left: "0.05"
                top: "0.085"
                height: "0.035"
                fontSize: .Nfont.h14
                textAlign:
                  x: left
            - type: label
              text: Blair Zhang
              dataKey: Global.email.name.data.senderName
              style:
                fontSize: .Nfont.h14
                fontWeight: "450"
                height: "0.035"
                width: "0.6"
                color: "0xBCC5D3"
                left: "0.2"
                top: "0.085"
                textAlign:
                  x: left
            - type: label
              text: "To:"
              style:
                left: "0.05"
                top: "0.115"
                height: "0.035"
                fontSize: .Nfont.h14
                textAlign:
                  x: left
            - type: label
              text:
              dataKey: Global.email.name.data.receiverName
              style:
                fontSize: .Nfont.h14
                fontWeight: "450"
                height: "0.035"
                width: "0.6"
                color: "0xBCC5D3"
                left: "0.2"
                top: "0.115"
                textAlign:
                  x: left
        - type: image
          viewTag: select
          path:
            emit:
              actions:
                - if:
                    - =.builtIn.number.typeIsValid:
                        dataIn:
                          docType: =..apiRequest.emailTag.docQueryResp.doc.0.type
                          localArr: [3]
                          binaryArr: [1]
                    - providerOn.svg
                    - providerOff.svg
          onClick:
            - actionType: evalObject
              object:
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""
                #修改start的内容
                - if:
                    - =..apiRequest.emailTag.docQueryResp.doc
                    - ..apiRequest.emailTag.docCreateReq@: =..apiRequest.emailTag.docQueryResp.doc.0
                    - continue
                - =.builtIn.number.inhx:
                    dataIn:
                      intHex: =..apiRequest.emailTag.docCreateReq.type
                      index: 3
                      hex: =..isStar
                    dataOut: MessageShow.apiRequest.emailTag.docCreateReq.type
                - =..apiRequest.emailTag.docAPI.store: ""
            - actionType: evalObject
              object:
                - .MessageShow.apiRequest.emailTag.docQueryResp.doc@: []
                - =.builtIn.array.add:
                    dataIn:
                      object: =.MessageShow.apiRequest.emailTag.docQueryResp.doc
                      value: =.MessageShow.apiRequest.emailTag.docCreateResp.doc
                - if:
                    - =..isStar
                    - ..isStar@: 0
                    - ..isStar@: 1
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""
            - actionType: builtIn
              funcName: redraw
              viewTag: select
          style:
            height: "0.025"
            left: "0.88"
            top: "0.09"
            zIndex: "100"
        - type: view
          style:
            display: ..formData.display.normalType
            top: "0.16"
            left: "0"
            width: "1"
            height: "0.42"
          children:
            - type: textView
              isEditable: "false"
              dataKey: Global.email.name.data.content
              style:
                top: "0.01"
                width: "0.9"
                left: "0.05"

                fontSize: "14"
                height: "0.4"
                backgroundColor: "0xffffff"
                color: "0x757575"
                fontWeight: 300
                # isEditable: "false"
                border:
                  style: "2"
                  color: "0xEFEFEF"
                  width: "1"
            - type: view
              style:
                top: "0.1"
                left: "0"
                width: "1"
                height: "0.43"
                #backgroundColor: "0xcdcdcd"
              children:
                - type: ecosDoc
                  ecosObj: ..docDetail.document
                  style:
                    width: "0.9"
                    left: "0.05"
                    height: "0.4"
                    color: "0x757575"
                    isEditable: "false"
                    border:
                      style: "1"
                    textAlign:
                      y: top
        - type: view
          style:
            ..style.messageBox:
          children:
            - type: label
              textBoard:
                - text: "Hello,"
                - br:
                - br:
                - text: "Facility Name"
                  color: "#2988e6"
                  dataKey: Global.email.name.data.sendTrueName
                - text: " has updated your demographics.Please click the “view” button below to check the changes or update your profile"
              style:
                ..style.message:

            - type: view
              style:
                ..style.viewBox:
              onClick:
                - ..event.btn_gotoComparisonProfile
              children:
                - type: view
                  style:
                    width: auto
                    height: auto
                  children:
                    - type: label
                      text: View
                      style:
                        ..style.viewLabel:
                    - type: image
                      path: rightCircleImg.svg
                      style:
                        ..style.viewImg:
        - type: view
          style:
            top: "0.16"
            display: ..formData.display.recommendationNotification
            marginLeft: "0.01"
            width: "0.92"
          children:
            # email content
            - type: view
              style:
                ..style.emailContentBox:
                marginLeft: "0.04"
              children:
                - type: label
                  text: Hello,
                  dataKey:
                  style:
                    lineHeight: "2.58vh"
                    width: "0.92"
                - type: view
                  style:
                    marginTop: "0.0246"
                  children:
                    - type: label
                      textBoard:
                        - text: "There is the recommendation by&nbsp;"
                        - text: "{ provide name }"
                          dataKey: Global.email.name.data.providerName
                          ..style.provideName:
                        - text: "."
                      dataKey:
                      style:
                        lineHeight: "2.58vh"
                        width: "0.92"
                - type: label
                  text: Please check the appointment details and the recommendations follow.
                  dataKey:
                  style:
                    lineHeight: "2.58vh"
                    width: "0.92"
            # Dividing lines
            - type: view
              style:
                ..style.dividingLine:
              children:
                - type: view
                  children:
                    - type: label
                      text: "………………"
                      dataKey:
                      style:
                        ..style.line:
                    - type: label
                      text: "&nbsp;&nbsp;Original Appointment&nbsp;&nbsp;"
                      dataKey:
                      style:
                        ..style.lineTips:
                    - type: label
                      text: "………………"
                      dataKey:
                      style:
                        ..style.line:
            # medical recommendation
            - type: view
              style:
                ..style.recommendationBox:
                backgroundColor: "#f4f4f4"
                borderRadius: "4"
                marginLeft: "0.04"
                fontSize: .Nfont.h14
              children:
                - type: label
                  text: Medical Recommendation
                  dataKey:
                  style:
                    ..style.recommendationStyle:
                    width: "0.65"
                    verticalAlign: middle
                    fontWeight: 600
                - type: view
                  style:
                    ..style.enterBtnBox:
                    verticalAlign: middle
                  onClick:
                    - ..event.enterRecommendationClick
                  children:
                    - type: label
                      text: Enter
                      dataKey:
                      style:
                        ..style.enterBtn:
                    - type: image
                      path: rightEnter.svg
                      style:
                        ..style.arrowRightImg:
            - type: view
              style:
                ..style.auto:
                backgroundColor: "#f4f4f4"
                borderRadius: "4"
                marginLeft: "0.04"
                marginTop: "0.024630"
                width: "0.9"
                fontSize: .Nfont.h14
              children:
                # Appointment info
                - type: view
                  style:
                    ..style.recommendationBox:
                    marginTop: "0"
                    # borderRadius: "4px 4px 0 0"
                    borderBottom: "2px solid #dededf"
                  children:
                    - type: view
                      style:
                      children:
                        - type: label
                          text: Appointment info
                          dataKey:
                          style:
                            ..style.recommendationStyle:
                            width: "0.65"
                            fontWeight: 600
                        - type: view
                          style:
                            ..style.enterBtnBox:
                          onClick:
                            - ..event.enterAppointmentClick
                          children:
                            - type: view
                              style:
                                ..style.auto:
                              children:
                                - type: label
                                  text: Enter
                                  dataKey:
                                  style:
                                    ..style.enterBtn:
                                - type: image
                                  path: rightEnter.svg
                                  style:
                                    ..style.arrowRightImg:
                # Appointment info label
                - type: view
                  style:
                    ..style.appointmentInfoLabelBox:
                  children:
                    # date
                    - type: view
                      style:
                      children:
                        - type: label
                          text: Date
                          dataKey:
                          style:
                            ..style.appointmentInfoLabelTitle:
                        - type: label
                          text=func: .builtIn.string.formatUnixtimeL_en
                          dataKey: apiRequest.appointment.edgeQueryResp.edge.0.stime
                          style:
                            ..style.appointmentInfoLabelContent:
                    # time
                    - type: view
                      style:
                        marginTop: "0.0073"
                      children:
                        - type: label
                          text: Time
                          dataKey:
                          style:
                            ..style.appointmentInfoLabelTitle:
                        - type: label
                          text=func: .builtIn.date.ShowTimeSpan
                          dataKey: apiRequest.appointment.edgeQueryResp.edge.0
                          style:
                            ..style.appointmentInfoLabelContent:
                    #  reason for visit
                    - type: view
                      style:
                        marginTop: "0.0073"
                      children:
                        - type: label
                          text: Reason For Vistit
                          dataKey:
                          style:
                            ..style.appointmentInfoLabelTitle:
                        - type: label
                          dataKey: apiRequest.appointment.edgeQueryResp.edge.0.name.Reason
                          style:
                            ..style.appointmentInfoLabelContent:
                    # appointment type
                    - type: view
                      style:
                        marginTop: "0.0073"
                      children:
                        - type: label
                          text: Appointment Type
                          dataKey:
                          style:
                            ..style.appointmentInfoLabelTitle:
                        - type: label
                          dataKey: apiRequest.appointment.edgeQueryResp.edge.0.name.visitType
                          style:
                            ..style.appointmentInfoLabelContent:
                    # patient
                    - type: view
                      style:
                        marginTop: "0.0073"
                      children:
                        - type: label
                          text: Patient
                          dataKey:
                          style:
                            ..style.appointmentInfoLabelTitle:
                        - type: label
                          dataKey: apiRequest.appointment.edgeQueryResp.edge.0.name.patientName
                          style:
                            ..style.appointmentInfoLabelContent:
                    # facility
                    - type: view
                      style:
                        marginTop: "0.0073"
                      children:
                        - type: label
                          text: Facility
                          dataKey:
                          style:
                            ..style.appointmentInfoLabelTitle:
                        - type: label
                          dataKey: apiRequest.appointment.edgeQueryResp.edge.0.name.locationName
                          style:
                            ..style.appointmentInfoLabelContent:
        - type: view
          style:
            display: ..formData.display.order
            marginLeft: "0.01"
            width: "0.98"
            top: "0.16"
            overflow: hidden
            fontSize: .Nfont.h14
          children:
            # email content
            - type: view
              style:
                ..style.emailContentBox:
                width: "0.9"
                marginLeft: "0.04"

              children:
                - type: label
                  text: Hello,
                  dataKey:
                  style:
                    lineHeight: "2.58vh"
                    width: "0.9"
                - type: label
                  text: Thank you for shopping at AiTmed. Please allow us up to two business days to process your order.
                  dataKey:
                  style:
                    marginTop: "0.0246"
                    lineHeight: "2.58vh"
                    width: "0.9"
                - type: label
                  text: Below,  you can check the order details.
                  dataKey:
                  style:
                    width: "0.9"
                - type: label
                  text: If you have any questions regarding your order,  please contact AiTmed at +1 88888888.
                  dataKey:
                  style:
                    lineHeight: "2.58vh"
                    width: "0.9"
            # Dividing lines
            - type: view
              style:
                ..style.dividingLine:
                width: "0.98"
              children:
                - type: view
                  children:
                    - type: label
                      text: "………………"
                      dataKey:
                      style:
                        ..style.line:
                    - type: label
                      text: "&nbsp;&nbsp;Original Appointment&nbsp;&nbsp;"
                      dataKey:
                      style:
                        ..style.lineTips:
                    - type: label
                      text: "………………"
                      dataKey:
                      style:
                        ..style.line:
            # Order Details
            - type: view
              style:
                ..style.recommendationBox:
                backgroundColor: "#f4f4f4"
                borderRadius: "4"
                marginLeft: "0.04"
                width: "0.9"
                boxSizing: border-box
              children:
                - type: label
                  text: Order Details
                  dataKey:
                  style:
                    ..style.recommendationStyle:
                    width: "0.65"
                    verticalAlign: middle
                - type: view
                  style:
                    ..style.enterBtnBox:
                    verticalAlign: middle
                  onClick:
                    - ..event.enterOrderDetail
                  children:
                    - type: label
                      text: Enter
                      dataKey:
                      style:
                        ..style.enterBtn:
                    - type: image
                      path: rightEnter.svg
                      style:
                        ..style.arrowRightImg:
        - type: view
          style:
            ..style.acceptAmendmentView:
          children:
            - type: label
              textBoard:
                - text: "Hello,"
                - br:
                - br:
                - text: ""
                  dataKey: Global.email.name.data.executorName
                - text: " has updated the "
                - text: ""
                  dataKey: Global.email.name.data.recordName
                - text: "."
              style:
                fontSize: .Nfont.h14
            - type: view
              style:
                ..style.viewBox:
              children:
                - type: view
                  onClick:
                    - ..event.toProviderNote
                  children:
                    - type: label
                      text: View Details
                      style:
                        ..style.viewLabel:
                    - type: image
                      path: rightCircleImg.svg
                      style:
                        ..style.viewImg:
        - type: view
          style:
            display: ..formData.display.denyAmendment
            ..style.acceptAmendmentView:
          children:
            - type: label
              textBoard:
                - text: "Hello,"
                - br:
                - br:
                - text: ""
                  dataKey: Global.email.name.data.executorName
                - text: " has denied Patient Amendment Request."
                - br:
                - br: 
                - text: "Reason:"
                - text: ""
                  dataKey: Global.email.name.data.denyReason
              style:
                fontSize: .Nfont.h14   
        - type: scrollView
          style:
            top: "0.57"
            width: "1"
            height: "0.22"
          children:
            - type: list
              contentType: listObject
              listObject: ..apiRequest.attachment.docQueryResp.doc
              iteratorVar: itemObject
              style:
                left: "0"
                top: "0.01"
                width: "1"
                height: "auto"
                backgroundColor: "0xffffff"
              children:
                - type: listItem
                  itemObject: ""
                  style:
                    marginTop: "0.001"
                    left: "0"
                    width: "1"
                    height: "0.05"
                  onClick:
                    - actionType: updateObject
                      dataKey: Global.showAttachment
                      dataObject: itemObject
                    - goto: ShowAttachment
                  children:
                    - type: view
                      style:
                        top: "0.001"
                        left: "0.05"
                        width: "0.9"
                        height: "0.049"
                        backgroundColor: "0xf8f9fa"
                        borderWidth: "1"
                        borderRadius: "10"
                        border:
                          style: "1"
                      children:
                        - type: image
                          path: blackAttachment.svg
                          style:
                            top: "0.01"
                            height: "0.03"
                            left: "0.03"
                        - type: label
                          dataKey: itemObject.name.title #需要加name.type
                          style:
                            top: "0"
                            textAlign:
                              y: center
                            height: "0.049"
                            width: "0.45"
                            left: "0.13"
                            overflow: hidden
                            text-overflow: ellipsis
                            whiteSpace: nowrap
                            fontSize: .Nfont.h2
                        - type: label
                          text=func: .builtIn.string.bitFormatting
                          dataKey: itemObject.size
                          style:
                            top: "0"
                            height: "0.049"
                            width: "0.3"
                            left: "0.58"
                            fontSize: .Nfont.h2
                            textAlign:
                              x: right
                              y: center
                            color: "0xbcc5d3"
    - type: view
      style:
        top: "0.9"
        width: "1"
        height: "0.1"
        backgroundColor: "0xffffff"
        boxShadow: "0 -2px 3px -1px #7070702a"
      children:
        - type: image
          path: trash.svg
          onClick:
            - actionType: popUp
              popUpView: tashComfirm
          style:
            left: "0.12"
            top: "0.03"
            height: "0.04"
        - type: image
          path: move.svg
          onClick:
            - actionType: popUp
              popUpView: folderPopUpView
          style:
            left: "0.4"
            top: "0.03"
            height: "0.04"
        - type: image
          path: reply.svg
          onClick: #reply 只能发送一个，再次回复只有一个邮件发生变化，而不是生成
            - goto: NewMessage2
          style:
            left: "0.67"
            top: "0.03"
            height: "0.04"
    - type: popUp
      viewTag: moveView
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "0.8"
        zIndex: "20"
      children:
        - type: view
          onClick:
            - actionType: popUpDismiss
              popUpView: moveView
          style:
            top: "0"
            left: "0"
            width: "1"
            height: "0.8"
        - type: list
          contentType: listObject
          listObject: ..listData.folderList.edge
          iteratorVar: itemObject
          style:
            left: "0.35"
            width: "0.29"
            top: "0.075"
            backgroundColor: "0x2988e6"
            height: auto
            # height: "0.08"
            # left: "0"
            marginTop: "0"
          children:
            - type: listItem
              itemObject: ""
              onClick:
                - actionType: updateObject
                  dataKey: MessageShow.inboxFolder
                  dataObject: itemObject.id
                - actionType: evalObject
                  object:
                    ..email.edge.name.folderID@: =..inboxFolder.id
                - actionType: evalObject
                  object:
                    - =..email.edgeAPI.store: ""
                - actionType: popUpDismiss
                  popUpView: moveView
              style:
                left: "0"
                width: "0.29"
                height: "0.04"
                border:
                  style: "2"
                borderColor: "0xffffff"
                borderWidth: "1"
              children:
                - type: label
                  dataKey: itemObject.name.folderName
                  style:
                    left: "0"
                    height: "0.04"
                    top: "0.005"
                    width: "0.29"
                    color: "0xffffff"
                    textAlign:
                      x: center
    - .TipsTitleMultiLine:
      viewTag: notExist
      tipstitle: Appointment Not Exist
      message: The appointment has been canceled
    - type: popUp
      viewTag: folderPopUpView
      style:
        left: "0"
        top: "0"
        height: "1"
        width: "1"
        zIndex: "100"
        backgroundColor: "0x00000033"
      children:
        - type: view
          style:
            width: "1"
            height: "0.64"
          onClick:
            - actionType: popUpDismiss
              popUpView: folderPopUpView
        - type: view
          style:
            top: "0.64"
            left: "0"
            width: "1"
            height: "0.36"
            backgroundColor: "0xFFFFFF"
            borderRadius: "10px 10px 0 0"
          children:
            - type: list
              contentType: listObject
              listObject: ..apiRequest.folder.docGetResp.doc
              iteratorVar: itemObject
              style:
                marginTop: "0.01"
                width: "1"
                height: "0.2"
                overflow: scroll
              children:
                - type: listItem
                  itemObject:
                  onClick:
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - ..apiRequest.folderTag.docCreateReq.fid@: $var.id
                          - =..apiRequest.folderTag.docAPI.store: ""
                    - goto: InboxDashboard
                  style:
                    width: "1"
                    height: "0.049"
                    marginTop: "0.001"
                    border:
                      style: 2
                    borderColor: "0xf0f0f0"
                    borderWidth: "1"
                  children:
                    - type: image
                      path: folderShow.svg
                      style:
                        marginTop: "0.4vw"
                        height: "0.03"
                        left: "0.08"
                        top: "0.01"
                    - type: label
                      dataKey: itemObject.name.title
                      style:
                        left: "0.18"
                        width: "0.3"
                        height: "0.048"
                        top: "0"
                        textAlign:
                          y: center
            - type: view
              style:
                marginTop: "0.01"
                width: "1"
                height: "0.08"
              children:
                - type: image
                  path: AddNewFolder.svg
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: folderPopUpView
                    - actionType: popUp
                      popUpView: addFolderPopUpView
                  style:
                    height: "0.055"
                    width: "0.6"
                    left: "0.2"
    - type: popUp
      title: Add New Folder
      viewTag: addFolderPopUpView
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        backgroundColor: "0xffffff55"
        zIndex: 100000
      children:
        - type: view
          style:
            left: "0.15"
            width: "0.7"
            top: "0.32"
            height: "0.18"
            backgroundColor: "0xe5e5e5"
            border:
              style: "5"
            borderWidth: "1"
            borderRadius: "10"
          children:
            - type: label
              text: ___.title
              style:
                left: "0.1"
                width: "0.5"
                top: "0.01"
                height: "0.06"
                fontSize: .Nfont.h2
                color: "0x4b4b4b"
                backgroundColor: "0xe5e5e5"
                borderWidth: "1"
                borderColor: "0x3f3f3f66"
                textAlign:
                  x: center
                  y: center
            - type: textField
              placeholder: Enter name here
              dataKey: apiRequest.folder.docCreateReq.name.title
              style:
                left: "0.04"
                top: "0.07"
                width: "0.62"
                border:
                  style: "3"
                borderWidth: "1"
                borderColor: "0xc4c4c6"
                height: "0.03"
                backgroundColor: "0xffffff"
                textAlign:
                  x: left
                  y: center
            - type: view
              style:
                left: "0"
                top: "0.128"
                width: "0.7"
                height: "0.001"
                backgroundColor: "0x999999"
                margin: "0"
            - type: view
              style:
                left: "0.35"
                top: "0.128"
                width: "0.002"
                height: "0.052"
                backgroundColor: "0x999999"
            - type: label
              text: Cancel
              style:
                left: "0.01"
                width: "0.33"
                top: "0.13"
                height: "0.045"
                fontSize: .Nfont.h2
                backgroundColor: "0xe5e5e5"
                border:
                  style: "1"
                color: "0x007aff"
                textAlign:
                  x: center
                  y: center
              onClick:
                - actionType: popUpDismiss
                  popUpView: addFolderPopUpView
            - type: label
              text: Ok
              style:
                left: "0.36"
                width: "0.33"
                top: "0.13"
                height: "0.045"
                fontSize: .Nfont.h2
                backgroundColor: "0xe5e5e5"
                border:
                  style: "1"
                color: "0x007aff"
                textAlign:
                  x: center
                  y: center
              onClick:
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.array.checkElememtExist:
                            dataIn:
                              objArr: =..apiRequest.folder.docGetResp.doc
                              values: =..apiRequest.folder.docCreateReq.name.title
                        - actionType: popUp
                          popUpView: folderUniqueErrorPopUp
                        - actionType: evalObject
                          object:
                            - .Global.createjwt.edge.bvid@: =.Global.currentUser.vertex.id
                            - =.Global.createjwt.edgeAPI.store: ""
                            - =..apiRequest.folder.docAPI.store: ""
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""
                - actionType: evalObject
                  object:
                    - =..apiRequest.folder.docAPI.get: ""
                - actionType: builtIn
                  funcName: redraw
                  viewTag: folderPopUpView
                - actionType: popUpDismiss
                  popUpView: addFolderPopUpView
                - actionType: popUp
                  popUpView: folderPopUpView
                - actionType: evalObject
                  object:
                    - ..apiRequest.folder.docCreateReq.name.title@: ""
                - actionType: builtIn
                  funcName: redraw
                  viewTag: addFolderPopUpView
    - .simplePopup:
      message: "Are you sure you want to delete the message?"
      viewTag: tashComfirm
      children:
        - .simplePopupView:
          children:
            - .simplePopupLable:
            - .simplePopupSplit1:
            - .simplePopupSplit2:
            - .simplePopupLeftButton:
            - .simplePopupRightButton:
              onClick:
                - actionType: evalObject
                  object:
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - =..apiRequest.emailTag.docAPI.get: ""
                    - ..apiRequest.emailTag.docCreateReq@: =..apiRequest.emailTag.docQueryResp.doc.0
                    - =.builtIn.number.inhx:
                        dataIn:
                          intHex: =..apiRequest.emailTag.docCreateReq.type
                          index: 2
                          hex: 1
                        dataOut: MessageShow.apiRequest.emailTag.docCreateReq.type
                    - =.builtIn.number.inhx:
                        dataIn:
                          intHex: =..apiRequest.emailTag.docCreateReq.type
                          index: 3
                          hex: 0
                        dataOut: MessageShow.apiRequest.emailTag.docCreateReq.type
                    - =.builtIn.number.inhx:
                        dataIn:
                          intHex: =..apiRequest.emailTag.docCreateReq.type
                          index: 4
                          hex: 1
                        dataOut: MessageShow.apiRequest.emailTag.docCreateReq.type
                    - =..apiRequest.emailTag.docAPI.store: ""
                - goto: InboxDashboard
    - .SoftTips:
      type: popUp
      viewTag: tag_notUpdatePatientProfile
      message: "You have updated it. Please view it in your profile."
  style:
    acceptAmendmentView:
      display: ..formData.display.acceptAmendment
      marginTop: "0.01477"
      marginLeft: "0.04"
      height: "auto"
      top: "0.16"
      width: "0.92"
      overflow: hidden
    appointmentInfoLabelContent:
      display: "inline-block"
      width: "0.48"
      color: "#333333"
      wordBreak: break-word
      textAlign:
        x: right
    appointmentInfoLabelTitle:
      display: "inline-block"
      width: "0.32"
      color: "#333333"
      fontWeight: 600
      whiteSpace: "nowrap"
      overflow: hidden
      text-overflow: "ellipsis"
    # appointment info
    appointmentInfoLabelBox:
      # backgroundColor: "#f4f4f4"
      # borderRadius: "0 0 4px 4px"
      paddingTop: "0.0172"
      paddingBottom: "0.0246"
      paddingLeft: "0.04"
      paddingRight: "0.036666"
      # boxSizing: "content-box"
    arrowRightImg:
      width: "0.0426"
      height: "0.0197"
      verticalAlign: middle
      display: "inline-block"
    enterBtnBox:
      display: "inline-block"
      width: "0.152"
      textAlign:
        x: right
    recommendationStyle:
      display: "inline-block"
      width: "0.70"
      color: "#333333"
      whiteSpace: "nowrap"
      overflow: hidden
      text-overflow: "ellipsis"
    # medical recommendation
    recommendationBox:
      fontWeight: 600
      width: "0.9"
      # backgroundColor: "#f4f4f4"
      # borderRadius: "4"
      paddingTop: "0.0123"
      paddingBottom: "0.0123"
      paddingLeft: "0.04"
      paddingRight: "0.026666"
      marginTop: "0.024630"
      boxSizing: "border-box"
    lineTips:
      display: "inline-block"
      fontSize: .Nfont.h12
      color: "#666666"
    line:
      display: "inline-block"
      fontSize: .Nfont.h14
      lineHeight: "1.10837vh"
      color: "#666666"
    enterBtn:
      color: "#2988e6"
      display: "inline-block"
      textDecoration: underline
    # dividing line
    dividingLine:
      # display: "inline-block"
      width: "0.92"
      marginTop: "0.0874"
      textAlign:
        x: center
    provideName:
      display: "inline-block"
      marginLeft: "0.01"
      color: "#2988e6"
    emailContentBox:
      marginTop: "0.014778"
      color: "#333333"
      lineHeight: "2.58vh"
    messageBox:
      display: ..formData.display.updatePatientProfile
      marginTop: "0.01477"
      marginLeft: "0.04"
      height: "auto"
      top: "0.16"
      width: "0.92"
      overflow: hidden
    message:
      fontSize: .Nfont.h14
      width: "0.925"
      height: "auto"
      color: "#333333"
      lineHeight: "2.58vh"
      wordBreak: break-word
    viewBox:
      marginTop: "0.0307881"
      width: "0.92"
      height: "auto"
      textAlign:
        x: right
    viewLabel:
      fontSize: .Nfont.h14
      color: "#2988e6"
      fontWeight: "600"
      display: "inline-block"
      verticalAlign: middle
    viewImg:
      marginLeft: "0.02"
      display: "inline-block"
      height: "0.019704"
      verticalAlign: middle
    auto:
      width: auto
      height: auto
  event:
    toProviderNote:
      - actionType: evalObject
        object:
          .Global._nonce@:
            =.builtIn.math.random: ""
      - actionType: evalObject
        object:
          # 查回accept邮件对应的provider note
          - ..apiRequest.amendent.docQueryReq.id@: =.Global.email.esig
          - =..apiRequest.amendent.docAPI.get: ""
          - ..apiRequest.providerNote.docQueryReq.id@: =..apiRequest.amendent.docQueryResp.doc.0.fid
          - =..apiRequest.providerNote.docAPI.get: ""
          # 获取应该跳转到的页面
          - =.builtIn.array.setFormJumpPage:
              dataIn:
                objArry: =..apiRequest.providerNote.docQueryResp.doc
                docFormObj: =.DocumentList
              dataOut: MessageShow.formData.docJumpList
          # 获取进入页面需要的信息
          # 获取会议的edge
          - ..apiRequest.roomInfo.edgeQueryReq.id@: =..formData.docJumpList.0.esig
          # 获取这个文档所在的eid，可能是40000，也可能是1053
          - ..apiRequest.currentRoom.edgeQueryReq.id@: =..formData.docJumpList.0.eid
          # 取回源文档会议下diagnoses信息
          - =.builtIn.array.add:
              dataIn:
                object: =..apiRequest.diagnosesDoc.docReq.id
                value: =..formData.docJumpList.0.eid
          - =.builtIn.array.add:
              dataIn:
                object: =..apiRequest.diagnosesDoc.docReq.id
                value: =..formData.docJumpList.0.esig
          # 查询
          - actionType: evalObject
            async: true
            object:
              - =..apiRequest.diagnosesDoc.docAPI.get: ""
              - =..apiRequest.roomInfo.edgeAPI.get: ""
              - =..apiRequest.currentRoom.edgeAPI.get: ""  
          - if:
              - =.builtIn.array.judgeListLength:
                  dataIn:
                    array: =..apiRequest.diagnosesDoc.docResp.doc
                    len: 0
              - .Global.formData.providerDoc.diagnosesDoc@: ""
              - .Global.formData.providerDoc.diagnosesDoc@: =..apiRequest.diagnosesDoc.docResp.doc.0
          - .Global.roomInfo.edge@: =..apiRequest.roomInfo.edgeQueryResp.edge.0
          - .Global.currentRoom.edge@: =..apiRequest.currentRoom.edgeQueryResp.edge.0  
          - .Global.Note@: =..formData.docJumpList.0
          - goto: =..formData.docJumpList.0.pageName
    # 进入订单完成界面
    enterOrderDetail:
      - actionType: evalObject
        object:
          - =..apiRequest.order.docAPI.get: ""
          - =..apiRequest.commerceCheckOrder.docAPI.get: ""
          - .Global.formData.currentOrder@: []
          - =.builtIn.object.extract:
              dataIn:
                array: =..apiRequest.order.docQueryResp.doc
                field: name.data.orderList
              dataOut: Global.formData.currentOrder
          - =.builtIn.array.flatArray:
              dataIn:
                param: =.Global.formData.currentOrder
              dataOut: Global.formData.currentOrder
          - goto: OrderDetails
    enterRecommendationClick:
      - actionType: evalObject
        object:
          # 控制是否显示MedicalRecommendation下detail入口
          - .Global.formData.medicalStatus@: false
          - ..apiRequest.medicalRecommendation.docQueryReq.id@: =..apiRequest.appointment.edgeQueryResp.edge.0.id
          - =..apiRequest.medicalRecommendation.docAPI.get: ""
          - .Global.Note@: =..apiRequest.medicalRecommendation.docQueryResp.doc.0
          - goto: MedicalRecommendation
    enterAppointmentClick:
      - actionType: evalObject
        object:
          - =..apiRequest.getIsCancel.edgeAPI.get: ""
      - actionType: evalObject
        object:

          - if:
              - =.builtIn.array.judgeListLength:
                  dataIn:
                    array: =..apiRequest.getIsCancel.cancelEdge.edge
                    len: 0
              - continue
              - actionType: popUp
                popUpView: notExist
                wait: true
                popUpDismiss: 2000
          - if:
              - =.builtIn.number.typeIsValid:
                  dataIn:
                    docType: =.Global.roomInfo.edge.subtype
                    localArr: [17]
                    binaryArr: [1]
              - goto: AppointmentLobby
              - goto: AppointmentLobbyOfficeVisit
    btn_gotoComparisonProfile:
      - actionType: evalObject
        object:
          .Global._nonce@:
            =.builtIn.math.random: ""
      - actionType: evalObject
        object:
          - .Global.MiddlePage.updatePatientProfilePage@: "MessageShow"
          - =..apiRequest.profileFromRelation.docAPI.get: ""
          - ..apiRequest.hashTagFromRelationProfile.docQueryReq.id@: =..apiRequest.profileFromRelation.docQueryResp.doc.0.id
          - =..apiRequest.hashTagFromRelationProfile.docAPI.get: ""
          - if:
              - =.builtIn.math.greater:
                  dataIn:
                    num1: =.Global.formData.hashTag.name.data.hashTime
                    num2: =..apiRequest.hashTagFromRelationProfile.docQueryResp.doc.0.name.data.hashTime
              - actionType: popUp
                popUpView: tag_notUpdatePatientProfile
                wait: 2000
              - actionType: evalObject
                object:
                  - .Global.formData.sourceProfile@: =.Global.Profile
                  - .Global.formData.targetProfile@: =..apiRequest.profileFromRelation.docQueryResp.doc.0
                  - .Global.formData.hashTagFromtargetProfile@: =..apiRequest.hashTagFromRelationProfile.docQueryResp.doc.0
                  - goto: ComparisonProfile
