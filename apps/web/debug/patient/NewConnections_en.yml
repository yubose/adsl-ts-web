NewConnections:
  title: "New Connections"
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - =.builtIn.utils.setTimer:
        dataIn:
          timeUnix: 2000
    - ..invite.edgeAPI.get
    - ..apiRequest.newFacilities.edgeAPI.get
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =..invite.inviteList.edge
              len: 0
        - ..formDataTemp.providerStyle@: "none"
        - continue
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =..apiRequest.newFacilities.newFacilitiesList.edge
              len: 0
        - ..formDataTemp.facilityStyle@: "none"
        - continue
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =..invite.inviteList.edge
              len: 0
        - actionType: evalObject
          object:
            - if:
                - =.builtIn.array.judgeListLength:
                    dataIn:
                      array: =..apiRequest.newFacilities.newFacilitiesList.edge
                      len: 0
                - actionType: evalObject
                  object:
                    - ..formDataTemp.facilityStyle@: "none"
                    - ..formDataTemp.providerStyle@: "none"
                    - ..formDataTemp.viewInfoImageStyle@: "block"
                - continue
        - continue
    - =.builtIn.array.getListLength:
        dataIn:
          object: =..invite.inviteList.edge
        dataOut: NewConnections.formDataTemp.newConnectionLength
    - =.builtIn.array.getListLength:
        dataIn:
          object: =..apiRequest.newFacilities.newFacilitiesList.edge
        dataOut: NewConnections.formDataTemp.newFacilitiesLength
    - ..apiRequest.insurance.docAPI.get
  relation:
    edgeRes: ""
    edgeReq:
      id:
        - =.Global.currentUser.vertex.id
      xfname: evid,bvid
      obfname: ctime
      maxcount: "1"
      _nonce: =.Global._nonce
      type: .EdgeType.Email
    edgeAPI:
      get:
        api: re
        dataIn: NewConnections.relation.edgeReq
        dataOut: NewConnections.relation.edgeRes
  formDataTemp:
    viewInfoImageStyle: "none"
    inviteTagStyle: "block"
    providerStyle: "block"
    facilityStyle: "block"
    newConnectionLength: "0"
    allConnectionLength: "0"
    newFacilitiesLength: "0"
  formData:
    profile: ""
    hashTagAfterShare: ""
  apiRequest:
    # get all insurance and share to the admin
    insurance:
      docQueryResp: ""
      docQueryReq:
        type: .DocType.InsuranceCard
        ids:
          - .Global.rootNotebookID
          - .Global.Profile.id
        xfname: eid,fid
        _nonce: =.Global._nonce
        obfname: ctime
      docAPI:
        get:
          api: rd
          dataIn: NewConnections.apiRequest.insurance.docQueryReq
          dataOut: NewConnections.apiRequest.insurance.docQueryResp
    facilityProfile:
      docQueryResp: ""
      docQueryReq:
        ObjType: 8
        id: ""
        type: .DocType.FacilityProfile
        xfname: E.bvid
        maxcount: "1"
        obfname: ctime
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: NewConnections.apiRequest.facilityProfile.docQueryReq
          dataOut: NewConnections.apiRequest.facilityProfile.docQueryResp
    profile:
      docQueryResp: ""
      docResponse: ""
      edge:
        id: ""
        xfname: ovid
        obfname: ctime
        maxcount: "1"
        type: .DocType.DoctorPublicProfile
        _nonce: =.Global._nonce
      docAPI:
        get:
          .DocAPI.get: ""
          api: rd
          dataIn: apiRequest.profile.edge
          dataOut: apiRequest.profile.docResponse
    refuse:
      edge:
        .Edge: ""
        type: .EdgeType.Refuse
        bvid: .Global.currentUser.vertex.id
        name: ""
      response: ""
      edgeAPI:
        store:
          api: ce
          dataIn: apiRequest.refuse.edge
          dataOut: apiRequest.refuse.response
    newFacilities:
      newFacilitiesList:
        edge: []
      edgeAPI:
        get:
          api: re
          type: .EdgeType.InviteInfo
          xfname: evid
          id: .Global.currentUser.vertex.id
          maxcount: "10000"
          dataKey: apiRequest.newFacilities.newFacilitiesList
          sCondition: subtype in (131088,131072)
          _nonce: =.Global._nonce
    email:
      docCreateResp: ""
      docCreateReq:
        type: .DocType.InboxMessage
        eid: .Global.rootNotebookID
        name:
          data:
            content: ""
            receiverName: ""
            senderName: .Global.Profile.name.data.basicInfo.fullName
            receiverAvatarId: ""
            haveAttachment: false
          title: Add Friend Reject
          user: .Global.Profile.name.data.basicInfo.avatar
      docAPI:
        store:
          api: cd
          dataIn: NewConnections.apiRequest.email.docCreateReq
          dataOut: NewConnections.apiRequest.email.docCreateResp
  sendNotification:
    document:
      .Document: ""
      eid: "=.NewConnections.accept.response.edge.id"
      subtype:
        isOnServer: 1
        isZipped: 0
        isBinary: 0
        isEncrypted: 0
        isExtraKeyNeeded: 0
        isEditable: 0
        applicationDataType: 0
        # 7 th bit
        notification: 1
        ringToneNotify: 0
        sendtoSelf: 0
        # 10 bit
        textMessage: 0
        mediaType: 8
      type: .DocType.Notification
      name:
        data: ""
        notification:
          title: Aitmed Connection Rejected
          context: Connection request rejected
          body: Connection request rejected
          onClickLandingPage: InboxDashboard
          targetApp: =.FirebaseToken.response.edge.evid
    docAPI:
      store:
        api: cd
        dataIn: sendNotification.document
  invite: #邀请列表 查询1053 中 subtype=65536
    inviteList:
      edge: []
    edgeReq:
      type: .EdgeType.InviteInfo
      xfname: evid
      id: .Global.currentUser.vertex.id
      maxcount: "10000"
      _nonce: =.Global._nonce
      obfname: ctime
      sCondition: subtype=65536
    edgeAPI:
      get:
        api: re
        dataIn: NewConnections.invite.edgeReq
        dataOut: NewConnections.invite.inviteList
      delete:
        api: dx
        dataIn: NewConnections.dataObject
  dataObject: ""
  accept: #同意 type=10002 subtype=65537 0x10001
    response: ""
    edge:
      .Edge: ""
      type: .EdgeType.Accept
      bvid: .Global.currentUser.vertex.id
      name: ""
    edgeAPI:
      store:
        api: ce
        dataIn: accept.edge
        dataOut: NewConnections.accept.response
      update:
        api: ce
        dataIn: NewConnections.dataObject
  refuse:
    edge:
      .Edge: ""
      type: .EdgeType.Refuse
      bvid: .Global.currentUser.vertex.id
      name: ""
    response: ""
    edgeAPI:
      store:
        api: ce
        dataIn: refuse.edge
        dataOut: refuse.response
  response: ""
  temporary:
    response: ""
    edge: ""
    edgeReq:
      id: ""
      xfname: id
      type: 1051
    edgeAPI:
      get:
        api: re
        dataIn: NewConnections.temporary.edgeReq
        dataOut: NewConnections.temporary.response
  acceptReponse:
    edge: ""
    edgeReq:
      id: ""
      xfname: id
      type: 10002
    edgeAPI:
      get:
        api: re
        dataIn: NewConnections.acceptReponse.edgeReq
        dataOut: NewConnections.acceptReponse.edge
  components:
    - .ProgressCheckView: ""
      message: "Accepting ..."
      viewTag: accepting
    - .BasePublicHeader:
        children:
          - .BasePublicHeaderLeft:
          - .BasePublicHeaderTitle:
    - type: view
      style:
        width: "1"
        height: "auto"
      children:
        - type: view
          style:
            margin: "0"
            height: "auto"
            width: "1"
            display: ..formDataTemp.viewInfoImageStyle
          children:
            - type: image
              path: emptyPage.svg
              style:
                width: "0.8"
                marginLeft: "0.1"
                marginTop: "0.05"
            - type: label
              text: "There is no invitation now."
              style:
                fontSize: .Nfont.n2
                width: "0.9"
                marginTop: "0.03"
                marginLeft: "0.05"
                height: "0.05"
                color: "#666666"
                textAlign:
                  x: center
                  y: center
        - type: scrollView
          viewTag: inviteTag
          style:
            left: "0"
            marginTop: "0"
            width: "1"
            height: "auto"
            # display: ..formDataTemp.inviteTagStyle
            backgroundColor: "#ffffff"
          children:
            - type: view
              style:
                marginTop: "0"
                marginLeft: "0"
                width: "1"
                height: "auto"
                display: ..formDataTemp.providerStyle
              children:
                - type: view
                  style:
                    marginTop: "0"
                    marginLeft: "0"
                    width: "1"
                    height: "0.05"
                    backgroundColor: "#f0f0f0"
                  children:
                    - type: label
                      text: "New Providers"
                      style:
                        marginLeft: "0.04"
                        fontSize: .Nfont.h14
                        height: "0.05"
                        width: "0.9"
                        color: "#666666"
                        fontWeight: "600"
                        textAlign:
                          y: center
                - type: list
                  viewTag: profileInfoTag
                  contentType: listObject
                  listObject: ..invite.inviteList.edge
                  iteratorVar: itemObject
                  style:
                    width: "1"
                    margin: "0"
                    height: auto
                  children:
                    - type: listItem
                      itemObject:
                      style:
                        width: "1"
                        height: "auto"
                        overflow: hidden
                      children:
                        - type: view
                          style:
                            marginTop: "0.0198"
                            marginLeft: "0.04"
                            height: "auto"
                            width: "auto"
                          children:
                            - type: view
                              style:
                                verticalAlign: middle
                                display: "inline-block"
                                height: "12vw"
                                width: "12vw"
                                overflow: hidden
                              children:
                                - type: image
                                  path: providerImage.svg
                                  path=func: .builtIn.utils.prepareDocToPath
                                  dataKey: itemObject.name.inviterAvatar
                                  style:
                                    height: "12vw"
                                    width: "12vw"
                            - type: view
                              style:
                                verticalAlign: middle
                                marginLeft: "0.01"
                                display: "inline-block"
                                height: "auto"
                                width: "0.5"
                                overflow: hidden
                              onClick:
                                - emit:
                                    dataKey:
                                      var: itemObject
                                    actions:
                                      - ..apiRequest.profile.edge.id@: $var.bvid
                                      - =..apiRequest.profile.docAPI.get: ""
                                      - .Global.formData.pageName@: "NewConnections"
                                      - .Global.formData.facilityProviderInfo@: =..apiRequest.profile.docResponse.doc.0
                                - goto: FacilityProviderInfo
                              children:
                                - type: label
                                  dataKey: itemObject.name.inviterName
                                  style:
                                    height: "auto"
                                    width: "0.5"
                                    fontSize: .Nfont.h16
                                    wordWrap: break-word
                                    fontWeight: "600"

                                    textDecoration: underline
                                - type: label
                                  dataKey: itemObject.name.specialty
                                  style:
                                    marginTop: "0.005"
                                    width: "0.5"
                                    height: "auto"
                                    fontSize: .Nfont.h14
                                    color: "#333333"

                                    verticalAlign: middle
                                    overflow: hidden
                                    text-overflow: ellipsis
                                    whiteSpace: nowrap
                            - type: view
                              style:
                                verticalAlign: middle
                                marginLeft: "0.01"
                                display: "inline-block"
                                height: "auto"
                                width: "auto"
                                overflow: hidden
                                boxSizing: border-box
                              children:
                                - type: button
                                  text: Accept
                                  onClick:
                                    - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                                      dataKey: NewConnections.dataObject
                                      dataObject: itemObject
                                    - actionType: popUp
                                      popUpView: acceptPopUpView
                                  style:
                                    border:
                                      style: 1
                                    color: "#ffffff"
                                    borderRadius: "4"
                                    fontSize: .Nfont.h12
                                    backgroundColor: "#2fc160"
                                    display: inline-block
                                    verticalAlign: middle
                                    width: "0.15"
                                    height: "0.032"
                                    boxSizing: border-box
                                - type: button
                                  text: Deny
                                  onClick:
                                    - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                                      dataKey: NewConnections.dataObject
                                      dataObject: itemObject
                                    - actionType: popUp
                                      popUpView: denyPopUpView
                                  style:
                                    marginLeft: "0.01"
                                    border:
                                      style: 1
                                    color: "#ffffff"
                                    fontSize: .Nfont.h12
                                    display: inline-block
                                    borderRadius: "4"
                                    backgroundColor: "#dc153c"
                                    verticalAlign: middle
                                    width: "0.15"
                                    height: "0.032"
                                    boxSizing: border-box
                        - type: view
                          style:
                            marginTop: "0.0147"
                            width: "1"
                            height: "auto"
                            border:
                              style: 2
                            borderWidth: "1"
                            borderColor: "#efefef"
            - type: view
              style:
                marginTop: "0"
                marginLeft: "0"
                width: "1"
                height: "auto"
                display: ..formDataTemp.facilityStyle
              children:
                - type: view
                  style:
                    width: "1"
                    height: "0.05"
                    backgroundColor: "#f0f0f0"
                  children:
                    - type: label
                      text: "New Organizations"
                      style:
                        marginLeft: "0.04"
                        fontSize: .Nfont.h14
                        height: "0.05"
                        width: "0.9"
                        color: "#666666"
                        fontWeight: "600"
                        textAlign:
                          y: center
                - type: list
                  viewTag: profileInfoTag
                  contentType: listObject
                  listObject: ..apiRequest.newFacilities.newFacilitiesList.edge
                  iteratorVar: itemObject
                  style:
                    width: "1"
                    margin: "0"
                    height: auto
                  children:
                    - type: listItem
                      itemObject:
                      style:
                        width: "1"
                        height: "auto"
                        overflow: hidden
                      children:
                        - type: view
                          style:
                            marginTop: "0.0198"
                            marginLeft: "0.04"
                            height: "auto"
                            width: "auto"
                          children:
                            - type: view
                              style:
                                verticalAlign: middle
                                display: "inline-block"
                                height: "12vw"
                                width: "12vw"
                                overflow: hidden
                              children:
                                - type: image
                                  path: office-building.svg
                                  path=func: .builtIn.utils.prepareDocToPath
                                  dataKey: itemObject.name.facilityAvatarID
                                  style:
                                    height: "12vw"
                                    width: "12vw"
                            - type: view
                              style:
                                verticalAlign: middle
                                marginLeft: "0.01"
                                display: "inline-block"
                                height: "auto"
                                width: "0.5"
                                overflow: hidden
                              onClick:
                                - emit:
                                    dataKey:
                                      var: itemObject
                                    actions:
                                      - ..apiRequest.facilityProfile.docQueryReq.id@: $var.bvid
                                      - =..apiRequest.facilityProfile.docAPI.get: ""
                                      - .Global.formData.temporaryFacilityId@: =..apiRequest.facilityProfile.docQueryResp.doc.0
                                      - .Global.formData.pageName@: "NewConnections"
                                - goto: ProviderFacilityInfo
                              children:
                                - type: label
                                  dataKey: itemObject.name.inviterName
                                  style:
                                    height: "auto"
                                    width: "0.5"
                                    fontSize: .Nfont.h16
                                    wordWrap: break-word
                                    fontWeight: "600"

                                    textDecoration: underline
                                - type: label
                                  dataKey: itemObject.name.businessType
                                  style:
                                    marginTop: "0.005"
                                    width: "0.5"
                                    height: "auto"
                                    fontSize: .Nfont.h14
                                    color: "#333333"

                                    verticalAlign: middle
                                    overflow: hidden
                                    text-overflow: ellipsis
                                    whiteSpace: nowrap
                            - type: view
                              style:
                                verticalAlign: middle
                                marginLeft: "0.01"
                                display: "inline-block"
                                height: "auto"
                                width: "auto"
                                overflow: hidden
                                boxSizing: border-box
                              children:
                                - type: button
                                  text: Accept
                                  onClick:
                                    - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                                      dataKey: NewConnections.dataObject
                                      dataObject: itemObject
                                    - actionType: popUp
                                      popUpView: acceptFacilityPopUp
                                  style:
                                    border:
                                      style: 1
                                    color: "#ffffff"
                                    borderRadius: "4"
                                    fontSize: .Nfont.h12
                                    backgroundColor: "#2fc160"
                                    display: inline-block
                                    verticalAlign: middle
                                    width: "0.15"
                                    height: "0.032"
                                    boxSizing: border-box
                                - type: button
                                  text: Deny
                                  onClick:
                                    - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                                      dataKey: NewConnections.dataObject
                                      dataObject: itemObject
                                    - actionType: popUp
                                      popUpView: denyFacilityPopUp
                                  style:
                                    marginLeft: "0.01"
                                    border:
                                      style: 1
                                    color: "#ffffff"
                                    fontSize: .Nfont.h12
                                    display: inline-block
                                    borderRadius: "4"
                                    backgroundColor: "#dc153c"
                                    verticalAlign: middle
                                    width: "0.15"
                                    height: "0.032"
                                    boxSizing: border-box
                        - type: view
                          style:
                            marginTop: "0.0147"
                            width: "1"
                            height: "auto"
                            border:
                              style: 2
                            borderWidth: "1"
                            borderColor: "#efefef"
    - type: popUp
      viewTag: acceeptSuccessfullyPopUpView
      style:
        left: "0"
        width: "1"
        top: "0"
        height: "1"
        backgroundColor: "0x00000033"
        zIndex: "1000"
      children:
        - type: view
          style:
            width: "1"
            height: "1"
            top: "0"
            left: "0"
          children:
            - type: view
              style:
                left: "0.3"
                width: "0.4"
                top: "0.35"
                height: "0.14"
                backgroundColor: "0xe5e5e5"
                border:
                  style: "5"
                borderWidth: "1"
                borderRadius: "10"
              children:
                - type: image
                  path: popUpSuccess.svg
                  style:
                    top: "0.02"
                    left: "0.15"
                    height: "0.05"
                - type: label
                  text: "Accept Successfully!"
                  style:
                    top: "0.07"
                    left: "0.02"
                    height: "0.06"
                    width: "0.36"
                    fontSize: .Nfont.h1
                    textAlign:
                      x: center
                      y: center
    - .simplePopup:
      viewTag: acceptPopUpView
      children:
        - .simplePopupView:
          style:
            height: "auto"
            overflow: hidden
          children:
            - type: label
              text: "Your personal information will be shared."
              dataKey:
              style:
                marginTop: "0.04"
                marginLeft: "0.03"
                width: "0.64"
                height: "auto"
                color: "0x4b4b4b"
                fontSize: .Nfont.n2

                textAlign:
                  x: center
                  y: center
            - type: label
              text: "Include: name, date of birth, username, phone number, email, gender and emergency contact"
              dataKey:
              style:
                marginTop: "0.04"
                marginLeft: "0.03"
                width: "0.64"
                height: "auto"
                color: "0x4b4b4b"
                fontSize: 3.2vw

                textAlign:
                  x: center
                  y: center
            - type: view
              style:
                marginTop: "0.04"
                height: "0.001"
                width: "0.72"
                backgroundColor: "0x8f8f90"
            - type: view
              style:
                height: "0.06"
                width: "0.72"
              children:
                - type: button
                  text: "Cancel"
                  style:
                    width: "0.358"
                    height: "0.049"
                    color: "0x007affff"
                    fontSize: .Nfont.h2
                    display: inline-block
                    backgroundColor: "0xe6e6e6"
                    borderRadius: "15"
                    textAlign:
                      x: center
                      y: center
                    border:
                      style: "5"
                      borderRadius: "15"
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: acceptPopUpView
                - type: view
                  style:
                    marginTop: "0"
                    width: "0.002"
                    height: "0.06"
                    display: inline-block
                    backgroundColor: "0x999999"
                - type: button
                  text: "Yes"
                  style:
                    width: "0.358"
                    height: "0.049"
                    color: "0x007affff"
                    fontSize: .Nfont.h2
                    display: inline-block
                    backgroundColor: "0xe6e6e6"
                    borderRadius: "15"
                    textAlign:
                      x: center
                      y: center
                    border:
                      style: "5"
                      borderRadius: "15"
                  onClick:
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - if:
                              - =.builtIn.array.isExist:
                                  dataIn:
                                    array: =.Global.formData.connectionList
                                    phoneNumber: =..dataObject.name.inviterPhoneNumber
                              - =..invite.edgeAPI.delete: ""
                              - continue
                          # 做1060，表示同意
                          - ..accept.edge.evid@: =..dataObject.bvid
                          - ..accept.edge.name@: =..dataObject.name
                          - ..accept.edge.name.inviteeAvatar@: =.Global.formData.avatar.doc.id
                          - ..accept.edge.refid@: =..dataObject.id
                          - =..accept.edgeAPI.store: ""
                          - =.builtIn.ecos.shareDoc:
                              dataIn:
                                sourceDoc: =.Global.Profile
                                targetEdgeID: =.NewConnections.dataObject.refid
                              dataOut: NewConnections.formData.profile
                          - if:
                              - =.Global.formData.hashTag.id
                              - =.builtIn.ecos.shareDoc:
                                  dataIn:
                                    sourceDoc: =.Global.formData.hashTag
                                    targetEdgeID: =..dataObject.refid
                                    reid: =..formData.profile.doc.id
                              - continue
                          - =.builtIn.ecos.shareDocList:
                              dataIn:
                                sourceDocList: =..apiRequest.insurance.docQueryResp.doc
                                targetEdgeID: =.NewConnections.dataObject.refid
                                reid: =..formData.profile.doc.id
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - =..invite.edgeAPI.get: ""
                    - actionType: popUpDismiss
                      popUpView: acceptPopUpView
                    - actionType: popUp
                      popUpView: acceeptSuccessfullyPopUpView
                      wait: 2000
                    - actionType: builtIn
                      funcName: goBack
                      reload: true
    - .simplePopup:
      viewTag: acceptFacilityPopUp
      children:
        - .simplePopupView:
          style:
            height: "auto"
            overflow: hidden
          children:
            - type: label
              text: "Your personal information will be shared."
              dataKey:
              style:
                marginTop: "0.04"
                marginLeft: "0.03"
                width: "0.64"
                height: "auto"
                color: "0x4b4b4b"
                fontSize: .Nfont.n2

                textAlign:
                  x: center
                  y: center
            - type: label
              text: "Include: name, date of birth, username, phone
                number, email, gender and emergency contact"
              dataKey:
              style:
                marginTop: "0.04"
                marginLeft: "0.03"
                width: "0.64"
                height: "auto"
                color: "0x4b4b4b"
                fontSize: 2vw

                textAlign:
                  x: center
                  y: center
            - type: view
              style:
                marginTop: "0.04"
                height: "0.001"
                width: "0.72"
                backgroundColor: "0x8f8f90"
            - type: view
              style:
                height: "0.06"
                width: "0.72"
              children:
                - type: button
                  text: "Cancel"
                  style:
                    width: "0.358"
                    height: "0.049"
                    color: "0x007affff"
                    fontSize: .Nfont.h2
                    display: inline-block
                    backgroundColor: "0xe6e6e6"
                    borderRadius: "15"
                    textAlign:
                      x: center
                      y: center
                    border:
                      style: "5"
                      borderRadius: "15"
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: acceptFacilityPopUp
                - type: view
                  style:
                    marginTop: "0"
                    width: "0.002"
                    height: "0.06"
                    display: inline-block
                    backgroundColor: "0x999999"
                - type: button
                  text: "Yes"
                  style:
                    width: "0.358"
                    height: "0.049"
                    color: "0x007affff"
                    fontSize: .Nfont.h2
                    display: inline-block
                    backgroundColor: "0xe6e6e6"
                    borderRadius: "15"
                    textAlign:
                      x: center
                      y: center
                    border:
                      style: "5"
                      borderRadius: "15"
                  onClick:
                    - actionType: evalObject
                      object:
                        - if:
                            - =.builtIn.array.isExist:
                                dataIn:
                                  array: =.Global.formData.connectionList
                                  phoneNumber: =.NewConnections.dataObject.name.inviterPhoneNumber
                            - =..invite.edgeAPI.delete: ""
                            - continue
                        # 创建同意的边
                        - ..accept.edge.evid@: =.NewConnections.dataObject.bvid
                        - ..accept.edge.name@: =.NewConnections.dataObject.name
                        - ..accept.edge.name.inviteeAvatar@: =.Global.formData.avatar.doc.id
                        - ..accept.edge.refid@: =.NewConnections.dataObject.id
                        - =..accept.edgeAPI.store: ""
                        - ..sendNotification.document.name.notificaiton.context@: "Connection request accepted"
                        - =..sendNotification.document.eid@: =.NewConnections.dataObject.refid
                        - =..sendNotification.docAPI.store: ""
                        - ..sendNotification.document.name.notificaiton.context@: "Connection request rejected"
                        - =.builtIn.ecos.shareDoc:
                            dataIn:
                              sourceDoc: =.Global.Profile
                              targetEdgeID: =.NewConnections.dataObject.refid
                            dataOut: NewConnections.apiRequest.profile.docQueryResp
                        - if:
                            - =.Global.formData.hashTag.id
                            - =.builtIn.ecos.shareDoc:
                                dataIn:
                                  sourceDoc: =.Global.formData.hashTag
                                  targetEdgeID: =.NewConnections.dataObject.refid
                                  reid: =..apiRequest.profile.docQueryResp.doc.id
                                dataOut: NewConnections.formData.hashTagAfterShare
                            - continue
                        - =.builtIn.ecos.shareDocList:
                            dataIn:
                              sourceDocList: =..apiRequest.insurance.docQueryResp.doc
                              targetEdgeID: =.NewConnections.dataObject.refid
                              reid: =..apiRequest.profile.docQueryResp.doc.id
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - =..invite.edgeAPI.get: ""
                    - actionType: popUpDismiss
                      popUpView: acceptFacilityPopUp
                    - actionType: builtIn
                      funcName: goBack
                      reload: true
    - .simplePopup:
      viewTag: denyPopUpView
      children:
        - .simplePopupView:
          style:
            height: "auto"
            overflow: hidden
          children:
            - type: label
              text: "Are you sure you want to deny?"
              dataKey:
              style:
                marginTop: "0.04"
                marginLeft: "0.03"
                width: "0.64"
                height: "auto"
                color: "0x4b4b4b"
                fontSize: .Nfont.n2

                textAlign:
                  x: center
                  y: center
            - type: view
              style:
                marginTop: "0.04"
                height: "0.001"
                width: "0.72"
                backgroundColor: "0x8f8f90"
            - type: view
              style:
                height: "0.06"
                width: "0.72"
              children:
                - .simplePopupSplit1:
                  style:
                    top: "0"
                    height: "0.06"
                - type: button
                  text: "No"
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: denyPopUpView
                  style:
                    .LabelStyle:
                      left: "0"
                      top: "0.01"
                      width: "0.35"
                      height: "0.049"
                      color: "0x007affff"
                      fontSize: .Nfont.h2
                      display: inline
                      backgroundColor: "0xe6e6e6"
                      borderRadius: "15"
                      textAlign:
                        x: center
                        y: center
                      border:
                        style: "5"
                        borderRadius: "15"
                - .simplePopupRightButton:
                  text: "Yes"
                  style:
                    top: "0.01"
                    fontSize: .Nfont.h2
                  onClick:
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - =.builtIn.array.add:
                              dataIn:
                                object: =..relation.edgeReq.id
                                value: ..dataObject.bvid
                          - =..relation.edgeAPI.get: ""
                          - ..apiRequest.email.docCreateReq.eid@: =..relation.edgeRes.edge.0.id
                          - ..apiRequest.email.docCreateReq.name.data.receiverAvatarId@: =..dataObject.name.inviterAvatar
                          - ..apiRequest.email.docCreateReq.name.data.receiverName@: =..dataObject.name.inviterName
                          - if:
                              - =.builtIn.array.isExist:
                                  dataIn:
                                    array: =.Global.formData.connectionList
                                    phoneNumber: ..dataObject.name.inviterPhoneNumber
                              - =..invite.edgeAPI.delete: ""
                              - continue
                          - ..apiRequest.refuse.edge.evid@: =..dataObject.bvid
                          - ..apiRequest.refuse.edge.name@: =..dataObject.name
                          - ..apiRequest.refuse.edge.refid@: =..dataObject.id
                          - if:
                              - =.builtIn.array.isExist:
                                  dataIn:
                                    array: =.Global.formData.connectionList
                                    phoneNumber: ..dataObject.name.inviterPhoneNumber
                              - continue
                              - =..apiRequest.refuse.edgeAPI.store: ""
                          - =.builtIn.utils.setTimer:
                              dataIn:
                                timeUnix: 1000
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - =..invite.edgeAPI.get: ""
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: inviteTag
                    - actionType: popUpDismiss
                      popUpView: denyPopUpView
                    - goto: NewConnections

    - .simplePopup:
      viewTag: denyFacilityPopUp
      children:
        - .simplePopupView:
          style:
            height: "auto"
            overflow: hidden
          children:
            - type: label
              text: "Are you sure you want to deny?"
              dataKey:
              style:
                marginTop: "0.04"
                marginLeft: "0.03"
                width: "0.64"
                height: "auto"
                color: "0x4b4b4b"
                fontSize: .Nfont.n2

                textAlign:
                  x: center
                  y: center
            - type: view
              style:
                marginTop: "0.04"
                height: "0.001"
                width: "0.72"
                backgroundColor: "0x8f8f90"
            - type: view
              style:
                height: "0.06"
                width: "0.72"
              children:
                - .simplePopupSplit1:
                  style:
                    top: "0"
                    height: "0.06"
                - type: button
                  text: "No"
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: denyFacilityPopUp
                  style:
                    .LabelStyle:
                      left: "0"
                      top: "0.01"
                      width: "0.35"
                      height: "0.049"
                      color: "0x007affff"
                      fontSize: .Nfont.h2
                      display: inline
                      backgroundColor: "0xe6e6e6"
                      borderRadius: "15"
                      textAlign:
                        x: center
                        y: center
                      border:
                        style: "5"
                        borderRadius: "15"
                - .simplePopupRightButton:
                  text: "Yes"
                  style:
                    top: "0.01"
                    fontSize: .Nfont.h2
                  onClick:
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - =.builtIn.array.add:
                            dataIn:
                              object: =..relation.edgeReq.id
                              value: =.NewConnections.dataObject.bvid
                        - =..relation.edgeAPI.get: ""
                        - ..apiRequest.email.docCreateReq.eid@: =..relation.edgeRes.edge.0.id
                        - ..apiRequest.email.docCreateReq.name.data.receiverAvatarId@: =..dataObject.name.inviterAvatar
                        - ..apiRequest.email.docCreateReq.name.data.receiverName@: =..dataObject.name.inviterName
                        - if:
                            - =.builtIn.array.isExist:
                                dataIn:
                                  array: =.Global.formData.connectionList
                                  phoneNumber: =.NewConnections.dataObject.name.inviterPhoneNumber
                            - =..invite.edgeAPI.delete: ""
                            - continue
                        - ..apiRequest.refuse.edge.evid@: =.NewConnections.dataObject.bvid
                        - ..apiRequest.refuse.edge.name@: =.NewConnections.dataObject.name
                        - ..apiRequest.refuse.edge.refid@: =.NewConnections.dataObject.id
                        - if:
                            - =.builtIn.array.isExist:
                                dataIn:
                                  array: =.Global.formData.connectionList
                                  phoneNumber: =.NewConnections.dataObject.name.inviterPhoneNumber
                            - continue
                            - =..apiRequest.refuse.edgeAPI.store: ""
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - =..invite.edgeAPI.get: ""
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: inviteTag
                    - actionType: popUpDismiss
                      popUpView: denyPopUpView
                    - goto: NewConnections

    - type: view
      contentType: messageHidden
      style:
        top: "0.1"
        left: "0"
        height: "0.9"
        width: "1"
        zIndex: "11"
        isHidden: "true"
        backgroundColor: "0xffffff"
      children:
        - type: label
          text: "No New Patient or Medical Falicities"
          style:
            top: "0.25"
            width: "1"
            height: "0.04"
            left: "0"
            color: "0x000058"
            fontSize: "18"
            textAlign:
              x: center
    - type: view
      contentType: messageHidden
      style:
        top: "0.1"
        left: "0"
        height: "0.3"
        width: "1"
        zIndex: "11"
        isHidden: "true"
      children:
        - type: label
          text: "No New Patient"
          style:
            top: "0.25"
            width: "1"
            height: "0.04"
            left: "0"
            color: "0x000058"
            fontSize: "18"
            textAlign:
              x: center
    - type: view
      message: "Add Friend Reject"
      viewTag: DenyView
      style:
        isHidden: true
        left: "0"
        width: "1"
        top: "0"
        height: "1"
        backgroundColor: "0x00000033"
        zIndex: "1000"
      children:
        - type: view
          style:
            left: "0.1"
            width: "0.8"
            top: "0.41"
            height: "0.19"
            backgroundColor: "0xe5e5e5"
            border:
              style: "5"
            borderWidth: "1"
            borderRadius: "10"
            boxShadow: "0px 0px 0px 1px #d8d8db"
            overflow: hidden
          children:
            - type: label
              text: ___.message
              style:
                marginTop: "0.02"
                width: "0.8"
                height: "0.02"
                fontSize: "4.2vw"
                fontWeight: "600"
                color: "0x000000"
                backgroundColor: "0xe5e5e5"
                textAlign:
                  x: center
                  y: center
            - type: textView
              placeholder: "Enter the reason here"
              dataKey: apiRequest.email.docCreateReq.name.data.content
              style:
                marginTop: "0.02"
                backgroundColor: "0xffffff"
                height: "0.06"
                width: "0.7"
                left: "0.05"
                border:
                  style: "1"
                borderRadius: "3"
                boxShadow: "0px 0px 0px 2px #DEDEDF"
            - type: view
              style:
                marginTop: "0.01"
                width: "0.8"
                height: "0.001"
                backgroundColor: "0xcccccc"
            - type: view
              style:
                width: "0.81"
                height: "0.054"
              children:
                - type: label
                  text: Cancel
                  style:
                    top: "0"
                    left: "0"
                    width: "0.4"
                    height: "0.054"
                    color: "0x0074ff"
                    fontSize: "4.5vw"
                    textAlign:
                      x: center
                      y: center
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: DenyView
                - type: view
                  style:
                    top: "0"
                    left: "0.41"
                    width: "0.001"
                    height: "0.054"
                    backgroundColor: "0xcccccc"
                - type: label
                  text: Send
                  style:
                    top: "0"
                    left: "0.42"
                    width: "0.4"
                    height: "0.054"
                    color: "0x0074ff"
                    fontSize: "4.5vw"
                    textAlign:
                      x: center
                      y: center
                  onClick:
                    - actionType: evalObject
                      object:
                        - if:
                            - =.builtIn.array.isExist:
                                dataIn:
                                  array: =.Global.formData.patientList
                                  phoneNumber: =..dataObject.name.inviterPhoneNumber
                            - =..invite.edgeAPI.delete: ""
                            - continue
                        - =..apiRequest.email.docAPI.store: ""
                    - goto: NewConnections
