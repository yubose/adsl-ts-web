AddPasswordRecovery:
  init:
    - .SignInCheck
    # - if:
    #   - =.Global.formData.profile.firstName
    #   - continue
    #   - goto: PatientDashboard
    - =.builtIn.eccNaCl.generate16Dkey:
        #dataIn:
        dataOut: AddPasswordRecovery.my16Dkey
  formData:
    countryCode: "+1"
    phoneNumber: ""
    phone: ""
    checkOk: ""
  inviteHelper:
    response: ""
    edge:
      .Edge: ""
      type: 1053
      _handledCode: 1020,23010
      refid: ""
      subtype: 8 # invite special people
      bvid: .Global.currentUser.vertex.id
      name:
        phoneNumber: ""
        inviterName: .Global.currentUser.vertex.name.firstName
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: AddPasswordRecovery.inviteHelper.edge
        dataOut: AddPasswordRecovery.inviteHelper.response
  # retrieveVertex:
  #   response: ""
  #   vertex:
  #     id: =..loginNewDevice.response.edge.deat.user_id
  #     _nonce: =.Global._nonce
  #   vertexAPI:
  #     get:
  #       api: rv
  #       dataIn: SignIn.retrieveVertex.vertex
  #       dataOut: SignIn.retrieveVertex.response
  my16Dkey: ""
  userData:
    userVertex:
      vertex: ""
    request:
      id: =.AddPasswordRecovery.inviteHelper.response.edge.evid
      xfname: id
      _handledCode: 2
      type: 1
    get:
      api: rv
      dataIn: AddPasswordRecovery.userData.request
      dataOut: AddPasswordRecovery.userData.userVertex
  newPasswordRecovery:
    document:
      type: .DocType.PasswordRecovery
      eid: =.AddPasswordRecovery.inviteHelper.response.edge.refid
      name:
        title: ""
        type: "application/json"
        sesk: ""
        data: ""
    docAPI:
      .DocAPI: ""
      store:
        api: cd
        dataIn: AddPasswordRecovery.newPasswordRecovery.document
        dataOut: AddPasswordRecovery.newPasswordRecovery.document
        # subtype:
        #   mediaType: "application/json"
  newPasswordHelper:
    document:
      type: .DocType.PasswordHelper
      # esig: .inviteHelper.response.edge.evid # Helpers.id
      eid: =.AddPasswordRecovery.inviteHelper.response.edge.refid
      name:
        data: ""
        title: "test2"
        type: "application/json"
        aesk: ""
    docAPI:
      .DocAPI: ""
      store:
        api: cd
        dataIn: AddPasswordRecovery.newPasswordHelper.document
        dataOut: AddPasswordRecovery.newPasswordHelper.document
        subtype:
          mediaType: "application/json"
  emailList:
    email: ""
    request:
      id:
        - .Global.currentUser.vertex.id
      xfname: "evid|bvid"
      type: .EdgeType.Email
      _nonce: =.Global._nonce
      sCondition: "subtype=8"
    get:
      api: re
      dataIn: emailList.request
      dataOut: emailList.email
  save:
    #- ..inviteHelper.edge.name.phoneNumber@: =.AddPasswordRecovery.formData.phone
    - .AddPasswordRecovery.inviteHelper.response@: ""
    - =..inviteHelper.edgeAPI.store: ""
  components:
    - .TipsMultiLine:
      message: "Please add one friend"
      viewTag: NoPhoneNum
      onClick:
        - actionType: evalObject
          object:
            - ..inviteHelper.edge.name.phoneNumber@: ""
        - actionType: builtIn
          funcName: redraw
          viewTag: phoneTag
        - actionType: popUpDismiss
          popUpView: __.viewTag
    - .TipsMultiLine:
      message: "Please click add button to add one friend"
      viewTag: notClick
      onClick:
        - actionType: evalObject
          object:
            - ..inviteHelper.edge.name.phoneNumber@: ""
        - actionType: builtIn
          funcName: redraw
          viewTag: phoneTag
        - actionType: popUpDismiss
          popUpView: __.viewTag
    - .TipsMultiLine:
      message: "Invalid phone number format"
      viewTag: wrongPhoneNum
      onClick:
        - actionType: evalObject
          object:
            - ..inviteHelper.edge.name.phoneNumber@: ""
        - actionType: builtIn
          funcName: redraw
          viewTag: phoneTag
        - actionType: popUpDismiss
          popUpView: __.viewTag
    - .TipsMultiLine:
      message: "You cannot use your own phone number"
      viewTag: ownPhoneNum
      onClick:
        - actionType: evalObject
          object:
            - ..inviteHelper.edge.name.phoneNumber@: ""
        - actionType: builtIn
          funcName: redraw
          viewTag: phoneTag
        - actionType: popUpDismiss
          popUpView: ownPhoneNum
    - .TipsMultiLine:
      message: "This friend is already your PR helper"
      viewTag: samePhoneNum
      onClick:
        - actionType: evalObject
          object:
            - ..inviteHelper.edge.name.phoneNumber@: ""
        - actionType: builtIn
          funcName: redraw
          viewTag: phoneTag
        - actionType: popUpDismiss
          popUpView: samePhoneNum
    - type: scrollView
      style:
        ..style.all:
      children:
        # title
        - type: view
          style:
            ..style.auto:
          children:
            - type: label
              text: Add your password reset helper
              style:
                ..style.title:
        # input phone
        - type: view
          style:
            width: "auto"
            height: "0.106"
          children:
            - type: view
              style:
                ..style.countryCode:
              children:
                - type: label
                  textBoard:
                    - text: Country
                    - text: "&nbsp;"
                    - text: "*"
                      color: "#FB5051"
                  style:
                    ..style.phoneTag:
                - type: select
                  contentType: countryCode
                  placeholder: ..formData.countryCode
                  dataKey: formData.countryCode # formData.countryCode : inputValue
                  required: "true"
                  options: .CountryCode
                  style:
                    ..style.select:
            - type: view
              style:
                ..style.phone:
              children:
                - type: label
                  textBoard:
                    - text: Phone
                    - text: "&nbsp;"
                    - text: "*"
                      color: "#FB5051"
                  style:
                    ..style.phoneTag:
                - type: textField
                  viewTag: phoneTag
                  contentType: countryCode
                  placeholder: 000-000-0000
                  dataKey: inviteHelper.edge.name.phoneNumber # formData.countryCode : inputValue
                  style:
                    ..style.phoneNumber:
            - type: view
              style:
                ..style.add:
              children:
                - type: button
                  text: Add
                  style:
                    ..style.addButton:
                  onClick:
                    - ..event.add
        # content
        - type: view
          style:
            ..style.auto:
          children:
            - type: label
              text: Add/Invite Friend(s) to Help Reset Forgotten Passwords
              style:
                ..style.blackWords:
            - type: label
              text: For your protection, your password reset(PR) should only be enabled by friends you trust (PR helper(s)).
              style:
                ..style.words:
            - type: label
              text: Your PR helper(s) will help you when you forget your password.Your PR helper(s) will have access to a part of your access key. They DO NOT know any part of your password and may not even know that you have designated them as PR helper(s). You are strongly recommended to designate at least one PR helper. You may remove or change your PR helper(s) at any time.
              style:
                ..style.words:
            - type: label
              text: "Warning:"
              style:
                ..style.WarningWords:
            - type: label
              text: Without valid PR helper(s), you will no longer have access if you forget your password.  lf this event, you have to start over by signing up again.
              style:
                ..style.words:
            - type: label
              textBoard:
                - text: If you do not have any friend registered in our system, we can add our customer service number
                - text: “+1 3107559849”
                  fontWeight: "600"
                  color: "0x333333"
                - text: as your default password reset helper.
              style:
                ..style.words:
        - type: view
          style:
            ..style.auto:
          children:
            - type: button
              text: Complete
              style:
                ..style.complete:
              onClick:
                - ..event.complete
            - type: label
              text: Skip For Now
              style:
                ..style.skip:
              onClick:
                - ..event.skip
    - type: popUp
      viewTag: inviteView
      message: "Sorry, this phone number is not inside our system, please enter another phone number or let this user sign up first."
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
        zIndex: "50"
        textAlign:
          y: center
      leftButton:
        - actionType: evalObject
          object:
            - ..inviteHelper.edge.name.phoneNumber@: ""
        - actionType: builtIn
          funcName: redraw
          viewTag: phoneTag
        - actionType: popUpDismiss
          popUpView: inviteView
      children:
        - type: view
          style:
            width: "0.7"
            marginLeft: "0.15"
            backgroundColor: "0xE6E6E6"
            borderRadius: "14px"
            overflow: hidden
            textAlign:
              x: center
          children:
            - type: image
              path: aboutRed.svg
              style:
                marginTop: "0.029"
                width: "0.13"
            - type: label
              text: ___.message
              style:
                width: "0.576"
                marginLeft: "0.062"
                marginTop: "0.006"
                fontSize: .Nfont.h14

                textAlign:
                  x: center
                color: "0x333333"
            - type: view
              style:
                height: "0.027"
                width: "0.7"
                border:
                  style: 2
                  color: "0x919192"
                borderWidth: "1"
            - type: view
              style:
                width: "0.7"
              children:
                - type: button
                  text: "Ok"
                  style:
                    color: "0x007AFF"
                    display: inline-block
                    width: "0.7"
                    borderRadius: "0 0 14px 14px"
                    height: "0.054"
                    fontWeight: "850"
                    fontSize: .Nfont.h14
                    backgroundColor: "0xE6E6E6"
                    border:
                      style: "1"
                  onClick: ____.leftButton
                # - type: view
                #   style:
                #     width: "0.002"
                #     backgroundColor: "0x919192"
                #     display: inline-block
                #     height: "0.054"
                #     zIndex: "50"
                # - type: button
                #   text: "Confirm"
                #   style:
                #     color: "0x007AFF"
                #     fontWeight: "850"
                #     display: inline-block
                #     width: "0.349"
                #     borderRadius: "0 0 14px 0"
                #     height: "0.054"
                #     fontSize: .Nfont.h14
                #     backgroundColor: "0xE6E6E6"
                #     border:
                #       style: "1"
                #   onClick: ____.rightButton
    # - .ConfirmWarningPopup:
    #   viewTag: inviteView
    #   children:
    #     - .ConfirmWarningPopupView:
    #       style:
    #         height: "auto"
    #         width: "0.8"
    #         left: "0.1"
    #         borderRadius: "10"
    #         overflow: hidden
    #       children:
    #         - type: view
    #           style:
    #             height: "0.045"
    #             width: "0.8"
    #             backgroundColor: "0xb62929"
    #           children:
    #             - type: image
    #               path: aboutWhite.svg
    #               style:
    #                 left: "0.29"
    #                 top: "0.011"
    #                 width: "5vw"
    #             - type: label
    #               text: Warning
    #               style:
    #                 left: "0.36"
    #                 # width: "0.1"
    #                 height: "0.045"
    #
    #                 top: "0.005"
    #                 fontSize: .Nfont.n3
    #                 color: "0xffffff"
    #                 textAlign:
    #                   x: left
    #                   y: center
    #         - type: view
    #           style:
    #             width: "0.8"
    #             height: "auto"
    #             overflow: hidden
    #           children:
    #             - type: label
    #               text: Sorry, this phone number
    #               style:
    #                 marginTop: "0.005"
    #                 height: "auto"
    #                 width: "0.65"
    #                 left: "0.075"
    #                 textAlign:
    #                   x: center
    #                 fontSize: "4.5vw"
    #                 fontWeight: "500"
    #             - type: label
    #               dataKey: inviteHelper.edge.name.phoneNumber
    #               style:
    #                 marginTop: "0.005"
    #                 height: "auto"
    #                 width: "0.8"
    #                 textAlign:
    #                   x: center
    #                 fontSize: "4vw"
    #             - type: label
    #               text: is not inside our system, please enter another phone number or let this user sign up first.
    #               style:
    #                 marginTop: "0.005"
    #                 height: "auto"
    #                 width: "0.74"
    #                 left: "0.03"
    #                 textAlign:
    #                   x: center
    #                 fontSize: "4vw"
    #         - type: view
    #           style:
    #             marginTop: "0.01"
    #             height: "0.001"
    #             width: "0.8"
    #             backgroundColor: "0x999999"
    #         - type: view
    #           style:
    #             height: "0.045"
    #             width: "0.8"
    #           children:
    #             - type: view
    #               style:
    #                 top: "0"
    #                 left: "0.4"
    #                 height: "0.045"
    #                 width: "0.002"
    #                 backgroundColor: "0x999999"
    #             - type: button
    #               text: Cancel
    #               style:
    #                 top: "0.005"
    #                 left: "0.1"
    #                 height: "0.04"
    #                 width: "0.2"
    #                 fontSize: "5vw"
    #                 color: "0x007aff"
    #                 border:
    #                   style: "1"
    #                 backgroundColor: "0xe5e5e5"
    #                 textAlign:
    #                   x: center
    #                   y: center
    #               onClick:
    #                 - actionType: popUpDismiss
    #                   popUpView: inviteView
    #             - type: button
    #               text: Confirm
    #               style:
    #                 top: "0.005"
    #                 left: "0.5"
    #                 height: "0.04"
    #                 width: "0.2"
    #                 fontSize: "5vw"
    #                 color: "0x007aff"
    #                 border:
    #                   style: "1"
    #                 backgroundColor: "0xe5e5e5"
    #                 textAlign:
    #                   x: center
    #                   y: center
    #               onClick:
    #                 - actionType: popUpDismiss
    #                   popUpView: inviteView

    # - .ConfirmWarningPopup:
    #   viewTag: defaultHelper
    #   children:
    #     - .ConfirmWarningPopupView:
    #       style:
    #         height: "auto"
    #         width: "0.8"
    #         left: "0.1"
    #         borderRadius: "10"
    #         overflow: hidden
    #       children:
    #         - type: view
    #           style:
    #             height: "0.045"
    #             width: "0.8"
    #             backgroundColor: "0xb62929"
    #           children:
    #             - type: image
    #               path: aboutWhite.svg
    #               style:
    #                 left: "0.29"
    #                 top: "0.011"
    #                 width: "5vw"
    #             - type: label
    #               text: Warning
    #               style:
    #                 left: "0.36"
    #                 width: "0.1"
    #                 height: "0.045"
    #
    #                 top: "0.005"
    #                 fontSize: .Nfont.n3
    #                 color: "0xffffff"
    #                 textAlign:
    #                   x: left
    #                   y: center
    #         - type: view
    #           style:
    #             width: "0.8"
    #             height: "auto"
    #             overflow: hidden
    #           children:
    #             - type: label
    #               text: If you do not have any friend registered in our system
    #               style:
    #                 marginTop: "0.005"
    #                 height: "auto"
    #                 width: "0.65"
    #                 left: "0.075"
    #                 textAlign:
    #                   x: center
    #                 fontSize: "4.5vw"
    #                 fontWeight: "500"
    #             - type: label
    #               text: we can add our customer service number “+1 3107559849” as your default password reset helper
    #               style:
    #                 marginTop: "0.005"
    #                 height: "auto"
    #                 width: "0.76"
    #                 left: "0.02"
    #                 textAlign:
    #                   x: center
    #                 fontSize: "4vw"
    #             - type: label
    #               text: Would you like to add it?
    #               style:
    #                 marginTop: "0.005"
    #                 height: "auto"
    #                 width: "0.6"
    #                 left: "0.1"
    #                 textAlign:
    #                   x: center
    #                 fontSize: "4vw"
    #         - type: view
    #           style:
    #             marginTop: "0.01"
    #             height: "0.001"
    #             width: "0.8"
    #             backgroundColor: "0x999999"
    #         - type: view
    #           style:
    #             height: "0.045"
    #             width: "0.8"
    #           children:
    #             - type: view
    #               style:
    #                 top: "0"
    #                 left: "0.4"
    #                 height: "0.045"
    #                 width: "0.002"
    #                 backgroundColor: "0x999999"
    #             - type: button
    #               text: Cancel
    #               style:
    #                 top: "0.005"
    #                 left: "0.1"
    #                 height: "0.04"
    #                 width: "0.2"
    #                 fontSize: "5vw"
    #                 color: "0x007aff"
    #                 border:
    #                   style: "1"
    #                 backgroundColor: "0xe5e5e5"
    #                 textAlign:
    #                   x: center
    #                   y: center
    #               onClick:
    #                 - actionType: popUpDismiss
    #                   popUpView: defaultHelper
    #             - type: button
    #               text: Confirm
    #               style:
    #                 top: "0.005"
    #                 left: "0.5"
    #                 height: "0.04"
    #                 width: "0.2"
    #                 fontSize: "5vw"
    #                 color: "0x007aff"
    #                 border:
    #                   style: "1"
    #                 backgroundColor: "0xe5e5e5"
    #                 textAlign:
    #                   x: center
    #                   y: center
    #               onClick:
    #                 - actionType: popUpDismiss
    #                   popUpView: defaultHelper
    #                 - actionType: evalObject
    #                   object:
    #                     - .AddPasswordRecovery.inviteHelper.edge.name.phoneNumber@: "3107559849"
    #                 - actionType: evalObject
    #                   object: ..save
    #                 - actionType: popUp
    #                   popUpView: finalView
    #                   wait: 2000
    #                 - actionType: evalObject
    #                   object:
    #                     - ..inviteHelper.edge.name.phoneNumber@: ""
    #                 - actionType: builtIn
    #                   funcName: redraw
    #                   viewTag: phoneTag

    - .SuccessfulOneLine:
      viewTag: finalView
      message: "Add Successfully!"
    # - type: popUp
    #   viewTag: finalView
    #   imagePath: popUpSuccess.svg
    #   message: "Add Successfully!"
    #   style:
    #     left: "0"
    #     width: "1"
    #     top: "0"
    #     height: "1"
    #     backgroundColor: "0x00000033"
    #     zIndex: "1000"
    #   children:
    #     - type: view
    #       style:
    #         width: "1"
    #         height: "1"
    #         top: "0"
    #         left: "0"
    #       children:
    #         - type: view
    #           style:
    #             left: "0.3"
    #             width: "0.4"
    #             top: "0.35"
    #             height: "0.14"
    #             backgroundColor: "0xe5e5e5"
    #             border:
    #               style: "5"
    #             borderWidth: "1"
    #             borderRadius: "10"
    #           children:
    #             - type: image
    #               path: ____.imagePath
    #               style:
    #                 top: "0.02"
    #                 left: "0.15"
    #                 height: "0.05"
    #             - type: label
    #               text: ____.message
    #               style:
    #                 top: "0.07"
    #                 left: "0.02"
    #                 height: "0.06"
    #                 width: "0.36"
    #                 fontSize: .Nfont.h1
    #                 textAlign:
    #                   x: center
    #                   y: center

    - .ConfirmWarningPopup:

      children:
        - .ConfirmWarningPopupView:
          style:
            height: "auto"
            width: "0.8"
            left: "0.1"
            borderRadius: "10"
            overflow: hidden
          children:
            - type: view
              style:
                height: "0.045"
                width: "0.8"
                backgroundColor: "0xb62929"
              children:
                - type: image
                  path: aboutWhite.svg
                  style:
                    left: "0.29"
                    top: "0.011"
                    width: "5vw"
                - type: label
                  text: Warning
                  style:
                    left: "0.36"
                    height: "0.045"

                    top: "0.005"
                    fontSize: .Nfont.n3
                    color: "0xffffff"
                    textAlign:
                      x: left
                      y: center
            - type: view
              style:
                width: "0.8"
                height: "auto"
                overflow: hidden
              children:
                - type: label
                  text: Add as Password Reset Helper
                  style:
                    marginTop: "0.005"
                    height: "auto"
                    width: "0.76"
                    left: "0.02"
                    textAlign:
                      x: center
                    fontSize: "4.5vw"
                    fontWeight: "500"
                - type: label
                  text: Send invite link to
                  style:
                    marginTop: "0.005"
                    height: "auto"
                    width: "0.8"
                    textAlign:
                      x: center
                    fontSize: "4vw"
                - type: label
                  dataKey: inviteHelper.edge.name.phoneNumber
                  style:
                    marginTop: "0.015"
                    height: "auto"
                    width: "0.74"
                    left: "0.03"
                    textAlign:
                      x: center
                    fontSize: "4vw"
            - type: view
              style:
                marginTop: "0.01"
                height: "0.001"
                width: "0.8"
                backgroundColor: "0x999999"
            - type: view
              style:
                height: "0.045"
                width: "0.8"
              children:
                - type: view
                  style:
                    top: "0"
                    left: "0.4"
                    height: "0.045"
                    width: "0.002"
                    backgroundColor: "0x999999"
                - type: button
                  text: Cancel
                  style:
                    top: "0.005"
                    left: "0.1"
                    height: "0.04"
                    width: "0.2"
                    fontSize: "5vw"
                    color: "0x007aff"
                    border:
                      style: "1"
                    backgroundColor: "0xe5e5e5"
                    textAlign:
                      x: center
                      y: center
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: confirmView
                - type: button
                  text: Confirm
                  style:
                    top: "0.005"
                    left: "0.5"
                    height: "0.04"
                    width: "0.2"
                    fontSize: "5vw"
                    color: "0x007aff"
                    border:
                      style: "1"
                    backgroundColor: "0xe5e5e5"
                    textAlign:
                      x: center
                      y: center
                  onClick:
                    - actionType: evalObject
                      object: ..save
                    - actionType: popUpDismiss
                      popUpView: confirmView
                    - actionType: evalObject
                      object:
                        - if:
                            - =..inviteHelper.response.edge.id
                            - continue
                            - actionType: popUp
                              popUpView: samePhoneNum
                              wait: true
                    - actionType: evalObject
                      object:
                        - .Global._nonce@:
                            =.builtIn.math.random: ""
                        - =..userData.get: ""
                    - actionType: evalObject
                      object:
                        - if:
                            - =..userData.userVertex.vertex.0.pk
                            - continue
                            - actionType: popUp
                              popUpView: inviteView
                              wait: true
                        - =.builtIn.eccNaCl.encryptAES:
                            dataIn:
                              key: =..my16Dkey
                              message: =.Global.currentUser.vertex.sk # user_sk
                            dataOut: AddPasswordRecovery.newPasswordRecovery.document.name.sesk #sesk
                        - =.builtIn.eccNaCl.encryptASK:
                            dataIn:
                              data: =..my16Dkey
                              sendSk: =.Global.currentUser.vertex.sk
                              recvPk: =..userData.userVertex.vertex.0.pk
                            dataOut: AddPasswordRecovery.newPasswordHelper.document.name.aesk #aesk
                    - actionType: evalObject
                      object:
                        - ..newPasswordRecovery.document.name.user@: =..userData.userVertex.vertex.0.name.firstName
                        - ..newPasswordRecovery.document.name.title@: =..userData.userVertex.vertex.0.name.phoneNumber
                        - =.AddPasswordRecovery.newPasswordRecovery.docAPI.store: ""
                    - actionType: evalObject
                      object:
                        - ..newPasswordHelper.document.fid@: =..newPasswordRecovery.document.doc.id
                        - =.AddPasswordRecovery.newPasswordHelper.docAPI.store: ""
                    - actionType: popUp
                      popUpView: finalView
                      wait: 2000
                    - actionType: evalObject
                      object:
                        - ..inviteHelper.edge.name.phoneNumber@: ""
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: phoneTag
    - type: popUp
      viewTag: confirmView
      phoneDataKey: "1"
      message: "Send Invite Link To"
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
        zIndex: "50"
        textAlign:
          y: center
      leftButton:
        - actionType: popUpDismiss
          popUpView: confirmView
      rightButton:
        # - actionType: evalObject
        #   object: ..save
        - actionType: popUpDismiss
          popUpView: confirmView
        # - actionType: evalObject
        #   object:
        #     - if:
        #         - =..inviteHelper.response.edge.id
        #         - continue
        #         - actionType: popUp
        #           popUpView: samePhoneNum
        #           wait: true
        - actionType: evalObject
          object:
            - .Global._nonce@:
                =.builtIn.math.random: ""
            # - =..userData.get: ""
        - actionType: evalObject
          object:
            # - if:
            #     - =..userData.userVertex.vertex.0.pk
            #     - continue
            #     - actionType: popUp
            #       popUpView: inviteView
            #       wait: true
            - =.builtIn.eccNaCl.encryptAES:
                dataIn:
                  key: =..my16Dkey
                  message: =.Global.currentUser.vertex.sk # user_sk
                dataOut: AddPasswordRecovery.newPasswordRecovery.document.name.sesk #sesk
            - =.builtIn.eccNaCl.encryptASK:
                dataIn:
                  data: =..my16Dkey
                  sendSk: =.Global.currentUser.vertex.sk
                  recvPk: =..userData.userVertex.vertex.0.pk
                dataOut: AddPasswordRecovery.newPasswordHelper.document.name.aesk #aesk
        - actionType: evalObject
          object:
            - ..newPasswordRecovery.document.name.user@: =..userData.userVertex.vertex.0.name.firstName
            - ..newPasswordRecovery.document.name.title@: =..userData.userVertex.vertex.0.name.phoneNumber
            - =.AddPasswordRecovery.newPasswordRecovery.docAPI.store: ""
        - actionType: evalObject
          object:
            - ..newPasswordHelper.document.fid@: =..newPasswordRecovery.document.doc.id
            - =.AddPasswordRecovery.newPasswordHelper.docAPI.store: ""
        - actionType: popUp
          popUpView: finalView
          wait: 2000
        - actionType: evalObject
          object:
            - ..inviteHelper.edge.name.phoneNumber@: ""
        - actionType: builtIn
          funcName: redraw
          viewTag: phoneTag
      children:
        - type: view
          style:
            width: "0.75"
            marginLeft: "0.125"
            backgroundColor: "0xE6E6E6"
            borderRadius: "14px"
          children:
            - type: label
              text: ___.message
              style:
                width: "0.616"
                marginLeft: "0.052"
                marginTop: "0.029"
                fontWeight: "600"
                fontSize: .Nfont.h14

                color: "0x4B4B4B"
                textAlign:
                  x: center
            - type: view
              style:
                marginTop: "0.02"
                width: "0.75"
                textAlign:
                  x: center
              children:
                - type: view
                  children:
                    - type: label
                      text: Send Invite Link To
                      style:
                        fontSize: .Nfont.h14
                        display: inline-block
                    - type: label
                      dataKey: AddPasswordRecovery.formData.phone
                      style:
                        marginLeft: "0.032"
                        color: "0x0D7AFF"
                        fontSize: .Nfont.h14
                        display: inline-block

            - type: view
              style:
                height: "0.02"
                border:
                  style: 2
                  color: "0x919192"
                borderWidth: "1"
                width: "0.75"
            - type: view
              style:
                width: "0.75"
              children:
                - type: button
                  text: "Cancel"
                  style:
                    color: "0x007AFF"
                    backgroundColor: "0xE6E6E6"
                    display: inline-block
                    width: "0.374"
                    borderRadius: "0 0 0 14px"
                    fontSize: .Nfont.h14
                    height: "0.054"
                    border:
                      style: "1"
                  onClick: ____.leftButton
                - type: view
                  style:
                    width: "0.002"
                    backgroundColor: "0x919192"
                    display: inline-block
                    height: "0.054"
                    zIndex: "50"
                - type: button
                  text: "Confirm"
                  style:
                    color: "0x007AFF"
                    fontWeight: "800"
                    backgroundColor: "0xE6E6E6"
                    display: inline-block
                    width: "0.374"
                    fontSize: .Nfont.h14
                    borderRadius: "0 0 14px 0"
                    height: "0.054"
                    border:
                      style: "1"
                  onClick: ____.rightButton
  event:
    skip:
      - actionType: evalObject
        object:
          - .AddPasswordRecovery.inviteHelper.edge.name.phoneNumber@: "3107559849"
      - actionType: evalObject
        object: ..save
      - actionType: evalObject
        object:
          - .Global._nonce@:
              =.builtIn.math.random: ""
          - =..userData.get: ""
      - actionType: evalObject
        object:
          - =.builtIn.eccNaCl.encryptAES:
              dataIn:
                key: =..my16Dkey
                message: =.Global.currentUser.vertex.sk # user_sk
              dataOut: AddPasswordRecovery.newPasswordRecovery.document.name.sesk #sesk
          - =.builtIn.eccNaCl.encryptASK:
              dataIn:
                data: =..my16Dkey
                sendSk: =.Global.currentUser.vertex.sk
                recvPk: =..userData.userVertex.vertex.0.pk
              dataOut: AddPasswordRecovery.newPasswordHelper.document.name.aesk #aesk
      - actionType: evalObject
        object:
          - ..newPasswordRecovery.document.name.user@: =..userData.userVertex.vertex.0.name.firstName
          - ..newPasswordRecovery.document.name.title@: =..userData.userVertex.vertex.0.name.phoneNumber
          - =.AddPasswordRecovery.newPasswordRecovery.docAPI.store: ""
      - actionType: evalObject
        object:
          - ..newPasswordHelper.document.fid@: =..newPasswordRecovery.document.doc.id
          - =.AddPasswordRecovery.newPasswordHelper.docAPI.store: ""
      - goto: PatientDashboard
    complete:
      - actionType: evalObject
        object:
          - =..emailList.get: ""
          - if:
              - =.AddPasswordRecovery.emailList.email.edge.0.id
              - continue
              - actionType: popUp
                popUpView: notClick
                popUpDismiss: 2000
                wait: true
      - goto: PatientDashboard
    add:
      # No phoneNubmer
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..inviteHelper.edge.name.phoneNumber
                    string2: ""
              - actionType: popUp
                popUpView: NoPhoneNum
                popUpDismiss: 2000
                wait: true
              - continue
            # - actionType: evalObject
            #   object:
            #     - .AddPasswordRecovery.inviteHelper.edge.name.phoneNumber@: "3107559849"

      - actionType: evalObject
        object:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..formData.countryCode
                    string2: "+965" # Kuwait
              - ..formData.checkOk@: true
              - =.builtIn.string.phoneVerification:
                  dataIn:
                    phoneNumber: =..inviteHelper.edge.name.phoneNumber
                    countryCode: =..formData.countryCode
                  dataOut: AddPasswordRecovery.formData.checkOk
          - if:
              - =..formData.checkOk
              - continue
              - actionType: evalObject
                object:
                  - .AddPasswordRecovery.inviteHelper.edge.name.phoneNumber@: ""
                  - actionType: builtIn
                    funcName: redraw
                    viewTag: phoneTag
                  - actionType: popUp
                    popUpView: wrongPhoneNum
                    popUpDismiss: 2000
                    wait: true
      # owner phoneNubmer
      - actionType: evalObject
        object:
          - =.builtIn.string.concat:
              dataIn:
                - =..formData.countryCode
                - " "
                - =..inviteHelper.edge.name.phoneNumber
              dataOut: AddPasswordRecovery.formData.phone
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =.Global.currentUser.vertex.uid
                    string2: =..formData.phone
              - actionType: evalObject
                object:
                  - .AddPasswordRecovery.inviteHelper.edge.name.phoneNumber@: ""
                  - actionType: builtIn
                    funcName: redraw
                    viewTag: phoneTag
                  - actionType: popUp
                    popUpView: ownPhoneNum
                    popUpDismiss: 2000
                    wait: true
              - continue
      - actionType: evalObject
        object: ..save
      # - actionType: popUpDismiss
      #   popUpView: confirmView
      #  if is not in system return code 1020? i find it return invalid encoding
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..inviteHelper.response.code
                    string2: "23010"
              # - =..inviteHelper.response.edge.id
              - actionType: evalObject
                object:
                  - .AddPasswordRecovery.inviteHelper.edge.name.phoneNumber@: ""
                  - actionType: builtIn
                    funcName: redraw
                    viewTag: phoneTag
                  - actionType: popUp
                    popUpView: samePhoneNum
                    popUpDismiss: 2000
                    wait: true
              - continue

      - actionType: evalObject
        object:
          - .Global._nonce@:
              =.builtIn.math.random: ""
          - =..userData.get: ""
      - actionType: evalObject
        object:
          - if:
              - =..userData.userVertex.vertex.0.pk
              - continue
              - actionType: popUp
                popUpView: inviteView
                # popUpDismiss: 2000
                wait: true

      - actionType: builtIn
        funcName: redraw
        viewTag: confirmView
      - actionType: popUp
        popUpView: confirmView
      # - actionType: popUp
      #   popUpView: inviteView
  style:
    all:
      marginTop: "0"
      marginLeft: "0"
      width: "1"
      height: "0.96"
      overflow: hidden

      backgroundColor: "0xffffff"
    auto:
      width: "auto"
      height: "auto"
    title:
      fontSize: .Nfont.h18
      color: "#2988E6"
      fontWeight: "600"
      marginTop: "0.0222"
      marginLeft: "0.066"
    countryCode:
      marginLeft: "0.08"
      display: "inline-block"
      verticalAlign: bottom
      marginTop: "0.0320"
    phone:
      marginLeft: "0.032"
      display: "inline-block"
      verticalAlign: bottom
      marginTop: "0.0320"
    add:
      marginLeft: "0.04266"
      display: "inline-block"
      verticalAlign: bottom
      marginTop: "0.0320"
    phoneTag:
      color: "#333333"
      fontSize: .Nfont.h14
      fontWeight: "600"

    select:
      backgroundColor: "#F4F4F5"
      fontSize: .Nfont.h14
      height: "0.049"
      textIndent: "1em"
      marginTop: "0.005"
      box-sizing: "border-box"
      borderRadius: "5"
      width: "0.2346"
      border:
        style: "1"
    phoneNumber:
      backgroundColor: "#F4F4F5"
      fontSize: .Nfont.h14
      height: "0.049"
      textIndent: "1em"
      marginTop: "0.005"
      box-sizing: "border-box"
      borderRadius: "5"
      width: "0.3893"
      border:
        style: "1"
    addButton:
      backgroundColor: "#2988e6"
      fontSize: .Nfont.h14
      height: "0.049"
      marginTop: "0.005"
      color: "#FFFFFF"
      fontWeight: "600"
      box-sizing: "border-box"
      borderRadius: "5"
      width: "0.144"
      border:
        style: "1"
      textAlign:
        x: center
        y: center
    blackWords:
      width: "0.84"
      fontWeight: "600"
      color: "0x333333"
      marginTop: "0.0369"
      fontSize: ".Nfont.h14"
      marginLeft: "0.08"
      lineHeight: "2.58vh"
    words:
      width: "0.84"
      color: "0x333333"
      marginTop: "0.0123"
      fontSize: ".Nfont.h14"
      marginLeft: "0.08"
      lineHeight: "2.58vh"
    WarningWords:
      width: "0.84"
      color: "0xFB5051"
      fontSize: ".Nfont.h14"
      marginLeft: "0.08"
      marginTop: "0.029"
      fontWeight: "600"
      lineHeight: "2.58vh"
    complete:
      backgroundColor: "#2988e6"
      fontSize: .Nfont.h14
      height: "0.049"
      marginTop: "0.01477"
      color: "#FFFFFF"
      box-sizing: "border-box"
      borderRadius: "5"
      width: "0.84"
      marginLeft: "0.08"
      fontWeight: "600"
      boxShadow: "1px 1px 4px 2px #dededf"
      border:
        style: "1"
      textAlign:
        x: center
        y: center
    skip:
      width: "1"
      color: "#2988e6"
      marginTop: "0.032"
      fontWeight: "600"
      textDecoration: underline
      fontSize: .Nfont.h14
      textAlign:
        x: center
