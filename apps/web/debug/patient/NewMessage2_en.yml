NewMessage2:
  pageNumber: "270" # xd page  32
  title: "Reply"
  init:
    - .SignInCheck
    - if:
        - =.Global.formData.replyEmail.name
        - ..apiRequest.email.docCreateReq@: =.Global.formData.replyEmail
        - continue
    - if:
        - =.Global.formData.attachments.0
        - ..formData.attachments@: =.Global.formData.attachments
        - continue
    - if:
        - =.builtIn.string.equalsLenString:
            dataIn:
              stringOne: =..apiRequest.email.docCreateReq.name.title
              stringTwo: Reply To
              len: 8
        - continue
        - =.builtIn.string.concat:
            dataIn:
              - Reply To
              - " "
              - =..apiRequest.email.docCreateReq.name.title
            dataOut: NewMessage2.apiRequest.email.docCreateReq.name.title
    - ..formData.attachments@: =.Global.formData.attachments
  formData:
    startEdit: false
    attachments: []
    fileSize: ""
    flag: false
  apiRequest:
    email:
      docCreateResp: ""
      docCreateReq:
        type: .DocType.InboxMessage
        eid: .Global.email.eid
        reid: .Global.email.id
        name:
          data:
            content: ""
            receiverName: .Global.email.name.data.senderName
            senderName: .Global.email.name.data.receiverName
            receiverAvatarId: .Global.email.name.user
            haveAttachment: false
          title: .Global.email.name.title
          user: .Global.Profile.name.data.basicInfo.avatar
      docAPI:
        store:
          api: cd
          dataIn: NewMessage2.apiRequest.email.docCreateReq
          dataOut: NewMessage2.apiRequest.email.docCreateResp
    attachment:
      deleteDocReq:
        id: ""
      docResp: ""
      docReq:
        type: .DocType.Attachment
        eid: .Global.rootNotebookID
        .Document: ""
        reid: ""
        name:
          data: binFile
          title: ""
          type: ..apiRequest.attachment.docAPI.store.subtype.mediaType
          user: ""
      docAPI:
        store:
          api: cd
          dataIn: NewMessage2.apiRequest.attachment.docReq
          dataOut: NewMessage2.apiRequest.attachment.docResp
        delete:
          api: dx
          dataIn: NewMessage2.apiRequest.attachment.deleteDocReq
  components:
    - .BaseHeader:
    - .HeaderLeftImg:
      path: whiteLeft.svg
      onClick:
        - actionType: evalObject
          object:
            - .Global.formData.replyEmail@: =..apiRequest.email.docCreateReq
            - .Global.formData.attachments@: =..formData.attachments
        - actionType: popUp
          popUpView: backPopUpView
    - .HeaderRightButton:
      text: Send
      onClick:
        - actionType: evalObject
          object:
            - .Global.formData.replyEmail@: =..apiRequest.email.docCreateReq
            - .Global.formData.attachments@: =..formData.attachments
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =..apiRequest.email.docCreateReq.name.data.receiverName
                      string2: ""
                - actionType: popUp
                  popUpView: connectionCheck
                  wait: true
                - continue
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =..apiRequest.email.docCreateReq.name.title
                      string2: ""
                - actionType: popUp
                  popUpView: sendPopUpView
                  wait: true
                - continue
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =..apiRequest.email.docCreateReq.name.data.content
                      string2: ""
                - actionType: popUp
                  popUpView: sendPopUpView
                  wait: true
                - continue
            - ..apiRequest.email.docCreateReq.eid@: =.Global.email.eid
            - if:
                - =..formData.attachments.0
                - ..apiRequest.email.docCreateReq.name.data.haveAttachment@: true
                - continue
            - =..apiRequest.email.docAPI.store: ""
            - if:
                - =..formData.attachments.0
                - =.builtIn.ecos.updateDocListReid:
                    dataIn:
                      sourceDocList: =..formData.attachments
                      reid: =..apiRequest.email.docCreateResp.doc.id
                - continue
        - actionType: popUp
          popUpView: sendSuccessfullyPopUpView
        - actionType: builtIn
          funcName: goBack
          reload: true
    # send 弹框
    - .BaseMessageWarnPopup:
      viewTag: sendSuccessfullyPopUpView
      imagePath: popUpSuccess.svg
      message: Send Successful!
      style:
        backgroundColor: "0x00000033"
      onClick:
        - goto: InboxDashboard
    - type: view
      style:
        top: "0.1"
        width: "1"
        left: "0"
        height: "0.14"
      children:
        - type: view
          style:
            left: "0.07"
            top: "0.02"
            width: "0.9"
            height: "0.05"
            border:
              style: "2"
            borderWidth: "1"
            borderColor: "0x00000055"
          children:
            - type: label
              text: "To:"
              height: "0.04"
              style:
                top: "0"
                fontSize: .Nfont.n3
                height: "0.05"
                left: "0"
                width: "0.05"
                textAlign:
                  y: center
            - type: label
              dataKey: apiRequest.email.docCreateReq.name.data.receiverName
              style:
                top: "0"
                left: "0.17"
                height: "0.05"
                border:
                  style: "1"
                fontSize: .Nfont.n3
                textAlign:
                  y: center
              width: "1"
        - type: view
          style:
            left: "0.07"
            top: "0.09"
            width: "0.9"
            height: "0.04"
            border:
              style: "2"
            borderWidth: "1"
            borderColor: "0x00000055"
          children:
            - type: label
              text: "Subject:"
              style:
                top: "0"
                fontSize: .Nfont.n3
                left: "0"
                width: "0.135"
                height: "0.04"
                textAlign:
                  y: center
            - type: textField
              dataKey: apiRequest.email.docCreateReq.name.title
              placeholder: "Enter title here"
              isEditable: true
              style:
                top: "0"
                left: "0.17"
                height: "0.038"
                width: "0.6"
                border:
                  style: "1"
                fontSize: .Nfont.n3
                textAlign:
                  y: center
            - type: image
              path: pin.svg
              onClick:
                - actionType: evalObject
                  object:
                    - .Global.formData.replyEmail@: =..apiRequest.email.docCreateReq
                    - .Global.formData.attachments@: =..formData.attachments
                - actionType: popUp
                  popUpView: selectView
              style:
                left: "0.8"
                height: "0.02"
                top: "0.005"
    - type: view
      style:
        top: "0.27"
        left: "0"
        width: "0.96"
        height: "0.652"
      children:
        - type: textView
          isEditable: true
          placeholder: "Write message here"
          dataKey: apiRequest.email.docCreateReq.name.data.content
          style:
            left: "0.05"
            width: "0.9"
            height: "0.2"

            textAlign:
              y: top
            border:
              style: "5"
              width: "1"
        - type: view
          style:
            width: "1"
            height: "0.02"
          children:
            - type: label
              textBoard:
                - text: "------------"
                - text: "&nbsp;"
                - text: "&nbsp;"
                - text: "Original"
                - text: "&nbsp;"
                - text: "&nbsp;"
                - text: "------------"
              dataKey:
              style:
                top: "0"
                width: "1"
                textAlign:
                  x: center
                  y: center
                height: "0.02"
                fontSize: .Nfont.n3

        - type: view
          style:
            marginTop: "0.01"
            left: "0.05"
            width: "0.9"
            height: "0.4"
          children:
            - type: view
              style:
                width: "0.9"
                height: "auto"
                backgroundColor: "0xf8f9fa"
                borderRadius: "7"
                overflow: hidden
              children:
                - type: label
                  text: "Details"
                  style:
                    top: "0.02"
                    left: "0.77"
                    color: "0x2988e6"
                    fontSize: .Nfont.n3
                    height: "0.02"
                    width: "0.105"
                    border:
                      style: "2"
                    borderWidth: "1"
                    borderColor: "0x2988e6"
                    textAlign:
                      x: center
                  onClick:
                    - actionType: evalObject
                      object:
                        - .Global.formData.attachments@: =..formData.attachments
                        - .Global.formData.replyEmail@: =..apiRequest.email.docCreateReq
                    - goto: MessageShowReplyDetails
                - type: view
                  style:
                    marginTop: "0.02"
                    height: "auto"
                    width: "0.7"
                    left: "0"
                  children:
                    - type: label
                      text: "Form:"
                      style:
                        left: "0.05"
                        fontSize: .Nfont.n3
                        textAlign:
                          y: center
                    - type: label
                      dataKey: Global.email.name.data.senderName
                      style:
                        top: "0"
                        left: "0.16"
                        wordBreak: break-word
                        fontSize: .Nfont.n3
                        textAlign:
                          y: center
                - type: view
                  style:
                    marginTop: "0.01"
                    height: "auto"
                    width: "0.7"
                  children:
                    - type: label
                      text: "To:"
                      style:
                        left: "0.05"
                        textAlign:
                          y: center
                        fontSize: .Nfont.n3
                    - type: label
                      dataKey: Global.email.name.data.receiverName
                      style:
                        top: "0"
                        left: "0.13"
                        wordBreak: break-word
                        textAlign:
                          y: center
                        fontSize: .Nfont.n3
                - type: view
                  style:
                    marginTop: "0.01"
                    height: "auto"
                    width: "0.9"
                  children:
                    - type: label
                      text: "Subject:"
                      style:
                        left: "0.05"
                        textAlign:
                          y: center
                        fontSize: .Nfont.n3
                    - type: label
                      dataKey: Global.email.name.title
                      style:
                        top: "0"
                        textAlign:
                          y: center
                        fontSize: .Nfont.n3
                        left: "0.2"
                        wordBreak: break-word
                - type: view
                  style:
                    marginTop: "0.01"
                    height: "auto"
                    width: "0.9"
                  children:
                    - type: label
                      text: "Date:"
                      style:
                        left: "0.05"
                        textAlign:
                          y: center
                        fontSize: .Nfont.n3
                    - type: label
                      text=func: .builtIn.string.formatUnixtime_en
                      dataKey: Global.email.ctime
                      style:
                        top: "0"
                        left: "0.18"
                        height: "auto"
                        textAlign:
                          y: center
                        wordBreak: break-word
                        fontSize: .Nfont.n3
                - type: view
                  viewTag: viewUp
                  style:
                    display: none
                    marginTop: "0.01"
                    width: "0.9"
                    height: "0.17"
                    isHidden: "true"
                  children:
                    - type: textView
                      isEditable: false
                      dataKey: Global.email.name.data.content
                      style:
                        left: "0.05"
                        width: "0.8"
                        height: "0.13"

                        textAlign:
                          y: top
                        border:
                          style: "5"
                          width: "1"
                        backgroundColor: "0xf8f9fa"
                        color: "0x4c5264"
                        fontSize: .Nfont.n3
                    - type: view
                      style:
                        marginTop: "0.01"
                        width: "0.9"
                        height: "0.025"
                      children:
                        - type: image
                          path: reply_up.svg
                          style:
                            width: "0.05"
                            left: "0.425"
                          onClick:
                            - actionType: builtIn
                              funcName: hide
                              viewTag: viewUp
                            - actionType: builtIn
                              funcName: show
                              viewTag: viewDown
                - type: view
                  viewTag: viewDown
                  style:
                    marginTop: "0.01"
                    width: "0.9"
                    height: "0.025"
                  children:
                    - type: image
                      path: reply_down.svg
                      style:
                        width: "0.05"
                        left: "0.425"
                      onClick:
                        - actionType: builtIn
                          funcName: hide
                          viewTag: viewDown
                        - actionType: builtIn
                          funcName: show
                          viewTag: viewUp

    - type: list
      contentType: listObject
      listObject: ..formData.attachments
      iteratorVar: itemObject
      viewTag: attachmentList
      style:
        margin: "0"
        top: "0.88"
        left: "0"
        width: "0.96"
        height: "0.11"
        overflow: scroll
        axis: horizontal
      children:
        - type: listItem
          itemObject: ""
          style:
            width: "0.36"
            height: "0.11"
          children:
            - type: view
              style:
                marginTop: "0.01"
                height: "0.09"
                marginLeft: "0.02"
                width: "0.32"
                backgroundColor: "0xf8f9fa"
                borderWidth: "1"
                borderRadius: "10"
                border:
                  style: "1"
              onClick:
                - actionType: evalObject
                  object:
                    - .Global.formData.replyEmail@: =..apiRequest.email.docCreateReq
                    - .Global.formData.attachments@: =..formData.attachments
                - actionType: updateObject
                  dataKey: Global.showAttachment
                  dataObject: itemObject
                - goto: ShowAttachment
              children:
                - type: label
                  dataKey: itemObject.name.title
                  style:
                    top: "0.01"
                    left: "0.02"
                    width: "0.28"
                    text-overflow: ellipsis
                    whiteSpace: nowrap
                    overflow: hidden
                    fontSize: .Nfont.h2
                    textAlign:
                      x: left
                - type: image
                  path: slopedAttachment.svg
                  style:
                    top: "0.065"
                    left: "0.02"
                    height: "0.015"
                - type: label
                  text=func: .builtIn.string.bitFormatting
                  dataKey: itemObject.size
                  style:
                    top: "0.06"
                    left: "0.08"
                    width: "0.22"
                    height: auto
                    fontSize: .Nfont.h15
                    color: "#ced4df"
                    textAlign:
                      x: right
            - type: image
              path: greyDelete.svg
              style:
                top: "0.005"
                left: "0.305"
                height: "0.02"
              onClick:
                - emit:
                    dataKey:
                      var: itemObject
                    actions:
                      - ..apiRequest.attachment.deleteDocReq.id@: $var.id
                      - =..apiRequest.attachment.docAPI.delete: ""
                      - =.builtIn.array.removeById:
                          dataIn:
                            object: =..formData.attachments
                            id: $var.id
                - actionType: builtIn
                  funcName: redraw
                  viewTag: attachmentList
    - type: popUp
      viewTag: selectView
      style:
        left: "0"
        width: "1"
        top: "0"
        height: "1"
        backgroundColor: "0xa9a9a9cc"
        zIndex: 10000
      children:
        - type: view
          style:
            top: "0.61"
            width: "0.9"
            height: "0.27"
            left: "0.05"
            border:
              style: "1"
            borderRadius: "10"
            backgroundColor: "0xe9e9e9"
            zIndex: 1000
          children:
            - type: button
              text: Medical Document
              contentType: file
              onClick:
                - actionType: evalObject
                  object:
                    - .Global.email@: =.NewMessage2.apiRequest.email.docCreateReq
                - goto: AddMedicalRecordsToMeeting
              style:
                top: "0.02"
                width: "0.9"
                height: "0.06"
                fontSize: .Nfont.h3
                color: "0x1d88fc"
                backgroundColor: "0xe9e9e9"
                textAlign:
                  x: center
                border:
                  style: "2"
                  width: "0.0001"
                borderColor: "0x00000066"
            - type: button
              text: Camera
              contentType: file
              onClick:
                - actionType: openCamera
                  dataObject: BLOB
                  dataKey: NewMessage2.apiRequest.attachment.docReq.name.data
                # - actionType: evalObject
                #   object:
                #     - if:
                #       - =.builtIn.math.lessthanSize:
                #           dataIn:
                #             object: =..apiRequest.attachment.docReq.name.data  # obejct
                #             key: 2  #mb
                #       - ..formData.flag@: false
                #       - actionType: evalObject
                #         object:
                #           - =.builtIn.utils.getFileSize:
                #               dataIn:
                #                 object: =..apiRequest.attachment.docReq.name.data
                #                 units: mb
                #               dataOut: NewMessage2.formData.fileSize
                #           - =.builtIn.string.concat:
                #               dataIn:
                #                 - "Your file size:"
                #                 - =..formData.fileSize
                #                 - "Mb"
                #               dataOut: Global.formData.fileSize
                #           - ..formData.flag@: true
                # - actionType: builtIn
                #   funcName: redraw
                #   viewTag: overSize
                # - actionType: evalObject
                #   object:
                #     - if:
                #       - =..formData.flag
                #       - actionType: popUp
                #         popUpView: overSize
                #         wait: true
                #       - continue
                - actionType: evalObject
                  object:
                    - =.builtIn.utils.getFileName:
                        dataIn:
                          object: =.NewMessage2.apiRequest.attachment.docReq.name.data
                        dataOut: NewMessage2.apiRequest.attachment.docReq.name.title
                    - =..apiRequest.attachment.docAPI.store: ""
                    - =.builtIn.array.add:
                        dataIn:
                          object: =..formData.attachments
                          value: =..apiRequest.attachment.docResp.doc
                - actionType: builtIn
                  funcName: redraw
                  viewTag: attachmentList
                - actionType: popUpDismiss
                  popUpView: selectView
                - actionType: builtIn
                  funcName: checkField
                  contentType: messageHidden
              style:
                top: "0.085"
                width: "0.9"
                height: "0.06"
                fontSize: .Nfont.h3
                color: "0x1d88fc"
                backgroundColor: "0xe9e9e9"
                textAlign:
                  x: center
                border:
                  style: "2"
                  width: "0.0001"
                borderColor: "0x00000066"
            - type: button
              text: Photo Library
              contentType: file
              onClick:
                - actionType: openPhotoLibrary
                  dataObject: BLOB
                  dataKey: NewMessage2.apiRequest.attachment.docReq.name.data
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.math.lessthanSize:
                            dataIn:
                              object: =..apiRequest.attachment.docReq.name.data # obejct
                              key: 2 #mb
                        - ..formData.flag@: false
                        - actionType: evalObject
                          object:
                            - =.builtIn.utils.getFileSize:
                                dataIn:
                                  object: =..apiRequest.attachment.docReq.name.data
                                  units: mb
                                dataOut: NewMessage2.formData.fileSize
                            - =.builtIn.string.concat:
                                dataIn:
                                  - "Your file size:"
                                  - =..formData.fileSize
                                  - "Mb"
                                dataOut: Global.formData.fileSize
                            - ..formData.flag@: true
                - actionType: builtIn
                  funcName: redraw
                  viewTag: overSize
                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.flag
                        - actionType: popUp
                          popUpView: overSize
                          wait: true
                        - continue
                - actionType: evalObject
                  object:
                    - =.builtIn.utils.getFileName:
                        dataIn:
                          object: =.NewMessage2.apiRequest.attachment.docReq.name.data
                        dataOut: NewMessage2.apiRequest.attachment.docReq.name.title
                    - =..apiRequest.attachment.docAPI.store: ""
                    - =.builtIn.array.add:
                        dataIn:
                          object: =..formData.attachments
                          value: =..apiRequest.attachment.docResp.doc
                - actionType: builtIn
                  funcName: redraw
                  viewTag: attachmentList
                - actionType: popUpDismiss
                  popUpView: selectView
                - actionType: builtIn
                  funcName: checkField
                  contentType: messageHidden
              style:
                top: "0.146"
                width: "0.9"
                height: "0.06"
                fontSize: .Nfont.h3
                color: "0x1d88fc"
                backgroundColor: "0xe9e9e9"
                textAlign:
                  x: center
                border:
                  style: "2"
                  width: "0.0001"
                borderColor: "0x00000066"
            - type: button
              text: Files
              contentType: file
              onClick:
                - actionType: openDocumentManager
                  dataObject: BLOB
                  dataKey: NewMessage2.apiRequest.attachment.docReq.name.data
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.math.lessthanSize:
                            dataIn:
                              object: =..apiRequest.attachment.docReq.name.data # obejct
                              key: 2 #mb
                        - ..formData.flag@: false
                        - actionType: evalObject
                          object:
                            - =.builtIn.utils.getFileSize:
                                dataIn:
                                  object: =..apiRequest.attachment.docReq.name.data
                                  units: mb
                                dataOut: NewMessage2.formData.fileSize
                            - =.builtIn.string.concat:
                                dataIn:
                                  - "Your file size:"
                                  - =..formData.fileSize
                                  - "Mb"
                                dataOut: Global.formData.fileSize
                            - ..formData.flag@: true
                - actionType: builtIn
                  funcName: redraw
                  viewTag: overSize
                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.flag
                        - actionType: popUp
                          popUpView: overSize
                          wait: true
                        - continue
                - actionType: evalObject
                  object:
                    - =.builtIn.utils.getFileName:
                        dataIn:
                          object: =.NewMessage2.apiRequest.attachment.docReq.name.data
                        dataOut: NewMessage2.apiRequest.attachment.docReq.name.title
                    - =..apiRequest.attachment.docAPI.store: ""
                    - =.builtIn.array.add:
                        dataIn:
                          object: =..formData.attachments
                          value: =..apiRequest.attachment.docResp.doc
                - actionType: builtIn
                  funcName: redraw
                  viewTag: attachmentList
                - actionType: popUpDismiss
                  popUpView: selectView
                - actionType: builtIn
                  funcName: checkField
                  contentType: messageHidden
              style:
                top: "0.206"
                width: "0.9"
                height: "0.055"
                fontSize: .Nfont.h3
                color: "0x1d88fc"
                backgroundColor: "0xe9e9e9"
                textAlign:
                  x: center
                border:
                  style: 1
        - type: button
          text: Cancel
          style:
            top: "0.9"
            left: "0.05"
            width: "0.9"
            height: "0.06"
            fontSize: "18"
            color: "0x1d88fc"
            backgroundColor: "0xe9e9e9"
            textAlign:
              x: center
            borderRadius: "10"
            border:
              style: 1
          onClick:
            - actionType: popUpDismiss
              popUpView: selectView
    - .simplePopup:
      viewTag: backPopUpView
      children:
        - .simplePopupView:
          children:
            - .simplePopupLable:
            - .simplePopupSplit1:
            - .simplePopupSplit2:
            - .simplePopupLeftButton:
              onClick:
                - actionType: builtIn
                  funcName: goBack
                  reload: true
            - .simplePopupRightButton:
              onClick:
                - actionType: evalObject
                  object:
                    - ..apiRequest.email.docCreateReq.eid@: =.Global.rootNotebookID
                    - =..apiRequest.email.docAPI.store: ""
                    # - ..apiRequest.attachment.docReq.reid@: =..apiRequest.email.docResp.doc.id
                    # - =..apiRequest.attachment.docAPI.store: ""
                    - if:
                        - =..formData.attachments.0
                        - =.builtIn.ecos.updateDocListReid:
                            dataIn:
                              sourceDocList: =..formData.attachments
                              reid: =..apiRequest.email.docResp.doc.id
                        - continue
                - goto: InboxDashboard
    - .simplePopup:
      viewTag: sendPopUpView
      message: "No subject or content,still send the Message?"
      children:
        - .simplePopupView:
          children:
            - .simplePopupLable:
            - .simplePopupSplit1:
            - .simplePopupSplit2:
            - .simplePopupLeftButton:
            - .simplePopupRightButton:
              onClick:
                - actionType: evalObject
                  object:
                    - =..apiRequest.relation.edgeAPI.get: ""
                    - ..apiRequest.email.docReq.eid@: =..apiRequest.relation.edgeResp.edge.0.id
                    - if:
                        - =..formData.attachments.0
                        - ..apiRequest.email.docReq.name.data.haveAttachment@: true
                        - continue
                    - =..apiRequest.email.docAPI.store: ""
                    - if:
                        - =..formData.attachments.0
                        - =.builtIn.ecos.updateDocListReid:
                            dataIn:
                              sourceDocList: =..formData.attachments
                              reid: =..apiRequest.email.docResp.doc.id
                        - continue
                - actionType: popUpDismiss
                  popUpView: sendPopUpView
                - actionType: popUp
                  popUpView: sendSuccessfullyPopUpView
                - goto: InboxDashboard
    - .BaseoverSize:
