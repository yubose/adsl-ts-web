AddressManagement:
  title: Address Management
  pageNumber:
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - actionType: evalObject
      object:
        - actionType: evalObject
          async: true
          object:
            - =..apiRequest.profile.docAPI.get: ""
            - .Global.Profile@: =..apiRequest.profile.docResponse.doc.0
            - =..apiRequest.addressAll.docAPI.get: ""
            - .Global.formData.defaultAddressId@: =.Global.Profile.name.data.shoppingAddressId
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =..apiRequest.addressAll.docQueryResp.doc
              len: 0
        - actionType: evalObject
          object:
            - ..formData.emptyFlag@: "block"
            - ..formData.listDataFlag@: "none"
            - .Global.formData.defaultAddressId@: ""
            - .Global.Profile.name.data.shoppingAddressId@: ""
        - actionType: evalObject
          object:
            - ..formData.emptyFlag@: "none"
            - ..formData.listDataFlag@: "block"
    # 复显状态
    - if:
        - =.Global.formData.addrStatus
        - actionType: evalObject
          object:
            - ..formData.status@: "Edit"
            - ..formData.deleteShow@: "none"
            - ..formData.btnShow@: "block"
            - ..formData.scrollHeight@: "0.8460"
        - actionType: evalObject
          object:
            - ..formData.status@: "Done"
            - ..formData.deleteShow@: "block"
            - ..formData.btnShow@: "none"
            - ..formData.scrollHeight@: "0.9456"

  formData:
    listDataFlag: "block"
    emptyFlag: "none"
    status: "Edit"
    deleteShow: "none"
    btnShow: "none"
    scrollHeight: "0.8460"
    currentAddress: ""
  formDataTemp: ""
  apiRequest:
    # 获取所有的地址
    addressAll:
      docQueryResp: ""
      docQueryReq:
        type: .DocType.Address
        ids:
          - .Global.rootNotebookID
          - .Global.Profile.id
        xfname: eid,fid
        _nonce: =.Global._nonce
        obfname: ctime
      docAPI:
        get:
          api: rd
          dataIn: AddressManagement.apiRequest.addressAll.docQueryReq
          dataOut: AddressManagement.apiRequest.addressAll.docQueryResp
    # 删除选中的地址
    addressDocument:
      docQueryReq:
        id: ""
      docAPI:
        delete:
          api: dx
          dataIn: AddressManagement.apiRequest.addressDocument.docQueryReq
    # 获取当前profile信息
    profile:
      docCreateResp: ""
      docCreateReq: .Global.Profile
      docResponse: ""
      docRequest:
        id: .Global.rootNotebookID
        xfname: eid
        obfname: mtime
        type: .DocType.PatientProfile
        _nonce: =.Global._nonce
      docAPI:
        store:
          api: cd
          dataIn: AddressManagement.apiRequest.profile.docCreateReq
          dataOut: AddressManagement.apiRequest.profile.docCreateResp
        get:
          api: rd
          dataIn: AddressManagement.apiRequest.profile.docRequest
          dataOut: AddressManagement.apiRequest.profile.docResponse
  components:
    - .BasePublicHeader:
        children:
          - .BasePublicHeaderLeft:
            leftClick:
              - actionType: evalObject
                object:
                  - .Global.formData.addrStatus@: true
                  - actionType: builtIn
                    funcName: goBack
                    reload: true
          - .BasePublicHeaderTitle:
          - .BasePublicHeaderRightText:
            dataKey: formData.status
            viewTag: statusTag
            onClick:
              - ..event.changeClick
    - type: scrollView
      viewTag: scrollTag
      style:
        ..style.scrollBox:
        height: ..formData.scrollHeight
      children:
        - type: view
          viewTag: emptyAddressTag
          style:
            display: ..formData.emptyFlag
            marginTop: "0.262315"
            width: "1"
            textAlign:
              x: center
          children:
            - type: image
              path: emptyAddress.svg
              style:
                width: "0.586666"
                margin: auto
        - type: list
          viewTag: addressTag
          contentType: listObject
          listObject: ..apiRequest.addressAll.docQueryResp.doc
          iteratorVar: itemObject
          style:
            ..style.ulStyle:
            height: ..formData.scrollHeight
            display: ..formData.listDataFlag
          children:
            - type: listItem
              itemObject:
              style:
                ..style.listBox:
              children:
                - type: view
                  style:
                    ..style.itemView:
                  onClick:
                    - ..event.itemClick
                  children:
                    - type: view
                      style:
                        ..style.listChildBox:
                      children:
                        - type: view
                          style:
                            marginTop: "18px"
                          children:
                            - type: label
                              text: Name
                              dataKey:
                              style:
                                ..style.listTitle:
                            - type: label
                              text:
                              dataKey: itemObject.name.data.userName
                              style:
                                ..style.listTitleContent:

                        - type: view
                          style:
                            marginTop: "0.0073"
                          children:
                            - type: label
                              text: Phone#
                              dataKey:
                              style:
                                ..style.listTitle:
                            - type: label
                              text:
                              dataKey: itemObject.name.data.phone.fullPhone
                              style:
                                ..style.listTitleContent:
                        - type: view
                          style:
                            marginTop: "0.0073"
                          children:
                            - type: label
                              text: Email
                              dataKey:
                              style:
                                ..style.listTitle:
                            - type: label
                              text:
                              dataKey: itemObject.name.data.email
                              style:
                                ..style.listTitleContent:
                        - type: view
                          style:
                            marginTop: "0.0036"
                          children:
                            - type: label
                              text: Address
                              dataKey:
                              style:
                                ..style.listTitle:
                            - type: view
                              style:
                                display: "inline-block"
                              children:
                                - type: label
                                  text:
                                  dataKey: itemObject.name.data.address.fullAddress
                                  style:
                                    ..style.addressContent:
                        - type: image
                          # path: defaultIcon.svg
                          path:
                            ..event.defaultPath:
                          style:
                            ..style.defaultImg:
                        - type: view
                          style:
                            height: "0.012"
                            width: "0.92"
                    - type: view
                      viewTag: deleTag
                      bubble: true
                      style:
                        top: "0.007389"
                        width: "0.12"
                        height: "0.06"
                        left: "0.8"
                        display: ..formData.deleteShow
                      onClick:
                        - ..event.delClick
                      children:
                        - type: image
                          path: x.svg
                          style:
                            top: "0"
                            left: "0.06"
                            height: "0.02"
                    - type: view
                      viewTag: deleTag
                      bubble: true
                      style:
                        top: "0.007389"
                        width: "0.12"
                        height: "0.04"
                        left: "0.8"
                        display: ..formData.deleteShow
                      onClick:
                        - ..event.delClick
                      children:
                        - type: image
                          path: x.svg
                          style:
                            top: "0"
                            left: "0.06"
                            height: "0.02"
                    - type: view
                      viewTag: deleTag
                      bubble: true
                      style:
                        top: "0.0738916"
                        width: "0.12"
                        height: "0.04"
                        left: "0.8"
                        display: ..formData.deleteShow
                      onClick:
                        - ..event.editClick
                      children:
                        - type: image
                          path: editIcon.svg
                          style:
                            top: "0"
                            left: "0.06"
                            height: "0.02"
    - type: view
      viewTag: btnTag
      style:
        ..style.btnBox:
        display: ..formData.btnShow
      children:
        - type: button
          text: Add New
          dataKey:
          style:
            ..style.btn:
          onClick:
            - ..event.btnClick
    - .publicDeleteUP:
      viewTag: BaseDelWarningView
      leftButton:
        - actionType: popUpDismiss
          popUpView: BaseDelWarningView
      rightButton:
        - actionType: evalObject
          object:
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =..formData.currentAddress.id
                      string2: =.Global.formData.defaultAddressId
                - actionType: evalObject
                  object:
                    - ..formData.filterAddress@: =..apiRequest.addressAll.docQueryResp.doc
                    - =.builtIn.array.removeByName:
                        dataIn:
                          object: =..formData.filterAddress
                          key: id
                          name: =..formData.currentAddress.id
                    - .Global.formData.defaultAddressId@: =..formData.filterAddress.0.id
                - continue
        - actionType: evalObject
          object:
            - ..apiRequest.addressDocument.docQueryReq.id@: =..formData.currentAddress.id
            - =..apiRequest.addressDocument.docAPI.delete: ""
        - actionType: evalObject
          object:
            .Global._nonce@:
              =.builtIn.math.random: ""
        - actionType: evalObject
          object:
            - =..apiRequest.addressAll.docAPI.get: ""
        - actionType: evalObject
          object:
            - if:
                - =.builtIn.array.judgeListLength:
                    dataIn:
                      array: =..apiRequest.addressAll.docQueryResp.doc
                      len: 0
                - .Global.formData.defaultAddressId@: ""
                - continue
        # update profile下默认购物地址
        - actionType: evalObject
          object:
            - ..apiRequest.profile.docCreateReq.name.data.shoppingAddressId@: =.Global.formData.defaultAddressId
            - =..apiRequest.profile.docAPI.store: ""
        - actionType: evalObject
          object:
            # 更新本地的profile信息
            - .Global.Profile@: =..apiRequest.profile.docCreateResp.doc

        - actionType: evalObject
          object:
            - if:
                - =.builtIn.array.judgeListLength:
                    dataIn:
                      array: =..apiRequest.addressAll.docQueryResp.doc
                      len: 0
                - actionType: evalObject
                  object:
                    - ..formData.emptyFlag@: "block"
                    - ..formData.listDataFlag@: "none"
                - actionType: evalObject
                  object:
                    - ..formData.emptyFlag@: "none"
                    - ..formData.listDataFlag@: "block"
        - actionType: builtIn
          funcName: redraw
          viewTag: addressTag
        - actionType: builtIn
          funcName: redraw
          viewTag: emptyAddressTag
        - actionType: popUpDismiss
          popUpView: BaseDelWarningView
  event:
    defaultPath:
      emit:
        dataKey:
          var: itemObject
        actions:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =.Global.formData.defaultAddressId
                    string2: $var.id
              - defaultIcon.png
              - null.png
    itemClick:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - .Global.formData.selectAddress@: $var
      - actionType: evalObject
        object:
          - if:
              - =.Global.formData.currentAddressStatus
              - continue
              - actionType: evalObject
                object:
                  - .Global.formData.addrStatus@: true
                  - goto: OrderConfirmation
    btnClick:
      - actionType: evalObject
        object:
          - .Global.formData.selectAddress@: ""
          - .Global.formData.addrStatus@: true
          - goto: EditAddress
    delClick:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - ..formData.currentAddress@: $var
      - actionType: popUp
        popUpView: BaseDelWarningView
    changeClick:
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..formData.status
                    string2: "Edit"
              - actionType: evalObject
                object:
                  - .Global.formData.addrStatus@: false
                  - ..formData.status@: "Done"
                  - ..formData.deleteShow@: "block"
                  - ..formData.btnShow@: "none"
                  - ..formData.scrollHeight@: "0.9456"
              - actionType: evalObject
                object:
                  - .Global.formData.addrStatus@: true
                  - ..formData.status@: "Edit"
                  - ..formData.deleteShow@: "none"
                  - ..formData.btnShow@: "block"
                  - ..formData.scrollHeight@: "0.8460"
      - actionType: builtIn
        funcName: redraw
        viewTag: statusTag
      - actionType: builtIn
        funcName: redraw
        viewTag: btnTag
      - actionType: builtIn
        funcName: redraw
        viewTag: scrollTag
    editClick:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - .Global.formData.selectAddress@: $var
      - actionType: evalObject
        object:
          - .Global.formData.addrStatus@: false
          - goto: EditAddress
  style:
    scrollBox:
      width: "1"
      boxSizing: "border-box"
      overflow: "scroll"
      backgroundColor: "0xf5f5f5"
      fontSize: .Nfont.h14
      paddingBottom: "0.0295566"
    btnBox:
      width: "1"
      height: "0.0985"
      boxSizing: "border-box"
      # overflow: "scroll"
      backgroundColor: "#ffffff"
      boxShadow: "1px 1px 4px 1px #dededf"
      textAlign:
        x: center
    ulStyle:
      width: "0.92"
      margin: "0"
      height: auto
      marginLeft: "0.04"
    listBox:
      width: "0.92"
      backgroundColor: "0xf5f5f5"
      borderRadius: "4"
      boxSizing: "border-box"
      overflow: hidden
    listChildBox:
      # marginTop: "0.0221"
      # marginBottom: "0.012"
      overflow: hidden
    itemView:
      width: "0.92"
      height: auto
      backgroundColor: "0xffffff"
      marginTop: "0.015"
      borderRadius: "4"
      boxSizing: "border-box"
      overflow: hidden
    listTitle:
      display: "inline-block"
      fontWeight: 600
      marginLeft: "0.04"
      width: "0.1599"
    listTitleContent:
      display: "inline-block"
      width: "0.576"
      whiteSpace: "nowrap"
      overflow: hidden
      text-overflow: "ellipsis"
      color: "#666666"
    editStyle:
      display: "inline-block"
      marginLeft: "0.029"
      color: "#2988e6"
      fontWeight: 600
      textDecoration: underline
    defaultImg:
      width: "0.12"
      height: "0.01847"
      marginLeft: "0.76"
    addressContent:
      display: "-webkit-box"
      color: "#666666"
      width: "0.55"
      overflow: hidden
      text-overflow: "ellipsis"
      webkitBoxOrient: vertical
      -webkit-line-clamp: 2
      wordBreak: break-word
    btn:
      marginTop: "0.0123"
      height: "0.0443"
      width: "0.84"
      border:
        style: 1
      borderRadius: "5"
      backgroundColor: "#2988e6"
      color: "#ffffff"
      fontSize: .Nfont.h14
      boxSizing: border-box
      fontWeight: "600"
      textAlign:
        x: center
