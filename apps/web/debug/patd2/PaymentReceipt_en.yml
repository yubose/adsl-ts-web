PaymentReceipt:
  title: Receipt
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - =..apiRequest.FinancialInfo.docAPI.get: ""
    - if:
        - =..apiRequest.FinancialInfo.docQueryResp.doc.0
        - ..formData.amount@: =..apiRequest.FinancialInfo.docQueryResp.doc.0.name.data.paymentInfo.fee
        - ..formData.amount@: =.Global.roomInfo.edge.name.fee
    - =..apiRequest.paymentEdge.edgeAPI.get: ""
    - ..apiRequest.hasPaidProfile.getDocReq.id@: =..apiRequest.paymentEdge.edgeResp.edge.0.id
    - ..apiRequest.refund.docQueryReq.id@: =..apiRequest.paymentEdge.edgeResp.edge.0.id
    - =..apiRequest.hasPaidProfile.docAPI.get: ""
    - =..apiRequest.refund.docAPI.get: ""
    - =.builtIn.object.extractArray:
        dataIn:
          obj: =..apiRequest.hasPaidProfile.getDocResp.doc
          arr: ["name.data.orderInfo.amount"]
        dataOut: PaymentReceipt.formData.paidAmountList
    - =.builtIn.array.getListByKey:
        dataIn:
          array: =..formData.paidAmountList
          keyId: amount
        dataOut: PaymentReceipt.formData.paidAmountList
    - =.builtIn.object.extractArray:
        dataIn:
          obj: =..apiRequest.refund.docQueryResp.doc
          arr: ["name.data.orderInfo.amount"]
        dataOut: PaymentReceipt.formData.refundAmountList
    - =.builtIn.array.getListByKey:
        dataIn:
          array: =..formData.refundAmountList
          keyId: amount
        dataOut: PaymentReceipt.formData.refundAmountList
    - =.builtIn.array.concat:
        dataIn:
          array1: =..formData.paidAmountList
          array2: =..formData.refundAmountList
        dataOut: PaymentReceipt.formData.amountPaidList
    - =.builtIn.math.cumulative:
        dataIn:
          numArr: =..formData.amountPaidList
        dataOut: PaymentReceipt.formData.amountPaid
    - =.builtIn.math.toFixedNum:
        dataIn:
          num: =..formData.amountPaid
        dataOut: PaymentReceipt.formData.amountPaid
  apiRequest:
    paymentEdge:
      edgeResp: ""
      edgeIn:
        id: .Global.roomInfo.edge.id
        xfname: refid
        _nonce: .Global._nonce
        type: 1113
        obfname: mtime
        subtype: 1
      edgeAPI:
        get:
          api: re
          dataIn: PaymentReceipt.apiRequest.paymentEdge.edgeIn
          dataOut: PaymentReceipt.apiRequest.paymentEdge.edgeResp
    refund:
      docQueryResp: ""
      docQueryReq:
        id: ""
        xfname: eid
        type: .DocType.Refund
        obfname: mtime
        _nonce: .Global._nonce
        maxcount: "1000"
      docAPI:
        get:
          api: rd
          dataIn: PaymentReceipt.apiRequest.refund.docQueryReq
          dataOut: PaymentReceipt.apiRequest.refund.docQueryResp
    hasPaidProfile:
      getDocResp: ""
      getDocReq:
        id: ""
        xfname: eid
        type: 2001
        obfname: mtime
        _nonce: .Global._nonce
        maxcount: "100"
      docAPI:
        get:
          api: rd
          dataIn: PaymentReceipt.apiRequest.hasPaidProfile.getDocReq
          dataOut: PaymentReceipt.apiRequest.hasPaidProfile.getDocResp
    FinancialInfo:
      docQueryResp: ""
      docQueryReq:
        id: .Global.roomInfo.edge.id
        xfname: reid
        obfname: mtime
        maxcount: "1"
        _nonce: =.Global._nonce
        type: .DocType.FinancialInfo
      docAPI:
        get:
          api: rd
          dataIn: PaymentReceipt.apiRequest.FinancialInfo.docQueryReq
          dataOut: PaymentReceipt.apiRequest.FinancialInfo.docQueryResp
  formData:
    paidAmountList: []
    refundAmountList: []
    amountPaidList: []
    amountPaid: ""
    payProfile: ""
    Profile: ""
    facility: ""
    amount: ""
  components:
    - type: popUp
      viewTag: softTips
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
        zIndex: "200"
        textAlign:
          y: center
      onClick:
        - actionType: popUpDismiss
          popUpView: __.viewTag
      children:
        - type: view
          style:
            width: "0.72"
            marginLeft: "0.14133"
            backgroundColor: "0xE6E6E6"
            borderRadius: "14px"
            textAlign:
              x: center
          children:
            - type: label
              textBoard:
                - text: Refunds may be requested to
                - text: "&nbsp;"
                - text: A&C Urgentcare
                  dataKey: formData.facility.name.data.basicInfo.medicalFacilityName
                  color: "#2887e5"
                - text: ",please contact them directly at"
                - text: "&nbsp;"
                - text: "(714) 634-4884"
                  dataKey: formData.facility.name.data.basicInfo.phoneNumber
                  color: "#2887e5"
                - text: "&nbsp;"
                - text: "."
              style:
                width: "0.58133"
                marginLeft: "0.072"
                marginTop: "0.0222"
                fontSize: .Nfont.h14

                textAlign:
                  x: left
                color: "0x333333"
                lineHeight: "2.21vh"
            - type: view
              style:
                height: "0.027"
    - .BaseHeader:
    - .HeaderLeftButton:
    - type: view
      style:
        top: "0.1"
        left: "0"
        width: "1"
        height: "0.9"
        overflow: scroll
      children:
        - type: view
          style:
            width: "0.9"
            height: "auto"
            marginLeft: "0.05"
            marginTop: "0.02"
          children:
            - .PresListView:
              children:
                - .PresLabelLeft:
                  text: "Receipt #"
                - .PresLabelRight:
                  text: "12345"
                  dataKey: apiRequest.hasPaidProfile.getDocResp.doc.0.deat.squareID
            - .PresListView:
              children:
                - .PresLabelLeft:
                  text: "Payment Date"
                - .PresLabelRight:
                  text=func: .builtIn.string.formatUnixtimeL_en
                  dataKey: apiRequest.hasPaidProfile.getDocResp.doc.0.ctime
            - .PresListView:
              children:
                - .PresLabelLeft:
                  text: "Patient"
                - .PresLabelRight:
                  text: "Thomas Mueller"
                  dataKey: apiRequest.hasPaidProfile.getDocResp.doc.0.name.data.orderInfo.payer
            - .PresListView:
              children:
                - .PresLabelLeft:
                  text: "Appointment Type"
                - .PresLabelRight:
                  text: "Office Visit"
                  dataKey: apiRequest.hasPaidProfile.getDocResp.doc.0.name.data.appointmentInfo.visitType
            - .PresListView:
              children:
                - .PresLabelLeft:
                  text: "Provider"
                - .PresLabelRight:
                  text: "--"
                  dataKey: apiRequest.hasPaidProfile.getDocResp.doc.0.name.data.appointmentInfo.providerName
        - type: view
          style:
            width: "0.9"
            height: "0.08"
            marginLeft: "0.05"
            marginTop: "0.025"
            borderRadius: 5px
            border:
              style: 3
              color: "0xDEDEDF"
          children:
            - type: view
              style:
                width: "0.9"
                height: "0.04"
                backgroundColor: "0xf8f8f8"
                borderBottom: "1px solid #DEDEDF"
                borderWidth: "1px"
              children:
                - type: label
                  text: "Date of Service"
                  style:
                    marginTop: "0.01"
                    display: "inline-block"
                    width: "0.3"
                    color: "0x666666"
                    fontSize: .Nfont.h0_2
                    textAlign:
                      x: center
                - type: label
                  text: "Reason for Visit"
                  style:
                    marginTop: "0.01"
                    display: "inline-block"
                    width: "0.3"
                    color: "0x666666"
                    fontSize: .Nfont.h0_2
                    textAlign:
                      x: center
                - type: label
                  text: "Amount Due"
                  style:
                    marginTop: "0.01"
                    display: "inline-block"
                    width: "0.3"
                    color: "0x666666"
                    fontSize: .Nfont.h0_2
                    textAlign:
                      x: center
            - type: view
              style:
                width: "0.9"
              children:
                - type: label
                  text=func: .builtIn.string.formatUnixtimeL_en
                  dataKey: apiRequest.hasPaidProfile.getDocResp.doc.0.ctime
                  style:
                    marginTop: "0.01"
                    display: "inline-block"
                    width: "0.3"
                    fontSize: .Nfont.h1_1
                    textAlign:
                      x: center
                - type: label
                  text: "New Consult"
                  dataKey: apiRequest.hasPaidProfile.getDocResp.doc.0.name.data.appointmentInfo.reason
                  style:
                    marginTop: "0.01"
                    display: "inline-block"
                    width: "0.3"
                    fontSize: .Nfont.h1_1
                    textAlign:
                      x: center
                - type: label
                  text: "$75.00"
                  text=func: .builtIn.string.dollarFormat
                  dataKey: formData.amount
                  style:
                    marginTop: "0.01"
                    display: "inline-block"
                    width: "0.3"
                    fontSize: .Nfont.h1_1
                    textAlign:
                      x: center
        - type: view
          style:
            width: "0.9"
            height: "0.06"
            marginLeft: "0.05"
            marginTop: "0.02"
          children:
            - type: label
              text: "Amount Paid:"
              style:
                display: "inline-block"
                width: "0.6"
                height: "0.03"
                marginLeft: "0"
                color: "0x707070"
                fontSize: .Nfont.h1_1
                textAlign:
                  x: right
            - type: label
              text=func: .builtIn.string.dollarFormat
              dataKey: formData.amountPaid
              style:
                marginLeft: "0"
                width: "0.3"
                fontSize: .Nfont.h1_1
                fontWeight: "bold"
                display: "inline-block"
                textAlign:
                  x: right

        - type: view
          style:
            width: "0.9"
            height: "auto"
            marginLeft: "0.05"
            marginTop: "0.01"
          children:
            - type: label
              text: "Paid to:"
              style:
                width: "0.15"
                height: "0.03"
                marginTop: "0"
                marginLeft: "0"
                color: "0x333333"
                fontSize: .Nfont.n2
                fontWeight: "600"
                display: "inline-block"
            - type: view
              style:
                width: "0.75"
                height: "auto"
                display: "inline-block"
              children:
                - type: label
                  text: "{Medical facility name}"
                  dataKey: Global.currentFacility.name.data.basicInfo.medicalFacilityName
                  style:
                    marginTop: "0"
                    marginLeft: "0"
                    width: "0.75"
                    height: "0.03"
                    fontSize: .Nfont.n2
                    fontWeight: "400"
                    color: "0x666666"
                    textAlign:
                      x: right
                - type: label
                  text: "{Medical facility name address}"
                  dataKey: Global.currentFacility.name.data.basicInfo.location
                  style:
                    marginTop: "0.01"
                    marginLeft: "0"
                    width: "0.75"
                    height: "0.03"
                    fontSize: .Nfont.n2
                    fontWeight: "400"
                    color: "0x666666"
                    textAlign:
                      x: right
    - type: view
      style:
        top: "0.8"
        left: "0.05"
        height: "0.2"
        width: "1"

        # boxShadow: "1px 1px 4px 1px #dededf"
        # overflow: hidden
      children:
        - type: label
          textBoard:
            - text: "Refunds may be requested to&nbsp;"
              color: "0x666666"
            - dataKey: Global.currentFacility.name.data.basicInfo.medicalFacilityName
              color: "0x666666"
              fontWeight: "700"
              textDecoration: underline
            - text: ", please contact them directly at&nbsp;"
              color: "0x666666"
            - dataKey: Global.currentFacility.name.data.basicInfo.phoneNumber
              color: "0x666666"
              textDecoration: underline
              fontWeight: "700"
            - text: "."
              color: "0x666666"
          style:
            width: "0.9"
            height: "auto"
            fontSize: .Nfont.h0_1
