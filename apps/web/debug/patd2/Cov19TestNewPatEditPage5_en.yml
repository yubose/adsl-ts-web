Cov19TestNewPatEditPage5:
  title: "COVID-19 Testing Consent - New Patient"

  pageNumber: "" # PageNumber

  init:
    - .SignInCheck
    # 获取facility name
    - .Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.facilityName@: =.Global.currentFacility.name.data.basicInfo.medicalFacilityName
    # 判断是否签名
    - if:
        - =.Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.whetherIsolationSignature
        - continue
        # 非空修改显示的标识,刷新签名区域
        - actionType: evalObject
          object:
            # 签名的时间
            - ..formData.signatureTime@: =.Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.signatureTime
            # 签名的id
            - ..formData.temporarySignature@: =.Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.id
            - ..formData.flag@: "block"
    # 判断是否Name of Recipient/Healthcare Proxy存在
    - actionType: evalObject
      object:
        - if:
            - =.Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.recipientName
            - ..formData.recipientName@: =.Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.recipientName
            - continue
  formData:
    doc: ""
    recipientName: ""
    # 获取暂存的签名的id
    temporarySignature: ""
    # 签名的显示,默认为none
    flag: "none"
    # 是否签名 true 表示未签 false 表示已签
    whetherIsolationSignature: ""
    signatureTime: ""
  formDataTemp: #Input data temp here, datatemp should not mix with formData

  apiRequest:
    cov19TestNewPatForm:
      docReq: ""
      docRes: ""
      docAPI:
        store:
          api: cd
          dataIn: Cov19TestNewPatEditPage5.apiRequest.cov19TestNewPatForm.docReq
          dataOut: Cov19TestNewPatEditPage5.apiRequest.cov19TestNewPatForm.docRes
    newSign:
      docRes: ""
      docReq: #DOC
        type: .DocType.UserSignature
        eid: .Global.rootNotebookID
        reid: .Global.formData.cov19TestNewPatForm.id
        name:
          title: ""
          type: ..apiRequest.newSign.docReq.subtype.mediaType
          data: ""
        subtype:
          mediaType: ""
      docAPI: # DOCAPI
        store:
          api: cd
          dataIn: Cov19TestNewPatEditPage5.apiRequest.newSign.docReq
          dataOut: Cov19TestNewPatEditPage5.apiRequest.newSign.docRes

  components:
    - type: view
      style:
        ..style.formatting:
      children:
        - .BasePublicHeader:
          children:
            - type: view
              style:
                ..style.backLeft:
              children:
                - type: image
                  path: arrowLeftgrey.svg
                  style:
                    ..style.backLeftImg:
                  onClick:
                    - ..event.publicClick
                    - ..event.backClick
            - .BasePublicHeaderTitle:
              style:
                fontSize: .Nfont.h14
        - type: view
          style:
            ..style.bodyBox:
          children:
            - type: view
              style:
                ..style.viewBox:
              children:
                - type: view
                  style:
                    ..style.titleBox:
                  children:
                    - type: label
                      text: Agreement For Self-Isolation
                      dataKey:
                      style:
                        ..style.titlelabel:
                    - type: label
                      text: "5&nbsp;/&nbsp;5"
                      dataKey:
                      style:
                        ..style.pageNum:
            - type: scrollView
              style:
                ..style.scrollBox:
              children:
                - type: label
                  text: "The local health jurisdiction has determined that if you are under suspicion for having COVID-19 due to symptoms and testing request, that it is necessary to be placed in isolation in order to prevent the transmission of this infection. It is important for you to comply with this Isolation Agreement in order to protect the public’s health. Thank you for agreeing to cooperate."
                  style:
                    ..style.text:

                - type: label
                  text: "Please Carefully Read The Following Informed Consent:"
                  dataKey:
                  style:
                    ..style.secondLabel:
                - type: label
                  textBoard:
                    - text: "a. I understand that I may be infected with the virus causing COVID-19 and that I meet criteria for isolation."
                    - br:
                    - br:
                    - text: "b. I agree that while I wait for my COVID-19 test results, I will remain in self-isolation."
                    - br:
                    - br:
                    - text: "c. I agree that if my COVID-19 test results are positive, I will remain isolated for 7 days from this day of testing OR until at least 72 hours after my symptoms have resolved, whichever is longer."
                    - br:
                    - br:
                    - text: "d. I agree that if my COVID-19 test results are negative, I will remain isolated until at least 72 hours after my symptoms have resolved."
                    - br:
                    - br:
                    - text: "e. I understand that if I am not isolated while ill, I could pose a substantial threat to the health of other persons"
                    - br:
                    - br:
                    - text: "f. I agree that I will not come into contact with any other person who is not isolated or ill due to potential COVID- 19 infection."
                    - br:
                    - br:
                    - text: "g. I understand that if I test positive for IgM antibody, I may need to take a COVID-19 swab test for active virus confirmation. "
                    - br:
                    - br:
                    - text: "h. I understand that testing positive for antibody does not mean immunity to COVID-19."
                    - br:
                    - br:
                    - text: "I, the undersigned, have been informed about the test purpose, procedures, possible benefits and risks, and I have received a copy of this Informed consent. I have been given the opportunity to ask questions before I sign, and I have been told that I can ask other questions at any time. I voluntarily agree to testing for COVID-19 and to self-isolation.  If "
                      color: "#666666"
                    - text: "Medical Facility Name"
                      dataKey: Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.facilityName
                      color: "#666666"
                    - text: " does not accept my insurance I consent to being financially responsible for the testing. If my insurance denies covering the cost of the testing I consent to being financially responsible for the testing."
                      color: "#666666"

                  style:
                    ..style.text:

                - type: label
                  text: "Name Of Recipient/Healthcare Proxy"
                  dataKey:
                  style:
                    ..style.secondLabel:
                    marginTop: "0.0197"
                - type: textField
                  placeholder: Enter here
                  dataKey: formData.recipientName
                  style:
                    ..style.blockInput:

                - type: label
                  text: "Signature"
                  dataKey:
                  style:
                    ..style.secondLabel:

                - type: view
                  style:
                    ..style.blockBox:
                  children:
                    - type: label
                      text: Click on the signature box below to finger sign
                      dataKey:
                      style:
                        ..style.signTips:
                    - type: label
                      text: Clear
                      dataKey:
                      style:
                        ..style.signClear:
                      onClick:
                        - ..event.signReset

                - type: view
                  style:
                    marginTop: "0.01"
                    height: "0.128"
                    width: "0.9"
                    border:
                      style: "4"
                      color: "0xa9a9a9"
                    borderWidth: "2"
                  children:
                    - type: label
                      text: X
                      style:
                        .SignLabelStyle:
                    - type: canvas
                      dataKey: Cov19TestNewPatEditPage5.apiRequest.newSign.docReq.name.data
                      viewTag: signatureTag
                      style:
                        left: "0"
                        width: "0.88"
                        height: "0.128"
                        overflow: scroll
                    - type: image
                      viewTag: signatureShowTag
                      path=func: .builtIn.utils.prepareDocToPath
                      dataKey: Cov19TestNewPatEditPage5.formData.temporarySignature
                      style:
                        display: ..formData.flag
                        left: "0"
                        width: "0.88"
                        top: "0"
                        height: "0.128"
                        overflow: scroll
                        zIndex: "1000"

                - type: view
                  style:
                    width: "0.92"
                    height: "auto"
                    overflow: hidden
                  children:
                    - type: view
                      style:
                        ..style.blockBox:
                        marginTop: "0.02216"
                      children:
                        - type: label
                          text: Patient Name
                          style:
                            ..style.blockBoxLeft:
                        - type: label
                          text:
                          dataKey: Global.formData.cov19TestNewPatForm.name.data.patientInfo.fullName
                          style:
                            ..style.blockBoxRight:
                    - type: view
                      style:
                        ..style.blockBox:
                      children:
                        - type: label
                          text: Date
                          style:
                            ..style.blockBoxLeft:
                        - type: label
                          text=func: .builtIn.string.formatUnixtimeL_en
                          dataKey: Global.formData.cov19TestNewPatForm.ctime
                          style:
                            ..style.blockBoxRight:
                - type: view
                  style:
                    marginTop: "0.03"

        - type: view
          style:
            ..style.btnBox:
          children:
            - type: button
              text: Done
              dataKey:
              style:
                ..style.btn:
              onClick:
                - ..event.publicClick
                - ..event.btnClick

    - .BaseWarningView:
      viewTag: BaseWarningView
      message: "You haven't signed the form"
  event:
    signReset:
      # 移除签名
      - actionType: removeSignature
        dataObject: BLOB
        dataKey: Cov19TestNewPatEditPage5.apiRequest.newSign.docReq.name.data
        viewTag: signatureTag
      # 重置临时签名
      - actionType: evalObject
        object:
          - ..formData.temporarySignature@: ""
          - ..formData.signatureTime@: ""
      # 显示签名区域隐藏
      - actionType: builtIn
        funcName: hide
        viewTag: signatureShowTag
      - actionType: builtIn
        funcName: show
        viewTag: signatureTag
    publicClick:
      # 签名处理
      - actionType: saveSignature
        dataObject: BLOB
        dataKey: Cov19TestNewPatEditPage5.apiRequest.newSign.docReq.name.data
        isEmpty: Cov19TestNewPatEditPage5.formData.whetherIsolationSignature
      - actionType: evalObject
        object:
          - if:
              - =..formData.whetherIsolationSignature
              - continue
              - =..apiRequest.newSign.docAPI.store: ""

      - actionType: evalObject
        object:
          - if:
              - =..formData.temporarySignature
              - actionType: evalObject
                object:
                  - .Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.signatureTime@: =..formData.signatureTime
                  - .Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.id@: =..formData.temporarySignature
                  - .Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.whetherIsolationSignature@: false
                  - ..formData.whetherIsolationSignature@: false
              - actionType: evalObject
                object:
                  - .Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.signatureTime@: =..apiRequest.newSign.docRes.doc.ctime
                  - .Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.id@: =..apiRequest.newSign.docRes.doc.id
                  - .Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.whetherIsolationSignature@: =..formData.whetherIsolationSignature

      - actionType: evalObject
        object:
          - .Global.formData.cov19TestNewPatForm.name.data.signatureIsolation.recipientName@: =..formData.recipientName

    btnClick:
      - actionType: evalObject
        object:
          - if:
              - =..formData.whetherIsolationSignature
              - actionType: popUp
                popUpView: BaseWarningView
                wait: true
                popUpDismiss: 2000
              - continue
          - ..apiRequest.cov19TestNewPatForm.docReq@: =.Global.formData.cov19TestNewPatForm
          - =.builtIn.array.add:
              dataIn:
                object: =.Global.vaccine
                value: "COVID-19 Testing Consent - New Patient"
          - =.builtIn.array.elementUnique:
              dataIn:
                arr: =.Global.vaccine
              dataOut: Cov19TestNewPatEditPage5.formData.doc
          - .Global.vaccine@: ""
          - .Global.vaccine@: =..formData.doc
          - =..apiRequest.cov19TestNewPatForm.docAPI.store: ""
          - =.builtIn.array.add:
              dataIn:
                object: =.Global.roomInfo.edge.name.finishDoc
                value: "COVID-19 Testing Consent - New Patient"
          - .Global.formData.cov19TestNewPatForm@: =..apiRequest.cov19TestNewPatForm.docRes.doc
      - goto: =.Global.formData.selectCategory
    backClick:
      - actionType: builtIn
        funcName: goBack
        reload: true

  style: #Input style fragment here
    formatting:
      margin: "0"
      padding: "0"
      height: "1"
      width: "1"
      overflow: hidden
      boxSizing: border-box

      color: "0x333333"
      fontSize: .Nfont.h16
    bodyBox:
      width: "auto"
      height: "0.84852"
    backLeft:
      marginLeft: "0.04"
      display: "inline-block"
      verticalAlign: middle
      height: "0.055"
      boxSizing: border-box
    backLeftImg:
      marginTop: "0.012"
      height: "0.0295"
    viewBox:
      marginLeft: "0.04"
      height: "auto"
      width: "0.92"
      overflow: hidden

    titleBox:
      marginTop: "0.0270"
      paddingBottom: "1.23vh"
      width: "0.92"
      height: "auto"
      border:
        style: 2
      borderWidth: "1"
      borderColor: "#dedede"
    titlelabel:
      display: "inline-block"
      fontSize: .Nfont.h16
      color: "0x333333"
      width: "0.753125"
      height: "auto"
      fontWeight: "700"
      verticalAlign: top
      lineHeight: "2.95vh"
    pageNum:
      marginLeft: "0.064"
      display: "inline-block"
      height: "0.0221"
      width: "0.1013"
      backgroundColor: "0x2988e6"
      color: "0xffffff"
      fontSize: .Nfont.h14
      fontWeight: "700"
      borderRadius: "3"
      verticalAlign: top
      textAlign:
        x: center
    scrollBox:
      marginLeft: "0.04"
      width: "0.92"
      height: "0.7832"
      boxSizing: border-box
      overflow: scroll
    secondLabel:
      width: "0.92"
      fontSize: .Nfont.h14
      fontWeight: "700"
      color: "0x333333"
      marginTop: "0.0246"
      lineHeight: "2.58vh"
    text:
      marginTop: "0.0172"
      height: "auto"
      width: "0.92"
      fontSize: .Nfont.h14
      lineHeight: "2.58vh"
      wordWrap: break-word
      color: "#333333"
    blockInput:
      marginTop: "0.01"
      height: "0.0369"
      width: "0.92"
      boxSizing: border-box
      border:
        style: 3
      borderRadius: "3"
      borderWidth: "1.5"
      borderColor: "0xdedede"

      fontSize: .Nfont.h14
      color: "0x333333"
      textIndent: "12px"
    blockBox:
      marginTop: "0.01"
      height: "auto"
      width: "0.92"
    blockBoxLeft:
      display: "inline-block"
      width: "auto"
      height: "auto"
      color: "0x666666"
      fontSize: .Nfont.h12
      verticalAlign: middle
    blockBoxRight:
      marginLeft: "0.0373"
      display: "inline-block"
      width: "auto"
      height: "auto"
      color: "0x333333"
      fontSize: .Nfont.h14
      fontWeight: "600"
      verticalAlign: middle
    signTips:
      display: "inline-block"
      color: "#666666"
      fontSize: .Nfont.h12
      verticalAlign: middle
      width: "0.8266"
      height: "auto"
    signClear:
      display: "inline-block"
      fontSize: .Nfont.h14
      color: "#e24445"
      verticalAlign: middle
      width: "auto"
      height: "auto"
    canvasBox:
      marginTop: "0.01"
      height: "0.128"
      width: "0.9"
      border:
        style: "4"
        color: "0xa9a9a9"
      borderWidth: "2"
    btnBox:
      height: "0.0972"
      width: "1"
      backgroundColor: "0xffffff"
      boxSizing: border-box

      boxShadow: "1px 1px 4px 1px #dededf"
      overflow: hidden
      textAlign:
        x: center
    btn:
      marginTop: "0.0123"
      height: "0.0443"
      width: "0.84"
      border:
        style: 1
      borderRadius: "5"
      backgroundColor: "#2988e6"
      color: "#ffffff"
      fontSize: .Nfont.h14
      boxSizing: border-box
      fontWeight: "600"
      textAlign:
        x: center
