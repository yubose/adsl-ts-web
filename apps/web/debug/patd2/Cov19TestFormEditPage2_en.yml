Cov19TestFormEditPage2:
  title: "COVID-19 Testing Consent Form"
  init:
    - .SignInCheck
    # 获取facility name
    - .Global.formData.cov19TestForm.name.data.signatureCoronavirus.facilityName@: =.Global.currentFacility.name.data.basicInfo.medicalFacilityName
    # 判断是否签名
    - if:
        - =.Global.formData.cov19TestForm.name.data.signatureCoronavirus.whetherCoronavirusSignature
        - continue
        # 非空修改显示的标识,刷新签名区域
        - actionType: evalObject
          object:
            # 签名的时间
            - ..formData.signatureTime@: =.Global.formData.cov19TestForm.name.data.signatureCoronavirus.signatureTime
            # 签名的id
            - ..formData.temporarySignature@: =.Global.formData.cov19TestForm.name.data.signatureCoronavirus.id
            - ..formData.flag@: "block"
    # 判断是否Name of Recipient/Healthcare Proxy存在
    - actionType: evalObject
      object:
        - if:
            - =.Global.formData.cov19TestForm.name.data.signatureCoronavirus.recipientName
            - ..formData.recipientName@: =.Global.formData.cov19TestForm.name.data.signatureCoronavirus.recipientName
            - continue
  formData:
    recipientName: ""
    # 获取暂存的签名的id
    temporarySignature: ""
    # 签名的显示,默认为none
    flag: "none"
    # 是否签名 true 表示未签 false 表示已签
    whetherCoronavirusSignature: ""
    signatureTime: ""
  formDataTemp: #Input data temp here, datatemp should not mix with formData

  apiRequest:
    newSign:
      docRes: ""
      docReq: #DOC
        type: .DocType.Signature1
        eid: .Global.rootNotebookID
        reid: .Global.formData.cov19TestForm.id
        name:
          title: ""
          type: ..apiRequest.newSign.docReq.subtype.mediaType
          data: ""
        subtype:
          mediaType: ""
      docAPI: # DOCAPI
        store:
          api: cd
          dataIn: Cov19TestFormEditPage2.apiRequest.newSign.docReq
          dataOut: Cov19TestFormEditPage2.apiRequest.newSign.docRes

  components:
    - type: view
      style:
        ..style.formatting:
      children:
        - .BasePublicHeader:
          children:
            - type: view
              style:
                ..style.backLeft:
              children:
                - type: image
                  path: arrowLeftgrey.svg
                  style:
                    ..style.backLeftImg:
                  onClick:
                    - ..event.publicClick
                    - ..event.backClick
            - .BasePublicHeaderTitle:
              style:
                fontSize: .Nfont.h14
        - type: view
          style:
            ..style.bodyBox:
          children:
            - type: view
              style:
                ..style.viewBox:
              children:
                - type: view
                  style:
                    ..style.titleBox:
                  children:
                    - type: label
                      text: Informed Consent For Coronavirus (Covid-19) Testing
                      dataKey:
                      style:
                        ..style.titlelabel:
                    - type: label
                      text: "2&nbsp;/&nbsp;3"
                      dataKey:
                      style:
                        ..style.pageNum:
            - type: scrollView
              style:
                ..style.scrollBox:
              children:
                - type: label
                  text: "Please Carefully Read The Following Informed Consent:"
                  dataKey:
                  style:
                    ..style.secondLabel:
                - type: label
                  textBoard:
                    - text: "a. I authorize "
                    - text: "Medical Facility Name"

                      dataKey: Global.formData.cov19TestForm.name.data.signatureCoronavirus.facilityName
                    - text: " to conduct collection of blood specimen to be screened for antibodies for COVID-19. "
                    - br:
                    - br:
                    - text: "b. I authorize "
                    - text: "Medical Facility Name"

                      dataKey: Global.formData.cov19TestForm.name.data.signatureCoronavirus.facilityName
                    - text: " to utilizing a rapid test kit which is used for the qualitative detection of the nucleocapsid protein antigen from SARS-CoV-2 in nasopharyngeal swab specimens directly collected from individuals suspected of COVID-19 as ordered by an authorized medical provider or public health official."
                    - br:
                    - br:
                    - text: "c. I authorize "
                    - text: "Medical Facility Name"

                      dataKey: Global.formData.cov19TestForm.name.data.signatureCoronavirus.facilityName
                    - text: " to conduct collection through a nasopharyngeal swab, as ordered by an authorized medical provider or public health official."
                    - br:
                    - br:
                    - text: "d. I authorize my test results to be disclosed to the county, state, or to any other governmental entity as may be required by law."
                    - br:
                    - br:
                    - text: "e. I acknowledge that a positive test result is an indication that I must continue to self-isolate in an effort to avoid infecting others (for nasal tests only)."
                    - br:
                    - br:
                    - text: "f. I understand that I am not creating a patient relationship with "
                    - text: "Medical Facility Name"

                      dataKey: Global.formData.cov19TestForm.name.data.signatureCoronavirus.facilityName
                    - text: " by participating in testing/screening. "
                    - br:
                    - br:
                    - text: "g. I understand this testing facility is not acting as my medical provider and I assume complete and full responsibility to take appropriate action with regards to my test results"
                    - br:
                    - br:
                    - text: "h. I understand that, as with any medical test, there is the potential for false positive or false negative test results can occur. "
                    - text: "Medical Facility Name"

                      dataKey: Global.formData.cov19TestForm.name.data.signatureCoronavirus.facilityName
                    - text: " carries no responsibilities/liabilities for false test. "
                    - br:
                    - br:
                    - text: "i. I understand that if this screening test is at the request of my employer, they will receive the results."
                    - br:
                    - br:
                    - text: "I, the undersigned, have been informed about the test purpose, procedures, possible benefits and risks, and I have received a copy of this Informed consent. I have been given the opportunity to ask questions before I sign, and I have been told that I can ask other questions at any time. I voluntarily agree to antibody screening and/or testing for COVID-19."
                      color: "#666666"

                  style:
                    ..style.text:

                - type: label
                  text: "Name Of Recipient/Healthcare Proxy"
                  dataKey:
                  style:
                    ..style.secondLabel:
                    marginTop: "0.0197"
                - type: textField
                  placeholder: Enter here
                  dataKey: formData.recipientName
                  style:
                    ..style.blockInput:

                - type: label
                  text: "Signature"
                  dataKey:
                  style:
                    ..style.secondLabel:

                - type: view
                  style:
                    ..style.blockBox:
                  children:
                    - type: label
                      text: Click on the signature box below to finger sign
                      dataKey:
                      style:
                        ..style.signTips:
                    - type: label
                      text: Clear
                      dataKey:
                      style:
                        ..style.signClear:
                      onClick:
                        - ..event.signReset

                - type: view
                  style:
                    marginTop: "0.01"
                    height: "0.128"
                    width: "0.9"
                    border:
                      style: "4"
                      color: "0xa9a9a9"
                    borderWidth: "2"
                  children:
                    - type: label
                      text: X
                      style:
                        .SignLabelStyle:
                    - type: canvas
                      dataKey: Cov19TestFormEditPage2.apiRequest.newSign.docReq.name.data
                      viewTag: signatureTag
                      style:
                        left: "0"
                        width: "0.88"
                        height: "0.128"
                        overflow: scroll
                    - type: image
                      viewTag: signatureShowTag
                      path=func: .builtIn.utils.prepareDocToPath
                      dataKey: Cov19TestFormEditPage2.formData.temporarySignature
                      style:
                        display: ..formData.flag
                        left: "0"
                        width: "0.88"
                        top: "0"
                        height: "0.128"
                        overflow: scroll
                        zIndex: "1000"

                - type: view
                  style:
                    width: "0.92"
                    height: "auto"
                    overflow: hidden
                  children:
                    - type: view
                      style:
                        ..style.blockBox:
                        marginTop: "0.02216"
                      children:
                        - type: label
                          text: Patient Name
                          style:
                            ..style.blockBoxLeft:
                        - type: label
                          text:
                          dataKey: Global.formData.cov19TestForm.name.data.patientInfo.fullName
                          style:
                            ..style.blockBoxRight:
                    - type: view
                      style:
                        ..style.blockBox:
                      children:
                        - type: label
                          text: Date
                          style:
                            ..style.blockBoxLeft:
                        - type: label
                          text=func: .builtIn.string.formatUnixtimeL_en
                          dataKey: Global.formData.cov19TestForm.ctime
                          style:
                            ..style.blockBoxRight:
                - type: view
                  style:
                    marginTop: "0.03"

        - type: view
          style:
            ..style.btnBox:
          children:
            - type: button
              text: Next
              dataKey:
              style:
                ..style.btn:
              onClick:
                - ..event.publicClick
                - ..event.btnClick

    - .BaseWarningView:
      viewTag: BaseWarningView
      message: "You haven't signed the form"
  event:
    signReset:
      # 移除签名
      - actionType: removeSignature
        dataObject: BLOB
        dataKey: Cov19TestFormEditPage2.apiRequest.newSign.docReq.name.data
        viewTag: signatureTag
      # 重置临时签名
      - actionType: evalObject
        object:
          - ..formData.temporarySignature@: ""
          - ..formData.signatureTime@: ""
      # 显示签名区域隐藏
      - actionType: builtIn
        funcName: hide
        viewTag: signatureShowTag
      - actionType: builtIn
        funcName: show
        viewTag: signatureTag
    publicClick:
      # 签名处理
      - actionType: saveSignature
        dataObject: BLOB
        dataKey: Cov19TestFormEditPage2.apiRequest.newSign.docReq.name.data
        isEmpty: Cov19TestFormEditPage2.formData.whetherCoronavirusSignature
      - actionType: evalObject
        object:
          - if:
              - =..formData.whetherCoronavirusSignature
              - continue
              - =..apiRequest.newSign.docAPI.store: ""

      - actionType: evalObject
        object:
          - if:
              - =..formData.temporarySignature
              - actionType: evalObject
                object:
                  - .Global.formData.cov19TestForm.name.data.signatureCoronavirus.signatureTime@: =..formData.signatureTime
                  - .Global.formData.cov19TestForm.name.data.signatureCoronavirus.id@: =..formData.temporarySignature
                  - .Global.formData.cov19TestForm.name.data.signatureCoronavirus.whetherCoronavirusSignature@: false
                  - ..formData.whetherCoronavirusSignature@: false
              - actionType: evalObject
                object:
                  - .Global.formData.cov19TestForm.name.data.signatureCoronavirus.signatureTime@: =..apiRequest.newSign.docRes.doc.ctime
                  - .Global.formData.cov19TestForm.name.data.signatureCoronavirus.id@: =..apiRequest.newSign.docRes.doc.id
                  - .Global.formData.cov19TestForm.name.data.signatureCoronavirus.whetherCoronavirusSignature@: =..formData.whetherCoronavirusSignature

      - actionType: evalObject
        object:
          - .Global.formData.cov19TestForm.name.data.signatureCoronavirus.recipientName@: =..formData.recipientName

    btnClick:
      - actionType: evalObject
        object:
          - if:
              - =..formData.whetherCoronavirusSignature
              - actionType: popUp
                popUpView: BaseWarningView
                wait: true
                popUpDismiss: 2000
              - continue

      - goto: Cov19TestFormEditPage3
    backClick:
      - actionType: builtIn
        funcName: goBack
        reload: true

  style: #Input style fragment here
    formatting:
      margin: "0"
      padding: "0"
      height: "1"
      width: "1"
      overflow: hidden
      boxSizing: border-box

      color: "0x333333"
      fontSize: .Nfont.h16
    bodyBox:
      width: "auto"
      height: "0.84852"
    backLeft:
      marginLeft: "0.04"
      display: "inline-block"
      verticalAlign: middle
      height: "0.055"
      boxSizing: border-box
    backLeftImg:
      marginTop: "0.012"
      height: "0.0295"
    viewBox:
      marginLeft: "0.04"
      height: "auto"
      width: "0.92"
      overflow: hidden

    titleBox:
      marginTop: "0.0270"
      paddingBottom: "1.23vh"
      width: "0.92"
      height: "auto"
      border:
        style: 2
      borderWidth: "1"
      borderColor: "#dedede"
    titlelabel:
      display: "inline-block"
      fontSize: .Nfont.h16
      color: "0x333333"
      width: "0.753125"
      height: "auto"
      fontWeight: "700"
      verticalAlign: top
      lineHeight: "2.95vh"
    pageNum:
      marginLeft: "0.064"
      display: "inline-block"
      height: "0.0221"
      width: "0.1013"
      backgroundColor: "0x2988e6"
      color: "0xffffff"
      fontSize: .Nfont.h14
      fontWeight: "700"
      borderRadius: "3"
      verticalAlign: top
      textAlign:
        x: center
    scrollBox:
      marginLeft: "0.04"
      width: "0.92"
      height: "0.76108"
      boxSizing: border-box
      overflow: scroll
    secondLabel:
      width: "0.92"
      fontSize: .Nfont.h14
      fontWeight: "700"
      color: "0x333333"
      marginTop: "0.0246"
      lineHeight: "2.58vh"
    text:
      marginTop: "0.0172"
      height: "auto"
      width: "0.92"
      fontSize: .Nfont.h14
      lineHeight: "2.58vh"
      wordWrap: break-word
      color: "#333333"
    blockInput:
      marginTop: "0.01"
      height: "0.0369"
      width: "0.92"
      boxSizing: border-box
      border:
        style: 3
      borderRadius: "3"
      borderWidth: "1.5"
      borderColor: "0xdedede"

      fontSize: .Nfont.h14
      color: "0x333333"
      textIndent: "12px"
    blockBox:
      marginTop: "0.01"
      height: "auto"
      width: "0.92"
    blockBoxLeft:
      display: "inline-block"
      width: "auto"
      height: "auto"
      color: "0x666666"
      fontSize: .Nfont.h12
      verticalAlign: middle
    blockBoxRight:
      marginLeft: "0.0373"
      display: "inline-block"
      width: "auto"
      height: "auto"
      color: "0x333333"
      fontSize: .Nfont.h14
      fontWeight: "600"
      verticalAlign: middle
    signTips:
      display: "inline-block"
      color: "#666666"
      fontSize: .Nfont.h12
      verticalAlign: middle
      width: "0.8266"
      height: "auto"
    signClear:
      display: "inline-block"
      fontSize: .Nfont.h14
      color: "#e24445"
      verticalAlign: middle
      width: "auto"
      height: "auto"
    canvasBox:
      marginTop: "0.01"
      height: "0.128"
      width: "0.9"
      border:
        style: "4"
        color: "0xa9a9a9"
      borderWidth: "2"
    btnBox:
      height: "0.0972"
      width: "1"
      backgroundColor: "0xffffff"
      boxSizing: border-box

      boxShadow: "1px 1px 4px 1px #dededf"
      overflow: hidden
      textAlign:
        x: center
    btn:
      marginTop: "0.0123"
      height: "0.0443"
      width: "0.84"
      border:
        style: 1
      borderRadius: "5"
      backgroundColor: "#2988e6"
      color: "#ffffff"
      fontSize: .Nfont.h14
      boxSizing: border-box
      fontWeight: "600"
      textAlign:
        x: center
