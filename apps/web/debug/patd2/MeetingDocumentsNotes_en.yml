MeetingDocumentsNotes:
  pageNumber: "180" # xd page 13
  title: "My Meeting Notes"
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
  save:
    - =.MeetingDocumentsNotes.newNote.docAPI.store: ""
  newNote:
    document:
      .Document: ""
      eid: .Global.roomInfo.edge.id
      type: .DocType.PatientMeetingNote # "6" # meeting notes for all participants
      name:
        # 签名id
        signatureId: ""
        title: ""
        type: ..newNote.docAPI.store.subtype.mediaType
        data:
          note: ""
          uploadUserName: .Global.currentUser.vertex.name.userName
    docAPI:
      .DocAPI: ""
      store:
        api: cd
        dataKey: newNote.document
        subtype:
          mediaType: "text/plain" # mediaType : "image/jpeg"
      get:
        .DocAPI.get: ""
        api: rd
        ids:
          - .Global.roomInfo.edge.id
        xfname: eid
        type: .DocType.PatientMeetingNote # "6"
        maxcount: "1"
        obfname: "mtime"
        dataKey: docResponse
  docResponse:
    doc:
      - type: .DocType.PatientMeetingNote # "6" # private profile
        eid: .Global.roomInfo.edge.id
        name: ""
    error: ""
    jwt: ""
  # 签名文档
  newSign:
    docRes: ""
    document: #DOC
      .Document: ""
      type: .DocType.DocumentSignature
      name:
        title: ""
        type: ..newSign.document.subtype.mediaType
        data: ""
      eid: .Global.rootNotebookID
      fid: ""
      subtype:
        mediaType: "" # mediaType : "image/jpeg"
    docAPI: # DOCAPI
      .DocAPI: ""
      store:
        api: cd
        dataIn: newSign.document
        dataOut: MeetingDocumentsNotes.newSign.docRes

  formData:
    whetherSign: ""
  components:
    - .BaseHeader:
    - .HeaderLeftButton:
    - type: scrollView
      style:
        top: "0.1"
        left: "0.1"
        width: "0.9"
        height: "0.83"
      children:
        - type: view
          style:
            top: "0"
            left: "0"
            height: "0.05"
            width: "0.8"
            # backgroundColor: "0xcdcdcd"
          children:
            - type: label
              text: Name your notes
              style:
                top: "0.01"
                left: "0.05"
                height: "0.04"
                width: "0.7"
                color: "0x000000ff"
                fontWeight: "400"
                fontSize: 17
                textAlign:
                  x: center
            - type: image
              path: tab.png
              style:
                top: "0"
                left: "0.58"
                height: "0.04"
        - type: textField
          placeholder: Weekly Meeting Minutes
          dataKey: newNote.document.name.title
          style:
            top: "0.05"
            left: "0"
            height: "0.04"
            width: "0.8"
            color: "0x000000ff"
            fontWeight: "300"
            fontSize: 20
            borderWidth: "1"
            border:
              style: "2"
        - type: textView
          # isEditable: false
          placeholder: Hello this meeting
          dataKey: newNote.document.name.data.note # users' input will be saved to this key
          style:
            textAlign:
              y: top
            fontSize: "16"
            left: "0"
            top: "0.11"
            width: "0.8"
            height: "0.6"
            required: "true"
            color: "0x000000ff"

            borderWidth: "1"
            border:
              style: "3"
            # 签名区域
        - type: view
          style:
            top: "0.75"
            left: "0"
            width: "0.85"
            height: "0.2"
          children:
            - type: label
              text: "Signature:"
              style:
                width: "0.43"
                fontSize: "14"
                height: "0.03"
                color: "0x000000"
                textAlign:
                  y: center
            - type: label
              text: "clear"
              onClick:
                - actionType: removeSignature
                  dataObject: BLOB
                  dataKey: MeetingDocumentsNotes.newSign.document.name.data
                  viewTag: signatureTag
              style:
                zIndex: "100"
                left: "0.7"
                top: "0"
                width: "0.12"
                fontSize: "14"
                height: "0.03"
                borderRadius: "4"
                backgroundColor: "0xD53C42"
                color: "0xffffff"
                textAlign:
                  y: center
                  x: center
            - type: view
              style:
                width: "0.8"
                height: "0.12"
                border:
                  style: "4"
                  width: "0.8"
                  color: "0xacacac"
                left: "0"
                top: "0.05"
              children:
                # 签名区域
                - type: canvas
                  dataKey: MeetingDocumentsNotes.newSign.document.name.data
                  viewTag: signatureTag
                  style:
                    left: "0"
                    width: "0.8"
                    top: "0"
                    height: "0.11"
                    overflow: scroll
                # # 签名复显
                # - type: image
                #   viewTag: signatureShowTag
                #   path=func: =.builtIn.utils.prepareDocToPath
                #   # 传入签名文档的id
                #   dataKey: newNote.document.name.data.signatureId
                #   style:
                #     # 控制显示
                #     display: "block"
                #     left: "0"
                #     width: "0.8"
                #     top: "0"
                #     height: "0.11"
                #     overflow: scroll

    - type: button
      text: Save note
      style:
        left: "0.1"
        height: "0.05"
        top: "0.945"
        width: "0.8"
        backgroundColor: "0x2988e6"
        color: "0xffffff"
        borderRadius: "5"
        textAlign:
          x: center
        fontSize: "16"
      onClick:
        # 签名处理
        - actionType: saveSignature
          dataObject: BLOB
          dataKey: MeetingDocumentsNotes.newSign.document.name.data
          isEmpty: MeetingDocumentsNotes.formData.whetherSign
        # 保存签名文档
        - actionType: evalObject
          object:
            - =..newSign.docAPI.store: ""
        - actionType: evalObject
          object:
            # 存放签名的id到newNote
            - ..newNote.document.name.data.signatureId@: =..newSign.docRes.doc.id
        # 保存文档
        - actionType: evalObject
          object:
            - =.MeetingDocumentsNotes.newNote.docAPI.store: ""
        - actionType: evalObject
          object:
            - if:
                - =.MeetingDocumentsNotes.formData.whetherSign
                - actionType: popUp
                  popUpView: warningView
                  wait: true
                - continue

        - actionType: evalObject
          object:
            .Global._nonce@:
              =.builtIn.math.random: ""
        - actionType: builtIn
          funcName: goBack
          reload: true

    - .BaseWarningView:
