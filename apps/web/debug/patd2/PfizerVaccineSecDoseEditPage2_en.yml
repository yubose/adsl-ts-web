PfizerVaccineSecDoseEditPage2:
  title: "Pfizer-BioNTech Vaccine - Second Dose"

  pageNumber:

  init:
    - .SignInCheck
    # 获取facility name
    - .Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.facilityName@: =.Global.currentFacility.name.data.basicInfo.medicalFacilityName

    # 判断是否签名
    - if:
        - =.Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.whetherSignature
        - continue
        # 非空修改显示的标识,刷新签名区域
        - actionType: evalObject
          object:
            # 签名的时间
            - ..formData.signatureTime@: =.Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.signatureTime
            # 签名的id
            - ..formData.temporarySignature@: =.Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.signaturePfizerVaccine
            - ..formData.flag@: "block"
    # 判断是否Name of Recipient/Healthcare Proxy存在
    - actionType: evalObject
      object:
        - if:
            - =.Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.recipientName
            - ..formData.recipientName@: =.Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.recipientName
            - continue
    # 判断是否同意
    - actionType: evalObject
      object:
        - if:
            - =.builtIn.string.equal:
                dataIn:
                  string1: =.Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.isAgree
                  string2: ""
            - continue
            - ..formData.consent@: =.Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.isAgree
  formData:
    consent: ""
    doc: []
    recipientName: ""
    # 获取暂存的签名的id
    temporarySignature: ""
    # 签名的显示,默认为none
    flag: "none"
    # 是否签名 true 表示未签 false 表示已签
    whetherSignature: ""
    signatureTime: ""
  formDataTemp:
    checkBoxTemp:
      - key: consent
        value: "1"
        text1: "I GIVE CONSENT to&nbsp;"
        text2: "&nbsp;to vaccinate me with the COVID-19. You must electronically sign this consent to receive the COVID-19 Vaccine."
      - key: consent
        value: "0"
        text1: "I DO NOT GIVE CONSENT to&nbsp;"
        text2: "&nbsp;to be vaccinated."
  apiRequest:
    newSign:
      docRes: ""
      docReq: #DOC
        type: .DocType.Signature1
        eid: .Global.rootNotebookID
        reid: .Global.formData.pifzerVaccineSecDoseForm.id
        name:
          title: ""
          type: ..apiRequest.newSign.docReq.subtype.mediaType
          data: ""
        subtype:
          mediaType: ""
      docAPI: # DOCAPI
        store:
          api: cd
          dataIn: PfizerVaccineSecDoseEditPage2.apiRequest.newSign.docReq
          dataOut: PfizerVaccineSecDoseEditPage2.apiRequest.newSign.docRes
    pifzerVaccineSecDoseForm:
      docRes: ""
      docReq:
        id: ""
        eid: .Global.rootNotebookID
        type: .DocType.PfizerVaccineSecDoseForm
        name:
          data: ""
          title: "Pfizer-BioNTech Vaccine - Second Dose"
          user: .Global.Profile.name.data.basicInfo.fullName
      docAPI:
        store:
          api: cd
          dataIn: PfizerVaccineSecDoseEditPage2.apiRequest.pifzerVaccineSecDoseForm.docReq
          dataOut: PfizerVaccineSecDoseEditPage2.apiRequest.pifzerVaccineSecDoseForm.docRes
  components:
    - type: view
      style:
        ..style.formatting:
      children:
        - .BasePublicHeader:
          children:
            - type: view
              style:
                ..style.backLeft:
              children:
                - type: image
                  path: arrowLeftgrey.svg
                  style:
                    ..style.backLeftImg:
                  onClick:
                    - ..event.publicClick
                    - ..event.backClick
            - .BasePublicHeaderTitle:
              style:
                fontSize: .Nfont.h14
        - type: view
          style:
            ..style.bodyBox:
          children:
            - type: view
              style:
                ..style.viewBox:
              children:
                - type: view
                  style:
                    ..style.titleBox:
                  children:
                    - type: label
                      text: Pfizer-BioNTech COVID-19 Vaccine Consent Form
                      dataKey:
                      style:
                        ..style.titlelabel:
                    - type: label
                      text: "2&nbsp;/&nbsp;2"
                      dataKey:
                      style:
                        ..style.pageNum:
            - type: scrollView
              style:
                ..style.scrollBox:
              children:
                - type: label
                  text: "2. Consent For Vaccination"
                  dataKey:
                  style:
                    ..style.secondLabel:
                - type: label
                  text: "Please Carefully Read The Following Informed Consent:"
                  dataKey:
                  style:
                    ..style.secondLabel:
                - type: label
                  textBoard:
                    - text: a. The Fact Sheet for Patients and Parents/Caregivers for the Pfizer-BioNTech COVID-19 Vaccine I am receiving (sometimes hereafter, the COVID-19 Vaccine) has been offered to me.
                    - br:
                    - br:
                    - text: b. I have read or had explained to me the Pfizer-BioNTech Fact Sheet for Patients and Parents/Caregivers for the COVID-19 Vaccine and I understand the risks and benefits.
                    - br:
                    - br:
                    - text: c. I understand the COVID-19 Vaccine has been approved by an emergency use authorization (EUA) process and has not fully been FDA reviewed or approved.
                    - br:
                    - br:
                    - text: d. I understand the potential risks from the therapy including serious allergic reactions (anaphylaxis). Other adverse reactions that have been reported include injection site pain, fatigue, headache, muscle pain, chills, joint pain, fever, injection site swelling, injection site redness, nausea, malaise, and lymphadenopathy.
                    - br:
                    - br:
                    - text: e. I understand that there may be other potential options to prevent COVID-19.
                    - br:
                    - br:
                    - text: f. I was offered the opportunity to ask questions and all questions were answered.
                    - br:
                    - br:
                    - text: g. I agree to proceed with receiving the Pfizer-BioNTech COVID-19 Vaccine.
                    - br:
                  style:
                    ..style.text:

                - type: list
                  viewTag: checkedView
                  # androidGrid: true
                  contentType: listObject
                  listObject: ..formDataTemp.checkBoxTemp
                  iteratorVar: itemObject
                  style:
                    ..style.list:
                  children:
                    - type: listItem
                      itemObject:
                      style:
                        ..style.checkItem:
                      children:
                        - type: image
                          style:
                            ..style.itemImg:
                          path:
                            ..event.checkBox:
                          onClick:
                            - ..event.checkBoxClick
                        - type: label
                          textBoard:
                            - text:
                              dataKey: itemObject.text1
                            - text: ""
                              dataKey: Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.facilityName

                            - text: ""
                              dataKey: itemObject.text2
                          style:
                            ..style.itemValue:
                - type: label
                  text: "Name Of Recipient/Healthcare Proxy"
                  dataKey:
                  style:
                    ..style.secondLabel:
                    marginTop: "0.0197"
                - type: textField
                  placeholder: Enter here
                  dataKey: formData.recipientName
                  style:
                    ..style.blockInput:
                - type: label
                  text: "Signature"
                  dataKey:
                  style:
                    ..style.secondLabel:

                - type: view
                  style:
                    ..style.blockBox:
                  children:
                    - type: label
                      text: Click on the signature box below to finger sign
                      dataKey:
                      style:
                        ..style.signTips:
                    - type: label
                      text: Clear
                      dataKey:
                      style:
                        ..style.signClear:
                      onClick:
                        - ..event.signReset

                - type: view
                  style:
                    marginTop: "0.01"
                    height: "0.128"
                    width: "0.9"
                    border:
                      style: "4"
                      color: "0xa9a9a9"
                    borderWidth: "2"
                  children:
                    - type: label
                      text: X
                      style:
                        .SignLabelStyle:
                    - type: canvas
                      dataKey: PfizerVaccineSecDoseEditPage2.apiRequest.newSign.docReq.name.data
                      viewTag: signatureTag
                      style:
                        left: "0"
                        width: "0.88"
                        height: "0.128"
                        overflow: scroll
                    - type: image
                      viewTag: signatureShowTag
                      path=func: .builtIn.utils.prepareDocToPath
                      dataKey: PfizerVaccineSecDoseEditPage2.formData.temporarySignature
                      style:
                        display: ..formData.flag
                        left: "0"
                        width: "0.88"
                        top: "0"
                        height: "0.128"
                        overflow: scroll
                        zIndex: "1000"

                - type: view
                  style:
                    width: "0.92"
                    height: "auto"
                    overflow: hidden
                  children:
                    - type: view
                      style:
                        ..style.blockBox:
                        marginTop: "0.02216"
                      children:
                        - type: label
                          text: Patient Name
                          style:
                            ..style.blockBoxLeft:
                        - type: label
                          text:
                          dataKey: Global.formData.pifzerVaccineSecDoseForm.name.data.patientInfo.fullName
                          style:
                            ..style.blockBoxRight:
                    - type: view
                      style:
                        ..style.blockBox:
                      children:
                        - type: label
                          text: Date
                          style:
                            ..style.blockBoxLeft:
                        - type: label
                          text=func: .builtIn.string.formatUnixtimeL_en
                          dataKey: Global.formData.pifzerVaccineSecDoseForm.ctime
                          style:
                            ..style.blockBoxRight:
                - type: view
                  style:
                    marginTop: "0.03"

        - type: view
          style:
            ..style.btnBox:
          children:
            - type: button
              text: Done
              dataKey:
              style:
                ..style.btn:
              onClick:
                - ..event.publicClick
                - ..event.btnClick
    - .BaseWarningView:
      viewTag: agreeView
      message: "Please give the consent first"
    - .BaseWarningView:
      viewTag: BaseWarningView
      message: "You haven't signed the form"
  event:
    checkBox:
      emit:
        dataKey:
          var: itemObject
        actions:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..formData.consent
                    string2: $var.value
              - selectOnBlue.svg
              - selectOffBlue.svg
    checkBoxClick:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =..formData.consent
                      string2: $var.value
                - continue
                - =.builtIn.object.set:
                    dataIn:
                      object: =.PfizerVaccineSecDoseEditPage2.formData
                      key: $var.key
                      value: $var.value
      - actionType: builtIn
        funcName: redraw
        viewTag: checkedView
    signReset:
      # 移除签名
      - actionType: removeSignature
        dataObject: BLOB
        dataKey: PfizerVaccineSecDoseEditPage2.apiRequest.newSign.docReq.name.data
        viewTag: signatureTag
      # 重置临时签名
      - actionType: evalObject
        object:
          - ..formData.temporarySignature@: ""
          - ..formData.signatureTime@: ""
      # 显示签名区域隐藏
      - actionType: builtIn
        funcName: hide
        viewTag: signatureShowTag
      - actionType: builtIn
        funcName: show
        viewTag: signatureTag
    publicClick:
      # 签名处理
      - actionType: saveSignature
        dataObject: BLOB
        dataKey: PfizerVaccineSecDoseEditPage2.apiRequest.newSign.docReq.name.data
        isEmpty: PfizerVaccineSecDoseEditPage2.formData.whetherSignature
      - actionType: evalObject
        object:
          - if:
              - =..formData.whetherSignature
              - continue
              - =..apiRequest.newSign.docAPI.store: ""

      - actionType: evalObject
        object:
          - if:
              - =..formData.temporarySignature
              - actionType: evalObject
                object:
                  - .Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.signatureTime@: =..formData.signatureTime
                  - .Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.signaturePfizerVaccine@: =..formData.temporarySignature
                  - .Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.whetherSignature@: false
                  - ..formData.whetherSignature@: false
              - actionType: evalObject
                object:
                  - .Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.signatureTime@: =..apiRequest.newSign.docRes.doc.ctime
                  - .Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.signaturePfizerVaccine@: =..apiRequest.newSign.docRes.doc.id
                  - .Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.whetherSignature@: =..formData.whetherSignature

      - actionType: evalObject
        object:
          - .Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.isAgree@: =..formData.consent
          - .Global.formData.pifzerVaccineSecDoseForm.name.data.signatureConsent.recipientName@: =..formData.recipientName

    btnClick:
      - actionType: evalObject
        object:
          - if:
              - =..formData.whetherSignature
              - actionType: popUp
                popUpView: BaseWarningView
                wait: true
                popUpDismiss: 2000
              - continue
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..formData.consent
                    string2: "1"
              - continue
              - actionType: popUp
                popUpView: agreeView
                wait: true
                popUpDismiss: 2000
      - actionType: evalObject
        object:
          - ..apiRequest.pifzerVaccineSecDoseForm.docReq.name.data@: =.Global.formData.pifzerVaccineSecDoseForm.name.data

          # 处理reason下Pifzer-BioNTech兼容问题
          - if:
              - =.builtIn.array.has:
                  dataIn:
                    object: =.Global.formData.appointment.docu
                    value: "Pifzer-BioNTech Vaccine - Second Dose"
              - =.builtIn.array.add:
                  dataIn:
                    object: =.Global.vaccine
                    value: "Pifzer-BioNTech Vaccine - Second Dose"
              - =.builtIn.array.add:
                  dataIn:
                    object: =.Global.vaccine
                    value: "Pfizer-BioNTech Vaccine - Second Dose"

          - =.builtIn.array.elementUnique:
              dataIn:
                arr: =.Global.vaccine
              dataOut: PfizerVaccineSecDoseEditPage2.formData.doc

      - actionType: evalObject
        object:
          - .Global.vaccine@: ""

      - actionType: evalObject
        object:
          - .Global.vaccine@: =..formData.doc
          - =..apiRequest.pifzerVaccineSecDoseForm.docAPI.store: ""
          - .Global.formData.pifzerVaccineSecDoseForm@: =..apiRequest.pifzerVaccineSecDoseForm.docRes.doc

      - actionType: evalObject
        object:
          .Global._nonce@:
            =.builtIn.math.random: ""
      - actionType: evalObject
        object:
          # 处理reason下Pifzer-BioNTech兼容问题
          - if:
              - =.builtIn.array.has:
                  dataIn:
                    object: =.Global.formData.appointment.docu
                    value: "Pifzer-BioNTech Vaccine - Second Dose"
              - =.builtIn.array.add:
                  dataIn:
                    object: =.Global.roomInfo.edge.name.finishDoc
                    value: "Pifzer-BioNTech Vaccine - First Dose"
              - =.builtIn.array.add:
                  dataIn:
                    object: =.Global.roomInfo.edge.name.finishDoc
                    value: "Pfizer-BioNTech Vaccine - Second Dose"

          # - =.builtIn.array.add:
          #     dataIn:
          #       object: =.Global.roomInfo.edge.name.finishDoc
          #       value: "Pfizer-BioNTech Vaccine - Second Dose"
          - goto: =.Global.formData.selectCategory
    backClick:
      - actionType: builtIn
        funcName: goBack
        reload: true
  style:
    formatting:
      margin: "0"
      padding: "0"
      height: "1"
      width: "1"
      overflow: hidden
      boxSizing: border-box

      color: "#333333"
      fontSize: .Nfont.h16
    backLeft:
      marginLeft: "0.04"
      display: "inline-block"
      verticalAlign: middle
      height: "0.055"
      boxSizing: border-box
    backLeftImg:
      marginTop: "0.012"
      height: "0.0295"
    viewBox:
      marginLeft: "0.04"
      height: "auto"
      width: "0.92"
      overflow: hidden

    titleBox:
      marginTop: "0.0270"
      paddingBottom: "1.23vh"
      width: "0.92"
      height: "auto"
      border:
        style: 2
      borderWidth: "1"
      borderColor: "#dedede"
    titlelabel:
      display: "inline-block"
      fontSize: .Nfont.h16
      color: "0x333333"
      width: "0.753125"
      height: "auto"
      fontWeight: "700"
      verticalAlign: top
      lineHeight: "2.95vh"
    pageNum:
      marginLeft: "0.064"
      display: "inline-block"
      height: "0.0221"
      width: "0.1013"
      backgroundColor: "0x2988e6"
      color: "0xffffff"
      fontSize: .Nfont.h14
      fontWeight: "700"
      borderRadius: "3"
      verticalAlign: top
      textAlign:
        x: center
    scrollBox:
      marginLeft: "0.04"
      width: "0.92"
      height: "0.7487"
      boxSizing: border-box
      overflow: scroll
    secondLabel:
      width: "0.92"
      fontSize: .Nfont.h14
      fontWeight: "700"
      color: "0x333333"
      marginTop: "0.0197"
      lineHeight: "2.58vh"
    text:
      marginTop: "0.0197"
      height: "auto"
      width: "0.92"
      fontSize: .Nfont.h14
      lineHeight: "2.58vh"
      wordWrap: break-word
      color: "#333333"
    list:
      width: "0.92"
      height: auto
      margin: "0"
      marginTop: "0.02955"
      boxSizing: border-box
      overflow: hidden
    itemImg:
      display: "inline-block"
      height: "0.0221"
    checkItem:
      display: "inline-block"
      margin: "0"
      marginTop: "0.01724"
      width: "0.92"
      height: "auto"
      boxSizing: border-box
    itemValue:
      marginLeft: "0.0213"
      display: "inline-block"
      fontSize: .Nfont.h14
      color: "#333333"
      width: "0.848"
      height: "auto"
      lineHeight: "2.58vh"
    blockInput:
      marginTop: "0.01"
      height: "0.0369"
      width: "0.92"
      boxSizing: border-box
      border:
        style: 3
      borderRadius: "3"
      borderWidth: "1.5"
      borderColor: "0xdedede"

      fontSize: .Nfont.h14
      color: "0x333333"
      textIndent: "12px"
    blockBox:
      marginTop: "0.01"
      height: "auto"
      width: "0.92"
    blockBoxLeft:
      display: "inline-block"
      width: "auto"
      height: "auto"
      color: "0x666666"
      fontSize: .Nfont.h12
      verticalAlign: middle

    blockBoxRight:
      marginLeft: "0.0373"
      display: "inline-block"
      width: "auto"
      height: "auto"
      color: "0x333333"
      fontSize: .Nfont.h14
      fontWeight: "600"
      verticalAlign: middle

    signTips:
      display: "inline-block"
      color: "#666666"
      fontSize: .Nfont.h12
      verticalAlign: middle
      width: "0.8266"
      height: "auto"
    signClear:
      display: "inline-block"
      fontSize: .Nfont.h14
      color: "#e24445"
      verticalAlign: middle
      width: "auto"
      height: "auto"
    canvasBox:
      marginTop: "0.01"
      height: "0.128"
      width: "0.9"
      border:
        style: "4"
        color: "0xa9a9a9"
      borderWidth: "2"

    btnBox:
      height: "0.0972"
      width: "1"
      backgroundColor: "0xffffff"
      boxSizing: border-box

      boxShadow: "1px 1px 4px 1px #dededf"
      overflow: hidden
      textAlign:
        x: center
    btn:
      marginTop: "0.0123"
      height: "0.0443"
      width: "0.84"
      border:
        style: 1
      borderRadius: "5"
      backgroundColor: "#2988e6"
      color: "#ffffff"
      fontSize: .Nfont.h14
      boxSizing: border-box
      fontWeight: "600"
      textAlign:
        x: center
