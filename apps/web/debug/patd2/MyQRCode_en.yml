MyQRCode:
  title: "My QR Code"
  init:
    - .SignInCheck
    # - ..profile.docAPI.get
    # - ..Avatar.docAPI.get
    # - actionType: evalObject
    #   object:
    #     - ..Avatar.showdocument@: =..Avatar.docResponse.doc.0
    # - actionType: evalObject
    #   object:
    #     - =.builtIn.utils.prepareDoc:
    #         dataIn:
    #           doc: =..Avatar.showdocument
    #         dataOut: MyQRCode.Avatar.showdocument
    - actionType: evalObject
      object:
        =.builtIn.string.concat:
          dataIn:
            # - "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data="
            - '{"userName": "'
            - =.Global.currentUser.vertex.name.fullName
            - '","id":"'
            - =.Global.currentUser.vertex.id
            #注释号码,避免暴露
            # - '","uid": "'
            # - =.Global.currentUser.vertex.uid
            - '","userId": "'
            - patient
            - '"}'
          dataOut: MyQRCode.imagepath

    # - actionType: evalObject
    #   object:
    #     - ..Avatar.url@: =..Avatar.showdocument.name.data
    #     - .Global.avatarUrl@: =..Avatar.showdocument.name.data

    - actionType: evalObject
      object:
        - if:
            - =.MyQRCode.profile.docResponse.doc.0.name.data.address
            - .MyQRCode.address@: =.MyQRCode.profile.docResponse.doc.0.name.data.address
            - continue
  address: " "
  imagepath: ""
  Avatar:
    url: ava.png
    showdocument:
      .Document: ""
      subtype:
        isEncrypted: "1"
        isOnServer: "0"
      type: .DocType.UserAvatar
      name:
        title: ""
        type: ..Avatar.docAPI.store.subtype.mediaType
        data: binFile
      deat:
        sig: ""
        url: ""
      eid: .Global.rootNotebookID
    document:
      .Document: ""
      subtype:
        isEncrypted: "1"
        isOnServer: "0"
      type: .DocType.UserAvatar
      name:
        title: ""
        type: ..Avatar.docAPI.store.subtype.mediaType
        data: binFile
      deat:
        sig: ""
        url: ""
      eid: .Global.rootNotebookID
    docResponse:
      doc:
        - type: .DocType.UserAvatar
          eid: .Global.rootNotebookID
          name: ""
      error: ""
      jwt: ""
    docAPI:
      get:
        .DocAPI.get: ""
        api: rd
        id: .Global.rootNotebookID
        xfname: eid
        type: .DocType.UserAvatar
        dataKey: MyQRCode.Avatar.docResponse
        _nonce: .Global._nonce
        maxcount: "1"
        obfname: "mtime"
  profile:
    docResponse: ""
    docAPI:
      get:
        api: rd
        id: .Global.rootNotebookID
        xfname: eid
        type: .DocType.PatientProfile #  type: "257"
        obfname: "mtime"
        maxcount: "1"
        dataKey: profile.docResponse
  components:
    - .BaseHeader:
    - .HeaderLeftButton:
      onClick:
        - goto: MenuBars
      children:
        - type: image
          path: backWhiteArrow.svg
          style:
            left: "0.02"
            # top: "0.04"
            height: "0.02"
            zIndex: 100
    - .HeaderRightButton:
      onClick:
        - actionType: evalObject
          object:
            - =.builtIn.downloadQRCode:
                dataIn:
                  content: =..imagepath
                  scale: 12
      children:
        - type: image
          path: download.svg
          style:
            left: "0.08"
            top: "0.04"
            height: "0.023"
            zIndex: 100
    - type: scrollView
      style:
        top: "0.15"
        width: "1"
        height: "0.85"
      children:
        - type: view
          style:
            marginTop: "0.01"
            width: "0.9"
            left: "0.05"
            height: "0.65"
            backgroundColor: "0xF0F0F0"
            borderRadius: "5"
          children:
            - type: view
              style:
                marginTop: "0.01"
                top: "0"
                left: "0.05"
                height: "0.1"
                width: "0.22"
              children:
                - type: image
                  path: patientImage.svg
                  path=func: =.builtIn.utils.prepareDocToPath
                  dataKey: Global.Profile.name.data.avatar
                  style:
                    height: "0.1"
                    width: "0.22"
            - type: label
              dataKey: Global.currentUser.vertex.name.fullName
              style:
                left: "0.28"
                marginTop: "0.02"
                fontWeight: "650"
                height: "0.08"
                top: "0"

                fontSize: "16"
                textAlign:
                  y: center
            # - type: label
            #   # text: "California"
            #   dataKey: MyQRCode.address
            #   style:
            #     left: "0.25"
            #     marginTop: "0.05"
            #     color: "0x4B4B4B"
            #     top: "0"
            #     fontWeight: "400"
            #
            #     fontSize: "14"
            - type: image
              contentType: QRCode
              dataKey: MyQRCode.imagepath
              style:
                top: "0.14"
                width: "0.8"
                height: "0.4"
                box-sizing: "border-box"

                left: "0.05"
                # border:
                #   style: 3
                # borderColor: "#ffffff"
                # borderWidth: "20"
            - type: label
              text: "Scan the QR code to add me on AiTmed"
              style:
                top: "0.56"
                width: "0.9"
                height: "0.08"
                fontSize: "14"
                left: "0"
                textAlign:
                  x: center
    - type: popUp
      viewTag: SendLinkTag
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
      children:
        - type: view
          style:
            top: "0.73"
            width: "0.9"
            left: "0.05"
            height: "0.14"
            borderRadius: "10"
            backgroundColor: "0xe9e9e9"
          children:
            - type: button
              text: Send Invite Link
              contentType: file
              style:
                top: "0.01"
                width: "0.9"
                # left: "0.05"
                height: "0.06"
                fontSize: "18"
                color: "0x1d88fc"
                backgroundColor: "0xe9e9e9"
                textAlign:
                  x: center
                # borderRadius: "5"
                border:
                  style: "2"
                  width: "0.0001"
                borderColor: "0x00000066"
            - type: button
              text: Save Image
              style:
                # left: "0.05"
                top: "0.07"
                width: "0.9"
                height: "0.06"
                fontSize: "18"
                color: "0x1d88fc"
                # borderRadius: "5"
                backgroundColor: "0xe9e9e9"
                textAlign:
                  x: center
                border:
                  style: 1
        - type: button
          text: Cancel
          style:
            top: "0.9"
            left: "0.05"
            width: "0.9"
            height: "0.06"
            fontSize: "18"
            color: "0x1d88fc"
            backgroundColor: "0xffffff"
            textAlign:
              x: center
            borderRadius: "10"
            border:
              style: 1
          onClick:
            - actionType: popUpDismiss
              popUpView: SendLinkTag
