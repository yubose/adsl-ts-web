CreateAppointment:
  pageNumber: "410" # xd page 48
  init:
    - .SignInCheck

    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - ..GetE3request.get
    - =.builtIn.date.getMonth:
        dataIn:
        dataOut: CreateAppointment.calendarDate.month
    # get Year for calendar
    - =.builtIn.date.getYear:
        dataIn:
        dataOut: CreateAppointment.calendarDate.year
    - =.builtIn.date.getDate:
        dataIn:
        dataOut: CreateAppointment.calendarDate.day
    # # generate calendar according month and year
    - actionType: evalObject
      object:
        - =.builtIn.date.calendarArray:
            dataIn:
              year: =..calendarDate.year
              month: =..calendarDate.month
              today: =..calendarDate.day
            dataOut: CreateAppointment.calendarDate.dayLable
    - actionType: evalObject
      object:
        - =.builtIn.string.concat:
            dataIn:
              - =..calendarDate.year
              - "-"
              - =..calendarDate.month
              - "-"
              - =..calendarDate.day
            dataOut: CreateAppointment.calendarDate.todayDate
    - actionType: evalObject
      object:
        - =.builtIn.date.getTimeStampOfDate:
            dataIn:
              date: =..calendarDate.todayDate
            dataOut: CreateAppointment.calendarDate.calendarDate
    - actionType: evalObject
      object:
        - =.builtIn.string.concat:
            dataIn:
              - "stime>"
              - =..calendarDate.calendarDate.start
              - " AND "
              - "etime<"
              - =..calendarDate.calendarDate.end
              - " AND "
              - "subtype=1"
            dataOut: Global.scheduleScondition
    - actionType: evalObject
      object:
        - ..schedule.scheduleList.edge@: []
    - if:
        # - =.CreateAppointment.GetE3request.edge
        - ..scheduleSetting.get
        - ..schedule.get
        - continue
    - actionType: evalObject
      object:
        - .Global.scheduleId@: .CreateAppointment.scheduleSetting.schedule.edge.0.id
    - ..VisitReason.docAPI.get
    - actionType: evalObject
      object:
        ..VisitReason.document@: =..VisitReason.response.doc.0
    - actionType: evalObject
      object:
        - =.builtIn.array.convertToList:
            dataIn:
              array: =..VisitReason.document.name.data.reasonForVisit
              key: reason
            dataOut: CreateAppointment.reasonForVisit
  reasonForVisit: []
  reason: ""
  VisitReason:
    response: ""
    document:
      type: .DocType.VisitReason
      name:
        data:
          reasonForVisit: []
      eid: .Global.rootNotebookID
    docAPI:
      store:
        api: cd
        dataKey: VisitReason.document
      get:
        .DocAPI.get: ""
        api: rd
        type: .DocType.VisitReason
        id: .Global.rootNotebookID
        xfname: eid
        dataKey: CreateAppointment.VisitReason.response
        _nonce: =.Global._nonce
  splitTime:
    morning: []
    afternoon: []
  #get E3
  # GetE3request:
  #   edge: ""
  #   get:
  #     .EdgeAPI.get: ""
  #     api: re
  #     dataKey: CreateAppointment.GetE3request
  #     type: 40000
  #     id: .Global.InviteInfo.evid
  #     sCondition: "subtype=3"
  #     maxcount: "1"
  #     xfname: "bvid"
  #     obfname: "ctime"
  #     # asc: true
  #     _nonce: =.Global._nonce
  # create subtype=2 edge
  save:
    - =.CreateAppointment.newAppointment.edgeAPI.store: ""
  newAppointment:
    response: ""
    edge:
      .Edge: ""
      # evid: .Global.currentUser.vertex.id
      evid: .Global.InviteInfo.evid
      bvid: .Global.currentUser.vertex.id
      id: ""
      refid: "" #the_selected_time_slot_edge.id
      subtype: 2
      type: 40000
      name:
        patientName: .Global.currentUser.vertex.name.userName
        date: ""
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: newAppointment.edge
        dataOut: newAppointment.response
  scheduleSetting:
    schedule:
      edge: ""
    get:
      .EdgeAPI.get: ""
      api: re
      dataKey: scheduleSetting.schedule
      type: 40000
      id: .Global.currentUser.vertex.id
      sCondition: "subtype=3"
      xfname: "bvid"
      maxcount: "1"
      obfname: "ctime"
      _nonce: =.Global._nonce
  schedule:
    response: ""
    scheduleList: ""
    get:
      .EdgeAPI.get: ""
      api: re
      dataIn: "schedule.edge"
      dataOut: "schedule.scheduleList"
    edge:
      type: 40000
      id: "..scheduleSetting.schedule.edge.0.id"
      sCondition: "=.Global.scheduleScondition"
      maxcount: "10000"
      xfname: "refid"
      obfname: "etime"
      asc: true
      _nonce: =.Global._nonce
  calendarDate:
    month: ""
    year: ""
    day: ""
    dayLable: []
    weekLabel:
      - key: SU
      - key: MO
      - key: TU
      - key: WE
      - key: TH
      - key: FR
      - key: SA
    todayDate: "YYYY-MM-DD"
    calendarDate:
    Scondition: ""
  timeSlot: 0
  time1:
    - key: "9:00 AM"
    - key: "9:20 AM"
    - key: "9:40 AM"
    - key: "10:00 AM"
    - key: "10:20 AM"
    - key: "11:00 AM"
    - key: "11:20 AM"
    - key: "11:40 AM"
  time2:
    - key: "1:40 PM"
    - key: "2:00 PM"
    - key: "3:00 PM"
    - key: "4:00 PM"
    - key: "5:00 PM"
  components:
    - .BottomMenu:
      style:
        top: "1.01"
        zIndex: 1000
    - type: view
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "0.5"
        backgroundColor: "0x2988e6ff"
      children:
        - type: view
          text: "Schedule Appointment"
          style:
            top: "0.05"
            left: "0.14"
            width: "0.7"
            height: "0.4"
            fontSize: "2.5vh"
            color: "#ffffff"
            textAlign:
              x: center
        - type: view
          text: "Cancel"
          style:
            top: "0.06"
            left: "0.06"
            width: "0.1"
            height: "0.4"
            fontSize: "1.7vh"
            color: "#ffffff"
            textAlign:
              x: center
        - type: view
          text: "Appointment  type"
          style:
            top: "0.1"
            left: "0.07"
            width: "0.7"
            height: "0.4"
            fontSize: "2.5vh"
            color: "#ffffff"
        - type: "select"
          placeholder: select
          style:
            left: "0.07"
            fontSize: "18"
            top: "0.15"
            height: "0.05"
            width: "0.45"
            borderRadius: "10"
            color: "#DDDDDD"
            textIndent: "5px"
            selectHeight: "0.11"
          options:
            - Select option
            - In-office
            - Telemedicine
        - type: view
          text: "Reason for Visit"
          style:
            top: "0.21"
            left: "0.07"
            width: "0.7"
            height: "0.4"
            fontSize: "2.5vh"
            color: "#ffffff"
        - type: "select"
          dataKey: reason
          onChange:
            - emit:
                actions:
                  - =.builtIn.array.getByKey:
                      dataIn:
                        array: =..VisitReason.document.name.data.reasonForVisit
                        key1: reason
                        value: =..reason
                        key2: duration
                      dataOut: CreateAppointment.timeSlot
            # - actionType: builtIn
            #   funcName: redraw
            #   viewTag: durationTag
          style:
            left: "0.07"
            fontSize: "18"
            top: "0.26"
            height: "0.05"
            width: "0.85"
            borderRadius: "10"
            color: "#DDDDDD"
            textIndent: "5px"
          options: ..reasonForVisit
        - type: view
          text: "Notes for provider"
          style:
            top: "0.32"
            left: "0.07"
            width: "0.7"
            height: "0.4"
            fontSize: "2.5vh"
            color: "#ffffff"
        - type: "view"
          style:
            left: "0.07"
            fontSize: "20"
            top: "0.37"
            height: "0.05"
            width: "0.85"
            border: "1px solid #f3f3f3"
            borderRadius: "10"
            color: "#517086"
            backgroundColor: "#ffffff"
            index: "100"
          children:
            - type: "label"
              text: "Sick,injury,routine,headache,med refill"
              style:
                left: "0.015"
                width: "0.8"
                height: "0.05"
                fontSize: "18"
                top: "0.01"
                color: "#DDDDDD"
                index: "100"
                textAlign:
                  x: center
        - type: "button"
          text: "Find availability"
          style:
            top: "0.435"
            left: "0.25"
            width: "0.5"
            fontSize: "20"
            height: "0.05"
            color: "#ffffff"
            backgroundColor: "#25A147"
            border: "1px solid #f3f3f3"
            borderRadius: "100"
          onClick:
            - actionType: popUpDismiss
              popUpView: Choosetime
            - actionType: popUp
              popUpView: Choosedate
            - actionType: evalObject
              object:
                - =.builtIn.date.splitByTimeSlot:
                    dataIn:
                      object2: =..schedule.scheduleList.edge
                      timeSlot: =..timeSlot
                    dataOut: CreateAppointment.splitTime
        # - type: popUp
        #   viewTag: Choosedate
        #   style:
        #     left: "0.027"
        #     top: "0.52"
        #     width: "0.94"
        #     height: "0.47"
        #     borderRadius: "50"
        #     backgroundColor: "#EAEAEA"
        #     # index: "100"
        #   children:
        #     - type: label
        #       text: "Choose date"
        #       style:
        #         left: "0.28"
        #         top: "0.01"
        #         width: "0.6"
        #         height: "0.3"
        #         color: "#707070"
        #         fontSize: "25"
        #     - type: divider
        #       style:
        #         left: "0.3"
        #         top: "0.045"
        #         height: "0.0001"
        #         width: "0.34"
        #         color: "#c1c1c1"
        #     - type: label
        #       text: "February 2021"
        #       style:
        #         left: "0.065"
        #         top: "0.06"
        #         width: "0.4"
        #         height: "0.3"
        #         color: "#517086"
        #         fontSize: "22"
        #     - type: image
        #       path: blueLeft.svg
        #       style:
        #         left: "0.63"
        #         top: "0.07"
        #         width: "0.036"
        #     - type: image
        #       path: blueRight.svg
        #       style:
        #         left: "0.8"
        #         top: "0.07"
        #         width: "0.035"
        #     - type: "label"
        #       textBoard:
        #       - text: "Sun"
        #       - br:
        #       - br:
        #       - text: "31"
        #       - br:
        #       - br:
        #       - text: "7"
        #       - br:
        #       - br:
        #       - text: "14"
        #       - br:
        #       - br:
        #       - text: "21"
        #       - br:
        #       - br:
        #       - text: "28"
        #       style:
        #         left: "0.055"
        #         top: "0.12"
        #         width: "0.1"
        #         height: "0.05"
        #         color: "#5B88A8"
        #         fontSize: "18"
        #         textAlign:
        #           x: center
        #     - type: "label"
        #       textBoard:
        #       - text: "Mon"
        #       - br:
        #       - br:
        #       - text: "1"
        #       - br:
        #       - br:
        #       - text: "8"
        #       - br:
        #       - br:
        #       - text: "15"
        #       - br:
        #       - br:
        #       - text: "22"
        #       - br:
        #       - br:
        #       - text: "29"
        #       style:
        #         left: "0.175"
        #         top: "0.12"
        #         width: "0.1"
        #         height: "0.05"
        #         color: "#5B88A8"
        #         fontSize: "18"
        #         textAlign:
        #           x: center
        #     - type: "label"
        #       textBoard:
        #       - text: "Tus"
        #       - br:
        #       - br:
        #       - text: "2"
        #       - br:
        #       - br:
        #       - text: "8"
        #       - br:
        #       - br:
        #       - text: "16"
        #       - br:
        #       - br:
        #       - text: "23"
        #       - br:
        #       - br:
        #       - text: "30"
        #       style:
        #         left: "0.295"
        #         top: "0.12"
        #         width: "0.1"
        #         height: "0.05"
        #         color: "#5B88A8"
        #         fontSize: "18"
        #         textAlign:
        #           x: center
        #     - type: "label"
        #       textBoard:
        #       - text: "Wed"
        #       - br:
        #       - br:
        #       - text: "3"
        #       - br:
        #       - br:
        #       - text: "10"
        #       - br:
        #       - br:
        #       - text: "17"
        #       - br:
        #       - br:
        #       - text: "24"
        #       - br:
        #       - br:
        #       - text: "31"
        #       style:
        #         left: "0.415"
        #         top: "0.12"
        #         width: "0.1"
        #         height: "0.05"
        #         color: "#5B88A8"
        #         fontSize: "18"
        #         textAlign:
        #           x: center
        #     - type: "label"
        #       textBoard:
        #       - text: "Thu"
        #       - br:
        #       - br:
        #       - text: "4"
        #       - br:
        #       - br:
        #       - text: "11"
        #       - br:
        #       - br:
        #       - text: "18"
        #       - br:
        #       - br:
        #       - text: "25"
        #       - br:
        #       - br:
        #       - text: "1"
        #       style:
        #         left: "0.535"
        #         top: "0.12"
        #         width: "0.1"
        #         height: "0.05"
        #         color: "#5B88A8"
        #         fontSize: "18"
        #         textAlign:
        #           x: center
        #     - type: "label"
        #       textBoard:
        #       - text: "Fri"
        #       - br:
        #       - br:
        #       - text: "5"
        #       - br:
        #       - br:
        #       - br:
        #       - br:
        #       - text: "19"
        #       - br:
        #       - br:
        #       - text: "26"
        #       - br:
        #       - br:
        #       - text: "2"
        #       style:
        #         left: "0.655"
        #         top: "0.12"
        #         width: "0.1"
        #         height: "0.05"
        #         color: "#5B88A8"
        #         fontSize: "18"
        #         textAlign:
        #           x: center
        #     - type: "label"
        #       textBoard:
        #       - text: "Sat"
        #       - br:
        #       - br:
        #       - text: "6"
        #       - br:
        #       - br:
        #       - text: "13"
        #       - br:
        #       - br:
        #       - text: "20"
        #       - br:
        #       - br:
        #       - text: "27"
        #       - br:
        #       - br:
        #       - text: "3"
        #       style:
        #         left: "0.775"
        #         top: "0.12"
        #         width: "0.1"
        #         height: "0.05"
        #         color: "#5B88A8"
        #         fontSize: "18"
        #         textAlign:
        #           x: center
        #     - type: "button"
        #       text: "12"
        #       style:
        #         top: "0.235"
        #         left: "0.662"
        #         width: "0.08"
        #         height: "0.04"
        #         color: "#517086"
        #         fontSize: "18"
        #         backgroundColor: "#AFC6D6"
        #         borderRadius: "100"
        #         textAlign:
        #           x: center
        #       onClick:
        #         - actionType: popUpDismiss
        #           popUpView: Choosedate
        #         - actionType: popUp
        #           popUpView: Choosetime
        - type: popUp
          viewTag: Choosedate
          style:
            left: "0.027"
            top: "0.52"
            width: "0.94"
            height: "0.47"
            borderRadius: "50"
            backgroundColor: "#EAEAEA"
          children:
            - .calendarView:
              style:
                top: "0"
              children:
                - type: select
                  contentType: month
                  options: .SelectINformationDM.Month
                  style:
                    width: "0.15"
                    left: "0.05"
                    height: "30px"
                    top: "0.01"
                    border: "none"
                  dataKey: calendarDate.month
                  onChange:
                    - emit:
                        actions:
                          - =.builtIn.date.calendarArray:
                              dataIn:
                                year: =..calendarDate.year
                                month: =..calendarDate.month
                                today: =..calendarDate.day
                              dataOut: CreateAppointment.calendarDate.dayLable
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: calendar
                - type: select
                  contentType: year
                  options: .SelectINformationDM.Year
                  style:
                    width: "0.15"
                    height: "30px"
                    left: "0.25"
                    top: "0.01"
                    border: "none"
                  dataKey: calendarDate.year
                  onChange:
                    - emit:
                        actions:
                          - =.builtIn.date.calendarArray:
                              dataIn:
                                year: =..calendarDate.year
                                month: =..calendarDate.month
                                today: =..calendarDate.day
                              dataOut: CreateAppointment.calendarDate.dayLable
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: calendar
                # ues flex layout  , one line: 7 elements  su-->sa
                - type: view
                  style:
                    width: "1"
                    display: "flex"
                    justifyContent: "center"
                    height: "50px"
                    top: "0.04"
                  children:
                    - type: list
                      contentType: listObject
                      listObject: ..calendarDate.weekLabel
                      iteratorVar: itemObject
                      style:
                        width: "320px"
                        display: "flex"
                        height: "50px"
                        justifyContent: "space-between"
                      children:
                        - type: listItem
                          itemObject: ""
                          style:
                            width: "44px"
                            height: "44px"
                            boxSizing: "border-box"
                            border: "none"
                            padding: "0px"
                            display: "inline-block"
                            flex: "auto"
                            borderRadius: "21px"
                          children:
                            - type: label
                              dataKey: itemObject.key
                              style:
                                width: "44px"
                                height: "44px"
                                border: "1px solid black"
                                borderRadius: "21px"
                                lineHeight: "44px"
                                backgroundColor: "0xffffff"
                                textAlign:
                                  x: center
                - type: view
                  style:
                    width: "1"
                    display: "flex"
                    justifyContent: "center"
                    height: "0.4"
                    top: "0.1"
                  viewTag: calendar
                  children:
                    - type: list
                      contentType: listObject
                      listObject: ..calendarDate.dayLable
                      iteratorVar: itemObject
                      viewTag: calendarColor
                      style:
                        width: "320px"
                        display: "flex"
                        height: "300px"
                        backgroundColor: "0x000000"
                        justifyContent: "space-between"
                      children:
                        - type: listItem
                          itemObject: ""
                          style:
                            width: "44px"
                            height: "44px"
                            boxSizing: "border-box"
                            border: "none"
                            padding: "0px"
                            display: "inline-block"
                            flex: "auto"
                            borderRadius: "21px"
                          onClick:
                            - emit:
                                dataKey:
                                  var: itemObject
                                actions:
                                  - =.builtIn.date.calendarArray:
                                      dataIn:
                                        year: =..calendarDate.year
                                        month: =..calendarDate.month
                                        today: $var.key
                                      dataOut: CreateAppointment.calendarDate.dayLable
                                  - =.builtIn.string.concat:
                                      dataIn:
                                        - =..calendarDate.year
                                        - "-"
                                        - =..calendarDate.month
                                        - "-"
                                        - $var.key
                                      dataOut: CreateAppointment.calendarDate.todayDate
                                  - =.builtIn.date.getTimeStampOfDate:
                                      dataIn:
                                        date: =..calendarDate.todayDate
                                      dataOut: CreateAppointment.calendarDate.todayStamp
                                  - =.builtIn.string.concat:
                                      dataIn:
                                        - "stime>"
                                        - =..calendarDate.todayStamp.start
                                        - " AND "
                                        - "etime<"
                                        - =..calendarDate.todayStamp.end
                                        - " AND "
                                        - "subtype=1"
                                      # dataOut: CreateAppointment.calendarDate.Scondition
                                      dataOut: Global.scheduleScondition
                            - actionType: evalObject
                              object:
                                - ..schedule.scheduleList.edge@: []
                            - actionType: evalObject
                              object:
                                .Global._nonce@:
                                  =.builtIn.math.random: ""
                            - ..schedule.get
                            - actionType: evalObject
                              object:
                                - =.builtIn.date.splitByTimeSlot:
                                    dataIn:
                                      object2: =..schedule.scheduleList.edge
                                      timeSlot: =..timeSlot
                                    dataOut: CreateAppointment.splitTime
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: calendarColor
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: schedule
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: todatDate
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: splitTimeTag
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: Choosetime
                            - actionType: popUpDismiss
                              popUpView: Choosedate
                            - actionType: popUp
                              popUpView: Choosetime
                          children:
                            - type: label
                              dataKey: itemObject.key
                              style:
                                width: "44px"
                                height: "44px"
                                borderRadius: "21px"
                                display: "block"
                                lineHeight: "44px"
                                backgroundColor: itemObject.backgroundColor
                                color: itemObject.color
                                zIndex: "100"
                                textAlign:
                                  x: center
                    - type: label
                      text: "Selected:"
                      style:
                        width: "0.15"
                        height: "44px"
                        left: "0.37"
                        top: "250px"
                        border: "none"
                        lineHeight: "30px"
                        textAlign:
                          y: center
                    - type: label
                      viewTag: todatDate
                      dataKey: calendarDate.todayDate
                      style:
                        width: "0.3"
                        left: "0.57"
                        height: "44px"
                        top: "250px"
                        lineHeight: "30px"
                        color: "#538dc7"
                        textAlign:
                          y: center
        - type: popUp
          viewTag: Choosetime
          style:
            left: "0.027"
            top: "0.52"
            width: "0.94"
            height: "0.45"
            borderRadius: "50"
            backgroundColor: "#EAEAEA"
            # index: "100"
          children:
            - type: label
              text: "Choose a time"
              style:
                left: "0.25"
                top: "0.01"
                width: "0.6"
                height: "0.3"
                color: "#707070"
                fontSize: "24"
            - type: divider
              style:
                left: "0.245"
                top: "0.045"
                height: "0.001"
                width: "0.42"
                color: "#c1c1c1"
            - type: label
              dataKey: calendarDate.todayDate
              viewTag: todatDateTag
              style:
                left: "0.05"
                top: "0.06"
                width: "0.8"
                height: "0.3"
                color: "#000000"
                fontSize: "26"
                fontStyle: "bold"
                textAlign:
                  x: center
            - type: label
              text: "Change Date"
              style:
                left: "0.73"
                top: "0.05"
                width: "0.2"
                height: "0.3"
                color: "#2DB3E4"
                fontSize: "14"

                textAlign:
                  x: center
            - type: label
              text: "Morning"
              style:
                left: "0.31"
                top: "0.1"
                width: "0.4"
                height: "0.3"
                color: "#808080"
                fontSize: "25"
            - type: list
              contentType: listObject
              listObject: ..splitTime.morning
              iteratorVar: itemObject
              style:
                width: "0.9"
                height: "0.3"
                top: "0"
                left: "0.01"
                display: "flex"
              children:
                - type: listItem
                  itemObject: ""
                  style:
                    left: "0"
                    width: "0.28"
                    height: "0.04"
                    display: "inline-block"
                  children:
                    - type: label
                      dataKey: itemObject.showTime
                      style:
                        width: "0.25"
                        height: "0.032"
                        # paddingTop: "1px"
                        top: "0.128"
                        left: "0.06"
                        color: "#ffffff"
                        fontSize: "20"
                        fontWeight: "400"
                        zIndex: "100"
                        backgroundColor: "0x2988e6ff"
                        borderRadius: "6"
                        textAlign:
                          x: center
            - type: label
              text: "Affternoon"
              style:
                left: "0.28"
                top: "0.28"
                width: "0.2"
                height: "0.1"
                color: "#808080"
                fontSize: "25"
            - type: list
              contentType: listObject
              listObject: ..splitTime.afternoon
              iteratorVar: itemObject
              style:
                width: "0.9"
                height: "0.45"
                top: "0"
                left: "0.01"
                display: "flex"
              children:
                - type: listItem
                  itemObject: ""
                  style:
                    left: "0"
                    width: "0.28"
                    height: "0.04"
                    display: "inline-block"
                  children:
                    - type: label
                      dataKey: itemObject.showTime
                      style:
                        width: "0.25"
                        height: "0.032"
                        # paddingTop: "8px"
                        top: "0.318"
                        left: "0.06"
                        color: "#ffffff"
                        fontSize: "20"
                        fontWeight: "400"
                        zIndex: "100"
                        backgroundColor: "0x2988e6ff"
                        borderRadius: "6"
                        textAlign:
                          x: center
