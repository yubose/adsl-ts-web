SearchCarriers:
  init:
    - .SignInCheck
    - =.builtIn.search.queryInsurance:
        dataIn:
          id: "0"
        dataOut: SearchCarriers.insurances
    - ..formData.popularCarrier@: =..insurances.0._source.popular
    - ..formData.allCarrier@: =..insurances.0._source.all
    - if:
        - =.Global.Profile.name.data.insuranceId
        - actionType: evalObject
          object:
            - ..formData.hasDefaultInsurance@: ""
            - =..apiRequest.insurance.get: ""
            - =.builtIn.string.concat:
                dataIn:
                  - =..apiRequest.insurance.docQueryResp.doc.0.name.data.companyName
                  - " - "
                  - =..apiRequest.insurance.docQueryResp.doc.0.name.data.planOrMedicalGroup
                dataOut: SearchCarriers.formDataTemp.dufaultCarrier.default
        - continue
  insurances: []
  formData:
    # if has default insurance, display this options
    carrier: ""
    hasDefaultInsurance: none
    popularCarrier: []
    allCarrier: []
    inputCarrier: ""
    realInsurance: []
    Alls: []
    Insurances: ""
    insuranceResponse: ""
    displayResult:
      startBlock: block
      inputBlock: none
      noResultBlock: none
      InsuranceBlock: block
      carrierPlanBlock: none
    isResultNull: true
  formDataTemp:
    dufaultCarrier:
      payMyself: I’m paying for myself
      chooseLater: I’ll choose my insurance later
      default: ""
  apiRequest:
    insurance:
      docQueryResp: ""
      docQueryReq:
        id: .Global.Profile.name.data.insuranceId
      get:
        api: rd
        dataIn: SearchCarriers.apiRequest.insurance.docQueryReq
        dataOut: SearchCarriers.apiRequest.insurance.docQueryResp
  components:
    #导航条
    - type: view
      style:
        marginTop: "0"
        height: "0.055"
        width: "1"
        backgroundColor: "0x2988e6"
        textAlign:
          y: center
      children:
        - type: view
          style:
            height: "auto"
            width: "auto"
          children:
            - type: view
              style:
                marginLeft: "0.025"
                display: "inline-block"
                verticalAlign: middle
                height: "auto"
                width: "0.15"
                textAlign:
                  x: center
              onClick:
                - actionType: builtIn
                  funcName: goBack
                  reload: true
              children:
                - type: label
                  text: Cancel
                  dataKey:
                  style:
                    marginLeft: "0.025"
                    color: "0xffffff"
                    fontSize:
                      .Nfont.h14

                      # fontWeight: "600"
            - type: view
              style:
                marginLeft: "0.025"
                display: "inline-block"
                verticalAlign: middle
                height: "auto"
              children:
                - type: label
                  text: Choose Plan
                  dataKey:
                  style:
                    color: "0xffffff"
                    fontSize: .Nfont.h18

                    width: "0.6"
                    textAlign:
                      x:
                        center
                        # fontWeight: "700"
            - type: view
              style:
                marginLeft: "0.025"
                verticalAlign: middle
                display: "inline-block"
                height: "auto"
                width: "0.15"
                textAlign:
                  x: center
              onClick:
                - goto: AppointmentSearch
              children:
                - type: label
                  text: Done
                  dataKey:
                  style:
                    marginLeft: "0.025"
                    color: "0xffffff"
                    fontSize: .Nfont.h14
                    width: "0.15"

                    fontWeight: "600"
    - type: view
      viewTag: InsuranceTag
      style:
        width: "1"
        height: "0.945"
        display: ..formData.displayResult.InsuranceBlock
      children:
        - type: view
          style:
            width: "1"
            height: "0.045"
            left: "0"
            border:
              style: 2
              color: "0xf3f3f3"
            borderWidth: 1px
          children:
            - type: textField
              viewTag: insTag
              placeholder: "Insurance carrier or plan"
              debounce: 200
              dataKey: formData.inputCarrier
              style:
                width: "0.75"
                left: "0.0467"
                height: "0.045"
                lineHeight: "4.3vh"
                verticalAlign: middle
                color: "0x000000"
                border:
                  style: 1
              onInput:
                - actionType: evalObject
                  object:
                    - .SearchCarriers.formData.realInsurance@: []
                    - =.builtIn.search.queryIns:
                        dataIn:
                          ins: =..formData.inputCarrier
                        dataOut: SearchCarriers.formData.insuranceResponse
                    - ..formData.realInsurance@: =..formData.insuranceResponse.suggest.ins.0.options
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.array.judgeListLength:
                            dataIn:
                              array: =..formData.realInsurance
                              len: 0
                        - ..formData.isResultNull@: true
                        - ..formData.isResultNull@: false
                - actionType: evalObject
                  object:
                    - if:
                        - ..formData.isResultNull
                        - actionType: evalObject
                          object:
                            - ..formData.displayResult.startBlock@: "block"
                            - ..formData.displayResult.inputBlock@: "none"
                            - ..formData.displayResult.noResultBlock@: "block"
                        - actionType: evalObject
                          object:
                            - ..formData.displayResult.startBlock@: "none"
                            - ..formData.displayResult.inputBlock@: "block"
                            - ..formData.displayResult.noResultBlock@: "none"
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..formData.inputCarrier
                              string2: ""
                        - actionType: evalObject
                          object:
                            - ..formData.displayResult.startBlock@: "block"
                            - ..formData.displayResult.inputBlock@: "none"
                            - ..formData.displayResult.noResultBlock@: "none"
                        - continue
                - actionType: builtIn
                  funcName: redraw
                  viewTag: startSearch
                - actionType: builtIn
                  funcName: redraw
                  viewTag: inputSearch
                - actionType: builtIn
                  funcName: redraw
                  viewTag: noResultSearch
        - type: view
          viewTag: startSearch
          style:
            width: "1"
            height: "0.9"
            display: ..formData.displayResult.startBlock
          children:
            - type: scrollView
              style:
                width: "1"
                height: "0.9"
              children:
                - type: view
                  style:
                    width: "1"
                    height: "0.1"
                    display: ..formData.displayResult.noResultBlock
                    textAlign:
                      x: center
                      y: center
                  children:
                    - type: image
                      path: noResults.svg
                      style:
                        height: "0.066"
                - type: view
                  style:
                    width: "0.9"
                    left: "0.04"
                    height: "auto"
                  children:
                    - type: label
                      dataKey: formDataTemp.dufaultCarrier.payMyself
                      style:
                        width: "0.9"
                        height: "0.042"
                        lineHeight: "4.2vh"
                        verticalAlign: middle
                        fontSize: .Nfont.h14
                        color: "0x4e4e4e"
                      onClick:
                        - actionType: evalObject
                          object:
                            - ..formData.inputCarrier@: =..formDataTemp.dufaultCarrier.payMyself
                            - .Global.ins@: =..formData.inputCarrier
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: insTag
                    - type: label
                      dataKey: formDataTemp.dufaultCarrier.chooseLater
                      style:
                        width: "0.9"
                        height: "0.042"
                        lineHeight: "4.2vh"
                        verticalAlign: middle
                        fontSize: .Nfont.h14
                        color: "0x4e4e4e"
                      onClick:
                        - actionType: evalObject
                          object:
                            - ..formData.inputCarrier@: =..formDataTemp.dufaultCarrier.chooseLater
                            - .Global.ins@: =..formData.inputCarrier
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: insTag
                    - type: view
                      style:
                        height: "auto"
                        width: "0.92"
                        wordWrap: break-word
                        display: ..formData.hasDefaultInsurance
                      onClick:
                        - actionType: evalObject
                          object:
                            - ..formData.inputCarrier@: =..formDataTemp.dufaultCarrier.default
                            - .Global.ins@: =..formData.inputCarrier
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: insTag
                      children:
                        - type: label
                          dataKey: formDataTemp.dufaultCarrier.default
                          style:
                            display: "inline"
                            color: "0x4e4e4e"
                            width: "0.92"
                            fontSize: .Nfont.h14
                            wordWrap: break-word
                            verticalAlign: middle
                        - type: label
                          text: default
                          style:
                            marginLeft: "0.032"
                            verticalAlign: middle
                            display: "inline-block"
                            color: "0x30b354"
                            fontSize: .Nfont.h1
                            width: "0.1173"
                            backgroundColor: "0xe4f5e9"
                            borderRadius: "3"
                            textAlign:
                              x: center

                - type: view
                  style:
                    width: "1"
                    height: "auto"
                  children:
                    - type: view
                      style:
                        width: "1"
                        height: "0.04"
                        background: "0xf3f3f3"
                      children:
                        - type: label
                          text: Popular carriers
                          style:
                            left: "0.04"
                            height: "0.04"
                            width: "0.75"
                            lineHeight: "4vh"
                            fontSize: .Nfont.h14
                            color: "0x2988e6"
                            fontWeight: 700
                - type: view
                  style:
                    width: "0.95"
                    height: "auto"
                  children:
                    - type: list
                      contentType: listObject
                      listObject: ..formData.popularCarrier
                      iteratorVar: itemObject
                      style:
                        width: "0.95"
                        margin: "0"
                        left: "0.04"
                        height: "auto"
                      children:
                        - type: listItem
                          itemObject: ""
                          onClick:
                            - actionType: evalObject
                              object:
                                - ..formData.popularPlans@: []
                                - ..formData.allPlans@: []
                            - emit:
                                dataKey:
                                  var: itemObject
                                actions:
                                  - ..formData.popularPlans@: $var.plan.0
                                  - ..formData.Alls@: =..formData.popularPlans
                                  - ..formData.InsurancePlanInput@: $var.carrier
                                  - ..formData.displayResult.InsuranceBlock@: none
                                  - ..formData.displayResult.carrierPlanBlock@: block
                                  - ..formData.carrier@: $var.carrier
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: InsuranceTag
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: carrierPlanTag
                          style:
                            width: "0.95"
                            height: "auto"
                            left: "0"
                            lineHeight: "4.2vh"
                            verticalAlign: middle
                          children:
                            - type: label
                              dataKey: itemObject.carrier
                              style:
                                height: "auto"
                                width: "0.9"
                                fontSize: .Nfont.h14
                                color: "0x4e4e4e"

                - type: view
                  # viewTag: startSearch
                  style:
                    width: "1"
                    height: "auto"
                  children:
                    - type: view
                      style:
                        width: "1"
                        height: "0.04"
                        background: "0xf3f3f3"
                      children:
                        - type: label
                          text: All carriers
                          dataKey:
                          style:
                            left: "0.04"
                            height: "0.04"
                            width: "0.75"
                            lineHeight: "4vh"
                            fontSize: .Nfont.h14
                            color: "0x2988e6"
                            fontWeight: "700"
                - type: view
                  style:
                    width: "0.95"
                    height: "auto"
                  children:
                    - type: list
                      contentType: listObject
                      listObject: ..formData.allCarrier
                      iteratorVar: itemObject
                      scrollable: false
                      style:
                        width: "0.95"
                        margin: "0"
                        left: "0.04"
                        height: "auto"
                      children:
                        - type: listItem
                          itemObject: ""
                          onClick:
                            - actionType: evalObject
                              object:
                                - ..formData.popularPlans@: []
                                - ..formData.allPlans@: []
                            - emit:
                                dataKey:
                                  var: itemObject
                                actions:
                                  - ..formData.allPlans@: $var.plan.1
                                  - ..formData.Alls@: =..formData.allPlans
                                  - ..formData.InsurancePlanInput@: $var.carrier
                                  - ..formData.displayResult.InsuranceBlock@: none
                                  - ..formData.displayResult.carrierPlanBlock@: block
                                  - ..formData.carrier@: $var.carrier
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: InsuranceTag
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: carrierPlanTag
                          style:
                            width: "0.95"
                            height: "auto"
                            left: "0"
                            textAlign:
                              y: center
                          children:
                            - type: label
                              dataKey: itemObject.carrier
                              style:
                                # height: '0.042'
                                width: "0.9"
                                lineHeight: "4.2vh"
                                fontSize: .Nfont.h14
                                color: "0x4e4e4e"
        - type: view
          viewTag: inputSearch
          style:
            width: "1"
            height: "0.9"
            display: ..formData.displayResult.inputBlock
          children:
            - type: scrollView
              style:
                width: "1"
                height: "0.9"
              children:
                - type: view
                  style:
                    width: "0.95"
                    height: "auto"
                  children:
                    - type: list
                      contentType: listObject
                      listObject: ..formData.realInsurance
                      iteratorVar: itemObject
                      scrollable: false
                      style:
                        width: "0.95"
                        margin: "0"
                        left: "0.04"
                        height: "auto"
                      children:
                        - type: listItem
                          itemObject:
                          style:
                            width: "0.95"
                            height: "auto"
                            left: "0"
                            lineHeight: "4.2vh"
                            verticalAlign: middle
                          children:
                            - type: label
                              highlightKey: formData.inputCarrier
                              highlightStyle:
                                color: "#FF6666"
                              dataKey: itemObject.text
                              style:
                                height: "auto"
                                width: "0.9"
                                fontSize: .Nfont.h14
                                color: "0x4e4e4e"
                              onClick:
                                - emit:
                                    dataKey:
                                      var: itemObject
                                    actions:
                                      - ..formData.inputCarrier@: $var.text
                                      - .Global.ins@: =..formData.inputCarrier
                                      - ..formData.InsurancePlanInput@: $var.text
                                      - ..formData.displayResult.InsuranceBlock@: none
                                      - ..formData.displayResult.carrierPlanBlock@: block
                                      - ..formData.carrier@: $var.text
                                - actionType: evalObject
                                  object:
                                    - =.builtIn.search.queryInsurance:
                                        dataIn:
                                          id: "0"
                                        dataOut: SearchCarriers.formData.Insurances
                                    - =.builtIn.search.ChooseCarrier:
                                        dataIn:
                                          object: =..formData.Insurances.0._source.all
                                          cond: =..formData.inputCarrier
                                        dataOut: SearchCarriers.formData.Alls
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: InsuranceTag
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: carrierPlanTag
    - type: view
      viewTag: carrierPlanTag
      style:
        width: "1"
        height: "0.945"
        display: ..formData.displayResult.carrierPlanBlock
      children:
        - type: textField
          viewTag: insTag
          placeholder: "Insurance plan"
          dataKey: formData.inputCarrier
          style:
            width: "0.75"
            left: "0.0467"
            height: "0.045"
            lineHeight: "4.3vh"
            verticalAlign: middle
            color: "0x000000"
            border:
              style: 1
        - type: scrollView
          style:
            width: "1"
            height: "0.9"
          children:
            - type: view
              style:
                width: "1"
                height: "0.04"
                background: "0xf3f3f3"
              children:
                - type: label
                  dataKey: formData.InsurancePlanInput
                  style:
                    left: "0.04"
                    height: "0.04"
                    width: "0.75"
                    lineHeight: "4vh"
                    fontSize: .Nfont.h14
                    color: "0x2988e6"
                    fontWeight: 700
            - type: view
              style:
                width: "0.95"
                height: "auto"
              children:
                - type: list
                  contentType: listObject
                  listObject: ..formData.Alls
                  iteratorVar: itemObject
                  scrollable: false
                  style:
                    width: "0.95"
                    margin: "0"
                    left: "0.04"
                    height: "auto"
                  children:
                    - type: listItem
                      itemObject:
                      style:
                        width: "0.95"
                        height: "auto"
                        left: "0"
                        lineHeight: "4.2vh"
                        verticalAlign: middle
                      children:
                        - type: label
                          dataKey: itemObject
                          style:
                            height: "auto"
                            width: "0.9"
                            fontSize: .Nfont.h14
                            color: "0x4e4e4e"
                      onClick:
                        - emit:
                            dataKey:
                              var: itemObject
                            actions:
                              - =.builtIn.string.concat:
                                  dataIn:
                                    - =..formData.carrier
                                    - " - "
                                    - $var
                                  dataOut: SearchCarriers.formData.inputCarrier
                              - .Global.ins@: =..formData.inputCarrier
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: insTag
