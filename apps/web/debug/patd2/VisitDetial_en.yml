VisitDetial:
  title: Visit Detail
  init:
    - .SignInCheck
    # AppointmentLobby AppointmentLobbyVisit VisitDetial
    - .Global.formData.medicalStatus@: true
    - .Global.formData.backPageName@: "VisitDetial"
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    # 把当前预约会议赋值给当前预约信息以供后续页面使用
    - .Global.currentRoomInfo.edge@: =.Global.roomInfo.edge
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.roomInfo.edge.bvid
              string2: =.Global.currentUser.vertex.id
        - .Global.currentRoom.edge@: =.Global.roomInfo.edge
        - actionType: evalObject
          object:
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =.Global.roomInfo.edge.evid
                      string2: =.Global.currentUser.vertex.id
                - .Global.currentRoom.edge@: =.Global.roomInfo.edge
                - actionType: evalObject
                  object:
                    - =..apiRequest.accessRoomInfo.edgeAPI.get: ""
                    - .Global.currentRoom.edge@: =..apiRequest.accessRoomInfo.response.edge.0
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.roomInfo.edge.name.visitType
              string2: Telemedicine
        - ..formData.isTelemedicine@: none
        - ..formData.isTelemedicine@: ""
    - if:
        - =.Global.currentFacility.name.data
        - continue
        - actionType: evalObject
          object:
            - ..apiRequest.facility.documentReq.id@: =.Global.roomInfo.edge.name.facilityId
            - =..apiRequest.facility.docAPI.get: ""
            - .Global.currentFacility@: =..apiRequest.facility.response.doc.0
    # get all E2 and display all the participants
    - ..apiRequest.appointment_E10.edgeAPI.get
    - if:
        - =..apiRequest.appointment_E10.edgeQueryResp.edge
        - actionType: evalObject
          object:
            - ..formData.participants_others@: ""
            - =.builtIn.object.extract:
                dataIn:
                  array: =..apiRequest.appointment_E10.edgeQueryResp.edge
                  field: name.role
                dataOut: VisitDetial.formData.roleList
        - continue
    - =.builtIn.object.extract:
        dataIn:
          array: =..apiRequest.appointment_E10.edgeQueryResp.edge
          field: name
        dataOut: VisitDetial.formData.participants
    # 去除邀请者中与主provider相同的人
    - =.builtIn.array.removeByName:
        dataIn:
          object: =..formData.participants
          key: roleName
          name: =.Global.currentRoomInfo.edge.name.providerName
    # According to the design team, only reserve patient and provider roles in participants
    - =.builtIn.array.removeByName:
        dataIn:
          object: =..formData.participants
          key: role
          name: Location
    - =.builtIn.array.removeByName:
        dataIn:
          object: =..formData.participants
          key: role
          name: Room
    - =.builtIn.array.removeByName:
        dataIn:
          object: =..formData.participants
          key: role
          name: Facility
    - =..apiRequest.financialInfo.docAPI.get: ""
    - if:
        - =.builtIn.utils.judgeAll:
            dataIn:
              value:
                - =.Global.roomInfo.edge.name.fee
                - =..apiRequest.financialInfo.docQueryResp.doc.0.name.data.paymentInfo.fee
              index: "0.00"
        - actionType: evalObject
          object:
            - ..formData.opacity_payStatus@: 0.6
            - ..formData.backgroundColor_status@: "#f4f4f4"
            - ..formData.pointerEvents_payStatus@: none
            - ..formData.display_payStatus@: none
        - continue
    - =..apiRequest.paymentEdge.edgeAPI.get: ""
    - if:
        - =..apiRequest.paymentEdge.edgeResp.edge.0.id
        - actionType: evalObject
          object:
            - ..apiRequest.hasPaidProfile.getDocReq.id@: =..apiRequest.paymentEdge.edgeResp.edge.0.id
            - =..apiRequest.hasPaidProfile.docAPI.get: ""
        - continue
    # 根据进来的入口决定要不要展示 enter virtual room的 button
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.MiddlePage.visitDetialbackPage
              string2: AppointmentHistory
        - actionType: evalObject
          object:
            - ..formData.displayTitle@: inline-block
            - ..formData.displayUnTitle@: none
        - actionType: evalObject
          object:
            - ..formData.displayTitle@: none
            - ..formData.displayUnTitle@: inline-block
    # 如果会议已经关闭，则不显示enter virtual room
    - =..apiRequest.appointment.edgeAPI.get: ""
    - .Global.roomInfo.edge@: =..apiRequest.appointment.edgeQueryResp.edge.0
    # - if:
    #     - =.builtIn.number.typeIsValid:
    #         dataIn:
    #           docType: =.Global.roomInfo.edge.tage
    #           localArr: [9]
    #           binaryArr: [1]
    #     - actionType: evalObject
    #       object:
    #         - ..formData.display_enterVirtalRoom@: none
    #         - ..formData.displayTitle@: inline-block
    #     - actionType: evalObject
    #       object:
    #         - ..formData.display_enterVirtalRoom@: "inline-block"
    #         - ..formData.displayTitle@: none
    # - ..formData.display_enterVirtalRoom@: none
    # - ..formData.display_enterVirtalRoom@: "inline-block"
    # 首先我们要获取所有的related appointment的 doc, 用当前的房间id作为reid 去查所有的doc就可以
    # 有三种情况 1. 0个 doc， 说明是老预约 2. 1个doc 说明只有当前一个 ，也可以说明没有 related app
    # 3. 有多个 出去当前的房间id 其他的就是当前的 related
    # 获取自己房间的小尾巴， 目的： 1。 reid 是跟房间 2. 自己的id 为下一个 related app的fid
    - =..apiRequest.getRelatedLink.docAPI.get: ""
    # 把自己的东西放到全局
    - .Global.formData.relatedApp.activeRelatedlink@: =..apiRequest.getRelatedLink.getResp.doc.0
    - =..apiRequest.getRelatedAppointment.docAPI.get: ""
    - =.builtIn.array.getListLength:
        dataIn:
          object: =..apiRequest.getRelatedAppointment.getResp.doc
        dataOut: VisitDetial.formData.relatedAppointmentCountString
    - =.builtIn.string.retainNumber:
        dataIn:
          value: =..formData.relatedAppointmentCountString
        dataOut: VisitDetial.formData.relatedAppointmentCount
    - if:
        - =.builtIn.math.greater:
            dataIn:
              num1: =.formData.relatedAppointmentCount
              num2: 0
        - =.builtIn.object.extract:
            dataIn:
              array: =..apiRequest.getRelatedAppointment.getResp.doc
              field: eid
            dataOut: VisitDetial.formData.relatedAppointmentIdList
        - continue
    # 把所有的appointment id 存放在 global里面
    - .Global.currentRoomrelatedAppointment@: =..formData.relatedAppointmentIdList
    - if:
        - =.builtIn.math.greater:
            dataIn:
              num1: =..formData.relatedAppointmentCount
              num2: 2
        - actionType: evalObject
          object:
            - ..formData.relatedAppointmentDisplay@: "block"
            - .Global.formData.tabBarShow@: "block"
        - actionType: evalObject
          object:
            - ..formData.relatedAppointmentDisplay@: "none"
            - .Global.formData.tabBarShow@: "none"

    # 处理Medical Recommendation
    - =.builtIn.array.pushAny:
        dataIn:
          newMessage: =.Global.roomInfo.edge.id
          messages: =..apiRequest.recommendation.docReq.id
        dataOut: VisitDetial.apiRequest.recommendation.docReq.id
    - =..apiRequest.recommendation.docAPI.get: ""
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =..apiRequest.recommendation.docResp.doc
              len: 0
        - .Global.formData.providerDoc.recommendationDoc@: ""
        - .Global.formData.providerDoc.recommendationDoc@: =..apiRequest.recommendation.docResp.doc.0

  formData:
    relatedAppointmentCountString: ""
    relatedAppointmentCount: ""
    relatedAppointmentDisplay: "none"
    relatedAppointmentIdList: []
    display_payStatus: ""
    pointerEvents_payStatus: ""
    backgroundColor_status: "#ffffff"
    opacity_payStatus: 1
    display_enterVirtalRoom: "none"
    displayUnTitle: "none"
    displayTitle: "block"
    pageName: ""
    isTelemedicine: none
    participants: []
    roleList: []
    # to control the provider of participants is display or not, display default
    participants_provider: ""
    # to control the other roles of participants is display or not, hide default
    participants_others: none
  apiRequest:
    recommendation:
      docResp: ""
      docReq:
        id: []
        xfname: "reid"
        type: .DocType.MedicalRecommend
        obfname: "mtime"
        maxcount: "1"
        _nonce: .Global._nonce
      docAPI:
        .DocAPI: ""
        get:
          api: rd
          dataIn: VisitDetial.apiRequest.recommendation.docReq
          dataOut: VisitDetial.apiRequest.recommendation.docResp
    accessRoomInfo:
      response: ""
      edge:
        type: .EdgeType.InviteInfo
        id:
          - .Global.currentUser.vertex.id
          - .Global.roomInfo.edge.id
        xfname: "bvid|evid,refid"
      edgeAPI:
        .EdgeAPI: ""
        get:
          api: re
          dataIn: apiRequest.accessRoomInfo.edge
          dataOut: apiRequest.accessRoomInfo.response
    #获取自己房间的realated 小尾巴
    getRelatedLink:
      getDocinfo:
        id: .Global.roomInfo.edge.id
        xfname: "eid"
        type: .DocType.RelatedAppTag
        _nonce: .Global._nonce
      getResp: ""
      docAPI:
        get:
          api: rd
          dataIn: apiRequest.getRelatedLink.getDocinfo
          dataOut: VisitDetial.apiRequest.getRelatedLink.getResp
    #获取所有的关联预约
    getRelatedAppointment:
      getDocinfo:
        id: =.Global.formData.relatedApp.activeRelatedlink.esig
        xfname: "reid"
        type: .DocType.RelatedAppTag
        obfname: mtime
      getResp: ""
      docAPI:
        get:
          api: rd
          dataIn: apiRequest.getRelatedAppointment.getDocinfo
          dataOut: VisitDetial.apiRequest.getRelatedAppointment.getResp
    appointment:
      edgeQueryResp: ""
      edgeQueryReq:
        id: .Global.roomInfo.edge.id
        _nonce: =.Global._nonce
      edgeAPI:
        get:
          api: re
          dataIn: VisitDetial.apiRequest.appointment.edgeQueryReq
          dataOut: VisitDetial.apiRequest.appointment.edgeQueryResp
    paymentEdge:
      edgeResp: ""
      edgeIn:
        id: .Global.roomInfo.edge.id
        xfname: refid
        _nonce: .Global._nonce
        type: 1113
        obfname: mtime
        subtype: 1
      edgeAPI:
        get:
          api: re
          dataIn: VisitDetial.apiRequest.paymentEdge.edgeIn
          dataOut: VisitDetial.apiRequest.paymentEdge.edgeResp
    hasPaidProfile:
      getDocResp: ""
      getDocReq:
        id: ""
        xfname: eid
        type: 2001
        obfname: mtime
        _nonce: .Global._nonce
        maxcount: "100"
      docAPI:
        get:
          api: rd
          dataIn: VisitDetial.apiRequest.hasPaidProfile.getDocReq
          dataOut: VisitDetial.apiRequest.hasPaidProfile.getDocResp
    financialInfo:
      docQueryResp: ""
      docQueryReq:
        type: .DocType.FinancialInfo
        id: .Global.roomInfo.edge.id
        xfname: reid
        obfname: mtime
        maxcount: "1"
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: VisitDetial.apiRequest.financialInfo.docQueryReq
          dataOut: VisitDetial.apiRequest.financialInfo.docQueryResp
    facility:
      response: ""
      documentReq:
        id: ""
        xfname: ovid
        type: .DocType.FacilityProfile
        _nonce: .Global._nonce
        obfname: mtime
        maxcount: "1"
      docAPI:
        get:
          api: rd
          dataIn: VisitDetial.apiRequest.facility.documentReq
          dataOut: VisitDetial.apiRequest.facility.response
    # get the E10
    appointment_E10:
      edgeQueryResp: ""
      edgeQueryReq:
        id: .Global.roomInfo.edge.id
        xfname: refid
        type: .EdgeType.InviteInfo
        sCondition: subtype!=0
        _nonce: =.Global._nonce
      edgeAPI:
        get:
          api: re
          dataIn: VisitDetial.apiRequest.appointment_E10.edgeQueryReq
          dataOut: VisitDetial.apiRequest.appointment_E10.edgeQueryResp
    newVideoMessage:
      response: ""
      document:
        eid: =.Global.currentRoom.edge.id
        reid: =.Global.roomInfo.edge.id
        subtype:
          isOnServer: 1
          isZipped: 0
          isBinary: 0
          isEncrypted: 0
          isExtraKeyNeeded: 0
          isEditable: 0
          applicationDataType: 8
          # 7 th bit
          notification: 0
          ringToneNotify: 0
          sendtoSelf: 0
          # 10 bit
          textMessage: 0
          mediaType: 8
        type: 770
        name:
          title: textMessage
          senderId: .Global.currentUser.vertex.id
          senderName: .Global.currentUser.vertex.name.userName
          data:
            text: ""
      docAPI:
        store:
          api: cd
          dataIn: apiRequest.newVideoMessage.document
          dataOut: apiRequest.newVideoMessage.response
  components:
    # - .BasePublicHeader:
    #   children:
    #     - .BasePublicHeaderLeft:
    #       style:
    #         display: ..formData.display_enterVirtalRoom
    #       leftClick:
    #         - goto: =.Global.MiddlePage.visitDetialbackPage
    #     - .BasePublicHeaderTitle:
    - .BasePublicHeader:
      style:
        display: ..formData.displayTitle
      children:
        - .BasePublicHeaderLeft:
          leftClick:
            - actionType: evalObject
              object:
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =.Global.formData.lastPage
                          string2: "MenuBars"
                    - actionType: evalObject
                      object:
                        - goto: MedicalRecommendation
                        - .Global.formData.backPageName@: RecommendationsRecord
                        - .Global.formData.medicalStatus@: false
                    - actionType: builtIn
                      funcName: goBack
                      reload: true
        - .BasePublicHeaderTitle:
        - .BasePublicHeaderRightIcon:
          path: help.png
          onClick:
            - actionType: popUp
              popUpView: questionTips
    - .BasePublicHeader:
      style:
        display: ..formData.displayUnTitle
      children:
        # - .BasePublicHeaderLeft:

        - .BasePublicHeaderTitle:
          style:
            height: "0.055"
            lineHeight: "5.5vh"
            marginLeft: "0.18"
        - .BasePublicHeaderRightIcon:
          path: help.png
          onClick:
            - actionType: popUp
              popUpView: questionTips
    # - .BasePublicHeader:
    #   style:
    #     display: ..formData.displayTitle
    #   children:
    #     - .BasePublicHeaderCenter:
    - type: scrollView
      style:
        width: "1"
        height: "0.86"
      children:
        - type: view
          style:
            height: "0.05"
            backgroundColor: "#f0f0f0"
            width: "1"
          children:
            - type: label
              text: Appointment  Info
              style:
                display: "inline-block"
                marginLeft: "0.05"
                color: "0x666666"
                height: "0.05"
                width: "0.45"
                lineHeight: 5vh

                fontSize: .Nfont.h14
                fontWeight: "600"
                textAlign:
                  x: left
        - type: view
          style:
            height: "auto"
            width: "0.9"
            marginLeft: "0.05"
            color: "0x4b4b4b"
          children:
            - .PresListView:
              children:
                - .PresLabelLeft:
                  text: Provider Name
                - .PresLabelRight:
                  dataKey: Global.roomInfo.edge.name.providerName
            - .PresListView:
              children:
                - .PresLabelLeft:
                  text: Visit Type
                - .PresLabelRight:
                  dataKey: Global.roomInfo.edge.name.visitType
            - .PresListView:
              children:
                - .PresLabelLeft:
                  text: "Reason for Visit"
                - .PresLabelRight:
                  dataKey: Global.roomInfo.edge.name.Reason
            - .PresListView:
              children:
                - .PresLabelLeft:
                  text: "Date"
                - .PresLabelRight:
                  text=func: .builtIn.string.formatUnixtimeL_en
                  dataKey: Global.roomInfo.edge.stime
            - .PresListView:
              children:
                - .PresLabelLeft:
                  text: "Time"
                - .PresLabelRight:
                  text=func: .builtIn.date.ShowTimeSpan
                  dataKey: Global.roomInfo.edge
            - .PresListView:
              viewTag: locationAndAddress
              style:
                display: ..formData.isTelemedicine
              children:
                - .PresLabelLeft:
                  text: "Location"
                - .PresLabelRight:
                  dataKey: Global.roomInfo.edge.name.locationName
            - .PresListView:
              viewTag: locationAndAddress
              style:
                display: ..formData.isTelemedicine
              children:
                - .PresLabelLeft:
                  text: "Address"
            - .PresListView:
              viewTag: locationAndAddress
              style:
                display: ..formData.isTelemedicine
              children:
                - .PresLabelLeft:
                  dataKey: Global.roomInfo.edge.name.location
                  style:
                    width: "0.9"
                    fontWeight: "normal"
                    wordBreak: break-word
            - .PresListView:
              viewTag: tag_payStatus
              style:
                display: ..formData.display_payStatus
              children:
                - .PresLabelLeft:
                  text: "Payment Status"
                - .PresLabelRight:
                  text: ""
                  dataKey: apiRequest.hasPaidProfile.getDocResp.doc.0
                  text=func: .builtIn.object.transformStatus
                  style:
                    color: ..formData.payStatus.fontColor
            - .PresListView:
              style:
                fontSize: "0"
              children:
                - .PresLabelLeft:
                  style:
                    width: "0.808"
                  text: "Medical Recommendation"
                - .PresLabelRight:
                  text: View
                  style:
                    color: "#2988e6"
                    width: "auto"
                    textDecoration: underline
                  onClick:
                    - actionType: evalObject
                      object:
                        - if:
                            - =.builtIn.array.judgeListLength:
                                dataIn:
                                  array: =..apiRequest.recommendation.docResp.doc
                                  len: 0
                            - continue
                            - .Global.Note@: =..apiRequest.recommendation.docResp.doc.0
                    - goto: MedicalRecommendation
        - type: view
          style:
            marginTop: "0.015"
            height: "0.05"
            backgroundColor: "0xf0f0f0"
            width: "1"
          children:
            - type: label
              text: Medical Info
              style:
                display: "inline-block"
                marginLeft: "0.05"
                color: "0x666666"
                height: "0.05"
                width: "0.48533333"
                lineHeight: 5vh

                fontSize: .Nfont.h14
                fontWeight: "600"
                textAlign:
                  x: left

            - type: view
              style:
                width: auto
                height: auto
                display: inline-block
              children:
                - type: label
                  text: Related Appointments
                  onClick:
                    - goto: RelatedAppointments
                  style:
                    display: ..formData.relatedAppointmentDisplay
                    marginLeft: "0.05"
                    height: "0.05"
                    width: "auto"
                    lineHeight: 5vh

                    fontSize: .Nfont.h14
                    fontWeight: "400"
                    color: "#2988e6"
                    textDecoration: underline
                    textAlign:
                      x: left
        - type: view
          style:
            height: "auto"
            width: "1"
          children:
            - type: view
              style:
                marginTop: "0.02"
                height: "0.16"
                width: "1"
              children:
                - type: view
                  onClick:
                    - goto: RequiredForms
                  style:
                    display: "inline-block"
                    width: "0.28"
                    marginLeft: "0.05"
                    height: "0.14"
                    backgroundColor: "#ffffff"
                    border:
                      style: 3
                    borderWidth: "1"
                    borderRadius: "10"
                    borderColor: "0xdededf"
                    box-sizing: border-box
                    boxShadow: "0px 0px 6px 0.5px #DEDEDF"
                    textAlign:
                      x: center
                  children:
                    - type: image
                      path: profile.svg
                      style:
                        marginTop: "0.01"
                        height: "0.06"
                    - type: label
                      text: Required Forms
                      style:
                        marginTop: "0.01"
                        height: "auto"
                        width: "0.28"

                        fontSize: .Nfont.h12
                        color: "0x4b4b4b"
                        fontWeight: "600"
                        textAlign:
                          x: center
                - type: view
                  style:
                    marginLeft: "0.03"
                    display: "inline-block"
                    width: "0.28"
                    height: "0.14"
                    backgroundColor: "#ffffff"
                    border:
                      style: 3
                    borderWidth: "1"
                    borderRadius: "10"
                    borderColor: "0xdededf"
                    box-sizing: border-box
                    boxShadow: "0px 0px 6px 0.5px #DEDEDF"
                    textAlign:
                      x: center
                  onClick:
                    - actionType: evalObject
                      object:
                        - .Global.vitalsInAppointment@: "true"
                    - goto: VitalSigns
                  children:
                    - type: image
                      path: remoteHealth0.svg
                      style:
                        marginTop: "0.01"
                        height: "0.06"
                    - type: label
                      text: Vital Signs
                      style:
                        marginTop: "0.01"
                        height: "auto"
                        width: "0.28"

                        fontSize: .Nfont.h12
                        color: "0x4b4b4b"
                        fontWeight: "600"
                        textAlign:
                          x: center
                - type: view
                  onClick:
                    - actionType: evalObject
                      object:
                        - .Global.flag.isMeetingPatientchart@: true
                    - goto: PatientChart
                  style:
                    marginLeft: "0.03"
                    display: "inline-block"
                    width: "0.28"
                    height: "0.14"
                    backgroundColor: "#ffffff"
                    border:
                      style: 3
                    borderWidth: "1"
                    borderRadius: "10"
                    borderColor: "0xdededf"
                    box-sizing: border-box
                    boxShadow: "0px 0px 6px 0.5px #DEDEDF"
                    textAlign:
                      x: center
                  children:
                    - type: image
                      path: patientchart.svg
                      style:
                        marginTop: "0.01"
                        height: "0.06"
                    - type: label
                      text: Patient Chart
                      style:
                        marginTop: "0.01"
                        height: "auto"
                        width: "0.28"

                        fontSize: .Nfont.h12
                        color: "0x4b4b4b"
                        fontWeight: "600"
                        textAlign:
                          x: center

            - type: view
              style:
                width: "1"
                height: "0.12"
              children:
                - type: view
                  onClick:
                    - goto: MedicalDocuments
                  style:
                    width: "0.59"
                    height: "0.1"
                    marginLeft: "0.05"
                    backgroundColor: "#ffffff"
                    border:
                      style: 3
                    borderWidth: "1"
                    borderRadius: "10"
                    borderColor: "0xdededf"
                    box-sizing: border-box
                    boxShadow: "0px 0px 6px 0.5px #DEDEDF"
                    display: "inline-block"
                  children:
                    - type: image
                      path: medical.records.svg
                      style:
                        height: "0.06"
                        marginTop: "0.02"
                        marginLeft: "0.042"
                    - type: view
                      style:
                        width: "0.37"
                        height: "0.06"
                        marginTop: "0.03"
                        marginLeft: "0.0246"
                        display: "inline-block"
                      children:
                        - type: label
                          text: "Medical Documents"
                          dataKey:
                          style:
                            fontSize: .Nfont.h12
                            fontWeight: "600"
                            color: "#333333"
                        - type: label
                          text: view all documents here
                          dataKey:
                          style:
                            fontSize: .Nfont.h12
                            fontWeight: "400"
                            color: "#666666"
                            marginTop: "0.005"

                - type: view
                  viewTag: tag_receipt
                  style:
                    marginLeft: "0.03"
                    width: "0.28"
                    height: "0.1"
                    backgroundColor: ..formData.backgroundColor_status
                    pointerEvents: ..formData.pointerEvents_payStatus
                    opacity: ..formData.opacity_payStatus
                    border:
                      style: 3
                    borderWidth: "1"
                    borderRadius: "10"
                    borderColor: "0xdededf"
                    box-sizing: border-box
                    boxShadow: "0px 0px 6px 0.5px #DEDEDF"
                    display: "inline-block"
                    textAlign:
                      x: "center"
                  onClick:
                    - goto: PaymentReceipt
                  children:
                    - type: image
                      path: paymentYellow.svg
                      style:
                        marginTop: "0.01"
                        height: "0.045"
                    - type: label
                      text: "Receipt"
                      style:
                        height: "auto"
                        width: "0.28"

                        fontSize: .Nfont.h12
                        color: "#333333"
                        textAlign:
                          x: "center"
        - type: view
          style:
            marginTop: "0.01"
            height: "0.05"
            backgroundColor: "#f0f0f0"
            width: "1"
          children:
            - type: label
              text: Participants
              style:
                display: "inline-block"
                marginLeft: "0.05"
                color: "0x666666"
                height: "0.05"
                width: "0.45"
                lineHeight: 5vh

                fontSize: .Nfont.h14
                fontWeight: "600"
                textAlign:
                  x: left
            - type: label
              text: + Invite
              dataKey:
              onClick:
                - actionType: evalObject
                  object:
                    - .Global.formData.pageName@: "VisitDetial"
                - goto: ChooseInvite
              style:
                display: "inline-block"
                marginLeft: "0.3074"
                height: "0.05"
                width: "auto"
                lineHeight: 5vh

                textDecoration: underline
                fontSize: .Nfont.h14
                fontWeight: "400"
                color: "#2988e6"
                textAlign:
                  x: left
        - type: view
          style:
            marginTop: "0.02"
            height: "auto"
            width: "0.9"
            marginLeft: "0.05"
            color: "0x4b4b4b"
          children:
            - .PresListView:
              style:
                display: ..formData.participants_provider
              children:
                - .PresLabelLeft:
                  text: Provider
                - .PresLabelRight:
                  dataKey: Global.roomInfo.edge.name.providerName
            - .PresListView:
              children:
                - .PresLabelLeft:
                  text: Patient
                - .PresLabelRight:
                  dataKey: Global.roomInfo.edge.name.patientName
            - type: list
              contentType: listObject
              listObject: ..formData.participants
              iteratorVar: itemObject
              style:
                display: ..formData.participants_others
                width: "0.9"
                margin: "0"
                marginTop: "0"
                height: "auto"
              children:
                - type: listItem
                  itemObject: ""
                  style:
                    width: "0.9"
                    height: "auto"
                    left: "0"
                    marginTop: "0.01"
                    overflow: hidden
                  children:
                    - .PresLabelLeft:
                      dataKey: itemObject.role
                    - .PresLabelRight:
                      dataKey: itemObject.roleName

    - .NextButtonView:
      style:
        top: "0.92"
        height: "0.08"
        width: "1"
        backgroundColor: "0xffffff"
        boxShadow: "0px 1px 10px #dbdfe3"
        overflow: hidden
      children:
        - type: button
          text: Back To Dashboard
          viewTag: nextBtn
          style:
            marginTop: "0.02"
            marginLeft: "0.2"
            width: "0.6"
            height: "0.04"
            backgroundColor: "0x2988e6"
            border:
              style: 5
            borderRadius: "4"

            color: "0xffffff"
            fontWeight: "600"
            fontSize: .Nfont.h14
            textAlign:
              x: center
          onClick:
            - actionType: evalObject
              object:
                .Global.VideoChatObjStore.reference.edge@: =.Global.roomInfo.edge
            - goto: PatientDashboard
        # - type: button
        #   text: Enter Virtual Room
        #   viewTag: nextBtn
        #   style:
        #     marginTop: "0.02"
        #     display: inline-block
        #     marginLeft: "0.1"
        #     width: "0.4"
        #     height: "0.04"
        #     backgroundColor: "0x2988e6"
        #     border:
        #       style: 3
        #     borderColor: "0x2988e6"
        #     borderRadius: "5"
        #
        #     fontSize: .Nfont.h2
        #     color: "0xffffff"
        #     textAlign:
        #       x: center
        #   onClick:
        #     - ..event.enterVirtulRoom
    - .NextButtonView:
      style:
        top: "0.92"
        height: "0.08"
        width: "1"
        display: ..formData.display_enterVirtalRoom
        backgroundColor: "0xffffff"
        boxShadow: "0px 1px 10px #dbdfe3"
        overflow: hidden
      children:
        - type: button
          text: Back to Homepage
          viewTag: nextBtn
          style:
            marginTop: "0.02"
            marginLeft: "0.05"
            width: "0.4"
            display: inline-block
            height: "0.04"
            backgroundColor: "0x2988e6"
            border:
              style: 5
            borderRadius: "4"

            color: "0xffffff"
            fontWeight: "600"
            fontSize: .Nfont.h14
            textAlign:
              x: center
          onClick:
            - actionType: evalObject
              object:
                .Global.VideoChatObjStore.reference.edge@: =.Global.roomInfo.edge
            - goto: PatientDashboard
        - type: button
          text: Enter Virtual Room
          viewTag: nextBtn
          style:
            marginTop: "0.02"
            display: inline-block
            marginLeft: "0.1"
            width: "0.4"
            height: "0.04"
            backgroundColor: "0x2988e6"
            border:
              style: 3
            borderColor: "0x2988e6"
            borderRadius: "5"

            fontSize: .Nfont.h2
            color: "0xffffff"
            textAlign:
              x: center
          onClick:
            - ..event.enterVirtulRoom

    - .SoftTips:
      viewTag: tag_closeMeeting
      message: "The current room is closing, Please contact with the admin if you have problem"
    - type: popUp
      viewTag: questionTips
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
        zIndex: "50"
        textAlign:
          y: center
      onClick:
        - actionType: popUpDismiss
          popUpView: questionTips
      children:
        - type: view
          style:
            width: "0.8"
            marginLeft: "0.1"
            backgroundColor: "0xE6E6E6"
            borderRadius: "14px"
            paddingTop: "0.0270935"
            paddingLeft: "0.032"
            paddingRight: "0.032"
            paddingBottom: "0.0270935"
            boxSizing: border-box
          children:
            - type: label
              textBoard:
                - text: "If you have questions about anything, please contact with &nbsp;"
                - text: ""
                  dataKey: Global.currentFacility.name.data.basicInfo.medicalFacilityName
                  color: "#2988e6"
                - text: "&nbsp;at&nbsp;"
                - text: ""
                  dataKey: Global.currentFacility.name.data.basicInfo.phoneNumber
                  color: "#2988e6"
                - text: "&nbsp;or&nbsp;"
                - text: ""
                  dataKey: Global.currentFacility.name.data.basicInfo.email
                  color: "#2988e6"
              style:
                height: auto
                fontSize: .Nfont.h14

                color: "0x333333"
                lineHeight: "2.58vh"
                wordBreak: break-word
  event:
    button_goBack:
      - actionType: evalObject
        object:
          - goto: =.Global.MiddlePage.visitDetialbackPage

    enterVirtulRoom:
      - actionType: evalObject
        object:
          .Global._nonce@:
            =.builtIn.math.random: ""
      - actionType: evalObject
        object:
          - if:
              - =.Global.roomInfoDoc.document.deat.roomID
              - continue
              - actionType: evalObject
                object:
                  - =..apiRequest.newVideoMessage.docAPI.store: ""
                  - .Global.roomInfoDoc.document@: =..apiRequest.newVideoMessage.response.doc
          - =..apiRequest.appointment.edgeAPI.get: ""
          - .Global.roomInfo.edge@: =..apiRequest.appointment.edgeQueryResp.edge.0
          - if:
              - =.builtIn.number.typeIsValid:
                  dataIn:
                    docType: =.Global.roomInfo.edge.tage
                    localArr: [9]
                    binaryArr: [0]
              - goto: VideoChat
              - actionType: popUp
                popUpView: tag_closeMeeting
                wait: 2000
