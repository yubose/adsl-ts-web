PatientDashboard:
  title: PatientDashboard
  init:
    # 初始化的时候需要从数据库获取的数据,通用信息将直接保存到Global中，后续操作直接从Global中读取而不用再去向后台请求
    # 需要保存到Global并且后续不必再二次请求的数据如下
    # 1. 病人信息： 1. 如果没有去创建 2. 保存在本地备用，保存到Global.Profile
    # 2. 病人信息的 hashtag，保存到Global.formData.hashTag
    # 3. 加好友信息 1. 显示好友申请 （1.1 provider 1.2 facility）,保存到Global.newProviderLength
    # 4. 邮件信息 1.显示邮件红点
    # 5. 病人的当前insurance,保存到Global.formData.module_insurance.insuranceList
    - .SignInCheck
    # if user on browser, he can not use scan so remove the scan button on the list
    - if:
        - .builtIn.isBrowser
        - ..formDataTemp.switchList@: =..formDataTemp.switchTempOnBrowser
        - ..formDataTemp.switchList@: =..formDataTemp.switchTemp
    # clear search params from AppointmentSearch
    - .Global.cond@: ""
    - .Global.pos@: ""
    - .Global.currentPosition@: ""
    - .Global.currentMilse@: "25Miles"
    #clear roomInfo
    - actionType: updateObject
      dataKey: Global.roomInfo.edge
      dataObject: .EmptyObj
    #clear currentRoomInfo
    - actionType: updateObject
      dataKey: Global.currentRoom.edge
      dataObject: .EmptyObj
    # 清空tab栏状态
    - actionType: updateObject
      dataKey: Global.formData.currentTabStatusList
      dataObject: []
    # get date operation
    - =.builtIn.date.getMonth:
        dataIn: ""
        dataOut: PatientDashboard.calendarDate.month
    - =.builtIn.date.getYear:
        dataIn: ""
        dataOut: PatientDashboard.calendarDate.year
    - =.builtIn.date.getDate:
        dataIn: ""
        dataOut: PatientDashboard.calendarDate.day
    - =.builtIn.string.concat:
        dataIn:
          - =.PatientDashboard.calendarDate.year
          - "-"
          - =.PatientDashboard.calendarDate.month
          - "-"
          - =.PatientDashboard.calendarDate.day
        dataOut: PatientDashboard.calendarDate.todayDate
    - =.builtIn.date.getTimeStampOfDate:
        dataIn:
          date: =.PatientDashboard.calendarDate.todayDate
        dataOut: PatientDashboard.calendarDate.todayStamp
    # clear cache
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    # get add friend request to show request num in the page footer,
    # 用来展示 是不是有添加自己好友
    - ..invite.edgeAPI.get
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =..invite.inviteList.edge
              len: 0
        - ..connectionHidden@: "true"
        - actionType: evalObject
          object:
            - ..connectionHidden@: "false"
            - =.builtIn.array.getListLength:
                dataIn:
                  object: =..invite.inviteList.edge
                dataOut: Global.newProviderLength
    # get the first appintment to display in the page header
    - =.builtIn.string.concat:
        dataIn:
          - "stime>"
          - =.PatientDashboard.calendarDate.todayStamp.start
          - " AND "
          - " subtype&0xff in (6,100) AND tage>=0 AND tage&0x100 in (0)"
        dataOut: PatientDashboard.inviteList.edgeQueryReq.sCondition
    # 查询当天最早的会议
    - ..inviteList.get
    # 如果当天有会议，将该会议放入Global.roomInfo.edge以便点击该会议进入会议详情
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =..inviteList.inviteInfo.edge
              len: 0
        - continue
        - actionType: evalObject
          object:
            - .Global.roomInfo.edge@: =..inviteList.inviteInfo.edge.0
            # if appointment has no provider, set default name -> no provider
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =.Global.roomInfo.edge.name.providerFullInfo
                      string2: ""
                - .Global.roomInfo.edge.name.providerFullInfo@: no provider
                - continue
            # 如果是room类型的预约，则将roomName赋值给providerFullInfo以在列表展示
            - if:
                - =.builtIn.number.betweenTwoNumbers:
                    dataIn:
                      figure: =.Global.roomInfo.edge.subtype
                      hexadecimal: 0xff0000
                      compareArr:
                        [
                          0x60000,
                          0xa0000,
                          0xc0000,
                          0xe0000,
                          0x100000,
                          0x120000,
                          0x140000,
                        ]
                - .Global.roomInfo.edge.name.providerFullInfo@: =.Global.roomInfo.edge.name.roomName
                - continue
            # 查询该会议是否已经存在1113付款的那条edge
            - ..apiRequest.paymentEdge.edgeQueryReq.id@: =..inviteList.inviteInfo.edge.0.id
            - =..apiRequest.paymentEdge.edgeAPI.get: ""
    - if:
        #新注册用户信息自动填入,从create new account进来会走这个入口
        - =.Global.formData.profile.firstName
        - actionType: evalObject
          object:
            # 将用户的名字拼接
            - =.builtIn.string.concat:
                dataIn:
                  - =.Global.formData.profile.firstName
                  - " "
                  - =.Global.formData.profile.lastName
                dataOut: PatientDashboard.profile.document.name.data.basicInfo.fullName
            # 如果第一次登陆进来，给用户创建一个 profile
            - =..profile.docAPI.store: ""
            - ..event.initCreateHashTag
            # push some profile infomation to the public profile
            - ..apiRequest.patientPublicProfile.docCreateReq.name.data.basicInfo.firstName@: =.Global.Profile.name.data.basicInfo.firstName
            - ..apiRequest.patientPublicProfile.docCreateReq.name.data.basicInfo.middleName@: =.Global.Profile.name.data.basicInfo.middleName
            - ..apiRequest.patientPublicProfile.docCreateReq.name.data.basicInfo.lastName@: =.Global.Profile.name.data.basicInfo.lastName
            - ..apiRequest.patientPublicProfile.docCreateReq.name.data.basicInfo.fullName@: =.Global.Profile.name.data.basicInfo.fullName
            - ..apiRequest.patientPublicProfile.docCreateReq.name.data.basicInfo.phone@: =.Global.Profile.name.data.basicInfo.phone
            - ..apiRequest.patientPublicProfile.docCreateReq.name.data.basicInfo.dateOfBirth@: =.Global.Profile.name.data.basicInfo.dateOfBirth
            - ..apiRequest.patientPublicProfile.docCreateReq.name.data.basicInfo.userName@: =.Global.Profile.name.data.basicInfo.userName
            - ..apiRequest.patientPublicProfile.docCreateReq.name.data.basicInfo.gender@: =.Global.Profile.name.data.basicInfo.gender
            - =..apiRequest.patientPublicProfile.docAPI.store: ""
            - =.builtIn.object.clear:
                dataIn:
                  object: =.Global.formData
                  key: profile
        # 如果直接从signin 登陆会走这个入口， 然后我门判断profile的版本号
        - continue
    # 查询会议1113edge上携带付款信息的doc
    - if:
        - =..apiRequest.paymentEdge.edgeQueryResp.edge.0.id
        - actionType: evalObject
          object:
            - ..apiRequest.hasPaidProfile.docGetReq.id@: =..apiRequest.paymentEdge.edgeQueryResp.edge.0.id
            - =..apiRequest.hasPaidProfile.docAPI.get: ""
        - continue
    - if:
        - =.Global.Profile.id
        - continue
        - actionType: evalObject
          object:
            - =..profile.docAPI.get: ""
            - if:
                - =..profile.docResponse.doc.0
                - .Global.Profile@: =..profile.docResponse.doc.0
                # 如果没有profile,说明因某种原因导致patient profile丢失，亦或是其他角色初次登录patient端导致没有profile
                - actionType: evalObject
                  object:
                    # 自动代入用户vertex中的某些信息以创建profile
                    - =.builtIn.utils.toaster:
                        dataIn:
                          toastMessage: "Warning: dont get patientProfile , will create a new one ， if you see this warning, please contact our developer"
                    - =.builtIn.string.concat:
                        dataIn:
                          - =.Global.currentUser.vertex.name.firstName
                          - " "
                          - =.Global.currentUser.vertex.name.lastName
                        dataOut: PatientDashboard.profile.document.name.data.basicInfo.fullName
                    - ..profile.document.name.data.basicInfo.firstName@: =.Global.currentUser.vertex.name.firstName
                    - ..profile.document.name.data.basicInfo.lastName@: =.Global.currentUser.vertex.name.lastName
                    - =..profile.docAPI.store: ""
                    - .Global.Profile@: =..profile.createDocResp.doc
                    - ..event.initCreateHashTag
    # 判断是否已经获取过hashtag
    - if:
        - =.Global.formData.hashTag.id
        # 如果有，则不再获取hashTag
        - continue
        - =..apiRequest.hashTag.docAPI.get: ""
    #Judge whether the current profile version number is the latest
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.Profile.name.data.version
              string2: 2
        - actionType: evalObject
          object:
            # 判断用户是否是第一次创建profile
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =.Global.Profile.name.data.isFirstCreateProfile
                      string2: true
                - .Global.nonFirstProfile@: false
                - .Global.nonFirstProfile@: true
            # 如果它的profile下面没有hashtag,则弹框告知用户更新profile,如果有的话，则将其保存到Global.formData.hashTag
            - if:
                - =.builtIn.array.judgeListLength:
                    dataIn:
                      array: =..apiRequest.hashTag.docQueryResp.doc
                      len: 0
                - .Global.nonFirstProfile@: false
                - .Global.formData.hashTag@: =..apiRequest.hashTag.docQueryResp.doc.0
        - .Global.nonFirstProfile@: false
    #获取未读邮件数量
    - =..apiRequest.unReadEmail.docAPI.get: ""
    - =.builtIn.array.getListLength:
        dataIn:
          object: =..apiRequest.unReadEmail.docQueryResp.doc
        dataOut: PatientDashboard.formData.unReadEmailNum
    # 控制邮件模块右上角数字角标是否显示
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =..formData.unReadEmailNum
              string2: "0"
        - ..formData.inboxHidden@: "true"
        - ..formData.inboxHidden@: "false"
    # 控制Upcoming Appointment是否显示
    - if:
        - =..inviteList.inviteInfo.edge.0
        - ..formData.appointmentHidden@: true
        - ..formData.appointmentHidden@: false
    # 格式化Upcoming Appointment中的type显示
    - if:
        - =.Global.roomInfo.edge.name.visitType
        - =.builtIn.string.concat:
            dataIn:
              - "("
              - =.Global.roomInfo.edge.name.visitType
              - ")"
            dataOut: PatientDashboard.formData.typeInfo
        - continue
    #  判断是否有预约来控制Upcoming Appointment模块的显示效果
    - if:
        - =.PatientDashboard.formData.appointmentHidden
        - actionType: evalObject
          object:
            # 控制有预约时的显示效果
            - .PatientDashboard.formData.flag@: "block"
            # 控制无预约时的显示效果
            - .PatientDashboard.formData.reminderFlag@: "none"
            # 控制Upcoming Appointment与下面的组件的距离
            - .PatientDashboard.formData.reminderMargin@: "0.02"
        - actionType: evalObject
          object:
            - .PatientDashboard.formData.flag@: "none"
            - .PatientDashboard.formData.reminderFlag@: "block"
            - .PatientDashboard.formData.reminderMargin@: "0.03"
    # 控制patient没有填完所有必填文档时的样式
    - if:
        - =.builtIn.number.typeIsValid:
            dataIn:
              docType: =.Global.roomInfo.edge.tage
              localArr: [2]
              binaryArr: [0]
        - actionType: evalObject
          object:
            - ..formData.statusColor@: "#ffd7d7"
            - ..formData.timeColor@: "#fd8080"
            - ..formData.labelText@: Fill Out Required Forms
        - continue
    # 控制patient没有check in时的样式
    - if:
        - =.builtIn.number.typeIsValid:
            dataIn:
              docType: =.Global.roomInfo.edge.tage
              localArr: [4]
              binaryArr: [1]
        - actionType: evalObject
          object:
            - ..formData.labelText@: Checked In
        - continue
    # 控制会议和费用相关的样式
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.roomInfo.edge.name.fee
              string2: "0.00"
        - continue
        - actionType: evalObject
          object:
            - if:
                - =.builtIn.array.judgeListLength:
                    dataIn:
                      array: =..apiRequest.hasPaidProfile.docGetResp.doc
                      len: 0
                - actionType: evalObject
                  object:
                    - ..formData.statusColor@: "#ffd7d7"
                    - ..formData.timeColor@: "#fd8080"
                    - ..formData.labelText@: Pay Now
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..apiRequest.hasPaidProfile.docGetResp.doc.0.deat.state
                              string2: "COMPLETED"
                        - continue
                        - actionType: evalObject
                          object:
                            - ..formData.statusColor@: "#ffd7d7"
                            - ..formData.timeColor@: "#fd8080"
                            - ..formData.labelText@: Pay Now
    # get default insurance to auto fill
    - if:
        - =.Global.Profile.name.data.insuranceId
        - actionType: evalObject
          object:
            - ..apiRequest.insurance.docQueryReq.id@: =.Global.Profile.name.data.insuranceId
            - =..apiRequest.insurance.docAPI.get: ""
            - .Global.formData.insurance@: =..apiRequest.insurance.docQueryResp.doc.0
        - continue
  # judge the number on the my healthy network is displayed or not
  connectionHidden: "true"
  # the requests about add friend to this user
  invite:
    edgeQueryReq:
      type: .EdgeType.InviteInfo
      xfname: evid
      id: .Global.currentUser.vertex.id
      maxcount: "10000"
      sCondition: "subtype in (65536,131072)"
      _nonce: =.Global._nonce
    inviteList:
      edge: []
    edgeAPI:
      get:
        api: re
        dataIn: PatientDashboard.invite.edgeQueryReq
        dataOut: PatientDashboard.invite.inviteList
  scan:
    document:
      name:
        data: ""
  calendarDate:
    year: ""
    month: ""
    day: ""
    todayDate: ""
    todayStamp: ""
  apiRequest:
    hashTag:
      docQueryResp: ""
      docQueryReq:
        id:
          - .Global.rootNotebookID
          - =.Global.Profile.id
        type: .DocType.HashTag
        maxcount: 1
        xfname: eid,reid
        obfname: mtime
        _nonce: =.Global._nonce
      docCreateResp: ""
      docCreateReq:
        eid: .Global.rootNotebookID
        type: .DocType.HashTag
        reid: ""
        name:
          data:
            hashTime: ""
            hashFields:
              - name
              - mtime
              - type
            hashCode: "" # sha256
      docAPI:
        get:
          api: rd
          dataIn: PatientDashboard.apiRequest.hashTag.docQueryReq
          dataOut: PatientDashboard.apiRequest.hashTag.docQueryResp
        store:
          api: cd
          dataIn: PatientDashboard.apiRequest.hashTag.docCreateReq
          dataOut: PatientDashboard.apiRequest.hashTag.docCreateResp
    # judge upcoming appointments has paid or not
    paymentEdge:
      edgeQueryResp: ""
      edgeQueryReq:
        id: ""
        xfname: refid
        _nonce: .Global._nonce
        type: .EdgeType.SquareCheckout
        obfname: mtime
      edgeAPI:
        get:
          api: re
          dataIn: PatientDashboard.apiRequest.paymentEdge.edgeQueryReq
          dataOut: PatientDashboard.apiRequest.paymentEdge.edgeQueryResp
    hasPaidProfile:
      docGetResp:
        doc: []
      docGetReq:
        id: ""
        xfname: eid
        type: .DocType.CheckOrder
        obfname: mtime
        _nonce: .Global._nonce
        maxcount: "100"
      docAPI:
        get:
          api: rd
          dataIn: PatientDashboard.apiRequest.hasPaidProfile.docGetReq
          dataOut: PatientDashboard.apiRequest.hasPaidProfile.docGetResp
    getProviderPublicProfile:
      resp: ""
      doc:
        id: =.Global.roomInfo.edge.providerId
        type: .DocType.DoctorPublicProfile
        xfname: ovid
        maxcount: "1"
        obfname: ctime
      docApi:
        get:
          api: rd
          dataIn: apiRequest.getProviderPublicProfile.doc
          dataOut: PatientDashboard.apiRequest.getProviderPublicProfile.resp
    insurance:
      docQueryResp: ""
      docQueryReq:
        id: ""
      docAPI:
        get:
          api: rd
          dataIn: PatientDashboard.apiRequest.insurance.docQueryReq
          dataOut: PatientDashboard.apiRequest.insurance.docQueryResp
    # design the patient public profile structure
    patientPublicProfile:
      docCreateResp: ""
      docCreateReq:
        eid: .Global.rootNotebookID
        type: .DocType.PatientPublicProfile
        name:
          data:
            basicInfo:
              firstName: ""
              middleName: ""
              lastName: ""
              fullName: ""
              phone: ""
              dateOfBirth: ""
              userName: ""
              gender: ""
      docAPI:
        store:
          api: cd
          dataIn: PatientDashboard.apiRequest.patientPublicProfile.docCreateReq
          dataOut: PatientDashboard.apiRequest.patientPublicProfile.docCreateResp
    #获取未读邮件
    unReadEmail:
      docQueryResp: ""
      docQueryReq:
        ObjType: 544
        type: 1281
        sCondition: E.type=10002 AND (D2.Type&0xFF02=0xE00 OR D2.reid IS NULL OR D2.Type = 66561)
        xfname: (E.bvid|E.evid)&!D.ovid
        obfname: ctime
        maxcount: "100"
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: PatientDashboard.apiRequest.unReadEmail.docQueryReq
          dataOut: PatientDashboard.apiRequest.unReadEmail.docQueryResp
  formData:
    updateProfile: true
    # upcoming appointments display
    labelText: "Not Checked In"
    timeColor: "0x30b354"
    # the visit type aftervisitReason
    typeInfo: ""
    unReadEmailNum: "0"
    inboxHidden: "true"
    appointmentHidden: false
    # 预约状态背景颜色
    statusColor: "0xd4f0dc"
    # 控制是否有预约显示信息
    flag: "none"
    reminderFlag: ""
    # 控制 菜单距离提示信息距离
    reminderMargin: "0.02"
    switchFlag: "none"
  formDataTemp:
    switchList: []
    switchTemp:
      - key: Add Network
        path: addProvider.svg
        pageName: AddHealthNetWork
      - key: Scan
        path: scan.svg
        pageName: SearchOutProviderInfo
      - key: Password Recovery
        path: passwordRecover.svg
        pageName: PasswordRecoveryHelper
      - key: Switch Account
        path: switch.svg
        pageName: ChooseUser
    switchTempOnBrowser:
      - key: Add Network
        path: addProvider.svg
        pageName: AddHealthNetWork
      - key: Password Recovery
        path: passwordRecover.svg
        pageName: PasswordRecoveryHelper
      - key: Switch Account
        path: switch.svg
        pageName: ChooseUser
  profile:
    docResponse: ""
    createDocResp:
      doc: ""
    document:
      type: .DocType.PatientProfile
      eid: .Global.rootNotebookID
      name:
        data:
          #first create profile or not
          isFirstCreateProfile: true
          #profile version
          version: 2
          #default insurace id
          insuranceId: ""
          #用户基本信息
          basicInfo:
            avatar: ""
            firstName: .Global.formData.profile.firstName
            middleName: ""
            lastName: .Global.formData.profile.lastName
            dateOfBirth: ""
            gender: ""
            socialSecurity: ""
            fullName: .PatientDashboard.formData.fullName
            userName: .Global.currentUser.vertex.name.userName
            phone: .Global.currentUser.vertex.uid
          #联系人信息
          contactInfo:
            alternatePhone:
              countryCode: "+1"
              phoneNumber: ""
              fullPhone: ""
            email: ""
            address:
              line: ""
              secondLine: ""
              #市
              city: ""
              #郡、县
              county: ""
              #州
              state: ""
              #邮政编码
              zipCode: ""
              fullAddress: ""
          #紧急联系人信息
          emergencyContact:
            firstName: ""
            middleName: ""
            lastName: ""
            #与当前用户的关系，如母子等
            relation: ""
            phone:
              countryCode: "+1"
              phoneNumber: ""
              fullPhone: ""
          #身份证信息
          identification:
            type: Drive License
            id: ""
            #身份证照片的docId
            imageId: ""
          #雇佣者信息
          employment:
            #雇佣者姓名
            employerName: ""
            dept: ""
            #经营范围
            NatureBusiness: ""
            #工作
            Occupation: ""
            #电话
            Telephone: ""
            fax: ""
            #邮箱
            email: ""
            #地址
            address:
              line: ""
              secondLine: ""
              #市
              city: ""
              #郡、县
              county: ""
              #州
              state: ""
              #邮政编码
              zipCode: ""
    docRequest:
      id: .Global.rootNotebookID
      xfname: eid
      obfname: mtime
      type: .DocType.PatientProfile
      _nonce: =.Global._nonce
    docAPI:
      get:
        api: rd
        dataIn: profile.docRequest
        dataOut: PatientDashboard.profile.docResponse
      store:
        api: cd
        dataIn: profile.document
        dataOut: PatientDashboard.profile.createDocResp
        subtype:
          mediaType: "application/json"
  #get the latest appointment
  inviteList:
    inviteInfo:
      edge: []
    edgeQueryReq:
      type: .EdgeType.WaitingRoom
      id: .Global.currentUser.vertex.id
      xfname: "bvid|evid"
      sCondition: ""
      maxcount: "1"
      obfname: "stime"
      asc: true
      _nonce: =.Global._nonce
    get:
      api: re
      dataIn: PatientDashboard.inviteList.edgeQueryReq
      dataOut: PatientDashboard.inviteList.inviteInfo
  components:
    - type: view
      style:
        width: "1"
        height: "0.175"
        top: "0px"
      children:
        - type: view
          style:
            width: "1"
            height: "0.118"
            top: "0px"
            borderRadius: "0px 0px 45px 0px"
            backgroundColor: "#2988e6"
        - type: view
          style:
            width: "0.88"
            height: "0.057"
            top: "0.118"
            backgroundColor: "#2988e6"
          children:
            - type: view
              style:
                width: "1"
                height: "0.057"
                top: "0"
                backgroundColor: "#ffffff"
                borderRadius: "40px 0px 0px 0px"
    - type: view
      style:
        width: "1"
        height: "0.118"
        top: "0px"
        overflow: "hidden"
      children:
        - type: view
          style:
            width: "1"
            height: "auto"
            marginTop: "0.0665"
            overflow: "hidden"
          children:
            - type: label
              text: "Hello,"
              dataKey:
              style:
                marginLeft: "0.08"
                verticalAlign: "middle"
                fontSize: .Nfont.h14

                color: "#ffffff"
                display: "inline-block"
                overflow: "hidden"
            - type: label
              text: "Name Name"
              dataKey: Global.Profile.name.data.basicInfo.fullName
              style:
                marginLeft: "0.0187"
                width: "0.6613"
                display: "inline-block"
                verticalAlign: "middle"
                fontSize: .Nfont.h16
                fontWeight: "700"

                color: "#ffffff"
                overflow: "hidden"
                textOverflow: ellipsis
                whiteSpace: nowrap
                textAlign:
                  x: "left"
            - type: image
              path: navigationBar.svg
              style:
                height: "0.03"
                marginLeft: "0px"
                overflow: "hidden"
                display: "inline-block"
              onClick:
                - ..event.showMoreOptions
    - type: view
      style:
        top: "0.118"
        width: "1"
        height: "0.882"
        overflow: "hidden"
      children:
        - type: view
          style:
            width: "0.83808"
            height: "0.07"
            marginTop: "0.02"
            left: "0.08"
          onClick:
            - actionType: popUp
              popUpView: emergency
          children:
            - type: image
              path: searchFence.svg
              style:
                width: "0.83808"
        - type: view
          style:
            height: "0.0234"
            marginTop: "0.0224"
            marginLeft: "0.08"
          children:
            - type: label
              text: "Upcoming Appointments"
              dataKey:
              style:
                fontSize: .Nfont.h14

                fontWeight: "400"
                textAlign:
                  y: "center"
        # if upcoming appointment is exist
        - type: view
          viewTag: appointmentTag
          style:
            display: ..formData.flag
            width: "0.84"
            height: "0.1"
            marginTop: "0.01"
            marginLeft: "0.08"
            overflow: "hidden"
            borderRadius: "4px"
            backgroundColor: ..formData.statusColor
          onClick:
            - ..event.enterDetailFromUpcomingAppointment
          children:
            - type: view
              style:
                width: "0.84"
                height: "0.0234"
                marginTop: "0.005"
                marginLeft: "0px"
              children:
                - type: label
                  text=func: .builtIn.string.formatUnixtimeL_en
                  dataKey: Global.roomInfo.edge.stime
                  style:
                    width: "0.224"
                    height: "0.0234"
                    fontSize: .Nfont.h14

                    display: "inline-block"
                    marginLeft: "0.0427"
                    color: ..formData.timeColor
                    textAlign:
                      x: "left"
                - type: label
                  dataKey: Global.roomInfo.edge.name.visitReason
                  style:
                    width: "auto"
                    height: "0.0234"
                    fontSize: .Nfont.h14

                    display: "inline-block"
                    textAlign:
                      x: "left"
                      y: "center"
                - type: label
                  dataKey: formData.typeInfo
                  style:
                    marginLeft: "0.02"
                    width: "auto"
                    height: "0.0234"
                    fontSize: .Nfont.h12

                    display: "inline-block"
                    textAlign:
                      x: "left"
                      y: "center"
            - type: view
              style:
                width: "0.84"
                height: "0.026"
                marginLeft: "0px"
                marginTop: "0px"
              children:
                - type: label
                  text=func: .builtIn.string.formatUnixtimeLT_en
                  dataKey: Global.roomInfo.edge.stime
                  style:
                    width: "0.224"
                    height: "0.026"
                    marginLeft: "0.0427"
                    fontSize: .Nfont.h16

                    display: "inline-block"
                    fontWeight: "700"
                    color: ..formData.timeColor
                    textAlign:
                      x: "left"
                - type: label
                  text: "Dr.Lisa - Family Medicine/Family dskf"
                  dataKey: Global.roomInfo.edge.name.providerFullInfo
                  style:
                    width: "0.573"
                    height: "0.026"
                    fontSize: .Nfont.h14

                    display: "inline-block"
                    textAlign:
                      x: "left"
                      y: "center"
                    overflow: hidden
                    textOverflow: ellipsis
                    whiteSpace: nowrap
            - type: view
              style:
                width: "0.84"
                height: "0.001"
                marginTop: "0.0073"
                backgroundColor: ..formData.timeColor
            - type: label
              dataKey: formData.labelText
              style:
                marginTop: "0.002"
                height: "0.035"
                width: "0.84"

                color: ..formData.timeColor
                fontSize: 1.6vh
                textAlign:
                  x: center
                  y: center
        #  无预约显示提示信息
        - type: view
          viewTag: reminderTag
          onClick:
            - goto: MyActiveProvider
          style:
            display: ..formData.reminderFlag
            marginTop: "0.012"
            width: "0.84"
            height: "auto"
            marginLeft: "0.08"
            borderRadius: "5"
            backgroundColor: "0xd4f0dc"
            border:
              style: "1"
            borderColor: "0xffffff"
            boxShadow: "1px 2px 2.5px 1px #e2e9ef"
            overflow: hidden
          children:
            - type: label
              text: "You haven't schedule an appointment"
              style:
                marginTop: "0.015"
                height: "auto"
                width: "0.9"

                color: "0x30b354"
                fontSize: .Nfont.h1
                textAlign:
                  x: center
                  y: center
            - type: label
              text: "Please schedule an appointment first."
              style:
                marginTop: "0.005"
                height: "auto"
                width: "0.9"

                color: "0x30b354"
                fontSize: .Nfont.h1
                textAlign:
                  x: center
                  y: center
            - type: view
              style:
                marginTop: "0.015"
                height: "auto"
        - type: view
          style:
            width: "0.92"
            height: "0.0234"
            marginTop: ..formData.reminderMargin
            left: "0.08"
          children:
            - type: label
              text: "What do you need?"
              dataKey:
              style:
                width: "0.92"
                height: "0.0234"
                fontSize: .Nfont.h14

                # fontWeight: "500"
                textAlign:
                  x: "left"
                  y: "center"
        - type: view
          style:
            width: "0.84"
            height: "0.111"
            marginTop: "0.01"
            left: "0.08"
            boxShadow: "1px 2px 2.5px 1px #e2e9ef"
            borderRadius: "8px"
            overflow: "hidden"
            backgroundColor: "0xffffff"
          onClick:
            - goto: MyActiveProvider
          children:
            - type: view
              style:
                width: "0.53867"
                height: "0.111"
                display: "inline-block"
                backgroundColor: "#fff4e0"
                overflow: "hidden"
                textAlign:
                  x: center
                  y: center
              children:
                - type: image
                  path: calendarYellow.svg
                  style:
                    height: "0.111"
                    backgroundColor: "#fff4e0"
            - type: view
              style:
                width: "0.30133"
                height: "0.111"
                marginLeft: "0PX"
                marginTop: "0px"
                display: "inline-block"
                overflow: "hidden"
              children:
                - type: label
                  text: "Schedule An Appointment"
                  dataKey:
                  style:
                    width: "0.30133"
                    height: "0.111"
                    fontSize: .Nfont.h14

                    # fontWeight: "500"
                    textAlign:
                      x: "center"
                      y: "center"
                    wordbreak: "break-all"
                    overflow: "hidden"
        - type: view
          style:
            width: "1"
            height: "0.1678"
            marginTop: "0.02"
          children:
            # appointment check in
            - type: view
              style:
                width: "0.5387"
                height: "0.1478"
                marginLeft: "0.08"
                marginTop: "0px"
                boxShadow: "1px 2px 2.5px 1px #e2e9ef"
                borderRadius: "10px"
                display: "inline-block"
                backgroundColor: "0xffffff"
              onClick:
                - goto: WaitingRoom
              children:
                - type: view
                  style:
                    width: "0.5387"
                    height: "0.1"
                    marginLeft: "0px"
                    marginTop: "0px"
                    backgroundColor: "#def1ff"
                    borderRadius: "10px 10px 0px 0px"
                    overflow: "hidden"
                    textAlign:
                      x: "center"
                  children:
                    - type: image
                      path: appointmentCheck.svg
                      style:
                        height: "0.103"
                        marginTop: "0.01515"
                - type: label
                  text: "Appointment Check In"
                  dataKey:
                  style:
                    height: "0.0478"
                    width: "0.5387"

                    fontSize: .Nfont.h14
                    # fontWeight: "500"
                    textAlign:
                      x: "center"
                      y: "center"
            # Visit history
            - type: view
              style:
                width: "0.269"
                height: "0.14778"
                marginLeft: "0.032"
                marginTop: "0px"
                boxShadow: "1px 2px 2.5px 1px #e2e9ef"
                borderRadius: "10px"
                display: "inline-block"
                backgroundColor: "0xffffff"
              onClick:
                - goto: AppointmentHistory
              children:
                - type: view
                  style:
                    width: "0.269"
                    height: "0.1"
                    marginTop: "0px"
                    marginLeft: "0px"
                    backgroundColor: "#e4f5e9"
                    borderRadius: "10px 10px 0px 0px"
                    overflow: "hidden"
                    textAlign:
                      x: "center"
                      y: "center"
                  children:
                    - type: image
                      path: visitHistory.svg
                      style:
                        height: "0.1"
                - type: label
                  text: "Visit History"
                  dataKey:
                  style:
                    width: "0.269"
                    height: "0.04778"

                    fontSize: .Nfont.h14
                    # fontWeight: "500"
                    textAlign:
                      x: "center"
                      y: "center"
        - type: view
          style:
            width: "1"
            height: "0.138"
          children:
            - type: view
              style:
                width: "0.2586"
                height: "0.118"
                marginTop: "0px"
                marginLeft: "0.08"
                backgroundColor: "0xfff4e0"
                boxShadow: "1px 2px 2.5px 1px #e2e9ef"
                borderRadius: "10px"
                display: "inline-block"
              onClick:
                - goto: MedicalRecords
              children:
                - type: view
                  style:
                    width: "0.2586"
                    height: "0.065"
                    textAlign:
                      x: "center"
                      y: "center"
                  children:
                    - type: image
                      path: medicalDocuments.svg
                      style:
                        width: "0.08728"
                - type: label
                  text: "Medical Documents"
                  dataKey:
                  style:
                    fontSize: .Nfont.h12
                    width: "0.2586"
                    height: "0.053"
                    textAlign:
                      x: center
                      y: center
            - type: view
              style:
                width: "0.2586"
                height: "0.118"
                marginTop: "0px"
                marginLeft: "0.032"
                backgroundColor: "0xe4f5e9"
                boxShadow: "1px 2px 2.5px 1px #e2e9ef"
                borderRadius: "10px"
                display: "inline-block"
              onClick:
                - goto: MyConnection
              children:
                - type: view
                  style:
                    width: "0.2586"
                    height: "0.065"
                    marginLeft: "0px"
                    marginTop: "0px"
                    textAlign:
                      x: "center"
                      y: "center"
                  children:
                    - type: image
                      path: myHeart.svg
                      style:
                        width: "0.08728"
                    - type: label
                      dataKey: Global.newProviderLength
                      style:
                        zIndex: "300"
                        width: "5vw"
                        height: "5vw"
                        fontSize: 1vh
                        backgroundColor: "#ff3a41"
                        isHidden: ..connectionHidden
                        top: "0.001"
                        left: "0.14"
                        border:
                          style: "1"
                        borderRadius: "50"
                        color: "0xffffff"
                        textAlign:
                          x: "center"
                          y: "center"
                - type: label
                  text: "My Health Network"
                  dataKey:
                  style:
                    fontSize: .Nfont.h12
                    marginLeft: "0.0493"
                    width: "0.16"
                    height: "0.053"
                    textAlign:
                      x: "center"
                      y: "center"
            - type: view
              style:
                width: "0.2586"
                height: "0.118"
                marginTop: "0px"
                marginLeft: "0.032"
                backgroundColor: "#def1ff"
                boxShadow: "1px 2px 2.5px 1px #e2e9ef"
                borderRadius: "10px"
                display: "inline-block"
              onClick:
                - actionType: evalObject
                  object:
                    - .Global.vitalsInAppointment@: "false"
                - goto: VitalSigns
              children:
                - type: view
                  style:
                    width: "0.2586"
                    height: "0.065"
                    marginLeft: "0px"
                    marginTop: "0px"
                    textAlign:
                      x: "center"
                      y: "center"
                  children:
                    - type: image
                      path: remoteHealth.svg
                      style:
                        width: "0.08728"
                - type: label
                  text: "Remote Health"
                  dataKey:
                  style:
                    width: "0.16"
                    height: "0.053"
                    marginLeft: "0.0493"

                    fontSize: .Nfont.h12
                    textAlign:
                      x: "center"
                      y: "center"
    # footer
    - .footerBox:
      style:
        top: "0.9"
      children:
        - .footerMenuBox:
          onClick:
            - goto: PatientDashboard
          children:
            - type: image
              path: homeY.svg
              style:
                width: "8vw"
                height: "8vw"
                marginTop: "0.016"
            - type: label
              text: Home
              dataKey:
              style:
                width: "0.333"
                height: "auto"
                fontSize: .Nfont.h14
                color: "0xfece55"
                marginTop: "0.006"
                fontWeight: 600
                textAlign:
                  x: "center"
        - .footerMenuBox:
          style:
            marginLeft: "0.005"
          onClick:
            - goto: InboxDashboard
          children:
            - type: image
              path: inboxW.svg
              style:
                width: "8vw"
                height: "8vw"
                marginTop: "0.016"
            - type: label
              text: Inbox
              dataKey:
              style:
                width: "0.333"
                height: "auto"
                fontSize: .Nfont.h14
                color: "0xffffff"
                marginTop: "0.006"
                fontWeight: 400
                textAlign:
                  x: "center"
            - .numberMark:
              dataKey: formData.unReadEmailNum
              style:
                isHidden: ..formData.inboxHidden
                top: "0.01"
                left: "0.185"
        - .footerMenuBox:
          style:
            marginLeft: "0.005"
          onClick:
            - goto: MenuBars
          children:
            - type: image
              path: meW.svg
              style:
                width: "8vw"
                height: "8vw"
                marginTop: "0.016"
            - type: label
              text: Me
              dataKey:
              style:
                width: "0.33"
                height: "auto"
                fontSize: .Nfont.h14
                color: "0xffffff"
                marginTop: "0.006"
                fontWeight: 400
                textAlign:
                  x: "center"
    # 提示用户更新profile弹框
    - type: view
      viewTag: updateProfileView
      updateButton:
        - actionType: evalObject
          object:
            - .Global.editProfile@: false
        - goto: UploadIdentification
      style:
        isHidden: .Global.nonFirstProfile
        top: "0"
        left: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
        zIndex: "50"
        textAlign:
          y: center
          x: center
      # 安卓需要这个onClick去消耗点击事件,避免点击到这个视图下面的控价
      onClick:
      children:
        - type: view
          style:
            width: "0.72"
            height: "auto"
            borderRadius: "8"

            backgroundColor: "0xe4e5e6"
            box-sizing: border-box
            overflow: hidden
            textAlign:
              x: center
          children:
            - type: view
              style:
                marginTop: "0.0295"
                width: "auto"
                height: auto
                box-sizing: border-box
              children:
                - type: label
                  text: Complete Patient Information
                  style:
                    width: "auto"
                    fontSize: .Nfont.h16

                    fontWeight: "350"
                    fontColor: "0x333333"
                    box-sizing: border-box
            - type: view
              style:
                width: "0.72"
                height: auto
                box-sizing: border-box
              children:
                - type: label
                  text: To See Doctors
                  style:
                    display: "inline-block"
                    fontSize: .Nfont.h16
                    width: "0.72"
                    color: "0x333333"
                    fontWeight: "350"

                    box-sizing: border-box
                    verticalAlign: middle
                    textAlign:
                      x: center
            - type: view
              style:
                height: "0.0295"
                width: "0.72"
                border:
                  style: "2"
                borderWidth: "1"
                borderColor: "0xa9a9aa"
                box-sizing: border-box
            - type: button
              text: OK
              style:
                color: "0x2988E6"
                width: "0.72"

                fontSize: ".Nfont.h16"
                height: "0.054"
                fontColor: "0x333333"
                fontWeight: "600"
                backgroundColor: "0xe4e5e6"
                box-sizing: border-box
                border:
                  style: "1"
              onClick: ___.updateButton
    # 右上角按钮点击后出现的弹框
    - type: view
      viewTag: Showcontent
      style:
        top: "0.088"
        left: "0.4"
        width: "auto"
        borderWidth: "1"
        borderRadius: "5"
        borderColor: "0xdedede"
        backgroundColor: "0xffffff"
        border:
          style: 3
        display: ..formData.switchFlag
        zIndex: 200
      children:
        - type: list
          scrollable: "false"
          viewTag: Showcontent
          contentType: listObject
          listObject: ..formDataTemp.switchList
          iteratorVar: itemObject
          style:
            width: "auto"
            marginTop: "0"
            height: "auto"
            boxSizing: "border-box"
            borderRadius: "5"
            backgroundColor: "0xffffff"

            border:
              style: 1
            overflow: hidden
          children:
            - type: listItem
              itemObject:
              style:
                width: "auto"
                height: "0.054"
                left: "0"
                marginTop: "0"
                borderWidth: "1px"
                borderColor: "0xf0f0f0"
                boxSizing: "border-box"
                border:
                  style: 2
                overflow: hidden
              children:
                - type: view
                  style:
                    width: "auto"
                    height: "0.054"
                    textAlign:
                      y: center
                  children:
                    - type: view
                      style:
                        height: "auto"
                        width: "auto"
                      children:
                        - type: image
                          path: itemObject.path
                          style:
                            marginLeft: "0.0426"
                            display: "inline-block"
                            verticalAlign: middle
                            height: "0.0295"
                        - type: label
                          dataKey: itemObject.key
                          style:
                            marginLeft: "0.0213"
                            marginRight: "0.064"
                            display: "inline-block"
                            width: "auto"
                            height: "auto"
                            wordWrap: break-word
                            verticalAlign: middle
                            fontSize: .Nfont.h14
                            color: "0x333333"
              onClick:
                - emit:
                    dataKey:
                      var: itemObject
                    actions:
                      - if:
                          - =.builtIn.string.equal:
                              dataIn:
                                string1: $var.key
                                string2: "Scan"
                          - actionType: evalObject
                            object:
                              - actionType: scanCamera
                                dataKey: PatientDashboard.scan.document.name.data
                              - actionType: evalObject
                                object:
                                  - .Global.roomInfo.edge.providerId@: =..scan.document.name.data.id
                                  - .Global.roomInfo.edge.providerInfo@: ""
                                  - =..apiRequest.getProviderPublicProfile.docApi.get: ""
                                  - .Global.roomInfo.edge.providerInfo@: =..apiRequest.getProviderPublicProfile.resp.doc.0
                                  - .Global.temporaryId@: =.Global.roomInfo.edge.providerInfo
                          - continue
                - emit:
                    dataKey:
                      var: itemObject
                    actions:
                      - goto: $var.pageName
    - type: popUp
      viewTag: Call911
      choice1Button:
        - actionType: call
          telephone: "911"
      choice2Button:
        - actionType: popUpDismiss
          popUpView: Call911
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
        zIndex: "301"
      children:
        - type: view
          style:
            marginTop: "0.77"
            width: "0.9"
            height: "auto"
            marginLeft: "0.05"
            border:
              style: "1"
            borderRadius: "10"
            backgroundColor: "0xf3f4f5"
          children:
            - type: button
              text: Call 911
              style:
                marginTop: "0.001"
                width: "0.9"
                height: "0.055"
                fontSize: .Nfont.h3
                color: "0x1d88fc"
                borderRadius: "10"
                backgroundColor: "0xf3f4f5"
                textAlign:
                  x: center
                border:
                  style: "1"
              onClick: ___.choice1Button
        - type: view
          style:
            marginTop: "0.01"
            width: "0.9"
            height: "auto"
            marginLeft: "0.05"
            border:
              style: "1"
            borderRadius: "10"
            backgroundColor: "0xf3f4f5"
          children:
            - type: button
              text: Cancel
              style:
                marginTop: "0.001"
                fontWeight: "600"
                width: "0.9"
                height: "0.055"
                fontSize: .Nfont.h3
                color: "0x1d88fc"
                borderRadius: "10"
                backgroundColor: "0xf3f4f5"
                textAlign:
                  x: center
                border:
                  style: "1"
              onClick: ___.choice2Button
    - .Normal:
      viewTag: emergency
      message: "Is this an emergency?"
      leftText: "Yes"
      rightText: "No"
      leftButton:
        - actionType: popUpDismiss
          popUpView: emergency
        - actionType: popUp
          popUpView: Call911
      rightButton:
        - actionType: popUpDismiss
          popUpView: emergency
        - goto: AppointmentSearch
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
        zIndex: "301"
        textAlign:
          y: center
      children:
        - type: view
          style:
            width: "0.7"
            marginLeft: "0.15"
            backgroundColor: "0xE6E6E6"
            borderRadius: "14px"
            overflow: hidden
            textAlign:
              x: center
          children:
            - type: label
              text: ___.message
              style:
                width: "0.576"
                marginLeft: "0.062"
                marginTop: "0.027"
                fontSize: .Nfont.h14

                textAlign:
                  x: center
                color: "0x333333"
            - type: view
              style:
                height: "0.027"
                width: "0.7"
                border:
                  style: 2
                  color: "0x919192"
                borderWidth: "1"
            - type: view
              style:
                width: "0.7"
                boxSizing: border-box
              children:
                - type: button
                  text: "Yes"
                  style:
                    color: "0x007AFF"
                    backgroundColor: "0xE6E6E6"
                    display: inline-block
                    width: "0.349"
                    borderRadius: "0 0 0 14px"
                    fontSize: .Nfont.h14
                    height: "0.054"
                    border:
                      style: "1"
                  onClick: ____.leftButton
                - type: view
                  style:
                    width: "0.002"
                    backgroundColor: "0x919192"
                    display: inline-block
                    height: "0.054"
                    zIndex: "50"
                - type: button
                  text: "No"
                  style:
                    color: "0x007AFF"
                    fontWeight: "850"
                    backgroundColor: "0xE6E6E6"
                    display: inline-block
                    width: "0.349"
                    fontSize: .Nfont.h14
                    borderRadius: "0 0 14px 0"
                    height: "0.054"
                    border:
                      style: "1"
                  onClick: ____.rightButton
  event:
    # 初始化hashtag
    initCreateHashTag:
      # 初始化hashtag的hashtime
      - =.builtIn.date.currentDateTime:
          dataIn:
          dataOut: PatientDashboard.apiRequest.hashTag.docCreateReq.name.data.hashTime
      # 初始化hashtag的hashcode
      - =.builtIn.utils.gethashCode:
          dataIn:
            hashFields: =..apiRequest.hashTag.docCreateReq.name.data.hashFields
          dataOut: PatientDashboard.apiRequest.hashTag.docCreateReq.name.data.hashCode
      # 将hashtag的reid指向新创建的profile
      - ..apiRequest.hashTag.docCreateReq.reid@: =..profile.createDocResp.doc.id
      # 保存hashtag
      - =..apiRequest.hashTag.docAPI.store: ""
      # 将hashtag保存到Global中以便后续减少请求
      - .Global.formData.hashTag@: =..apiRequest.hashTag.docCreateResp.doc
      - .Global.Profile@: =..profile.createDocResp.doc
    # 展开右上角的选项
    showMoreOptions:
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..formData.switchFlag
                    string2: "none"
              - ..formData.switchFlag@: "block"
              - ..formData.switchFlag@: "none"
      - actionType: builtIn
        funcName: redraw
        viewTag: Showcontent

    # 通过upcoming appointment进入会议详情
    enterDetailFromUpcomingAppointment:
      - actionType: evalObject
        object:
          # 设置admin更改patient profile弹框可见
          - .Global.formData.meetingStatus.cancelUpdateInMeeting@: false
          # 根据17位是否为1来判断是telemedicine还是office visit(含room类型)
          - if:
              - =.builtIn.number.typeIsValid:
                  dataIn:
                    docType: =.Global.roomInfo.edge.subtype
                    localArr: [17]
                    binaryArr: [1]
              - goto: AppointmentLobby
              - goto: AppointmentLobbyOfficeVisit
