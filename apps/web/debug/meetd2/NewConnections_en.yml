NewConnections:
  title: "New Connections"
  init:
    - .SignInCheck    
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - ..invite.edgeAPI.get
    - if:
      - =..invite.inviteList.edge.0
      - continue
      - =.builtIn.checkField:
          dataIn:
            contentType: messageHidden
            wait: 100         
  invite:
    inviteList: 
      edge: ""
    edgeReq:
      type: .EdgeType.InviteInfo
      xfname: evid
      id: .Global.currentUser.vertex.id
      maxcount: "10000"
      _nonce: =.Global._nonce
      obfname: ctime
      sCondition: "subtype=9 AND tage=0"
    edgeAPI:
      get:
        api: re
        dataIn: NewConnections.invite.edgeReq
        dataOut: NewConnections.invite.inviteList
      delete: 
        api: dx
        dataIn: NewConnections.dataObject
  dataObject: ""   
  accept:
    edge:
      .Edge: ""
      type: .EdgeType.Accept
      bvid: .Global.currentUser.vertex.id
      name: ""
    edgeAPI: 
      store:
        api: ce
        dataIn: accept.edge
  refuse:
    edge:
      .Edge: ""
      type: .EdgeType.Refuse
      bvid: .Global.currentUser.vertex.id
      name: ""
    edgeAPI:
      store:
        api: ce
        dataIn: refuse.edge
  components:
    - .BaseHeader:
    - .HeaderLeftButton:
    - type: view
      viewTag: inviteTag
      style: 
        left: "0"
        top: "0.1"
        width: "1"
        height: "0.9"
        backgroundColor: "#ffffff"
      children:
        - .BaseList:
          listObject: ..invite.inviteList.edge
          style: 
            left: "0"
            # top: "0"
            width: "1"
            height: "0.88"
            zIndex: "100"
            margin: "0"
          children:
            - .BaseListItem:
              style:
                height: "0.08"
                width: "1"
                backgroundColor: "0xFFFFFF"
                border: 
                  style: "2"
                borderWidth: "1"
                borderColor: "0xf0f0f0"
              children:
                - type: label
                  dataKey: itemObject.name.inviterName
                  style:
                    top: "0"
                    left: "0.06"
                    width: "0.5"
                    height: "0.08"
                    fontSize: "18"
                    color: "#6e6e6e"
                    textAlign:
                      x: center
                      y: center
                - type: button
                  text: "Accept"
                  onClick: 
                    - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                      dataKey: NewConnections.dataObject
                      dataObject: itemObject        
                    - emit:
                        dataKey:
                          var: itemObject
                        actions: 
                          - ..accept.edge.evid@: $var.bvid
                          - ..accept.edge.name@: $var.name
                          - ..accept.edge.refid@: $var.id
                          - =..accept.edgeAPI.store: ""
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: builtIn
                      funcName: goBack
                      reload: true
                  style:
                    top: "0.025"
                    left: "0.6"
                    width: "0.18"
                    height: "0.03"
                    fontSize: "15"
                    color: "#ffffff"
                    backgroundColor: "#1dc160"
                    borderRadius: "5"
                    textAlign:
                      x: center
                - type: button
                  text: "Deny"
                  onClick: 
                    - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                      dataKey: NewConnections.dataObject
                      dataObject: itemObject       
                    - emit: 
                        dataKey:
                          var: itemObject
                        actions:
                          - ..refuse.edge.evid@: $var.bvid
                          - ..refuse.edge.name@: $var.name
                          - ..refuse.edge.refid@: $var.id
                          - =..refuse.edgeAPI.store: ""
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: inviteTag
                    - actionType: evalObject
                      object:
                        - =.builtIn.goto:
                            dataIn:
                              destination: 'NewConnections'
                              pageReload: true
                        - if:
                          - =..invite.inviteList.edge.0
                          - continue
                          - =.builtIn.checkField:
                              dataIn:
                                contentType: messageHidden
                                wait: 100 
                  style:
                    top: "0.025"
                    left: "0.8"
                    width: "0.18"
                    height: "0.03"
                    fontSize: "15"
                    color: "#ffffff"
                    backgroundColor: "#DC143C"
                    borderRadius: "5"
                    textAlign:
                      x: center
    - type: view
      contentType: messageHidden
      style:
        top: "0.1"
        left: "0"
        height: "0.9"
        width: "1"
        zIndex: "11"
        isHidden: "true"
        backgroundColor: '0xffffff'
      children: 
        - type: label
          text: "No New Connections"
          style:
            # left: "0.31"
            top: "0.25"
            width: "1"
            height: "0.04"
            color: "0x000058"
            fontSize: "18"
            textAlign:
              x: center                      