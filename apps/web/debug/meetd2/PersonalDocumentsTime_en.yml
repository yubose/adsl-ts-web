PersonalDocumentsTime:
  title: "My Documents"
  pageNumber: "90"
  init:
    #  get today date (get month --> get year ---> get day ) ---> get stamp of this date ---> sCondition ---> ce
    #  cache
    - actionType: evalObject
      object: 
        .Global._nonce@: 
          =.builtIn.math.random: ""
    - ..listData.get 
    # - if:
    #   - ..listData.WaitingInRoom.edge
    #   - continue
    #   - =.builtIn.checkField:
    #       dataIn:
    #         contentType: messageHidden
    #         wait: 100        
    # get month for calendar
    - actionType: evalObject
      object:
        .PersonalDocumentsTime.calendarDate.month@:
          =.builtIn.date.getMonth: ""
    # get Year for calendar
    - actionType: evalObject
      object:
        .PersonalDocumentsTime.calendarDate.year@:
          =.builtIn.date.getYear: ""
    - actionType: evalObject
      object:
        .PersonalDocumentsTime.calendarDate.day@:
          =.builtIn.date.getDate: ""
    # generate calendar according month and year
    - actionType: evalObject
      object:
        - =.builtIn.date.ShowDateByNumber:
            dataIn:
              year: =..calendarDate.year
              month: =..calendarDate.month
              day: =..calendarDate.day
            dataOut: PersonalDocumentsTime.selectDate
    - actionType: evalObject
      object:
        - =.builtIn.date.transformMonth:
            dataIn:
              month: =..calendarDate.month
            dataOut: PersonalDocumentsTime.calendarDate.monthName
    - actionType: evalObject
      object:
        - =.builtIn.date.miniWeeklyCalendarArray:
            dataIn:
              year: =..calendarDate.year
              month: =..calendarDate.month
              today: =..calendarDate.day
              markDay: =..calendarDate.day
              color: "0x000000"
              backgroundColor: "0x2988E6"
              todayColor: "0xffffff"
              todayBackgroundColor: "0xFFFFFF6f"
            dataOut: PersonalDocumentsTime.calendarDate.dayLable
    - actionType: evalObject
      object:
        - =.builtIn.string.concat:
              dataIn:
                - =..calendarDate.year
                - "-"
                - =..calendarDate.month
                - "-"
                - =..calendarDate.day
              dataOut: PersonalDocumentsTime.calendarDate.todayDate
    - actionType: evalObject
      object:
        - =.builtIn.date.getTimeStampOfDate:
              dataIn: 
                date: =..calendarDate.todayDate
              dataOut: PersonalDocumentsTime.calendarDate.todayStamp
    - actionType: evalObject
      object:
        - =.builtIn.string.concat:
              dataIn:
                - "stime>"
                - =..calendarDate.todayStamp.start
                - " AND "
                - "etime<"
                - =..calendarDate.todayStamp.end
                - " AND "
                - "subtype in (196609,5)"
              dataOut: Global.scheduleScondition
    - actionType: evalObject
      object:
        - ..schedule.scheduleList.edge@: []
    - ..scheduleSetting.get 
    - if:
      - =.PersonalDocumentsTime.scheduleSetting.schedule.edge
      - ..schedule.get
      - continue
    - actionType: evalObject
      object:
        =.builtIn.array.getListLength:
            dataIn:
              object: =..requestList.requestData.edge
            dataOut: PersonalDocumentsTime.patientNumber
    - actionType: evalObject
      object:
        .Global.scheduleId@: =.PersonalDocumentsTime.scheduleSetting.schedule.edge.0.id
    - actionType: evalObject
      object:
        - =.builtIn.date.AddHeightByTimeSpan:
            dataIn:
              object: =..schedule.scheduleList.edge
            dataOut: PersonalDocumentsTime.formData.response
    - ..requestList.get
    - actionType: evalObject
      object:
        =.builtIn.array.getListLength:
            dataIn:
              object: =..requestList.requestData.edge
            dataOut: PersonalDocumentsTime.requestListNum
    - if:
      - =.builtIn.string.equal:
          dataIn:
            string1: =..requestListNum
            string2: "0"
      - ..requestListHidden@: true
      - ..requestListHidden@: false

  selectDate: ""
  timeSlot: 60
  splitTime: []
  patientNumber: "0"
  requestListNum: "0"
  requestListHidden: "true"
  requestList:
    requestData:
      edge: ""
    get:
      .EdgeAPI.get: ""
      api: re
      dataKey: requestList.requestData
      type: 40000
      id: .Global.currentUser.vertex.id
      maxcount: "10000"
      xfname: "evid"
      obfname: "ctime"
      # subtype: "2"
      sCondition: "subtype=2"
      asc: false
      _nonce: =.Global._nonce

# get subtype=3 edge
  scheduleSetting:
    response: ""
    schedule:
      edge: ""
    get:
      .EdgeAPI.get: ""
      api: re
      dataKey: scheduleSetting.schedule
      type: 40000
      id: .Global.currentUser.vertex.id
      sCondition: "subtype=65535"
      xfname: "bvid"
      maxcount: "1"
      obfname : "ctime"
      _nonce: =.Global._nonce
  resetData:
    - name:
        title: "today dont have appoinment"
# get all edge include available (subtype=1) accepted(subtype=5)
  schedule:
    scheduleList:
      edge:
    get:
      .EdgeAPI.get: ""
      api: re
      dataIn: schedule.edge
      dataOut: schedule.scheduleList
    edge:
      type: 40000
      id: .Global.currentUser.vertex.id
      sCondition: "=.Global.scheduleScondition"
      maxcount: "10000"
      xfname: "bvid | evid"
      obfname: "etime"
      asc: true
      _nonce: '=.Global._nonce'
  listData: 
    WaitingInRoom:
      edge: "" 
    get:
      .EdgeAPI.get: ""
      api: re
      dataKey: listData.WaitingInRoom
      type: .EdgeType.WaitingRoom
      id: .Global.currentUser.vertex.id
      # 0--> one people in meeting, 6--> agree request , but no one in meeting
      sCondition: "subtype in (6,100) AND tage=0"
      xfname: "evid|bvid"
      maxcount: "1000"
      obfname : "mtime"
      _nonce: =.Global._nonce    
  ListReGet:
    WaitingInRoom:
      edge: "" 
    get:
      .EdgeAPI.get: ""
      api: re
      dataIn: ListReGet.edge
      dataOut: ListReGet.WaitingInRoom
    edge:
      type: .EdgeType.WaitingRoom
      id: .Global.currentUser.vertex.id
      # 0--> one people in meeting, 6--> agree request , but no one in meeting
      sCondition: "=.Global.WaitingSetting"
      xfname: "evid|bvid"
      maxcount: "1000"
      obfname : "mtime"
      _nonce: =.Global._nonce 
    # scheduleList:
    #   edge:
    # get:
    #   .EdgeAPI.get: ""
    #   api: re
    #   dataIn: ListReGet.edge
    #   dataOut: ListReGet.scheduleList
    # edge:
    #   type: 40000
    #   id: .Global.currentUser.vertex.id
    #   sCondition: "=.Global.scheduleScondition"
    #   maxcount: "10000"
    #   xfname: "bvid | evid"
    #   obfname: "etime"
    #   asc: true
    #   _nonce: '=.Global._nonce'
  todaySchedule: ""
  formData:
    response: []
  calendarDate:
    month: ""
    year:  ""
    day: ""
    dayLable: []
    weekLabel:
      - key: SU
      - key: MO
      - key: TU
      - key: WE
      - key: TH
      - key: FR
      - key: SA
    todayDate: "YYYY-MM-DD"
    calendarDate: 
    Scondition: ""
    flag: false
  components: 
    - type: view
      style:
        marginTop: "0"
        width: "1"
        height: "0.1"
      children:
        - .BaseHeader:
        - .HeaderLeftButton:
        - .HeaderRightImg:
          onClick:
            - actionType: evalObject
              object:
                - if: 
                  - ..flag
                  - actionType: evalObject
                    object:
                      - actionType: builtIn
                        funcName: hide
                        viewTag: setSchedule
                      - ..flag@: false
                  - actionType: evalObject
                    object:
                      - actionType: builtIn
                        funcName: show
                        viewTag: setSchedule
                      - ..flag@: true                  
          path: calendar.png
    # - type: view
    #   viewTag: test
    #   style:
    #     isHidden: true
    #     top: "0.28"
    #     width: "1"
    #     left: "0"
    #     height: "0.1"
    #     backgroundColor: "0x000000"
    - type: view
      viewTag: setSchedule
      style:
        width: "1"
        height: "0.18"
        backgroundColor: "0x2988E6"
        marginTop: '0'
        isHidden: true
        display: none
        left: "0"
      children:
        - type: view
          style:
            left: "0.25"
            width: "0.18"
            height: "0.03"
          children:
            - type: image
              path: iconOutlineArrowLeft.png
              onClick:
                - emit:
                    actions:
                      - =.builtIn.date.loopMonth:
                          dataIn:
                            month: =..calendarDate.month
                            step: -1
                          dataOut: PersonalDocumentsTime.calendarDate.month
                      - =.builtIn.date.transformMonth:
                          dataIn:
                            month: =..calendarDate.month
                          dataOut: PersonalDocumentsTime.calendarDate.monthName
                      - =.builtIn.date.miniWeeklyCalendarArray:
                          dataIn:
                            year: =..calendarDate.year
                            month: =..calendarDate.month
                            today: 33
                            markDay: 1
                            color: "0x000000"
                            backgroundColor: "0x2988E6"
                            todayColor: "0xffffff"
                            todayBackgroundColor: "0xFFFFFF6f"
                          dataOut: PersonalDocumentsTime.calendarDate.dayLable
                - actionType: builtIn
                  funcName: redraw
                  viewTag: setSchedule
              style:
                height: "0.02"
                top: "0.005"
            - type: label
              dataKey: calendarDate.monthName
              style:
                width: "0.05"
                height: "0.02"
                left: "0.07"
                fontSize: "18"
                color: "0xffffff"
                textAlign:
                  x: center
            - type: image
              path: iconOutlineArrowRight.png
              onClick:
                - emit:
                    actions:
                      - =.builtIn.date.loopMonth:
                          dataIn:
                            month: =..calendarDate.month
                            step: 1
                          dataOut: PersonalDocumentsTime.calendarDate.month
                      - =.builtIn.date.transformMonth:
                          dataIn:
                            month: =..calendarDate.month
                          dataOut: PersonalDocumentsTime.calendarDate.monthName
                      - =.builtIn.date.miniWeeklyCalendarArray:
                          dataIn:
                            year: =..calendarDate.year
                            month: =..calendarDate.month
                            today: 33
                            markDay: 1
                            color: "0x000000"
                            backgroundColor: "0x2988E6"
                            todayColor: "0xffffff"
                            todayBackgroundColor: "0xFFFFFF6f"
                          dataOut: PersonalDocumentsTime.calendarDate.dayLable             
                - actionType: builtIn
                  funcName: redraw
                  viewTag: setSchedule
              style:
                left: "0.16"
                height: "0.02"
                top: "0.005"
        - type: view
          style:
            top: "0"
            left: "0.5"
            width: "0.4"
            height: "0.03"
          children:
            - type: image
              path: iconOutlineArrowLeft.png
              onClick:
                - emit:
                    actions:
                      - =.builtIn.number.Subtraction:
                          dataIn:
                            num: =..calendarDate.year
                            step: 1
                          dataOut: PersonalDocumentsTime.calendarDate.year
                      - =.builtIn.date.miniWeeklyCalendarArray:
                          dataIn:
                            year: =..calendarDate.year
                            month: 1
                            today: 33
                            markDay: 1
                            color: "0x000000"
                            backgroundColor: "0x2988E6"
                            todayColor: "0xffffff"
                            todayBackgroundColor: "0xFFFFFF6f"
                          dataOut: PersonalDocumentsTime.calendarDate.dayLable
                - actionType: evalObject
                  object: 
                    - .PersonalDocumentsTime.calendarDate.month@: 1
                - actionType: evalObject
                  object:
                    - =.builtIn.date.transformMonth:
                        dataIn:
                          month: =..calendarDate.month
                        dataOut: PersonalDocumentsTime.calendarDate.monthName
                - actionType: builtIn
                  funcName: redraw
                  viewTag: setSchedule
                
              style:
                left: "0"
                height: "0.02"
                top: "0.005"
            - type: label
              dataKey: calendarDate.year
              style:
                width: "0.05"
                height: "0.03"
                top: "0"
                left: "0.08"
                fontSize: "18"
                color: "0xffffff"
                textAlign:
                  x: center
            - type: image
              path: iconOutlineArrowRight.png
              onClick:
                - emit:
                    actions:
                      - =.builtIn.number.addition:
                          dataIn:
                            num: =..calendarDate.year
                            step: 1
                          dataOut: PersonalDocumentsTime.calendarDate.year
                      - =.builtIn.date.miniWeeklyCalendarArray:
                          dataIn:
                            year: =..calendarDate.year
                            month: 1
                            today: 33
                            markDay: 1
                            color: "0x000000"
                            backgroundColor: "0x2988E6"
                            todayColor: "0xffffff"
                            todayBackgroundColor: "0xFFFFFF6f"
                          dataOut: PersonalDocumentsTime.calendarDate.dayLable
                - actionType: evalObject
                  object: 
                    .PersonalDocumentsTime.calendarDate.month@: 1
                - actionType: evalObject
                  object:
                    - =.builtIn.date.transformMonth:
                        dataIn:
                          month: =..calendarDate.month
                        dataOut: PersonalDocumentsTime.calendarDate.monthName
                - actionType: builtIn
                  funcName: redraw
                  viewTag: setSchedule
              style:
                left: "0.2"
                height: "0.02"
                top: "0.005"
        - type: view
          style:
            top: "0"
            width: "0.08"
            height: "0.08"
          children:
            - type: image
              path: iconOutlineArrowLeft.png
              onClick:
                - emit:
                    actions:
                        - =.builtIn.date.LastWeek:
                            dataIn:
                              year: =..calendarDate.dayLable.0.year
                              month: =..calendarDate.dayLable.0.month
                              day: =..calendarDate.dayLable.0.day
                            dataOut: calendarDate.tempDate
                        - =.builtIn.date.miniWeeklyCalendarArray:
                            dataIn:
                              year: =..calendarDate.tempDate.year
                              month: =..calendarDate.tempDate.month
                              today: =..calendarDate.day
                              markDay: =..calendarDate.tempDate.day
                              color: "0x000000"
                              backgroundColor: "0x2988E6"
                              todayColor: "0xffffff"
                              todayBackgroundColor: "0xFFFFFF6f"
                            dataOut: PersonalDocumentsTime.calendarDate.dayLable
                - actionType: evalObject
                  object:
                    - ..calendarDate.year@: =..calendarDate.tempDate.year
                    - ..calendarDate.month@: =..calendarDate.tempDate.month
                    - =.builtIn.date.transformMonth:
                        dataIn:
                          month: =..calendarDate.month
                        dataOut: PersonalDocumentsTime.calendarDate.monthName
                - actionType: builtIn
                  funcName: redraw
                  viewTag: setSchedule
              style:
                top: "0.07"
                height: "0.02"
        - type: list
          contentType: listObject
          listObject: ..calendarDate.dayLable
          iteratorVar: itemObject
          viewTag: calendarColor
          style:
            top: "0.03"
            left: "0.08"
            width: "0.84"
            display: "flex"
            height: "100px"
            justifyContent: "space-between"
          children:
            - type: listItem
              itemObject: ""
              onClick:
                - emit:
                    dataKey:
                      var: itemObject
                    actions: 
                      # - ..formData.response@: []
                      - =.builtIn.date.miniWeeklyCalendarArray:
                          dataIn:
                            year: $var.year
                            month: $var.month
                            today: $var.day
                            markDay: $var.day
                            color: "0x000000"
                            backgroundColor: "0x2988E6"
                            todayColor: "0xffffff"
                            todayBackgroundColor: "0xFFFFFF6f"
                          dataOut: PersonalDocumentsTime.calendarDate.dayLable
                      # - .PersonalDocumentsTime.formData.response@: []
                      - .PersonalDocumentsTime.listData.WaitingInRoom.edge@: []
                      - ..calendarDate.year@: $var.year
                      - ..calendarDate.month@: $var.month
                      - ..calendarDate.day@: $var.day
                      - =.builtIn.date.ShowDateByNumber:
                            dataIn:
                              year: =..calendarDate.year
                              month: =..calendarDate.month
                              day: =..calendarDate.day
                            dataOut: PersonalDocumentsTime.selectDate
                      - =.builtIn.date.transformMonth:
                          dataIn:
                            month: =..calendarDate.month
                          dataOut: PersonalDocumentsTime.calendarDate.monthName
                      - =.builtIn.string.concat:
                          dataIn:
                            - =..calendarDate.year
                            - "-"
                            - =..calendarDate.month
                            - "-"
                            - $var.day
                          dataOut: PersonalDocumentsTime.calendarDate.todayDate
                      - =.builtIn.date.getTimeStampOfDate:
                          dataIn:
                            date: =..calendarDate.todayDate
                          dataOut: PersonalDocumentsTime.calendarDate.todayStamp
                      # get subtype=1 or subtype=5   userId = evid | bvid
                      - =.builtIn.string.concat:
                            dataIn:
                              - "stime>"
                              - =..calendarDate.todayStamp.start
                              - " AND "
                              - "etime<"
                              - =..calendarDate.todayStamp.end
                              - " AND "
                              - "subtype in (6,100) AND tage=0"
                            # dataOut: PersonalDocumentsTime.calendarDate.Scondition   
                            dataOut: Global.WaitingSetting
                - actionType: evalObject
                  object:
                    - .PersonalDocumentsTime.listData.WaitingInRoom.edge@: []                    
                - actionType: evalObject
                  object: 
                    .Global._nonce@: 
                      =.builtIn.math.random: ""
                
                - actionType: evalObject        #modify
                  object: 
                    - =..ListReGet.get: "" 
                - actionType: evalObject
                  object:
                    - =.builtIn.date.AddHeightByTimeSpan:
                        dataIn:
                          object: =..ListReGet.WaitingInRoom.edge
                        dataOut: PersonalDocumentsTime.listData.WaitingInRoom.edge
                - actionType: builtIn
                  funcName: redraw
                  viewTag: setSchedule
                - actionType: builtIn
                  funcName: redraw
                  viewTag: PatientList                                             
              style:
                width: "0.12"
                height: "0.08"
                boxSizing: "border-box"
                border: "none"
                padding: "0px"
                display: "inline-block"
                flex: "auto"
                # borderRadius: "21px" 
              children:
                - type: label
                  dataKey: itemObject.weekDay
                  style:
                    width: "0.1"
                    color: "0xffffff"
                    fontSize: "12px"
                    textAlign:
                      x: center
                    height: "0.04"
                    top: "0"
                - type: label
                  dataKey: itemObject.day
                  style:
                    width: "0.1"
                    color: "0xffffff"
                    backgroundColor: itemObject.backgroundColor
                    borderRadius: "50"
                    fontSize: "18px"
                    textAlign:
                      x: center
                    height: "30px"
                    lineHeight: "30px"
                    top: "0.04"
        - type: view
          style:
            top: "0"
            left: "0.92"
            width: "0.08"
            height: "0.08"
          children:
            - type: image
              path: iconOutlineArrowRight.png
              style:
                top: "0.07"
                height: "0.02"
              onClick:
                - emit:
                    actions:
                      - =.builtIn.date.NextWeek:
                            dataIn:
                              year: =..calendarDate.dayLable.6.year
                              month: =..calendarDate.dayLable.6.month
                              day: =..calendarDate.dayLable.6.day
                            dataOut: calendarDate.tempDate
                      - =.builtIn.date.miniWeeklyCalendarArray:
                          dataIn:
                            year: =..calendarDate.tempDate.year
                            month: =..calendarDate.tempDate.month
                            today: =..calendarDate.day
                            markDay: =..calendarDate.tempDate.day
                            color: "0x000000"
                            backgroundColor: "0x2988E6"
                            todayColor: "0xffffff"
                            todayBackgroundColor: "0xFFFFFF6f"
                          dataOut: PersonalDocumentsTime.calendarDate.dayLable
                - actionType: evalObject
                  object:
                    - ..calendarDate.year@: =..calendarDate.tempDate.year
                    - ..calendarDate.month@: =..calendarDate.tempDate.month
                    - =.builtIn.date.transformMonth:
                        dataIn:
                          month: =..calendarDate.month
                        dataOut: PersonalDocumentsTime.calendarDate.monthName
                - actionType: builtIn
                  funcName: redraw
                  viewTag: setSchedule
        - type: label
          dataKey: PersonalDocumentsTime.selectDate
          style:
            width: "1"
            top: "0.14"
            fontSize: "15"
            color: "0xffffff"
            fontWeight: "550"
            textAlign:
              x: center

    - type: view
      style:  
        width: "1"
        height: "0.72"
        marginTop: "0"
        left: "0" 
        backgroundColor: "0xffffff"           
      children:
        - type: view
          style:
            top: "0"
            # left: "0.05"
            width: "1"
            height: "0.08"
            backgroundColor: "0x2988e6"
          children:
            - .SearchField:
              placeholder: "Search"
              style:
                left: "0.04"
                top: "0.01"
                backgroundColor: "0xffffff"
                textAlign:
                  x: center
                  y: center 
            - type: image
              path: search3.png
              style:
                top: "0.02"
                left: "0.35"
                height: "0.025"
            - type: view
              style:
                top: "0.08"
                # left: "0.05"
                width: "1"
                height: "0.71"
                # backgroundColor: "#f0f0f0"
              children:
                # - type: label
                #   text: "February 12, 2021 Today"
                #   style:
                #     top: "0.01"
                #     left: "0.08"
                #     width: "1"
                #     height: "0.02"
                #     # backgroundColor: "0xF7F7F7" 
                #     fontSize: "14"
                #     fontWeight: 400
                #     color: "#4b4b4b"
                    # textAlign:
                    #   x: center
                - type: scrollView
                  viewTag: PatientList
                  style:
                    
                    top: "0.01"
                    # left: "0.05"
                    width: "1"
                    height: "0.62"
                    backgroundColor: "#ffffff"
                    overflow: scroll
                  children:
                    - type: list
                      # viewTag: PatientList
                      contentType: listObject
                      listObject: ..listData.WaitingInRoom.edge
                      iteratorVar: itemObject
                      style:
                        top: "-0.02"
                        left: "0"
                        width: "1"
                        height: "0.8"
                        # backgroundColor: "0x00000066"
                        boxShadow: "0px 0px 1px #dededf"
                      children:
                        - type: listItem
                          itemObject: ""
                          onClick: 
                            - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                              dataKey: Global.roomInfo.edge
                              dataObject: itemObject
                            - goto: AppointmentLobby
                          style:
                            left: "0"
                            width: "1"
                            height: "0.1"
                            border:
                              style: "2"
                            borderColor: "0x00000066"
                            borderWidth: "1"
                          children:
                            - type: label
                              text=func: .builtIn.date.ShowTimeSpanFormat
                              dataKey: itemObject
                              style:
                                top: "0.02"
                                fontSize: "14"
                                fontWeight: 350
                                left: "0.08"
                                color: itemObject.name.fontColor
                            - type: label
                              dataKey: itemObject.name.visitReason
                              style:
                                top: "0.055"
                                fontSize: "16"
                                fontWeight: 350
                                left: "0.08"
                            - type: label
                              dataKey: itemObject.name.Reason
                              style:
                                top: "0.055"
                                width: "0.4"
                                fontSize: "18"
                                fontWeight: 350
                                left: "0.56"
                                textAlign:
                                  x: right
                            - type: label
                              dataKey: itemObject.name.visitType
                              style:
                                style:
                                top: "0.02"
                                fontSize: "12"
                                fontWeight: 350
                                left: "0.56"
                                width: "0.4"
                                textAlign:
                                  x: right
                                color: itemObject.name.fontColor
