MeetingLobby:
  module: meetingroom
  pageNumber: "160_110" # xd page 11
  title: =.Global.rootRoomInfo.edge.name.title
  rootRoom:  # this must be a root room
    response: ""
    edge: 
      _nonce: =.Global._nonce
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: rootRoom.edge
        dataOut: rootRoom.response
  inviteesInfo:
    response: ""
    edge:
      .Edge: ""
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: inviteesInfo.edge
        dataOut: inviteesInfo.response
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .MeetingLobby.rootRoom.edge@: =.Global.rootRoomInfo.edge
    - ..listData.get
    - if: 
        - =.MeetingLobby.rootRoom.edge.name.title
        - continue
        - actionType: evalObject
          object:
            .MeetingLobby.rootRoom.edge.name.title@: "New Room"
    - if:
        - =..dataObject.refid
        - =.builtIn.hide:
            dataIn:
              viewTag: videoDuration
              wait: 0
        - =.builtIn.hide:
            dataIn:
              viewTag: videoTimer
              wait: 0
    - if:
        - =..dataObject.tage
        - =.builtIn.hide:
            dataIn:
              viewTag: closeRoom
              wait: 0
        - contiue
    - if:
        - =..dataObject.refid
        - =.builtIn.hide:
            dataIn:
              viewTag: closeRoom
              wait: 0
        - contiue
    - if:
        - =..dataObject.refid
        - =.builtIn.hide:
            dataIn:
              viewTag: enterRoom
              wait: 0
        - contiue                                        
    - actionType: evalObject
      object:
        =.builtIn.string.concat:
          dataIn:
            - =.Global.currentUser.vertex.name.firstName
            - " "
            - =.Global.currentUser.vertex.name.lastName
          dataOut: Global.currentUser.vertex.name.fullName      
  dataObject: .Global.rootRoomInfo.edge
  save:
    - ..rootRoom.edgeAPI.store
  listData: 
    response:
      edge:
        # - .Edge:
        #     name:
        #       firstName: "test"
        #       lastName: "1"
        # - .Edge:
        #     name:
        #       firstName: "test"
        #       lastName: "2"
    edge:
      .Edge: ""
      id: .Global.VideoChatObjStore.reference.edge.refid
      # id: .Global.rootRoomInfo.edge.id
      type : 1053
      xfname : refid
      maxcount : "20"
      sCondition: "tage!=-1 AND ctime>UNIX_TIMESTAMP()-7200 AND evid is not null"  
    get:
      .EdgeAPI.get : ""
      api: re
      dataIn: listData.edge
      dataOut: listData.response
      _nonce: =.Global._nonce
  components:
    - type: view
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
      children:
        - type: view
          style:
            left: "0"
            top: "0"
            width: "1"
            height: "0.24"
            backgroundColor: "0x388eccff"  
          children:
            - .BaseHeader3:
              viewTag: edittitle
            - .HeaderLeftButton4:
              onClick:
                - actionType: updateObject
                  dataKey: Global.rootRoomInfo.edge.name.title
                  dataObject: ..rootRoom.edge.name.title
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""                  
                - actionType: saveObject
                  object: ..save
                - actionType: builtIn
                  funcName: goBack
            - type: label
              text: Edit
              viewTag: edittitle
              style:
                left: "0.85"
                top: "0"
                width: "0.1"
                height: "0.1"
                zIndex: 100
                #marginTop: "0.05"
                color: "0xffffff"
                fontSize: "17"
                textAlign:
                  x: right
                  y: center
              onClick:
                - actionType: builtIn
                  funcName: hide
                  viewTag: edittitle
                - actionType: builtIn
                  funcName: show
                  viewTag: savetitle
            - type: textField # take users' input
              viewTag: savetitle
              contentType: text
              placeholder: "Please type the title here"
              dataKey: rootRoom.edge.name.title # users' input will be saved to this key
              style:
                left: "0.3"
                top: "0"
                width: "0.4"
                height: "0.1"
                color: "0x99C5E5"
                backgroundColor: "0x388eccff"
                textAlign:
                  x: center
                fontSize: "17"
                required: "true"
                isHidden: true
                # borderWidth: "1"
                # borderColor: "0xffffffff"
                # border:
                #   style: "2"
            - type: label
              text: "Save"
              viewTag: savetitle
              style:
                top: "0"
                left: "0.85"
                height: "0.1"
                width: "0.1"
                fontSize: "17"
                textAlign:
                  x: right
                  y: center
                color: "0xffffff"
                isHidden: true
              onClick:
                - actionType: evalObject
                  object:
                    .Global.rootRoomInfo.edge.name.title@: =..rootRoom.edge.name.title
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""                  
                - actionType: saveObject
                  object: ..save
                # - actionType: builtIn
                #   funcName: hide
                #   viewTag: savetitle
                # - actionType: builtIn
                #   funcName: show
                #   viewTag: edittitle
                # - actionType: builtIn
                #   funcName: redraw
                #   viewTag: edittitle
                - goto: MeetingLobby
            - type: label
              text: "Started on:"
              style: 
                top: "0.13"
                left: "0.05"
                width: "0.9"
                height: "0.04"
                color: "0xffffff"
                fontWeight: "500"
                fontSize: "16"
                textAlign: 
                  x: left
                  y: top
                borderWidth: "1"
                borderColor: "0xffffffff"
                border:
                  style: "2"
            - type: label
              text=func: =.builtIn.string.formatUnixtime_en
              dataKey: dataObject.ctime # Mon Day, Year hh:mm:ss
              style: 
                top: "0.13"
                left: "0.5"
                width: "0.45"
                height: "0.04"
                fontWeight: "500"
                fontSize: "16"
                color: "0xffffff"
                paddingBottom: "10px"
                textIndent: "20px"
                textAlign: 
                  x: right
                  y: top
            - type: label
              text: Duration
              style: 
                top: "0.19"
                left: "0.05"
                width: "0.9"
                height: "0.04"
                color: "0xffffff"
                fontWeight: "500"
                fontSize: "16"
                textAlign: 
                  x: left
            - type: label
              contentType: timer
              viewTag: videoTimer
              text=func: =.builtIn.string.formatTimer
              dataKey: Global.timer # to be remove after implemented builtIn         
              # text=func: =.builtIn.string.formatDurationInSecond
              # # dataKey: dataObject.name.duration
              # dataKey: dataObject.tage # hh:mm'ss"
              style: 
                top: "0.19"
                left: "0.5"
                width: "0.45"
                height: "0.04"
                fontWeight: "500"
                fontSize: "16"
                color: "0xffffff"
                paddingBottom: "10px"
                textIndent: "20px"
                textAlign: 
                  x: right
            - type: label
              # contentType: timer
              # viewTag: "videoTimer"
              # text=func: =.builtIn.string.formatTimer
              # dataKey: Global.timer # to be remove after implemented builtIn          
              text=func: =.builtIn.string.formatDurationInSecond
              dataKey: dataObject.name.duration
              # dataKey: dataObject.tage # hh:mm'ss"
              viewTag: videoDuration
              style: 
                top: "0.19"
                left: "0.5"
                width: "0.45"
                height: "0.04"
                fontWeight: "500"
                fontSize: "16"
                color: "0xffffff"
                paddingBottom: "10px"
                textIndent: "20px"
                textAlign: 
                  x: right                  
           
            
                
        - type: view
          style:
            top: "0.26"
            left: "0"
            height: "0.72"
          children:
            - type: view
              style:
                top: "0"
                left: "0" 
                width: "0.5" 
                height: "0.2"
              children:
                - type: image
                  path: add.file.png
                  onClick:                 
                    - goto: UploadSharedDocuments
                  style:
                    top: "0"
                    left: "0.165"
                    width: "0.17"
                - type: label
                  text: Documents 
                  style:
                    top: "0.11"
                    left: "0"
                    width: "0.5"
                    height: "0.05"
                    fontSize: 14
                    fontWeight: 400
                    textAlign:
                      x: center   
            - type: view
              style:
                top: "0"
                left: "0.5" 
                width: "0.5" 
                height: "0.2"
              children:
                - type: image
                  path: invite.user.png
                  onClick:
                    - goto: UploadFavorite
                  style:
                    top: "0"
                    left: "0.165"
                    width: "0.17"
                - type: label
                  text: Invite
                  style:
                    top: "0.11"
                    left: "0.09"
                    width: "0.3"
                    height: "0.05"
                    fontSize: 14
                    fontWeight: 400
                    textAlign:
                      x: center
            - type: label
              text: "Participants"
              style:
                top: "0.14"
                left: "0"
                width: "1"
                height: "0.05"
                fontSize: 20
                color: "0x00000099"
                textAlign: 
                  x: center
                border: 
                  style: "2"
                borderColor: "0x00000044"
                borderWidth: "0.001px"
            - type: label
              dataKey: Global.rootRoomInfo.edge.name.hostName
              style:
                left: "0.1"
                top: "0.21"
                width: "0.7"
                height: "0.03"
                fontSize: "18"
                fontStyle: bold
                color: "0x000000ff"           
            - type: label
              text: Organizer
              style:
                left: "0.7"
                top: "0.21"
                width: "0.18"
                height: "0.04"
                fontSize: "18"
                color: "0x000000ff"
                fontStyle: bold
                display: inline
                textAlign:
                  x: center     
                border:
                  style: "1"
                # borderColor: "0xeeeeeeff"
                # borderWidth: "0.001px"                                  
              
                
              # children:
              #   - type: label
              #     text: 1
              #     dataKey:
              #     style:
              #       width: "0.18"
              #       color: "0xeb3d38" 
              #       fontSize: "16"
              #       textAlign:
              #         x: right
              #   - type: label
              #     text: Document(s) have been uploaded.
              #     dataKey:
              #     style:
              #       width: "0.8"
              #       left: "0.19"
              #       color: "0x000000" 
              #       fontSize: "16"            
            - type: list # hardcoded listObject
              contentType: listObject
              listObject: ..listData.response.edge # to dataObject to enumerate the list
              iteratorVar: itemObject # iteratorVar is a reserve key of CADL
              #for (itemObject in listObject) do something
              #  ..messageDoc@ = itemObject
              style:
                left: "0"
                top: "0.24"
                width: "1"
                # backgroundColor: "0xcdcdcd"
                height: "0.26"
                overflow: scroll
              #for loop through listObject, we got each itemObject
              children:
                - type: listItem
                  itemObject: ""
                  style:
                    left: "0"
                    # top: "0"
                    width: "1"
                    height: "0.10"
                    border:
                      style: "2"
                      color: "0xeeeeeeff"
                    borderWidth: "1"
                    textAlign:
                      y: center                      
                  children:
                    # - type: label
                    #   dataKey: itemObject.name.firstName
                    #   style:
                    #     left: "0.08"
                    #     top: "0.025"
                    #     width: "0.15"
                    #     height: "0.07"
                    #     fontSize: "32"
                    #     fontStyle: bold
                    #     color: "0xffffffff"
                    #     backgroundColor: "0xff8f90ff"
                    #     display: inline
                    #     textAlign:
                    #       x: center
                    #       y: center
                    - type: label
                      dataKey: itemObject.name.fullName
                      style:
                        left: "0.1"
                        # top: "0.045"
                        width: "0.7"
                        height: "0.03"
                        fontSize: "18"
                        fontStyle: bold
                        color: "0x000000ff"                      
                    - type: button
                      onClick:
                        - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                          dataKey: MeetingLobby.inviteesInfo.edge
                          dataObject: itemObject # this must be a rootRoom
                        - actionType: evalObject
                          object: 
                            .MeetingLobby.inviteesInfo.edge.tage@: -1 
                        - actionType: evalObject
                          object: 
                            - =.MeetingLobby.inviteesInfo.edgeAPI.store: ""
                        - actionType: refresh
                      text: Remove
                      style:
                        left: "0.69"
                        top: "0.037"
                        width: "0.2"
                        height: "0.04"
                        fontSize: "14"
                        color: "0xffffffff"
                        backgroundColor: "0xd53d42ff"
                        textAlign:
                          x: center
                        border:
                          style: "1"    
            - type: button
              onClick:
                - actionType: updateObject
                  dataKey: Global.rootRoomInfo.edge.name.title
                  dataObject: ..rootRoom.edge.name.title
                - actionType: saveObject
                  object: ..save
                - actionType: evalObject
                  object:
                    - ..rootRoom.response.edge.refid@: =.Global.VideoChatObjStore.reference.edge.refid
                    - .Global.VideoChatObjStore.reference.edge@: =..rootRoom.response.edge
                # - actionType: evalObject
                #   object:
                #     - .Global.VideoChatObjStore.reference.edge.refid@: =.Global.rootRoomInfo.edge.id
                    # - .Global.DocReference.document.id@: =.EmptyObj     
                - actionType: evalObject
                  object: 
                    .Global.timer@: =.Global.rootRoomInfo.edge.name.duration                                      
                - goto: VideoChat
              text: "Enter  Room"
              viewTag: enterRoom
              style:
                left: "0.2"
                top: "0.56"
                width: "0.6"
                height: "0.05"
                fontSize: "18"
                color: "0xffffffff"
                fontWeight: 500
                backgroundColor: "0x388eccff"
                borderRaduis: "3"
                textAlign:
                  x: center
                border:
                  style: "1"
                borderRadius: "3"
            - type: button
              viewTag: closeRoom
              text: "Close  Room"
              style:
                left: "0.2"
                top: "0.63"
                width: "0.6"
                height: "0.05"
                fontSize: "18"
                fontWeight: 500
                borderRaduis: "3"
                color: "0xffffffff"
                backgroundColor: "0xd53d42ff"
                textAlign:
                  x: center
                border:
                  style: "1"
              onClick:
                - actionType: evalObject
                  object: 
                    - ..rootRoom.edge.tage@: -1 
                    - .Global.rootRoomInfo.edge@: =..roomInfo.response.edge
                    - .Global.DocChat.document.id@: =.EmptyObj   
                    - ..rootRoom.edge.name.duration@: =.Global.rootRoomInfo.edge.name.duration                                          
                - actionType: saveObject
                  object: ..save 
                - actionType: evalObject
                  object: 
                    .Global._nonce@: 
                      =.builtIn.math.random: "" 
                - actionType: evalObject
                  object:
                    .Global.rootRoomInfo.edge@: =..rootRoom.response.edge                                                                   
                - goto: MeetingRoomHistory                          
                  
    - type: popUp # view
      viewTag: warningView
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1" 
        backgroundColor: "0x00000066" 
      children:
        - type: view
          style:
            left: "0.05"
            top: "0.2"
            width: "0.89333"
            height: "0.3"
            backgroundColor: "0xeeeeeeff"
            border:
              style: "5"
            borderRadius: "15"
          children:
            - type: label
              text: "OOPS"
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.04"
                  width: "0.89333"
                  height: "0.027247"
                  color: "0x00000088"
                  fontSize: "20"
                  fontStyle: bold
                  display: inline
                  textAlign:
                    x: center
                    y: center
            - type: label
              text: "There is no title of meeting"
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.12"
                  width: "0.89333"
                  height: "0.04"
                  color: "0x00000088"
                  fontSize: "14"
                  display: inline
                  textAlign:
                    x: center
                    y: center 
            - type: divider
              style:
                .DividerStyle:
                  left: "0"
                  top: "0.20436"
                  width: "0.89333"
                  backgroundColor: "0x00000088"
            - type: button
              onClick: 
                - actionType: popUpDismiss
                  popUpView: warningView
              text: OK
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.225"
                  width: "0.89333"
                  height: "0.06812"
                  color: "0x007affff"
                  fontSize: "17"
                  display: inline
                  textAlign:
                    x: center
                    y: center 
                  border:
                    style: "5"
                  borderRadius: "15"
