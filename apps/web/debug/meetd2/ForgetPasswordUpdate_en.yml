ForgetPasswordUpdate:
  title: 'Forget Password'
  formData:
    esk: ""
    password: ""
    confirmPassword: ""
    verificationCode: .SignUp.formData.code
    signature: ""
  myLoginTime: ""
  loginMessage: ""
  loginUser2:
    response: ""
    edge:
      .Edge: ""
      type: 1031
      tage: =.ForgetPasswordIn.formData.code
      name:
        ctime: ""
        sig: ""
        # encrypt: ssha256(bvid+ctime)+spk+currentUser.sk
        # server: decrypt sig with (currentUser.pk and ssk) = ssha256(ctime+bvid)
        #bvid in base64 format, ctime in unix timestamp
      _nonce: =.Global._nonce
      bvid: =.ForgetPasswordIn.loginNewDevice.response.edge.deat.user_id
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: ForgetPasswordUpdate.loginUser2.edge
        dataOut: ForgetPasswordUpdate.loginUser2.response
  getAccess:
    - =.builtIn.date.currentDateTime:
        dataOut: ForgetPasswordUpdate.myLoginTime  
    # - ..myLoginTime@: =.builtIn.currentDateTime 
    - =.builtIn.string.concat:
        dataIn:
          - =..loginUser2.edge.bvid
          - " "
          - =..myLoginTime
        dataOut: ForgetPasswordUpdate.loginMessage
    - =.builtIn.storeCredentials:
        dataIn:
          sk: =.ForgetPasswordContact.formData.sk
    - =.builtIn.eccNaCl.signature:
        dataIn:
          message: =..loginMessage
          sk: =.ForgetPasswordContact.formData.sk
          eskSign: =.ForgetPasswordContact.retrieveVertex.response.vertex.0.name.eskSign
        dataOut: ForgetPasswordUpdate.loginUser2.edge.name.sig
    - .ForgetPasswordUpdate.loginUser2.edge.name.ctime@: =..myLoginTime
    - =.ForgetPasswordUpdate.loginUser2.edgeAPI.store: ""
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
  updateVertex: .ForgetPasswordContact.myVertex
  updateApiData:
    response: ""
    vertexAPI:
      .VertexAPI: ""
      store:
        api: cv # construct uid, pk, esk .. for new account
        dataIn: updateVertex
        dataOut: updateApiData.response
  components:
    - .BaseCheckView: ""
      message: "Password should be same"
      viewTag: samePassword
    - .BaseCheckView: ""
      message: "Please fill out required fields"
      viewTag: inputPassword       
    - .BaseHeader:
    - .HeaderLeftButton:
    - type: scrollView
      style:
        left: '0'
        width: '1'
        height: '0.9'
        top: '0.1'
        overflow: 'scroll'
      children:
        - type: image
          path: progressPercent100yellow.png
          style:
            left: '0'
            marginTop: ''
            width: '1'
        - type: label
          text: 'New Password'
          style:
            left: '0.09'
            width: '0.3'
            height: '0.05'
            fontWeight: '500'
            fontSize: '12'
        - type: textField
          contentType: password
          placeholder: 'Enter here'
          dataKey: formData.password
          style:          
            border:
              style: '3'
            borderWidth: "2"
            borderColor: "0xf0f0f0"
            borderRadius: "5"
            top: '0.11'
            fontSize: '16'
            width: '0.8'
            height: '0.05'
            left: '0.08'
        - type: label
          text: '8-16 digits of 0-9, Aa-Zz, or symbols'
          style:
            marginTop: '0.05'
            left: '0.12'
            width: '0.8'
            # height: '0.05'
            fontWeight: '100'
            fontSize: '12'
        # - type: view
        #   style:
        #     top: '0.18'
        #     left: '0.12'
        #     width: '0.8'
        #   children:
        #     - type: view
        #       style: 
        #         top: '0'
        #         left: '0'
        #         width: '0.15'
        #         height: '0.01'
        #         textAlign: 
        #           x: 'center'
        #         border: 
        #           style: "1"
        #         backgroundColor: '0xe2e8ed'
        #         borderRadius: "10"
        #       children:
        #         - type: label
        #           text: 'Weak'
        #           style:
        #             marginTop: '0.016'
        #             fontFamily: "PMingLiU"
        #             fontSize: '12'
        #     - type: view
        #       style: 
        #         top: '0'
        #         left: '0.16'
        #         width: '0.15'
        #         height: '0.01'
        #         textAlign: 
        #           x: 'center'
        #         border: 
        #           style: "1"
        #         backgroundColor: '0xe2e8ed'
        #         borderRadius: "10"
        #       children:
        #         - type: label
        #           text: 'Middle'
        #           style:
        #             marginTop: '0.016'
        #             fontFamily: "PMingLiU"
        #             fontSize: '12'
        #     - type: view
        #       style: 
        #         top: '0'
        #         left: '0.32'
        #         width: '0.15'
        #         height: '0.01'
        #         textAlign: 
        #           x: 'center'
        #         border: 
        #           style: "1"
        #         backgroundColor: '0xe2e8ed'
        #         borderRadius: "10"
        #       children:
        #         - type: label
        #           text: 'Strong'
        #           style:
        #             marginTop: '0.016'
        #             fontFamily: "PMingLiU"
        #             fontSize: '12'

        - type: label
          text: 'Confirm Password'
          style:
            marginTop: '0.08'
            left: '0.09'
            width: '0.3'
            height: '0.05'
            fontWeight: '500'
            fontSize: '12'
        - type: textField
          contentType: password
          placeholder: 'Enter here'
          dataKey: formData.confirmPassword
          style:
            border:
              style: '3'
            borderWidth: "2"
            borderColor: "0xf0f0f0"
            borderRadius: "5"
            top: '0.31'
            fontSize: '16'
            width: '0.8'
            height: '0.05'
            left: '0.08'
        - type: view
          onClick: 
            - actionType: evalObject
              object:
                - if:
                    - =..formData.password
                    - continue
                    - actionType: popUp
                      popUpView: inputPassword
                      wait: true
            - actionType: evalObject
              object:
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =..formData.password
                          string2: =..formData.confirmPassword
                    - continue
                    - actionType: popUp
                      popUpView: samePassword
                      wait: true
            - actionType: evalObject
              object:
                =.builtIn.eccNaCl.encryptAES:
                  dataIn:
                    key: =..formData.password
                    message: =.ForgetPasswordContact.formData.sk  
                  dataOut: ForgetPasswordUpdate.formData.esk                                                       
            - actionType: evalObject
              object: ..getAccess
            - actionType: evalObject
              object:
                - if:
                    - =..loginUser2.response.jwt
                    - continue
                    - actionType: popUp
                      popUpView: jwtExpired
                      wait: true              
                - ..updateVertex.jwt@: =..loginUser2.response.jwt
                - ..updateVertex.esk@: =..formData.esk
                - ..updateVertex.tage@: =.ForgetPasswordIn.formData.code
                - =..updateApiData.vertexAPI.store: ""
            - actionType: popUp
              popUpView: selectView
          style:
            border: 
              style: "3"
            borderWidth: ""
            borderColor: "0x707070"
            borderRadius: "5"
            marginTop: '0.505'
            left: '0.1'
            backgroundColor: "0x388eccff"
            width: '0.8'
            height: '0.05'
            textAlign:
              x: 'center'
              y: 'center'
          children:
            - type: label
              text: 'Done'
              style:
                fontFamily: PMingLiU
                color: '0xffffff'
    - type: popUp
      viewTag: selectView
      style:
        width: '1'
        height: '1'
        backgroundColor: '0xffffff00'
        top: '0'
        left: '0'
      children:
        - type: view
          onClick:
            - actionType: popUpDismiss
              popUpView: selectView
            - actionType: evalObject
              object:
                - if:
                    - =..loginUser2.response.jwt
                    - =.builtIn.cleanLocalStorage
                    - continue              
            - goto: SignIn              
          style:
            left: "0.15"
            width: "0.7"
            borderRadius: "15"
            top: "0.325"
            height: "0.325"
            backgroundColor: "0xf9f9f9"
            textAlign: 
              y: 'center'
              x: 'center'
          children:
          - type: image
            path: successMark.png
            style: 
              top: "0.04"
              width: "0.2"
              left: "0.25"
          # - type: label
          #   text: 'After verification, we will reset your password and send you a text message.'
          #   style:
          #     width: '0.6'
          #     left: '0.05'
          #     top: '0.14'
          #     fontSize: '24'
          #     fontWeight: '700'
          #     fontFamily: PMingLiU
          - type: label
            text: 'Success!'
            style:
              width: '0.65'
              left: '0.025'
              top: '0.2'
              fontFamily: PMingLiU

    - type: popUp
      viewTag: jwtExpired
      style:
        width: '1'
        height: '1'
        backgroundColor: '0xffffff00'
        top: '0'
        left: '0'
      children:
        - type: view
          onClick:
            - actionType: popUpDismiss
              popUpView: jwtExpired
            # - actionType: evalObject
            #   object:              
            #     - =.builtIn.cleanLocalStorage:
            - goto: ForgetPasswordIn              
          style:
            left: "0.15"
            width: "0.7"
            borderRadius: "15"
            top: "0.325"
            height: "0.325"
            backgroundColor: "0xf9f9f9"
            textAlign: 
              y: 'center'
              x: 'center'
          children:
            - type: label
              text: 'Time expired, will go back to re-input verification code.'
              style:
                width: '0.6'
                left: '0.05'
                top: '0.1'
                fontSize: '24'
                fontWeight: '700'
                # fontFamily: PMingLiU
            # - type: label
            #   text: 'Success!'
            #   style:
            #     width: '0.65'
            #     left: '0.025'
            #     top: '0.2'
            #     fontFamily: PMingLiU