AddPasswordRecovery:
  init:
    - =.builtIn.eccNaCl.generate16Dkey:
          #dataIn:
        dataOut: AddPasswordRecovery.my16Dkey
  formData:
    countryCode: "+1"
    phoneNumber: ""
  inviteHelper:
    response: ""
    edge:
      .Edge: ""
      type: 1053
      refid: ""
      subtype: 8 # invite special people
      bvid: .Global.currentUser.vertex.id
      name:
        phoneNumber: ""
        inviterName: .Global.currentUser.vertex.name.firstName
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: inviteHelper.edge
        dataOut: inviteHelper.response
  # retrieveVertex:
  #   response: ""
  #   vertex:
  #     id: =..loginNewDevice.response.edge.deat.user_id
  #     _nonce: =.Global._nonce
  #   vertexAPI:
  #     get:
  #       api: rv
  #       dataIn: SignIn.retrieveVertex.vertex
  #       dataOut: SignIn.retrieveVertex.response        
  my16Dkey: ""
  userData:
    userVertex:
      vertex:
    request:
      id: =.AddPasswordRecovery.inviteHelper.response.edge.evid
      xfname: id
      type: 1          
    get:
      api: rv
      dataIn: userData.request
      dataOut: userData.userVertex
  NewPasswordRecovery:
    document:
      type: .DocType.PasswordRecovery
      eid: =.AddPasswordRecovery.inviteHelper.response.edge.id
      name:
        title: "test3"
        type: "application/json"
        sesk: ""
    docAPI:
      .DocAPI: ""
      store:
        api: cd
        dataIn: NewPasswordRecovery.document 
        dataOut: AddPasswordRecovery.NewPasswordRecovery.document
        subtype:
          mediaType: "application/json"    
  NewPasswordHelper:
    document:
      type: .DocType.PasswordHelper
      # esig: .inviteHelper.response.edge.evid # Helpers.id
      eid: =..emailList.email.edge.0.id
      name:
        title: "test2"
        type: "application/json"
        aesk: ""
    docAPI:
      .DocAPI: ""
      store:
        api: cd
        dataIn: NewPasswordHelper.document 
        dataOut: AddPasswordRecovery.NewPasswordHelper.document
        subtype:
          mediaType: "application/json" 
  emailList: 
    email: 
      edge: 
    request:
        id: 
          - =..inviteHelper.response.edge.evid 
          - .Global.currentUser.vertex.id
        xfname: "evid,bvid"
        type: .EdgeType.Email
        _nonce: =.Global._nonce
        sCondition: "subtype=8"
    get: 
      api: re
      dataIn: emailList.request
      dataOut: emailList.email                     
  save:
    - ..inviteHelper.edgeAPI.store            
  components:
    - .BaseCheckView: ""
      message: "Please add one firend"
      viewTag: NoPhoneNum
    - .BaseCheckView: ""
      message: "Incorrect Phone Number"
      viewTag: wrongPhoneNum  
    - type: image
      path: "backpic.png"
      style:
        left: "0"
        width: "1"
        top: "0"
    - type: image
      path: mLogo.png
      style:
        top: "0.05"
        width: "0.38"
        left: "0.31"
    - type: scrollView
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
      children:
        - type: view
          style:
            top: "0.25"
            height: "1"
            width: "1"
            left: "0"
            backgroundColor: "0xffffff"
            border:
              style: 3
            borderRadius: "50"
            boxSizing: "border-box"
          children:
            - type: label
              text: Add Your Password Recovery Helper
              style:
                color: "0x3185c7ff"
                left: "0.05"
                marginTop: "0.05"
                width: "0.9"
                height: "0.041"
                fontSize: "18"
                fontStyle: bold
                textAlign:
                  x: center
                  y: center
            - type: view
              viewTag: phoneNumber
              style: 
                left: "0"
                # top: "0.246"
                marginTop: "0"
                width: "1"
                height: "0.14"
                border: 
                  style: "2"
                #borderWidth: "1"
                #borderColor: "0xdededf"
              children:
                - type: label
                  text: Country
                  style:
                    left: "0.08"
                    top: "0.031"
                    width: "0.3"
                    height: "0.028"
                    fontSize: "12"
                    fontWeight: "450"
                    textAlign:
                      x: left
                - type: select                                    #contentType: countryCode
                  contentType: countryCode
                  placeholder: ..formData.countryCode
                  dataKey: formData.countryCode # formData.countryCode : inputValue
                  options:
                    # - "+1"
                    # - "+52"
                    # - "+86"
                    # - "+965"
                    .CountryCode
                  required: "true"
                  style:
                    left: "0.08"
                    top: "0.06"
                    width: "0.2"
                    height: "0.04"
                    border:
                      style: "3"
                    borderColor: "0xefefef"
                    borderWidth: "1"
                    fontSize: "15"
                    # zIndex: "10"
                - type: label
                  textBoard: 
                    - text: Phone Number
                    - text: "*"
                      color: "0xff0000"
                  style:
                    left: "0.35"
                    top: "0.031"
                    width: "0.30"
                    height: "0.03"
                    fontSize: "12"
                    fontWeight: "450"
                    textAlign:
                      x: left
                - type: textField
                  placeholder: "000-000-0000"
                  dataKey: inviteHelper.edge.name.phoneNumber
                  style:
                    left: "0.35"
                    top: "0.06"
                    width: "0.40"
                    height: "0.04"
                    border: 
                      style: "3"
                    borderColor: "0xdededf" 
                    borderWidth: "0.1px"
                    textIndent: "10px"
                    fontSize: "15"
                - type: button
                  text: Add
                  onClick:
                    - actionType: evalObject
                      object: 
                        - if:
                          - =..inviteHelper.edge.name.phoneNumber
                          - continue
                          - actionType: popUp
                            popUpView: NoPhoneNum
                            wait: true
                    - actionType: evalObject
                      object: 
                        - =.builtIn.typeCheck.phoneNumber:
                            dataIn:
                              phoneNumber: =..inviteHelper.edge.name.phoneNumber
                              countryCode: =..formData.countryCode
                            dataOut: ForgetPasswordIn.formData.checkOk
                        - if:
                          - ..formData.checkOk
                          - continue
                          - actionType: popUp
                            popUpView: WrongPhoneNum
                            wait: true
                    - actionType: popUp
                      popUpView: confirmView                                               
                    # - actionType: popUp
                    #   popUpView: inviteView
                  style: 
                    left: "0.78"
                    top: "0.06"
                    width: "0.15"
                    height: "0.045"
                    color: "0xffffff"
                    backgroundColor: "0x388eccff"
                    fontSize: "12"
                    border:
                      style: "3"
                    borderWidth: "1.5"
                    borderRadius: "5"
                    borderColor: "0xffffff"
                    textAlign:
                      x: center
                      y: center
            - type: view
              style: 
                left: "0"
                marginTop: "0"
                width: "1"
                height: "0.345"
                #backgroundColor: "red"
              children:
              - type: label
                text: "Add/Invite Friend(s) to Help Recover Forgotten Passwords"
                style:
                  fontSize: "14"
                  fontWeight: "800"   #字体粗细
                  #color: "0x000000"   #字体颜色
                  #lineHeight: "0"   #行高
                  textAlign:
                    x: center
                    y: center
                  height: "0.023"
                  width: "0.8"
                  marginTop: "0.02"
                  left: "0.1"
              - type: label
                text: "For your protection, your password recovery(PR) should only be enabled by friends you trust (PR helper(s))."
                style:
                  fontSize: "12"
                  fontWeight: "600"   #字体粗细
                  #color: "0x000000"   #字体颜色
                  #lineHeight: "0"   #行高
                  textAlign:
                    x: left
                    #y: center
                  height: "0.053"
                  width: "0.8"
                  marginTop: "0.03"
                  left: "0.1"
              - type: label
                text: "Your PR helper(s) will help you when you forget your password. Your PR helper(s) will have access to a part of your access key. They DO NOT know any part of your password and may not even know that you have designated them as PR helper(s). You are strongly recommended to designate at least one PR helper. You may remove or change your PR helper(s) at any time."            
                style:
                  fontSize: "12"
                  fontWeight: "600"   #字体粗细
                  #color: "0x000000"   #字体颜色
                  #lineHeight: "0"   #行高
                  textAlign:
                    x: left
                    #y: center
                  height: "0.150"
                  width: "0.8"
                  marginTop: "0.03"
                  left: "0.1"  
              - type: label
                textBoard: 
                  - text: "WARNING:"
                    color: "red"
                  - text: " Without valid PR helper(s), you will no longer have access if you forget your password. If this event, you have to start over by signing up again."             
                style:
                  fontSize: "12"
                  fontWeight: "600"   #字体粗细
                  #color: "0x000000"   #字体颜色
                  #lineHeight: "0"   #行高
                  textAlign:
                    x: left
                    #y: center
                  height: "0.093"
                  width: "0.8"
                  marginTop: "0"
                  left: "0.1"  
            - type: button
              text: Sign Up
              onClick: 
                - actionType: evalObject
                  object:
                    - .Global._nonce@: 
                        =.builtIn.math.random: ""                        
                    - =..userData.get: ""                     
                    - =..emailList.get: ""                      
                - actionType: evalObject
                  object: 
                    - if:
                      - =..userData.userVertex.vertex.0.pk
                      - continue
                      - actionType: popUp
                        popUpView: inviteView
                        wait: true                                 
                    - =.builtIn.eccNaCl.encryptAES:
                        dataIn:
                          key: =..my16Dkey
                          message: =.Global.currentUser.vertex.sk # user_sk
                        dataOut: AddPasswordRecovery.NewPasswordRecovery.document.name.sesk #sesk  
                    - =.builtIn.eccNaCl.encryptASK:
                        dataIn:
                          data: =..my16Dkey
                          sendSk: =.Global.currentUser.vertex.sk 
                          recvPk: =..userData.userVertex.vertex.0.pk
                        dataOut: AddPasswordRecovery.NewPasswordHelper.document.name.aesk #aesk
                - actionType: evalObject
                  object:
                    - =.AddPasswordRecovery.NewPasswordRecovery.docAPI.store: ""                    
                    - =.AddPasswordRecovery.NewPasswordHelper.docAPI.store: ""                                                   
                - goto: MeetingRoomInvited                                      
              style:
                color: "0xffffffff"
                fontSize: "16"
                # fontStyle: bold
                left: "0.128"
                marginTop: "0.07"
                fontWeight: 400
                width: "0.747"
                height: "0.06"
                backgroundColor: "0x388eccff"
                border:
                  style: "1"
                display: inline
                textAlign:
                  x: center
                  y: center
            - type: view
              style:
                left: "0"
                marginTop: "0.01"
                width: "0.8"
                height: "0.054"
                backgroundColor: "0xffffff"
              children:
                - type: label
                  text: Already have an account?
                  style:
                    color: "0x00000088"
                    fontSize: "14"
                    left: "0.21"
                    top: "0"
                    width: "0.6"
                    height: "0.08"
                    textAlign:
                      x: right
                      y: center
                - type: label
                  text: Sign In
                  style:
                    color: "0x3185c7ff"
                    fontSize: "14"
                    fontStyle: bold
                    left: "0.7"
                    top: "0"
                    fontWeight: 400
                    width: "0.25"
                    height: "0.08"
                    backgroundColor: "0xffffffff"
                    border:
                      style: "1"
                    textAlign:
                      x: left
                      y: center
                  onClick:
                    - goto: SignIn
    - type: popUp
      viewTag: inviteView
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000033"
        zIndex: "1000"
      children:
        - type: view
          style:
            left: "0.15"
            top: "0.3"
            width: "0.7"
            height: "0.25"
            backgroundColor: "0xefefef"
            borderRadius: "10"
          children:
            - type: label
              text: Sorry, this phone number 
              style:
                left: "0"
                marginTop: "0.04"
                width: "0.7"
                height: "0.02" 
                fontSize: "16"
                fontWeight: "500"
                textAlign: 
                  x: center
            - type: label
              dataKey: inviteHelper.edge.name.phoneNumber
              style:
                left: "0"
                marginTop: "0.02"
                width: "0.7"
                height: "0.02" 
                fontSize: "13"
                fontWeight: "500"
                textAlign: 
                  x: center
            - type: label
              text: is not inside our system, please enter another phone number or let this user sign up first.
              style:
                left: "0"
                marginTop: "0.02"
                width: "0.7"
                height: "0.05" 
                fontSize: "14"
                fontWeight: "500"
                textAlign: 
                  x: center
            - type: view
              style:
                left: "0"
                top: "0.19"
                width: "0.7"
                height: "0.0002"
                backgroundColor: "0xbebebf"
            - type: divider
              style:
                left: "0.348"
                top: "0.18"
                width: "0.001"
                height: "0.057"
                backgroundColor: "0xbebebf"
            - type: button
              text: Cancel
              onClick: 
                - actionType: popUpDismiss
                  popUpView: inviteView
              style:
                left: "0"
                top: "0.195"
                width: "0.348"
                height: "0.05"
                borderRadius: "10"
                borderWidth: "0"
                fontSize: "17"
                fontWeight: "500"
                color: "0x3a96f9"
                textAlign: 
                  x: center
            - type: button
              text: Confirm
              onClick:
                - actionType: popUpDismiss
                  popUpView: inviteView
              style:
                left: "0.352"
                top: "0.195"
                width: "0.348"
                height: "0.05"
                borderRadius: "10"
                borderWidth: "0"
                fontSize: "17"
                fontWeight: "500"
                color: "0x3a96f9"
                textAlign: 
                  x: center      
    - type: popUp
      onClick:
        - actionType: popUpDismiss
          popUpView: finalView          
      viewTag: finalView
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000033"
        zIndex: "1000"
      children:
        - type: view
          style:
            left: "0.25"
            top: "0.25"
            width: "0.5"
            height: "0.225"
            backgroundColor: "0xefefef"
            borderRadius: "10"
          children:
            - type: image
              path: successMark.png
              style:
                top: "0.02"
                width: "0.2"
                left: "0.15"
            - type: label
              text: Success!
              style:
                left: "0"
                top: "0.17"
                width: "0.5"
                fontSize: "26"
                fontWeight: "700"
                textAlign:
                  x: center
    - type: popUp # view
      viewTag: confirmView
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1" 
        backgroundColor: "0x00000066" 
      children:
        - type: view
          style:
            left: "0.05"
            top: "0.15"
            width: "0.89333"
            height: "0.35"
            backgroundColor: "0xeeeeeeff"
            border:
              style: "5"
            borderRadius: "15"
          children:
            - type: label
              text: "Send Invite Link"
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.04"
                  width: "0.89333"
                  height: "0.04"
                  color: "0x00000088"
                  fontSize: "20"
                  fontStyle: bold
                  display: inline
                  textAlign:
                    x: center
                    y: center
            - type: label
              text: "Send invite link to"
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.1"
                  width: "0.89333"
                  height: "0.04"
                  color: "0x00000088"
                  fontSize: "14"
                  display: inline
                  textAlign:
                    x: center
                    y: center 
            - type: label
              #text: "+1 7148397253"
              dataKey: inviteHelper.edge.name.phoneNumber
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.20"
                  width: "0.89333"
                  height: "0.027247"
                  color: "0x00000088"
                  fontSize: "14"
                  display: inline
                  textAlign:
                    x: center
                    y: center 
            - type: divider
              style:
                .DividerStyle:
                  left: "0"
                  top: "0.25436"
                  width: "0.89333"
                  height: "0.001"
                  backgroundColor: "0x00000088"
            - type: button
              onClick: 
                - actionType: popUpDismiss
                  popUpView: confirmView
              text: Cancel
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.275"
                  width: "0.42"
                  height: "0.06812"
                  color: "0x007affff"
                  fontSize: "17"
                  display: inline
                  textAlign:
                    x: center
                    y: center 
                  border:
                    style: "5"
                  borderRadius: "15"

            - type: button
              onClick: 
                - actionType: saveObject
                  object: ..save
                - actionType: evalObject
                  object: 
                    .Global._nonce@: 
                      =.builtIn.math.random: ""     
                - actionType: popUpDismiss
                  popUpView: confirmView
                - actionType: popUp
                  popUpView: finalView                   
              text: Confirm
              style:
                .LabelStyle:
                  left: "0.45"
                  top: "0.275"
                  width: "0.42"
                  height: "0.06812"
                  color: "0x007affff"
                  fontSize: "17"
                  display: inline
                  textAlign:
                    x: center
                    y: center 
                  border:
                    style: "5"
                  borderRadius: "15"
            - type: divider
              style:
                .DividerStyle:
                  left: "0.45"
                  top: "0.26"
                  width: "0.001"
                  height: "0.07"
                  backgroundColor: "0x00000088"                      