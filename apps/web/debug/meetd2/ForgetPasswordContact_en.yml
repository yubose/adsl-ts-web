ForgetPasswordContact:
  title: 'Forget Password'
  init:
    - .ForgetPasswordContact.NewPasswordHelper.docAPI.get
    - if:
      - =..docResponse.doc.0
      - actionType: evalObject
        object:
          - ..NewInboxMessage.document.fid@: =..docResponse.doc.0.id
          - ..NewInboxMessage.document.eid@: =.Global.email.id          
          - =..NewInboxMessage.docAPI.store: ""
      - continue
    - ..emailList.get      
    - .ForgetPasswordContact.NewPasswordRecovery.docAPI.get
  formData:
    part1: ""
    part2: ""
    part3: ""
    part4: ""
    password: ""
    sk: ""  
    pass: "" 
  myVertex: ""
  retrieveVertex:
    response: ""
    vertex:
      id: =.ForgetPasswordIn.loginNewDevice.response.edge.deat.user_id
      _nonce: =.Global._nonce
    vertexAPI:
      get:
        api: rv
        dataIn: ForgetPasswordContact.retrieveVertex.vertex
        dataOut: ForgetPasswordContact.retrieveVertex.response
  NewInboxMessage:
    document:
      type: .DocType.InboxMessage
      eid: ""
      fid: ""
      name:
        title: "Password Recovery Request!!!"
        type: "application/json" 
        data: "Please help me retrieve account"
        user: .ForgetPasswordIn.apiData.phoneNumber
    docAPI:
      .DocAPI: ""
      store:
        api: cd
        dataIn: NewInboxMessage.document 
        dataOut: ForgetPasswordContact.NewInboxMessage.document
        subtype:
          mediaType: "application/json"          
  NewPasswordHelper:
    document:
    docAPI:
      .DocAPI: ""
      get:
        .DocAPI.get: "" 
        api: rd
        ids:
          - .Global.email.id  
        xfname: eid
        type: .DocType.PasswordHelper 
        maxcount: "1"
        obfname: "mtime"
        dataKey: docResponse
        _nonce: =.Global._nonce
  emailList: 
    email: 
      edge: 
    request:
        id: 
          - .Global.helperUser.vertex.id
          - .ForgetPasswordIn.loginNewDevice.response.edge.deat.user_id
        xfname: "evid,bvid"
        type: .EdgeType.InviteInfo
        _nonce: =.Global._nonce
        sCondition: "subtype=8"
    get: 
      api: re
      dataIn: emailList.request
      dataOut: emailList.email 
  NewPasswordRecovery:
    document:
    docAPI:
      .DocAPI: ""
      get:
        .DocAPI.get: "" 
        api: rd
        ids:
          - =..emailList.email.edge.0.id
        xfname: eid
        type: .DocType.PasswordRecovery
        maxcount: "1"
        obfname: "mtime"
        dataKey: docResponse2
        _nonce: =.Global._nonce 
  docResponse:
    doc:
    error: ""
    jwt: ""                           
  docResponse2:
    doc:
    error: ""
    jwt: ""                                     
  components:
    - .BaseCheckView: ""
      message: "Incorrect verificationCode"
      viewTag: wrongCode
    - .BaseHeader:
    - .HeaderLeftButton:
    - type: scrollView
      style:
        left: '0'
        width: '1'
        height: '0.9'
        top: '0.1'
        overflow: 'scroll'
      children:
        - type: image
          path: progressPercent66.png
          style:
            left: '0'
            marginTop: ''
            width: '1'
            height: '0.2'
        - type: label
          text: 'Please contact with your friend'
          style:
            top: '0.11'
            left: '0.08'
            width: '0.84'
            fontWeight: '500'
            textAlign:
              x: 'center'
              y: 'center'
            height: '0.05'
            fontSize: '18'
        - type: label
          text: 'to get password recovery PIN'
          style:
            top: '0.15'
            left: '0.08'
            width: '0.84'
            fontWeight: '500'
            textAlign:
              x: 'center'
              y: 'center'
            height: '0.05'
            fontSize: '18'            
        - type: view
          style:
            top: '0.22'
            left: '0.15'
            width: '0.85'
          children:
            - type: textField
              dataKey: formData.part1
              style:
                textAlign:
                  x: 'center'
                  y: 'center'
                border:
                  style: '3'
                borderWidth: "2"
                borderColor: "0xf0f0f0"
                borderRadius: "5"
                top: '0'
                width: '0.1'
                height: '0.04'
                left: '0.0'
            - type: divider
              style: 
                left: "0.15"
                top: "0.01"
                height: "0.003"
                width: "0.02"  
                backgroundColor: "0xE6E9F4"
            - type: textField
              dataKey: formData.part2
              style:
                textAlign:
                  x: 'center'
                  y: 'center'
                border: 
                  style: "3"
                borderWidth: "2"
                borderColor: "0xf0f0f0"
                borderRadius: "5"
                top: '0'
                width: '0.1'
                height: '0.04'
                left: '0.2'
            - type: divider
              style: 
                left: "0.35"
                top: "0.01"
                height: "0.003"
                width: "0.02"  
                backgroundColor: "0xE6E9F4"
            - type: textField
              dataKey: formData.part3
              style:
                textAlign:
                  x: 'center'
                  y: 'center'
                border: 
                  style: "3"
                borderWidth: "2"
                borderColor: "0xf0f0f0"
                borderRadius: "5"
                top: '0'
                width: '0.1'
                height: '0.04'
                left: '0.4'
            - type: divider
              style: 
                left: "0.54"
                top: "0.01"
                height: "0.003"
                width: "0.02"  
                backgroundColor: "0xE6E9F4"
            - type: textField
              dataKey: formData.part4
              style:
                textAlign:
                  x: 'center'
                  y: 'center'
                border: 
                  style: "3"
                borderWidth: "2"
                borderColor: "0xf0f0f0"
                borderRadius: "5"
                top: '0'
                width: '0.1'
                height: '0.04'
                left: '0.59'
        - type: image
          path: phonePassword.png
          style:
            left: '0.3'
            height: '0.25'
            width: '0.4'
            top: '0.45'

        - type: view
          style:
            border: 
              style: "1"
            borderWidth: ""
            borderColor: "0x707070"
            borderRadius: "5"
            top: '0.815'
            left: '0.1'
            backgroundColor: "0x388eccff"
            width: '0.8'
            height: '0.05'
            textAlign:
              x: 'center'
              y: 'center'
          children:
            - type: label
              text: 'Next'
              onClick:
                - actionType: evalObject
                  object:
                    =.builtIn.string.concat:
                      dataIn:
                        - =..formData.part1
                        # - "-"
                        - =..formData.part2
                        # - "-"
                        - =..formData.part3
                        # - "-"                        
                        - =..formData.part4                                               
                      dataOut: ForgetPasswordContact.formData.password
                - actionType: evalObject
                  object:
                    - =.builtIn.eccNaCl.decryptAES:
                        dataIn:
                          key: =..formData.password
                          message: =..docResponse2.doc.0.name.sesk
                        dataOut: ForgetPasswordContact.formData.sk 
                - actionType: evalObject
                  object:
                    - =.builtIn.eccNaCl.skCheck:
                        dataIn:
                          pk: =.ForgetPasswordIn.loginNewDevice.response.edge.deat.pk
                          sk: =..formData.sk
                        dataOut: ForgetPasswordContact.formData.pass                                      
                - actionType: evalObject
                  object:
                    - if:
                      - =.ForgetPasswordContact.formData.pass                                                                          
                      - actionType: evalObject
                        object:
                          - =..retrieveVertex.vertexAPI.get: ""
                          - ..myVertex@: =..retrieveVertex.response.vertex.0
                          - goto: ForgetPasswordUpdate
                      - actionType: popUp
                        popUpView: wrongCode
                        wait: true
              style:
                fontFamily: PMingLiU
                color: '0xffffff'