Transactions:
  title:  Transactions
  pageNumber: 
  init: #Page initialization
    - actionType: evalObject
      object: 
        .Global._nonce@: 
          =.builtIn.math.random: ""
    - actionType: evalObject
      object: .BaseDate.getDate
    #生成年份
    - =.builtIn.date.generateYear:
        dataIn:
          last: 40
          next: 10
        dataOut: BaseDate.year
    - =..apiRequest.aitmedBalance.docAPI.get: ""
    - if:
      - =..apiRequest.aitmedBalance.docResp.doc.0.id
      - actionType: evalObject
        object:
          - ..apiRequest.aitmedBalance.docReq@: =..apiRequest.aitmedBalance.docResp.doc.0
          - =..apiRequest.aitmedBalance.docAPI.store: ""   
      - =..apiRequest.aitmedBalance.docAPI.store: ""
    - ..formData.currentBalance@: =..apiRequest.aitmedBalance.storeResp.doc.size
    # up to date received
    - =..apiRequest.totalReceived.docAPI.store: ""
    - ..formData.totalReceived@: =..apiRequest.totalReceived.docResp.doc.size 
    # total refund  
    - =..apiRequest.totalRefund.docAPI.store: ""
    - ..formData.totalRefund@: =..apiRequest.totalRefund.docResp.doc.size
    # total cashout  
    - =..apiRequest.totalCashOut.docAPI.store: ""
    - ..formData.totalCashOut@: =..apiRequest.totalCashOut.docResp.doc.size            
    - =..apiRequest.hasPaidProfile.docAPI.get: ""
    - ..formData.transactions@: =..apiRequest.hasPaidProfile.getDocResp.doc
    # Get Appointments List
    # - =..apiRequest.#.docAPI.get: ""
    # doc REPLACE ..formDataTemp.appFormList
    # Processing Appointments List
    # 表格分页
    # 1 
    - =.builtIn.array.splitTableList: 
        dataIn: 
          arrObj: =..formData.transactions
          numX: "11"
          numY: "1"
        dataOut: Transactions.formData.tableData
    - ..formData.tableList@: =..formData.tableData.0
    - =.builtIn.string.concat:
        dataIn:
          - =..formData.tablePageNum # page num
          - " / "
          - =..formData.tableData.1 # total page
        dataOut: Transactions.formData.tableCurrentPage # current page                           
    - =.builtIn.number.addition: # get totalPage+1 to verify legitimacy of gotoPageNum
        dataIn:
          num: =..formData.tableData.1
          step: "1"
        dataOut: Transactions.formData.totalPageMore # update page num       
    - =.builtIn.array.setPropertyInterlacedChange:
        dataIn:
          arrIn: =..formData.transactions
          arr: ["backgroundColor"]
          valueArr: ["0xf5f5f5"]
          errorArr: ["0xffffff"]
    
  formData: #Input data calendarHeader
    refundTotalArr: []   # 退款的总金额数组
    refundTotal: ""   # 退款的总金额,不包括当前这次
    refundJudge: ""  # 退款总金额，包括当前退款，用于判断是否超过总付款
    isTransCompleted: false   # 判断当前交易是否为Refunded或者Paid，从而决定弹窗是否展示receipt以及refunded
    currentBalance: ""  # 当前账户总余额
    tableData: [] # sdk 返回的数组,包括当前显示第几页的数据list 和 被切分成总共多少页面
    tableList: [] # sdk 返回的数组的第一项，list真正打印的数据
    tablePageNum: "1" # previous和next 中间的文本显示的数据
    tableCurrentPage: "1" # 当前显示的当前页面/总页面
    gotoPageNum: "" # goto 后面的文本显示
    totalPageMore: "" # totalPage(tableData.1) + 1   
    statusHiddenOrShow: "0"
    transactions: []
    currentTransaction: {}
    moreOptions: []
    refundData:
      patientName: ""
      paidAmount: "" # 支付金额
      notes: ""
      refundAmount: "" # 退款金额
    updateCondition: 
      name: ""
      beginDate: ""
      endDate: ""
      statusSelected:
        list: []
    tabList: 
      - name: Paid
        color: "0x005795"
        fontWeight: "700"
        borderColor: "0x005795"
      - name: Pending
        color: "0x000000"
        fontWeight: ""
        borderColor: "#ececec"
  formDataTemp: #Input data temp here, datatemp should not mix with formData
    statusList:
      - name: "Paid"
      - name: "Unpaid"
      - name: "Refund"
      - name: "Refund fail"
      - name: "Cancelled"

  apiRequest: #Input data request here
    # 所有的 当前facility 下所有交易记录
    hasPaidProfile:
      getDocResp: ""
      getDocReq: 
        # id: .Global.currentFacility.id
        # type: 2001
        xfname: "none"
        sCondition: "type in (2001,2002) and reid is not null and deat is not null "
        _nonce: .Global._nonce
        maxcount: "100"    
        obfname: ctime
      docAPI: 
        get:
          api: rd
          dataIn: Transactions.apiRequest.hasPaidProfile.getDocReq
          dataOut: Transactions.apiRequest.hasPaidProfile.getDocResp
    #  refund info
    refundOrder:
      docReq:
        type: 2002 # .DocType.refundOrder
        eid: "" # once click the order, they share the same eid 
        name:
          data:
            appointmentInfo: ""
            orderInfo:
              amount: # 退款金额 
              payer: ""
          title: ""
          nonce: "" # once click the order, get the squareID from response.document.deat.squareID   
      docRes: ""
      docAPI:
        store:
          api: cd
          dataIn: Transactions.apiRequest.refundOrder.docReq
          dataOut: Transactions.apiRequest.refundOrder.docRes 

    # all transactions of the same meeting room (同一会议下的所有交易记录,包括pay和refund)
    onceTransaction: 
      docResp: ""
      docReq: 
        id: ""
        xfname: eid
        sCondition: "type in (2001,2002)"
        _nonce: .Global._nonce
      docAPI: 
        get: 
          api: rd
          dataIn: apiRequest.onceTransaction.docReq
          dataOut: Transactions.apiRequest.onceTransaction.docResp
    
    # 获取当前Doc所挂的1113，从而拿到它的refid也就是appointment ID，赋值跳转对应的会议
    squareCheckout: 
      edgeIn: 
        id: ""
        xfname: id
        maxcount: "1"
        _nonce: =.Global._nonce
      edgeAPI: 
        get: 
          api: re
          dataIn: apiRequest.squareCheckout.edgeIn
          dataOut: Transactions.apiRequest.squareCheckout.edgeResp
    # for getting the balance of AiTmed
    aitmedBalance:
      storeResp: "" 
      docResp: ""
      docReq:
        eid: .Global.rootNotebookID
        type: 2005
        id: "" 
        jwt: ""     
      docIn: 
        id: .Global.rootNotebookID
        xfname: eid
        type: 2005
        _nonce: .Global._nonce
        maxcount: "100"  
      docAPI: 
        store: 
          api: cd
          dataIn: apiRequest.aitmedBalance.docReq
          dataOut: Transactions.apiRequest.aitmedBalance.storeResp            
        get: 
          api: rd
          dataIn: apiRequest.aitmedBalance.docIn
          dataOut: Transactions.apiRequest.aitmedBalance.docResp              
    # AiTmed 总收钱
    totalReceived: 
      docResp: ""
      docReq: 
        type: .DocType.AiTmedOrderTotal
        eid: .Global.rootNotebookID
        name: 
          data: ""
          nonce: "E.type=1113 AND D.reid IS NOT NULL AND D.type = 2001"
      docAPI: 
        store: 
          api: cd
          dataIn: apiRequest.totalReceived.docReq
          dataOut: Transactions.apiRequest.totalReceived.docResp
                  
    # AiTmed 总退款
    totalRefund: 
      docResp: ""
      docReq: 
        type: .DocType.AiTmedRefundTotal
        eid: .Global.rootNotebookID
        name: 
          data: ""
          nonce: "E.type=1113 AND D.reid IS NOT NULL AND D.type = 2002"
      docAPI: 
        store: 
          api: cd
          dataIn: apiRequest.totalRefund.docReq
          dataOut: Transactions.apiRequest.totalRefund.docResp   
    # AiTmed 总提现
    totalCashOut: 
      docResp: ""
      docReq: 
        type: .DocType.AiTmedCashOutTotal
        eid: .Global.rootNotebookID
        name: 
          data: ""
          nonce: "E.type=1113 AND D.reid IS NOT NULL AND D.type = 2003" # it is sCondition 
      docAPI: 
        store: 
          api: cd
          dataIn: apiRequest.totalCashOut.docReq
          dataOut: Transactions.apiRequest.totalCashOut.docResp          
  style: #Input style fragment here

  components:
    - .TotalView: 
      children: 
        - .SideMenuBar: 
          children:
            - .aitLogo:
            - .MenuBar:        
        - .TopBar: 
        - .InnerBodyView:
          children:
            - .TransactionsAndMoneyView: 
              children:
                - .PageTitleLabelHasReceivedMoney:
                - .RightPaymentReceivedView: 
                  children:
                    # Up to Date Payment Received
                    - .UpDatePaymentReceived: 
                    - .ReceivedMoneyLabel: 
                      text: ""
                      dataKey: formData.totalReceived
                      text=func: .builtIn.string.dollarFormat
                    
            - .ContentBar:
              children:
                - type: view
                  style:
                    width: "0.76"
                    height: "0.13"
                    display: flex
                    justifyContent: space-between
                    alignItems: center
                    left: "0.028"
                  children:
                    - .MoneyRelatedView:
                      children:
                        - .RelationLabel: 
                        - .MoneyView: 
                          children:
                            - .MoneyLabel:  
                              dataKey: formData.currentBalance
                              text=func: .builtIn.string.dollarFormat
                    - .MoneyRelatedView:
                      style: 
                        backgroundColor: "0xe4f5e9"
                      children:
                        - .RelationLabel: 
                          text: "Total Cash out"
                        - .MoneyView: 
                          children:
                            - .MoneyLabel:  
                              dataKey: formData.totalCashOut
                              text=func: .builtIn.string.dollarFormat
                              style:
                                color: "0x2fb355"
                    - .MoneyRelatedView:
                      style: 
                        backgroundColor: "0xfff4e0"
                      children:
                        - .RelationLabel: 
                          text: "Total Process fee"
                        - .MoneyView: 
                          children:
                            - .DollarBlueSmall: 
                              style:
                                color: "0xffaa00"
                            - .MoneyLabel:  
                              style:
                                color: "0xffaa00"
                    - .MoneyRelatedView:
                      style: 
                        backgroundColor: "0xffeaea"
                      children:
                        - .RelationLabel: 
                          text: "Total Refund"
                        - .MoneyView: 
                          children:
                            - .MoneyLabel:  
                              dataKey: formData.totalRefund
                              text=func: .builtIn.string.dollarFormat                            
                              style:
                                color: "0xe24445"

                - type: view
                  style:
                    left: "0.028"
                    width: "0.76"
                    border:
                      style: "2"
                    borderColor: "0xececec"
                    display: flex
                    boxSizing: border-box
                  children:
                    - type: list
                      viewTag: settingFormsTag
                      contentType: listObject
                      listObject: ..formData.tabList
                      iteratorVar: itemObject
                      style:
                        width: "0.4"
                        margin: '0'
                        height: auto
                        display: flex
                        axis: horizontal
                      children:
                        - type: listItem
                          itemObject: 
                          style:
                            height: "0.05"
                          children:
                            - type: label
                              dataKey: itemObject.name
                              style:
                                height: "0.05"
                                width: "0.05"
                                display: flex
                                fontSize: .Nfont.n6
                                fontWeight: itemObject.fontWeight
                                color: itemObject.color
                                alignItems: center
                                justifyContent: center
                                marginRight: "0.02"
                                border:
                                  style: "2"
                                borderWidth: "2"
                                borderColor: itemObject.borderColor
                              onClick:
                                - emit: 
                                    dataKey: 
                                      var: itemObject
                                    actions: 
                                      - =.builtIn.object.setProperty: 
                                          dataIn: 
                                            obj: =..formData.tabList
                                            label: "name"
                                            text: $var.name
                                            arr: ["color","fontWeight","borderColor"]
                                            valueArr: ["0x005795","700","0x005795"]
                                            errorArr: ["0x000000","","#ececec"] 
                                      - if:
                                        - =.builtIn.string.equal:
                                            dataIn:
                                              string1: $var.name
                                              string2: "Reason/Fee"
                                        - ..formData.isShowReasonAndFee@: block
                                        - ..formData.isShowReasonAndFee@: none
                                      - if:
                                        - =.builtIn.string.equal:
                                            dataIn:
                                              string1: $var.name
                                              string2: "Reason/Fee"
                                        - ..formData.isShowAvailabilitySetting@: none
                                        - ..formData.isShowAvailabilitySetting@: block
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: settingFormsTag


                - type: view
                  style:
                    width: "0.76"
                    height: "0.07"
                    marginTop: "0.008"
                    left: "0.028"
                  children:
                    # search patient
                    - type: view
                      style:
                        width: "0.163"
                        height: "auto"
                        display: inline-block
                        marginTop: "0.02"
                        border: 
                          style: "3"
                        borderRadius: "3"
                        boxSizing: border-box
                        borderColor: "0xd0d0d0"
                        textAlign :
                          y: center
                      children:
                        - type: image
                          path: searchGray.svg
                          style:
                            marginLeft: "0.01"
                            width: "0.01"
                            marginTop: "0.01"
                            display: inline-block
                        - .TransactionsTextField: ""
                          dataKey: formData.updateCondition.name              
                          style:
                            width: "0.13"
                            marginLeft: "0.005"
                            display: inline-block
                            border: 
                              style: "1"

                    # From - Today
                    - type: view
                      viewTag: selectStartAndEndTag
                      style:
                        width: "0.21"
                        height: "auto"
                        marginTop: "0.02"
                        display: inline-block
                        marginLeft: "0.012"
                      children:
                        - type: label
                          text: Date
                          dataKey: 
                          style:
                            fontSize: .Nfont.n5_2
                            display: inline-block
                            marginTop: "0.005"
                            textAlign:
                              y: center
                        - type: view
                          style:
                            width: "0.08"
                            display: inline-block
                            marginLeft: "0.008"
                          onClick:
                            - actionType: popUp
                              popUpView: startDateTag
                          children:
                            - type: image
                              path: calendarPoint.svg
                              style:
                                top: "0.009"
                                left: "0.065"
                                zIndex: "5"
                            - .TransactionsTextField: ""
                              placeholder: Start Date
                              dataKey: formData.updateCondition.beginDate
                              style:
                                width: "0.08"

                        - type: label
                          text: "—"
                          dataKey: 
                          style:
                            fontWeight: "700"
                            top: "0.006"
                            marginTop: "0"
                            left: "0.115"
                            color: "0xc1c1c1"
                        - type: view
                          style:
                            width: "0.08"
                            display: inline-block
                            left: "0.018"
                          onClick:
                            - actionType: popUp
                              popUpView: endDateTag
                          children:
                            - type: image
                              path: calendarPoint.svg
                              style:
                                top: "0.009"
                                left: "0.065"
                                zIndex: "5"
                            - .TransactionsTextField: ""
                              placeholder: End Date
                              dataKey: formData.updateCondition.endDate
                              style:
                                width: "0.08"
                    
                    # Status
                    - type: view
                      style:
                        width: "auto"
                        marginLeft: "0.012"
                        display: inline-block
                        marginTop: "0.02"
                      onClick:  
                        - actionType: popUp
                          popUpView: statusTag
                        - actionType: evalObject
                          object: 
                            - if:
                              - =.builtIn.string.equal:
                                  dataIn:
                                    string1: =..formData.statusHiddenOrShow
                                    string2: "0"
                              - ..formData.statusHiddenOrShow@: "1"
                              - ..formData.statusHiddenOrShow@: "0"
                            - if: 
                              - =.builtIn.string.equal:
                                  dataIn: 
                                    string1: =..formData.statusHiddenOrShow
                                    string2: "0"
                              - actionType: popUpDismiss
                                popUpView:  statusTag
                              - actionType: popUp
                                popUpView:  statusTag
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: statusBlackArrowTag
                      children:
                        - type: label
                          text: Status
                          dataKey: 
                          style:
                            fontSize: .Nfont.n6
                            display: inline-block
                            marginTop: "0.005"
                            marginRight: "0.006"
                            textAlign:
                              y: center
                        - .TransactionsTextField: ""
                          viewTag: statusTextFiledTag
                          placeholder: Select
                          dataKey: formData.updateCondition.statusSelected.list
                          style:
                            width: "0.115"
                            fontSize: .Nfont.nf2
                            paddingRight: "3em"
                        - type: image
                          # path: downArrowBlack.svg
                          viewTag: statusBlackArrowTag
                          path: downArrowDeepGray.svg
                          style:
                            width: "0.007"
                            top: "0.014"
                            left: "0.132"
                    # Update 按钮
                    - type: button
                      text: Update
                      style:
                        width: "0.06"
                        height: "0.036"
                        display: inline-block                        
                        backgroundColor: "0x0063a8"
                        color: "0xffffff"
                        fontWeight: "500"
                        borderRadius: "3"
                        marginTop: "0.02"
                        left: "0.014"
                        fontSize: .Nfont.n6_1_1
                        border: 
                          style: "1"
                        textAlign:
                          x: center
                          y: center
                      onClick:
                        - actionType: evalObject
                          object:

                    - type: label
                      text: Revise
                      dataKey: 
                      style:
                        textDecoration: underline
                        display: inline-block     
                        color: "0x0063a8"
                        marginTop: "0.025"
                        left: "0.025"
                      onClick:
                        - actionType: evalObject
                          object:

                    # downLoad 按钮
                    - type: view
                      style:
                        width: "0.065"
                        height: "0.036"
                        backgroundColor: "0xffffff"
                        borderRadius: "3"
                        display: inline-block
                        marginTop: "0.02"
                        left: "0.069"
                        border: 
                          style: "3"
                        borderColor: "0x4785b2"
                      onClick:
                        - actionType: evalObject
                          object: 
                            - =.builtIn.EcosObj.exportPDF:
                                dataIn:
                                  viewTag: tableView
                      children:
                        - type: image
                          path: downLoadBlue.svg
                          style:
                            left: "0.008"
                            marginTop: "0.011"
                            width: "0.008"
                        - type: label
                          text: Download
                          dataKey: 
                          style:
                            display: inline-block
                            color: "0x4785b2"
                            left: "0.012"
                            fontSize: .Nfont.n6_1
                            marginTop: "0.008"
                                        
                # 表格
                - type: view
                  viewTag: tableView
                  style:
                    width: "0.76"
                    height: auto
                    marginTop: "0.02"
                    left: "0.028"
                    borderRadius: "5"
                  children: 
                    - .FormMeterBlue: ""
                      children:
                        - .FormTemplate: ""
                          style:
                            paddingLeft: "16px"
                        - .FormTemplate: ""
                          text: "Transaction Date"
                          style: 
                            width: "0.09" 
                        - .FormTemplate: ""
                          text: "Payer"
                          style: 
                            width: "0.075"
                            paddingLeft: "12px"
                        - .FormTemplate: "" 
                          text: "Provider"
                          style: 
                            width: "0.1"
                        - .FormTemplate: "" 
                          text: "Reason for Visit"
                          style: 
                            width: "0.122"
                        - .FormTemplate: "" 
                          text: "App. Date & Time"
                          style: 
                            width: "0.098"
                            boxSizing: border-box
                        - .FormTemplate: "" 
                          text: "Status"
                          style: 
                            width: "0.058"
                        - .FormTemplate: "" 
                          text: "Amount"
                          style: 
                            width: "0.073"
                        - .FormTemplate: "" 
                          text: "Balance"
                          style: 
                            width: "0.052"
                    - type: list
                      contentType: listObject
                      listObject: ..formData.tableList
                      iteratorVar: itemObject
                      viewTag: transactionTag
                      style:
                        width: '0.76'
                        margin: '0'
                        height: auto
                        borderLeft: "1px solid #dbdbdb"
                        borderRight: "1px solid #dbdbdb"
                        boxSizing: border-box
                      children:
                        - type: listItem
                          itemObject: 
                          style:
                            width: '0.759'
                            height: '0.038'
                            left: '0'
                            marginTop: ''
                            backgroundColor: itemObject.backgroundColor
                            borderBottom: "1px solid #dbdbdb"
                            boxSizing: border-box
                          onClick: 
  
                            # - actionType: updateObject                        
                            #   dataKey: Transaction
                            #   dataObject: []
                            - actionType: evalObject
                              object: 
                                - =.builtIn.object.clearAll:
                                    dataIn: 
                                      object: =..formData.currentTransaction
                                - ..formData.moreOptions@: []
                                - ..formData.refundTotalArr@: []
                                - ..formData.refundTotal@: ""
                            - emit:
                                dataKey:
                                  var: itemObject
                                actions: 
                                  - ..formData.currentTransaction@: $var
                                  - ..apiRequest.onceTransaction.docReq.id@: $var.eid
                                  - if: 
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: $var.deat.state
                                          string2: "COMPLETED"
                                    - ..formData.isTransCompleted@: false
                                    - ..formData.isTransCompleted@: true
                            - actionType: evalObject
                              object:
                                - =..apiRequest.onceTransaction.docAPI.get: ""
                                - ..formData.moreOptions@: =..apiRequest.onceTransaction.docResp.doc
                                
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: moreOptionsTag
                            - actionType: popUp
                              popUpView: moreOptionsTag
                             
                          children:
                            - type: label
                              dataKey: itemObject.deat.squareID
                              style:
                                width: "0.0838"
                                .FormMainLabelStyleNew: ""
                                paddingLeft: "16px"
                                color: itemObject.color
                            - type: label
                              text=func: .builtIn.string.formatUnixtime_en
                              dataKey: itemObject.ctime
                              style:
                                width: "0.09"
                                .FormMainLabelStyleNew: ""
                            - type: label
                              dataKey: itemObject.name.data.orderInfo.payer
                              style:
                                width: "0.075"
                                .FormMainLabelStyleNew: ""
                                word-break: break-word
                                paddingLeft: "12px"
                            - type: label
                              dataKey: itemObject.name.data.appointmentInfo.providerName
                              style:
                                width: "0.1"
                                .FormMainLabelStyleNew: ""
                            - type: label
                              dataKey: itemObject.name.data.appointmentInfo.reason
                              style:
                                width: "0.122"
                                .FormMainLabelStyleNew: ""
                                textIndent: 0.5em
                            - type: label
                              text=func: .builtIn.string.formatUnixtime_en
                              dataKey: itemObject.name.data.appointmentInfo.appTime
                              style:
                                width: "0.098"
                                .FormMainLabelStyleNew: ""
                            - type: label
                              text=func: .builtIn.object.transformStatus
                              dataKey: itemObject
                              style:
                                width: "0.058"
                                .FormMainLabelStyleNew: ""
                            - type: label
                              dataKey: itemObject.name.data.orderInfo.amount
                              text=func: .builtIn.string.dollarFormat                            
                              style:
                                width: "0.073"
                                .FormMainLabelStyleNew: ""
                            - type: label
                              text=func: .builtIn.string.dollarFormat                            
                              dataKey: itemObject.deat.balance
                              style:
                                width: "0.052"
                                .FormMainLabelStyleNew: ""

            # TableFooter
            - type: view
              viewTag: tableFooter
              style:
                .TableFooterView:
                top: "0.857"
              children:   
                - type: view
                  style:
                    top: "0.005"
                    width: "0.08"
                    height: "0.0155"
                  children:
                    - type: label
                      text: "Current page:"
                      style:
                        display: inline-block
                        fontSize: .Nfont.nf0
                        color: "0x333333"
                        textAlign:
                          x: "center"
                          y: "center"
                    - type: label
                      dataKey: formData.tableCurrentPage
                      style:
                        marginLeft: "0.005"
                        display: inline-block
                        fontSize: .Nfont.nf0
                        color: "0x333333"
                        textAlign:
                          x: "center"
                          y: "center"
                # Previous & Next
                - type: view
                  style:
                    top: "0"
                    left: "0.076"
                    width: "0.05168"
                    height: "0.02576"
                  children:
                    - type: image
                      path: tableLeft.svg
                      onClick:
                        - actionType: evalObject
                          object:
                            - if: 
                              - =.builtIn.number.less: 
                                  dataIn: 
                                    num1: =..formData.tablePageNum
                                    num2: 2
                              - continue
                              - actionType: evalObject
                                object:
                                  # num - step
                                  - =.builtIn.number.Subtraction: 
                                      dataIn:
                                        num: =..formData.tablePageNum
                                        step: "1"
                                      dataOut: Transactions.formData.tablePageNum
                                  - =.builtIn.array.splitTableList: 
                                      dataIn: 
                                        arrObj: =..formData.transactions
                                        numX: "11"
                                        numY: =..formData.tablePageNum
                                      dataOut: Transactions.formData.tableData
                                  - ..formData.tableList@: =..formData.tableData.0
                                  - =.builtIn.string.concat: # re-concat
                                      dataIn:
                                        - =..formData.tablePageNum # page num
                                        - " / "
                                        - =..formData.tableData.1 # total page
                                      dataOut: Transactions.formData.tableCurrentPage # current page                                       
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: tableView
                        - actionType: builtIn 
                          funcName: redraw
                          viewTag: tableFooter                               
                      style:
                        top: "0"
                        width: "0.01456"
                        height: "0.02576"
                    - type: label
                      viewTag: pageNumView
                      dataKey: formData.tablePageNum
                      style:
                        top: "0"
                        left: "0.01856"
                        width: "0.01446"
                        height: "0.02576"
                        fontSize: .Nfont.nf0
                        fontWeight: "500"
                        color: "0xffffff"
                        backgroundColor: "0x005795"
                        borderRadius: "3"
                        textAlign:
                          x: center
                          y: center
                    - type: image
                      path: tableRight.svg
                      onClick:
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: "" 
                        - actionType: evalObject
                          object:
                            - if: 
                              - =.builtIn.number.less: 
                                  dataIn: 
                                    num1: =..formData.tablePageNum
                                    num2: =..formData.tableData.1
                              - actionType: evalObject
                                object:
                                  - =.builtIn.number.addition: 
                                      dataIn:
                                        num: =..formData.tablePageNum
                                        step: "1"
                                      dataOut: Transactions.formData.tablePageNum # update page num
                                  - =.builtIn.array.splitTableList: 
                                      dataIn: 
                                        arrObj: =..formData.transactions
                                        numX: "11"
                                        numY: =..formData.tablePageNum
                                      dataOut: Transactions.formData.tableData
                                  - ..formData.tableList@: =..formData.tableData.0
                                  - =.builtIn.string.concat: # re-concat
                                      dataIn:
                                        - =..formData.tablePageNum # page num
                                        - " / "
                                        - =..formData.tableData.1 # total page
                                      dataOut: Transactions.formData.tableCurrentPage # current page 
                              - continue                           
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: tableView  
                        - actionType: builtIn 
                          funcName: redraw
                          viewTag: tableFooter
                      style:
                        top: "0"
                        left: "0.03712"
                        height: "0.02576"
                        width: "0.01456"
                # Go to
                - type: view
                  style:
                    top: "0"
                    left: "0.14"
                    width: "0.05"
                    height: "0.02496"
                  children:
                    - type: textField
                      viewTag: gotoView
                      dataKey: formData.gotoPageNum
                      style:
                        width: "0.02496"
                        top: "0"
                        height: "0.02576"
                        borderRadius: "3"
                        borderWidth: "1"
                        border:
                          style: "3"
                        boxSizing: border-box
                        borderColor: "0xd8d8d8"
                        fontSize: .Nfont.nf0
                        fontWeight: "500"
                        color: "0x333333"
                        textAlign: 
                          x: center 
                          y: center 
                    - type: button
                      text: "Go to"
                      style:
                        textDecoration: underline
                        left: "0.029"
                        top: "0"
                        height: "0.02576"
                        border:
                          style: "1"
                        fontSize: .Nfont.nf0
                        color: "0x333333"
                        backgroundColor: "0xffffff00"
                      onClick:
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: ""                           
                        - actionType: evalObject
                          object:
                            # gotoPageNum ?> 1
                            - if:
                              - =.builtIn.number.less: 
                                  dataIn: 
                                    num1: =..formData.gotoPageNum
                                    num2: 1
                              - continue
                              - actionType: evalObject
                                object:
                                  # gotoPageNum ?< totalPage+1
                                  - if: 
                                    - =.builtIn.number.less: 
                                        dataIn: 
                                          num1: =..formData.gotoPageNum
                                          num2: =..formData.totalPageMore
                                    - actionType: evalObject
                                      object:
                                        - =.builtIn.array.splitTableList: 
                                            dataIn: 
                                              arrObj: =..formData.transactions
                                              numX: "11"
                                              numY: =..formData.gotoPageNum
                                            dataOut: Transactions.formData.tableData
                                        - ..formData.tableList@: =..formData.tableData.0
                                        - =.builtIn.string.concat: # re-concat
                                            dataIn:
                                              - =..formData.gotoPageNum # page num
                                              - " / "
                                              - =..formData.tableData.1 # total page
                                            dataOut: Transactions.formData.tableCurrentPage # current page
                                        - ..formData.tablePageNum@: =..formData.gotoPageNum
                                        - ..formData.gotoPageNum@: ""
                                    - continue                        
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: tableView 
                        - actionType: builtIn 
                          funcName: redraw
                          viewTag: tableFooter                          
        # Refund 成功
        - .BaseSuccessfulView: ""
          style:
            backgroundColor: "0x00000033"
          viewTag: successView
        # 警示框
        - type: popUp
          msg1: Refund Payment
          msg2: Are you sure you want to complete payment refund?
          viewTag: warningView
          style: 
            left: "0"
            width: "1"
            top: "0"
            height: "1"
            backgroundColor: "0x00000033"
            zIndex: "1000"
          children: 
            - type: view
              style: 
                left: "0.43"
                width: "0.28"
                top: "0.3"
                height: "0.345"
                boxShadow: "0px 2px 2px 1px #b7b7b7"
                borderRadius: "5"
                backgroundColor: "0xffffff"
              children: 
                - type: view
                  style:
                    marginTop: "0"
                    left: "0"
                    width: "0.28"
                    height: "0.013"
                    backgroundColor: "0xe24445"
                    border-top-left-radius: "5px"
                    border-top-right-radius: "5px"
                - type: view
                  style: 
                    marginTop: "0"
                    width: "0.28"
                    left: "0"
                    height: "0.332"
                  children: 
                    - type: image
                      path: warningRed.svg
                      style: 
                        left: "0.12"
                        width: "0.04"
                        marginTop: "0.04"
                    - type: label
                      text: ____.msg1
                      style:
                        left: "0.05"
                        width: "0.18"
                        fontSize: .Nfont.n5_1
                        color: "0x171725"
                        fontWeight: "500"
                        fontFamily: "Robot"
                        marginTop: "0.02"
                        textAlign: 
                          x: center
                    - type: label
                      text: ____.msg2
                      style:
                        left: "0.02"
                        width: "0.24"
                        marginTop: "0.02"
                        fontSize: .Nfont.n6_1
                        fontFamily: "Roboto"
                        color: "0x707070"
                        textAlign: 
                          x: center
                    - type: view
                      style:
                        display: flex
                        justifyContent: space-evenly
                        alignItems: center
                        marginTop: "0.04"
                        width: "0.28"
                      children:
                        - type: label
                          text: Edit
                          dataKey: 
                          style:
                            textDecoration: underline
                            fontSize: .Nfont.n6
                            color: "0x5c6172"
                            fontWeight: "600"
                          onClick:
                            - actionType: popUp
                              popUpView: refundTag
                            - actionType: popUpDismiss
                              popUpView: warningView
                        - type: button
                          text: Refund
                          onClick:
                            - actionType: evalObject
                              object:
                                - ..apiRequest.refundOrder.docReq.eid@: =..formData.currentTransaction.eid
                                - ..apiRequest.refundOrder.docReq.name.data.appointmentInfo@: =..formData.currentTransaction.name.data.appointmentInfo

                                # - ..apiRequest.refundOrder.docReq.name.title@: 
                                - ..apiRequest.refundOrder.docReq.name.data.orderInfo.amount@: =..apiRequest.refundOrder.docReq.name.title
                                - ..apiRequest.refundOrder.docReq.name.data.orderInfo.payer@: =..formData.currentTransaction.name.data.orderInfo.payer
                                - ..apiRequest.refundOrder.docReq.name.nonce@: =..formData.currentTransaction.deat.squareID
                                - =..apiRequest.refundOrder.docAPI.store: ""
                                # - ..apiRequest.refundOrder.docReq@: =..apiRequest.refundOrder.docReqIn

                                # 重新get下数据并且分页
                            - actionType: popUp
                              popUpView: successView
                              popUpDismiss: 1000  
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableView
                            - actionType: popUpDismiss
                              popUpView: warningView
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: refundTag
                          style:
                            border:
                              style: "1"
                            borderRadius: "5"
                            color: "0xffffff"
                            fontSize: .Nfont.n6
                            width: "0.06"
                            height: "0.045"
                            backgroundColor: "0xe24445"
                            fontWeight: "600"
                            textAlign:
                              x: center     
                              y: center
        # More options
        - type: popUp
          viewTag: moreOptionsTag
          style:
            top: "0"
            width: "1"
            height: "1"
            backgroundColor: "0x00000033"
            zIndex: "20"
          children:
            - type: view
              style:
                width: "0.584"
                height: "0.555"
                top: "0.22"
                left: "0.29"
                backgroundColor: "0xffffff"
                zIndex: "201"
                boxShadow: "1px 2px 7px 4px #cccccc"
                borderRadius: "5"
              children:
                - type: view
                  style:
                    width: "0.55"
                    height: "0.085"
                    left: "0.034"
                    display: flex
                    justifyContent: flex-start
                    alignItems: center
                  children:
                    - type: label
                      text: "More options"
                      dataKey: 
                      style:
                        width: "0.105"
                        fontSize: .Nfont.n4_2_1
                        fontWeight: "600"
                    - type: view
                      style:
                        width: "0.04"
                        display: flex
                        justifyContent: space-between
                        alignItems: center
                        isHidden: ..formData.isTransCompleted
                      onClick:
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: receiptTag
                        - actionType: popUp
                          popUpView: receiptTag
                        - actionType: popUpDismiss
                          popUpView: moreOptionsTag
                      children: 
                        - type: image
                          path: receipt.svg
                          style:
                            width: "0.01"
                        - type: label
                          text: Receipt
                          dataKey: 
                          style:
                            fontSize: .Nfont.n6_1
                            fontWeight: "600"
                            color: "0x2e75a8"
                            textDecoration: underline
                    - type: view
                      style:
                        width: "0.04"
                        marginLeft: "0.012"
                        display: flex
                        justifyContent: space-between
                        alignItems: center
                        isHidden: ..formData.isTransCompleted
                      onClick:
                        - actionType: evalObject
                          object:
                            - =.builtIn.object.extractArray: 
                                dataIn: 
                                  obj: =..formData.moreOptions
                                  arr:
                                    - name.data.orderInfo.amount
                                dataOut: Transactions.formData.refundTotalArr
                            - =.builtIn.array.selectOneToArr:
                                dataIn:
                                  arr: =..formData.refundTotalArr
                                  key: "amount"
                                dataOut: Transactions.formData.refundTotalArr
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: refundTag
                        - actionType: popUp
                          popUpView: refundTag
                        - actionType: popUpDismiss
                          popUpView: moreOptionsTag
                      children:
                        - type: image
                          path: refund.svg
                          style:
                            width: "0.01"
                        - type: label
                          text: Refund
                          dataKey: 
                          style:
                            fontSize: .Nfont.n6_1
                            fontWeight: "600"
                            color: "0xe24849"
                            textDecoration: underline
                    - type: image
                      path: ConfirmCashOutClose.svg
                      style:
                        width: "0.012"   
                        left: "0.3"
                      onClick:
                        - actionType: popUpDismiss
                          popUpView: moreOptionsTag
                - type: view
                  style:
                    width: "0.25"
                    height: "0.045"
                    left: "0.034"
                    display: flex
                    justifyContent: flex-start
                    alignItems: top
                  children:
                    - type: label
                      text: "Payer"
                      dataKey: 
                      style:
                        fontSize: .Nfont.n6_1_1
                    - type: label
                      dataKey: formData.currentTransaction.name.data.orderInfo.payer
                      style:
                        fontSize: .Nfont.n5_2
                        fontWeight: "600"
                        marginLeft: "0.01"
                - type: view
                  style:
                    left: "0.034"
                    height: "0.06"
                    display: flex
                    justifyContent: flex-start
                    alignItems: center
                  children:
                    - type: view
                      style:
                        height: "0.06"
                        marginRight: "0.02"
                      children:
                        - type: label
                          text: "Transaction ID"
                          dataKey: 
                          style:
                            fontSize: .Nfont.n6_1
                            height: "0.025"
                        - type: label
                          dataKey: formData.currentTransaction.deat.squareID
                          style:
                            fontSize: .Nfont.n6_1_1
                            fontWeight: "600"
                    - type: view
                      style:
                        height: "0.06"
                        marginRight: "0.02"
                      children:
                        - type: label
                          text: "Appointment"
                          dataKey: 
                          style:
                            width: "0.05"
                            fontSize: .Nfont.n6_1
                            height: "0.025"
                            display: inline-block
                        - type: label
                          text: Open Details
                          dataKey: 
                          style:
                            width: "0.05"
                            textDecoration: underline
                            fontSize: .Nfont.n6_1
                            color: "0x206ca2"
                            display: inline-block
                          onClick:
                            - actionType: evalObject
                              object:
                                - ..apiRequest.squareCheckout.edgeIn.id@: =..formData.currentTransaction.eid
                                - =..apiRequest.squareCheckout.edgeAPI.get: ""
                                - .Global.formData.patientHistoryInfo.id@: =..apiRequest.squareCheckout.edgeResp.edge.0.refid
                                - if: 
                                  - =.builtIn.array.has:
                                      dataIn: 
                                        object: ["Telemedicine","Office Visit"]
                                        value: =..formData.currentTransaction.name.data.appointmentInfo.visitType
                                  # - =..formData.currentTransaction.name.data.appointmentInfo.visitType
                                  - goto: PatientSummary
                                  - goto: PatientSummaryRoom

                        - type: label
                          # text: "10/23/2021 5:00pm"
                          text=func: .builtIn.string.formatUnixtime_en
                          dataKey: formData.currentTransaction.name.data.appointmentInfo.appTime
                          style:
                            fontSize: .Nfont.n6_1_1
                            fontWeight: "600"
                    - type: view
                      style:
                        height: "0.06"
                      children:
                        - type: label
                          text: "Service Type"
                          dataKey: 
                          style:
                            fontSize: .Nfont.n6_1
                            height: "0.025"
                        - type: label
                          dataKey: formData.currentTransaction.name.data.appointmentInfo.visitType
                          style:
                            fontSize: .Nfont.n6_1_1
                            fontWeight: "600"

                - type: view
                  style:
                    width: "0.5"
                    height: "0.06"
                    left: "0.034"
                  children:
                    - type: label
                      text: Notes
                      dataKey: 
                      style:
                        fontSize: .Nfont.nf1
                    - type: label
                      text: Test notes......
                      dataKey: 
                      style:
                        fontSize: .Nfont.nf3
                        fontWeight: "600"

                - type: scrollView
                  style:
                    width: "0.515"
                    height: "0.21"
                    left: "0.034"
                    borderRadius: "5"
                    overflow: scroll
                  children:
                    - type: view
                      style:
                        # width: "0.515"
                        height: "0.0417"
                        backgroundColor: "0xf5f5f5"
                        border-top-left-radius: "5"
                        border-top-right-radius: "5"
                        # boxSizing: border-box
                        border:
                          style: "3"
                        borderColor: "0xdbdbdb"
                      children:
                        - .OptionsFormHead: ""
                          style: 
                            textIndent: "1em"
                        - .OptionsFormHead: ""
                          text: Transac. Date & Time
                        - .OptionsFormHead: ""
                          text: Transaction made by
                        - .OptionsFormHead: ""
                          text: Status
                          style:
                            width: "0.065"
                        - .OptionsFormHead: ""
                          text: Process Fee
                          style:
                            width: "0.082"
                        - .OptionsFormHead: ""
                          text: Amount
                          style:
                            width: "0.057"

                    - type: list
                      contentType: listObject
                      listObject: ..formData.moreOptions
                      iteratorVar: itemObject
                      style:
                        # width: '0.75'
                        margin: '0'
                        height: auto
                        borderLeft: "1px solid #dbdbdb"
                        borderRight: "1px solid #dbdbdb"
                        boxSizing: border-box
                      children:
                        - type: listItem
                          itemObject: 
                          style:
                            # width: '0.103'
                            height: '0.0416'
                            left: '0'
                            marginTop: ''
                            backgroundColor: "0xffffff"
                            borderBottom: "1px solid #dbdbdb"
                            boxSizing: border-box
                          children:
                            - type: label
                              dataKey: itemObject.deat.squareID
                              style:
                                width: "0.103"
                                .FormMainLabelStyleNew: ""
                                paddingLeft: "12px"
                                paddingRight: "12px"
                                height: '0.0416'
                            - type: label
                              text=func: .builtIn.string.formatUnixtime_en
                              dataKey: itemObject.ctime
                              style:
                                width: "0.103"
                                .FormMainLabelStyleNew: ""
                                height: '0.0416'
                                paddingLeft: "0"
                            - type: label
                              dataKey: itemObject.name.data.orderInfo.payer
                              style:
                                width: "0.103"
                                .FormMainLabelStyleNew: ""
                                paddingLeft: "0"
                                height: '0.0416'
                            - type: label
                              text=func: .builtIn.object.transformStatus
                              dataKey: itemObject
                              style:
                                width: "0.065"
                                .FormMainLabelStyleNew: ""
                                height: '0.0416'
                                paddingLeft: "0"
                            - type: label
                              dataKey: itemObject.name.data.orderInfo.processFee
                              style:
                                width: "0.082"
                                .FormMainLabelStyleNew: ""
                                height: '0.0416'
                                paddingLeft: "0"
                            - type: label
                              dataKey: itemObject.name.data.orderInfo.amount
                              text=func: .builtIn.string.dollarFormat                            
                              style:
                                width: "0.057"
                                .FormMainLabelStyleNew: ""
                                height: '0.0416'
                                paddingLeft: "0"

                - type: button
                  text: Done
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: moreOptionsTag
                  style:
                    backgroundColor: "0x005795"
                    color: "0xffffff"
                    top: "0.49"
                    width: "0.055"
                    height: "0.038"
                    left: "0.495"
                    fontSize: .Nfont.n6_1_1
                    border: 
                      style: "1"
                    borderRadius: "5"
                    textAlign:
                      x: center
                      y: center
        # status 弹窗            
        - type: popUp
          viewTag: statusTag
          style:
            width: "0.115"
            height: "auto"
            top: "0.4"
            left: "0.628"
            zIndex: "101" 
            borderRadius: "8"
            backgroundColor: "0xffffff"
            boxShadow: "1px 1px 4px 2px #cccccc"
          children:
            - type: list
              viewTag: payeeListTag
              contentType: listObject
              listObject: ..formDataTemp.statusList
              iteratorVar: itemObject
              style:
                width: '0.083'
                margin: '0'
                height: auto
              children:
                - type: listItem
                  itemObject: 
                  style:
                    width: '0.083'
                    height: '0.04'
                    left: '0'
                    marginTop: ''
                  children:
                    - type: image
                      path: # selectBlue.svg
                        emit:
                          dataKey:
                            var: itemObject
                          actions:  
                            - if:
                              - =.builtIn.array.has:
                                  dataIn:
                                    object: =..formData.updateCondition.statusSelected.list
                                    value: $var.name
                              - selectBlue.svg 
                              - selectGray.svg
                      onClick:
                        - emit:
                            dataKey:
                              var: itemObject
                            actions: 
                              - if:
                                - =.builtIn.array.has:
                                    dataIn:
                                      object: =..formData.updateCondition.statusSelected.list
                                      value: $var.name
                                - =.builtIn.array.removeByValue:
                                    dataIn:
                                      object: =..formData.updateCondition.statusSelected.list
                                      value: $var.name
                                - =.builtIn.array.add:
                                    dataIn:
                                      object: =..formData.updateCondition.statusSelected.list
                                      value: $var.name
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: payeeListTag
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: statusTextFiledTag
                      style:
                        width: "0.012"
                        left: "0.01"
                        marginTop: "0.01"
                    - type: label
                      text: 
                      dataKey: itemObject.name
                      style:
                        display: inline-block
                        left: "0.015"
                        marginTop: "0.011"
                        fontSize: .Nfont.n6_1_2
        
        # Receipt
        - type: popUp
          viewTag: receiptTag
          style:
            top: "0"
            width: "1"
            height: "1"
            backgroundColor: "0x00000033"
            zIndex: "10"
          children:
            - type: view
              style:
                width: "0.584"
                height: "0.49"
                top: "0.22"
                left: "0.29"
                backgroundColor: "0xffffff"
                zIndex: "201"
                boxShadow: "1px 2px 7px 4px #cccccc"
                borderRadius: "5"
              children:
                - type: view
                  style:
                    width: "0.55"
                    height: "0.092"
                    left: "0.034"
                    display: flex
                    justifyContent: flex-start
                    alignItems: center
                  children:
                    - type: label
                      text: "Receipt"
                      dataKey: 
                      style:
                        width: "0.07"
                        fontSize: .Nfont.n4_2_1
                        fontWeight: "600"
                    - type: view
                      style:
                        width: "0.065"
                        display: flex
                        justifyContent: space-between
                        alignItems: center
                      onClick:
                        - actionType: evalObject
                          object:
                            - =.builtIn.EcosObj.exportPDF:
                                dataIn:
                                  viewTag: receiptTag
                      children: 
                        - type: image
                          path: downLoadBlue.svg
                          style:
                            width: "0.01"
                        - type: label
                          text: Download
                          dataKey: 
                          style:
                            width: "0.05"
                            fontSize: .Nfont.n6_1
                            fontWeight: "600"
                            color: "0x2e75a8"
                            textDecoration: underline
                    - type: image
                      path: ConfirmCashOutClose.svg
                      style:
                        width: "0.012"   
                        left: "0.36"
                      onClick:
                        - actionType: popUpDismiss
                          popUpView: receiptTag
                        - actionType: popUp
                          popUpView: moreOptionsTag

                - type: view
                  style:
                    width: "0.372"
                    height: "0.055"
                    left: "0.175"
                    display: flex
                    justifyContent: flex-end
                    alignItems: flex-start
                    top: "0.09"
                  children:
                    - type: label
                      text: "Receipt #:"
                      dataKey: 
                      style:
                        fontSize: .Nfont.n6_1_1
                    - type: label
                      text: "12345"
                      dataKey: formData.currentTransaction.deat.squareID
                      style:
                        marginLeft: "0.005"
                        fontSize: .Nfont.nf4
                        fontWeight: "600"
                - type: view
                  style:
                    width: "0.15"
                    left: "0.034"
                    # height: "0.06"
                    display: flex
                    flexDirection: column
                    alignItems: flex-start
                    justifyContent: center
                  children:
                    - type: view
                      style:
                        height: "0.03"
                        display: flex
                        alignItems: center
                      children:
                        - type: label
                          text: "Payment Date:"
                          dataKey: 
                          style:
                            fontSize: .Nfont.n6_1
                        - type: label
                          text=func: .builtIn.string.formatUnixtime_en
                          dataKey: formData.currentTransaction.ctime
                          style:
                            fontSize: .Nfont.n6_1_1
                            fontWeight: "600"
                            left: "0.01"
                    - type: view
                      style:
                        height: "0.03"
                        display: flex
                        alignItems: center
                      children:
                        - type: label
                          text: "Patient:"
                          dataKey: 
                          style:
                            fontSize: .Nfont.n6_1
                        - type: label
                          dataKey: formData.currentTransaction.name.data.orderInfo.payer
                          style:
                            fontSize: .Nfont.n6_1_1
                            fontWeight: "600"
                            left: "0.01"
                    - type: view
                      style:
                        height: "0.03"
                        display: flex
                        alignItems: center
                      children:
                        - type: label
                          text: "Appointment Type:"
                          dataKey: 
                          style:
                            fontSize: .Nfont.n6_1
                            display: inline-block
                        - type: label
                          dataKey: formData.currentTransaction.name.data.appointmentInfo.visitType
                          style:
                            fontSize: .Nfont.n6_1_1
                            display: inline-block
                            left: "0.005"
                            fontWeight: "600"

                    - type: view
                      style:
                        height: "0.03"
                        display: flex
                        alignItems: center
                      children:
                        - type: label
                          text: "Provider:"
                          dataKey: 
                          style:
                            fontSize: .Nfont.n6_1
                        - type: label
                          dataKey: formData.currentTransaction.name.data.appointmentInfo.providerName
                          style:
                            fontSize: .Nfont.n6_1_1
                            fontWeight: "600"
                            left: "0.01"

                - type: view
                  style:
                    width: "0.515"
                    height: "0.125"
                    left: "0.034"
                    borderRadius: "5"
                    marginTop: "0.02"
                  children:
                    - type: view
                      style:
                        # width: "0.515"
                        height: "0.0417"
                        backgroundColor: "0xf5f5f5"
                        border-top-left-radius: "5"
                        border-top-right-radius: "5"
                        # boxSizing: border-box
                        border:
                          style: "3"
                        borderColor: "0xdbdbdb"
                        display: flex
                        justifyContent: space-between
                      children:
                        - .OptionsFormHead: ""
                          text: Date of Service
                          style: 
                            textIndent: "1em"
                            width: "0.165"
                            display: flex
                        - .OptionsFormHead: ""
                          text: Reason for Visit
                          style: 
                            width: "0.171"
                            display: flex
                            justifyContent: center
                        - .OptionsFormHead: ""
                          text: Amount Due
                          style: 
                            width: "0.171"
                            display: flex
                            justifyContent: flex-end
                            paddingRight: "20px"
                    - type: list
                      contentType: listObject
                      listObject: ..formData.moreOptions
                      iteratorVar: itemObject
                      style:
                        # width: '0.75'
                        margin: '0'
                        height: auto
                        borderLeft: "1px solid #dbdbdb"
                        borderRight: "1px solid #dbdbdb"
                        boxSizing: border-box
                      children:
                        - type: listItem
                          itemObject: 
                          style:
                            # width: '0.103'
                            height: '0.0416'
                            left: '0'
                            marginTop: ''
                            backgroundColor: "0xffffff"
                            borderBottom: "1px solid #dbdbdb"
                            boxSizing: border-box
                          children:
                            - type: label
                              text=func: .builtIn.string.formatUnixtime_en
                              dataKey: itemObject.name.data.appointmentInfo.appTime
                              style:
                                width: "0.171"
                                .FormMainLabelStyleNew: ""
                                paddingLeft: "12px"
                                height: '0.0416'
                                display: inline-block
                            - type: label
                              dataKey: itemObject.name.data.appointmentInfo.reason
                              style:
                                width: "0.12"
                                .FormMainLabelStyleNew: ""
                                height: '0.0416'
                                paddingLeft: "0"
                                display: inline-block
                                left: "0.057"
                            - type: label
                              dataKey: itemObject.name.data.orderInfo.amount
                              text=func: .builtIn.string.dollarFormat                            
                              style:
                                .FormMainLabelStyleNew: ""
                                paddingLeft: "0"
                                height: '0.0416'
                                display: inline-block
                                left: "0.17"
                - type: view
                  style:
                    width: "0.515"
                    height: "0.03"
                    left: "0.034"
                    display: flex
                    justifyContent: flex-end
                    marginTop: "0.01"
                  children:
                    - type: label
                      text: "Amount Paid: $ "
                      dataKey: 
                      style:
                        color: "#1e6ba1"
                        fontSize: .Nfont.n6_1
                        fontWeight: "600"
                        marginRight: "0.003"
                    - type: label
                      # text: "30000.00"
                      dataKey: formData.currentTransaction.name.data.orderInfo.amount
                      style:
                        color: "#1e6ba1"
                        fontSize: .Nfont.n6_1
                        fontWeight: "600"
                - type: view
                  style:
                    width: "0.515"
                    height: "0.03"
                    left: "0.034"
                  children:
                    - type: view
                      style:
                        display: flex
                      children:
                        - type: label
                          text: "Paid to: "
                          dataKey: 
                          style:
                            fontWeight: "600"
                            fontSize: .Nfont.n6_1_1
                            marginRight: "0.01"
                    - type: view
                      style:
                        display: flex
                      children:  
                        - type: label
                          dataKey: formData.currentTransaction.name.data.orderInfo.payee
                          style:
                            fontSize: .Nfont.n6_1
                            fontWeight: "600"
                    - type: view
                      style:
                        display: flex
                      children:
                        - type: label
                          dataKey: formData.currentTransaction.name.data.orderInfo.location
                          style:
                            fontSize: .Nfont.n6_1
                            fontWeight: "600"
        # Refund
        - type: popUp
          viewTag: refundTag
          style:
            top: "0"
            width: "1"
            height: "1"
            backgroundColor: "0x00000033"
            zIndex: "10"
          children:
            - type: view
              style:
                width: "0.39"
                height: "0.42"
                top: "0.29"
                left: "0.385"
                backgroundColor: "0xffffff"
                zIndex: "201"
                boxShadow: "1px 2px 7px 4px #cccccc"
                borderRadius: "5"
              children:
                - type: view
                  style:
                    marginTop: "0.025"
                    marginLeft: "0.0325"
                  children: 
                    - type: label
                      text: Refund
                      dataKey: 
                      style:
                        width: "0.07"
                        fontSize: .Nfont.n4_2
                        fontWeight: "600"
                        display: inline-block
                        verticalAlign: bottom
                    - type: image
                      path: ConfirmCashOutClose.svg
                      onClick:
                        - actionType: popUpDismiss
                          popUpView: refundTag
                        - actionType: popUp
                          popUpView: moreOptionsTag                      
                      style:
                        marginLeft: "0.25"
                        display: inline-block
                        width: "0.009"                        
                        marginTop: "0.015"
                - type: view
                  style:
                    marginTop: "0.012"
                    marginLeft: "0.06"
                    width: "0.27"
                  children: 
                    - type: label
                      text: Please enter amount and reason for refund.
                      dataKey: 
                      style:
                        width: "0.2"
                        fontSize: .Nfont.nf2
                        fontFamily: Proxima Nova
                        color: "0x545454"
                    - type: view
                      style:
                        marginTop: "0.02"
                      children: 
                        - type: label
                          text: Patient
                          dataKey: 
                          style:
                            left: "0"
                            display: inline-block
                            fontSize: .Nfont.nf1
                            fontFamily: Proxima Nova
                            color: "0x333333"
                        - type: label
                          dataKey:  formData.currentTransaction.name.data.orderInfo.payer
                          style:
                            left: "0.042"
                            fontSize: .Nfont.nf2
                            fontWeight: "600"
                            fontFamily: Proxima Nova
                            color: "0x333333"                            
                            display: inline-block
                    - type: view
                      style:
                        marginTop: "0.005"
                      children: 
                        - type: label
                          text: Amount
                          dataKey: 
                          style:
                            left: "0"
                            display: inline-block
                            fontSize: .Nfont.nf1
                            fontFamily: Proxima Nova
                            color: "0x333333"
                        - type: label
                          # text: ff
                          dataKey: formData.currentTransaction.name.data.orderInfo.amount
                          style:
                            left: "0.042"
                            fontSize: .Nfont.nf2
                            fontWeight: "600"
                            fontFamily: Proxima Nova
                            color: "0x333333"                            
                            display: inline-block  
                    - type: view
                      style:
                        marginTop: "0.006"
                      children: 
                        - type: label
                          text: Notes
                          dataKey: 
                          style:
                            fontSize: .Nfont.nf1
                            fontFamily: Proxima Nova
                            color: "0x333333"  
                        - type: textView
                          placeholder: Appointment canceled by pt
                          dataKey: formData.refundData.notes
                          style:
                            width: "0.27"      
                            marginTop: "0.006"
                            textIndent: "10px"
                            height: "0.06"
                            fontFamily: Proxima Nova  
                            border: 
                              style: "3"
                            borderWidth: "1"
                            borderColor: "0xc1c1c1"
                            borderRadius: "4" 
                    - type: view
                      style:
                        marginTop: "0.006"
                      children: 
                        - type: label
                          text: Amount
                          dataKey: 
                          style:
                            fontSize: .Nfont.nf1
                            fontFamily: Proxima Nova
                            color: "0x333333"   
                        - type: view
                          style:
                            marginTop: "0.006"
                            width: "0.07"
                            height: "0.035"
                            boxSizing: border-box
                            border: 
                              style: "3"
                            borderWidth: "1"
                            borderColor: "0xc1c1c1"
                            borderRadius: "4"   
                            textAlign: 
                              x: center 
                              y: center
                          children: 
                            - type: textField
                              placeholder: 30.00
                              dataKey: formData.refundData.refundAmount
                              style:
                                marginLeft: "0.005"
                                boxSizing: border-box
                                width: "0.045"
                                display: inline-block
                                verticalAlign: middle
                                border: 
                                  style: "1"
                                borderWidth: "1"
                            - type: label
                              text: $
                              style:
                                marginRight: "0.005"
                                display: inline-block
                                verticalAlign: middle
                                fontSize: .Nfont.nf2
                                fontFamily: Proxima Nova
                                color: "0x333333"                                   
                    - type: view
                      style:
                        marginTop: "0.032"
                        width: "0.27"
                        textAlign: 
                          x: right
                          y: center
                      children: 
                        - type: label
                          text: Cancel
                          dataKey: 
                          style:
                            display: inline-block
                            fontSize: .Nfont.nf4
                            color: "0x4c5264"
                            textDecoration: underline
                          onClick:
                            - actionType: popUpDismiss
                              popUpView: refundTag
                            - actionType: popUp
                              popUpView: moreOptionsTag
                        - type: button
                          text: Refund
                          onClick:
                            - actionType: evalObject
                              object:
                                - =.builtIn.math.cumulative: 
                                    dataIn: 
                                      numArr: =..formData.refundTotalArr   
                                    dataOut: Transactions.formData.refundTotal                                   
                                - =.builtIn.string.concat:
                                    dataIn:
                                      - "-"
                                      - =..formData.refundData.refundAmount              
                                    dataOut: Transactions.apiRequest.refundOrder.docReq.name.title
                                - =.builtIn.number.addition:
                                    dataIn:
                                      num: =..formData.refundTotal
                                      step: =..apiRequest.refundOrder.docReq.name.title
                                    dataOut: Transactions.formData.refundJudge
                                - if: 
                                  - =.builtIn.math.greater: 
                                      dataIn: 
                                        num1: =..formData.refundJudge
                                        num2: 0
                                  - continue
                                  - actionType: popUp
                                    popUpView: refundFailTag
                                    wait: true
                            - actionType: popUp
                              popUpView: warningView
                            - actionType: popUpDismiss
                              popUpView: refundTag
                          style:
                            marginLeft: "0.02"
                            border:
                              style: "1"
                            borderRadius: "5"
                            color: "0xffffff"
                            display: inline-block
                            fontSize: .Nfont.nf4
                            width: "0.055"
                            height: "0.038"
                            backgroundColor: "0xe24445"
                            fontWeight: "600"
                            textAlign:
                              x: center     
                              y: center
        # Refund Fail
        - .BaseWarningView:
          viewTag: refundFailTag
          msg2: The Refund amount is more than total amount
          # onClick: 
          #   - actionType: popUpDismiss
          #     popUpView: refundFailTag
          #   - actionType: popUp
          #     popUpView: refundTag
          style: 
            zIndex: "20"
        # 日历 start
        - type: popUp
          viewTag: startDateTag
          style:
            left: "0"
            top: "0"
            width: "1"
            height: "1" 
            backgroundColor: "0x00000033"
            zIndex: "100"
          children:
            - .BaseDate.calendar:
              children:
                - .BaseDate.calendarTitle:
                - .BaseDate.calendarCancel:
                - .BaseDate.calendarHeader:
                  children:
                    - .BaseDate.newMonthView:
                    - .BaseDate.newYearView:
                - .BaseDate.weekView:
                - .BaseDate.dayView:
                - .BaseDate.addButton:
                  onClick:
                    - actionType: evalObject
                      object:
                        - ..formData.updateCondition.beginDate@: =.BaseDate.calendarDate.todayDate
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: selectStartAndEndTag
                    - actionType: popUpDismiss
                      popUpView: startDateTag
        # 日历 end
        - type: popUp
          viewTag: endDateTag
          style:
            left: "0"
            top: "0"
            width: "1"
            height: "1" 
            backgroundColor: "0x00000033"
            zIndex: "100"
          children:
            - .BaseDate.calendar:
              children:
                - .BaseDate.calendarTitle:
                - .BaseDate.calendarCancel:
                - .BaseDate.calendarHeader:
                  children:
                    - .BaseDate.newMonthView:
                    - .BaseDate.newYearView:
                - .BaseDate.weekView:
                - .BaseDate.dayView:
                - .BaseDate.addButton:
                  onClick:
                    - actionType: evalObject
                      object:
                        - ..formData.updateCondition.endDate@: =.BaseDate.calendarDate.todayDate
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: selectStartAndEndTag
                    - actionType: popUpDismiss
                      popUpView: endDateTag








