AdminList:
  title:  Admin
  init:
    - ..apiRequest.facilityList.docAPI.get: ""
    - ..formData.adminList@: =..apiRequest.facilityList.response.doc
    - =.builtIn.array.splitTableList: 
        dataIn: 
          arrObj: =..formData.adminList
          numX: "12"
          numY: "1"
        dataOut: AdminList.formData.tableData
    - ..formData.tableList@: =..formData.tableData.0
    - =.builtIn.string.concat:
        dataIn:
          - =..formData.tablePageNum # page num
          - " / "
          - =..formData.tableData.1 # total page
        dataOut: AdminList.formData.tableCurrentPage # current page                           
    - =.builtIn.number.addition: # get totalPage+1 to verify legitimacy of gotoPageNum
        dataIn:
          num: =..formData.tableData.1
          step: "1"
        dataOut: AdminList.formData.totalPageMore # update page num       
    - =.builtIn.array.setPropertyInterlacedChange:
        dataIn:
          arrIn: =..formData.tableList
          arr: ["backgroundColor"]
          valueArr: ["0xf5f5f5"]
          errorArr: ["0xffffff"]    
  formData: 
    emptyFacility: ""
    searchFacility: ""
    searchFacilityArray: []  # 筛选需要输入数组，把当前的facility放进数组里
    adminList: []
    tableData: [] # sdk 返回的数组,包括当前显示第几页的数据list 和 被切分成总共多少页面
    tableList: [] # sdk 返回的数组的第一项，list真正打印的数据
    tablePageNum: "1" # previous和next 中间的文本显示的数据
    tableCurrentPage: "1" # 当前显示的当前页面/总页面
    gotoPageNum: "" # goto 后面的文本显示
    totalPageMore: "" # totalPage(tableData.1) + 1 
  apiRequest:
    # 被点击的facility的payment setting。获取提前方式
    facilityList:
      response: ""
      document: ""
      documentReq:
        id: ""
        xfname: "none"
        # type: .DocType.FacilityProfile
        ObjType: 28
        sfname: "{\"result\":\"D.*\", \"join\": \"INNER JOIN Vertex V on V.id = D.ovid\"}"       
        sCondition: V.type=20 AND D.type=271361
        _nonce: =.Global._nonce
        obfname: mtime
        maxcount: "100"
      docAPI:
        get:
          api: rd
          dataIn: apiRequest.facilityList.documentReq
          dataOut: AdminList.apiRequest.facilityList.response
  components:
    - .TotalView: 
      children: 
        - .SideMenuBar: 
          children:
            - .aitLogo:
            - .MenuBar:        
        - .TopBar: 
        - .InnerBodyView:
          children:
            - .TransactionsAndMoneyView: 
              children:
                - .PageTitleLabelHasReceivedMoney:
            - .ContentBar:
              viewTag: statementMainTag
              children:
                - type: view
                  style:
                    width: "0.76"
                    left: "0.028"
                    marginTop: "0.032"
                    display: flex
                    justifyContent: space-between
                  children:
                    - type: view
                      viewTag: searchTag
                      style:
                        height: "0.032"
                        display: inline-block
                      children: 
                        - type: image
                          path: searchGray.svg
                          style:
                            width: "0.01"
                            top: "0.008"
                            left: "0.008"
                            zIndex: "10"
                        - type: textField
                          placeholder: Search facility
                          dataKey: formData.searchFacility
                          style:
                            width: "0.64"
                            height: "0.032"
                            border: 
                              style: "3"
                            borderColor: "0xdedede"
                            borderRadius: "5px"
                            textIndent: 3em

                    - type: view
                      style:
                        display: flex
                        justifyContent: space-around
                        alignItems: center
                        width: "0.11"
                      children: 
                        # Update 按钮
                        - type: button
                          text: Update
                          style:
                            width: "0.06"
                            height: "0.036"
                            display: inline-block                        
                            backgroundColor: "0x0063a8"
                            color: "0xffffff"
                            fontWeight: "500"
                            borderRadius: "3"
                            fontSize: .Nfont.n6_1_1
                            border: 
                              style: "1"
                            textAlign:
                              x: center
                              y: center
                          onClick:
                            - actionType: evalObject
                              object:
                                - =.builtIn.array.vagueFilterArrayByPath:
                                    dataIn:
                                      objArr: =..formData.adminList
                                      path: name.data.basicInfo.medicalFacilityName
                                      compareStr: =..formData.searchFacility
                                    dataOut: AdminList.formData.adminList
                                - =.builtIn.array.splitTableList: 
                                    dataIn: 
                                      arrObj: =..formData.adminList
                                      numX: "12"
                                      numY: "1"
                                    dataOut: AdminList.formData.tableData
                                - ..formData.tableList@: =..formData.tableData.0
                                - =.builtIn.string.concat:
                                    dataIn:
                                      - =..formData.tablePageNum # page num
                                      - " / "
                                      - =..formData.tableData.1 # total page
                                    dataOut: AdminList.formData.tableCurrentPage # current page                           
                                - =.builtIn.number.addition: # get totalPage+1 to verify legitimacy of gotoPageNum
                                    dataIn:
                                      num: =..formData.tableData.1
                                      step: "1"
                                    dataOut: AdminList.formData.totalPageMore # update page num       
                                - =.builtIn.array.setPropertyInterlacedChange:
                                    dataIn:
                                      arrIn: =..formData.tableList
                                      arr: ["backgroundColor"]
                                      valueArr: ["0xf5f5f5"]
                                      errorArr: ["0xffffff"]          
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: searchTag
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableView
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableFooter
                        - type: button
                          text: Revise
                          onClick:
                            - actionType: evalObject
                              object:
                                - ..formData.adminList@: =..apiRequest.facilityList.response.doc
                                - =.builtIn.array.splitTableList: 
                                    dataIn: 
                                      arrObj: =..formData.adminList
                                      numX: "12"
                                      numY: "1"
                                    dataOut: AdminList.formData.tableData
                                - ..formData.tableList@: =..formData.tableData.0
                                - =.builtIn.string.concat:
                                    dataIn:
                                      - =..formData.tablePageNum # page num
                                      - " / "
                                      - =..formData.tableData.1 # total page
                                    dataOut: AdminList.formData.tableCurrentPage # current page                           
                                - =.builtIn.number.addition: # get totalPage+1 to verify legitimacy of gotoPageNum
                                    dataIn:
                                      num: =..formData.tableData.1
                                      step: "1"
                                    dataOut: AdminList.formData.totalPageMore # update page num       
                                - =.builtIn.array.setPropertyInterlacedChange:
                                    dataIn:
                                      arrIn: =..formData.tableList
                                      arr: ["backgroundColor"]
                                      valueArr: ["0xf5f5f5"]
                                      errorArr: ["0xffffff"]                                       
                                - ..formData.searchFacility@: ""
                                - ..formData.searchFacilityArray@: []
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: searchTag
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableView
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableFooter                                
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableView
                          style:
                            textDecoration: underline
                            display: inline-block   
                            fontSize: .Nfont.n6_1_1
                            backgroundColor: "0xffffff"
                            color: "0x0063a8"
                            textAlign:
                              x: center
                              y: center
                            border: 
                              style: "1"
                # 表格
                - type: scrollView
                  style:
                    width: "0.8"
                    height: "0.7"
                    left: "0.02"
                    borderRadius: "5"
                    marginTop: "0.01"
                  children: 
                    - type: list
                      contentType: listObject
                      listObject: ..formData.tableList
                      iteratorVar: itemObject
                      viewTag: tableView
                      style:
                        width: '0.79'
                        left: "0.008"
                        height: "auto"
                        margin: "0"
                        float: left
                      children:
                        - type: listItem
                          itemObject: 
                          style:
                            marginTop: "0.02"
                            display: inline-block
                            width: '0.195'
                            height: '0.17'
                            boxSizing: border-box
                            boxShadow: "1px "
                            marginBottom: "0.01"
                          children:
                            - .ScheduleSettingsLiView:
                              children:
                                - type: image
                                  path: addLoc.svg
                                  path=func: .builtIn.utils.prepareDocToPath
                                  dataKey: itemObject.name.data.basicInfo.businessLogo
                                  style: 
                                    left: "0.02"
                                    top: "0.06"
                                    height: "0.076"
                                    width: "0.043"
                                    borderRadius: "50"
                                    # border: 
                                    #   style: "3"
                                    # borderColor: "0xc1c1c1"
                                    # borderWidth: "1"
                                    textAlign:  
                                      x: center
                                      y: center
                                - type: label
                                  dataKey: itemObject.name.data.basicInfo.medicalFacilityName
                                  style:
                                    left: "0.02"
                                    top: "0.02"
                                    fontSize: .Nfont.nf4
                                    fontWeight: "600"
                                    fontFamily: "Arial"
                                    overflow: hidden
                                    textOverflow: ellipsis
                                    whiteSpace: nowrap                                
                                    color: 
                                    width: "0.1"
                                - type: label
                                  text: Pending
                                  dataKey: itemObject.name.data.basicInfo.status
                                  style:  
                                    left: "0.07"
                                    top: "0.06"
                                    width: "0.1"
                                    fontSize: .Nfont.nf2
                                    fontFamily: "sans-serif"
                                    color: itemObject.name.data.basicInfo.statusColor
                                    overflow: hidden
                                    textOverflow: ellipsis
                                    whiteSpace: nowrap                                    
                                - type: label
                                  text: 
                                  dataKey: itemObject.name.data.basicInfo.fullInfo
                                  style:  
                                    left: "0.07"
                                    top: "0.09"
                                    width: "0.1"
                                    fontSize: .Nfont.nf2
                                    fontFamily: "sans-serif"
                                    color: "0x666666"
                                    overflow: hidden
                                    textOverflow: ellipsis
                                    whiteSpace: nowrap
                                - type: view
                                  style:  
                                    left: "0.012"
                                    width: "0.152"
                                    height: "0.04"
                                    top: "0.12"
                                    # backgroundColor: "0xff0000"
                                  children: 
                                #     - type: button
                                #       text: Enter here
                                #       onClick:
                                #         - emit: 
                                #             dataKey: 
                                #               var: itemObject
                                #             actions:
                                #               - .Global.formData.paymentEdgeID@: $var.id
                                #         - goto: TransactionsAngle
                                #       style:
                                #         width: "0.07"
                                #         height: "0.03"
                                #         fontSize: .Nfont.nf2
                                #         fontFamily: "Arial"
                                #         boxSizing: border-box
                                #         display: inline-block
                                #         color: "0x005795"
                                #         backgroundColor: "0xffffff"
                                #         border: 
                                #           style: "3"
                                #         borderWidth: "1"
                                #         borderColor: "0x005795"
                                #         borderRadius: "5"
                                #         textAlign:
                                #           x: center
                                #           y: center
                                    - type: label
                                      text: View
                                      onClick:  
                                        - emit: 
                                            dataKey: 
                                              var: itemObject
                                            actions:
                                              - actionType: updateObject
                                                dataKey: Global.formData.currentFacility
                                                dataObject: {}                                             
                                              - .Global.formData.currentFacility@: $var  
                                              - =.builtIn.string.concat:
                                                  dataIn:
                                                    - =.Config.searchLink
                                                    - "/index.html?FacilityDetailLink&id="
                                                    - $var.name.data.basicInfo.locationID
                                                    # - " "
                                                  dataOut: Global.formData.facilityLink                                                                                
                                        - goto: FacilityInfo1                               
                                      style:
                                        width: "0.05"
                                        left: "0.1"
                                        height: "0.04"
                                        fontSize: .Nfont.nf3
                                        fontFamily: "Arial"                                    
                                        # boxSizing: border-box
                                        color: "0x005795"
                                        backgroundColor: "0xffffff"
                                        display: inline-block
                                        # border: 
                                        #   style: "2"
                                        # borderWidth: "1"
                                        # borderColor: "0x005795"
                                        borderRadius: "5"
                                        textDecoration: underline
                                        textAlign:
                                          x: center
                                          y: center
                                       
            # TableFooter
            - type: view
              viewTag: tableFooter
              style:
                .TableFooterView:
                top: "0.857"
              children:   
                - type: view
                  style:
                    top: "0.005"
                    width: "0.08"
                    height: "0.0155"
                  children:
                    - type: label
                      text: "Current page:"
                      style:
                        display: inline-block
                        fontSize: .Nfont.nf0
                        color: "0x333333"
                        textAlign:
                          x: "center"
                          y: "center"
                    - type: label
                      dataKey: formData.tableCurrentPage
                      style:
                        marginLeft: "0.005"
                        display: inline-block
                        fontSize: .Nfont.nf0
                        color: "0x333333"
                        textAlign:
                          x: "center"
                          y: "center"
                # Previous & Next
                - type: view
                  style:
                    top: "0"
                    left: "0.076"
                    width: "0.05168"
                    height: "0.02576"
                  children:
                    - type: image
                      path: tableLeft.svg
                      onClick:
                        - actionType: evalObject
                          object:
                            - if: 
                              - =.builtIn.number.less: 
                                  dataIn: 
                                    num1: =..formData.tablePageNum
                                    num2: 2
                              - continue
                              - actionType: evalObject
                                object:
                                  # num - step
                                  - =.builtIn.number.Subtraction: 
                                      dataIn:
                                        num: =..formData.tablePageNum
                                        step: "1"
                                      dataOut: AdminList.formData.tablePageNum
                                  - =.builtIn.array.splitTableList: 
                                      dataIn: 
                                        arrObj: =..formData.adminList
                                        numX: "12"
                                        numY: =..formData.tablePageNum
                                      dataOut: AdminList.formData.tableData
                                  - ..formData.tableList@: =..formData.tableData.0
                                  - =.builtIn.string.concat: # re-concat
                                      dataIn:
                                        - =..formData.tablePageNum # page num
                                        - " / "
                                        - =..formData.tableData.1 # total page
                                      dataOut: AdminList.formData.tableCurrentPage # current page                                       
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: tableView
                        - actionType: builtIn 
                          funcName: redraw
                          viewTag: tableFooter                               
                      style:
                        top: "0"
                        width: "0.01456"
                        height: "0.02576"
                    - type: label
                      viewTag: pageNumView
                      dataKey: formData.tablePageNum
                      style:
                        top: "0"
                        left: "0.01856"
                        width: "0.01446"
                        height: "0.02576"
                        fontSize: .Nfont.nf0
                        fontWeight: "500"
                        color: "0xffffff"
                        backgroundColor: "0x005795"
                        borderRadius: "3"
                        textAlign:
                          x: center
                          y: center
                    - type: image
                      path: tableRight.svg
                      onClick:
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: "" 
                        - actionType: evalObject
                          object:
                            - if: 
                              - =.builtIn.number.less: 
                                  dataIn: 
                                    num1: =..formData.tablePageNum
                                    num2: =..formData.tableData.1
                              - actionType: evalObject
                                object:
                                  - =.builtIn.number.addition: 
                                      dataIn:
                                        num: =..formData.tablePageNum
                                        step: "1"
                                      dataOut: AdminList.formData.tablePageNum # update page num
                                  - =.builtIn.array.splitTableList: 
                                      dataIn: 
                                        arrObj: =..formData.adminList
                                        numX: "12"
                                        numY: =..formData.tablePageNum
                                      dataOut: AdminList.formData.tableData
                                  - ..formData.tableList@: =..formData.tableData.0
                                  - =.builtIn.string.concat: # re-concat
                                      dataIn:
                                        - =..formData.tablePageNum # page num
                                        - " / "
                                        - =..formData.tableData.1 # total page
                                      dataOut: AdminList.formData.tableCurrentPage # current page 
                              - continue                           
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: tableView  
                        - actionType: builtIn 
                          funcName: redraw
                          viewTag: tableFooter
                      style:
                        top: "0"
                        left: "0.03712"
                        height: "0.02576"
                        width: "0.01456"
                # Go to
                - type: view
                  style:
                    top: "0"
                    left: "0.14"
                    width: "0.05"
                    height: "0.02496"
                  children:
                    - type: textField
                      viewTag: gotoView
                      dataKey: formData.gotoPageNum
                      style:
                        width: "0.02496"
                        top: "0"
                        height: "0.02576"
                        borderRadius: "3"
                        borderWidth: "1"
                        border:
                          style: "3"
                        boxSizing: border-box
                        borderColor: "0xd8d8d8"
                        fontSize: .Nfont.nf0
                        fontWeight: "500"
                        color: "0x333333"
                        textAlign: 
                          x: center 
                          y: center 
                    - type: button
                      text: "Go to"
                      style:
                        textDecoration: underline
                        left: "0.029"
                        top: "0"
                        height: "0.02576"
                        border:
                          style: "1"
                        fontSize: .Nfont.nf0
                        color: "0x333333"
                        backgroundColor: "0xffffff00"
                      onClick:
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: ""                           
                        - actionType: evalObject
                          object:
                            # gotoPageNum ?> 1
                            - if:
                              - =.builtIn.number.less: 
                                  dataIn: 
                                    num1: =..formData.gotoPageNum
                                    num2: 1
                              - continue
                              - actionType: evalObject
                                object:
                                  # gotoPageNum ?< totalPage+1
                                  - if: 
                                    - =.builtIn.number.less: 
                                        dataIn: 
                                          num1: =..formData.gotoPageNum
                                          num2: =..formData.totalPageMore
                                    - actionType: evalObject
                                      object:
                                        - =.builtIn.array.splitTableList: 
                                            dataIn: 
                                              arrObj: =..formData.adminList
                                              numX: "12"
                                              numY: =..formData.gotoPageNum
                                            dataOut: AdminList.formData.tableData
                                        - ..formData.tableList@: =..formData.tableData.0
                                        - =.builtIn.string.concat: # re-concat
                                            dataIn:
                                              - =..formData.gotoPageNum # page num
                                              - " / "
                                              - =..formData.tableData.1 # total page
                                            dataOut: AdminList.formData.tableCurrentPage # current page
                                        - ..formData.tablePageNum@: =..formData.gotoPageNum
                                        - ..formData.gotoPageNum@: ""
                                    - continue                        
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: tableView 
                        - actionType: builtIn 
                          funcName: redraw
                          viewTag: tableFooter      