ProviderNotes:
  title: "Medical Documents"
  init:
    - .SignInCheck
    # 清空 unPageName
    - actionType: updateObject
      dataKey: Global.formData.unPageName
      dataObject: .EmptyObj
    - actionType: updateObject
      dataKey: Global.Note
      dataObject: .EmptyObj
    - actionType: updateObject
      dataKey: Global.DocReference.document
      dataObject: .EmptyObj
    - actionType: updateObject
      dataKey: Global.formData.newPatientForm
      dataObject: .EmptyObj
    - actionType: updateObject
      dataKey: Global.formData.pifzerVaccineFirDoseForm
      dataObject: .EmptyObj
    - actionType: updateObject
      dataKey: Global.formData.modernaVaccineFirDoseForm
      dataObject: .EmptyObj
    - actionType: updateObject
      dataKey: Global.formData.cov19TestNewPatForm
      dataObject: .EmptyObj
    - .Global.prescriptionArray@: []
    # - =.builtIn.utils.setTimer:
    #     dataIn:
    #       timeUnix: 2000
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""

    # get all medical documents from the waiting room
    - ..apiRequest.medicalDocuments.docAPI.get
    # init the doc list
    - ..formData.docList@: =..apiRequest.medicalDocuments.docQueryResp.doc
    # 暂时注释
    # - if:
    #     - =.builtIn.array.judgeListLength:
    #         dataIn:
    #           array: =.Global.currentMeetingDoc
    #           len: 0
    #     - actionType: evalObject
    #       object:
    #         - .Global.currentMeetingDoc@: =..apiRequest.medicalDocuments.docQueryResp.doc
    #     - continue

    # - =.builtIn.array.concatArray:
    #     dataIn:
    #       array1: =..formData.docList
    #       array2: =.Global.currentMeetingDoc
    #       sortby: ctime
    #       orders: desc
    #     dataOut: ProviderNotes.formData.docList
    # - =.builtIn.array.keepLatestDoc:
    #     dataIn:
    #       docList: =.ProviderNotes.formData.docList
    #       path: id
    #     dataOut: ProviderNotes.formData.docList

    - =.builtIn.array.setFormJumpPage:
        dataIn:
          objArry: =..formData.docList
          docFormObj: =.DocumentList
        dataOut: ProviderNotes.formData.docJumpList

    - actionType: evalObject
      object:
        - if:
            - =.builtIn.string.equal:
                dataIn:
                  string1: =.Global.formData.providerTitle
                  string2: ""
            - actionType: evalObject
              object:
                - =.builtIn.string.concat:
                    dataIn:
                      - =.Global.MyProfile.name.data.fullName
                      - " - "
                      - =.Global.MyProfile.name.data.title
                    dataOut: Global.formData.providerTitle
            - continue

  formData:
    flag: "none"
    tempData: ""
    tempDataId: ""
    docList: [] # 用于接收处理过的
    docLists: [] # 用于接收处理过的
    docJumpList: []
  formDataTemp:
    selectTemp:
      - key: Add
        path: add.svg
        pageName: ProviderNoteSelect
      - key: Macro
        path: macro.svg
        pageName: ProviderMacros
    titleData:
      - title: All
        fontColor: "0x2988e6"
        borderColor: "0x2988e6"
        backgroundColor: "0xe6effc"
        tagCategory: "All"
      - title: "Patient"
        fontColor: "0xf8ae29"
        borderColor: "0xfff4e0"
        backgroundColor: "0xfff4e0"
        tagCategory: classTag
      - title: "Provider"
        fontColor: "0x30b354"
        borderColor: "0xe4f5e9"
        backgroundColor: "0xe4f5e9"
        tagCategory: classTag
      - title: Admin
        fontColor: "0x005795"
        borderColor: "0xe9f2fc"
        backgroundColor: "0xe9f2fc"
        tagCategory: classTag
      - title: Private
        fontColor: "0x4c5264"
        borderColor: "0xececee"
        backgroundColor: "0xececee"
        tagCategory: statusTag
      - title: Released
        fontColor: "0x2988e6"
        borderColor: "0xdfedfc"
        backgroundColor: "0xdfedfc"
        tagCategory: statusTag
      - title: "@Me"
        fontColor: "0xfc3a3a"
        borderColor: "0xffeaea"
        backgroundColor: "0xffeaea"
        tagCategory: ""
  apiRequest:
    medicalDocuments:
      docQueryResp: ""
      docQueryReq:
        id: .Global.roomInfo.edge.id
        xfname: reid
        # patient profile need not display in the list
        sCondition: .DocumentQuery.ProviderAllMeetingDocuments
        obfname: ctime
        asc: false
        _nonce: =.Global._nonce
        maxcount: "100"
      docAPI:
        get:
          api: rd
          dataIn: ProviderNotes.apiRequest.medicalDocuments.docQueryReq
          dataOut: ProviderNotes.apiRequest.medicalDocuments.docQueryResp
  dataObject: .Global.roomInfo.edge
  components:
    - .BasePublicHeader:
      children:
        - .BasePublicHeaderLeft:
        - .BasePublicHeaderTitle:
        - .BasePublicHeaderRightIcon:
          path: more.svg
          style:
            height: "0.0344"
          onClick:
            - actionType: evalObject
              object:
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =..formData.flag
                          string2: "none"
                    - ..formData.flag@: "block"
                    - ..formData.flag@: "none"
            - actionType: builtIn
              funcName: redraw
              viewTag: selectTag

    - type: view
      style:
        width: "1"
        height: "auto"
        border:
          style: 2
        borderWidth: "1"
        borderColor: "0xdedede"
        boxSizing: "border-box"
        overflow: hidden
      children:
        - type: list
          viewTag: filterTag
          androidGrid: true
          contentType: listObject
          listObject: ..formDataTemp.titleData
          iteratorVar: itemObject
          style:
            margin: "0"
            width: "0.95"
            height: "auto"
            boxSizing: "border-box"
            overflow: hidden
          children:
            - type: listItem
              itemObject:
              style:
                width: "0.19"
                height: "auto"
                display: "inline-block"
                boxSizing: "border-box"
                overflow: hidden
              children:
                - type: label
                  dataKey: itemObject.title
                  style:
                    marginTop: "0.02"
                    marginLeft: "0.03"
                    height: "0.025"
                    width: "0.16"
                    fontSize: .Nfont.h12
                    color: itemObject.fontColor
                    border:
                      style: 3
                    borderColor: itemObject.borderColor
                    backgroundColor: itemObject.backgroundColor
                    fontWeight: "600"
                    boxSizing: "border-box"
                    borderRadius: "3"
                    textAlign:
                      x: center
                      y: center
                  onClick:
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - =.builtIn.object.setProperty:
                              dataIn:
                                obj: =..formDataTemp.titleData
                                label: "title"
                                text: $var.title
                                arr: ["borderColor"]
                                valueArr: $var.fontColor
                                errorArr: ["0x00000000"]
                          - =.builtIn.array.filterByTag:
                              dataIn:
                                sourceDoc: =..apiRequest.medicalDocuments.docQueryResp.doc
                                tagCategory: $var.tagCategory
                                tagName: $var.title
                              dataOut: ProviderNotes.formData.docList
                          - =.builtIn.array.concatArray:
                              dataIn:
                                array1: =..formData.docList
                                array2: []
                                sortby: ctime
                                orders: desc
                              dataOut: ProviderNotes.formData.docList
                          - =.builtIn.array.setFormJumpPage:
                              dataIn:
                                objArry: =..formData.docList
                                docFormObj: =.DocumentList
                              dataOut: ProviderNotes.formData.docJumpList
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: filterTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: docListTag
        - type: view
          style:
            marginTop: "0.0198"
    - type: list
      viewTag: docListTag
      contentType: listObject
      listObject: ..formData.docJumpList
      iteratorVar: itemObject
      style:
        margin: "0"
        width: "1"
        height: "0.83"
        overflow: scroll
      children:
        - type: listItem
          itemObject:
          style:
            width: "1"
            height: "auto"
            left: "0"
            marginTop: "0"
            # border:
            #   style: 2
            # borderWidth: "1"
            # borderColor: "0xdedede"
            boxSizing: "border-box"
            overflow: hidden
          children:
            - type: view
              style:
                marginTop: "0.0173"
                marginLeft: "0.04"
                width: "0.92"
                height: "auto"
                overflow: hidden
              children:
                - type: label
                  dataKey: itemObject.name.title
                  style:
                    display: "inline-block"
                    width: "0.525"
                    height: "auto"
                    fontSize: .Nfont.h16
                    fontWeight: "600"
                    verticalAlign: top
                    wordBreak: "break-all"
                - type: view
                  style:
                    marginLeft: "0.058"
                    display: "inline-block"
                    verticalAlign: top
                    width: "0.16"
                    height: "auto"
                  children:
                    - type: label
                      dataKey: itemObject.name.data.classTag.name
                      style:
                        height: "0.025"
                        width: "0.16"
                        fontSize: .Nfont.h12
                        color: itemObject.name.data.classTag.fontColor
                        border:
                          style: 1
                        backgroundColor: itemObject.name.data.classTag.backgroundColor
                        fontWeight: "600"
                        boxSizing: "border-box"
                        borderRadius: "3"
                        textAlign:
                          x: center
                          y: center
                - type: view
                  style:
                    marginLeft: "0.013"
                    display: "inline-block"
                    verticalAlign: top
                    width: "0.16"
                    height: "auto"
                  children:
                    - type: view
                      style:
                        display: itemObject.name.data.statusTag.display
                        width: "auto"
                        height: "auto"
                      children:
                        - type: label
                          dataKey: itemObject.name.data.statusTag.name
                          style:
                            height: "0.025"
                            width: "0.16"
                            fontSize: .Nfont.h12
                            color: itemObject.name.data.statusTag.fontColor
                            border:
                              style: 1
                            backgroundColor: itemObject.name.data.statusTag.backgroundColor
                            fontWeight: "600"
                            boxSizing: "border-box"
                            borderRadius: "3"
                            textAlign:
                              x: center
                              y: center
            - type: view
              style:
                marginTop: "0.001"
                marginLeft: "0.04"
                width: "0.92"
                height: "auto"
                overflow: hidden
              children:
                - type: label
                  dataKey: itemObject.name.user
                  style:
                    display: "inline-block"
                    width: "0.42"
                    height: "auto"
                    fontSize: .Nfont.h14
                    verticalAlign: middle
                    wordBreak: "break-all"
                    color: "0x666666"
                - type: label
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: itemObject.mtime
                  style:
                    marginLeft: "0.08"
                    display: "inline-block"
                    width: "0.42"
                    height: "auto"
                    fontSize: .Nfont.h12
                    verticalAlign: middle
                    wordBreak: "break-all"
                    color: "0x999999"
                    textAlign:
                      x: right
            - type: view
              style:
                marginTop: "0.015"
                height: "0.0013"
                width: "1"
                backgroundColor: "0xdedede"
            - type: view
              style:
                marginTop: "0"
                height: "0.001"
          onClick:
            - emit:
                dataKey:
                  var: itemObject
                actions:
                  - ..formData.tempDataId@: $var.id
            - actionType: evalObject
              object:
                - =.builtIn.array.getObjectByArray:
                    dataIn:
                      array: =..formData.docList
                      key: "id"
                      value: =..formData.tempDataId
                    dataOut: ProviderNotes.formData.tempData

            # - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
            #   dataKey: Global.Note
            #   dataObject: =..formData.tempData
            - actionType: evalObject
              object:
                - .Global.DocReference.document@: ""
                - .Global.DocReference.document@: =.ProviderNotes.formData.tempData
                - .Global.Note@: ""
                - .Global.Note@: =.Global.DocReference.document
            - emit:
                dataKey:
                  var: itemObject
                actions:
                  - goto: $var.pageName
    - type: view
      viewTag: selectTag
      style:
        top: "0.0431"
        left: "0.68"
        width: "0.28"
        borderWidth: "1"
        borderRadius: "5"
        borderColor: "0xdedede"
        backgroundColor: "0xffffff"
        border:
          style: 3
        display: ..formData.flag
        zIndex: 200
      children:
        - type: list
          viewTag: selectTag
          contentType: listObject
          listObject: ..formDataTemp.selectTemp
          iteratorVar: itemObject
          style:
            width: "0.28"
            marginTop: "0"
            height: "auto"
            boxSizing: "border-box"
            borderRadius: "5"
            backgroundColor: "0xffffff"
            border:
              style: 1
            overflow: hidden
          children:
            - type: listItem
              itemObject:
              style:
                width: "0.28"
                height: "0.054"
                left: "0"
                marginTop: "0"
                borderWidth: "1px"
                borderColor: "0xf0f0f0"
                boxSizing: "border-box"
                border:
                  style: 2
                overflow: hidden
              children:
                - type: view
                  style:
                    width: "0.28"
                    height: "0.054"
                    textAlign:
                      y: center
                  children:
                    - type: view
                      style:
                        height: "auto"
                      children:
                        - type: image
                          path: itemObject.path
                          style:
                            marginLeft: "0.053"
                            display: "inline-block"
                            verticalAlign: middle
                            height: "0.024"
                        - type: label
                          dataKey: itemObject.key
                          style:
                            marginLeft: "0.0213"
                            display: "inline-block"
                            width: "auto"
                            height: "auto"
                            wordWrap: break-word
                            verticalAlign: middle
                            fontSize: .Nfont.h14
                            color: "0x333333"
              onClick:
                - emit:
                    dataKey:
                      var: itemObject
                    actions:
                      - goto: $var.pageName
