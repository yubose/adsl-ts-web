AppointmentSchedule: #xdpage:9
  title: "Schedule"
  init:
    - .SignInCheck
    - actionType: updateObject
      dataKey: Global.formData.appointment
      dataObject: .AppointmentSchedule.formData.appointment
    - actionType: updateObject
      dataKey: Global.formData.pageName
      dataObject: .EmptyObj

    - actionType: updateObject
      dataKey: Global.roomInfo.edge
      dataObject: .EmptyObj
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - actionType: evalObject
      object:
        - .BaseComponents.calendarDate.year@: ""
        - .BaseComponents.calendarDate.month@: ""
        - .BaseComponents.calendarDate.day@: ""
        - .BaseComponents.calendarDate.monthName@: ""
        - .BaseComponents.calendarDate.todayDate@: ""
        - .BaseComponents.calendarDate.flag@: ""
        - .BaseComponents.calendarDate.dayLable@: []
        - .BaseComponents.year@: []
        - .BaseComponents.flag: ""
        #生成年份
        - =.builtIn.date.generateYear:
            dataIn:
              last: 121
              next: 10
            dataOut: BaseComponents.year
        - =.builtIn.date.getYear:
            dataIn:
            dataOut: AppointmentSchedule.calendarDate.year

    # get month for calendar
    - actionType: evalObject
      object:
        - =.builtIn.date.getMonth:
            dataIn: ""
            dataOut: AppointmentSchedule.calendarDate.month
    # get Year for calendar
    - actionType: evalObject
      object:
        - =.builtIn.date.getYear:
            dataIn: ""
            dataOut: AppointmentSchedule.calendarDate.year
    - actionType: evalObject
      object:
        - =.builtIn.date.getDate:
            dataIn: ""
            dataOut: AppointmentSchedule.calendarDate.day
    # generate calendar according month and year
    - actionType: evalObject
      object:
        - =.builtIn.date.ShowDateByNumber:
            dataIn:
              year: =.AppointmentSchedule.calendarDate.year
              month: =.AppointmentSchedule.calendarDate.month
              day: =.AppointmentSchedule.calendarDate.day
            dataOut: AppointmentSchedule.selectDate
    - actionType: evalObject
      object:
        - =.builtIn.date.transformMonth:
            dataIn:
              month: =.AppointmentSchedule.calendarDate.month
            dataOut: AppointmentSchedule.calendarDate.monthName

    - actionType: evalObject
      object:
        - =.builtIn.string.concat:
            dataIn:
              - =.AppointmentSchedule.calendarDate.year
              - "-"
              - =.AppointmentSchedule.calendarDate.month
              - "-"
              - =.AppointmentSchedule.calendarDate.day
            dataOut: AppointmentSchedule.calendarDate.todayDate
    - actionType: evalObject
      object:
        - =.builtIn.date.getTimeStampOfDate:
            dataIn:
              date: =.AppointmentSchedule.calendarDate.todayDate
            dataOut: AppointmentSchedule.calendarDate.todayStamp

    - actionType: evalObject
      object:
        - =.builtIn.date.miniWeeklyCalendarArray:
            dataIn:
              year: =.AppointmentSchedule.calendarDate.year
              month: =.AppointmentSchedule.calendarDate.month
              today: =.AppointmentSchedule.calendarDate.day
              markDay: =.AppointmentSchedule.calendarDate.day
              color: "0xffffff"
              backgroundColor: "0x2988E6"
              todayColor: "0x2988e6"
              todayBackgroundColor: "0xffffff"
              currentDateTime: =.AppointmentSchedule.calendarDate.todayDate
              pastTimeColor: "0xbababa"
            dataOut: AppointmentSchedule.calendarDate.dayLable
    - actionType: evalObject
      object:
        - =.builtIn.string.concat:
            dataIn:
              - "E2.type=40000 AND "
              - "(E.stime<="
              - =.AppointmentSchedule.calendarDate.todayStamp.start
              - " AND "
              - "E.etime>="
              - =.AppointmentSchedule.calendarDate.todayStamp.start
              - " OR "
              - "E.stime>="
              - =.AppointmentSchedule.calendarDate.todayStamp.start
              - " AND "
              - "E.etime<="
              - =.AppointmentSchedule.calendarDate.todayStamp.end
              - " OR "
              - "E.stime<"
              - =.AppointmentSchedule.calendarDate.todayStamp.end
              - " AND "
              - "E.etime>="
              - =.AppointmentSchedule.calendarDate.todayStamp.end
              - ")"
              - " AND "
              - " E.type=40000 AND E.subtype&0xff in (1,6,100) AND E.tage&0x100 in (0)"
            dataOut: Global.scheduleScondition3
        - =.builtIn.string.concat:
            dataIn:
              - "E2.type=40000 AND "
              - "(E.stime<="
              - =.AppointmentSchedule.calendarDate.todayStamp.start
              - " AND "
              - "E.etime>="
              - =.AppointmentSchedule.calendarDate.todayStamp.start
              - " OR "
              - "E.stime>="
              - =.AppointmentSchedule.calendarDate.todayStamp.start
              - " AND "
              - "E.etime<="
              - =.AppointmentSchedule.calendarDate.todayStamp.end
              - " OR "
              - "E.stime<="
              - =.AppointmentSchedule.calendarDate.todayStamp.end
              - " AND "
              - "E.etime>="
              - =.AppointmentSchedule.calendarDate.todayStamp.end
              - ")"
              - " AND "
              - "E.type=40000 AND E.subtype in (10) AND E2.subtype in (0x60006,0x60064,0xa0006,0xa0064,0xc0006,0xc0064) AND E2.tage>=0"
            dataOut: Global.roomScondition4
    - actionType: evalObject
      object:
        - ..schedule.scheduleList.edge@: []
        - ..scheduleReGet.scheduleList.edge@: []
        - ..apiRequest.scheduleList.scheduleList.edge@: []
        - ..formData.ids@: []
        - =.builtIn.array.concat:
            dataIn:
              array1: =..formData.ids
              array2: =.Global.formData.currentFacility.alllocationId
            dataOut: AppointmentSchedule.formData.ids
        - =.builtIn.array.push:
            dataIn:
              messages: =..formData.ids
              newMessage: =.Global.currentFacility.id
            dataOut: AppointmentSchedule.formData.ids
        - =.builtIn.array.push:
            dataIn:
              messages: =..formData.ids
              newMessage: =.Global.currentUser.vertex.id
            dataOut: AppointmentSchedule.formData.ids
    - ..scheduleSetting.get
    - ..schedule.get
    - ..apiRequest.listRoomData.get
    - =.builtIn.array.concatArray:
        dataIn:
          array1: =..schedule.scheduleList.edge
          array2: =..apiRequest.listRoomData.response.edge
          sortby: "stime"
          orders: "asc"
        dataOut: AppointmentSchedule.schedule.scheduleList.edge
    # - ..scheduleReGet.get
    - actionType: evalObject
      object: #合并数据并排序
        - =.builtIn.date.AddHeightByTimeSpan:
            dataIn:
              object: =..schedule.scheduleList.edge
            dataOut: AppointmentSchedule.formData.response

    - actionType: evalObject
      object:
        - .Global.scheduleId@: =.AppointmentSchedule.scheduleSetting.schedule.edge.0.id
    # - ..requestList.get
    # - actionType: evalObject
    #   object:
    #     - =.builtIn.array.getListLength:
    #         dataIn:
    #           object: =..requestList.requestData.edge
    #         dataOut: AppointmentSchedule.patientNumber
    # - actionType: evalObject
    #   object:
    #     - =.builtIn.array.getListLength:
    #         dataIn:
    #           object: =..requestList.requestData.edge
    #         dataOut: Global.requestListNum
    # - if:
    #     - =.builtIn.string.equal:
    #         dataIn:
    #           string1: =.Global.requestListNum
    #           string2: "0"
    #     - ..requestListHidden@: "true"
    #     - ..requestListHidden@: "false"
    #获取未读邮件数量
    - actionType: evalObject
      object:
        - =..apiRequest.unReadEmail.docAPI.get: ""
        - =.builtIn.array.getListLength:
            dataIn:
              object: =..apiRequest.unReadEmail.docQueryResp.doc
            dataOut: AppointmentSchedule.formData.unReadEmailNum
        - if:
            - =.builtIn.string.equal:
                dataIn:
                  string1: =..formData.unReadEmailNum
                  string2: "0"
            - ..formData.inboxHidden@: "true"
            - ..formData.inboxHidden@: "false"

    - =.builtIn.object.setTimeProperty:
        dataIn:
          obj: =..formData.response
        dataOut: AppointmentSchedule.formData.manageList
    - actionType: updateObject
      dataKey: Global.clock
      dataObject: .EmptyObj
  #获取未读邮件
  apiRequest:
    unReadEmail:
      docQueryResp: ""
      docQueryReq:
        id: .Global.currentUser.vertex.id
        ObjType: 544
        type: 1281
        sCondition: E.type=10002 AND (D2.Type&0xFF02=0xE00 OR D2.reid IS NULL OR D2.Type = 66561)
        xfname: (E.bvid|E.evid)&!D.ovid
        obfname: ctime
        maxcount: "100"
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: AppointmentSchedule.apiRequest.unReadEmail.docQueryReq
          dataOut: AppointmentSchedule.apiRequest.unReadEmail.docQueryResp
    listRoomData:
      response:
        edge: []
      edge:
        ObjType: "4"
        id:
          - =.Global.currentUser.vertex.id
          - =.Global.currentFacility.id
        xfname: "E.evid,E.Bvid"
        sCondition: =.Global.roomScondition4
        maxcount: "100"
        obfname: "stime"
        asc: true
        _nonce: =.Global._nonce
      get:
        .EdgeAPI.get: ""
        api: re
        dataIn: apiRequest.listRoomData.edge
        dataOut: apiRequest.listRoomData.response
  flag: false
  selectDate: ""
  timeSlot: 60
  splitTime: []
  patientNumber: "0"
  requestListHidden: "true"
  # requestList:
  #   requestData: ""
  #   edgeReq:
  #     id:
  #       - .Global.currentFacility.id
  #       - .Global.currentUser.vertex.id
  #     maxcount: "10000"
  #     ObjType: 20
  #     xfname: "(,E.evid)&(,E2.evid)"
  #     obfname: "ctime"
  #     sCondition: "E2.type=40000 AND E2.subtype in (196609,131073) AND E.type = 40000 AND E.subtype in (196610,131074)"
  #     asc: false
  #     _nonce: =.Global._nonce
  #   get:
  #     api: re
  #     dataIn: AppointmentSchedule.requestList.edgeReq
  #     dataOut: requestList.requestData
  # get subtype=3 edge
  scheduleSetting:
    response: ""
    schedule:
      edge: ""
    get:
      .EdgeAPI.get: ""
      api: re
      dataKey: scheduleSetting.schedule
      type: 40000
      id: .Global.currentUser.vertex.id
      sCondition: "subtype=65535" #会议中的大于65535
      xfname: "bvid"
      maxcount: "1"
      obfname: "ctime"
      _nonce: =.Global._nonce
  resetData:
    - name:
        roomName: "today dont have appoinment"
  # get all edge include available (subtype=1) accepted(subtype=5)
  teleMedicine:
    edgeRes: ""
    edgeReq:
      ObjType: 4
      obfname: stime
      sCondition: (E.type=40000 OR E.type = 1053) AND E2.type=40000  AND E2.subtype in (0x30006,0x20006,0x30064) AND E2.tage=0
      xfname: E.bvid|E.evid
      _nonce: =.Global._nonce
    edgeAPI:
      get:
        api: re
        dataIn: AppointmentSchedule.teleMedicine.edgeReq
        dataOut: AppointmentSchedule.teleMedicine.edgeRes
  schedule:
    scheduleList:
      edge:
    get:
      .EdgeAPI.get: ""
      api: re
      dataIn: schedule.edge
      dataOut: AppointmentSchedule.schedule.scheduleList
    edge:
      ObjType: 20
      # type: 40000
      id: =..formData.ids
      sCondition: =.Global.scheduleScondition3
      maxcount: "10000"
      xfname: "E2.evid,E2.Bvid"
      obfname: "stime"
      asc: true
      _nonce: "=.Global._nonce"
  save:
    - =.AppointmentSchedule.newAppointment.edgeAPI.store: ""
  newAppointment:
    edge:
      .Edge: ""
      evid: .Global.currentUser.vertex.id
      # evid: .Global.InviteInfo.evid
      bvid: .Global.currentUser.vertex.id
      id: ""
      refid: "" #the_selected_time_slot_edge.id
      subtype: 2
      type: 40000
      name:
        patientName: .Global.currentUser.vertex.name.userName
        date: ""
    edgeAPI:
      .EdgeAPI: ""
      store:
        api: ce
        dataIn: newAppointment.edge
        dataOut: newAppointment.response
  todaySchedule: ""
  formData:
    color: "0xbababa"
    ids: []
    manageList: []
    appointment:
      status: "0"
      visitType: ""
      addressName: ""
      locationId: ""
      selectDate: ""
      selectData:
        duration: ""
        reason: ""
        docu: ""
      selectTime: []
    response: []
    unReadEmailNum: "0"
    inboxHidden: "true"
    tempData: ""
    tempDataId: ""
  calendarDate:
    month: ""
    year: ""
    day: ""

    dayLable: []
    weekLabel:
      - key: SU
      - key: MO
      - key: TU
      - key: WE
      - key: TH
      - key: FR
      - key: SA
    todayDate: "YYYY-MM-DD"
    calendarDate:
    Scondition: ""
    todayStamp:
      start: ""
      end: ""
    monthName: ""
    tempDate: ""
  components:
    - .ProgressCheckView: ""
      message: "loading ..."
      viewTag: uploading
    # - .noOrganizationMessage:
    - .TipsOneLine:
      message: Please add a facility
      viewTag: noOrganizationView
    - .BaseHeader:
    - .HeaderRightImg:
      path: setting.svg
      onClick:
        - actionType: evalObject
          object:
            - if:
                - =.Global.hasOrganization
                - goto: ScheduleProfile
                - actionType: popUp
                  popUpView: noOrganizationView
                  popUpDismiss: 2000
    - type: view
      viewTag: setSchedule
      style:
        marginTop: "0.099"
        marginLeft: "0"
        width: "1"
        height: "auto"
        backgroundColor: "0x2988e6"
        overflow: hidden
      children:
        - type: view
          style:
            marginTop: "0.01"
            marginLeft: "0.05"
            height: "0.04"
            width: "0.9"
          children:
            - type: select
              dataKey: calendarDate.monthName
              options: .BaseComponents.month
              style:
                verticalAlign: "middle"
                display: "inline-block"
                width: "0.15"
                height: "0.03"
                boxSizing: "border-box"
                border:
                  style: 1
                color: "0xffffff"
                fontSize: .Nfont.h1
                backgroundColor: "0x2988e6"
              onChange:
                - actionType: evalObject
                  object:
                    - .BaseComponents.calendarDate.monthName@: =..calendarDate.monthName
                    - .BaseComponents.calendarDate.year@: =..calendarDate.year
                    - =.builtIn.date.transformMonth:
                        dataIn:
                          month: =.BaseComponents.calendarDate.monthName
                          flag: 2
                        dataOut: AppointmentSchedule.calendarDate.month
                    - =.builtIn.date.calendarArray:
                        dataIn:
                          year: =.BaseComponents.calendarDate.year
                          month: =.BaseComponents.calendarDate.month
                          today: 1
                        dataOut: AppointmentSchedule.calendarDate.dayLable
                    - .BaseComponents.calendarDate.day@: 1
                    - =.builtIn.date.miniWeeklyCalendarArray:
                        dataIn:
                          year: =..calendarDate.year
                          month: =..calendarDate.month
                          today: 33
                          markDay: 1
                          color: "0xffffff"
                          backgroundColor: "0x2988E6"
                          todayColor: "0x2988e6"
                          todayBackgroundColor: "0xffffff"
                          currentDateTime: =..calendarDate.todayDate
                          pastTimeColor: "0xbababa"
                        dataOut: AppointmentSchedule.calendarDate.dayLable
                - actionType: builtIn
                  funcName: redraw
                  viewTag: setSchedule
            - type: select
              dataKey: calendarDate.year
              options: .BaseComponents.year
              style:
                verticalAlign: "middle"
                display: "inline-block"
                marginLeft: "0.02"
                width: "0.15"
                height: "0.03"
                boxSizing: "border-box"
                border:
                  style: 1
                color: "0xffffff"
                fontSize: .Nfont.h1
                backgroundColor: "0x2988e6"
              onChange:
                - actionType: evalObject
                  object:
                    - .BaseComponents.calendarDate.year@: =..calendarDate.year
                    - =.builtIn.date.transformYear:
                        dataIn:
                          year: =..calendarDate.year
                        dataOut: AppointmentSchedule.calendarDate.year
                    - =.builtIn.string.concat:
                        dataIn:
                          - =.AppointmentSchedule.calendarDate.year
                          - "-"
                          - =.AppointmentSchedule.calendarDate.month
                          - "-"
                          - =.AppointmentSchedule.calendarDate.day
                        dataOut: AppointmentSchedule.calendarDate.todayDate
                    - =.builtIn.date.miniWeeklyCalendarArray:
                        dataIn:
                          year: =..calendarDate.year
                          month: 1
                          today: 33
                          markDay: 1
                          color: "0xffffff"
                          backgroundColor: "0x2988E6"
                          todayColor: "0x2988e6"
                          todayBackgroundColor: "0xffffff"
                          currentDateTime: =..calendarDate.todayDate
                          pastTimeColor: "0xbababa"
                        dataOut: AppointmentSchedule.calendarDate.dayLable
                - actionType: evalObject
                  object:
                    - .AppointmentSchedule.calendarDate.month@: 1
                - actionType: evalObject
                  object:
                    - =.builtIn.date.transformMonth:
                        dataIn:
                          month: =..calendarDate.month
                        dataOut: AppointmentSchedule.calendarDate.monthName
                - actionType: builtIn
                  funcName: redraw
                  viewTag: setSchedule
            - type: label
              dataKey: AppointmentSchedule.selectDate
              style:
                verticalAlign: "middle"
                display: "inline-block"
                fontFamily: "Arial"
                height: "auto"
                width: "0.57"
                color: "0xffffff"
                fontSize: .Nfont.h1
                textAlign:
                  x: right

        - type: view
          style:
            marginTop: "0.01"
            height: "auto"
            width: "1"
          children:
            - type: view
              style:
                display: "inline-block"
                height: "0.08"
                width: "0.08"
                textAlign:
                  x: center
                boxSizing: "border-box"
              children:
                - type: image
                  path: leftDate.svg
                  style:
                    top: "0.02"
                    left: "0"
                    height: "0.05"
                    zIndex: 10
                  onClick:
                    - actionType: evalObject
                      object:
                        - =.builtIn.date.LastWeek:
                            dataIn:
                              year: =.AppointmentSchedule.calendarDate.dayLable.0.year
                              month: =.AppointmentSchedule.calendarDate.dayLable.0.month
                              day: =.AppointmentSchedule.calendarDate.dayLable.0.day
                            dataOut: AppointmentSchedule.calendarDate.tempDate
                        - =.builtIn.date.miniWeeklyCalendarArray:
                            dataIn:
                              year: =.AppointmentSchedule.calendarDate.tempDate.year
                              month: =.AppointmentSchedule.calendarDate.tempDate.month
                              today: =.AppointmentSchedule.calendarDate.day
                              markDay: =.AppointmentSchedule.calendarDate.tempDate.day
                              color: "0xffffff"
                              backgroundColor: "0x2988E6"
                              todayColor: "0x2988e6"
                              todayBackgroundColor: "0xffffff"
                              currentDateTime: =..calendarDate.todayDate
                              pastTimeColor: "0xbababa"
                            dataOut: AppointmentSchedule.calendarDate.dayLable
                    - actionType: evalObject
                      object:
                        - .AppointmentSchedule.calendarDate.year@: =.AppointmentSchedule.calendarDate.tempDate.year
                        - .AppointmentSchedule.calendarDate.month@: =.AppointmentSchedule.calendarDate.tempDate.month
                        - =.builtIn.date.transformMonth:
                            dataIn:
                              month: =.AppointmentSchedule.calendarDate.month
                            dataOut: AppointmentSchedule.calendarDate.monthName
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: setSchedule3

            - type: view
              style:
                display: "inline-block"
                height: "0.08"
                width: "0.84"
                boxSizing: "border-box"
              children:
                - type: list
                  contentType: listObject
                  listObject: ..calendarDate.dayLable
                  iteratorVar: itemObject
                  viewTag: setSchedule3
                  style:
                    axis: horizontal
                    width: "0.84"
                    height: "0.08"
                    boxSizing: "border-box"
                  children:
                    - type: listItem
                      itemObject: ""
                      style:
                        marginLeft: "0.01"
                        width: "0.11"
                        height: "0.08"
                        boxSizing: "border-box"
                        backgroundColor: itemObject.backgroundColor
                        borderRadius: "22px 22px 22px 22px"
                        overflow: hidden
                      children:
                        - type: label
                          dataKey: itemObject.weekDay
                          style:
                            marginTop: "0.01"
                            width: "0.1115"
                            color: itemObject.color
                            fontSize: .Nfont.h1
                            textAlign:
                              x: center
                            boxSizing: "border-box"
                        - type: label
                          dataKey: itemObject.day
                          style:
                            marginTop: "0.01"
                            width: "0.1115"
                            height: "0.045"
                            color: itemObject.color
                            fontSize: .Nfont.h2
                            borderRadius: "80"
                            textAlign:
                              x: center
                            boxSizing: "border-box"
                      onClick:
                        - actionType: popUp
                          popUpView: uploading
                        - emit:
                            dataKey:
                              var: itemObject
                            actions:
                              - .AppointmentSchedule.formData.response@: []
                              - ..schedule.scheduleList.edge@: []
                              - ..apiRequest.listRoomData.response.edge@: []
                              - ..scheduleReGet.scheduleList.edge@: []
                              - ..teleMedicine.edgeRes.edge@: []
                              - .AppointmentSchedule.calendarDate.year@: $var.year
                              - .AppointmentSchedule.calendarDate.month@: $var.month
                              - .AppointmentSchedule.calendarDate.day@: $var.day
                              - =.builtIn.date.ShowDateByNumber:
                                  dataIn:
                                    year: =.AppointmentSchedule.calendarDate.year
                                    month: =.AppointmentSchedule.calendarDate.month
                                    day: =.AppointmentSchedule.calendarDate.day
                                  dataOut: AppointmentSchedule.selectDate
                              - =.builtIn.date.transformMonth:
                                  dataIn:
                                    month: =.AppointmentSchedule.calendarDate.month
                                  dataOut: AppointmentSchedule.calendarDate.monthName
                              - =.builtIn.string.concat:
                                  dataIn:
                                    - =.AppointmentSchedule.calendarDate.year
                                    - "-"
                                    - =.AppointmentSchedule.calendarDate.month
                                    - "-"
                                    - =.AppointmentSchedule.calendarDate.day
                                  dataOut: AppointmentSchedule.calendarDate.todayDate
                              - =.builtIn.date.getTimeStampOfDate:
                                  dataIn:
                                    date: =.AppointmentSchedule.calendarDate.todayDate
                                  dataOut: AppointmentSchedule.calendarDate.todayStamp
                              - =.builtIn.date.miniWeeklyCalendarArray:
                                  dataIn:
                                    year: $var.year
                                    month: $var.month
                                    today: $var.day
                                    markDay: $var.day
                                    color: "0xffffff"
                                    backgroundColor: "0x2988E6"
                                    todayColor: "0x2988e6"
                                    todayBackgroundColor: "0xffffff"
                                    currentDateTime: =..calendarDate.todayDate
                                    pastTimeColor: "0xbababa"
                                  dataOut: AppointmentSchedule.calendarDate.dayLable
                              # get subtype=1 or subtype=5   userId = evid | bvid

                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: ""
                        - actionType: evalObject
                          object:
                            - =.builtIn.string.concat:
                                dataIn:
                                  - "E2.type=40000 AND "
                                  - "(E.stime<="
                                  - =.AppointmentSchedule.calendarDate.todayStamp.start
                                  - " AND "
                                  - "E.etime>="
                                  - =.AppointmentSchedule.calendarDate.todayStamp.start
                                  - " OR "
                                  - "E.stime>="
                                  - =.AppointmentSchedule.calendarDate.todayStamp.start
                                  - " AND "
                                  - "E.etime<="
                                  - =.AppointmentSchedule.calendarDate.todayStamp.end
                                  - " OR "
                                  - "E.stime<"
                                  - =.AppointmentSchedule.calendarDate.todayStamp.end
                                  - " AND "
                                  - "E.etime>="
                                  - =.AppointmentSchedule.calendarDate.todayStamp.end
                                  - ")"
                                  - " AND "
                                  - " E.type=40000  AND E.subtype&0xff in (1,6,100) AND E.tage&0x100 in (0)"
                                dataOut: Global.scheduleScondition3
                            - =.builtIn.string.concat:
                                dataIn:
                                  - "E2.type=40000 AND "
                                  - "(E.stime<="
                                  - =.AppointmentSchedule.calendarDate.todayStamp.start
                                  - " AND "
                                  - "E.etime>="
                                  - =.AppointmentSchedule.calendarDate.todayStamp.start
                                  - " OR "
                                  - "E.stime>="
                                  - =.AppointmentSchedule.calendarDate.todayStamp.start
                                  - " AND "
                                  - "E.etime<="
                                  - =.AppointmentSchedule.calendarDate.todayStamp.end
                                  - " OR "
                                  - "E.stime<="
                                  - =.AppointmentSchedule.calendarDate.todayStamp.end
                                  - " AND "
                                  - "E.etime>="
                                  - =.AppointmentSchedule.calendarDate.todayStamp.end
                                  - ")"
                                  - " AND "
                                  - "E.type=40000 AND E.subtype in (10) AND E2.subtype in (0x60006,0x60064,0xa0006,0xa0064,0xc0006,0xc0064) AND E2.tage>=0"
                                dataOut: Global.roomScondition4
                            # - =..teleMedicine.edgeAPI.get: ""
                            - =..schedule.get: ""
                            - =..apiRequest.listRoomData.get: ""
                            - =.builtIn.array.concatArray:
                                dataIn:
                                  array1: =..schedule.scheduleList.edge
                                  array2: =..apiRequest.listRoomData.response.edge
                                  sortby: "stime"
                                  orders: "asc"
                                dataOut: AppointmentSchedule.schedule.scheduleList.edge
                            # - =..scheduleReGet.get: ""
                        - actionType: evalObject
                          object:
                            - =.builtIn.date.AddHeightByTimeSpan:
                                dataIn:
                                  object: =..schedule.scheduleList.edge
                                dataOut: AppointmentSchedule.formData.response

                            - =.builtIn.object.setTimeProperty:
                                dataIn:
                                  obj: =..formData.response
                                dataOut: AppointmentSchedule.formData.manageList
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: setSchedule3
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: schedule
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: setSchedule
                        - actionType: popUpDismiss
                          popUpView: uploading
            - type: view
              style:
                display: "inline-block"
                height: "0.08"
                width: "0.08"
                textAlign:
                  x: center
                boxSizing: "border-box"
              children:
                - type: image
                  path: rightDate.svg
                  style:
                    top: "0.02"
                    right: "0"
                    height: "0.05"
                  onClick:
                    - actionType: evalObject
                      object:
                        - =.builtIn.date.NextWeek:
                            dataIn:
                              year: =.AppointmentSchedule.calendarDate.dayLable.6.year
                              month: =.AppointmentSchedule.calendarDate.dayLable.6.month
                              day: =.AppointmentSchedule.calendarDate.dayLable.6.day
                            dataOut: AppointmentSchedule.calendarDate.tempDate
                        - =.builtIn.date.miniWeeklyCalendarArray:
                            dataIn:
                              year: =.AppointmentSchedule.calendarDate.tempDate.year
                              month: =.AppointmentSchedule.calendarDate.tempDate.month
                              today: =.AppointmentSchedule.calendarDate.day
                              markDay: =.AppointmentSchedule.calendarDate.tempDate.day
                              color: "0xffffff"
                              backgroundColor: "0x2988E6"
                              todayColor: "0x2988e6"
                              todayBackgroundColor: "0xffffff"
                              currentDateTime: =..calendarDate.todayDate
                              pastTimeColor: "0xbababa"
                            dataOut: AppointmentSchedule.calendarDate.dayLable
                    - actionType: evalObject
                      object:
                        - .AppointmentSchedule.calendarDate.year@: =.AppointmentSchedule.calendarDate.tempDate.year
                        - .AppointmentSchedule.calendarDate.month@: =.AppointmentSchedule.calendarDate.tempDate.month
                        - =.builtIn.date.transformMonth:
                            dataIn:
                              month: =.AppointmentSchedule.calendarDate.month
                            dataOut: AppointmentSchedule.calendarDate.monthName
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: setSchedule3
        - type: view
          style:
            marginTop: "0.02"
    - type: view
      style:
        marginTop: "0"
        height: "0.64"
        width: "1"
        overflow: hidden
      children:
        - type: view
          style:
            marginTop: "0.02"
            height: "auto"
            width: "9"
            marginLeft: "0.05"
            # backgroundColor: "yellow"
          children:
            # - .numberMark:
            #   dataKey: Global.requestListNum
            #   contentType: messageHidden
            #   style:
            #     left: "0.38"
            #     top: "-0.01"
            #     isHidden: ..requestListHidden
            #     zIndex: 10
            - type: view
              style:
                display: "inline-block"
                width: "0.42"
                height: "0.045"
                backgroundColor: "0xffffff"
                border:
                  style: "3"
                borderColor: "0x2fb355"
                borderWidth: "1"
                boxSizing: "border-box"
                borderRadius: "5"
              children:
                - type: image
                  path: newReq.svg
                  style:
                    marginLeft: "0.02"
                    display: "inline-block"
                    height: "0.02"
                    verticalAlign: middle
                - type: label
                  text: Overview
                  style:
                    marginLeft: "0.02"
                    height: "0.045"
                    display: "inline-block"
                    verticalAlign: middle
                    lineHeight: "4.5vh"
                    fontFamily: "Arial"
                    fontSize: .Nfont.h1
                    color: "0x2fb355"
                    textDecoration: underline
                    fontWeight: 600
              onClick:
                - actionType: evalObject
                  object:
                    - if:
                        - =.Global.hasOrganization
                        - actionType: evalObject
                          object:
                            #为后续跳转patient in waiting的id做准备
                            - .Global.ids@: []
                            - =.builtIn.array.concat:
                                dataIn:
                                  array1: =.Global.ids
                                  array2: =.Global.formData.currentFacility.alllocationId
                                dataOut: Global.ids
                            - =.builtIn.array.push:
                                dataIn:
                                  messages: =.Global.ids
                                  newMessage: =.Global.currentFacility.id
                                dataOut: Global.ids
                            - =.builtIn.array.push:
                                dataIn:
                                  messages: =.Global.ids
                                  newMessage: =.Global.currentUser.vertex.id
                                dataOut: Global.ids
                            - =.builtIn.string.concat:
                                dataIn:
                                  - " E2.type=40000 AND E.subtype in (0x20006,0x30006,0x20064,0x30064) AND E.type=40000 AND E.tage&0x100 in (0)"
                                dataOut: Global.queryScondition
                            - =.builtIn.string.concat:
                                dataIn:
                                  - "E.type = 1053 AND E.subtype in (110,120,130,140) AND E2.type=40000 AND E2.tage&0x100 in (0) AND E2.subtype in (0x20006,0x30006,0x20064,0x30064,0x60006,0x60064,0xa0006,0xa0064,0xc0006,0xc0064)"
                                dataOut: Global.queryScondition_participants    
                            - .Global.isGetRoom@: true
                            - goto: NewRequest
                        - actionType: popUp
                          popUpView: noOrganizationView
                          popUpDismiss: 2000

            - type: view
              style:
                marginLeft: "0.04"
                display: "inline-block"
                width: "0.44"
                height: "0.045"
                backgroundColor: "0xffffff"
                boxSizing: "border-box"
                border:
                  style: "3"
                borderColor: "0x2988e6"
                borderWidth: "1"
                borderRadius: "5"
              children:
                - type: image
                  path: createApp.svg
                  style:
                    marginLeft: "0.02"
                    display: "inline-block"
                    height: "0.02"
                    verticalAlign: middle
                    color: "0x2fb355"
                - type: label
                  text: Create Appointment
                  style:
                    display: "inline-block"
                    marginLeft: "0.015"
                    verticalAlign: middle
                    lineHeight: "4.5vh"
                    fontFamily: "Arial"
                    fontSize: .Nfont.h1
                    color: "0x2988e6"
                    textDecoration: underline
                    fontWeight: 600
                    height: "0.045"
              onClick:
                - actionType: evalObject
                  object:
                    - if:
                        - =.Global.hasOrganization
                        - goto: MobileContacts
                        - actionType: popUp
                          popUpView: noOrganizationView
                          popUpDismiss: 2000

        # - type: view
        #   style:
        #     marginTop: "0"
        #     height: "0.565"
        #     overflow: scroll
        #   children:
        - type: list
          viewTag: schedule
          contentType: listObject
          listObject: ..formData.manageList
          iteratorVar: itemObject
          style:
            width: "0.95"
            margin: "0"
            marginLeft: "0.05"
            height: "0.565"
            overflow: scroll
            boxSizing: "border-box"
          children:
            - type: listItem
              itemObject: ""
              style:
                marginTop: "0.01"
                width: "0.9"
                height: "auto"
                border:
                  style: 3
                borderColor: itemObject.name.borderColor
                borderWidth: "1"
                borderRadius: "5"
                backgroundColor: itemObject.name.backgroundColor
                boxSizing: "border-box"
                overflow: hidden
              children:
                - type: view
                  style:
                    marginLeft: "0.05"
                    marginTop: "0.015"
                    height: "auto"
                    width: "0.85"
                    boxSizing: "border-box"
                  children:
                    - type: label
                      dataKey: itemObject.name.visitReason
                      style:
                        display: "inline-block"
                        width: "0.55"
                        fontFamily: "Arial"
                        fontSize: .Nfont.h15
                        verticalAlign: middle
                        boxSizing: "border-box"
                    - type: label
                      dataKey: itemObject.name.visitType
                      style:
                        display: "inline-block"
                        width: "0.25"
                        fontFamily: "Arial"
                        verticalAlign: middle
                        fontSize: .Nfont.h1
                        color: itemObject.name.fontColor
                        boxSizing: "border-box"
                        textAlign:
                          x: right
                - type: view
                  style:
                    marginLeft: "0.05"
                    marginTop: "0.01"
                    height: "auto"
                    width: "0.85"
                    boxSizing: "border-box"
                  children:
                    - type: image
                      path: waitTime.svg
                      style:
                        display: "inline-block"
                        height: "0.018"
                        verticalAlign: middle
                        boxSizing: "border-box"
                    - type: label
                      text=func: .builtIn.date.ShowTimeSpan
                      dataKey: itemObject
                      style:
                        marginLeft: "0.015"
                        display: "inline-block"
                        fontFamily: "Arial"
                        fontSize: .Nfont.h1
                        verticalAlign: middle
                        color: "0x5a5a5a"
                        boxSizing: "border-box"
                - type: view
                  style:
                    marginTop: "0.015"
                    boxSizing: "border-box"
              onClick:
                - emit:
                    dataKey:
                      var: itemObject
                    actions:
                      - ..formData.tempDataId@: $var.id
                - actionType: evalObject
                  object:
                    - =.builtIn.array.getObjectByArray:
                        dataIn:
                          array: =..formData.response
                          key: "id"
                          value: =..formData.tempDataId
                        dataOut: AppointmentSchedule.formData.tempData
                # - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                #   dataKey: Global.roomInfo.edge
                #   dataObject: ..formData.tempData

                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.tempData
                        - actionType: evalObject
                          object:
                            - if:
                                - =.builtIn.number.typeIsValid:
                                    dataIn:
                                      docType: =..formData.tempData.subtype
                                      localArr: [1]
                                      binaryArr: [1]
                                - continue
                                - actionType: evalObject
                                  object:
                                    - .Global.roomInfo.edge@: =..formData.tempData
                                    - actionType: updateObject
                                      dataKey: Global.currentMeetingDoc
                                      dataObject: []
                                    - if:
                                        - =.builtIn.number.typeIsValid:
                                            dataIn:
                                              docType: =..formData.tempData.subtype
                                              localArr: [17]
                                              binaryArr: [1]
                                        - goto: AppointmentLobby
                                        - goto: AppointmentLobbyOfficeVisit
                        - continue
    - .footerBox:
      style:
        top: "0.9"
      children:
        - .footerMenuBox:
          onClick:
            - goto: "Dashboard"
          children:
            - .footerMenuImg:
              path: dashboard0.svg
            - .footerMenuLabel:
              text: Dashboard

        - .footerMenuBox:
          onClick:
            - goto: "InboxDashboard"
          children:
            - .footerMenuImg:
              path: inbox0.svg
            - .footerMenuLabel:
              text: Inbox
            - .numberMark:
              dataKey: formData.unReadEmailNum
              style:
                isHidden: ..formData.inboxHidden

        - .footerMenuBox:
          onClick:
            - goto: AppointmentSchedule
          children:
            - .footerMenuImg:
              path: schedule0Yellow.svg
            - .footerMenuLabel:
              text: Schedule
              style:
                color: "0xfece55"
            - .numberMark:
              dataKey: Global.requestListNum
              style:
                isHidden: ..requestListHidden

        - .footerMenuBox:
          onClick:
            - goto: MenuBars
          children:
            - .footerMenuImg:
              path: me.svg
            - .footerMenuLabel:
              text: Me

    # - type: popUp
    #   viewTag: setSchedule
    #   style:
    #     width: "1"
    #     height: "0.4"
    #     top: "0.3"
    #     left: "0"
    #     backgroundColor: "0x000000"
