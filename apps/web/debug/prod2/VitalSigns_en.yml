#For Android Only
VitalSigns:
  title: "Vital Signs"
  init:
    - .SignInCheck
    - =..apiRequest.vital.docAPI.get: ""
    - =.builtIn.array.getListLength:
        dataIn:
          object: =..apiRequest.vital.docQueryResp.doc
        dataOut: VitalSigns.formData.VitalNum
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =..formData.VitalNum
              string2: "0"
        - continue
        - actionType: evalObject
          object:
            - .VitalSigns.apiRequest.vital.docCreateReq.id@: =.VitalSigns.apiRequest.vital.docQueryResp.doc.0.id
            - .VitalSigns.tempVitalsData@: =.VitalSigns.apiRequest.vital.docQueryResp.doc.0.name.data
    - if: 
      - .builtIn.isAndroid
      - ..blueTooth@: false
      - ..blueTooth@: true  
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - actionType: builtIn
      funcName: autoRefresh
      viewTag: dataList
      frequency: 1000
  isConnectedTemp: "false"
  currentVital: ""
  blueTooth: true
  tempVitalsData:
    - time: " "
      id: "bp"
      measurements: []
      label1: "Blood Pressure"
      label2: "Heart Rate"
      unit1: "mmHg"
      unit2: "bpm"
      data1: " "
      data2: " "
      imgPath: vitalsHeart.png
    - time: " "
      id: "resp"
      measurements: []
      label1: "Respiratory Rate"
      unit1: "breaths/min"
      data1: " "
      data2: VITALS_DATA_HIDE_TEXTFIELD
      imgPath: vitalsGeneric.png
    - time: " "
      id: "spo2"
      measurements: []
      label1: "Pulse Oximetry"
      label2: "Heart Rate"
      unit1: "O₂ %"
      unit2: "bpm"
      data1: " "
      data2: " "
      imgPath: vitalsGeneric.png
    - time: " "
      id: "temp"
      measurements: []
      label1: "Temperature"
      unit1: "°F/°C"
      data1: " "
      data2: VITALS_DATA_HIDE_TEXTFIELD
      imgPath: vitalsTemperature.png
    - time: " "
      id: "height"
      measurements: []
      label1: "Height"
      unit1: "ft."
      unit2: "in."
      data1: " "
      data2: " "
      imgPath: vitalsHeight.png
    - time: " "
      id: "weight"
      measurements: []
      label1: "Weight"
      unit1: "lbs"
      data1: " "
      data2: VITALS_DATA_HIDE_TEXTFIELD
      imgPath: vitalsWeight.png
    - time: " "
      id: "bmi"
      measurements: []
      label1: "Body Mass Index (BMI)"
      unit1: "kg/m²"
      data1: " "
      data2: VITALS_DATA_HIDE_TEXTFIELD
      imgPath: vitalsBMI.png
  formData:
    VitalNum: "0"
  apiRequest:
    vital:
      docQueryResp: ""
      docQueryReq:
        id:
          - .Global.roomInfo.edge.id
          - .Global.roomInfo.edge.id
        xfname: "eid,reid"
        type: .DocType.VitalSigns
        _nonce: =.Global._nonce
      docCreateReq:
        .Document: ""
        eid: .Global.currentRoom.edge.id
        name:
          #data: .VitalSigns.tempVitalsData
          data: []
        type: .DocType.VitalSigns
      docCreateResp: ""
      docAPI:
        get:
          api: rd
          dataIn: VitalSigns.apiRequest.vital.docQueryReq
          dataOut: VitalSigns.apiRequest.vital.docQueryResp
        store:
          api: cd
          dataIn: VitalSigns.apiRequest.vital.docCreateReq
          dataOut: VitalSigns.apiRequest.vital.docCreateResp
  components:
    - .BaseHeader:
    - .HeaderLeftButton:
      onClick:
        - actionType: evalObject
          object:
            - .VitalSigns.apiRequest.vital.docCreateReq.name.data@: =.VitalSigns.tempVitalsData #Ensures data in docCreateReq is correct if this page is not reloaded
        - actionType: builtIn #whenever you leave page, update rootnotebookID with my vitalsigns
          funcName: goBack
          reload: true
    - .HeaderRightImg:
      path: blueTooth.png
      style:
        zIndex: "10000" #wangchen 2021/11/29 iOS 暂时还未实现继承的写法。134-137暂时添加，iOS解析后会删除
        color: "0xffffff"
        isHidden: ..blueTooth
      onClick:
        - actionType: evalObject
          object:
            - .VitalSigns.apiRequest.vital.docCreateReq.name.data@: =.VitalSigns.tempVitalsData #Ensures data in docCreateReq is correct if this page is not reloaded
            - if:
                - .builtIn.isAndroid
                - actionType: evalObject
                  object:
                    - .Global.tempVitalsData@: =..tempVitalsData
                    - goto: BluetoothDevices
                - continue
    - type: scrollView
      style:
        left: "0"
        width: "1"
        top: "0.1"
        height: "0.8"
      children:
        - type: list
          contentType: listObject
          listObject: ..tempVitalsData
          iteratorVar: itemObject
          viewTag: dataList
          style:
            top: "0"
            margin: "0"
            left: "0"
            width: "1"
            height: "0.78"
            isRefresh: true
          children:
            - type: listItem
              itemObject: ""
              style:
                left: "0.04"
                width: "0.92"
                marginTop: "0.01"
                border:
                  style: "2"
                borderWidth: "2"
                borderColor: "0xdddddd"
              children:
                - type: view
                  style:
                    left: "0"
                    width: "0.96"
                    height: "0.1"
                    backgroundColor: "0xffffff"
                    borderRadius: "5"
                    boxShadow: "0px 0px 10px #dededf"
                  children:
                    - type: image
                      path:
                        emit:
                          dataKey:
                            var: itemObject
                          actions:
                            - if:
                                - =$var.imgPath
                                - $var.imgPath
                                - $var.imgPath
                      style:
                        height: "0.01"
                        top: "0.02"
                        left: "0.01"
                    - type: label
                      dataKey: itemObject.label1
                      style:
                        top: "0.02"
                        fontSize: .Nfont.h14
                        fontWeight: "550"
                        #left: "0.1"
                        left: "0.04"
                    - type: textField
                      dataKey: itemObject.data1
                      style:
                        top: "0.05"
                        width: "0.22"
                        height: "0.04"
                        fontSize: "20"
                        fontWeight: "700"
                        left: "0.02"
                        textAlign:
                          x: center
                        padding: "0px"
                        boxSizing: "border-box"
                        border:
                          style: "3"
                        borderWidth: "1"
                        borderRadius: "5"
                        borderColor: "#DEDEDF"
                      onChange:
                        - actionType: builtIn
                          funcName: calculateVital
                          id: bmi
                    - type: label
                      dataKey: itemObject.unit1
                      style:
                        top: "0.07"
                        fontSize: .Nfont.h14
                        left: "0.25"
                        color: "0x999999"
                    - type: label
                      dataKey: itemObject.label2
                      style:
                        top: "0.02"
                        fontSize: .Nfont.h14
                        fontWeight: "550"
                        left: "0.4"
                    - type: textField
                      dataKey: itemObject.data2
                      style:
                        top: "0.05"
                        width: "0.15"
                        height: "0.04"
                        fontSize: "20"
                        fontWeight: "700"
                        left: "0.4"
                        textAlign:
                          x: center
                        padding: "0px"
                        boxSizing: "border-box"
                        border:
                          style: "3"
                        borderWidth: "1"
                        borderRadius: "5"
                        borderColor: "#DEDEDF"
                      onChange:
                        - actionType: builtIn
                          funcName: calculateVital
                          id: bmi
                    - type: label
                      dataKey: itemObject.unit2
                      style:
                        top: "0.07"
                        fontSize: .Nfont.h14
                        left: "0.56"
                        color: "0x999999"
                    - type: label
                      dataKey: itemObject.time
                      #viewTag: dataTag
                      style:
                        top: "0.02"
                        fontSize: .Nfont.h12
                        width: "0.45"
                        left: "0.435"
                        textAlign:
                          x: right
                        color: "0x575757"
                    - .SmallButton:
                      #text: Get Data
                      text: Connecct
                      onClick:
                        - emit:
                            dataKey:
                              var: itemObject
                            actions:
                              - actionType: evalObject
                                object:
                                  - =.builtIn.object.get:
                                      dataIn:
                                        object: =.Global.isDeviceConnected
                                        key: $var.id
                                      dataOut: VitalSigns.isConnectedTemp
                                  - if:
                                      - =.builtIn.string.equal:
                                          dataIn:
                                            string1: =.VitalSigns.isConnectedTemp
                                            string2: "false"
                                      - if:
                                          - .builtIn.isAndroid
                                          - actionType: evalObject
                                            object:
                                              - .Global.tempVitalsData@: =..tempVitalsData
                                              - goto: BluetoothDevices
                                          - continue
                                      - actionType: builtIn
                                        funcName: getBluetoothData
                                        deviceType: $var.id
                              # btRedraw not working here dont know why
                              - actionType: builtIn
                                funcName: btRedraw
                      style:
                        #backgroundColor: "#2988e6"    #blue
                        backgroundColor: "0xC1C1C1" #grey
                        top: "0.055"
                        height: "0.03"
                        width: "0.15"
                        left: "0.73"
                        fontSize: .Nfont.n4
    #                    - type: label
    #                      text: history
    #                      style:
    #                        top: "0.02"
    #                        height: auto
    #                        left: 0.75
    #                      onClick:
    #                        - emit:
    #                            dataKey:
    #                              var: itemObject
    #                            actions:
    #                              - ..currentVital@: $var
    #                        - actionType: popUp
    #                          popUpView: vitalsLog
    #                    - .SmallButton:
    #                      text: Get Data
    #                      onClick:
    #                        - emit:
    #                            dataKey:
    #                              var: itemObject
    #                            actions:
    #                              - actionType: builtIn
    #                                funcName: getBluetoothData
    #                                deviceType: $var.id
    #                                # btRedraw not working here dont know why
    #                        - actionType: builtIn
    #                          funcName: btRedraw
    #                      style:
    #                        backgroundColor: "#2988e6"
    #                        top: "0.045"
    #                        height: "0.04"
    #                        width: "0.16"
    #                        left: "0.73"
    #                        fontSize: .Nfont.n2
    - .NextButtonView:
      children:
        - type: button
          text: "Save"
          style:
            left: "0.07"
            width: "0.86"
            top: "0.0275"
            height: "0.045"
            fontSize: .Nfont.n2
            color: "0xffffff"
            border:
              style: "3"
            borderColor: "0x2988e6"
            backgroundColor: "0x2988e6"
            borderRadius: "3"
            textAlign:
              x: center
          onClick:
            - actionType: popUp
              popUpView: uploading
            - actionType: evalObject
              object:
                - =..apiRequest.vital.docAPI.get: ""
                - =.builtIn.array.getListLength:
                    dataIn:
                      object: =..apiRequest.vital.docQueryResp.doc
                    dataOut: VitalSigns.formData.VitalNum
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =..formData.VitalNum
                          string2: "0"
                    - .VitalSigns.apiRequest.vital.docCreateReq.id@: ""
                    - .VitalSigns.apiRequest.vital.docCreateReq.id@: =.VitalSigns.apiRequest.vital.docQueryResp.doc.0.id
                - .VitalSigns.apiRequest.vital.docCreateReq.name.data@: =.VitalSigns.tempVitalsData #Ensures that the data being sent is correct, in case page is not reloaded
                - =..apiRequest.vital.docAPI.store: ""
    - type: popUp
      viewTag: uploading
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
      children:
        - type: view
          style:
            left: "0.05"
            top: "0.3"
            width: "0.89333"
            height: "0.35"
            zIndex: "100"
            backgroundColor: "0xeaeaea"
            border:
              style: "5"
            borderRadius: "15"
          children:
            - type: label
              text: "Saved Successfully."
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.08"
                  width: "0.89333"
                  height: "0.05"
                  color: "0x000000"
                  fontSize: "19"
                  display: inline
                  # fontStyle: "bold"
                  fontFamily: "sans-serif"
                  textAlign:
                    x: center
                    y: center
            - type: divider
              style:
                .DividerStyle:
                  left: "0"
                  top: "0.25436"
                  width: "0.89333"
                  height: "0.001"
                  backgroundColor: "0x00000088"
            - type: button
              onClick:
                - actionType: popUpDismiss
                  popUpView: uploading
              text: OK
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.275"
                  width: "0.89333"
                  height: "0.06812"
                  color: "0x007affff"
                  fontSize: "19"
                  display: inline
                  backgroundColor: "0xeaeaea"
                  textAlign:
                    x: center
                    y: center
                  border:
                    style: "5"
                    borderRadius: "15"
    - type: popUp
      viewTag: vitalsLog
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
      children:
        - type: view
          style:
            left: "0.05"
            top: "0.1"
            width: "0.89333"
            height: "0.8"
            zIndex: "100"
            backgroundColor: "0xeaeaea"
            border:
              style: "5"
            borderRadius: "15"
          children:
            - type: label
              text: "Measurement History"
              style:
                .LabelStyle:
                  left: "0"
                  top: "0"
                  width: "0.89333"
                  height: "0.05"
                  color: "0x000000"
                  fontSize: "19"
                  display: inline
                  fontFamily: "sans-serif"
                  textAlign:
                    x: center
                    y: center
            - type: scrollView
              style:
                left: "0"
                width: "0.89333"
                top: "0.05"
                height: "0.75"
              children:
                - type: list
                  contentType: listObject
                  listObject: ..currentVital.measurements
                  iteratorVar: itemObject
                  viewTag: dataList
                  style:
                    top: "0"
                    margin: "0"
                    left: "0"
                    width: "0.89333"
                    height: "0.75"
                  children:
                    - type: listItem
                      style:
                        left: "0"
                        width: "0.89333"
                        marginTop: "0.01"
                        height: "0.1"
                        border:
                          style: "2"
                        borderRadius: "5"
                        boxShadow: "0px 0px 10px #dededf"
                      children:
                        - type: label
                          dataKey: itemObject.label1
                          style:
                            top: "0.02"
                            fontSize: .Nfont.h14
                            fontWeight: "550"
                            #left: "0.1"
                            left: "0.06"
                        - type: label
                          dataKey: itemObject.label2
                          style:
                            top: "0.02"
                            fontSize: .Nfont.h14
                            fontWeight: "550"
                            left: "0.43"
                        - type: label
                          dataKey: itemObject.data1
                          style:
                            top: "0.055"
                            width: "0.21"
                            fontSize: "20"
                            fontWeight: "700"
                            left: "0.06"
                            textAlign:
                              x: center
                            padding: "0px"
                            boxSizing: "border-box"
                            border:
                              style: "3"
                            borderWidth: "1"
                            borderRadius: "5"
                            borderColor: "#DEDEDF"
                        - type: label
                          dataKey: itemObject.unit1
                          style:
                            top: "0.065"
                            fontSize: .Nfont.h14
                            left: "0.30"
                            color: "0x999999"
                        - type: label
                          dataKey: itemObject.time
                          #viewTag: dataTag
                          style:
                            top: "0.02"
                            fontSize: "15"
                            width: "0.35"
                            left: "0.51"
                            textAlign:
                              x: right
                            color: "0x575757"
                        - type: label
                          dataKey: itemObject.data2
                          style:
                            top: "0.055"
                            width: "0.16"
                            fontSize: "20"
                            fontWeight: "700"
                            left: "0.43"
                            textAlign:
                              x: center
                            padding: "0px"
                            boxSizing: "border-box"
                            border:
                              style: "3"
                            borderWidth: "1"
                            borderRadius: "5"
                            borderColor: "#DEDEDF"
                        - type: label
                          dataKey: itemObject.unit2
                          style:
                            top: "0.065"
                            fontSize: .Nfont.h14
                            left: "0.63"
                            color: "0x999999"
            - type: divider
              style:
                .DividerStyle:
                  left: "0"
                  top: "0.76"
                  width: "0.89333"
                  height: "0.001"
                  backgroundColor: "0x00000088"
            - type: button
              onClick:
                - actionType: evalObject
                  object:
                    - =..currentVital@: ""
                - actionType: popUpDismiss
                  popUpView: vitalsLog
              text: Close
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.75"
                  width: "0.89333"
                  height: "0.05"
                  color: "0x007affff"
                  fontSize: "19"
                  display: inline
                  backgroundColor: "0xeaeaea"
                  textAlign:
                    x: center
                    y: center
                  border:
                    style: "5"
                    borderRadius: "15"
