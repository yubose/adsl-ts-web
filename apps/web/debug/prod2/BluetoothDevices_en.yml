#For Android Only
BluetoothDevices:
  title: "Bluetooth Devices"
  init:
    - .SignInCheck
    - actionType: builtIn
      funcName: initBluetooth
  device:
    name: ""
    address: ""
  #connectedDevices: []
  scanStatus: Scan
  availableDevices: []
  currentObject:
  currentDevice:
    retrieve:
      - ..currentDevice.docAPI.get: ""
    deviceObjs:
    address: ""
    docAPI:
      get:
        .DocAPI.get: ""
        id: =..currentDevice.address
        xfname: fid
        type: .DocType.BtDeviceObj
        dataKey: currentDevice.deviceObjs
        maxcount: "1000"
        obfname: "mtime"
        _nonce: =.Global._nonce
  currentDeviceInfo:
    retrieve:
      - ..currentDeviceInfo.docAPI.get: ""
    targetId: ""
    deviceInfoDoc:
    docAPI:
      get:
        .DocAPI.get: ""
        id: =..currentDeviceInfo.targetId
        type: .DocType.BtDeviceInfo
        dataKey: currentDeviceInfo.deviceInfoDoc
        maxcount: "1000"
        obfname: "mtime"
        _nonce: =.Global._nonce
  components:
    - .BaseHeader:
    - .HeaderLeftButton:
      onClick:
        - actionType: evalObject
          object:
            - .VitalSigns.vitalsData@: =.Global.vitalsData
        - actionType: builtIn
          funcName: goBack
          reload: false #reload must be false, otherwise data from devices may be overwritten
    - .HeaderRightImg:
      path: sideNav.svg
      onClick:
        - actionType: popUp
          popUpView: Showcontent
    - type: popUp
      viewTag: Showcontent
      style:
        width: "1"
        left: "0"
        top: "0"
        height: "1"
        zIndex: "10000"
      children:
        - .HeaderRightImg:
          path: sideNav.svg
          style:
            zIndex: "1000001"
          onClick:
            - actionType: popUpDismiss
              popUpView: Showcontent
        - type: view
          style:
            left: "0"
            top: "0"
            width: "1"
            height: "1"
          onClick:
            - actionType: popUpDismiss
              popUpView: Showcontent
        - type: image
          path: triangle.svg
          style:
            top: "0.07"
            left: "0.86"
            width: "0.1"
        - type: view
          style:
            top: "0.089"
            width: "0.4"
            left: "0.54"
            height: "0.08"
            backgroundColor: "0xffffff"
            boxShadow: "1px 1px 4px 1px #DBDBDB"
          children:
            - type: view
              style:
                left: "0"
                marginTop: "0"
                width: "0.42"
                height: "0.04"
                border:
                  style: "2"
                borderColor: "0x000000"
                borderWidth: "1"
              onClick:
                - goto: ""
              children:
                - type: label
                  text: "History"
                  style:
                    left: "0.03"
                    top: "0.01"
                    fontSize: .Nfont.h2
                    fontFamily: "Arial"
            - type: view
              style:
                left: "0"
                marginTop: "0"
                width: "0.42"
                height: "0.04"
              onClick:
                - goto: ""
              children:
                - type: label
                  text: "Bluetooth Devices"
                  style:
                    left: "0.03"
                    top: "0.01"
                    fontSize: .Nfont.h2
                    fontFamily: "Arial"
    - type: label
      text: "Selected Devices"
      style:
        top: "0.11"
        left: "0.05"
        width: "1"
        height: "0.03"
        fontSize: .Nfont.h2
        fontWeight: 200
        color: "0x000000"
        fontFamily: sans-serif
        textAlign:
          x: left
    - type: view
      style:
        top: "0.15"
        left: "0"
        width: "1"
        height: "0.5"
        backgroundColor: "#ffffff"
        overflow: scroll
      children:
        - type: list
          contentType: listObject
          listObject: .Global.connectedDevices
          iteratorVar: itemObject
          viewTag: availableTag
          style:
            top: "0"
            left: "0"
            width: "0.94"
            height: "0.46"
            margin: "0"
            isRefresh: true #Enable pulldown to refresh
          children:
            - type: listItem
              itemObject: ""
              style:
                left: "0"
                width: "1"
                height: "0.08"
                border:
                  style: "2"
                borderWidth: "1"
                borderColor: "0x00000011"
              children:
                - type: image
                  onClick:
                    - emit:
                      dataKey:
                        var: itemObject
                      actions:
                        - ..currentObject@: $var
                        - actionType: popUp
                          popUpView: deleting
                  path: delete.png
                  style:
                    left: "0.05"
                    width: "0.05"
                    textAlign:
                      y: center
                - type: label
                  dataKey: itemObject.name
                  onClick:
                    - goto: ""
                  style:
                    left: "0.08"
                    top: "0.01"
                    width: "0.7"
                    height: "0.03"
                    fontWidth: "100"
                    fontSize: .Nfont.h2
                    fontStyle: "bold"
                    color: "#000000"
                    zIndex: 100
                    textAlign:
                      y: center
                - type: label
                  text: "Connected"
                  dataKey: itemObject.status
                  style:
                    left: "0.08"
                    top: "0.04"
                    width: "0.7"
                    height: "0.03"
                    fontWidth: "100"
                    fontSize: .Nfont.h2
                    color: "#4B4B4B"
                    zIndex: 100
                    textAlign:
                      y: center
                - type: label
                  text: "Update"
                  dataKey: itemObject.buttonText1
                  onClick:
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - actionType: builtIn
                            funcName: getBluetoothData
                            device: $var
                    - actionType: builtIn
                      funcName: btRedraw
                  style:
                    left: "0.7"
                    top: "0"
                    width: "0.27"
                    height: "0.05"
                    fontWidth: "100"
                    fontSize: .Nfont.h2
                    color: "0x2988e6"
                    zIndex: 100
                    textAlign:
                      y: center
                      x: center
    - type: label
      text: "Available Devices"
      style:
        top: "0.5"
        left: "0.05"
        width: "1"
        height: "0.03"
        fontSize: .Nfont.h2
        fontWeight: 200
        color: "0x000000"
        fontFamily: sans-serif
        textAlign:
          x: left
    - type: button
      dataKey: scanStatus
      viewTag: scanButton
      onClick:
        - actionType: builtIn
          funcName: discoverBluetooth
          object: availableDevices
      style:
        left: "0.5"
        top: "0.5"
        width: "0.4"
        height: "0.03"
        fontSize: .Nfont.h16
        color: "0xffffff"
        backgroundColor: "0x30b354"
        border:
          style: "3"
        borderColor: "0x30b354"
        borderWidth: "1"
        borderRadius: "5"
        textAlign:
          x: center
          y: center
        zIndex: 10000
    - type: view
      style:
        top: "0.53"
        left: "0"
        width: "1"
        height: "0.5"
        backgroundColor: "#ffffff"
        overflow: scroll
      children:
        - type: label
          text: Pull Down to Refresh
          style:
            left: "0"
            top: "0.005"
            width: "1"
            height: "0.02"
            fontSize: .Nfont.h12
            fontFamily: PMingLiU
            textAlign:
              x: center
        - type: list
          contentType: listObject
          listObject: ..availableDevices #..formData.connectionList
          iteratorVar: itemObject
          viewTag: availableTag
          style:
            top: "0.01"
            left: "0"
            width: "1"
            height: "0.5"
            margin: "0"
            isRefresh: true
          children:
            - type: listItem
              itemObject: ""
              style:
                left: "0"
                width: "1"
                height: "0.05"
                border:
                  style: "2"
                borderWidth: "1"
                borderColor: "0x00000011"
              children:
                - type: label
                  dataKey: itemObject.name
                  style:
                    left: "0.08"
                    top: "0"
                    width: "0.7"
                    height: "0.05"
                    fontWidth: "100"
                    fontSize: .Nfont.h2
                    fontStyle: "bold"
                    color: "#000000"
                    zIndex: 100
                    textAlign:
                      y: center
                - type: label
                  text: "Select"
                  onClick:
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - if:
                              - actionType: builtIn
                                funcName: selectBluetoothDevice
                                device: $var
                              - actionType: evalObject
                                object:
                                  - =.builtIn.array.removeByName:
                                      dataIn:
                                        object: =..availableDevices
                                        key: "address"
                                        name: $var.address
                                  - =.builtIn.array.add:
                                      dataIn:
                                        object: =.Global.connectedDevices
                                        value: $var
                              - actionType: popUp
                                popUpView: duplicateDevice
                    - actionType: builtIn
                      funcName: btRedraw
                  style:
                    left: "0.7"
                    top: "0"
                    width: "0.27"
                    height: "0.05"
                    fontWidth: "100"
                    fontSize: .Nfont.h2
                    color: "0x2988e6"
                    zIndex: 100
                    textAlign:
                      y: center
                      x: center
    - type: popUp
      viewTag: duplicateDevice
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
      children:
        - type: view
          style:
            left: "0.05"
            top: "0.3"
            width: "0.89333"
            height: "0.35"
            zIndex: "100"
            backgroundColor: "0xeaeaea"
            border:
              style: "5"
            borderRadius: "15"
          children:
            - type: label
              text: "There is already a device of this type connected."
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.08"
                  width: "0.89333"
                  height: "0.05"
                  color: "0x000000"
                  fontSize: "19"
                  display: inline
                  # fontStyle: "bold"
                  fontFamily: "sans-serif"
                  textAlign:
                    x: center
                    y: center
            - type: divider
              style:
                .DividerStyle:
                  left: "0"
                  top: "0.25436"
                  width: "0.89333"
                  height: "0.001"
                  backgroundColor: "0x00000088"
            - type: button
              onClick:
                - actionType: popUpDismiss
                  popUpView: duplicateDevice
              text: NO
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.275"
                  width: "0.89333"
                  height: "0.06812"
                  color: "0x007affff"
                  fontSize: "19"
                  display: inline
                  backgroundColor: "0xeaeaea"
                  textAlign:
                    x: center
                    y: center
                  border:
                    style: "5"
                    borderRadius: "15"
    - type: popUp
      viewTag: deleting
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
      children:
        - type: view
          style:
            left: "0.05"
            top: "0.3"
            width: "0.89333"
            height: "0.35"
            zIndex: "100"
            backgroundColor: "0xeaeaea"
            border:
              style: "5"
            borderRadius: "15"
          children:
            - type: label
              text: "Unselect this device?"
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.08"
                  width: "0.89333"
                  height: "0.05"
                  color: "0x000000"
                  fontSize: "19"
                  display: inline
                  # fontStyle: "bold"
                  fontFamily: "sans-serif"
                  textAlign:
                    x: center
                    y: center
            - type: divider
              style:
                .DividerStyle:
                  left: "0"
                  top: "0.25436"
                  width: "0.89333"
                  height: "0.001"
                  backgroundColor: "0x00000088"
            - type: button
              onClick:
                - actionType: popUpDismiss
                  popUpView: deleting
              text: NO
              style:
                .LabelStyle:
                  left: "0"
                  top: "0.275"
                  width: "0.42"
                  height: "0.06812"
                  color: "0x007affff"
                  fontSize: "19"
                  display: inline
                  backgroundColor: "0xeaeaea"
                  textAlign:
                    x: center
                    y: center
                  border:
                    style: "5"
                    borderRadius: "15"
            - type: button
              onClick:
                - actionType: popUpDismiss
                  popUpView: deleting
                - =.builtIn.array.removeByName:
                    dataIn:
                      object: =.Global.connectedDevices
                      key: "address"
                      name: =..currentObject.address
                - actionType: builtIn
                  funcName: unselectBluetoothDevice
                  device: =..currentObject
                - actionType: builtIn
                  funcName: btRedraw
              text: YES
              style:
                .LabelStyle:
                  left: "0.45"
                  top: "0.275"
                  width: "0.42"
                  height: "0.06812"
                  color: "0x007affff"
                  fontSize: "19"
                  display: inline
                  backgroundColor: "0xeaeaea"
                  textAlign:
                    x: center
                    y: center
                  border:
                    style: "5"
                    borderRadius: "15"
            - type: divider
              style:
                .DividerStyle:
                  left: "0.45"
                  top: "0.255"
                  width: "0.002"
                  height: "0.08"
                  backgroundColor: "0x00000088"
