RoomManagement:
  title: "Room Management"
  init:
    - .SignInCheck
    - actionType: updateObject
      dataKey: Global.acceptInfo
      dataObject: {}
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.locationAll
              string2: []
        - continue
        - actionType: evalObject
          object:
            - =.builtIn.array.selectOneToArr:
                dataIn:
                  arr: =.Global.locationAll
                  key: "medicalFacilityName"
                dataOut: RoomManagement.formData.addressName
            - ..formData.address@: =..formData.addressName.0
            - =.builtIn.array.matchInArray:
                dataIn:
                  arr: =.Global.locationAll
                  value: =..formData.addressName.0
                  key: medicalFacilityName
                  key1: "id"
                dataOut: RoomManagement.formData.locationId
            - =.builtIn.array.matchInArray:
                dataIn:
                  arr: =.Global.locationAll
                  value: =..formData.addressName.0
                  key: medicalFacilityName
                  key1: "locationID"
                dataOut: RoomManagement.formData.locationOwnId
            - ..formData.locationTableId@: =..formData.locationId
            - ..roomList.docIn.ids.0@: =..formData.locationTableId
            - =..roomList.docAPI.get: ""

            - =.builtIn.array.splitTableList:
                dataIn:
                  arrObj: =..roomList.docResp.doc
                  numX: "12"
                  numY: "1"
                dataOut: RoomManagement.formData.tableData
            - ..formData.tableList@: =..formData.tableData.0

            - =.builtIn.string.concat:
                dataIn:
                  - =..formData.tablePageNum # page num
                  - " / "
                  - =..formData.tableData.1 # total page
                dataOut: RoomManagement.formData.tableCurrentPage # current page                           
            - =.builtIn.number.addition:
                # get totalPage+1 to verify legitimacy of gotoPageNum
                dataIn:
                  num: =..formData.tableData.1
                  step: "1"
                dataOut: RoomManagement.formData.totalPageMore # update page num 
            - .Global.formData.service@: "COVID-19 Testing"
            - =.builtIn.array.setPropertyInterlacedChange:
                dataIn:
                  arrIn: =..formData.tableList
                  arr: [ "backgroundColor" ]
                  valueArr: [ "0xf5f5f5" ]
                  errorArr: [ "0xffffff" ]
                dataOut: RoomManagement.formData.tableList
  formData:
    tableData: []       
    tableList: []       
    tablePageNum: "1" # previous和next 中间的文本显示的数据
    tableCurrentPage: "1" # 当前显示的当前页面/总页面
    gotoPageNum: "" # goto 后面的文本显示
    totalPageMore: "" #totalPage(tableData .1) + 1 
    addressName: []       
    address: "" # for dataKey
    locationId: ""
    locationOwnId: "" # for location's locationID not id
    locationTableId: ""
    locationStatus: ""
    countryCode: "+1"
    number: ""
    res: ""
    reasonForVisit: []
    locationUid: ""
    controlForm: "1"
    controlFormShow: "none"

  reasonObj:
    reason: ""
    duration: "5 min"
    document: []
    # selectDoc: ""
  setLocation:
    docResp:
    storeResp: ""
    document:
      name:
        data:
          basicInfo:
            service: []
    docIn:
      ObjType: 12
      type: .DocType.FacilityProfile
      id: ""
      xfname: E.bvid
      sCondition: E.type=10000
      maxcount: "10000"
      _nonce: =.Global._nonce
    docAPI:
      get:
        api: rd
        dataIn: setLocation.docIn
        dataOut: RoomManagement.setLocation.docResp
      store:
        api: cd
        dataIn: setLocation.document
        dataOut: setLocation.storeResp
  formDoc:
    # form  
    form: []       
    formCov:
      # 如果是cov form就显示与cov相关
      - title: New Patient Forms
        pageName: NewPatFormPreviewPage1
      - title: COVID-19 Testing Consent - New Patient
        pageName: Cov19TestNewPatPreviewPage1
      - title: COVID-19 Testing Consent Form
        pageName: Cov19TestFormPreviewPage1
      - title: Pfizer-BioNTech Vaccine - First Dose
        pageName: PfizerVaccineFirDosePreviewPage1
      - title: Pfizer-BioNTech Vaccine - Second Dose
        pageName: PfizerVaccineSecDosePreviewPage1
      - title: Moderna Vaccine Form - First Dose
        pageName: ModernaVaccineFirDosePreviewPage1
      - title: Moderna Vaccine Form - Second Dose
        pageName: ModernaVaccineSecDosePreviewPage1
      # formFlu: # 如果是flu form就显示与flu相关
      #   - title: Flu Vaccination Consent form 2020-2021(English)
      #     pageName: FluVaccinationConsentFormEnglishPreview      
      # - title: COVID-19 Results & Flu A&B Results
      #   pageName: Cov19ResultsAndFluResultsEdit

  fac_RootNotebook:
    # 获取当前room的rootnotebook
    edgeReq:
      id: ""
      xfname: bvid
      type: .EdgeType.RootNotebook
    edgeResp: ""
    edgeAPI:
      get:
        api: re
        dataIn: RoomManagement.fac_RootNotebook.edgeReq
        dataOut: RoomManagement.fac_RootNotebook.edgeResp
  room:
    resp: ""
    vertexResp: ""
    verIn:
      type: "30"
      id: ""
      xfname: "id"
    vertex:
      .Vertex: ""
      type: "30"
      _handledCode: -1
      name:
        basicInfo:
          roomName: ""
          roomId: ""
          view: "view"
          # service: "Telemedicine"
          service: "COVID-19 Testing"
      uid: ""
      jwt: ""
      # pk: "VW/ceBN733d2oAki+muUeSAaKZBaE9SIbRJu5gBz40c="
      # esk: "2f8J1+aRIftJkKL+VxLb00qYjW3hWfQwLIBGumdwum/NHXlv6VChfmPIhj0bTOaUK4VscRwwa4soTqJ8x0a1jsOBoDDZz5aR"
    vertexAPI:
      .VertexAPI: ""
      store:
        api: cv
        dataIn: RoomManagement.room.vertex
        dataOut: RoomManagement.room.resp
      get:
        api: rv
        dataIn: room.verIn
        dataOut: RoomManagement.room.vertexResp
  roomProfile:
    docStoreResp: "" # for cd response
    resp: ""
    document:
      # for cd
      .Document: ""
      type: .DocType.RoomProfile
      name:
        data:
          roomName: ""
      eid:
    docIn:
      # for rd
      .Document: ""
      type: .DocType.RoomProfile
      name:
        data:
      id:
      xfname: "id"
    docAPI:
      store:
        api: cd
        dataIn: roomProfile.document
        dataOut: RoomManagement.roomProfile.docStoreResp
      get:
        api: rd
        dataIn: roomProfile.docIn
        dataOut: RoomManagement.roomProfile.resp
  roomList:
    docResp:
      doc: []

    docIn:
      ObjType: 12
      ids:
      xfname: "E.bvid"
      maxcount: "100"
      obfname: "mtime"
      type: .DocType.RoomProfile
      sCondition: E.type=1100
      asc: false
      _nonce: =.Global._nonce
    docAPI:
      get:
        api: rd
        dataIn: roomList.docIn
        dataOut: RoomManagement.roomList.docResp
  roomListReget:
    docResp:
      doc: []
    docIn:
      ObjType: 12
      ids:
      xfname: "E.bvid"
      maxcount: "100"
      obfname: "mtime"
      type: .DocType.RoomProfile
      sCondition: E.type=1100
      asc: false
      _nonce: =.Global._nonce
    docAPI:
      get:
        api: rd
        dataIn: roomListReget.docIn
        dataOut: RoomManagement.roomListReget.docResp
  apiRequest:
    roomList:
      # 获取所有的room 
      vertexResp: ""
      vertexIn:
        ObjType: "4"
        id: []
        xfname: E.Bvid
        sCondition: "E.type=1100 AND V.type=30"
        _nonce: =.Global._nonce
      vertexAPI:
        get:
          api: rv
          dataIn: apiRequest.roomList.vertexIn
          dataOut: RoomManagement.apiRequest.roomList.vertexResp
  components:
    - .BaseCheckView:
      viewTag: reasonNullView
      message: "Please enter your reason"
    - .BaseCheckView: ""
      message: "Room ID cannot be repeated!"
      viewTag: roomIDTag
    - .TotalView:
      children:
        - .SideMenuBar:
          children:
            - .aitLogo:
            - .MenuBar:
        - .TopBar:
        - .InnerBodyView:
          children:
            - .PageTitleLabel:
              style:
                fontWeight: "600"
            - .GotoBack: ""
              style:
                top: "0.045"
            - .ContentBar:
              children:
                - type: view
                  style:
                    display: inline-block
                    marginTop: "0.035"
                    left: "0.028"
                  children:
                    - type: label
                      text: Location
                      style:
                        height: "0.035"
                        fontSize: .Nfont.nf5
                        fontWeight: "600"
                        color: "0x005795"
                        display: inline-block
                        marginTop: "0.01"
                    - type: select
                      dataKey: formData.address
                      options: ..formData.addressName
                      onChange:
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: ""
                        - actionType: evalObject
                          object:
                            - =.builtIn.array.matchInArray:
                                dataIn:
                                  arr: =.Global.locationAll
                                  value: =..formData.address
                                  key: "medicalFacilityName"
                                  key1: "id"
                                dataOut: RoomManagement.formData.locationTableId
                            - =.builtIn.array.matchInArray:
                                dataIn:
                                  arr: =.Global.locationAll
                                  value: =..formData.address
                                  key: "medicalFacilityName"
                                  key1: "locationID"
                                dataOut: RoomManagement.formData.locationOwnId
                            - ..roomListReget.docIn.ids.0@: =..formData.locationTableId
                            - ..formData.locationId@: =..formData.locationTableId
                            # - .Global.jwt.edge.bvid@: =..formData.locationTableId
                            # - =.Global.jwt.edgeAPI.store: ""
                            - =..roomListReget.docAPI.get: ""
                            # - ..formData.tableList@: =..roomListReget.docResp.doc
                            - ..roomList.docResp.doc@: =..roomListReget.docResp.doc

                            - ..formData.tablePageNum@: "1"
                            - =.builtIn.array.splitTableList:
                                dataIn:
                                  arrObj: =..roomListReget.docResp.doc
                                  numX: "12"
                                  numY: "1"
                                dataOut: RoomManagement.formData.tableData
                            - ..formData.tableList@: =..formData.tableData.0
                            - =.builtIn.array.setPropertyInterlacedChange:
                                dataIn:
                                  arrIn: =..formData.tableList
                                  arr: [ "backgroundColor" ]
                                  valueArr: [ "0xf5f5f5" ]
                                  errorArr: [ "0xffffff" ]
                                dataOut: RoomManagement.formData.tableList
                            - =.builtIn.string.concat:
                                dataIn:
                                  - =..formData.tablePageNum # page num
                                  - " / "
                                  - =..formData.tableData.1 # total page
                                dataOut: RoomManagement.formData.tableCurrentPage # current page                           
                            - =.builtIn.number.addition:
                                # get totalPage+1 to verify legitimacy of gotoPageNum
                                dataIn:
                                  num: =..formData.tableData.1
                                  step: "1"
                                dataOut: RoomManagement.formData.totalPageMore # update page num 
                            - ..roomListReget.docResp.doc@: []

                        - actionType: builtIn
                          funcName: redraw
                          viewTag: tableView
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: tableFooter
                      style:
                        marginLeft: "0.01"
                        width: "0.3"
                        height: "0.045"
                        fontSize: .Nfont.nf4
                        display: inline-block
                        border:
                          style: "3"
                        borderWidth: "1"
                        color: "0x000000"
                        borderColor: "0xdedede"
                        borderRadius: "4"
                - type: view
                  onClick:
                    - actionType: evalObject
                      object:
                        - ..room.vertex.name.basicInfo.roomName@: ""
                        - ..room.vertex.name.basicInfo.roomId@: ""
                        - ..room.vertex.name.basicInfo.service@: "COVID-19 Testing"
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: addView
                    - actionType: popUp
                      popUpView: addRoomView
                  style:
                    width: '0.095'
                    left: '0.313'
                    height: '0.04'
                    display: inline-block
                    marginTop: '0.026'
                    backgroundColor: '#005795'
                    borderRadius: "3"
                    color: '#FFFFFF'
                  children:
                    - .Label1:
                      text: 'Add New Room'
                      style:
                        fontSize: .Nfont.nf3
                        height: '0.04'
                        left: '0.027'
                        width: "0.07"
                        textAlign:
                          y: center
                    - type: image
                      path: addCircle.svg
                      style:
                        top: '0.012'
                        left: '0.01'
                        width: "0.01"

                # Table
                - type: view
                  viewTag: tableView
                  style:
                    left: "0.028"
                    marginTop: "0.05"
                    width: "0.762"
                    height: "auto"
                    border-top-left-radius: "5px"
                    border-top-right-radius: "5px"
                    boxSizing: border-box
                    border:
                      style: "3"
                    borderColor: "0x7070704f"
                    borderBottom: "0xffffff"
                  children:
                    #TableHeader
                    - type: view
                      viewTag: tableHeader
                      style:
                        marginTop: "0.02"
                        width: "0.762"
                        margin: "0"
                        left: "0"
                        height: "0.04"
                      children:
                        - type: label
                          text: Room Name
                          style:
                            .RoomManageHeaderStyle:
                            width: "0.07"
                            textIndent: "1.3em"
                        - type: label
                          text: ID
                          style:
                            .RoomManageHeaderStyle:
                            width: "0.192"
                        - type: label
                          text: Location Name
                          style:
                            .RoomManageHeaderStyle:
                            width: "0.135"
                        - type: label
                          text: Service
                          style:
                            .RoomManageHeaderStyle:
                            width: "0.15"
                        - type: label
                          text: Schedule Setting
                          style:
                            .RoomManageHeaderStyle:
                        - type: label
                          text: Edit
                          style:
                            .RoomManageHeaderStyle:
                            width: "0.055"
                    #TableBody
                    - type: list
                      viewTag: tableBody
                      contentType: listObject
                      listObject: ..formData.tableList
                      iteratorVar: itemObject
                      style:
                        width: "0.761"
                        margin: "0"
                        left: "0"
                        height: auto
                        borderTop: "solid 1px  #7070704f"
                        backgroundColor: "0xffffff"
                        boxSizing: border-box
                        borderBottom: "#ffffff"
                        fontSize: .Nfont.nf2
                      children:
                        - type: listItem
                          itemObject:
                          style:
                            height: "0.04"
                            borderBottom: "1px solid #dedede"
                            boxSizing: border-box
                            backgroundColor: itemObject.backgroundColor
                          children:
                            - type: label
                              dataKey: itemObject.name.data.roomName
                              style:
                                width: "0.07"
                                height: "0.04"
                                borderWidth: "1"
                                display: inline-block
                                textIndent: "1.5em"
                                lineHeight: "4vh"
                                textAlign:
                                  y: "center"
                            - type: label
                              dataKey: itemObject.name.data.roomId
                              style:
                                width: "0.192"
                                height: "0.04"
                                borderWidth: "1"
                                display: inline-block
                                lineHeight: "4vh"
                                textIndent: 1.5em
                                textAlign:
                                  y: "center"
                            - type: label
                              dataKey: formData.address
                              style:
                                width: "0.135"
                                height: "0.04"
                                borderWidth: "1"
                                display: inline-block
                                lineHeight: "4vh"
                                textIndent: 1.5em
                                textAlign:
                                  y: "center"
                            - type: label
                              dataKey: itemObject.name.data.service
                              style:
                                width: "0.15"
                                height: "0.04"
                                borderWidth: "1"
                                display: inline-block
                                textIndent: 1.5em
                                lineHeight: "4vh"
                                textAlign:
                                  y: "center"
                            - type: label
                              dataKey: itemObject.name.data.view
                              onClick:
                                - emit:
                                    dataKey:
                                      var: itemObject
                                    actions:
                                      - .Global.acceptInfo@: $var
                                - actionType: evalObject
                                  object:
                                    - .Global.locationId@: =..formData.locationTableId
                                    - .Global.formData.service@: =.Global.acceptInfo.name.data.service
                                    - .Global.formData.serviceType@: =.Global.acceptInfo.name.data.serviceType
                                    - goto: ScheduleSettingRoomTime
                              style:
                                textDecoration: underline
                                width: "0.14"
                                height: "0.04"
                                color: "0x2988e6"
                                backgroundColor: "0xffffff00"
                                fontSize: .Nfont.nf2
                                display: inline-block
                                lineHeight: "4vh"
                                textIndent: 1.5em
                                borderWidth: "1"
                                textAlign:
                                  y: "center"
                            - type: view
                              style:
                                textDecoration: underline
                                width: "0.055"
                                height: "0.04"
                                display: inline-block
                                lineHeight: "4vh"
                                color: "0x2988e6"
                                backgroundColor: "0xffffff00"
                                fontSize: .Nfont.nf2
                                borderWidth: "1"
                                textIndent: 0.8em
                                textAlign:
                                  y: "center"
                              children:
                                - type: image
                                  path: editBlue.svg
                                  style:
                                    width: "0.03"
                                    height: "0.02"
                                    top: "0.01"
                                  onClick:
                                    - emit:
                                        dataKey:
                                          var: itemObject
                                        actions:
                                          - ..roomProfile.document@: $var
                                          - ..room.verIn.id@: =..roomProfile.document.bsig
                                          - =..room.vertexAPI.get: ""
                                          - ..room.vertex@: =..room.vertexResp.vertex.0
                                    - actionType: popUp
                                      popUpView: editRoomView
                                    - actionType: builtIn
                                      funcName: redraw
                                      viewTag: editView
                # TableFooter
                - type: view
                  viewTag: tableFooter
                  style:
                    .TableFooterView:
                  children:
                    - type: view
                      style:
                        top: "0.005"
                        width: "0.08"
                        height: "0.0155"
                      children:
                        - type: label
                          text: "Current page:"
                          style:
                            display: inline-block
                            fontSize: .Nfont.nf0
                            color: "0x333333"
                            textAlign:
                              x: "center"
                              y: "center"
                        - type: label
                          dataKey: formData.tableCurrentPage
                          style:
                            marginLeft: "0.005"
                            display: inline-block
                            fontSize: .Nfont.nf0
                            color: "0x333333"
                            textAlign:
                              x: "center"
                              y: "center"
                    - type: view
                      style:
                        top: "0"
                        left: "0.076"
                        width: "0.05168"
                        height: "0.02576"
                      children:
                        - type: image
                          path: tableLeft.svg
                          onClick:
                            - actionType: evalObject
                              object:
                                - if:
                                    - =.builtIn.number.less:
                                        dataIn:
                                          num1: =..formData.tablePageNum
                                          num2: 2
                                    - continue
                                    - actionType: evalObject
                                      object:
                                        - =.builtIn.number.Subtraction:
                                            dataIn:
                                              num: =..formData.tablePageNum
                                              step: "1"
                                            dataOut: RoomManagement.formData.tablePageNum
                                        - =.builtIn.array.splitTableList:
                                            dataIn:
                                              arrObj: =..roomList.docResp.doc
                                              numX: "12"
                                              numY: =..formData.tablePageNum
                                            dataOut: RoomManagement.formData.tableData
                                        - ..formData.tableList@: =..formData.tableData.0
                                        - =.builtIn.array.setPropertyInterlacedChange:
                                            dataIn:
                                              arrIn: =..formData.tableList
                                              arr: [ "backgroundColor" ]
                                              valueArr: [ "0xf5f5f5" ]
                                              errorArr: [ "0xffffff" ]
                                            dataOut: RoomManagement.formData.tableList
                                        - =.builtIn.string.concat:
                                            dataIn:
                                              - =..formData.tablePageNum
                                              - " / "
                                              - =..formData.tableData.1
                                            dataOut: RoomManagement.formData.tableCurrentPage # current page
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableView
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableFooter
                          style:
                            top: "0"
                            width: "0.01456"
                            height: "0.02576"
                        - type: label
                          dataKey: formData.tablePageNum
                          style:
                            top: "0"
                            left: "0.01856"
                            width: "0.01446"
                            height: "0.02576"
                            fontSize: .Nfont.nf0
                            fontWeight: "500"
                            color: "0xffffff"
                            backgroundColor: "0x005795"
                            borderRadius: "3"
                            textAlign:
                              x: center
                              y: center
                        - type: image
                          path: tableRight.svg
                          onClick:
                            - actionType: evalObject
                              object:
                                .Global._nonce@:
                                  =.builtIn.math.random: ""
                            - actionType: evalObject
                              object:
                                - if:
                                    - =.builtIn.number.less:
                                        dataIn:
                                          num1: =..formData.tablePageNum
                                          num2: =..formData.tableData.1
                                    - actionType: evalObject
                                      object:
                                        - =.builtIn.number.addition:
                                            dataIn:
                                              num: =..formData.tablePageNum
                                              step: "1"
                                            dataOut: RoomManagement.formData.tablePageNum # update page num
                                        - =.builtIn.array.splitTableList:
                                            dataIn:
                                              arrObj: =..roomList.docResp.doc
                                              numX: "12"
                                              numY: =..formData.tablePageNum
                                            dataOut: RoomManagement.formData.tableData
                                        - ..formData.tableList@: =..formData.tableData.0
                                        - =.builtIn.array.setPropertyInterlacedChange:
                                            dataIn:
                                              arrIn: =..formData.tableList
                                              arr: [ "backgroundColor" ]
                                              valueArr: [ "0xf5f5f5" ]
                                              errorArr: [ "0xffffff" ]
                                            dataOut: RoomManagement.formData.tableList
                                        - =.builtIn.string.concat:
                                            dataIn:
                                              - =..formData.tablePageNum
                                              - " / "
                                              - =..formData.tableData.1
                                            dataOut: RoomManagement.formData.tableCurrentPage # current page 
                                    - continue
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableView
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableFooter
                          style:
                            top: "0"
                            left: "0.03712"
                            height: "0.02576"
                            width: "0.01456"
                    # Goto
                    - type: view
                      style:
                        top: "0"
                        left: "0.14"
                        width: "0.05"
                        height: "0.02496"
                      children:
                        - type: textField
                          viewTag: gotoView
                          dataKey: formData.gotoPageNum
                          style:
                            width: "0.02496"
                            top: "0"
                            height: "0.02576"
                            borderRadius: "3"
                            borderWidth: "1"
                            border:
                              style: "3"
                            boxSizing: border-box
                            borderColor: "0xd8d8d8"
                            fontSize: .Nfont.nf0
                            fontWeight: "500"
                            color: "0x333333"
                            textAlign:
                              x: center
                              y: center
                        - type: button
                          text: Go to
                          style:
                            textDecoration: underline
                            left: "0.029"
                            top: "0"
                            height: "0.02576"
                            border:
                              style: "1"
                            fontSize: .Nfont.nf0
                            color: "0x333333"
                            backgroundColor: "0xffffff00"
                          onClick:
                            - action: evalObject
                              object:
                                .Global._nonce@:
                                  =.builtIn.math.random: ""
                            - actionType: evalObject
                              object:
                                - if:
                                    - =.builtIn.number.less:
                                        dataIn:
                                          num1: =..formData.gotoPageNum
                                          num2: 1
                                    - continue
                                    - actionType: evalObject
                                      object:
                                        - if:
                                            - =.builtIn.number.less:
                                                dataIn:
                                                  num1: =..formData.gotoPageNum
                                                  num2: =..formData.totalPageMore
                                            - actionType: evalObject
                                              object:
                                                - =.builtIn.array.splitTableList:
                                                    dataIn:
                                                      arrObj: =..roomList.docResp.doc
                                                      numX: "12"
                                                      numY: =..formData.gotoPageNum
                                                    dataOut: RoomManagement.formData.tableData
                                                - ..formData.tableList@: =..formData.tableData.0
                                                - =.builtIn.array.setPropertyInterlacedChange:
                                                    dataIn:
                                                      arrIn: =..formData.tableList
                                                      arr: [ "backgroundColor" ]
                                                      valueArr: [ "0xf5f5f5" ]
                                                      errorArr: [ "0xffffff" ]
                                                    dataOut: RoomManagement.formData.tableList
                                                - =.builtIn.string.concat:
                                                    dataIn:
                                                      - =..formData.gotoPageNum
                                                      - " / "
                                                      - =..formData.tableData.1
                                                    dataOut: RoomManagement.formData.tableCurrentPage # current page
                                                - ..formData.tablePageNum@: =..formData.gotoPageNum
                                                - ..formData.gotoPageNum@: ""
                                            - continue
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableView
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: tableFooter

        # Edit Room
        - type: popUp
          style:
            width: '1'
            height: '0.999'
            top: '0'
            left: '0'
            backgroundColor: '0x00000033'
            zIndex: "10"
          viewTag: editRoomView
          children:
            - type: view
              style:
                left: "0.6"
                width: "0.4"
                top: "0"
                height: "1"
                backgroundColor: "0xffffff"
              children:
                - .PopUphead:
                  children:
                    - .CreateLabel:
                      text: 'Edit Room Info'
                    - .Closebutton:
                      onClick:
                        - actionType: evalObject
                          object:
                            - ..reasonObj.reason@: ""
                            - ..reasonObj.document@: []
                        - actionType: popUpDismiss
                          popUpView: editRoomView
                        - actionType: popUpDismiss
                          popUpView: documentViewEdit
                - type: scrollView
                  viewTag: editView
                  style:
                    height: '0.84'
                    width: '0.4'
                    top: '0.08'
                    backgroundColor: '0xffffff'
                    overflow: scroll
                  children:
                    - type: view
                      style:
                        marginTop: "0"
                        width: "0.4"
                        left: "0"
                        height: "0.425"
                      children:
                        - .ProdManageView:
                          style:
                            marginTop: "0.025"
                            height: "0.07"
                            left: "0.047"
                          children:
                            - .RoomManageLabelNewUI:
                              text: Location
                            - type: textField
                              isEditable: false
                              dataKey: formData.address
                              style:
                                width: "0.31"
                                marginTop: "0.01"
                                height: "0.047"
                                boxSizing: border-box
                                borderRadius: "5"
                                border:
                                  style: "3"
                                borderWidth: "1"
                                textIndent: 0.6em
                                borderColor: "0xeaeaea"
                                textAlign:
                                  y: center
                        - .ProdManageView:
                          style:
                            marginTop: "0.035"
                            height: "0.07"
                            left: "0.047"
                          children:
                            - .RoomManageLabelNewUI:
                              text: Room Name
                            - type: textField
                              placeholder: Enter Here
                              dataKey: roomProfile.document.name.data.roomName
                              style:
                                width: "0.31"
                                marginTop: "0.01"
                                height: "0.047"
                                boxSizing: border-box
                                borderRadius: "5"
                                border:
                                  style: "3"
                                borderWidth: "1"
                                textIndent: 0.6em
                                borderColor: "0xeaeaea"
                                textAlign:
                                  y: center
                        - .ProdManageView:
                          style:
                            marginTop: "0.035"
                            height: "0.07"
                            left: "0.047"
                          children:
                            - .RoomManageLabelNewUI:
                              text: Room ID
                            - type: textField
                              # placeholder: "Enter Here"
                              isEditable: false
                              dataKey: roomProfile.document.name.data.roomId
                              style:
                                width: "0.31"
                                marginTop: "0.01"
                                height: "0.047"
                                boxSizing: border-box
                                borderRadius: "5"
                                border:
                                  style: "3"
                                borderWidth: "1"
                                textIndent: 0.6em
                                borderColor: "0xeaeaea"
                                textAlign:
                                  y: center
                        - .ProdManageView:
                          style:
                            marginTop: "0.035"
                            height: "0.07"
                            left: "0.047"
                          children:
                            - .RoomManageLabelNewUI:
                              text: Service Type
                            - type: textField
                              dataKey: roomProfile.document.name.data.service
                              isEditable: false
                              # options: 
                              #   - Telemedicine
                              #   - Office Visit
                              #   - COVID-19 Testing
                              #   - COVID-19 Vaccine
                              style:
                                width: "0.31"
                                marginTop: "0.01"
                                height: "0.047"
                                boxSizing: border-box
                                borderRadius: "5"
                                border:
                                  style: "3"
                                borderWidth: "1"
                                textIndent: 0.6em
                                borderColor: "0xeaeaea"
                                textAlign:
                                  y: center
                - .ConfirmBtnView:
                  children:
                    - .ConfirmBtn:
                      style:
                        width: "0.085"
                        height: "0.043"
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: documentViewEdit
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - ..reasonObj.reason@: ""
                        - ..reasonObj.document@: []
                        - ..room.vertex.name.basicInfo@: =..roomProfile.document.name.data
                        - ..room.vertex.uid@: =..room.vertex.name.basicInfo.roomId
                        - .Global.jwt.edge.bvid@: =..room.vertex.id
                        - =.Global.jwt.edgeAPI.store: ""
                        - =..room.vertexAPI.store: ""
                        - =.builtIn.search.updateEsData:
                            dataIn:
                              id: =..room.resp.data.vertex.id
                              type: '655363'
                            dataOut: RoomManagement.formData.res
                        - =..roomProfile.docAPI.store: ""
                        - ..roomListReget.docIn.ids.0@: =..formData.locationTableId
                        - =..roomListReget.docAPI.get: ""
                        - =.builtIn.array.removeById:
                            dataIn:
                              object: =.Global.roomAll
                              id: =..room.vertex.id
                        - =.builtIn.array.add:
                            dataIn:
                              object: =.Global.roomAll
                              value: =..room.resp.vertex
                        # - ..formData.tableList@: =..roomListReget.docResp.doc
                        # - ..roomListReget.docResp.doc@: []
                        - =.builtIn.array.splitTableList:
                            dataIn:
                              arrObj: =..roomListReget.docResp.doc
                              numX: "12"
                              numY: "1"
                            dataOut: RoomManagement.formData.tableData
                        - ..formData.tableList@: =..formData.tableData.0
                        - =.builtIn.string.concat:
                            dataIn:
                              - =..formData.tablePageNum # page num
                              - " / "
                              - =..formData.tableData.1 # total page
                            dataOut: RoomManagement.formData.tableCurrentPage
                        - =.builtIn.search.updateEsData:
                            dataIn:
                              id: =..room.vertex.id
                              type: '655363'
                            dataOut: RoomManagement.formData.res
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: tableView
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: tableFooter
                    - actionType: popUpDismiss
                      popUpView: editRoomView

        - type: popUp
          style:
            width: '1'
            height: '1'
            top: '0'
            left: '0'
            backgroundColor: '0x00000033'
            zIndex: "10"
          viewTag: addRoomView
          children:
            - type: view
              style:
                left: "0.6"
                width: "0.4"
                top: "0"
                height: "1"
                backgroundColor: "0xffffff"
              children:
                - .PopUphead:
                  children:
                    - .CreateLabel:
                      text: 'Add New Room'
                    - .Closebutton:
                      onClick:
                        - actionType: evalObject
                          object:
                            - ..reasonObj.reason@: ""
                            - ..reasonObj.document@: []
                        - actionType: popUpDismiss
                          popUpView: addRoomView
                        - actionType: popUpDismiss
                          popUpView: documentView1
                - type: scrollView
                  viewTag: addView
                  style:
                    height: '0.84'
                    width: '0.4'
                    top: '0.08'
                    backgroundColor: '0xffffff'
                    overflow: scroll
                  children:
                    - type: view
                      style:
                        marginTop: "0"
                        width: "0.4"
                        left: "0"
                        height: "0.425"
                        # backgroundColor: "0xcdcdcd"
                      children:
                        - .ProdManageView:
                          style:
                            marginTop: "0.025"
                            height: "0.07"
                            left: "0.047"
                          children:
                            - .RoomManageLabelNewUI:
                              text: Location
                            - type: select
                              dataKey: formData.address
                              options: ..formData.addressName
                              onChange:
                                - actionType: evalObject
                                  object:
                                    - =.builtIn.array.matchInArray:
                                        dataIn:
                                          arr: =.Global.locationAll
                                          value: =..formData.address
                                          key: medicalFacilityName
                                          key1: "id"
                                        dataOut: RoomManagement.formData.locationId
                                    - =.builtIn.array.matchInArray:
                                        dataIn:
                                          arr: =.Global.locationAll
                                          value: =..formData.address
                                          key: medicalFacilityName
                                          key1: "locationID"
                                        dataOut: RoomManagement.formData.locationOwnId
                              style:
                                width: "0.31"
                                marginTop: "0.01"
                                height: "0.047"
                                boxSizing: border-box
                                borderRadius: "5"
                                border:
                                  style: "3"
                                borderWidth: "1"
                                textIndent: 0.6em
                                borderColor: "0xeaeaea"
                                textAlign:
                                  y: center
                        - .ProdManageView:
                          style:
                            marginTop: "0.035"
                            height: "0.07"
                            left: "0.047"
                          children:
                            - .RoomManageLabelNewUI:
                              text: Room Name
                            - type: textField
                              placeholder: Enter Here
                              dataKey: room.vertex.name.basicInfo.roomName
                              onTextChange:
                                - actionType: evalObject
                                  object:
                                    - =.builtIn.string.generateID:
                                        dataIn:
                                          facilityID: ""
                                          locationID: =..formData.locationOwnId
                                          roomID: =..room.vertex.name.basicInfo.roomName
                                        dataOut: RoomManagement.room.vertex.name.basicInfo.roomId
                                - actionType: builtIn
                                  funcName: redraw
                                  viewTag: roomIDView
                              style:
                                width: "0.31"
                                marginTop: "0.01"
                                height: "0.047"
                                boxSizing: border-box
                                borderRadius: "5"
                                textIndent: 0.6em
                                border:
                                  style: "3"
                                borderWidth: "1"
                                borderColor: "0xdddddd"
                                textAlign:
                                  y: center
                        - .ProdManageView:
                          viewTag: roomIDView
                          style:
                            marginTop: "0.035"
                            height: "0.07"
                            left: "0.047"
                          children:
                            - .RoomManageLabelNewUI:
                              text: Room ID
                            - type: textField
                              placeholder: "Enter Here"
                              dataKey: room.vertex.name.basicInfo.roomId
                              style:
                                width: "0.31"
                                borderRadius: "5"
                                textIndent: 0.6em
                                marginTop: "0.01"
                                height: "0.047"
                                boxSizing: border-box
                                border:
                                  style: "3"
                                borderWidth: "1"
                                borderColor: "0xdddddd"
                                textAlign:
                                  # x: right
                                  y: center
                        - .ProdManageView:
                          style:
                            marginTop: "0.035"
                            left: "0.047"
                            height: "0.07"
                          children:
                            - .RoomManageLabelNewUI:
                              text: Service Type
                            - type: select
                              dataKey: room.vertex.name.basicInfo.service
                              options:
                                # - Telemedicine
                                # - Office Visit
                                - COVID-19 Testing
                                - COVID-19 Vaccine
                                - Flu Shot
                              onChange:
                                - actionType: popUpDismiss
                                  popUpView: documentView1
                              style:
                                width: "0.31"
                                borderRadius: "5"
                                textIndent: 0.6em
                                marginTop: "0.01"
                                height: "0.047"
                                boxSizing: border-box
                                border:
                                  style: "3"
                                borderWidth: "1"
                                borderColor: "0xdddddd"
                                textAlign:
                                  # x: right
                                  y: center
                - .ConfirmBtnView:
                  children:
                    - .ConfirmBtn:
                      style:
                        width: "0.085"
                        height: "0.043"
                      onClick:
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: ""
                        - actionType: evalObject
                          object:
                            - ..reasonObj.reason@: ""
                            - ..reasonObj.document@: []
                            - .Global.jwt.edge.bvid@: =..formData.locationId
                            - =.Global.jwt.edgeAPI.store: ""
                            - ..setLocation.docResp.doc@: []
                            - ..setLocation.docIn.id@: =..formData.locationId

                            - =..setLocation.docAPI.get: ""
                            - ..setLocation.document@: =..setLocation.docResp.doc.0
                            - =.builtIn.array.add:
                                dataIn:
                                  object: =..setLocation.document.name.data.basicInfo.service
                                  value: =..room.vertex.name.basicInfo.service
                            - =.builtIn.array.elementUnique:
                                dataIn:
                                  arr: =..setLocation.document.name.data.basicInfo.service
                                dataOut: RoomManagement.setLocation.document.name.data.basicInfo.service
                            - =..setLocation.docAPI.store: ""
                            # - .Global.formData.roomLocation@: =..setLocation.storeResp.doc
                            - ..room.vertex.uid@: =..room.vertex.name.basicInfo.roomId
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..room.vertex.name.basicInfo.service
                                      string2: "COVID-19 Testing"
                                - ..room.vertex.name.basicInfo.serviceType@: "655363"
                                - continue
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..room.vertex.name.basicInfo.service
                                      string2: "COVID-19 Vaccine"
                                - ..room.vertex.name.basicInfo.serviceType@: "393219"
                                - continue
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..room.vertex.name.basicInfo.service
                                      string2: "Flu Shot"
                                - ..room.vertex.name.basicInfo.serviceType@: "786435"
                                - continue
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..room.vertex.name.basicInfo.service
                                      string2: "Telemedicine"
                                - ..room.vertex.name.basicInfo.serviceType@: "196611"
                                - continue
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..room.vertex.name.basicInfo.service
                                      string2: "Office Visits"
                                - ..room.vertex.name.basicInfo.serviceType@: "131075"
                                - continue
                            - .Global.jwt.edge.bvid@: =..formData.locationId
                            - =.Global.jwt.edgeAPI.store: ""
                            - =..room.vertexAPI.store: ""
                            - =.builtIn.search.updateEsData:
                                dataIn:
                                  id: =..room.vertex.id
                                  type: '655363'
                                dataOut: RoomManagement.formData.res
                            - ..formData.locationStatus@: =..room.resp.code
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..formData.locationStatus
                                      string2: -1
                                - actionType: popUp
                                  popUpView: roomIDTag
                                  wait: true
                                - continue
                            - ..fac_RootNotebook.edgeReq.id@: =..room.resp.data.vertex.id
                            - =..fac_RootNotebook.edgeAPI.get: ""
                            - .Global.jwt.edge.bvid@: =..room.resp.data.vertex.id
                            - =.Global.jwt.edgeAPI.store: ""

                            - ..roomProfile.document.eid@: =..room.resp.data.vertex.deat.rnb64ID
                            - ..roomProfile.document.name.data@: =..room.resp.data.vertex.name.basicInfo
                            - =.builtIn.string.concat:
                                dataIn:
                                  - "search.aitmed.com/"
                                  - =..roomProfile.document.name.data.roomId
                                dataOut: RoomManagement.roomProfile.document.name.data.roomLink
                            - =..roomProfile.docAPI.store: ""
                            - ..roomListReget.docIn.ids.0@: =..formData.locationTableId
                            # - .Global.jwt.edge.bvid@: =..formData.locationTableId
                            # - =.Global.jwt.edgeAPI.store: ""
                            - =..roomListReget.docAPI.get: ""
                            # - ..formData.tableList@: =..roomListReget.docResp.doc
                            # - ..roomListReget.docResp.doc@: []
                            - =.builtIn.array.splitTableList:
                                dataIn:
                                  arrObj: =..roomListReget.docResp.doc
                                  numX: "12"
                                  numY: "1"
                                dataOut: RoomManagement.formData.tableData
                            - ..formData.tableList@: =..formData.tableData.0
                            - =.builtIn.array.setPropertyInterlacedChange:
                                dataIn:
                                  arrIn: =..formData.tableList
                                  arr: [ "backgroundColor" ]
                                  valueArr: [ "0xf5f5f5" ]
                                  errorArr: [ "0xffffff" ]
                                dataOut: RoomManagement.formData.tableList
                            - =.builtIn.string.concat:
                                dataIn:
                                  - =..formData.tablePageNum # page num
                                  - " / "
                                  - =..formData.tableData.1 # total page
                                dataOut: RoomManagement.formData.tableCurrentPage
                            - ..apiRequest.roomList.vertexIn.id@: =.Global.alllocationID
                            - =..apiRequest.roomList.vertexAPI.get: ""
                            - .Global.roomAll@: =..apiRequest.roomList.vertexResp.vertex
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: tableView
                        - actionType: popUp
                          popUpView: successView
                        - actionType: popUpDismiss
                          popUpView: addRoomView
                        - actionType: popUpDismiss
                          popUpView: documentView1

        - type: popUp
          style:
            width: '1'
            height: '1'
            top: '0'
            left: '0'
            backgroundColor: '0x00000033'
            zIndex: "10"
          viewTag: successView
          children:
            - type: view
              style:
                left: "0.6"
                width: "0.4"
                top: "0"
                height: "1"
                backgroundColor: "0xffffff"
              children:
                - .PopUphead:
                  children:
                    - .CreateLabel:
                      text: 'Create a new Room'
                    - .Closebutton:
                      onClick:
                        - actionType: popUpDismiss
                          popUpView: successView
                - type: scrollView
                  viewTag: addView
                  style:
                    width: '0.4'
                    top: '0.08'
                    backgroundColor: '0xffffff'
                    overflow: scroll
                  children:
                    - type: image
                      path: successfulGreen.svg
                      style:
                        left: "0.165"
                        width: "0.05"
                        marginTop: "0.1"
                    - type: label
                      text: Save Successfully!
                      style:
                        left: "0.1"
                        width: "0.2"
                        marginTop: "0.02"
                        height: "0.06"
                        fontSize: .Nfont.n4_2
                        fontFamily: poppins
                        fontWeight: "700"
                        textAlign:
                          x: center
                    - type: label
                      textBoard:
                        - text: Please don't forget to set the room schedule availability.
                      style:
                        left: "0"
                        width: "0.4"
                        height: "0.1"
                        fontSize: .Nfont.nf4
                        fontFamily: poppins
                        fontWeight: "500"
                        textAlign:
                          x: center
                - type: button
                  text: Go to set room schedule
                  style:
                    width: "0.31"
                    left: "0.05"
                    height: "0.045"
                    top: "0.455"
                    color: "0xffffff"
                    backgroundColor: "#005795"
                    fontSize: .Nfont.nf3
                    border:
                      style: "3"
                      color: "#005795"
                    borderRadius: "5"
                  onClick:
                    - actionType: evalObject
                      object:
                        - .Global.locationId@: =..formData.locationId
                        - .Global.acceptInfo@: =..roomProfile.docStoreResp.doc
                        - .Global.formData.service@: =..roomProfile.docStoreResp.doc.name.data.service
                        - .Global.formData.serviceType@: =..roomProfile.docStoreResp.doc.name.data.serviceType
                    - actionType: popUpDismiss
                      popUpView: successView
                    - goto: ScheduleSettingRoomTime
                - type: button
                  text: Set it later
                  style:
                    width: "0.2"
                    left: "0.1"
                    height: "0.05"
                    top: "0.5"
                    textDecoration: underline
                    backgroundColor: "0xffffff"
                    fontSize: .Nfont.nf3
                    fontWeight: "600"
                    fontFamily: poppins
                    border:
                      style: "1"
                  onClick:
                    - actionType: evalObject
                      object:
                        - ..formData.address@: =.Global.locationAll.0.medicalFacilityName
                        - ..room.vertex.name.basicInfo.roomId@: ""
                        - ..room.vertex.name.basicInfo.roomName@: ""
                        - ..room.vertex.name.basicInfo.roomId@: ""
                        - ..room.vertex.name.basicInfo.service@: ""
                        - ..roomListReget.docIn.ids.0@: =..formData.locationTableId
                        # - .Global.jwt.edge.bvid@: =..formData.locationTableId
                        # - =.Global.jwt.edgeAPI.store: ""
                        - =..roomListReget.docAPI.get: ""
                        # - ..formData.tableList@: =..roomListReget.docResp.doc
                        # - ..roomListReget.docResp.doc@: []
                        - =.builtIn.array.splitTableList:
                            dataIn:
                              arrObj: =..roomListReget.docResp.doc
                              numX: "12"
                              numY: "1"
                            dataOut: RoomManagement.formData.tableData
                        - ..formData.tableList@: =..formData.tableData.0
                        - =.builtIn.array.setPropertyInterlacedChange:
                            dataIn:
                              arrIn: =..formData.tableList
                              arr: [ "backgroundColor" ]
                              valueArr: [ "0xf5f5f5" ]
                              errorArr: [ "0xffffff" ]
                            dataOut: RoomManagement.formData.tableList
                        - =.builtIn.string.concat:
                            dataIn:
                              - =..formData.tablePageNum # page num
                              - " / "
                              - =..formData.tableData.1 # total page
                            dataOut: RoomManagement.formData.tableCurrentPage
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: tableView
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: tableFooter
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: addRoomView
                    - actionType: popUpDismiss
                      popUpView: successView
        - .LoadingPopUpView:
          viewTag: loadingTag
