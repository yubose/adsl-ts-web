SchduleSetting:
  init:
    - .SignInCheck
    - actionType: evalObject
      object: 
        .Global._nonce@: 
          =.builtIn.math.random: ""
    - actionType: updateObject
      dataKey: Global.currentSchedule
      dataObject: []
    - actionType: evalObject
      object:
        - .Global.jwt.edge.bvid@: =.Global.currentFacility.id
        - =.Global.jwt.edgeAPI.store: ""
    - =.builtIn.array.selectOneToArr:
        dataIn:
          arr: =.Global.locationAll
          key: "medicalFacilityName"
        dataOut: SchduleSetting.addressName
    # - ..formDataOfficeVisisAddress@: =..addressName.0
    - =.builtIn.array.matchInArray:
        dataIn:
          arr: =.Global.locationAll
          value: =..addressName.0
          key: medicalFacilityName
          key1: "id"
        dataOut: SchduleSetting.locationId
    - =.builtIn.array.add:
        dataIn:
          object: =..getScheduleOfficeVisit.edgeReq.id
          value: =..locationId
    - =..getScheduleTelemedicine.get: ""
    - =..getScheduleOfficeVisit.get: ""
    - actionType: evalObject
      object:
        - ..formDataTelemedicine@: =..getScheduleTelemedicine.schedule.edge.0
        - ..formDataOfficeVisit@: =..getScheduleOfficeVisit.schedule.edge.0
    - actionType: evalObject
      object:
        - if:
          - =.SchduleSetting.getScheduleTelemedicine.schedule.edge.0.id
          - =.builtIn.array.WeekSchedule:
              dataIn:
                planObject: =.SchduleSetting.getScheduleTelemedicine.schedule.edge.0.name.setting.day
              dataOut: SchduleSetting.dayTelemedicine
          - continue
        - if:
          - =.SchduleSetting.getScheduleOfficeVisit.schedule.edge.0.id
          - =.builtIn.array.WeekSchedule:
              dataIn:
                planObject: =.SchduleSetting.getScheduleOfficeVisit.schedule.edge.0.name.setting.day
              dataOut: SchduleSetting.dayOfficeVisit
          - continue
        # - =.builtIn.search.updateEsData:
        #     dataIn:
        #       id: =.Global.formData.scheduleManageProdId
        #       type: '40000'
        #     dataOut: SchduleSetting.res
  getScheduleTelemedicine:
    schedule:
      edge:
        name:
          setting:
            day: []
    get:
      .EdgeAPI.get: ""
      api: re
      dataKey: SchduleSetting.getScheduleTelemedicine.schedule
      type: 40000
      id: 
        - .Global.acceptInfo.bsig
        - .Global.currentFacility.id
      # sCondition: "subtype=131075"
      sCondition: "subtype=196611"
      xfname: "evid,bvid"
      maxcount: "1"
      obfname : "ctime"
      _nonce: =.Global._nonce
  getScheduleOfficeVisit:
    edgeReq: 
      type: 40000
      id: 
        - .Global.acceptInfo.bsig
        # - .Global.currentFacility.id
      sCondition: "subtype=131075"
      # sCondition: "subtype=196611"
      xfname: "evid,bvid"
      maxcount: "1"
      obfname : "ctime"
      _nonce: =.Global._nonce
    schedule:
      edge:
        name:
          setting:
            day: []
    get:
      .EdgeAPI.get: ""
      api: re
      dataIn: SchduleSetting.getScheduleOfficeVisit.edgeReq
      dataOut: SchduleSetting.getScheduleOfficeVisit.schedule

  weekLabel:
      - key: Sunday
      - key: Monday
      - key: Tuesday
      - key: Wednesday
      - key: Thursday
      - key: Friday
      - key: Saturday
  formDataTelemedicine: ""
  dayTelemedicine: ""
  formDataOfficeVisit: ""
  formDataOfficeVisisAddress: ..addressName.0  # 给select的dataKey一个初始值，如果不赋值，dataKey在未选择之前都是空的
  locationId: ""
  dayOfficeVisit: ""
  components:
    - .BaseCheckView: ""
      message: "You don't have the authority to edit"
      viewTag: pATAuthEdit
      style: 
        zIndex: "100000"
    - type: view
      style:
        width: '1'
        height: '1'
        margin: auto
      children:
        - .SideMenuBar:
          children:
            - .aitLogo:
            - .MenuBar:
        - .TopBar:
        - .BodyView:
          children:
            - type: view
              style:  
                left: "0.03"
                top: "0.015"
                width: "0.8"
                height: "0.06"
              children: 
                - .BackLabel: 
            - .ContentView:
              style:
                top: "0.075"
              children:
                - type: view
                  style:
                    width: "0.78"
                    height: "0.1"
                    top: "0"
                    left: "0"
                    display: flex
                    alignItems: center
                  children: 
                    - type: label
                      text: "Provider Name:"
                      style:
                        display: inline-block
                        marginLeft: "0.022"
                        fontSize: .Nfont.nf4
                        fontFamily: "Roboto"
                    - type: label
                      dataKey: Global.acceptInfo.name.data.fullName
                      style:
                        display: inline-block
                        marginLeft: "0.01"
                        fontSize: .Nfont.nf4
                        # fontFamily: "Roboto"                        
                - type: view
                  style:
                    width: "0.78"
                    height: "0.6"
                    top: "0.1"
                    left: "0"
                  children: 
                    - type: view
                      style: 
                        left: "0"
                        width: "0.39"
                        top: "0"
                        height: "0.6"
                        # backgroundColor: "0xff000033"
                      children: 
                        - type: view
                          style:
                            left: "0"
                            width: "0.4"
                            top: "0"
                            height: "0.5"
                          children: 
                            - type: button
                              text: Edit
                              onClick: 
                                - actionType: evalObject
                                  object:
                                    - .Global.formData.scheduleType@: Telemedicine
                                    - .Global.currentSchedule@: =..getScheduleTelemedicine.schedule.edge.0
                                    - .Global.setSchedule.scheduleTypeNumber@: "196611"
                                # - actionType: evalObject
                                #   object:
                                #     - if: 
                                #       - =.builtIn.string.equal:
                                #           dataIn: 
                                #             string1: =.Global.auth.PAT.edit
                                #             string2: true 
                                #       - goto: ScheduleSettingsDisplay
                                #       - actionType: popUp
                                #         popUpView: pATAuthEdit
                                - goto: ScheduleSettingsDisplay
                              style:
                                top: "0"
                                width: "0.04"
                                left: "0.33"
                                height: "0.03"
                                color: "0xffffff"
                                fontSize: "1.7vh"
                                # textDecoration: underline
                                border: 
                                  style: "5"
                                # borderWidth: "1"
                                # borderColor: "0x005795"
                                # borderRadius: "5"
                                backgroundColor: "0x005795"
                                borderRadius: '5'
                                textAlign:
                                  x: center
                                  y: center
                            - type: view
                              style: 
                                marginTop: "0.01"
                                width: "0.35"
                                left: "0"
                                height: "0.08"
                              children: 
                                - type: label
                                  text: Start Date
                                  style: 
                                    left: "0.022"
                                    width: "0.1"
                                    top: "0"
                                    height: "0.03"
                                    textAlign: 
                                      x: left
                                    fontSize: .Nfont.nf2
                                - type: label
                                  dataKey: formDataTelemedicine.name.setting.startDate
                                  style: 
                                    left: "0.02"
                                    width: "0.115"
                                    top: "0.035"
                                    height: "0.04"
                                    border: 
                                      style: "3"
                                    borderWidth: "1"
                                    borderColor: "0xdededf"
                                    borderRadius: "2"
                                    textAlign: 
                                      y: center
                                    textIndent: "10px"
                                - type: label
                                  text: Repeat weeks
                                  style: 
                                    left: "0.137"
                                    width: "0.115"
                                    top: "0"
                                    height: "0.03"
                                    textAlign: 
                                      x: left
                                    fontSize: .Nfont.nf2
                                - type: label
                                  dataKey: formDataTelemedicine.name.setting.forwardRepeatWeeks
                                  style: 
                                    left: "0.135"
                                    width: "0.115"
                                    top: "0.035"
                                    height: "0.04"
                                    border: 
                                      style: "3"
                                    borderWidth: "1"
                                    borderColor: "0xdededf"
                                    borderRadius: "2"
                                    textAlign: 
                                      y: center
                                    textIndent: "10px"
                            - type: view
                              style: 
                                marginTop: "0.035"
                                width: "0.35"
                                left: "0.02"
                                height: "0.045"
                                backgroundColor: "0x005795"
                              children: 
                                - type: label
                                  text: Telemedicine
                                  dataKey: 
                                  style:
                                    left: "0.02"
                                    width: "0.3"
                                    top: "0"
                                    height: "0.045"
                                    textAlign: 
                                      y: center
                                    fontSize: "1.7vh"
                                    color: "0xffffff"
                                    border: 
                                      style: "5"
                                    borderRadius: "2"
                            - type: view
                              style: 
                                marginTop: "0"
                                width: "0.35"
                                left: "0.02"
                                height: "0.33"
                                # overflow: scroll
                              children: 
                                - type: list
                                  contentType: listObject
                                  listObject: ..dayTelemedicine
                                  iteratorVar: itemObject
                                  style:
                                    width: '0.35'
                                    left: "0"
                                    margin: '0'
                                    height: auto
                                  children:
                                    - type: listItem
                                      itemObject: ""
                                      style:
                                        width: '0.349'
                                        height: '0.045'
                                        left: '0'
                                        border: 
                                          style: "3"
                                        borderWidth: "1"
                                        borderColor: "#ccdae4"
                                        borderRadius: "2"
                                      children:
                                        - type: label
                                          dataKey: itemObject.weekDay
                                          style: 
                                            left: "0"
                                            width: "0.1"
                                            top: "0"
                                            height: "0.045"
                                            fontWeight: "500"
                                            fontSize: .Nfont.nf2
                                            backgroundColor: "0xf7f7f7"
                                            textAlign: 
                                              x: center
                                              y: center
                                        - type: label
                                          dataKey: itemObject.info
                                          style: 
                                            left: "0.1"
                                            width: "0.24"
                                            top: "0"
                                            height: "0.045"
                                            fontSize: .Nfont.nf2
                                            textAlign: 
                                              x: center
                                              y: center
                    - type: view
                      style: 
                        left: "0.39"
                        width: "0.39"
                        top: "0"
                        height: "0.6"
                        # backgroundColor: "0xcdcdcd"
                      children: 
                        - type: view
                          style:
                            left: "0"
                            width: "0.39"
                            top: "0"
                            height: "0.5"
                          children: 
                            - type: button
                              text: Edit
                              onClick: 
                                - actionType: evalObject
                                  object:
                                    - .Global.formData.scheduleType@: Office Visit
                                    - .Global.formData.scheduleAddress@: =..formDataOfficeVisisAddress
                                    - .Global.formData.scheduleLocationId@: =..locationId
                                    - .Global.currentSchedule@: =..getScheduleOfficeVisit.schedule.edge.0
                                    - .Global.setSchedule.scheduleTypeNumber@: "131075"
                                # - actionType: evalObject
                                #   object:
                                #     - if: 
                                #       - =.builtIn.string.equal:
                                #           dataIn: 
                                #             string1: =.Global.auth.PAT.edit
                                #             string2: true 
                                #       - goto: ScheduleSettingsDisplay
                                #       - actionType: popUp
                                #         popUpView: pATAuthEdit
                                - goto: ScheduleSettingsDisplay
                              style:
                                top: "0"
                                width: "0.04"
                                left: "0.325"
                                height: "0.03"
                                color: "0xffffff"
                                fontSize: "1.7vh"
                                # textDecoration: underline
                                border: 
                                  style: "5"
                                zIndex: "100"
                                backgroundColor: "0x005795"
                                borderRadius: '5'
                                textAlign:
                                  x: center
                                  y: center
                            - type: view
                              viewTag: availabilityView
                              style: 
                                marginTop: "0.01"
                                width: "0.39"
                                left: "0"
                                height: "0.08"
                              children: 
                                - type: label
                                  text: Start Date
                                  style: 
                                    left: "0.022"
                                    width: "0.1"
                                    top: "0"
                                    height: "0.03"
                                    textAlign: 
                                      x: left
                                    fontSize: .Nfont.nf2
                                - type: label
                                  dataKey: formDataOfficeVisit.name.setting.startDate
                                  style: 
                                    left: "0.02"
                                    width: "0.115"
                                    top: "0.035"
                                    height: "0.04"
                                    border: 
                                      style: "3"
                                    borderWidth: "1"
                                    borderColor: "0xdededf"
                                    borderRadius: "2"
                                    textAlign: 
                                      y: center
                                    textIndent: "10px"
                                - type: label
                                  text: Repeat weeks
                                  style: 
                                    left: "0.137"
                                    width: "0.115"
                                    top: "0"
                                    height: "0.03"
                                    textAlign: 
                                      x: left
                                    fontSize: .Nfont.nf2
                                - type: label
                                  dataKey: formDataOfficeVisit.name.setting.forwardRepeatWeeks
                                  style: 
                                    left: "0.135"
                                    width: "0.115"
                                    top: "0.035"
                                    height: "0.04"
                                    border: 
                                      style: "3"
                                    borderWidth: "1"
                                    borderColor: "0xdededf"
                                    borderRadius: "2"
                                    textAlign: 
                                      y: center
                                    textIndent: "10px"
                                - type: label
                                  text: Address
                                  style: 
                                    left: "0.25"
                                    width: "0.1"
                                    top: "0"
                                    height: "0.03"
                                    textAlign: 
                                      x: left
                                    fontSize: .Nfont.nf2
                                - type: select
                                  dataKey: formDataOfficeVisisAddress
                                  onChange: 
                                    - actionType: evalObject
                                      object: 
                                        - =.builtIn.array.matchInArray:
                                            dataIn:
                                              arr: =.Global.locationAll
                                              value: =..formDataOfficeVisisAddress
                                              key: medicalFacilityName
                                              key1: "id"
                                            dataOut: SchduleSetting.locationId
                                        - ..getScheduleOfficeVisit.edgeReq.id@: []
                                        - ..getScheduleOfficeVisit.schedule.edge@: []
                                        - =.builtIn.array.add:
                                            dataIn:
                                              object: =..getScheduleOfficeVisit.edgeReq.id
                                              value: =.Global.acceptInfo.bsig
                                        - =.builtIn.array.add:
                                            dataIn:
                                              object: =..getScheduleOfficeVisit.edgeReq.id
                                              value: =..locationId
                                    - actionType: evalObject
                                      object: 
                                        .Global._nonce@: 
                                          =.builtIn.math.random: ""
                                    - actionType: evalObject
                                      object: 
                                        - =..getScheduleOfficeVisit.get: ""
                                        - ..formDataOfficeVisit@: =..getScheduleOfficeVisit.schedule.edge.0
                                        - if: 
                                          - =.SchduleSetting.getScheduleOfficeVisit.schedule.edge.0.id
                                          - =.builtIn.array.WeekSchedule:
                                              dataIn:
                                                planObject: =.SchduleSetting.getScheduleOfficeVisit.schedule.edge.0.name.setting.day
                                              dataOut: SchduleSetting.dayOfficeVisit
                                          - ..dayOfficeVisit@: []
                                        - if: 
                                          - =.SchduleSetting.getScheduleOfficeVisit.schedule.edge.0
                                          - continue
                                          - actionType: evalObject
                                            object: 
                                              - ..formDataOfficeVisit.name.setting.startDate@: ""
                                              - ..formDataOfficeVisit.name.setting.forwardRepeatWeeks@: ""
                                    - actionType: builtIn
                                      funcName: redraw
                                      viewTag: timeView
                                    - actionType: builtIn
                                      funcName: redraw
                                      viewTag: availabilityView
                                  options: 
                                    ..addressName
                                  style: 
                                    left: "0.25"
                                    width: "0.115"
                                    top: "0.035"
                                    height: "0.04"
                                    border: 
                                      style: "3"
                                    borderWidth: "1"
                                    borderColor: "0xdededf"
                                    borderRadius: "2"
                                    boxSizing: content-box
                                    textAlign: 
                                      y: center
                                    textIndent: "10px"
                            - type: view
                              style: 
                                marginTop: "0.035"
                                width: "0.35"
                                left: "0.02"
                                height: "0.045"
                                backgroundColor: "0x005795"
                              children: 
                                - type: label
                                  text: Office Visit
                                  dataKey: 
                                  style:
                                    left: "0.02"
                                    width: "0.3"
                                    top: "0"
                                    height: "0.045"
                                    textAlign: 
                                      y: center
                                    fontSize: "1.7vh"
                                    color: "0xffffff"
                                    border: 
                                      style: "5"
                                    borderRadius: "2"
                            - type: view
                              viewTag: timeView
                              style: 
                                marginTop: "0"
                                width: "0.35"
                                left: "0.02"
                                height: "0.33"
                                # overflow: scroll
                              children: 
                                - type: list
                                  contentType: listObject
                                  listObject: ..dayOfficeVisit
                                  iteratorVar: itemObject
                                  style:
                                    width: '0.35'
                                    left: "0"
                                    margin: '0'
                                    height: auto
                                  children:
                                    - type: listItem
                                      itemObject: ""
                                      style:
                                        width: '0.349'
                                        height: '0.045'
                                        left: '0'
                                        border: 
                                          style: "3"
                                        borderWidth: "1"
                                        borderColor: "#ccdae4"
                                        borderRadius: "2"
                                      children:
                                        - type: label
                                          dataKey: itemObject.weekDay
                                          style: 
                                            left: "0"
                                            width: "0.1"
                                            top: "0"
                                            height: "0.045"
                                            fontWeight: "500"
                                            fontSize: .Nfont.nf2
                                            backgroundColor: "0xf7f7f7"
                                            textAlign: 
                                              x: center
                                              y: center
                                        - type: label
                                          dataKey: itemObject.info
                                          style: 
                                            left: "0.1"
                                            width: "0.24"
                                            top: "0"
                                            height: "0.045"
                                            fontSize: .Nfont.nf2
                                            textAlign: 
                                              x: center
                                              y: center
            