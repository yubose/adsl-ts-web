EvaluationNotePrivate:
  title: 'Evaluation Note'
  init:
    - .SignInCheck
    # 传入已经填过的数据
    - if:
      - =.Global.formData.medicalRecords.id
      - actionType: evalObject
        object:
          - ..apiRequest.newNote.docReq@: =.Global.formData.medicalRecords
      - continue
    # 判断是否签名
    - actionType: evalObject
      object:
        - if:
          - =..apiRequest.newNote.docReq.name.data.whetherSign
          - continue
          # 非空修改显示的标识,刷新签名区域
          - actionType: evalObject
            object:
              - ..formData.temporarySignature@: =..apiRequest.newNote.docReq.name.data.signatureId
              # - ..formData.whetherSign@: =.Global.formData.medicalRecords.name.data.whetherSign
              - ..formData.flag@: "block"
              - actionType: builtIn
                funcName: redraw
                viewTag: signatureShowTag
          
    - if:
      - =.builtIn.string.equal:
          dataIn:
            string1: =..newNote.document.name.data.authority
            string2: "Private"
      - ..formData.signIsHidden@: false
      - ..formData.isEditable@: false
    - if: 
      - =..apiRequest.newNote.docReq.name.data.descriptiveList.0
      - ..formData.listDataflag@: block
      - continue
    - =.builtIn.string.concat:
        dataIn:
          - =.Global.formData.providerInfo.name.data.fullName
          - ","
          - =.Global.formData.providerInfo.name.data.title
        dataOut: EvaluationNotePrivate.apiRequest.newNote.docReq.name.data.providerInfo.fullName
  apiRequest:
    newNote:
      deleteReq: 
        id: ""
      docResp: ""
      docReq:
        eid: .Global.formData.meetingDocEid
        reid: ""
        type: .DocType.EvaluationNote 
        subtype:
          mediaType: "application/json" 
        name:
          data:
            classTag:
              name: Admin
              fontColor: "0x005795"
              backgroundColor: "0xe9f2fc"
              display: block
            statusTag:
              name: Private
              fontColor: "0x4c5264"
              backgroundColor: "0xececee"
              display: block
            treatmentPlan: ""
            signatureId: ""
            # 默认签名状态为true,没有签名
            whetherSign: "true"
            descriptiveList: []
            patientHistory: ""
            PhysicalExamination: ""
            LabAndImage: ""
            datatreatmentPlan: ""
            uploadUserName: 
            providerInfo:
              # lic: .Global.MyProfile.name.data.MedicalLicense
              npi: .Global.formData.providerInfo.name.data.NPI
              dea: .Global.formData.providerInfo.name.data.DEA
              email: .Global.formData.providerInfo.name.data.email
              phone: .Global.currentFacility.name.basicInfo.phoneNumber
              fax: 
              fullName: ""
              Medicine: .Global.currentFacility.name.basicInfo.medicalFacilityName
            patientInfo:
              fullName: .Global.formData.patientInfo.name.data.basicInfo.fullName
              dob: .Global.formData.patientInfo.name.data.basicInfo.dateOfBirth
              phoneNumber: .Global.formData.patientInfo.name.data.basicInfo.phone
              email: .Global.formData.patientInfo.name.data.contactInfo.email
          type: "application/json"
          title: "Evaluation Note"
          user: .Global.currentFacility.name.basicInfo.medicalFacilityName
      docAPI:
        .DocAPI: ""
        store:
          api: cd
          dataIn: EvaluationNotePrivate.apiRequest.newNote.docReq
          dataOut: EvaluationNotePrivate.apiRequest.newNote.docResp
        delete:
          api: dx
          dataIn: EvaluationNotePrivate.apiRequest.newNote.deleteReq
    newSign:
      docRes: ""
      document: #DOC
        type: .DocType.DocumentSignature
        name:
          title: ""
          type: ..apiRequest.newSign.document.subtype.mediaType
          data: "" 
        eid: .Global.formData.meetingDocEid
        subtype:
          mediaType: ""            
      docAPI: # DOCAPI 
        store:
          api: cd
          dataIn: apiRequest.newSign.document 
          dataOut: EvaluationNotePrivate.apiRequest.newSign.docRes 
  # 签名显示,默认为none
  formData:
    flag: "none"
    temporarySignature: ""
    whetherSign: ""
    signIsHidden: true
    isEditable: true
    providerTitle: ""
    selectedDiagnosis: ""
    listDatalength: ""
    listDataflag: "none"
    diagnosis:
      descriptiveList:
        code: ""
        description: ""
        comment: ""
  formDataTemp:
    allListInfo: []
    allListString: []
    allCodes: []
    allDescription: []
    privateTag: 
      display: "block"
      backgroundColor: "0xececee"
      fontColor: "0x4c5264"
      name: "Private"
    publicTag: 
      display: "block"
      backgroundColor: "0xdfedfc"
      fontColor: "0x2988e6"
      name: "Released"
  components: 
    - type: view
      style:
        width: '1'
        height: '1'
        margin: auto
      children:
        - .SideMenuBar:
          children:
            - .aitLogo:
            - .MenuBar:
        - .TopBar:
        - .BodyView:
          style: 
            height: "0.93"
          children:
            - .AppointmentLobby:
            - .GotoBack:
              onClick:
                - actionType: builtIn
                  funcName: goBack
                  reload: true 
            - type: view
              style:
                left: "0.008"
                width: "0.824"
                height: "0.74"
                top: "0.1"
                overflow: hidden
                backgroundColor: "0xffffff"
              children:
                - type: view
                  style:
                    width: "0.39"
                    margin: "auto"
                  children:
                    - type: scrollView
                      style: 
                        width: "0.39"
                        height: "0.74"
                        overflow: scroll
                      children:
                        - type: view
                          style:
                            marginTop: "0.02"
                            width: "0.39"
                            height: "0.1"
                          children:
                            - type: image
                              path: aitmedLogoBlack.svg
                              style:
                                top: "0"
                                width: "0.056"
                                height: "0.1"
                            - type: view
                              style:
                                marginLeft: "0.056"
                                height: "0.1"
                                width: "0.334"
                              children:
                                - type: label
                                  dataKey: apiRequest.newNote.docReq.name.data.providerInfo.fullName
                                  style:
                                    height: "0.05"
                                    width: "0.334"
                                    fontSize: .Nfont.nf5
                                    fontFamily: "Roboto"
                                    textAlign: 
                                      x: center
                                      y: center
                                - type: label
                                  dataKey: apiRequest.newNote.docReq.name.data.providerInfo.Medicine
                                  style:
                                    height: "0.05"
                                    width: "0.334"
                                    fontSize: .Nfont.nf5
                                    fontFamily: "Roboto"
                                    textAlign: 
                                      x: center
                                      y: center
                            - type: label
                              dataKey: Global.currentFacility.name.basicInfo.website
                              style:
                                fontSize: .Nfont.nf0
                                color: "0x7e7e7e" 
                                textIndent: "0.5em"                           
                        - type: view
                          style:
                            marginTop: "0.04"
                            width: "0.39"
                            height: auto
                          children:
                            - .PrescriptionListBox:
                              children: 
                                - .PrescriptionLabel:
                                  text: NPI#
                                - .PrescriptionDatakey:
                                  dataKey: apiRequest.newNote.docReq.name.data.providerInfo.npi
                            - .PrescriptionListBox:
                              children: 
                                - .PrescriptionLabel:
                                  text: "DEA #"
                                - .PrescriptionDatakey:
                                  dataKey: apiRequest.newNote.docReq.name.data.providerInfo.dea
                            - .PrescriptionListBox:
                              children: 
                                - .PrescriptionLabel:
                                  text: "Email:"
                                - .PrescriptionDatakey:
                                  dataKey: apiRequest.newNote.docReq.name.data.providerInfo.email
                            - .PrescriptionListBox:
                              children: 
                                - .PrescriptionLabel:
                                  text: "Phone:"
                                - .PrescriptionDatakey:
                                  dataKey: apiRequest.newNote.docReq.name.data.providerInfo.phone
                        - type: view 
                          style:  
                            marginTop: "0.02"
                            width: "0.39"
                            height: "0.002"
                            backgroundColor: "0x707070"                                   
                        - type: view
                          style:
                            marginTop: "0.02"
                            width: "0.39"
                            height: "0.1"
                          children:
                            - type: image
                              path: iconsForms.svg
                              style:
                                top: "0"
                                width: "0.056"
                                height: "0.1"
                            - type: label
                              text=func: .builtIn.string.formatUnixtime_en
                              dataKey: Global.roomInfo.edge.atime
                              style:
                                marginLeft: "0.056"
                                height: "0.1"
                                width: "0.334"
                                top: "0"
                                fontSize: .Nfont.nf4
                                textAlign: 
                                  x: right
                                  y: center 
                        - type: view
                          style:
                            marginTop: "0.02"
                            width: "0.39"
                            height: auto
                          children:
                            - .PrescriptionListBox:
                              children: 
                                - .PrescriptionLabel:
                                  text: "Patient Name:"
                                - .PrescriptionDatakey:
                                  dataKey: apiRequest.newNote.docReq.name.data.patientInfo.fullName
                            - .PrescriptionListBox:
                              children: 
                                - .PrescriptionLabel:
                                  text: "DOB:"
                                - .PrescriptionDatakey:
                                  dataKey: apiRequest.newNote.docReq.name.data.patientInfo.dob
                            - .PrescriptionListBox:
                              children: 
                                - .PrescriptionLabel:
                                  text: "Phone:"
                                - .PrescriptionDatakey:
                                  dataKey: apiRequest.newNote.docReq.name.data.patientInfo.phoneNumber
                            - .PrescriptionListBox:
                              children: 
                                - .PrescriptionLabel:
                                  text: "Email:"
                                - .PrescriptionDatakey:
                                  style:
                                  dataKey: apiRequest.newNote.docReq.name.data.patientInfo.email
                        - type: view 
                          style:  
                            marginTop: "0.02"
                            width: "0.39"
                            height: "0.003"
                            backgroundColor: "0x707070"                                   
                        - type: view
                          style:
                            marginTop: "0.02"
                            width: "0.39"
                            height: auto
                          children: 
                            - type: label
                              text: 'Physician Evaluation Report'
                              style:
                                width: "0.39"
                                fontFamily: "sans-serif"
                                fontSize: .Nfont.nf2
                                fontWeight: "600"
                                textAlign: 
                                  x: center
                            - type: view
                              style: 
                                marginTop: "0.01"
                                width: "0.39"
                                height: auto
                              children: 
                                - type: label
                                  text: 'HPI & Patient History'
                                  style: 
                                    width: "0.39"
                                    fontSize: .Nfont.nf4
                                    color: "0x6b6b6b"
                                    fontWeight: "600"
                                - type: textView
                                  dataKey: apiRequest.newNote.docReq.name.data.patientHistory
                                  style: 
                                    marginTop: "0.01"
                                    height: "0.15"
                                    width: '0.39'
                                    fontSize: .Nfont.nf4
                                    fontFamily: "Roboto"
                                    fontWeight: "300"
                                    boxSizing: border-box
                                    backgroundColor: "0xffffff"
                                    border:   
                                      style: "3"
                                    borderWidth: "1"
                                    borderColor: "0x6b6b6b"
                            - type: view
                              style: 
                                marginTop: "0.02"
                                width: "0.39"
                                height: auto
                              children: 
                                - type: label
                                  text: 'Physical Examination'
                                  style: 
                                    width: "0.39"
                                    fontSize: .Nfont.nf4
                                    color: "0x6b6b6b"
                                    fontWeight: "600"
                                - type: textView
                                  dataKey: apiRequest.newNote.docReq.name.data.PhysicalExamination
                                  style: 
                                    marginTop: "0.01"
                                    height: "0.15"
                                    width: '0.39'
                                    fontSize: .Nfont.nf4
                                    backgroundColor: "0xffffff"
                                    fontFamily: "Roboto"
                                    fontWeight: "300"
                                    boxSizing: border-box
                                    border:   
                                      style: "3"
                                    borderWidth: "1"
                                    borderColor: "0x6b6b6b"
                            - type: view
                              style:  
                                marginTop: "0.02"
                                width: "0.39"
                                height: auto
                              children: 
                                - type: label
                                  text: 'Lab and imaging summary'
                                  style: 
                                    width: "0.39"
                                    fontSize: .Nfont.nf4
                                    color: "0x6b6b6b"
                                    fontWeight: "600"
                                - type: textView
                                  dataKey: apiRequest.newNote.docReq.name.data.LabAndImage
                                  style:  
                                    marginTop: "0.01"
                                    height: "0.15"
                                    width: "0.39"
                                    fontSize: .Nfont.nf4
                                    backgroundColor: "0xffffff"
                                    fontFamily: "Roboto"
                                    fontWeight: "300"
                                    boxSizing: border-box
                                    border:   
                                      style: "3"
                                    borderWidth: "1"
                                    borderColor: "0x6b6b6b"
                            - type: view
                              style: 
                                marginTop: "0.02"
                                width: "0.39"
                                height: auto
                              children:
                                - type: label
                                  textBoard: 
                                    - text: "ICD10:"
                                    - br: 
                                    - text: 'lo see more descriptive list, click'
                                  style:
                                    width: "0.39"
                                    fontSize: .Nfont.nf4
                                    color: "0x6b6b6b"
                                    fontWeight: "600"
                              # 搜索框
                                - type: view
                                  viewTag: searchBox
                                  style:
                                    height: "auto"
                                    width: "0.39"
                                    overflow: hidden
                                  children:
                                    - type: view
                                      style:
                                        marginTop: "0.01"
                                        width: "0.39"
                                        height: "auto"
                                        boxSizing: border-box
                                      children:
                                        - type: view
                                          viewTag: selectDateTag
                                          style:
                                            display: "inline-block"
                                            height: "auto"
                                            width: "0.1"
                                            boxSizing: border-box
                                          children:
                                            - type: image
                                              path: searchBlue.svg
                                              style:
                                                top: "0.01"
                                                left: "0.08"
                                                height: "0.02"
                                                zIndex: 10
                                            - type: textField
                                              viewTag: CodeListTag
                                              placeholder: Search
                                              dataKey: formData.diagnosis.descriptiveList.code
                                              style:
                                                height: "0.04"
                                                width: "0.1"
                                                boxSizing: border-box
                                                border:
                                                  style: 3
                                                borderRadius: "3"
                                                borderWidth: "1"
                                                borderColor: "0xd4d4d4"
                                              onInput:
                                                - actionType: evalObject
                                                  object:
                                                    - ..formDataTemp.allListInfo@: []
                                                    - ..formDataTemp.allListString@: []
                                                - actionType: evalObject
                                                  object:
                                                    - =.builtIn.search.queryCode:
                                                        dataIn:
                                                          query: =..formData.diagnosis.descriptiveList.code
                                                        dataOut: EvaluationNotePrivate.formDataTemp.allListInfo
                                                    - ..formDataTemp.allListString@: =..formDataTemp.allListInfo
                                                - actionType: builtIn
                                                  funcName: redraw
                                                  viewTag: CodeTag
                                                - actionType: builtIn
                                                  funcName: redraw
                                                  viewTag: CodeTags
                                                - actionType: builtIn
                                                  funcName: show
                                                  viewTag: CodeTag
                                                - actionType: builtIn
                                                  funcName: hide
                                                  viewTag: listData
                                                - actionType: builtIn
                                                  funcName: show
                                                  viewTag: ShowTag
                                                - actionType: popUp
                                                  popUpView: CodeTag
                                                  dismissOnTouchOutside: true
                                        - type: textField
                                          viewTag: descriptionTag
                                          placeholder: Description
                                          dataKey: formData.diagnosis.descriptiveList.description
                                          style:
                                            marginLeft: "0.02"
                                            display: "inline-block"
                                            height: "0.04"
                                            width: "0.27"
                                            boxSizing: border-box
                                            border:
                                              style: 3
                                            borderRadius: "3"
                                            borderWidth: "1"
                                            borderColor: "0xd4d4d4"
                                    - .ProNoteInitTextView:
                                      viewTag: CommentsTag
                                      placeholder: Comments
                                      isEditable: true
                                      dataKey: formData.diagnosis.descriptiveList.comment
                                     

                                - type: view
                                  style:
                                    marginTop: "0.01"
                                    height: "0.02"
                                  children:
                                    - type: label
                                      text: + add more
                                      style:
                                        marginTop: "0"
                                        fontFamily: "Arial"
                                        fontSize: "1.5vh"
                                        color: "0x1492e6"
                                        height: "0.02"
                                        width: "0.39"
                                        textAlign:
                                          x: right
                                        fontWeight: "550"
                                      onClick:
                                        - emit:
                                            actions:
                                              - =.builtIn.array.add:
                                                  dataIn:
                                                    object: =..apiRequest.newNote.docReq.name.data.descriptiveList
                                                    value: =..formData.diagnosis.descriptiveList # create copy .create by value ,not reference
                                        - actionType: evalObject
                                          object:
                                            - ..formData.diagnosis.descriptiveList.code@: ""
                                            - ..formData.diagnosis.descriptiveList.description@: ""
                                            - ..formData.diagnosis.descriptiveList.comment@: ""
                                        - actionType: builtIn
                                          funcName: redraw
                                          viewTag: listData
                                        - actionType: builtIn
                                          funcName: redraw
                                          viewTag: CodeListTag
                                        - actionType: builtIn
                                          funcName: redraw
                                          viewTag: descriptionTag
                                        - actionType: builtIn
                                          funcName: hide
                                          viewTag: ShowTag
                                        - actionType: builtIn
                                          funcName: show
                                          viewTag: listData
                                        - actionType: builtIn
                                          funcName: redraw
                                          viewTag: CommentsTag

                                # debug
                                - type: view
                                  style:
                                    marginTop: "0.01"
                                    height: "auto"
                                    width: "0.39"
                                  children:
                                    - type: view
                                      viewTag: CodeTag
                                      style:
                                        display: "none"
                                        width: "0.39"
                                        height: "auto"
                                        fontFamily: "Poppins"
                                        border:
                                          style: 3
                                          color: "0xeeeeee"
                                        borderWidth: "1"
                                        zIndex: 10
                                        boxSizing: border-box
                                      children:
                                        - type: scrollView
                                          viewTag: ShowTag
                                          style:
                                            height: "0.3"
                                            left: "0.02"
                                            overflow: scroll
                                          children:
                                            - type: list
                                              contentType: listObject
                                              listObject: ..formDataTemp.allListString
                                              iteratorVar: itemObject
                                              viewTag: CodeTags
                                              style:
                                                width: "0.39"
                                                height: "auto"
                                                margin: "0"
                                                marginTop: "0"
                                              children:
                                                - type: listItem
                                                  itemObject: ""
                                                  style:
                                                    width: "0.39"
                                                    marginTop: "0.002"
                                                    height: "auto"
                                                  children:
                                                    - type: label
                                                      dataKey: itemObject.0.2
                                                      style:
                                                        width: "0.39"
                                                        left: "0"
                                                        textIndent: 20px
                                                        marginTop: "0"
                                                        textAlign:
                                                          x: left
                                                          y: center
                                                        height: "auto"
                                                        fontSize: "1.7vh"
                                                        color: "0x143459"
                                                      onClick:
                                                        - emit:
                                                            dataKey:
                                                              var: itemObject
                                                            actions:
                                                              - ..formData.diagnosis.descriptiveList.code@: $var.0.0
                                                              - ..formData.diagnosis.descriptiveList.description@: $var.0.1
                                                        - actionType: builtIn
                                                          funcName: redraw
                                                          viewTag: CodeListTag
                                                        - actionType: builtIn
                                                          funcName: redraw
                                                          viewTag: descriptionTag
                                                        - actionType: builtIn
                                                          funcName: hide
                                                          viewTag: ShowTag
                                                        - actionType: builtIn
                                                          funcName: show
                                                          viewTag: listData
                                                        - actionType: builtIn
                                                          funcName: hide
                                                          viewTag: CodeTag

                                    - type: view
                                      viewTag: listData
                                      style:
                                        width: "0.39"
                                        left: "0"
                                        height: "auto"
                                        marginTop: "0.01"
                                        display: ..formData.listDataflag
                                      children:
                                        - type: view
                                          style:
                                            marginTop: "0.01"
                                            height: "0.002"
                                            width: "0.39"
                                            backgroundColor: "0xd8d8d8"
                                        - type: list
                                          viewTag: listData
                                          contentType: listObject
                                          listObject: ..apiRequest.newNote.docReq.name.data.descriptiveList # to dataObject to enumerate the list
                                          iteratorVar: itemObject
                                          style:
                                            left: "0"
                                            width: "0.39"
                                            marginTop: "0.03"
                                            height: "auto"
                                            margin: "0"
                                          children:
                                            - type: listItem
                                              itemObject: ""
                                              style:
                                                marginTop: "0.01"
                                                width: "0.39"
                                                height: "auto"
                                                left: "0"
                                                overflow: hidden
                                              children:
                                                - type: view
                                                  style:
                                                    width: "0.39"
                                                    height: "auto"
                                                  children:
                                                    - type: image
                                                      path: deletePhoto.svg
                                                      style:
                                                        display: "inline-block"
                                                        height: "0.025"
                                                        zIndex: 10
                                                        verticalAlign: middle
                                                      onClick:
                                                        - actionType: popUp
                                                          popUpView: BaseDelWarningView
                                                        - actionType: updateObject
                                                          dataKey: formData.selectedDiagnosis
                                                          dataObject: itemObject
                                                    - type: label
                                                      dataKey: itemObject.code
                                                      style:
                                                        display: "inline-block"
                                                        marginLeft: "0.02"
                                                        height: "auto"
                                                        width: "0.1"
                                                        textAlign:
                                                          x: left
                                                        fontFamily: "Arial"
                                                        backgroundColor: "0xffffff"
                                                        wordBreak: break-all
                                                        fontSize: .Nfont.h1
                                                        fontWeight: "550"
                                                        verticalAlign: middle
                                                    - type: label
                                                      text: "-"
                                                      style:
                                                        verticalAlign: middle
                                                        display: "inline-block"
                                                        width: "auto"
                                                        height: "auto"
                                                        fontSize: .Nfont.h2
                                                    - type: label
                                                      dataKey: itemObject.description
                                                      style:
                                                        verticalAlign: middle
                                                        marginLeft: "0.02"
                                                        display: "inline-block"
                                                        height: "auto"
                                                        width: "0.2"
                                                        textAlign:
                                                          x: left
                                                        backgroundColor: "0xffffff"
                                                        fontFamily: "Arial"
                                                        wordBreak: break-all
                                                        fontSize: .Nfont.h1
                                                - type: label
                                                  dataKey: itemObject.comment
                                                  style:
                                                    marginTop: "0.002"
                                                    marginLeft: "0.035"
                                                    width: "0.34"
                                                    height: "auto"
                                                    color: "0x666666"
                                                    fontFamily: "Arial"
                                                    wordBreak: break-all
                                                    fontSize: .Nfont.h1
                    
                            - type: view
                              style: 
                                marginTop: "0.02"
                                width: "0.39"
                                height: auto
                              children: 
                                - type: label
                                  text: 'Assessment & Treatment Plan'
                                  style: 
                                    width: "0.39"
                                    fontSize: .Nfont.nf4
                                    color: "0x6b6b6b"
                                    fontWeight: "600"
                                - type: textView
                                  dataKey: apiRequest.newNote.docReq.name.data.datatreatmentPlan
                                  style: 
                                    marginTop: "0.01"
                                    height: "0.15"
                                    width: '0.39'
                                    fontSize: .Nfont.nf4
                                    backgroundColor: "0xffffff"
                                    fontFamily: "Roboto"
                                    fontWeight: "300"
                                    boxSizing: border-box
                                    border:   
                                      style: "3"
                                    borderWidth: "1"
                                    borderColor: "0x6b6b6b"
                        - type: view 
                          style:  
                            marginTop: "0.02"
                            width: "0.39"
                            height: "0.002"
                            backgroundColor: "0x707070"
                        - type: view
                          style:
                            marginTop: "0.02"
                            width: "0.39"
                            height: auto
                          children:
                            - .PrescriptionLabel:
                              text: "Signature:"
                              style:
                                width: "0.39"
                        - type: view
                          style:
                            marginTop: "0.01"
                            width: "0.39"
                            display: flex
                            flexDirection: column
                            flexWrap: wrap
                            alignContent: space-around
                            justifyContent: center
                          children:
                            - type: view
                              style:
                                marginLeft: "0"
                                width: "0.39"
                              children:
                                - type: label
                                  text: "Clear"
                                  style:
                                    color: "0xe24445"
                                    marginTop: "0.01"
                                    display: "inline-block"
                                    marginLeft: "0.33"
                                  onClick: 
                                  # 移除签名
                                    - actionType: removeSignature
                                      dataObject: BLOB
                                      dataKey: apiRequest.newSign.document.name.data   
                                      viewTag: signatureTag   
                                    - actionType: evalObject
                                      object:
                                        - ..formData.temporarySignature@: ""
                                        - ..apiRequest.newNote.docReq.name.data.signatureId@: ""
                                        - ..apiRequest.newNote.docReq.name.data.whetherSign@: true
                                    - actionType: builtIn
                                      funcName: hide
                                      viewTag: signatureShowTag
                                    - actionType: builtIn
                                      funcName: show
                                      viewTag: signatureTag
                            - .SignAreaView:
                              style:
                                marginLeft: "0.03"
                              children:             
                                - type: canvas
                                  viewTag: signatureTag  
                                  dataKey: apiRequest.newSign.document.name.data 
                                  style:
                                    .SignCanvasStyle:
                                - type: label
                                  text: "X"
                                  style:
                                    .SignLabelStyle:   
                                # 显示暂存的签名
                                - type: image
                                  viewTag: signatureShowTag
                                  path=func: =.builtIn.utils.prepareDocToPath
                                  # 传入签名文档的id
                                  dataKey: formData.temporarySignature
                                  style:
                                    # 控制显示
                                    display: ..formData.flag
                                    .SignCanvasStyle:

            - .FormsBottomView: 
              children:
                - .FormsBottomButtons:
                  children:
                    - .FormsBottomLeftButton:
                      onClick:
                        - actionType: saveSignature
                          dataObject: BLOB
                          dataKey: apiRequest.newSign.document.name.data
                          isEmpty: formData.whetherSign 
                        # 签名处理
                        - actionType: evalObject
                          object:
                            - if:
                              - =..formData.temporarySignature
                              - actionType: evalObject
                                object:
                                  - ..apiRequest.newNote.docReq.name.data.signatureId@: =..formData.temporarySignature
                                  - ..apiRequest.newNote.docReq.name.data.whetherSign@: false
                                  - ..formData.whetherSign@: false
                              - actionType: evalObject
                                object:
                                  - if:
                                    - =..formData.whetherSign
                                    - continue
                                    - actionType: evalObject
                                      object:
                                        - =..apiRequest.newSign.docAPI.store: "" 
                                        - ..apiRequest.newSign.document.reid@: =..apiRequest.newNote.docResp.doc.id
                                        - ..apiRequest.newNote.docReq.name.data.signatureId@: =..apiRequest.newSign.docRes.doc.id
                                        - ..apiRequest.newNote.docReq.name.data.whetherSign@: =..formData.whetherSign
                        - actionType: evalObject
                          object:
                            - ..apiRequest.newNote.docReq.reid@: =.Global.formData.meetingDocReid
                        - actionType: evalObject
                          object:
                            - =.builtIn.number.inhx:
                                dataIn:
                                  intHex: =..apiRequest.newNote.docReq.type
                                  index: 1
                                  hex: 0
                                dataOut: EvaluationNotePrivate.apiRequest.newNote.docReq.type
                          
                        - actionType: evalObject
                          object:
                            - ..apiRequest.newNote.docReq.name.data.statusTag@: =..formDataTemp.privateTag                         
                            - =..apiRequest.newNote.docAPI.store: ""    
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: ""   
                        - actionType: builtIn
                          funcName: goBack
                          reload: true 
                    # release button
                    - .FormsBottomRightButton: 
                      onClick:
                        - actionType: saveSignature
                          dataObject: BLOB
                          dataKey: apiRequest.newSign.document.name.data
                          isEmpty: formData.whetherSign 
                        - actionType: evalObject
                          object:
                            - if:
                              - =..formData.temporarySignature
                            # 签了
                              - actionType: evalObject
                                object:
                                  - ..apiRequest.newNote.docReq.name.data.signatureId@: =..formData.temporarySignature
                                  - ..apiRequest.newNote.docReq.name.data.whetherSign@: false
                                  - ..formData.whetherSign@: false
                              - actionType: evalObject
                                object:
                                  - if:
                                    - =..formData.whetherSign
                                    - actionType: popUp
                                      popUpView: signatureWarningTag
                                      wait: true
                                    - actionType: evalObject
                                      object:
                                        - ..apiRequest.newSign.document.reid@: =..apiRequest.newNote.docResp.doc.id                                        
                                        - =..apiRequest.newSign.docAPI.store: ""
                                        - ..apiRequest.newNote.docReq.name.data.signatureId@: =..apiRequest.newSign.docRes.doc.id
                                        - ..apiRequest.newNote.docReq.name.data.signatureTime@: =..apiRequest.newSign.docRes.doc.ctime
        
                        - actionType: evalObject
                          object:
                            - ..apiRequest.newNote.docReq.reid@: =.Global.formData.meetingDocReid
                        - actionType: evalObject
                          object:
                            - ..apiRequest.newNote.docReq.name.data.whetherSign@: =..formData.whetherSign 
                            - ..apiRequest.newNote.docReq.name.data.statusTag@: =..formDataTemp.publicTag       
                            - =..apiRequest.newNote.docAPI.store: ""
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: ""  
                        - actionType: builtIn
                          funcName: goBack
                          reload: true 
        - .BaseWarningView:
          msg2: "You haven't signed the form."
          viewTag: signatureWarningTag
        - .DeleteWarningPopUp:
          msg: Are you sure you want to delete it ?
          viewTag: BaseDelWarningView
          .BackgroundPopUp: 
          children:
            - .BackgroundWhite:
              children: 
                - .WarningRedLine:
                - type: view
                  style:
                    marginTop: "0"
                    width: "0.28"
                    left: "0"
                    height: "0.267"
                  children: 
                    - .DeleteWarningImg:
                    - .WarningLabel:
                    - .DeleteWarningLabel:  
                - .CancelButton: 
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: BaseDelWarningView
                - .DeleteButton: 
                  onClick:
                    - actionType: evalObject
                      object:
                        - =.builtIn.array.removeByName:
                            dataIn:
                              object: =..apiRequest.newNote.docReq.name.data.descriptiveList
                              key: code
                              name: =..formData.selectedDiagnosis.code
                        - ..formData.listDataflag@: "block"
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: listData
                    - actionType: popUpDismiss
                      popUpView: BaseDelWarningView