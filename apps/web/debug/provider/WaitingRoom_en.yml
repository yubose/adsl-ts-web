WaitingRoom:
  title: "Waiting Room"
  pageNumber: "90"
  init:
    - .SignInCheck
    - actionType: updateObject
      dataKey: Global.formData.entrancePageName
      dataObject: ""
    - actionType: updateObject
      dataKey: Global.formData.patientChart
      dataObject: ""
    - actionType: updateObject
      dataKey: Global.formData.goodNameList
      dataObject: ""
    - actionType: updateObject
      dataKey: Global.formData.production
      dataObject: ""
    - actionType: updateObject
      dataKey: Global.formData.productionSelectionList
      dataObject: []
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - actionType: evalObject
      object:
        - =.builtIn.date.getMonth:
            dataIn: ""
            dataOut: WaitingRoom.calendarDate.month
    - actionType: evalObject
      object:
        - =.builtIn.date.getYear:
            dataIn: ""
            dataOut: WaitingRoom.calendarDate.year
    - actionType: evalObject
      object:
        - =.builtIn.date.getDate:
            dataIn: ""
            dataOut: WaitingRoom.calendarDate.day
    - actionType: evalObject
      object:
        - =.builtIn.string.concat:
            dataIn:
              - =.WaitingRoom.calendarDate.year
              - "-"
              - =.WaitingRoom.calendarDate.month
              - "-"
              - =.WaitingRoom.calendarDate.day
            dataOut: WaitingRoom.calendarDate.todayDate
    - actionType: evalObject
      object:
        - =.builtIn.date.getTimeStampOfDate:
            dataIn:
              date: =.WaitingRoom.calendarDate.todayDate
            dataOut: WaitingRoom.calendarDate.todayStamp
    - actionType: evalObject
      object:
        - actionType: evalObject
          async: true
          object:
            - =..apiRequest.waitingRoom_me.edgeAPI.get: ""
            - =..apiRequest.waitingRoom_participants.edgeAPI.get: ""
            - =..apiRequest.relatedRoom_me.edgeAPI.get: ""
    - =.builtIn.array.concatArray:
        dataIn:
          array1: =.WaitingRoom.apiRequest.waitingRoom_participants.edgeQueryResp.edge
          array2: =.WaitingRoom.apiRequest.relatedRoom_me.edgeQueryResp.edge
          sortby: stime
          orders: desc
        dataOut: WaitingRoom.formData.nonShceduledList
    - =.builtIn.array.getOrReplaceAnArrayItem:
        dataIn:
          strArr: =.Global.formData.currentTabStatusList
          tag: false
        dataOut: WaitingRoom.formData.currentTab
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =.Global.formData.currentTabStatusList
              len: 0
        - continue
        - actionType: evalObject
          object:
            - =.builtIn.object.setProperty:
                dataIn:
                  obj: =..formDataTemp.titleData
                  label: "title"
                  text: =..formData.currentTab
                  arr: ["fontColor", "fontWeight", "block"]
                  valueArr: ["0x2988e6", "600", "block"]
                  errorArr: ["0x666666", "400", "none"]
                dataOut: WaitingRoom.formDataTemp.titleData
            - ..formData.meBlock@: =..formDataTemp.titleData.0.block
            - ..formData.articipantBlock@: =..formDataTemp.titleData.1.block
  formData:
    nonShceduledList: []
    currentTab: ""
    meBlock: block
    articipantBlock: none
  formDataTemp:
    titleData:
      - title: Scheduled
        fontColor: "0x2988e6"
        fontWeight: "500"
        block: "block"
      - title: Nonscheduled
        fontColor: "#333333"
        fontWeight: "400"
        block: "none"
  calendarDate:
    year: ""
    month: ""
    day: ""
    todayDate: ""
    todayStamp: ""
  apiRequest:
    relatedRoom_me:
      edgeQueryResp: 
        edge: ""
      edgeQueryReq:
        id: .Global.currentUser.vertex.id
        xfname: bvid
        type: .EdgeType.WaitingRoom
        _nonce: .Global._nonce
        sCondition: .Global.querySconditionForRelatedRoomInNonScheduled
      edgeAPI:
        get:
          api: re
          dataIn: WaitingRoom.apiRequest.relatedRoom_me.edgeQueryReq
          dataOut: WaitingRoom.apiRequest.relatedRoom_me.edgeQueryResp
    waitingRoom_me:
      edgeQueryResp: ""
      edgeQueryReq:
        ObjType: 20
        id: .Global.ids
        xfname: E2.evid,E2.Bvid
        type: .EdgeType.WaitingRoom
        sCondition: .Global.queryScondition
        maxcount: "20000"
        obfname: "stime"
        _nonce: .Global._nonce
      edgeAPI:
        get:
          api: re
          dataIn: WaitingRoom.apiRequest.waitingRoom_me.edgeQueryReq
          dataOut: WaitingRoom.apiRequest.waitingRoom_me.edgeQueryResp
    waitingRoom_participants:
      edgeQueryResp:
        edge: []
      edgeQueryReq:
        ObjType: 4
        id: .Global.currentUser.vertex.id
        xfname: E.evid
        maxcount: "20000"
        obfname: stime
        sCondition: .Global.queryScondition_participants
        _nonce: .Global._nonce
      edgeAPI:
        get:
          api: re
          dataIn: WaitingRoom.apiRequest.waitingRoom_participants.edgeQueryReq
          dataOut: WaitingRoom.apiRequest.waitingRoom_participants.edgeQueryResp
    listRoomData:
      response:
        edge: []
      edge:
        .EdgeAPI.get: ""
        ObjType: "4"
        id:
          - .Global.currentUser.vertex.id
          - .Global.currentFacility.id
        xfname: "E.evid,E.bvid"
        sCondition: "=.Global.getRoomScondition"
        maxcount: "100"
        obfname: "stime"
        asc: true
        _nonce: =.Global._nonce
      get:
        .EdgeAPI.get: ""
        api: re
        dataIn: apiRequest.listRoomData.edge
        dataOut: apiRequest.listRoomData.response
  components:
    - .BasePublicHeader:
      children:
        - .BasePublicHeaderLeft:
        - .BasePublicHeaderTitle:
        - .BasePublicHeaderRightText:
          text: History
          style:
            width: "0.14"
          onClick:
            - goto: AppointmentHistory

    - type: list
      viewTag: tabTag
      contentType: listObject
      listObject: ..formDataTemp.titleData
      iteratorVar: itemObject
      style:
        ..style.tabList:
      children:
        - type: listItem
          itemObject:
          style:
            ..style.tabListItem:
          children:
            - type: label
              dataKey: itemObject.title
              style:
                ..style.title:
            - type: view
              style:
                ..style.line:
            - type: view
              viewTag: leftBlockTag
              style:
                ..style.tabBar:
          onClick:
            - ..event.tabChange
    - type: scrollView
      style:
        ..style.scrollBox:
      children:
        - type: view
          viewTag: AllTag
          style:
            ..style.viewBox:
            display: ..formData.meBlock
          children:
            # All
            - type: list
              viewTag: AllTag
              contentType: listObject
              listObject: ..apiRequest.waitingRoom_me.edgeQueryResp.edge
              iteratorVar: itemObject
              style:
                ..style.dataList:
              children:
                - type: listItem
                  itemObject:
                  onClick:
                    - actionType: evalObject
                      object:
                        - .Global.status.isParticipant@: false
                    - ..event.waitingItem
                  style:
                    ..style.listItem:
                  children:
                    - type: view
                      style:
                        ..style.firstBox:
                      children:
                        - type: view
                          style:
                            ..style.timeBox:
                          children:
                            - type: image
                              path: waitTime.svg
                              style:
                                ..style.waitTimeImg:
                            - type: label
                              text=func: .builtIn.date.ShowTimeSpan
                              dataKey: itemObject
                              style:
                                ..style.ShowTimeSpan:
                            - type: label
                              text=func: .builtIn.string.formatUnixtimeL_en
                              dataKey: itemObject.stime
                              style:
                                ..style.stime:
                            - type: image
                              style:
                                ..style.statusImg:
                              path:
                                ..event.statusPath:
                    - type: view
                      style:
                        ..style.seocndLine:
                    - type: view
                      style:
                        ..style.secondBox:
                      children:
                        - type: view
                          style:
                            ..style.secondTop:
                          children:
                            - type: label
                              dataKey: itemObject.name.Reason
                              style:
                                ..style.reasonBox:
                            - type: label
                              dataKey: itemObject.name.patientName
                              style:
                                ..style.infoLabel:
                        - type: image
                          path: appLeft.svg
                          style:
                            ..style.leftImg:
                    - type: view
                      style:
                        marginTop: "0"
                      children:
                        - type: label
                          style:
                            width: "auto"
                            height: "0.015"
            - type: view
              style:
                marginTop: "0.02"
        - type: view
          viewTag: AllTag
          style:
            ..style.viewBox:
            display: ..formData.articipantBlock
          children:
            # Participant
            - type: list
              viewTag: AllTag
              contentType: listObject
              listObject: ..formData.nonShceduledList
              iteratorVar: itemObject
              style:
                ..style.dataList:
              children:
                - type: listItem
                  itemObject:
                  onClick:
                    - actionType: evalObject
                      object:
                        - .Global.status.isParticipant@: true
                    - ..event.waitingItem
                  style:
                    ..style.listItem:
                  children:
                    - type: view
                      style:
                        ..style.firstBox:
                      children:
                        - type: view
                          style:
                            ..style.timeBox:
                          children:
                            - type: image
                              path: waitTime.svg
                              style:
                                ..style.waitTimeImg:
                            - type: label
                              text=func: .builtIn.date.ShowTimeSpan
                              dataKey: itemObject
                              style:
                                ..style.ShowTimeSpan:
                            - type: label
                              text=func: .builtIn.string.formatUnixtimeL_en
                              dataKey: itemObject.stime
                              style:
                                ..style.stime:
                            - type: image
                              style:
                                ..style.statusImg:
                              path:
                                ..event.statusPath:
                    - type: view
                      style:
                        ..style.seocndLine:
                    - type: view
                      style:
                        ..style.secondBox:
                      children:
                        - type: view
                          style:
                            ..style.secondTop:
                          children:
                            - type: label
                              dataKey: itemObject.name.Reason
                              style:
                                ..style.reasonBox:
                            - type: label
                              dataKey: itemObject.name.patientName
                              style:
                                ..style.infoLabel:
                        - type: image
                          path: appLeft.svg
                          style:
                            ..style.leftImg:
                    - type: view
                      style:
                        marginTop: "0"
                      children:
                        - type: label
                          style:
                            width: "auto"
                            height: "0.015"
            - type: view
              style:
                marginTop: "0.02"
  event:
    tabChange:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - ..formData.tempData@: $var.title
            - =.builtIn.object.setProperty:
                dataIn:
                  obj: =..formDataTemp.titleData
                  label: "title"
                  text: $var.title
                  arr: ["fontColor", "fontWeight", "block"]
                  valueArr: ["0x2988e6", "500", "block"]
                  errorArr: ["#333333", "400", "none"]
            - ..formData.meBlock@: =..formDataTemp.titleData.0.block
            - ..formData.articipantBlock@: =..formDataTemp.titleData.1.block
            # 保存当前tab栏状态
            - =.builtIn.array.getOrReplaceAnArrayItem:
                dataIn:
                  strArr: =.Global.formData.currentTabStatusList
                  tag: true
                  index: 0
                  value: $var.title
                dataOut: Global.formData.currentTabStatusList
      - actionType: builtIn
        funcName: redraw
        viewTag: AllTag
      - actionType: builtIn
        funcName: redraw
        viewTag: ParticipantTag
      - actionType: builtIn
        funcName: redraw
        viewTag: tabTag
    statusPath:
      emit:
        dataKey:
          var: itemObject
        actions:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: $var.name.visitType
                    string2: Telemedicine
              - video.svg
              - videoTele.svg
    waitingItem:
      - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
        dataKey: Global.roomInfo.edge
        dataObject: itemObject
      - actionType: updateObject
        dataKey: Global.currentMeetingDoc
        dataObject: []
      - emit:
          dataKey:
            var: itemObject
          actions:
            - if:
                - =.builtIn.number.typeIsValid:
                    dataIn:
                      docType: $var.subtype
                      localArr: [17]
                      binaryArr: [1]
                - goto: AppointmentLobby
                - goto: AppointmentLobbyOfficeVisit
  style:
    tabList:
      width: "1"
      margin: "0"
      axis: horizontal
      height: "auto"
      overflow: hidden
      marginTop: "0.02"
    tabListItem:
      width: "0.5"
      height: "auto"
      boxSizing: border-box
    title:
      color: itemObject.fontColor
      height: "auto"
      width: "0.5"
      fontWeight: itemObject.fontWeight
      textAlign:
        x: center
      fontSize: .Nfont.h16
    line:
      marginTop: "0.005"
      height: "0.0025" #2.03px
      width: "0.5"
      backgroundColor: "0xdededf"
    tabBar:
      display: itemObject.block
      top: "0.031"
      left: "0.21"
      width: "0.08"
      height: "0.0025"
      backgroundColor: "0x2988e6"
      zIndex: 10
    scrollBox:
      width: "1"
      height: "0.89"
      paddingBottom: "0.03"
      boxSizing: border-box
    viewBox:
      width: "1"
      height: "auto"
      boxSizing: border-box
    dataList:
      width: "1"
      margin: "0"
      height: "auto"
    listItem:
      marginTop: "0.015"
      width: "0.9"
      height: "auto"
      left: "0.05"
      boxShadow: "0px 0px 5px #80808044"
      backgroundColor: "0xffffff"
      border:
        style: 3
      borderColor: "#dededf"
      borderWidth: "1.5"
      borderRadius: "5"
    firstBox:
      width: "0.85"
      height: "0.04"
      left: "0.025"
    timeBox:
      display: "inline-block"
      height: "0.04"
      width: "0.85"
    waitTimeImg:
      height: "0.017"
      display: "inline-block"
      verticalAlign: middle
    ShowTimeSpan:
      marginLeft: "0.025"
      display: "inline-block"
      fontSize: .Nfont.h12
      fontWeight: "700"
      color: "#333333"
      width: "0.35"
      height: "0.04"
      lineHeight: "4vh"
      verticalAlign: middle
      textAlign:
        x: left
    stime:
      display: "inline-block"
      fontSize: .Nfont.h12
      color: "#333333"
      width: "0.24"
      lineHeight: "4vh"
      verticalAlign: middle
      textAlign:
        x: center

    statusImg:
      marginLeft: "0.144"
      display: "inline-block"
      height: "0.016"
      verticalAlign: middle
    seocndLine:
      width: "0.85"
      height: "0.001"
      left: "0.025"
      backgroundColor: "0xf0f0f0"
    secondBox:
      marginTop: "0.01"
      width: "0.9"
      height: "auto"
    secondTop:
      width: "0.8"
      height: "auto"
      left: "0.025"
    reasonBox:
      fontSize: .Nfont.h16
      fontWeight: "700"
      color: "#333333"
      height: "auto"
      width: "auto"
    infoLabel:
      marginTop: "0.01"
      fontSize: .Nfont.h12
      color: "#333333"
      height: "auto"
      width: "0.8"
      overflow: hidden
      whiteSpace: nowrap
      text-overflow: ellipsis
    leftImg:
      top: "0"
      left: "0.8"
      height: "0.06"
