# AbsentNotePrivate:

AbsentNotePrivate:
  title: Absence / Excuse Note
  # pageNumber: "184"
  init:
    - .SignInCheck
    - =.builtIn.date.currentDateTime:
        dataIn:
        dataOut: Global.formData.auditLog.startTime
    - if:
        - =.Global.Note.id
        - actionType: evalObject
          object:
            - ..apiRequest.absentNote.docReq@: =.Global.Note
        - continue
    - actionType: evalObject #android use calendar init
      object:
        - .BaseComponents.calendarDate.year@: ""
        - .BaseComponents.calendarDate.month@: ""
        - .BaseComponents.calendarDate.day@: ""
        - .BaseComponents.calendarDate.monthName@: ""
        - .BaseComponents.calendarDate.todayDate@: ""
        - .BaseComponents.calendarDate.flag@: ""
        - .BaseComponents.calendarDate.dayLable@: []
        - .BaseComponents.year@: []
        - .BaseComponents.flag: ""
        #生成年份
        - =.builtIn.date.generateYear:
            dataIn:
              last: 121
              next: 10
            dataOut: BaseComponents.year
    - actionType: evalObject #android use calendar init
      object: .BaseComponents.getDate
    - actionType: evalObject #android use calendar init
      object: .BaseComponents.getShow
    - actionType: evalObject
      object:
        - ..calendarDate@: =.BaseComponents.calendarDate
    - actionType: evalObject #IOS use calendar init
      object:
        - =.builtIn.date.getMonth:
            dataIn:
            dataOut: AbsentNotePrivate.calendarDate.month
        - =.builtIn.date.getYear:
            dataIn:
            dataOut: AbsentNotePrivate.calendarDate.year
        - =.builtIn.date.getDate:
            dataIn:
            dataOut: AbsentNotePrivate.calendarDate.day
    - actionType: evalObject #IOS use calendar init
      object:
        - =.builtIn.date.calendarArray:
            dataIn:
              year: =.AbsentNotePrivate.calendarDate.year
              month: =.AbsentNotePrivate.calendarDate.month
              today: =.AbsentNotePrivate.calendarDate.day
            dataOut: AbsentNotePrivate.calendarDate.dayLable
        - =.builtIn.date.transformMonth:
            dataIn:
              month: =.AbsentNotePrivate.calendarDate.month
            dataOut: AbsentNotePrivate.calendarDate.monthName
        - =.builtIn.date.ShowDateByNumber:
            dataIn:
              year: =.AbsentNotePrivate.calendarDate.year
              month: =.AbsentNotePrivate.calendarDate.month
              day: =.AbsentNotePrivate.calendarDate.day
              formatType: "M/D/Y"
            dataOut: AbsentNotePrivate.calendarDate.todayDate

    # 判断是否签名
    - if:
        - =..apiRequest.absentNote.docReq.name.data.whetherSign
        - continue
        # 非空修改显示的标识,刷新签名区域
        - actionType: evalObject
          object:
            # 签名的时间
            - ..formData.signatureTime@: =.AbsentNotePrivate.apiRequest.absentNote.docReq.name.data.signatureTime
            # 签名的id
            - ..formData.temporarySignature@: =.AbsentNotePrivate.apiRequest.absentNote.docReq.name.data.signatureId
            - ..formData.flag@: "block"

  calendarDate:
    year: ""
    month: ""
    day: ""
    dayLable: []
    todayDate: ""
    monthName: ""
  apiRequest:
    absentNote:
      docResp: ""
      docReq:
        eid: .Global.currentRoom.edge.id
        reid: ""
        type: .DocType.AbsentNote
        subtype:
          mediaType: "application/json"
        name:
          data:
            classTag:
              name: Provider
              fontColor: "0x30b354"
              backgroundColor: "0xe4f5e9"
              display: block
            statusTag:
              name: Private
              fontColor: "0x4c5264"
              backgroundColor: "0xececee"
              display: block
            signatureId: ""
            signatureTime: ""
            whetherSign: "true"
            name: ""
            place: ""
            reason: ""
            note: ""
            date: ""
            uploadUserName: .Global.MyProfile.name.data.fullName
            facilityInfo: ""
            providerInfo: ""
          title: "Absence / Excuse Note"
          user: .Global.formData.providerTitle
      docAPI:
        .DocAPI: ""
        store:
          api: cd
          dataIn: AbsentNotePrivate.apiRequest.absentNote.docReq
          dataOut: AbsentNotePrivate.apiRequest.absentNote.docResp
    newSign:
      docRes: ""
      docReq: #DOC
        type: .DocType.DocumentSignature
        name:
          title: ""
          type: ..apiRequest.newSign.docReq.subtype.mediaType
          data: ""
        eid: .Global.rootNotebookID
        subtype:
          mediaType: ""
      docAPI: # DOCAPI
        store:
          api: cd
          dataIn: apiRequest.newSign.docReq
          dataOut: AbsentNotePrivate.apiRequest.newSign.docRes

  formData:
    flag: "none"
    temporarySignature: ""
    whetherSign: ""

  formDataTemp:
    place:
      - key: place
        value: school
      - key: place
        value: work
      - key: place
        value: other
    reason:
      - key: reason
        value: injury
      - key: reason
        value: illness
      - key: reason
        value: other

  components:
    - .BasePublicHeader:
      children:
        - .BasePublicHeaderLeft:
        - .BasePublicHeaderTitle:
        - .BasePublicHeaderRightText:
          onClick:
            # 签名处理
            - actionType: saveSignature
              dataObject: BLOB
              dataKey: AbsentNotePrivate.apiRequest.newSign.docReq.name.data
              isEmpty: AbsentNotePrivate.formData.whetherSign
            # 保存签名
            - actionType: evalObject
              object:
                - ..apiRequest.newSign.docReq.reid@: =.AbsentNotePrivate.apiRequest.absentNote.docReq.id

            - actionType: evalObject
              object:
                - if:
                    - =..formData.whetherSign
                    - continue
                    - =..apiRequest.newSign.docAPI.store: ""

            - actionType: evalObject
              object:
                - if:
                    - =..formData.temporarySignature
                    - actionType: evalObject
                      object:
                        - ..apiRequest.absentNote.docReq.name.data.signatureTime@: =..formData.signatureTime
                        - ..apiRequest.absentNote.docReq.name.data.signatureId@: =..formData.temporarySignature
                        - ..apiRequest.absentNote.docReq.name.data.whetherSign@: false
                        - ..formData.whetherSign@: false
                    - actionType: evalObject
                      object:
                        - ..apiRequest.absentNote.docReq.name.data.signatureTime@: =..apiRequest.newSign.docRes.doc.ctime
                        - ..apiRequest.absentNote.docReq.name.data.signatureId@: =..apiRequest.newSign.docRes.doc.id
                        - ..apiRequest.absentNote.docReq.name.data.whetherSign@: =..formData.whetherSign
            - actionType: evalObject
              object:
                - =.AbsentNotePrivate.apiRequest.absentNote.docAPI.store: ""
                - .Global.Note@: =..apiRequest.absentNote.docResp.doc
                - goto: ProviderMacros
    - type: scrollView
      style:
        width: "1"
        height: "0.846"
        overflow: scroll

      children:
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.0246"
            height: "auto"
            width: "0.92"
          children:
            - type: image
              path: office-building.svg
              path=func: .builtIn.utils.prepareDocToPath
              dataKey: apiRequest.absentNote.docReq.name.data.facilityInfo.facilityAvatarID
              style:
                verticalAlign: middle
                display: "inline-block"
                height: "0.0578"
                width: "5.78vh"
            - type: view
              style:
                verticalAlign: middle
                marginLeft: "0.08"
                display: "inline-block"
                height: "auto"
                width: "0.71"
                overflow: hidden
              children:
                - type: label
                  dataKey: apiRequest.absentNote.docReq.name.data.facilityInfo.facilityName
                  style:
                    width: "0.71"
                    height: "auto"
                    fontSize: .Nfont.h20
                    fontWeight: "600"

                    verticalAlign: middle
                    wordWrap: break-word
                - type: label
                  dataKey: apiRequest.absentNote.docReq.name.data.facilityInfo.location
                  style:
                    marginTop: "0.0110"
                    width: "0.71"
                    height: "auto"
                    fontSize: .Nfont.h14
                    color: "0x666666"

                    verticalAlign: middle
                    wordWrap: break-word

        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.00738"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: Email
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.absentNote.docReq.name.data.facilityInfo.email
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: Website
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.absentNote.docReq.name.data.facilityInfo.website
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Main #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.absentNote.docReq.name.data.facilityInfo.phoneNumber
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Fax #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.absentNote.docReq.name.data.facilityInfo.fax

        - .DocPublicLine:
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.00738"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Exam Date
                - .DocPublicStyleTwoRight:
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: apiRequest.absentNote.docReq.name.data.patientInfo.examDate
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Patient Name
                - .DocPublicStyleTwoRight:
                  dataKey: apiRequest.absentNote.docReq.name.data.patientInfo.name
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Date of Birth
                - .DocPublicStyleTwoRight:
                  dataKey: apiRequest.absentNote.docReq.name.data.patientInfo.dob
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Phone #"
                - .DocPublicStyleTwoRight:
                  dataKey: apiRequest.absentNote.docReq.name.data.patientInfo.phoneNumber
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Email"
                - .DocPublicStyleTwoRight:
                  dataKey: apiRequest.absentNote.docReq.name.data.patientInfo.email
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Patient Address"
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  dataKey: apiRequest.absentNote.docReq.name.data.patientInfo.address
                  style:
                    height: "auto"
                    width: "0.92"
                    fontSize: .Nfont.h14
                    wordWrap: break-word
                    color: "0x333333"
                    fontWeight: "600"
        - .DocPublicLine:
        - type: label
          text: "Leave Of Absence"
          dataKey:
          style:
            marginTop: "0.0222"
            marginLeft: "0.04"
            fontSize: .Nfont.h16
            width: "auto"

            fontWeight: "700"
        - type: view
          style:
            marginLeft: "0.04"
            width: "0.92"
            height: "0.037"
            marginTop: "0.021"
          children:
            - type: view
              style:
                width: "0.32"
                height: "0.037"
                display: "inline-block"
              children:
                - type: label
                  text: "Please Excuse"
                  dataKey:
                  style:
                    width: "0.32"
                    height: "0.037"
                    textAlign:
                      x: "left"
                      y: "center"
                    fontSize: .Nfont.h14

                    fontWeight: "600"
            - type: textField
              placeholder: "Enter here"
              dataKey: apiRequest.absentNote.docReq.name.data.name
              style:
                width: "0.6"
                height: "0.037"
                fontSize: .Nfont.h14

                textIndent: "12px"
                display: "inline-block"
                borderRadius: "4"
                boxSizing: "border-box"
                borderColor: "#dedede"
                border:
                  style: 3
                  width: "1.5px"
        - type: view
          style:
            marginLeft: "0.04"
            width: "0.92"
            height: "0.037"
            marginTop: "0.0148"
          children:
            - type: view
              style:
                width: "0.32"
                height: "0.037"
                display: "inline-block"
              children:
                - type: label
                  text: "As Of"
                  dataKey:
                  style:
                    width: "0.32"
                    height: "0.037"
                    textAlign:
                      x: "left"
                      y: "center"
                    fontSize: .Nfont.h14

                    fontWeight: "600"
            - type: view
              viewTag: dateTag
              style:
                width: "0.6"
                height: "auto"
                display: "inline-block"
                border:
                  style: 3
                borderRadius: "4"
                boxSizing: "border-box"
                borderColor: "#dedede"
                overflow: hidden
              children:
                - type: textField
                  placeholder: "Select"
                  dataKey: apiRequest.absentNote.docReq.name.data.date
                  isEditable: "false"
                  style:
                    marginLeft: "0.032"
                    width: "0.506"
                    height: "0.037"
                    fontSize: .Nfont.h14

                    display: "inline-block"
                    boxSizing: "border-box"
                    border:
                      style: 1
                    verticalAlign: middle
                    backgroundColor: "0xffffff"
                    color: "0x333333"
                - type: image
                  path: dateImg.svg
                  style:
                    display: "inline-block"
                    height: "0.0172"
                    verticalAlign: middle
              onClick:
                - actionType: popUp
                  popUpView: selectDate
        - type: label
          text: "From"
          dataKey:
          style:
            marginLeft: "0.04"
            marginTop: "0.022"
            fontSize: .Nfont.h14

            width: "0.92"
            fontWeight: "600"
        - type: view
          style:
            marginTop: "0.0086"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
          children:
            - type: list
              viewTag: "radioViewOne"
              contentType: listObject
              androidGrid: true
              listObject: ..formDataTemp.place
              iteratorVar: itemObject
              style:
                width: "0.92"
                margin: "0"
                height: "auto"
                axis: horizontal
              children:
                - type: listItem
                  itemObject:
                  style:
                    width: "0.234"
                    height: "0.021"
                    display: "inline-block"
                  children:
                    - type: image
                      style:
                        display: "inline-block"
                        marginTop: "0"
                        verticalAlign: middle
                        height: "0.0197"
                      path:
                        emit:
                          dataKey:
                            var: itemObject
                          actions:
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..apiRequest.absentNote.docReq.name.data.place
                                      string2: $var.value
                                - radioOn.svg
                                - radioOff.svg
                      onClick:
                        - emit:
                            dataKey:
                              var: itemObject
                            actions:
                              - if:
                                  - =.builtIn.string.equal:
                                      dataIn:
                                        string1: =..apiRequest.absentNote.docReq.name.data.place
                                        string2: $var.value
                                  - =.builtIn.object.clear:
                                      dataIn:
                                        object: =..apiRequest.absentNote.docReq.name.data
                                        key: $var.key
                                  - =.builtIn.object.set:
                                      dataIn:
                                        object: =..apiRequest.absentNote.docReq.name.data
                                        key: $var.key
                                        value: $var.value
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: radioViewOne
                    - type: label
                      text:
                      dataKey: itemObject.value
                      style:
                        marginLeft: "0.021"
                        marginTop: "0"
                        fontSize: .Nfont.h12

                        display: "inline-block"
                        verticalAlign: "middle"
        # 第二组单选框
        - type: label
          text: "Due To"
          dataKey:
          style:
            marginLeft: "0.04"
            marginTop: "0.022"
            fontSize: .Nfont.h14

            width: "0.92"
            fontWeight: "600"
        - type: view
          style:
            marginTop: "0.0086"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
          children:
            - type: list
              viewTag: "radioViewTwo"
              contentType: listObject
              listObject: ..formDataTemp.reason
              iteratorVar: itemObject
              style:
                width: "0.92"
                margin: "0"
                axis: horizontal
                height: "auto"
              children:
                - type: listItem
                  itemObject:
                  style:
                    width: "0.234"
                    height: "0.021"
                    display: "inline-block"
                  children:
                    - type: image
                      style:
                        display: "inline-block"
                        marginTop: "0"
                        verticalAlign: middle
                        height: "0.0197"
                      path:
                        emit:
                          dataKey:
                            var: itemObject
                          actions:
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..apiRequest.absentNote.docReq.name.data.reason
                                      string2: $var.value
                                - radioOn.svg
                                - radioOff.svg
                      onClick:
                        - emit:
                            dataKey:
                              var: itemObject
                            actions:
                              - if:
                                  - =.builtIn.string.equal:
                                      dataIn:
                                        string1: =..apiRequest.absentNote.docReq.name.data.reason
                                        string2: $var.value
                                  - =.builtIn.object.clear:
                                      dataIn:
                                        object: =..apiRequest.absentNote.docReq.name.data
                                        key: $var.key
                                  - =.builtIn.object.set:
                                      dataIn:
                                        object: =..apiRequest.absentNote.docReq.name.data
                                        key: $var.key
                                        value: $var.value
                        - actionType: builtIn
                          funcName: redraw
                          viewTag: radioViewTwo
                    - type: label
                      text:
                      dataKey: itemObject.value
                      style:
                        marginLeft: "0.021"
                        marginTop: "0"
                        fontSize: .Nfont.h12

                        display: "inline-block"
                        verticalAlign: "middle"

        # 纯文本:confidentiality Notice
        - type: label
          textBoard:
            - text: "Confidentiality Notice:"
              fontWeight: "600"
            - text: "&nbsp;"
            - text: "the documents accompanying
                this facsimile transmission contain confidential information
                belonging to the sender, which is privilege.the information
                is intended only for the use of the individual or entity
                below.if you are not the intended recipient, you are here
                by notified that any disclosure.copying distribution or the
                taking of any action in reliance of the contents of this
                telescoped information is strictly prohibited. if you have
                received this facsimile in error,please notify us immediately
                by telephone to arrange for the return of said documents."
          style:
            marginTop: "0.025"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"

            fontSize: .Nfont.h14
            wordBreak: break-word
          # Notes
        - type: label
          text: "Notes"
          dataKey:
          style:
            marginTop: "0.0222"
            fontSize: .Nfont.h14

            marginLeft: "0.04"
            width: "0.92"
            fontWeight: "600"
        # textView
        - type: textView
          placeholder: "Enter here"
          dataKey: apiRequest.absentNote.docReq.name.data.note
          style:
            marginTop: "0.01"
            marginLeft: "0.04"
            width: "0.92"
            height: "0.0874"
            textInde: "0.032"
            paddingTop: "7px"
            fontSize: .Nfont.h14

            borderRadius: "4"
            borderColor: "#dedede"
            boxSizing: border-box
            border:
              style: "3"
              width: "1px"
            textIndent: "12px"

        - .DocPublicLine:

        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.03"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - type: view
              style:
                height: "auto"
                width: "0.92"
              children:
                - type: label
                  text: "Signature"
                  style:
                    display: "inline-block"
                    width: "0.816"
                    fontSize: .Nfont.h14
                    height: "auto"
                    color: "0x333333"
                    fontWeight: "600"
                    textAlign:
                      x: left
                - type: label
                  text: "Clear"
                  style:
                    display: "inline-block"
                    width: "auto"
                    fontSize: .Nfont.h14
                    height: "auto"
                    color: "0xfb5051"
                  onClick:
                    - actionType: removeSignature
                      dataObject: BLOB
                      dataKey: AbsentNotePrivate.apiRequest.newSign.docReq.name.data
                      viewTag: signatureTag
                    - actionType: evalObject
                      object:
                        - ..formData.temporarySignature@: ""
                        - ..formData.signatureTime@: ""
                        - ..formData.flag@: "none"
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: signatureTimeTag
                    # 显示签名区域隐藏
                    - actionType: builtIn
                      funcName: hide
                      viewTag: signatureShowTag
                    - actionType: builtIn
                      funcName: show
                      viewTag: signatureTag
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.01"
            height: "0.128"
            width: "0.9"
            border:
              style: "4"
              color: "0xa9a9a9"
            borderWidth: "2"
          children:
            - type: label
              text: X
              style:
                .SignLabelStyle:
            - type: canvas
              dataKey: AbsentNotePrivate.apiRequest.newSign.docReq.name.data
              viewTag: signatureTag
              style:
                left: "0"
                width: "0.88"
                height: "0.128"
                overflow: scroll
            # 显示暂存的签名
            - type: image
              viewTag: signatureShowTag
              path=func: .builtIn.utils.prepareDocToPath
              # 传入签名文档的id
              dataKey: AbsentNotePrivate.formData.temporarySignature
              style:
                # 控制显示
                display: =..formData.flag
                left: "0"
                width: "0.88"
                top: "0"
                height: "0.128"
                overflow: scroll
                zIndex: "1000"

        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.0146"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - type: view
              viewTag: signatureTimeTag
              style:
                display: ..formData.flag
                marginTop: "0.01"
                height: "auto"
                width: "0.92"
              children:
                - type: label
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: apiRequest.absentNote.docReq.name.data.signatureTime
                  style:
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    fontSize: .Nfont.h12
                    color: "0x757575"
                    verticalAlign: middle
                - type: label
                  text: "Digitally Signed"
                  dataKey:
                  style:
                    marginLeft: "0.02"
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    fontSize: .Nfont.h12
                    color: "0x757575"
                    verticalAlign: middle
            - type: view
              style:
                marginTop: "0.01"
                width: "auto"
                height: "auto"
              children:
                - type: label
                  text: Date
                  style:
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    color: "0x666666"
                    fontSize: .Nfont.h12
                - type: label
                  text=func: .builtIn.string.formatUnixtimeL_en
                  dataKey: apiRequest.absentNote.docReq.ctime
                  style:
                    marginLeft: "0.0373"
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    color: "0x333333"
                    fontSize: .Nfont.h12
                    fontWeight: "600"

        - type: view
          style:
            marginTop: "0.03"
    - .BasePublicFooter:
      children:
        - type: view
          style:
            height: auto
            width: "auto"
          children:
            - .DocButtonPrivate:
              onClick:
                # 签名处理
                - actionType: saveSignature
                  dataObject: BLOB
                  dataKey: AbsentNotePrivate.apiRequest.newSign.docReq.name.data
                  isEmpty: AbsentNotePrivate.formData.whetherSign

                # 保存签名
                - actionType: evalObject
                  object:
                    # 签名reid指向 doc 的id
                    - ..apiRequest.newSign.docReq.reid@: =.AbsentNotePrivate.apiRequest.absentNote.docReq.id

                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.whetherSign
                        - continue
                        - =..apiRequest.newSign.docAPI.store: ""

                #  指定 eid 和 reid
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =.Global.formData.unPageName
                              string2: ""
                        - actionType: evalObject
                          object:
                            - ..apiRequest.absentNote.docReq.eid@: =.Global.currentRoom.edge.id
                            - ..apiRequest.absentNote.docReq.reid@: =.Global.roomInfo.edge.id
                        - continue
                # 签名处理
                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.temporarySignature
                        - actionType: evalObject
                          object:
                            - ..apiRequest.absentNote.docReq.name.data.signatureTime@: =..formData.signatureTime
                            - ..apiRequest.absentNote.docReq.name.data.signatureId@: =..formData.temporarySignature
                            - ..apiRequest.absentNote.docReq.name.data.whetherSign@: false
                            - ..formData.whetherSign@: false
                        - actionType: evalObject
                          object:
                            - ..apiRequest.absentNote.docReq.name.data.signatureTime@: =..apiRequest.newSign.docRes.doc.ctime
                            - ..apiRequest.absentNote.docReq.name.data.signatureId@: =..apiRequest.newSign.docRes.doc.id
                            - ..apiRequest.absentNote.docReq.name.data.whetherSign@: =..formData.whetherSign

                #  修改type
                - actionType: evalObject
                  object:
                    - =.builtIn.number.inhx:
                        dataIn:
                          intHex: =..apiRequest.absentNote.docReq.type
                          index: 1
                          hex: 0
                        dataOut: AbsentNotePrivate.apiRequest.absentNote.docReq.type

                # 保存newNote
                - actionType: evalObject
                  object:
                    - =..apiRequest.absentNote.docAPI.store: ""
                    - =.builtIn.array.add:
                        dataIn:
                          object: =.Global.currentMeetingDoc
                          value: =..apiRequest.absentNote.docResp.doc
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""

                - actionType: evalObject
                  object:
                    - =.builtIn.utils.createAuditLog:
                        dataIn:
                          actionTypeCode: .ActionTypeCode.edit
                          recordTypeCode: .DocType.AbsentNote
                          eid: =.Global.formData.currentFacility.relationEdge.id
                          date: =.Global.formData.auditLog.startTime
                          user: =.Global.MyProfile.name.data.fullName
                          userId: =.Global.currentUser.vertex.id
                          targetUserId: =.Global.formData.auditLog.patientId
                          accessPort: provider
                        dataOut: Global.formData.auditLog.result

                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =.Global.formData.unPageName
                              string2: ""
                        - goto: ProviderNotes
                        - goto: =.Global.formData.unPageName

            - .DocButtonRelease:
              onClick:
                # 签名处理
                - actionType: saveSignature
                  dataObject: BLOB
                  dataKey: AbsentNotePrivate.apiRequest.newSign.docReq.name.data
                  isEmpty: AbsentNotePrivate.formData.whetherSign

                # 保存签名
                - actionType: evalObject
                  object:
                    # 签名reid指向 doc 的id
                    - ..apiRequest.newSign.docReq.reid@: =.AbsentNotePrivate.apiRequest.absentNote.docReq.id

                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.whetherSign
                        - continue
                        - =..apiRequest.newSign.docAPI.store: ""

                #  指定 eid 和 reid
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =.Global.formData.unPageName
                              string2: ""
                        - actionType: evalObject
                          object:
                            - ..apiRequest.absentNote.docReq.eid@: =.Global.currentRoom.edge.id
                            - ..apiRequest.absentNote.docReq.reid@: =.Global.roomInfo.edge.id
                        - continue

                # 签名处理
                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.temporarySignature
                        - actionType: evalObject
                          object:
                            - ..apiRequest.absentNote.docReq.name.data.signatureTime@: =..formData.signatureTime
                            - ..apiRequest.absentNote.docReq.name.data.signatureId@: =..formData.temporarySignature
                            - ..apiRequest.absentNote.docReq.name.data.whetherSign@: false
                            - ..formData.whetherSign@: false
                        - actionType: evalObject
                          object:
                            - ..apiRequest.absentNote.docReq.name.data.signatureTime@: =..apiRequest.newSign.docRes.doc.ctime
                            - ..apiRequest.absentNote.docReq.name.data.signatureId@: =..apiRequest.newSign.docRes.doc.id
                            - ..apiRequest.absentNote.docReq.name.data.whetherSign@: =..formData.whetherSign

                - actionType: evalObject
                  object:
                    - if:
                        - =.AbsentNotePrivate.formData.whetherSign
                        - actionType: popUp
                          popUpView: BaseWarningView
                          wait: true
                          popUpDismiss: 2000
                        - continue

                #  修改type
                - actionType: evalObject
                  object:
                    - =.builtIn.number.inhx:
                        dataIn:
                          intHex: =..apiRequest.absentNote.docReq.type
                          index: 1
                          hex: 1
                        dataOut: AbsentNotePrivate.apiRequest.absentNote.docReq.type

                - actionType: evalObject
                  object:
                    - =.builtIn.utils.createAuditLog:
                        dataIn:
                          actionTypeCode: .ActionTypeCode.edit
                          recordTypeCode: .DocType.AbsentNote
                          eid: =.Global.formData.currentFacility.relationEdge.id
                          date: =.Global.formData.auditLog.startTime
                          user: =.Global.MyProfile.name.data.fullName
                          userId: =.Global.currentUser.vertex.id
                          targetUserId: =.Global.formData.auditLog.patientId
                          accessPort: provider
                        dataOut: Global.formData.auditLog.result

                - actionType: popUp
                  popUpView: dialogueTag

    # 弹窗区域
    - .BaseWarningView:
      message: "You haven't signed the form"

    # 对话弹窗组件
    - .Normal:
      message: "Do you want the patient to see it?"
      viewTag: dialogueTag
      leftText: "No"
      rightText: "Yes"
      leftButton:
        # 保存newNote
        - actionType: evalObject
          object:
            # 修改tage
            - ..apiRequest.absentNote.docReq.tage@: 1
            - =..apiRequest.absentNote.docAPI.store: ""
            - =.builtIn.array.add:
                dataIn:
                  object: =.Global.currentMeetingDoc
                  value: =..apiRequest.absentNote.docResp.doc
        - actionType: evalObject
          object:
            .Global._nonce@:
              =.builtIn.math.random: ""

        - actionType: popUpDismiss
          popUpView: dialogueTag

        - actionType: popUp
          popUpView: successTag

        - actionType: evalObject
          object:
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =.Global.formData.unPageName
                      string2: ""
                - goto: ProviderNotes
                - goto: =.Global.formData.unPageName
      rightButton:
        - actionType: evalObject
          object:
            # 更新文档状态
            - ..apiRequest.absentNote.docReq.name.data.statusTag.name@: "Released"
            - ..apiRequest.absentNote.docReq.name.data.statusTag.fontColor@: "0x2988e6"
            - ..apiRequest.absentNote.docReq.name.data.statusTag.backgroundColor@: "0xdfedfc"

        - actionType: evalObject
          object:
            # 修改tage
            - ..apiRequest.absentNote.docReq.tage@: -1
            - =..apiRequest.absentNote.docAPI.store: ""
            - =.builtIn.array.add:
                dataIn:
                  object: =.Global.currentMeetingDoc
                  value: =..apiRequest.absentNote.docResp.doc
        - actionType: evalObject
          object:
            .Global._nonce@:
              =.builtIn.math.random: ""

        - actionType: popUpDismiss
          popUpView: dialogueTag

        - actionType: popUp
          popUpView: successTag

        - actionType: evalObject
          object:
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =.Global.formData.unPageName
                      string2: ""
                - goto: ProviderNotes
                - goto: =.Global.formData.unPageName
    - .SuccessfulOneLine:
      message: "Successfully"
      viewTag: successTag

    - type: popUp
      viewTag: selectDate
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        backgroundColor: "0x00000066"
        zIndex: "1000"
      children:
        - .BaseComponents.calendar:
          children:
            - .BaseComponents.calendarHeader:
              children:
                - type: view
                  style:
                    marginTop: "0.024"
                    left: "0"
                    height: "0.035"
                    width: "0.9"
                  children:
                    - .BaseComponents.newMonthView:
                    - .BaseComponents.newYearView:
                - .BaseComponents.newdevider:
                - .BaseComponents.weekView:
            - .BaseComponents.dayView:
            - .BaseComponents.addButton:
              text: "Select"
              onClick:
                - actionType: evalObject
                  object:
                    - ..apiRequest.absentNote.docReq.name.data.date@: =.BaseComponents.calendarDate.todayDate
                - actionType: builtIn
                  funcName: redraw
                  viewTag: dateTag
                - actionType: popUpDismiss
                  popUpView: selectDate
