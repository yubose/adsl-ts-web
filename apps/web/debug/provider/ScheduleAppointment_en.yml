ScheduleAppointment:
  title: Schedule an Appointment
  pageNumber:
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - actionType: evalObject
      object:
        - actionType: evalObject
          async: true
          object:
            - =..apiRequest.connection.docAPI.get: ""
            - =..apiRequest.facilityConnections.docAPI.get: ""
    - ..formData.providerList@: =..apiRequest.connection.connectionList.doc
    - ..formData.facilityList@: =..apiRequest.facilityConnections.facilityConList.doc
    # 对provider列表进行除重
    - =.builtIn.array.keepLatestDoc:
        dataIn:
          docList: =..formData.providerList
          path: bsig
        dataOut: ScheduleAppointment.formData.providerList
    # 将provider本人加入到好友列表
    - =.builtIn.array.pushAny:
        dataIn:
          newMessage: =.Global.MyProfile
          messages: =..formData.providerList
        dataOut: ScheduleAppointment.formData.providerList

    - =.builtIn.array.getOrReplaceAnArrayItem:
        dataIn:
          strArr: =.Global.formData.currentTabStatusList
          tag: false
        dataOut: ScheduleAppointment.formData.currentTab
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =.Global.formData.currentTabStatusList
              len: 2
        - actionType: evalObject
          object:
            - =.builtIn.object.setProperty:
                dataIn:
                  obj: =..formDataTemp.titleData
                  label: "title"
                  text: =..formData.currentTab
                  arr: ["fontColor", "fontWeight", "block"]
                  valueArr: ["0x2988e6", "600", "block"]
                  errorArr: ["0x666666", "400", "none"]
                dataOut: ScheduleAppointment.formDataTemp.titleData
            - ..formData.providerShow@: =..formDataTemp.titleData.0.block
            - ..formData.facilitiesShow@: =..formDataTemp.titleData.1.block
        - continue
  apiRequest:
    connection: #provider & provider
      connectionList:
        edge: ""
      docAPI:
        get:
          api: rd
          type: .DocType.DoctorProfile
          xfname: (E.bvid|E.evid)&!(D.ovid)
          id: .Global.currentUser.vertex.id
          ObjType: 12
          obfname: mtime
          dataKey: apiRequest.connection.connectionList
          sCondition: E.type=10002 AND E.tage>0 AND E.subtype&0xff0000=0x40000
          _nonce: =.Global._nonce
    edge:
      edgeAPI:
        get:
          api: re
          type: .Global.Email
          xfname: E.bvid|E.evid
          id: .Global.patientId
          dataKey: patient.patientList
          sCondition: subtype in (65536,65552,65808,65792)
    # get all facility profile
    facilityConnections:
      facilityConList: ""
      docAPI:
        get:
          api: rd
          type: 271361
          xfname: E.bvid|E.evid
          id: .Global.currentUser.vertex.id
          ObjType: 12
          dataOut: ScheduleAppointment.apiRequest.facilityConnections.facilityConList
          sCondition: E.type=10002 AND E.tage=1 AND E.subtype&0xff0000=0x30000
          _nonce: =.Global._nonce
    # get all facilitys which provider belongs to
    facility:
      docQueryResp: ""
      docQueryReq:
        ObjType: 12
        id: ""
        xfname: E.bvid|E.evid
        sCondition: "E.type=10002 AND E.tage=1 AND E.subtype&0xff0000=0x30000"
        type: .DocType.FacilityProfile
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: ScheduleAppointment.apiRequest.facility.docQueryReq
          dataOut: ScheduleAppointment.apiRequest.facility.docQueryResp
  formData:
    currentTab: ""
    facilityCount: ""
    providerId: ""
    providerList: []
    facilityList: []
    tempData: ""
    providerShow: "block"
    facilitiesShow: "none"
  formDataTemp:
    titleData:
      - title: Providers
        fontColor: "0x2988e6"
        fontWeight: "500"
        block: "block"
      - title: Medical Facilities
        fontColor: "0x4b4b4b"
        fontWeight: "400"
        block: "none"
  components:
    - .BasePublicHeader:
      children:
        - .BasePublicHeaderLeft:
          leftClick:
            - actionType: evalObject
              object:
                - =.builtIn.array.getOrReplaceAnArrayItem:
                    dataIn:
                      strArr: =.Global.formData.currentTabStatusList
                      tag: true
                      index: 1
                    dataOut: Global.formData.currentTabStatusList
            - actionType: builtIn
              funcName: goBack
              reload: true
        - .BasePublicHeaderTitle:
    - type: list
      viewTag: tabTag
      contentType: listObject
      listObject: ..formDataTemp.titleData
      iteratorVar: itemObject
      style:
        ..style.tabList:
      children:
        - type: listItem
          itemObject:
          style:
            ..style.tabListItem:
          children:
            - type: label
              dataKey: itemObject.title
              style:
                ..style.title:
            - type: view
              style:
                ..style.line:
            - type: view
              viewTag: leftBlockTag
              style:
                ..style.tabBar:
          onClick:
            - ..event.tabChange
    - type: scrollView
      style:
        ..style.scrollBox:
      children:
        - type: view
          viewTag: providersTag
          style:
            ..style.viewBox:
            display: ..formData.providerShow
          children:
            # Providers
            - type: list
              viewTag: providersTag
              contentType: listObject
              listObject: ..formData.providerList
              iteratorVar: itemObject
              style:
                ..style.dataList:
                display: ..formData.providersBlock
              children:
                - type: listItem
                  itemObject: ""
                  style:
                    width: "1"
                    height: "auto"
                    margin: "0"
                    # border:
                    #   style: "2"
                    # borderWidth: "1"
                    # borderColor: "0xdededf"
                    overflow: hidden
                  onClick:
                    - ..event.providerItemClick
                  children:
                    - type: view
                      style:
                        ..style.itemBox:
                      children:
                        - type: image
                          path: providerImage.svg
                          path=func: .builtIn.utils.prepareDocToPath
                          dataKey: itemObject.name.data.avatar
                          style:
                            ..style.listImg:
                        - type: view
                          style:
                            ..style.itemValueBox:
                          children:
                            - type: label
                              textBoard:
                                - text: ""
                                  dataKey: itemObject.name.data.fullName
                                - text: "&nbsp;-&nbsp;"
                                - text: ""
                                  dataKey: itemObject.name.data.title
                              dataKey: 
                              style:
                                ..style.fullLabel:
                            - type: label
                              text: ""
                              dataKey: itemObject.name.data.selectedSpecialty.0
                              style:
                                ..style.specialty:
                    - type: view
                      style:
                        marginTop: "0.0198"
                      children:
                        - type: label
                          style:
                            height: "0.001"
                            width: "1"
                            backgroundColor: "0xdededf"
        # facility list
        - type: view
          viewTag: facilitysTag
          style:
            ..style.viewBox:
            display: ..formData.facilitiesShow
          children:
            - type: list
              viewTag: facilitysTag
              contentType: listObject
              listObject: ..formData.facilityList
              iteratorVar: itemObject
              style:
                ..style.dataList:
              children:
                - type: listItem
                  itemObject: ""
                  style:
                    ..style.dataListItem:
                  onClick:
                    - ..event.facilityItemClick
                  children:
                    - type: view
                      style:
                        ..style.itemBox:
                      children:
                        - type: image
                          path: office-building.png
                          path=func: .builtIn.utils.prepareDocToPath
                          dataKey: itemObject.name.data.basicInfo.businessLogo
                          style:
                            ..style.listImg:
                        - type: view
                          style:
                            ..style.itemValueBox:
                          children:
                            - type: label
                              text: ""
                              dataKey: itemObject.name.data.basicInfo.medicalFacilityName
                              style:
                                ..style.fullLabel:
                            - type: label
                              text: ""
                              dataKey: itemObject.name.data.basicInfo.businessType
                              style:
                                ..style.specialty:
                    - type: view
                      style:
                        marginTop: "0.0198"

  event:
    tabChange:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - ..formData.tempData@: $var.title
            - =.builtIn.object.setProperty:
                dataIn:
                  obj: =..formDataTemp.titleData
                  label: "title"
                  text: $var.title
                  arr: ["fontColor", "fontWeight", "block"]
                  valueArr: ["0x2988e6", "500", "block"]
                  errorArr: ["0x4b4b4b", "400", "none"]
            - ..formData.providerShow@: =..formDataTemp.titleData.0.block
            - ..formData.facilitiesShow@: =..formDataTemp.titleData.1.block
            - =.builtIn.array.getOrReplaceAnArrayItem:
                dataIn:
                  strArr: =.Global.formData.currentTabStatusList
                  tag: true
                  index: 1
                  value: $var.title
                dataOut: Global.formData.currentTabStatusList
      - actionType: builtIn
        funcName: redraw
        viewTag: providersTag
      - actionType: builtIn
        funcName: redraw
        viewTag: facilitysTag
      - actionType: builtIn
        funcName: redraw
        viewTag: showVT
      - actionType: builtIn
        funcName: redraw
        viewTag: tabTag
    providerItemClick:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - ..formData.providerId@: $var.bsig
            - .Global.formData.relatedApp.activeProviderId@: $var.bsig
      - actionType: updateObject
        dataKey: Global.formData.relatedApp.activeProvider
        dataObject: itemObject
      - actionType: evalObject
        object:
          .Global._nonce@:
            =.builtIn.math.random: ""
      - actionType: evalObject
        object:
          # if facilities of provider is more than one, enter the ChooseFacilities page
          - ..apiRequest.facility.docQueryReq.id@: =..formData.providerId
          - =..apiRequest.facility.docAPI.get: ""
          - =.builtIn.array.getListLength:
              dataIn:
                object: =..apiRequest.facility.docQueryResp.doc
              dataOut: ScheduleAppointment.formData.facilityCount
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..formData.facilityCount
                    string2: "1"
              - actionType: evalObject
                object:
                  - .Global.formData.relatedApp.activefacility@: =..apiRequest.facility.docQueryResp.doc.0
                  - .Global.formData.relatedApp.activeFacilityId@: =..apiRequest.facility.docQueryResp.doc.0.bsig
                  - goto: CreateSchedule
              - actionType: evalObject
                object:
                  - .Global.formData.relatedApp.facilityList@: =..apiRequest.facility.docQueryResp.doc

                  - goto: ChooseFacilities
    facilityItemClick:
      - actionType: updateObject
        dataKey: Global.formData.currentProviderFacility
        dataObject: itemObject
      - actionType: updateObject
        dataKey: Global.formData.relatedApp.activefacility
        dataObject: itemObject
      - actionType: evalObject
        object:
          - .Global.formData.relatedApp.activeFacilityId@: =.Global.formData.relatedApp.activefacility.bsig
      - goto: ChooseProviders
  style:
    tabList:
      width: "1"
      margin: "0"
      axis: horizontal
      height: "auto"
      overflow: hidden
      marginTop: "0.02"
    tabListItem:
      width: "0.5"
      height: "auto"
      boxSizing: border-box
    title:
      color: itemObject.fontColor
      height: "auto"
      width: "0.5"
      fontWeight: itemObject.fontWeight
      textAlign:
        x: center
      fontSize: .Nfont.h16
    line:
      marginTop: "0.005"
      height: "0.0025" #2.03px
      width: "0.5"
      backgroundColor: "0xdededf"
    tabBar:
      display: itemObject.block
      top: "0.031"
      left: "0.2"
      width: "0.08"
      height: "0.0025"
      backgroundColor: "0x2988e6"
      zIndex: 10
    scrollBox:
      width: "1"
      height: "0.89"
      boxSizing: border-box
    viewBox:
      width: "1"
      height: "auto"
      boxSizing: border-box
    dataList:
      margin: "0"
      padding: "0"
      width: "1"
      height: "auto"
      boxSizing: border-box
    dataListItem:
      width: "1"
      height: "auto"
      margin: "0"
      border:
        style: "2"
      borderWidth: "1"
      borderColor: "0xdededf"
      overflow: hidden
    listImg:
      verticalAlign: middle
      display: "inline-block"
      height: "0.04926"
      width: "0.10666"
      boxSizing: border-box
      borderRadius: "4"
    itemBox:
      marginTop: "0.0198"
      marginLeft: "0.0427"
      height: "auto"
      width: "0.91"
    itemValueBox:
      verticalAlign: middle
      marginLeft: "0.03733"
      display: "inline-block"
      height: "auto"
      width: "0.75"
      overflow: hidden
    fullLabel:
      width: "0.75"
      height: "auto"

      verticalAlign: middle
      fontSize: .Nfont.h16
      fontWeight: "600"
      wordWrap: break-word
    specialty:
      marginTop: "0.005"
      width: "0.75"
      height: "auto"
      fontSize: .Nfont.h14
      color: "#666666"

      verticalAlign: middle
      wordWrap: break-word
    popBox:
      top: "0"
      left: "0"
      width: "1"
      height: "1"
      backgroundColor: "0x00000066"
      zIndex: "50"
      textAlign:
        y: center
    conentBox:
      width: "0.72"
      marginLeft: "0.14"
      backgroundColor: "0xE6E6E6"
      borderRadius: "14px"
    message:
      width: "0.616"
      marginLeft: "0.052"
      marginTop: "0.029"
      fontWeight: "600"
      fontSize: .Nfont.h16

      color: "0x4B4B4B"
      textAlign:
        x: center
    secondBox:
      marginTop: "0.014778"
      textAlign:
        x: center
      width: "0.72"
    popImg:
      marginLeft: "0.032"
      height: "0.04926"
      width: "0.10666"
      backgroundColor: "0xFFFFFF"
      verticalAlign: middle
      display: "inline-block"
      borderRadius: "4"
      textAlign:
        x: center
    valueBox:
      display: "inline-block"
      verticalAlign: middle
      marginLeft: "0.037"
      textAlign:
        x: left
    valueLabel:
      fontSize: .Nfont.h12
      color: "0x333333"
      fontWeight: "600"
    popSpecialty:
      fontSize: .Nfont.h12
      marginTop: "0"
      zIndex: "1000"
      color: "0x666666"
      fontWeight: "400"
      height: "auto"
      width: "0.45"
      overflow: hidden
      text-overflow: ellipsis
      whiteSpace: nowrap
    popTitle:
      marginTop: "0.01231"
      height: "auto"
      width: "auto"
      fontSize: .Nfont.h12
      color: "#333333"
      fontWeight: "600"
    category:
      marginTop: "0.005"
      width: "0.43733"
      height: "0.03694"
      fontSize: .Nfont.h12
      border:
        style: 3
      borderWidth: "1"
      borderRadius: "4"
      borderColor: "#dededf"
      textIndent: "12px"
    secondLine:
      height: "0.02"
      border:
        style: 2
        color: "0x919192"
      borderWidth: "1"
      width: "0.72"
    buttonLine:
      width: "0.002"
      backgroundColor: "0x919192"
      display: inline-block
      height: "0.054"
      zIndex: "50"
    cancelBox:
      color: "0x007AFF"
      backgroundColor: "0xE6E6E6"
      display: inline-block
      width: "0.359"
      borderRadius: "0 0 0 14px"
      fontSize: .Nfont.h14
      height: "0.054"
      border:
        style: "1"
    confirmBox:
      color: "0x007AFF"
      fontWeight: "800"
      backgroundColor: "0xE6E6E6"
      display: inline-block
      width: "0.359"
      fontSize: .Nfont.h14
      borderRadius: "0 0 14px 0"
      height: "0.054"
      border:
        style: "1"
