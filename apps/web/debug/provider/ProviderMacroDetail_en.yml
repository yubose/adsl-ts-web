ProviderMacroDetail:
  title: Macro Details
  init:
    - .SignInCheck
    - if:
        - =.Global.Macro.id
        - actionType: evalObject
          object:
            - ..macro.document@: =.Global.Macro
            - =.builtIn.string.concat:
                dataIn:
                  - =.Global.Macro.name.title
                  - =.Global.Macro.name.data.content
                dataOut: ProviderMacroDetail.formData.goalData
        - continue
  save:
    - =.ProviderMacroDetail.macro.docAPI.store: ""
  delete:
    - =.ProviderMacroDetail.macro.docAPI.delete: ""
  newSign:
    docRes: ""
    document: #DOC
      .Document: ""
      type: .DocType.DocumentSignature
      name:
        title: ""
        type: ..newSign.document.subtype.mediaType
        data: ""
      eid: .Global.rootNotebookID
      fid: ""
      subtype:
        mediaType: "" # mediaType : "image/jpeg"
    docAPI: # DOCAPI
      .DocAPI: ""
      store:
        api: cd
        dataIn: newSign.document
        dataOut: ProviderMacroDetail.newSign.docRes
  macro:
    response: ""
    document:
      # .Global.Macro: ""
      .Document: ""
      eid: .Global.rootNotebookID
      type: .DocType.Macro
      name:
        type: "text/plain"
        title: ""
        data:
          content: ""
    docAPI:
      .DocAPI: ""
      store:
        api: cd
        dataIn: macro.document
        dataOut: ProviderMacroDetail.macro.response
        subtype:
          mediaType: "text/plain" # mediaType : "image/jpeg"
      delete:
        api: dx
        dataIn: ProviderMacroDetail.macro.document
  formData:
    checkoutData: ""
    goalData: ""
    whetherSign: ""
  components:
    - .BaseHeader:
    - .HeaderLeftButton:
      onClick:
        - actionType: evalObject
          object:
            - if:
                - =.Global.Macro.id
                - actionType: evalObject
                  object:
                    - =.builtIn.string.concat:
                        dataIn:
                          - =..macro.document.name.title
                          - =..macro.document.name.data.content
                        dataOut: ProviderMacroDetail.formData.checkoutData
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..formData.goalData
                              string2: =..formData.checkoutData
                        - goto: ProviderMacros
                        - actionType: popUp
                          popUpView: judgmentOperation
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..macro.document.name.title
                              string2: ""
                        - actionType: evalObject
                          object:
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..macro.document.name.data.content
                                      string2: ""
                                - goto: ProviderMacros
                                - actionType: popUp
                                  popUpView: judgmentOperation
                        - actionType: popUp
                          popUpView: judgmentOperation
    - type: scrollView
      style:
        width: "1"
        height: "0.8"
        top: "0.1"
        left: "0"
        overflow: hidden
      children:
        - type: view
          style:
            width: "0.9"
            height: "auto"
            marginTop: "0.01"
          children:
            - type: label
              text: Title
              style:
                width: "1"
                height: "0.04"
                fontSize: .Nfont.h3
                textAlign:
                  x: center
            - type: label
              text: "*"
              style:
                left: "0.6"
                top: "0"
                width: "0.1"
                height: "0.02"
                fontSize: .Nfont.h15
                color: "0xd53c42"
        - type: textField
          placeholder: "Macro"
          dataKey: macro.document.name.title
          style:
            marginLeft: "0.15"
            marginTop: "0.01"
            width: "0.7"
            height: "0.04"
            border:
              style: "2"
            borderWidth: "1"
            borderColor: "0x000000"
            fontSize: .Nfont.h2
            textAlign:
              x: center
        - type: label
          text: Content
          style:
            marginTop: "0.01"
            width: "1"
            height: "auto"
            fontSize: .Nfont.h3
            textAlign:
              x: center
        - type: textView
          placeholder: "Super cool macro"
          dataKey: macro.document.name.data.content
          style:
            left: "0.1"
            marginTop: "0.01"
            width: "0.8"
            height: "0.61"
            fontSize: .Nfont.h15
            textIndent: "10px"
            fontFamily: sans-serif
            border:
              style: "3"
              width: "1"
            borderColor: "0x787878"
            textAlign:
              y: top

    - type: view
      style:
        width: "1"
        height: "0.1"
        top: "0.9"
        left: "0"
      children:
        - type: button
          text: Delete
          onClick:
            - actionType: evalObject
              object: ..delete
            - actionType: evalObject
              object:
                - goto: ProviderMacros
          style:
            left: "0.1"
            top: "0.015"
            width: "0.38"
            fontSize: .Nfont.h2
            height: "0.05"
            borderWidth: "0"
            borderRadius: "5"
            backgroundColor: "0xd5626a"
            color: "0xffffff"
            textAlign:
              x: center
        - type: button
          text: Save
          onClick:
            - actionType: evalObject
              object:
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =..macro.document.name.title
                          string2: ""
                    - ..macro.document.name.title@: "Macro"
                    - continue
            # 保存Macro
            - actionType: evalObject
              object: ..save

            # - actionType: evalObject
            #   object:
            #     - if:
            #       - =.ProviderMacroDetail.formData.whetherSign
            #       - actionType: popUp
            #         message: "You haven't signed the form"
            #         popUpView: BaseWarningView
            #         wait: true
            #       - continue

            - actionType: evalObject
              object:
                .Global._nonce@:
                  =.builtIn.math.random: ""

            - actionType: evalObject
              object:
                - goto: ProviderMacros
          style:
            left: "0.52"
            top: "0.015"
            width: "0.38"
            fontSize: .Nfont.h2
            height: "0.05"
            borderWidth: "0"
            borderRadius: "5"
            backgroundColor: "0x2fb355"
            color: "0xffffff"
            textAlign:
              x: center

    - .BaseWarningView:

    - .BackgroundColorGray:
      viewTag: judgmentOperation
      children:
        - type: view
          style:
            left: "0.15"
            top: "0.43"
            width: "0.72"
            height: auto
            backgroundColor: "0xe4e4e5"
            borderRadius: "10"
          children:
            - type: label
              text: Whether to save your changes ?
              style:
                width: "0.65"
                height: auto
                marginLeft: "0.035"
                color: "0x555555"
                fontSize: .Nfont.h1
                fontFamily: "Arial"
                # margin: auto
                marginTop: "0.03"
                word-break: break-word
                textAlign:
                  x: center
            - type: view
              style:
                width: "0.72"
                height: "0.02"
                borderBottom: "1px solid #848484"
            - .ButtonView:
              children:
                - .JudgmentCancelButton:
                  onClick:
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""

                    - actionType: evalObject
                      object:
                        - goto: ProviderMacros
                - .DividerLine:
                - .JudgmentConfirmButton:
                  onClick:
                    - actionType: evalObject
                      object:
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =..macro.document.name.title
                                  string2: ""
                            - ..macro.document.name.title@: "Macro"
                            - continue
                    # 保存Macro
                    - actionType: evalObject
                      object: ..save
                    - actionType: popUpDismiss
                      popUpView: judgmentOperation
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: evalObject
                      object:
                        - goto: ProviderMacros
