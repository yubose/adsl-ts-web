SwitchFacility:
  title: "Switch Facility"
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - ..formData.facilities@: =.Global.organizations 
    - =.builtIn.object.setProperty:
        dataIn:
          obj: =..formData.facilities
          label: "id"
          text: =.Global.currentFacilityDoc.bsig
          arr: ["borderColor"]
          valueArr: ["0x2887e5"]
          errorArr: ["0xeeeeee"] 
    # 是否存在facility
    - actionType: evalObject
      object:
        - =.builtIn.array.getListLength:
            dataIn:
              object: =..formData.facilities
            dataOut: SwitchFacility.formData.facilityLength
      
    - actionType: evalObject
      object:
        - if:
          - =.builtIn.string.equal:
              dataIn:
                string1: =..formData.facilityLength
                string2: "0"
          - actionType: evalObject
            object:
              - ..formData.facilityInfo@: "none"
              - ..formData.emptyfacility@: "block"
          - actionType: evalObject
            object:
              - ..formData.facilityInfo@: "block"
              - ..formData.emptyfacility@: "none"   
  localFacility:
  apiRequest:
    currentFacilityDoc:
      docResp: ""
      docReq:
        id: =.Global.currentFacility.id
        xfname: ovid
        obfname: "mtime"
        maxcount: "1"
        type: .DocType.FacilityProfile
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: apiRequest.currentFacilityDoc.docReq
          dataOut: SwitchFacility.apiRequest.currentFacilityDoc.docResp
  formData:
    facilities: []
    emptyfacility: "block"
    # facilityInfo: "none"
    facilityLength: ""
  components:
    - .BaseHeader:
    - .HeaderLeftBack:
    - type: view
      viewTag: facilityTag
      style:
        marginTop: "0.1"
        marginLeft: "0.04"
        width: "0.92"
        height: "0.615"
        boxSizing: border-box
      children:
        - type: view
          style:
            display: ..formData.emptyfacility
            width: "0.92"
            height: "auto"
            overflow: hidden
            textAlign: 
              x: center
          children:
            - type: image
              path: emptyPage.svg
              style:
                marginTop: "0.0911"
                width: "0.6453"
            - type: label
              text: "There is no facility now."
              style:
                marginTop: "0.0467"
                width: "0.92"
                height: "auto"
                fontSize: .Nfont.h14
                textAlign:
                  x: center
        - type: list
          contentType: listObject
          listObject: ..formData.facilities
          iteratorVar: itemObject
          style:
            display: ..formData.facilityInfo
            height: "0.615"
            width: "0.92"
            borderRadius: "7"
            boxSizing: border-box
            overflow: scroll
          children:
            - type: listItem
              viewTag: switchTag
              itemObject:
              style:
                marginTop: "0.0198"
                width: "0.92"
                height: "auto"
                border:
                  style: 3
                borderWidth: "1.5"
                borderColor: itemObject.borderColor
                boxShadow: "1px 1px 4px 1px #eeeeee"
                borderRadius: "7"
                overflow: hidden
                boxSizing: border-box
                fontFamily: Arial
              children:
                - type: view
                  style:
                    marginTop: "0.0198" #16.08px
                    height: "auto"
                    width: "0.92"
                  children:
                    - type: image
                      dataKey: itemObject.name.basicInfo.businessLogo
                      path=func: =.builtIn.utils.prepareDocToPath
                      path: office-building.svg
                      style:
                        marginLeft: "0.0533"
                        verticalAlign: middle
                        display: "inline-block"
                        height: "0.059"
                        width: "0.128"
                        borderRadius: "5"
                    - type: label
                      dataKey: itemObject.name.basicInfo.medicalFacilityName
                      style:
                        verticalAlign: middle
                        marginLeft: "0.0426"
                        display: "inline-block"
                        height: "auto"
                        width: "0.6"
                        overflow: hidden
                    - type: image
                      path: blueRightThin.svg
                      style:
                        display: "inline-block"
                        verticalAlign: middle
                        width: "0.064"
                        height: "0.0295"
                - type: view
                  style:
                    height: "0.0198" #16.08px                        
              onClick:
                - actionType: evalObject
                  object:
                    - .Global.currentFacility@: []
                    - actionType: updateObject
                      dataKey: Global.currentFacility
                      dataObject: itemObject
                - actionType: evalObject
                  object:
                    - =..apiRequest.currentFacilityDoc.docAPI.get: ""
                    - .Global.currentFacilityDoc@:  =..apiRequest.currentFacilityDoc.docResp.doc.0
                - emit:
                    dataKey:
                      var: itemObject
                    actions:
                      - .Global.formData.location@: $var
                      - .Global.dashboardName@: $var.name.basicInfo.medicalFacilityName
                - goto: Dashboard          
    - type: view
      style:
        marginTop: "0.0198"
        width: "1"
        height: "auto"
        fontFamily: Arial
        textAlign:
          x: center
      children:
        - type: image
          path: aitmedLogoBlack.svg
          style:
            height: "0.0948"
        - type: label
          text: You can switch at any time by tapping the switch account button in the menu bar at the top right hand corner of the dashboard. 
          style:
            marginLeft: "0.04"
            marginTop: "0.0198"
            height: "auto"
            width: "0.92"
            color: "0x333333"
            lineHeight: "2.2vh"
            fontSize: .Nfont.h12
            textAlign:
              x: center

                
