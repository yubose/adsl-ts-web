SentMessage:
  pageNumber: "220"
  title: "Message"
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    #获取tag
    - ..apiRequest.emailTag.docAPI.get
    #获取附件
    - ..apiRequest.attachment.docAPI.get
    - ..apiRequest.email.docAPI.get
    # 根据email的tage的指定位的值来判断是何种类型的邮件
    - if:
      # 判断是否是recommendation邮件
      - =.builtIn.number.typeIsValid:
          dataIn:
            docType: =.Global.inbox.sentEmail.tage
            localArr: [1]
            binaryArr: [1]
      - actionType: evalObject
        object:
          - ..formData.display.normalType@: none
          - ..formData.display.recommendationNotification@: block
      - actionType: evalObject
        object:
          - ..formData.display.normalType@: block
          - ..formData.display.recommendationNotification@: none
  formData:
    # 控制哪种邮件内容展示
    display: 
      # 普通邮件
      normalType: none
      # recommendation邮件
      recommendationNotification: none
  requestListHidden: "true"
  subject: ""
  inboxFolder: ""
  apiRequest:
    email:
      docQueryResp: ""
      docQueryReq:
        id: .Global.inbox.sentEmail.esig
      docAPI:
        get:
          api: rd
          dataIn: SentMessage.apiRequest.email.docQueryReq
          dataOut: SentMessage.apiRequest.email.docQueryResp
    #get attachment
    attachment:
      docQueryResp: ""
      docQueryReq:
        type: .DocType.Attachment
        id: .Global.inbox.sentEmail.id
        xfname: reid
        obfname: "ctime"
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: SentMessage.apiRequest.attachment.docQueryReq
          dataOut: SentMessage.apiRequest.attachment.docQueryResp
    emailTag:
      docQueryResp: ""
      docQueryReq:
        sCondition: type & 0xFF00 = 0xE00
        ids:
          - .Global.rootNotebookID
          - .Global.inbox.sentEmail.id
        xfname: eid,reid
        _nonce: =.Global._nonce
      docCreateResp: ""
      docCreateReq:
        type: .DocType.MailTag
        eid: .Global.rootNotebookID
        name:
          data: ""
        reid: ""
      docAPI:
        get:
          api: rd
          dataIn: SentMessage.apiRequest.emailTag.docQueryReq
          dataOut: SentMessage.apiRequest.emailTag.docQueryResp
        store:
          api: cd
          dataIn: SentMessage.apiRequest.emailTag.docCreateReq
          dataOut: SentMessage.apiRequest.emailTag.docCreateResp
  components:
    - .BaseHeader:
    - .HeaderLeftImg:
      onClick:
        - actionType: builtIn
          funcName: goBack
          reload: true
      path: whiteLeft.svg
    - type: view
      style:
        width: "1"
        height: "0.8"
        top: "0.1"
        left: "0"
        display: "block"
        
      viewTag: funbar
      children:
        - type: view
          style:
            width: "1"
            left: "0"
            height: "0.15"
            zIndex: "10"
            border:
              style: "2"
            borderColor: "0xe9e9eb"
            borderWidth: "1"
            position: "relative"
          children:
            - type: label
              text=func: .builtIn.string.formatUnixtime_en
              dataKey: Global.inbox.sentEmail.ctime
              style:
                top: "0.02"
                height: "0.02"
                width: "0.34"
                textAlign:
                  y: center
                left: "0.05"
                fontSize: .Nfont.h12
                color: "0xBCC5D3"
            - type: label
              dataKey: Global.inbox.sentEmail.name.title
              style:
                fontSize: "21"
                fontWeight: "500"
                left: "0.05"
                top: "0.045"
                width: "0.9"
            - type: label
              text: "From:"
              style:
                left: "0.05"
                top: "0.085"
                height: "0.035"
                fontSize: "15"
                textAlign:
                  x: left
            - type: label
              text: Blair Zhang
              dataKey: Global.inbox.sentEmail.name.data.senderName
              style:
                fontSize: "15"
                fontWeight: "450"
                height: "0.035"
                width: "0.6"
                color: "0xBCC5D3"
                left: "0.2"
                top: "0.085"
                textAlign:
                  x: left
            - type: label
              text: "To:"
              style:
                left: "0.05"
                top: "0.115"
                height: "0.035"
                fontSize: "15"
                textAlign:
                  x: left
            - type: label
              text:
              dataKey: Global.inbox.sentEmail.name.data.receiverName
              style:
                fontSize: "15"
                fontWeight: "450"
                height: "0.035"
                width: "0.6"
                color: "0xBCC5D3"
                left: "0.2"
                top: "0.115"
                textAlign:
                  x: left
        - type: view
          style:
            display: ..formData.display.normalType
            top: "0.16"
            left: "0"
            width: "1"
            height: "0.42"
          children:
            - type: textView
              isEditable: "false"
              dataKey: Global.inbox.sentEmail.name.data.content
              style:
                top: "0.01"
                width: "0.9"
                left: "0.05"
                fontSize: .Nfont.h14
                height: "0.4"
                backgroundColor: "0xffffff"
                color: "0x757575"
                fontWeight: 300
                border:
                  style: "2"
                  color: "0xEFEFEF"
                  width: "1"
        - type: scrollView
          style:
            display: ..formData.display.recommendationNotification
            marginLeft: "0.04"
            width: "0.92"
            height: "0.640394"
            boxSizing: border-box
            overflow: scroll
            paddingBottom: "0.0123"
          children:
            # email content
            - type: view
              style:
                ..style.emailContentBox:
              children:
                - type: label
                  text: Hello,
                  dataKey:
                  style:
                - type: view
                  style:
                    marginTop: "0.0246"
                  children:
                    - type: label
                      textBoard:
                        - text: "There is the recommendation by&nbsp;"
                        - text: "{ provide name }"
                          dataKey: Global.inbox..sentEmail.name.data.providerName
                          ..style.provideName:
                        - text: "."
                      dataKey:
                      style:
                - type: label
                  text: Please check the appointment details and the recommendations follow.
                  dataKey:
                  style:
            # Dividing lines
            - type: view
              style:
                ..style.dividingLine:
              children:
                - type: label
                  text: "………………"
                  dataKey:
                  style:
                    ..style.line:
                - type: label
                  text: "&nbsp;&nbsp;Original Appointment&nbsp;&nbsp;"
                  dataKey:
                  style:
                    ..style.lineTips:
                - type: label
                  text: "………………"
                  dataKey:
                  style:
                    ..style.line:
            # medical recommendation
            - type: view
              style:
                ..style.recommendationBox:
              children:
                - type: label
                  text: Medical Recommendation
                  dataKey:
                  style:
                    ..style.recommendationStyle:
                - type: view
                  style:
                    ..style.enterBtnBox:
                  onClick:
                    - ..event.enterRecommendationClick
                  children:
                    - type: label
                      text: Enter
                      dataKey:
                      style:
                        ..style.enterBtn:
                    - type: image
                      path: rightEnter.svg
                      style:
                        ..style.arrowRightImg:
                # Appointment info
            - type: view
              style:
                ..style.recommendationBox:
                borderRadius: "4px 4px 0 0"
                borderBottom: "2px solid #dededf"
              children:
                - type: view
                  style:
                  children:
                    - type: label
                      text: Appointment info
                      dataKey:
                      style:
                        ..style.recommendationStyle:
                    - type: view
                      style:
                        ..style.enterBtnBox:
                      onClick:
                        - ..event.enterAppointmentClick
                      children:
                        - type: label
                          text: Enter
                          dataKey:
                          style:
                            ..style.enterBtn:
                        - type: image
                          path: rightEnter.svg
                          style:
                            ..style.arrowRightImg:
            # Appointment info label
            - type: view
              style:
                ..style.appointmentInfoLabelBox:
              children:
                # date
                - type: view
                  style:
                  children:
                    - type: label
                      text: Date
                      dataKey:
                      style:
                        ..style.appointmentInfoLabelTitle:
                    - type: label
                      text=func: .builtIn.string.formatUnixtimeL_en
                      dataKey: Global.roomInfo.edge.stime
                      style:
                        ..style.appointmentInfoLabelContent:
                # time
                - type: view
                  style:
                    marginTop: "0.0073"
                  children:
                    - type: label
                      text: Time
                      dataKey:
                      style:
                        ..style.appointmentInfoLabelTitle:
                    - type: label
                      text=func: .builtIn.date.ShowTimeSpan
                      dataKey: Global.roomInfo.edge
                      style:
                        ..style.appointmentInfoLabelContent:
                #  reason for visit
                - type: view
                  style:
                    marginTop: "0.0073"
                  children:
                    - type: label
                      text: Reason For Vistit
                      dataKey:
                      style:
                        ..style.appointmentInfoLabelTitle:
                    - type: label
                      dataKey: Global.roomInfo.edge.name.Reason
                      style:
                        ..style.appointmentInfoLabelContent:
                # appointment type
                - type: view
                  style:
                    marginTop: "0.0073"
                  children:
                    - type: label
                      text: Appointment Type
                      dataKey:
                      style:
                        ..style.appointmentInfoLabelTitle:
                    - type: label
                      dataKey: Global.roomInfo.edge.name.visitType
                      style:
                        ..style.appointmentInfoLabelContent:
                # patient
                - type: view
                  style:
                    marginTop: "0.0073"
                  children:
                    - type: label
                      text: Patient
                      dataKey:
                      style:
                        ..style.appointmentInfoLabelTitle:
                    - type: label
                      dataKey: Global.roomInfo.edge.name.patientName
                      style:
                        ..style.appointmentInfoLabelContent:
                # facility
                - type: view
                  style:
                    marginTop: "0.0073"
                  children:
                    - type: label
                      text: Facility
                      dataKey:
                      style:
                        ..style.appointmentInfoLabelTitle:
                    - type: label
                      dataKey: Global.roomInfo.edge.name.locationName
                      style:
                        ..style.appointmentInfoLabelContent:
        # 附件
        - type: scrollView
          style: 
            top: "0.57"
            width: "1"
            height: "0.22"
          children:
            - type: list
              contentType: listObject
              listObject: ..apiRequest.attachment.docQueryResp.doc
              iteratorVar: itemObject
              style:
                left: "0"
                top: "0.01"
                width: "1"
                height: "auto"
                backgroundColor: "0xffffff"
              children:
                - type: listItem
                  itemObject: ""
                  onClick:
                    - actionType: updateObject
                      dataKey: Global.showAttachment
                      dataObject: itemObject
                    - goto: ShowAttachment
                  style:
                    marginTop: "0.001"
                    left: "0"
                    width: "1"
                    height: "0.055"
                  children:
                    - type: view
                      style:
                        top: "0.001"
                        left: "0.05"
                        width: "0.9"
                        height: "0.05"
                        backgroundColor: "0xf8f9fa"
                        borderWidth: "1"
                        borderRadius: "10"
                        border:
                          style: "1"
                      children:
                        - type: image
                          path: blackAttachment.svg
                          style:
                            top: "0.01"
                            height: "0.03"
                            left: "0.03"
                        - type: label
                          dataKey: itemObject.name.title #需要加name.type
                          style:
                            top: "0.01"
                            height: "0.03"
                            width: "0.45"
                            left: "0.13"
                            overflow: hidden
                            text-overflow: ellipsis
                            whiteSpace: nowrap
                            fontSize: .Nfont.h2
                        - type: label
                          text=func: .builtIn.string.bitFormatting
                          dataKey: itemObject.size
                          style:
                            top: "0.01"
                            height: "0.03"
                            width: "0.3"
                            left: "0.72"
                            fontSize: .Nfont.h2
                            textAlign:
                              x: right
                            color: "0xbcc5d3"
    - type: view
      style:
        top: "0.9"
        width: "1"
        height: "0.1"
        boxShadow: "1px 1px 4px 1px #dededf"
        backgroundColor: "#ffffff"
      children:
        - type: image
          path: trash.svg
          onClick:
            - actionType: popUp
              popUpView: simplePopup
          style:
            left: "0.67"
            top: "0.03"
            height: "0.04"
    - type: popUp
      message: "Are you sure you want to delete the message?"
      viewTag: simplePopup
      style:
        width: "1"
        height: "1"
        top: "0"
        left: "0"
        backgroundColor: "0x00000033"
        zIndex: "1000"
      children:
        - .simplePopupView:
          children:
            - .simplePopupLable:
            - .simplePopupSplit1:
            - .simplePopupSplit2:
            - .simplePopupLeftButton:
            - .simplePopupRightButton:
              onClick:
                - actionType: evalObject
                  object:
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - =..apiRequest.emailTag.docAPI.get: ""
                    - ..apiRequest.emailTag.docCreateReq@: =..apiRequest.emailTag.docQueryResp.doc.0
                    - =.builtIn.number.inhx:
                        dataIn:
                          intHex: =..apiRequest.emailTag.docCreateReq.type
                          index: 4
                          hex: 1
                        dataOut: SentMessage.apiRequest.emailTag.docCreateReq.type
                    - =..apiRequest.emailTag.docAPI.store: ""
                - actionType: popUpDismiss
                  popUpView: simplePopup
                - actionType: popUp
                  popUpView: deleteTruePopUp
                - goto: Sent
    - .BaseMessageWarnPopup:
      viewTag: deleteTruePopUp
      message: Delete Successful!
      imagePath: deleteTrue.svg
  event:
    enterRecommendationClick:
      - actionType: evalObject
        object:
          # 控制是否显示MedicalRecommendation下detail入口
          - .Global.formData.medicalStatus@: false
          - ..apiRequest.medicalRecommendation.docQueryReq.id@: =..apiRequest.appointment.edgeQueryResp.edge.0.id
          - =..apiRequest.medicalRecommendation.docAPI.get: ""
          - .Global.Note@: =..apiRequest.medicalRecommendation.docQueryResp.doc.0
          - goto: MedicalRecommendation
    enterAppointmentClick:
      - actionType: evalObject
        object:
          - if:
            - =.builtIn.number.typeIsValid:
                dataIn:
                  docType: =.Global.roomInfo.edge.subtype
                  localArr: [17]
                  binaryArr: [1]
            - goto: AppointmentLobby
            - goto: AppointmentLobbyOfficeVisit
  style:
    emailContentBox:
      marginTop: "0.014778"
      color: "#333333"
      lineHeight: "2.58vh"
    provideName:
      display: "inline-block"
      marginLeft: "0.01"
      color: "#2988e6"
    dividingLine:
      display: "inline-block"
      width: "0.92"
      marginTop: "0.0874"
      textAlign:
        x: center
    lineTips:
      display: "inline-block"
      fontSize: .Nfont.h12
      color: "#666666"
    line:
      display: "inline-block"
      fontSize: .Nfont.h14
      lineHeight: "1.10837vh"
      color: "#666666"
    recommendationBox:
      fontWeight: 600
      backgroundColor: "#f4f4f4"
      borderRadius: "4"
      paddingTop: "0.0123"
      paddingBottom: "0.0123"
      paddingLeft: "0.04"
      paddingRight: "0.026666"
      marginTop: "0.024630"
      boxSizing: "border-box"
    recommendationStyle:
      display: "inline-block"
      width: "0.70"
      color: "#333333"
      whiteSpace: "nowrap"
      overflow: hidden
      text-overflow: "ellipsis"
    enterBtnBox:
      display: "inline-block"
      width: "0.152"
      textAlign:
        x: right
    enterBtn:
      color: "#2988e6"
      display: "inline-block"
      textDecoration: underline
    arrowRightImg:
      width: "0.0426"
      height: "0.0197"
      verticalAlign: middle
    appointmentInfoLabelBox:
      backgroundColor: "#f4f4f4"
      borderRadius: "0 0 4px 4px"
      paddingTop: "0.0172"
      paddingBottom: "0.0246"
      paddingLeft: "0.04"
      paddingRight: "0.04"
      boxSizing: "border-box"
    appointmentInfoLabelTitle:
      display: "inline-block"
      width: "0.338666"
      color: "#333333"
      fontWeight: 600
      whiteSpace: "nowrap"
      overflow: hidden
      text-overflow: "ellipsis"
    appointmentInfoLabelContent:
      display: "inline-block"
      width: "0.5"
      color: "#333333"
      wordBreak: break-word
      textAlign:
        x: right