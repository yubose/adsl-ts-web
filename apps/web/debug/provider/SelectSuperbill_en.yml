SelectSuperbill:
  title: Superbill
  pageNumber:
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        - actionType: evalObject
          async: true
          object:
            #获取所有的 folder
            - =..apiRequest.codeFolder.docAPI.get: ""
            #获取所有的 code
            - =..apiRequest.codeAllList.docAPI.get: ""

    #NOTE: 初始化的时候先不获取，然后根据点击的进行获取
    # - ..apiRequest.codeList.docAPI.get
    # 判断是不是已经选了
    - if:
        - =.Global.formData.providerDoc.superbillDoc.id
        - actionType: evalObject
          object:
            - ..formData.selectedList@: =.Global.formData.providerDoc.superbillDoc.name.data.procedureCodeList
        - continue
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =..formData.selectedList
              len: 0
        - ..formData.btnColor@: "#c1c1c1"
        - ..formData.btnColor@: "#2988e6"
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.formData.unPageName
              string2: "MenuBars"
        - actionType: evalObject
          object:
            - ..formData.displayFlag@: "none"
            - ..formData.imageFlag@: "none"
            - ..formData.scrollHeight@: "0.94"
        - continue
    # 格式化文件夹
    - =.builtIn.array.formatFolder:
        dataIn:
          parentFiles: =..apiRequest.codeFolder.resp.doc
        dataOut: SelectSuperbill.formData.formatFolder
    - ..formData.folderList@: =..formData.formatFolder
    #- =.builtIn.array.folderMatching:
    #    dataIn:
    #      parentFiles: =..apiRequest.codeFolder.resp.doc
    #      childFiles: =..apiRequest.codeList.resp.doc
    #    dataOut: SelectSuperbill.formData.folderList
  formData:
    displayFlag: "block"
    imageFlag: "inline-block"
    scrollHeight: "0.84729064"
    tempDataList: []
    currentProcedureName: ""
    selectData: ""
    selectedList: []
    btnColor: "#c1c1c1"
    currentCode: ""
    folderList: []
    currentFolderList: []
    currentFolderId: ""
    formatFolder: []
    open: true
    searchContent: ""
    searchResultShow: "none"
    codeListShow: "block"
    emptyFlag: "none"
  formDataTemp:

    # tabTemp:
    #   - title: Provider
    #     fontColor: "0x2988e6"
    #     fontWeight: "500"
    #     block: "block"
    #   - title: Medical Facilities
    #     fontColor: "0x4b4b4b"
    #     fontWeight: "400"
    #     block: "none"
  apiRequest:
    # 获取所有的 folder
    codeFolder:
      resp: ""
      folderInfo:
        # 当前facility的id
        id: .Global.currentFacility.id
        xfname: "ovid"
        type: .DocType.ProcedureCategory
        maxcount: 20
      docAPI:
        get:
          api: rd
          dataIn: apiRequest.codeFolder.folderInfo
          dataOut: SelectSuperbill.apiRequest.codeFolder.resp
    codeList:
      resp: ""
      folderInfo:
        # 当前facility的id
        ids:
          - .Global.currentFacility.id
          - =..formData.currentFolderId
        xfname: "ovid,reid"
        sCondition: .DocType.procedureCode
        maxcount: "500"
      docAPI:
        get:
          api: rd
          dataIn: apiRequest.codeList.folderInfo
          dataOut: SelectSuperbill.apiRequest.codeList.resp

    codeAllList:
      resp: ""
      folderInfo:
        # 当前facility的id
        id: .Global.currentFacility.id
        xfname: "ovid"
        sCondition: .DocType.procedureCode
      docAPI:
        get:
          api: rd
          dataIn: SelectSuperbill.apiRequest.codeAllList.folderInfo
          dataOut: SelectSuperbill.apiRequest.codeAllList.resp

  components:
    - .BasePublicHeader:
        children:
          - .BasePublicHeaderLeft:
            leftClick:
              - actionType: evalObject
                object:
                  - if:
                      - =.builtIn.string.equal:
                          dataIn:
                            string1: =.Global.formData.backPage
                            string2: "ChargeEntry"
                      - goto: =.Global.formData.backPage
                      - actionType: builtIn
                        funcName: goBack
                        reload: true
          - .BasePublicHeaderTitle:

    - type: scrollView
      style:
        ..style.scrollBox:
        height: ..formData.scrollHeight
      children:
        - type: view
          style:
            ..style.searchBox:
          children:
            - type: view
              style:
                boxSizing: border-box
                border: "1.5px solid #2988e6"
                paddingLeft: "0.032"
                paddingRight: "0.032"
                width: "0.7813333"
                borderRadius: "4"
                display: "inline-block"
                verticalAlign: middle
              children:
                - type: image
                  path: searchGray.svg
                  style:
                    ..style.searchImg:
                - type: textField
                  viewTag: searchInputTag
                  placeholder: Search
                  dataKey: formData.searchContent
                  style:
                    ..style.searchInput:
                  onInput:
                    - ..event.searchInput
            - type: label
              text: Revise
              style:
                ..style.searchLabel:
              onClick:
                - ..event.reviseChange

        - type: scrollView
          viewTag: searchTag
          style:
            display: ..formData.searchResultShow
            marginLeft: "0.04"
            width: "0.92"
            height: "0.7684729"
            paddingBottom: "0.0160098"
          children:
            - type: list
              viewTag: searchListTag
              contentType: listObject
              listObject: ..formData.searchList
              iteratorVar: itemObject
              style:
                width: "0.92"
                margin: "0"
                height: auto
              children:
                - type: listItem
                  viewTag: itemViewTag
                  itemObject:
                  style:
                    ..style.secondListItem:
                  children:
                    - type: view
                      style:
                        ..style.auto:
                        display: inline-block
                      children:
                        - type: image
                          path:
                            ..event.checkBoxPath:
                          style:
                            ..style.checkBoxImg:
                            display: ..formData.imageFlag
                          onClick:
                            - ..event.checkBoxClick
                    - type: label
                      textBoard:
                        - text: ""
                          dataKey: itemObject.code
                        - text: "&nbsp;&nbsp;&nbsp;&nbsp;"
                        - text: ""
                          dataKey: itemObject.description
                      style:
                        ..style.checkBoxValue:
                        paddingRight: "0.04"
                        boxSizing: border-box

        - type: scrollView
          viewTag: codeListTag
          style:
            display: ..formData.codeListShow
            height: "0.7684729"
            paddingBottom: "0.0160098"
            overflow: scroll
          children:
            - type: list
              viewTag: selectFacilityListTag
              contentType: listObject
              listObject: ..formData.folderList
              iteratorVar: itemObject
              style:
                ..style.firstList:
                marginTop: "0.0098517"
                overflow: hidden
              children:
                - type: listItem
                  itemObject:
                  style:
                    ..style.firstListItem:
                  children:
                    - type: view
                      viewTag: selectDataTag
                      style:
                        ..style.selectBox:
                      onClick:
                        - ..event.selectClick
                      children:
                        - type: label
                          text: Select
                          dataKey: itemObject.category
                          style:
                            ..style.selectLabel:
                        - type: image
                          path:
                            ..event.selectPath:
                          style:
                            ..style.selectImg:

                    - type: scrollView
                      style:
                        ..style.secondScrollView:
                        display: itemObject.displayStyle
                      children:
                        - type: list
                          viewTag: selectViewTag
                          contentType: listObject
                          listObject: itemObject.secondList
                          iteratorVar: itemObject
                          style:
                            ..style.secondList:
                          children:
                            - type: listItem
                              itemObject:
                              viewTag: itemViewTag
                              style:
                                ..style.secondListItem:
                              children:
                                - type: view
                                  style:
                                    ..style.auto:
                                    display: inline-block
                                  children:
                                    - type: image
                                      path:
                                        ..event.checkBoxPath:
                                      style:
                                        ..style.checkBoxImg:
                                        display: ..formData.imageFlag
                                      onClick:
                                        - ..event.checkBoxClick
                                - type: label
                                  textBoard:
                                    - text: ""
                                      dataKey: itemObject.code
                                    - text: "&nbsp;&nbsp;&nbsp;&nbsp;"
                                    - text: ""
                                      dataKey: itemObject.description
                                  style:
                                    ..style.checkBoxValue:

        # 无检索结果
        - type: view
          viewTag: emptyCodeTag
          style:
            display: ..formData.emptyFlag
            marginTop: "0.262315"
            width: "1"
            textAlign:
              x: center
          children:
            - type: image
              path: noCode.svg
              style:
                width: "0.586666"
                margin: auto

    - type: view
      style:
        ..style.btnBox:
        display: ..formData.displayFlag
      children:
        - type: button
          text: Continue
          viewTag: btnTag
          style:
            ..style.btn:
            backgroundColor: ..formData.btnColor
          onClick:
            - ..event.btnClick
    # 弹窗区域
    - .BaseWarningView:
      message: Please select code(s) to continue.
      viewTag: WarningTag
  event:
    tabSwitch:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - =.builtIn.object.setProperty:
                dataIn:
                  obj: =..formDataTemp.tabTemp
                  label: "title"
                  text: $var.title
                  arr: ["fontColor", "fontWeight", "block"]
                  valueArr: ["0x2988e6", "500", "block"]
                  errorArr: ["0x4b4b4b", "400", "none"]
      - actionType: builtIn
        funcName: redraw
        viewTag: tabTag
      - actionType: builtIn
        funcName: redraw
        viewTag: selectProviderListTag
      - actionType: builtIn
        funcName: redraw
        viewTag: selectFacilityListTag
    selectClick:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - ..formData.currentProcedureName@: ""
            - ..formData.currentProcedureName@: $var.hashCode
            - ..formData.folderList@: []
            - ..formData.folderList@: =..formData.formatFolder
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: $var.displayStyle
                      string2: "none"
                - =.builtIn.object.setProperty:
                    dataIn:
                      obj: =..formData.folderList
                      label: "hashCode"
                      text: $var.hashCode
                      arr: ["displayStyle"]
                      valueArr: ["block"]
                      errorArr: ["none"]
                - =.builtIn.object.setProperty:
                    dataIn:
                      obj: =..formData.folderList
                      label: "hashCode"
                      text: $var.hashCode
                      arr: ["displayStyle"]
                      valueArr: ["none"]
                      errorArr: ["none"]
            #NOTE: 如果是开启就获取，如果是关闭就不动
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: $var.displayStyle
                      string2: "none"
                - ..formData.open@: true
                - ..formData.open@: false
            - ..formData.currentFolderId@: $var.id
      - actionType: evalObject
        object:
          #获取当前folder下面的code
          - if:
              - =..formData.open
              - actionType: evalObject
                object:
                  - =..apiRequest.codeList.docAPI.get: ""
                  # 根据当前folder的id进行匹配
                  - =.builtIn.array.folderMatching:
                      dataIn:
                        folderId: =..formData.currentFolderId
                        data: =..apiRequest.codeList.resp.doc
                        formatedFolderList: =..formData.folderList
                      dataOut: SelectSuperbill.formData.folderList
              - continue
      - actionType: builtIn
        funcName: redraw
        viewTag: selectFacilityListTag

    selectPath:
      emit:
        dataKey:
          var: itemObject
        actions:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: $var.displayStyle
                    string2: "none"
              - selectDown.svg
              - selectUp.svg
    checkBoxPath:
      emit:
        dataKey:
          var: itemObject
        actions:
          - if:
              - =.builtIn.array.containingValue:
                  dataIn:
                    object: =..formData.selectedList
                    key: hashCode
                    value: $var.hashCode
              - selectOnBlue.svg
              - selectOffBlue.svg
    checkBoxClick:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - if:
                - =.builtIn.array.containingValue:
                    dataIn:
                      object: =..formData.selectedList
                      key: hashCode
                      value: $var.hashCode
                - =.builtIn.array.removeObjectByValue:
                    dataIn:
                      object: =..formData.selectedList
                      values: hashCode
                      value: $var.hashCode
                - =.builtIn.array.push:
                    dataIn:
                      messages: =..formData.selectedList
                      newMessage: $var
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.array.judgeListLength:
                  dataIn:
                    array: =..formData.selectedList
                    len: 0
              - ..formData.btnColor@: "#c1c1c1"
              - ..formData.btnColor@: "#2988e6"
      - actionType: builtIn
        funcName: redrawCurrent
        viewTag: itemViewTag
      - actionType: builtIn
        funcName: redraw
        viewTag: btnTag
    btnClick:
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.array.judgeListLength:
                  dataIn:
                    array: =..formData.selectedList
                    len: 0
              - actionType: popUp
                popUpView: WarningTag
                wait: true
                popUpDismiss: 2000
              - continue
      - actionType: evalObject
        object:
          - if:
              - =.Global.formData.providerDoc.superbillDoc.id
              - actionType: evalObject
                object:
                  - .Global.formData.providerDoc.superbillDoc.name.data.procedureCodeList@: =..formData.selectedList
              - .Global.currentFolder@: =..formData.selectedList
      - goto: ChargeEntry

    searchCheckBoxPath:
      emit:
        dataKey:
          var: itemObject
        actions:
          - if:
              - =.builtIn.array.containingValue:
                  dataIn:
                    object: =..formData.selectedList
                    key: hashCode
                    value: $var.name.data.hashCode
              - selectOnBlue.svg
              - selectOffBlue.svg

    searchCheckBoxClick:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - if:
                - =.builtIn.array.containingValue:
                    dataIn:
                      object: =..formData.selectedList
                      key: hashCode
                      value: $var.name.data.hashCode
                - =.builtIn.array.removeObjectByValue:
                    dataIn:
                      object: =..formData.selectedList
                      values: hashCode
                      value: $var.name.data.hashCode
                - =.builtIn.array.push:
                    dataIn:
                      messages: =..formData.selectedList
                      newMessage: $var
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.array.judgeListLength:
                  dataIn:
                    array: =..formData.selectedList
                    len: 0
              - ..formData.btnColor@: "#c1c1c1"
              - ..formData.btnColor@: "#2988e6"
      - actionType: builtIn
        funcName: redrawCurrent
        viewTag: itemViewTag
      - actionType: builtIn
        funcName: redraw
        viewTag: btnTag
      - actionType: builtIn
        funcName: redraw
        viewTag: searchListTag
    searchInput:
      - actionType: evalObject
        object:
          - =.builtIn.array.getDataByPath:
              dataIn:
                objArr: =..apiRequest.codeAllList.resp.doc
                path: "name.data"
              dataOut: SelectSuperbill.formData.tempDataList
      - actionType: evalObject
        object:
          - =.builtIn.object.matchSearchValue:
              dataIn:
                objArr: =..formData.tempDataList
                paths:
                  - code
                  - description
                value: =..formData.searchContent
              dataOut: SelectSuperbill.formData.searchList
          - =.builtIn.array.uniqueByObjectKey:
              dataIn:
                objArr: =..formData.searchList
                path: "hashCode"
              dataOut: SelectSuperbill.formData.searchList
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..formData.searchContent
                    string2: ""
              - actionType: evalObject
                object:
                  - ..formData.searchResultShow@: "none"
                  - ..formData.codeListShow@: "block"
                  - ..formData.emptyFlag@: "none"
              - actionType: evalObject
                object:
                  - if:
                      - =.builtIn.array.judgeListLength:
                          dataIn:
                            array: =..formData.searchList
                            len: 0
                      - actionType: evalObject
                        object:
                          - ..formData.searchResultShow@: "none"
                          - ..formData.codeListShow@: "none"
                          - ..formData.emptyFlag@: "block"
                      - actionType: evalObject
                        object:
                          - ..formData.searchResultShow@: "block"
                          - ..formData.codeListShow@: "none"
                          - ..formData.emptyFlag@: "none"
      - actionType: builtIn
        funcName: redraw
        viewTag: searchTag
      - actionType: builtIn
        funcName: redraw
        viewTag: codeListTag
      - actionType: builtIn
        funcName: redraw
        viewTag: emptyCodeTag
    reviseChange:
      - actionType: evalObject
        object:
          - ..formData.searchContent@: ""
          - ..formData.searchResultShow@: "none"
          - ..formData.codeListShow@: "block"
      - actionType: builtIn
        funcName: redraw
        viewTag: searchTag
      - actionType: builtIn
        funcName: redraw
        viewTag: codeListTag
      - actionType: builtIn
        funcName: redraw
        viewTag: searchInputTag
  style:
    auto:
      width: auto
      height: auto
    tabBox:
      height: "auto"
      width: "1"
      overflow: hidden
    tabList:
      width: "1"
      margin: "0"
      axis: horizontal
      height: "auto"
      overflow: hidden
      marginTop: "0.02"
    tabListItem:
      width: "0.5"
      height: "auto"
    tabListTitle:
      color: itemObject.fontColor
      height: "auto"
      width: "0.5"
      fontWeight: itemObject.fontWeight
      textAlign:
        x: center
      fontSize: .Nfont.h16
    tabListLine:
      marginTop: "0.005"
      height: "0.0025" #2.03px
      width: "0.5"
      backgroundColor: "0xdededf"
    tabBar:
      display: itemObject.block
      top: "0.031"
      left: "0.2"
      width: "0.08"
      height: "0.0025"
      backgroundColor: "0x2988e6"
      zIndex: 10
    scrollBox:
      width: "1"
      # height: "0.84729064"
      boxSizing: "border-box"
      overflow: "scroll"
    btnBox:
      width: "1"
      height: "0.0972"
      boxSizing: "border-box"
      overflow: "scroll"
      backgroundColor: "#ffffff"
      boxShadow: "1px 1px 4px 1px #dededf"
      textAlign:
        x: center
    btn:
      marginTop: "0.0123"
      height: "0.0443"
      width: "0.84"
      border:
        style: 1
      borderRadius: "5"
      # backgroundColor: "#2988e6"
      color: "#ffffff"
      fontSize: .Nfont.h14
      boxSizing: border-box
      fontWeight: "600"
      textAlign:
        x: center
    selectBox:
      marginTop: "0.01"
      marginLeft: "0.04"
      width: "0.92"
      height: "0.036945"
      border:
        style: 3
        width: "1.5px"
      borderRadius: "3"
      boxSizing: "border-box"
      borderColor: "#dededf"

      backgroundColor: "0xffffff"
      overflow: hidden
    selectLabel:
      marginLeft: "0.032"
      display: "inline-block"
      width: "0.8"
      height: "auto"
      lineHeight: "3.6945vh"
      fontSize: .Nfont.h14
      color: "#333333"
      boxSizing: "border-box"
      verticalAlign: middle
    selectImg:
      display: "inline-block"
      height: "0.029556"
      width: "0.064"
      verticalAlign: middle
    firstList:
      width: "1"
      margin: "0"
      height: auto
    firstListItem:
      width: "1"
      height: "auto"
      marginTop: "0.0147783"
    secondScrollView:
      width: "0.92"
      height: "auto"
      maxHeight: "1"
      margin: "0"
      marginLeft: "0.04"
      paddingBottom: "0.0160098"
      borderRadius: "4"
      boxSizing: "border-box"
      backgroundColor: "#ffffff"
    secondList:
      width: "0.92"
      margin: "0"
      height: "auto"
    secondListItem:
      width: "0.92"
      height: "auto"
      marginTop: "0.0160098"
      border:
        style: 1
      boxSizing: "border-box"
      overflow: hidden
    checkBoxImg:
      height: "0.0197044"
      width: "0.0426666"
      marginLeft: "0.032"
      display: "inline-block"
      verticalAlign: top
    checkBoxValue:
      marginLeft: "0.032"
      display: "inline-block"
      width: "0.8106666"
      height: "auto"
      wordBreak: break-word
      fontSize: .Nfont.h14
      verticalAlign: top
    searchBox:
      marginLeft: "0.04"
      marginTop: "0.0197044"
      boxSizing: border-box

      width: "0.92"
    searchImg:
      height: "0.0160098"
      width: "0.0346666"
      display: "inline-block"
      verticalAlign: middle
    searchInput:
      border: "none"
      display: "inline-block"
      verticalAlign: middle
      paddingLeft: "0.032"
      height: "0.036945"
      boxSizing: "border-box"
      width: "0.653333"
    searchLabel:
      color: "#2988e6"
      display: "inline-block"
      fontSize: .Nfont.h14
      verticalAlign: middle
      fontWeight: "600"
      textDecoration: underline
      width: "0.1386666"
      textAlign:
        x: right
