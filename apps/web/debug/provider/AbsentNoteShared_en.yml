AbsentNoteShared:
  title: Absence / Excuse Note
  # pageNumber: "184"
  init:
    - .SignInCheck
    - =.builtIn.date.currentDateTime:
        dataIn:
        dataOut: Global.formData.auditLog.startTime
    # 记录下载行为
    - .Global.formData.auditLog.actionTypeCode@: =.ActionTypeCode.download
    - .Global.formData.auditLog.recordTypeCode@: =.DocType.AbsentNote

    - ..formData@: =.Global.Note
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""

    # 判断是否私有只读
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.Note.tage
              string2: 1
        - actionType: evalObject
          object:
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =.Global.Note.name.data.classTag.name
                      string2: "Admin"
                - actionType: evalObject
                  object:
                    # 显示重置滚动条高度按钮
                    - ..formDataTemp.scrollHeight@: "0.945"
                    # 显示分享按钮
                    - ..formDataTemp.displayBtn@: "none"
                - actionType: evalObject
                  object:
                    # 取回当前文档信息
                    - ..apiRequest.absentNote.docReq@: =.Global.Note
                    # 显示重置滚动条高度按钮
                    - ..formDataTemp.scrollHeight@: "0.84729"
                    # 显示分享按钮
                    - ..formDataTemp.displayBtn@: "block"
        - actionType: evalObject
          object:
            # 显示重置滚动条高度按钮
            - ..formDataTemp.scrollHeight@: "0.945"
            # 显示分享按钮
            - ..formDataTemp.displayBtn@: "none"

    - actionType: evalObject
      object:
        - if:
            # 根据Liz要求，所有release后的，不管是否让patient看，都可以下载pdf
            - =.builtIn.number.typeIsValid:
                dataIn:
                  docType: =.Global.Note.type
                  localArr: [1]
                  binaryArr: [1]
            - continue
            - ..formDataTemp.downFlag@: "none"
        # 下载pdf的样式控制
        - .Global.formData.downloadPDF.titleName@: "Absence / Excuse Note"
        - .Global.formData.downloadPDF.scaleX@: 0.78
        - .Global.formData.downloadPDF.scaleY@: 0.78
        - .Global.formData.downloadPDF.originX@: 0
        - .Global.formData.downloadPDF.originY@: 0

    # 判断签名是否存在
    - actionType: evalObject
      object:
        - if:
            - =.AbsentNoteShared.formData.name.data.signatureId
            - ..formData.displaySign@: "block"
            - ..formData.displaySign@: "none"

  formData:
    # 控制签名是否显示
    displaySign: "none"

  formDataTemp:
    downFlag: "inline-block"
    # 控制当前滚动条高度
    scrollHeight: "0.84729"
    # 是否显示分享按钮
    displayBtn: "none"
    place:
      - key: place
        value: school
      - key: place
        value: work
      - key: place
        value: other
    reason:
      - key: reason
        value: injury
      - key: reason
        value: illness
      - key: reason
        value: other
  apiRequest:
    absentNote:
      docRes: ""
      docReq: ""
      docAPI:
        .DocAPI: ""
        store:
          api: cd
          dataIn: AbsentNoteShared.apiRequest.absentNote.docReq
          dataOut: AbsentNoteShared.apiRequest.absentNote.docRes
  components:
    - .BasePublicHeader:
      children:
        - .BasePublicHeaderLeft:
          leftClick:
            - actionType: evalObject
              object:
                - =.builtIn.utils.createAuditLog:
                    dataIn:
                      date: =.Global.formData.auditLog.startTime
                      actionTypeCode: .ActionTypeCode.view
                      recordTypeCode: .DocType.AbsentNote
                      eid: =.Global.formData.currentFacility.relationEdge.id
                      user: =.Global.MyProfile.name.data.fullName
                      userId: =.Global.currentUser.vertex.id
                      targetUserId: =.Global.formData.auditLog.patientId
                      targetUser: =.Global.formData.auditLog.patientName
                      accessPort: provider
                    dataOut: Global.formData.auditLog.result
            - actionType: builtIn
              funcName: goBack
              reload: true
        - .BasePublicHeaderTitle:
        - .BasePublicHeaderMenu:
          style:
            display: ..formDataTemp.downFlag
    - type: scrollView
      viewTag: mainView
      style:
        ..style.scrollBox:
        height: ..formDataTemp.scrollHeight
      children:
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.0246"
            height: "auto"
            width: "0.92"
          children:
            - type: image
              path: office-building.svg
              path=func: .builtIn.utils.prepareDocToPath
              dataKey: formData.name.data.facilityInfo.facilityAvatarID
              style:
                verticalAlign: middle
                display: "inline-block"
                height: "0.0578"
                width: "5.78vh"
            - type: view
              style:
                verticalAlign: middle
                marginLeft: "0.08"
                display: "inline-block"
                height: "auto"
                width: "0.71"
                overflow: hidden
              children:
                - type: label
                  dataKey: formData.name.data.facilityInfo.facilityName
                  style:
                    width: "0.71"
                    height: "auto"
                    fontSize: .Nfont.h20
                    fontWeight: "600"

                    verticalAlign: middle
                    wordWrap: break-word

                - type: label
                  dataKey: formData.name.data.facilityInfo.location
                  style:
                    marginTop: "0.0110"
                    width: "0.71"
                    height: "auto"
                    fontSize: .Nfont.h14
                    color: "0x666666"

                    verticalAlign: middle
                    wordWrap: break-word

        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.00738"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: Email
                - .DocPublicStyleOneRight:
                  dataKey: formData.name.data.facilityInfo.email
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: Website
                - .DocPublicStyleOneRight:
                  dataKey: formData.name.data.facilityInfo.website
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Main #"
                - .DocPublicStyleOneRight:
                  dataKey: formData.name.data.facilityInfo.phoneNumber
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Fax #"
                - .DocPublicStyleOneRight:
                  dataKey: formData.name.data.facilityInfo.fax

        - .DocPublicLine:
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.00738"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Exam Date
                - .DocPublicStyleTwoRight:
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: formData.name.data.patientInfo.examDate
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Patient Name
                - .DocPublicStyleTwoRight:
                  dataKey: formData.name.data.patientInfo.name
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Date of Birth
                - .DocPublicStyleTwoRight:
                  dataKey: formData.name.data.patientInfo.dob
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Phone #"
                - .DocPublicStyleTwoRight:
                  dataKey: formData.name.data.patientInfo.phoneNumber
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Email"
                - .DocPublicStyleTwoRight:
                  dataKey: formData.name.data.patientInfo.email
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Patient Address"
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  dataKey: formData.name.data.patientInfo.address
                  style:
                    height: "auto"
                    width: "0.92"
                    fontSize: .Nfont.h14
                    wordWrap: break-word
                    color: "0x333333"
                    fontWeight: "600"
        - .DocPublicLine:
        - type: label
          text: "Leave Of Absence"
          dataKey:
          style:
            marginTop: "0.0222"
            marginLeft: "0.04"
            fontSize: .Nfont.h16
            width: "auto"

            fontWeight: "700"
        - type: view
          style:
            marginLeft: "0.04"
            width: "0.92"
            height: "0.037"
            marginTop: "0.021"
          children:
            - type: view
              style:
                width: "0.32"
                height: "0.037"
                display: "inline-block"
              children:
                - type: label
                  text: "Please Excuse"
                  dataKey:
                  style:
                    width: "0.32"
                    height: "0.037"
                    textAlign:
                      x: "left"
                      y: "center"
                    fontSize: .Nfont.h14

                    fontWeight: "600"
            - type: textField
              placeholder: "No content"
              dataKey: formData.name.data.name
              isEditable: "false"
              style:
                width: "0.6"
                height: "0.037"
                fontSize: .Nfont.h14

                textIndent: "12px"
                display: "inline-block"
                borderRadius: "4"
                boxSizing: "border-box"
                borderColor: "#dedede"
                backgroundColor: "0xf4f4f4"
                border:
                  style: 1
        - type: view
          style:
            marginLeft: "0.04"
            width: "0.92"
            height: "0.037"
            marginTop: "0.0148"
          children:
            - type: view
              style:
                width: "0.32"
                height: "0.037"
                display: "inline-block"
              children:
                - type: label
                  text: "As Of"
                  dataKey:
                  style:
                    width: "0.32"
                    height: "0.037"
                    textAlign:
                      x: "left"
                      y: "center"
                    fontSize: .Nfont.h14

                    fontWeight: "600"
            - type: view
              viewTag: dateTag
              style:
                width: "0.6"
                height: "auto"
                display: "inline-block"
                border:
                  style: 1
                borderRadius: "4"
                boxSizing: "border-box"
                borderColor: "#dedede"
                backgroundColor: "0xf4f4f4"
                overflow: hidden
              children:
                - type: textField
                  placeholder: "No content"
                  dataKey: formData.name.data.date
                  isEditable: "false"
                  style:
                    marginLeft: "0.032"
                    width: "0.506"
                    height: "0.037"
                    fontSize: .Nfont.h14

                    display: "inline-block"
                    boxSizing: "border-box"
                    border:
                      style: 1
                    verticalAlign: middle
                    backgroundColor: "0xf4f4f4"
                    color: "0x333333"
        - type: label
          text: "From"
          dataKey:
          style:
            marginLeft: "0.04"
            marginTop: "0.022"
            fontSize: .Nfont.h14

            width: "0.92"
            fontWeight: "600"
        - type: view
          style:
            marginTop: "0.0086"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
          children:
            - type: list
              viewTag: "radioViewOne"
              contentType: listObject
              androidGrid: true
              listObject: ..formDataTemp.place
              iteratorVar: itemObject
              style:
                width: "0.92"
                margin: "0"
                axis: horizontal
                height: "auto"
              children:
                - type: listItem
                  itemObject:
                  style:
                    width: "0.234"
                    height: "0.021"
                    display: "inline-block"
                  children:
                    - type: image
                      style:
                        display: "inline-block"
                        marginTop: "0"
                        verticalAlign: middle
                        height: "0.0197"
                      path:
                        emit:
                          dataKey:
                            var: itemObject
                          actions:
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..formData.name.data.place
                                      string2: $var.value
                                - radioOn.svg
                                - radioGray.svg
                    - type: label
                      text:
                      dataKey: itemObject.value
                      style:
                        marginLeft: "0.021"
                        marginTop: "0"
                        fontSize: .Nfont.h12

                        display: "inline-block"
                        verticalAlign: "middle"
        # 第二组单选框
        - type: label
          text: "Due To"
          dataKey:
          style:
            marginLeft: "0.04"
            marginTop: "0.022"
            fontSize: .Nfont.h14

            width: "0.92"
            fontWeight: "600"
        - type: view
          style:
            marginTop: "0.0086"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
          children:
            - type: list
              viewTag: "radioViewTwo"
              contentType: listObject
              listObject: ..formDataTemp.reason
              iteratorVar: itemObject
              style:
                width: "0.92"
                margin: "0"
                height: "auto"
                axis: horizontal
              children:
                - type: listItem
                  itemObject:
                  style:
                    width: "0.234"
                    height: "0.021"
                    display: "inline-block"
                  children:
                    - type: image
                      style:
                        display: "inline-block"
                        marginTop: "0"
                        verticalAlign: middle
                        height: "0.0197"
                      path:
                        emit:
                          dataKey:
                            var: itemObject
                          actions:
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..formData.name.data.reason
                                      string2: $var.value
                                - radioOn.svg
                                - radioGray.svg
                    - type: label
                      text:
                      dataKey: itemObject.value
                      style:
                        marginLeft: "0.021"
                        marginTop: "0"
                        fontSize: .Nfont.h12

                        display: "inline-block"
                        verticalAlign: "middle"

        # 纯文本:confidentiality Notice
        - type: label
          textBoard:
            - text: "Confidentiality Notice:"
              fontWeight: "600"
            - text: "&nbsp;"
            - text: "the documents accompanying
                this facsimile transmission contain confidential information
                belonging to the sender, which is privilege.the information
                is intended only for the use of the individual or entity
                below.if you are not the intended recipient, you are here
                by notified that any disclosure.copying distribution or the
                taking of any action in reliance of the contents of this
                telescoped information is strictly prohibited. if you have
                received this facsimile in error,please notify us immediately
                by telephone to arrange for the return of said documents."
          style:
            marginTop: "0.025"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"

            fontSize: .Nfont.h14
            wordBreak: break-word
          # Notes
        - type: label
          text: "Notes"
          dataKey:
          style:
            marginTop: "0.0222"
            fontSize: .Nfont.h14

            marginLeft: "0.04"
            width: "0.92"
            fontWeight: "600"
        # textView
        - type: label
          text: No content
          dataKey: formData.name.data.note
          style:
            marginLeft: "0.04"
            marginTop: "0.01"
            height: "auto"
            width: "0.92"
            boxSizing: border-box
            border:
              style: 1
            borderRadius: "4"
            fontSize: .Nfont.h14

            color: "0x333333"
            padding: "6px 12px"
            backgroundColor: "0xfafafa"
            wordWrap: break-word
        - .DocPublicLine:

        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.03"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - type: view
              style:
                height: "auto"
                width: "0.92"
              children:
                - type: label
                  text: "Signature"
                  style:
                    display: "inline-block"
                    width: "0.816"
                    fontSize: .Nfont.h14
                    height: "auto"
                    color: "0x333333"
                    fontWeight: "600"
                    textAlign:
                      x: left
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.01"
            height: "0.128"
            width: "0.9"
            border:
              style: "4"
              color: "0xa9a9a9"
            borderWidth: "2"
          children:
            - type: label
              text: X
              style:
                .SignLabelStyle:
            # 显示暂存的签名
            - type: image
              viewTag: signatureShowTag
              path=func: .builtIn.utils.prepareDocToPath
              # 传入签名文档的id
              dataKey: AbsentNoteShared.formData.name.data.signatureId
              style:
                left: "0"
                width: "0.88"
                top: "0"
                height: "0.128"
                overflow: scroll
                zIndex: "1000"
                display: ..formData.displaySign

        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.0146"
            width: "0.92"
            height: "auto"
            overflow: hidden
            display: ..formData.displaySign
          children:
            - type: view
              viewTag: signatureTimeTag
              style:
                display: ..formData.flag
                marginTop: "0.01"
                height: "auto"
                width: "0.92"
              children:
                - type: label
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: formData.name.data.signatureTime
                  style:
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    fontSize: .Nfont.h12
                    color: "0x757575"
                    verticalAlign: middle
                - type: label
                  text: "Digitally Signed"
                  dataKey:
                  style:
                    marginLeft: "0.02"
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    fontSize: .Nfont.h12
                    color: "0x757575"
                    verticalAlign: middle
            - type: view
              style:
                marginTop: "0.01"
                width: "auto"
                height: "auto"
              children:
                - type: label
                  text: Date
                  style:
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    color: "0x666666"
                    fontSize: .Nfont.h12
                - type: label
                  text=func: .builtIn.string.formatUnixtimeL_en
                  dataKey: formData.mtime
                  style:
                    marginLeft: "0.0373"
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    color: "0x333333"
                    fontSize: .Nfont.h12
                    fontWeight: "600"

        - type: view
          style:
            marginTop: "0.03"
    # - .HeaderPopUpDownload:
    - .HeaderPopUpMenu:

    - .SuccessfulOneLine:
      message: "Successfully"
      viewTag: successTag

    - type: view
      style:
        ..style.btnBox:
        display: ..formDataTemp.displayBtn
      children:
        - type: button
          text: Release
          style:
            ..style.btn:
          onClick:
            - ..event.btnClick

  event:
    btnClick:
      # 更新文档状态
      - actionType: evalObject
        object:
          - ..apiRequest.absentNote.docReq.name.data.statusTag.name@: Released
          - ..apiRequest.absentNote.docReq.name.data.statusTag.fontColor@: "0x2988e6"
          - ..apiRequest.absentNote.docReq.name.data.statusTag.backgroundColor@: "0xdfedfc"

      # 保存newNote
      - actionType: evalObject
        object:
          - ..apiRequest.absentNote.docReq.tage@: -1
          - =..apiRequest.absentNote.docAPI.store: ""

      - actionType: evalObject
        object:
          .Global._nonce@:
            =.builtIn.math.random: ""

      - actionType: evalObject
        object:
          - =.builtIn.utils.createAuditLog:
              dataIn:
                date: =.Global.formData.auditLog.startTime
                actionTypeCode: .ActionTypeCode.view
                recordTypeCode: .DocType.AbsentNote
                eid: =.Global.formData.currentFacility.relationEdge.id
                user: =.Global.MyProfile.name.data.fullName
                userId: =.Global.currentUser.vertex.id
                targetUserId: =.Global.formData.auditLog.patientId
                targetUser: =.Global.formData.auditLog.patientName
                accessPort: provider
              dataOut: Global.formData.auditLog.result

      - actionType: popUp
        popUpView: successTag

      # 返回路径
      - actionType: builtIn
        funcName: goBack
        reload: true

  style:
    scrollBox:
      width: "1"
      height: "0.84729"
      boxSizing: "border-box"
      overflow: "scroll"
    btnBox:
      width: "1"
      height: "0.0972"
      boxSizing: "border-box"
      overflow: "scroll"
      backgroundColor: "#ffffff"
      boxShadow: "1px 1px 4px 1px #dededf"
      textAlign:
        x: center
    btn:
      marginTop: "0.0123"
      height: "0.0443"
      width: "0.84"
      border:
        style: 1
      borderRadius: "5"
      backgroundColor: "#2988e6"
      color: "#ffffff"
      fontSize: .Nfont.h14
      boxSizing: border-box
      fontWeight: "600"
      textAlign:
        x: center
