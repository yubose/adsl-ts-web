DocumentShared:
  title: Provider Documents
  pageNumber:
  init:
    - .SignInCheck
    - =.builtIn.date.currentDateTime:
        dataIn:
        dataOut: Global.formData.auditLog.startTime
    - ..formData@: =.Global.Note
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""

    # 判断是否是图片文件
    - if:
        - =.builtIn.array.has:
            dataIn:
              object: =..formDataTemp.imgTypeList
              value: =..formData.name.data.fileType
        - actionType: evalObject
          object:
            - ..formData.uplodImg@: "none"
            - ..formData.showImg@: "block"
        - actionType: evalObject
          object:
            - ..formData.uplodImg@: "none"
            - ..formData.showFile@: "block"

    - ..apiRequest.uplaodDoc.docReq.id@: =..formData.name.data.fileId
    - =..apiRequest.uplaodDoc.docAPI.get: ""

  formData:
    # 上传显示
    uplodImg: "block"
    # 图片显示
    showImg: "none"
    # 非图片文件显示
    showFile: "none"
    fileDocument: ""
  formDataTemp:
    # 图片上传类型
    imgTypeList: ["jpeg", "jpg", "png", "pdf"]
    # doc
    docTypeList: ["docx", "doc", "pages"]
    # xls
    xlsTypeList: ["xlsx", "xls", "numbers"]
    # ppt
    pptTypeList: ["pptx", "ppt"]
    # htm
    htmTypeList: ["htm", "html"]
  apiRequest:
    uplaodDoc:
      docResp: ""
      docReq:
        id: ""
      docAPI:
        get:
          api: rd
          dataIn: DocumentShared.apiRequest.uplaodDoc.docReq
          dataOut: DocumentShared.apiRequest.uplaodDoc.docResp
  components:
    - .BasePublicHeader:
      children:
        - .BasePublicHeaderLeft:
          leftClick:
            - actionType: evalObject
              object:
                - =.builtIn.utils.createAuditLog:
                    dataIn:
                      date: =.Global.formData.auditLog.startTime
                      actionTypeCode: .ActionTypeCode.view
                      recordTypeCode: 163841
                      eid: =.Global.formData.currentFacility.relationEdge.id
                      user: =.Global.MyProfile.name.data.fullName
                      userId: =.Global.currentUser.vertex.id
                      targetUserId: =.Global.formData.auditLog.patientId
                      accessPort: provider
                    dataOut: Global.formData.auditLog.result
            - actionType: builtIn
              funcName: goBack
              reload: true
        - .BasePublicHeaderTitle:
    - type: scrollView
      style:
        ..style.scrollBox:
      children:
        - type: label
          dataKey: formData.name.title
          style:
            fontWeight: "600"
            marginTop: "0.024630"
            lineHeight: "2.58vh"
            width: "0.92"
            wordBreak: break-word
        - type: view
          viewTag: showImgTag
          style:
            marginTop: "0.013546"
            width: "0.92"

          children:
            - type: view
              style:
                display: ..formData.showImg
                height: "0.57"

              children:
                - type: image
                  path: null.png
                  viewTag: showFileTag
                  path=func: .builtIn.utils.prepareDocToPath
                  dataKey: DocumentShared.formData.name.data.fileId
                  style:
                    ..style.imgShow:
                - type: image
                  path: downIcon.svg
                  style:
                    ..style.deleteImg:
                  onClick:
                    - ..event.downloadClick
            - type: view
              style:
                ..style.otherFileBox:
                display: ..formData.showFile
                width: "0.92"
              onClick:
                - ..event.downloadClick
              children:
                - type: image
                  path:
                    ..event.iconPath:
                  style:
                    ..style.fileIcon:
                - type: view
                  style:
                    ..style.contentBox:
                  children:
                    - type: label
                      dataKey: formData.name.data.fileName
                      style:
                        ..style.fileTitle:
                    - type: label
                      text=func: .builtIn.string.bitFormatting
                      dataKey: formData.name.data.fileSize
                      style:
                        ..style.fileSize:
            - type: image
              path: downIcon.svg
              style:
                ..style.deleteImg:
                display: ..formData.showFile

    # 上传成功提示
    - .SuccessfulOneLine:
      message: "Download Successfully!"
      viewTag: successTag

    - .SoftTips:
      viewTag: failTag
      message: "Download Failed!"

    - .Normal:
      message: "Download this file?"
      viewTag: dialogueTag
      leftButton:
        - actionType: popUpDismiss
          popUpView: dialogueTag
      rightButton:
        - actionType: popUpDismiss
          popUpView: dialogueTag
        - actionType: evalObject
          object:
            - =.builtIn.utils.createAuditLog:
                dataIn:
                  actionTypeCode: .ActionTypeCode.download
                  recordTypeCode: 163841
                  eid: =.Global.formData.currentFacility.relationEdge.id
                  user: =.Global.MyProfile.name.data.fullName
                  userId: =.Global.currentUser.vertex.id
                  targetUserId: =.Global.formData.auditLog.patientId
                  accessPort: provider
                dataOut: Global.formData.auditLog.result
        - actionType: evalObject
          object:
            - =.builtIn.utils.prepareDoc:
                dataIn:
                  doc: =..apiRequest.uplaodDoc.docResp.doc.0
                dataOut: DocumentShared.formData.fileDocument
            - =.builtIn.EcosObj.download:
                dataIn:
                  fileName: =..formData.name.data.fileName
                  ecosObj: =..formData.fileDocument
                  successView: successTag
                  failedView: failTag

  event:
    iconPath:
      emit:
        actions:
          - if:
              - =.builtIn.array.has:
                  dataIn:
                    object: =..formDataTemp.docTypeList
                    value: =..formData.name.data.fileType
              - docIco.svg
              - if:
                  - =.builtIn.array.has:
                      dataIn:
                        object: =..formDataTemp.xlsTypeList
                        value: =..formData.name.data.fileType
                  - xlsIco.svg
                  - if:
                      - =.builtIn.array.has:
                          dataIn:
                            object: =..formDataTemp.pptTypeList
                            value: =..formData.name.data.fileType
                      - pptIco.svg
                      - if:
                          - =.builtIn.array.has:
                              dataIn:
                                object: =..formDataTemp.htmTypeList
                                value: =..formData.name.data.fileType
                          - htmIco.svg
                          - pdfIco.svg
    downloadClick:
      - actionType: popUp
        popUpView: dialogueTag

  style:
    scrollBox:
      marginLeft: "0.04"
      width: "0.92"
      height: "0.945"
      boxSizing: "border-box"
    imgShow:
      width: "0.9"
      height: "auto"
      margin: auto
    deleteImg:
      top: "0.006157"
      left: "0.864"
      height: "0.02"
      zIndex: "10"
    otherFileBox:
      backgroundColor: "#f8f8f8"
      boxSizing: border-box
      paddingLeft: "0.032"
      paddingRight: "0.064"
      paddingTop: "0.0147783"
      paddingBottom: "0.0147783"
      borderRadius: "4"
    fileIcon:
      display: "inline-block"
      width: "0.056"
      height: "0.032019"
      verticalAlign: middle
    contentBox:
      display: "inline-block"
      verticalAlign: middle
      marginLeft: "0.032"
      width: "0.72"
    fileTitle:
      fontSize: .Nfont.h14
      color: "#333333"
      lineHeight: "2.58vh"
      display: "-webkit-box"
      overflow: hidden
      text-overflow: "ellipsis"
      webkitBoxOrient: vertical
      -webkit-line-clamp: 2
      wordBreak: break-word
    fileSize:
      fontSize: .Nfont.h12
      color: "#999999"
# DocumentShared:
#   title: My Documents
#   pageNumber:
#   init: #Page initialization
#     - .SignInCheck
#     - ..formData@: =.Global.Note
#     - actionType: evalObject
#       object:
#         .Global._nonce@:
#           =.builtIn.math.random: ""

#     # 判断是否私有只读
#     - if:
#         - =.builtIn.string.equal:
#             dataIn:
#               string1: =.Global.Note.tage
#               string2: 1
#         - actionType: evalObject
#           object:
#             # 取回当前文档信息
#             - ..apiRequest.medicalRecord.docReq@: =.Global.Note
#             # 显示重置滚动条高度按钮
#             - ..formDataTemp.scrollHeight@: "0.84729"
#             # 显示分享按钮
#             - ..formDataTemp.displayBtn@: "block"
#         - actionType: evalObject
#           object:
#             # 显示重置滚动条高度按钮
#             - ..formDataTemp.scrollHeight@: "0.945"
#             # 显示分享按钮
#             - ..formDataTemp.displayBtn@: "none"

#     - actionType: evalObject
#       object:
#         - if:
#             - =.builtIn.string.equal:
#                 dataIn:
#                   string1: =.DocumentShared.formData.name.data.fileId
#                   string2: ""
#             - continue
#             - actionType: evalObject
#               object:
#                 - ..formData.fileId@: =.DocumentShared.formData.name.data.fileId
#                 - ..formData.uplodImg@: "none"
#                 - ..formData.showImg@: "block"

#     - actionType: builtIn
#       funcName: redraw
#       viewTag: showFileTag
#     - actionType: builtIn
#       funcName: redraw
#       viewTag: showImgTag
#     - actionType: builtIn
#       funcName: redraw
#       viewTag: uplodImgTag

#     - actionType: evalObject
#       object:
#         # 下载pdf的样式控制
#         - .Global.formData.downloadPDF.titleName@: "My Documents"
#         - .Global.formData.downloadPDF.scaleX@: 1
#         - .Global.formData.downloadPDF.scaleY@: 1
#         - .Global.formData.downloadPDF.originX@: 0
#         - .Global.formData.downloadPDF.originY@: 0

#   formData:
#     flag: ""
#     fileSize: ""
#     fileId: ""
#     uplodImg: "block"
#     showImg: "none"
#     need: .jpeg, .png, .pdf, .xlsx, .xls, .pptx, .ppt, .docx, .doc, .numbers, .pages, .htm

#     downFlag: "inline-block"
#     # 控制当前滚动条高度
#     scrollHeight: "0.84729"

#   formDataTemp: #Input data temp here, datatemp should not mix with formData

#   apiRequest: #Input data request here
#     medicalRecord:
#       docResp: ""
#       docReq: ""
#       docAPI:
#         .DocAPI: ""
#         store:
#           api: cd
#           dataIn: apiRequest.medicalRecord.docReq
#           dataOut: apiRequest.medicalRecord.docResp

#   components:
#     - .BasePublicHeader:
#       children:
#         - .BasePublicHeaderLeft:
#         - .BasePublicHeaderTitle:
#         - .BasePublicHeaderMenu:
#     - type: view
#       viewTag: mainView
#       style:
#         ..style.scrollBox:
#         height: ..formDataTemp.scrollHeight
#       children:
#         - type: view
#           style:
#             marginTop: "0.01"
#             left: "0.05"
#             width: "0.9"
#             height: "auto"
#             overflow: hidden
#           children:
#             - type: label
#               text: Create document name
#               dataKey:
#               style:
#                 display: "inline-block"
#                 marginTop: "0.02"
#                 width: "0.6"
#                 fontSize: .Nfont.h2
#             - type: label
#               text: "*"
#               style:
#                 marginTop: "0.015"
#                 display: "inline-block"
#                 color: "0xfd3a3a"

#                 width: "0.1"
#         - type: textField
#           placeholder: "Enter here"
#           isEditable: "false"
#           dataKey: formData.name.title
#           style:
#             marginTop: "0.01"
#             marginLeft: "0.05"
#             width: "0.9"
#             height: "0.06"
#             fontSize: .Nfont.h15
#             color: "0x000000ff"
#             border:
#               style: "2"
#               color: "0x000000ef"
#             borderWidth: "1"
#             backgroundColor: "0xffffff"
#         - type: view
#           style:
#             marginTop: "0.02"
#             left: "0.05"
#             width: "0.9"
#             height: "auto"
#             overflow: hidden
#           children:
#             - type: label
#               text: Upload your document
#               dataKey:
#               style:
#                 display: "inline-block"
#                 marginTop: "0.02"
#                 width: "0.6"
#                 fontSize: .Nfont.h2
#             - type: label
#               text: "*"
#               style:
#                 marginTop: "0.015"
#                 display: "inline-block"
#                 color: "0xfd3a3a"

#                 width: "0.1"
#         - type: view
#           viewTag: uplodImgTag
#           style:
#             display: ..formData.uplodImg
#             width: "1"
#             height: "auto"
#           children:
#             - type: view
#               onClick:
#                 - actionType: popUp
#                   popUpView: selectView
#               style:
#                 marginTop: "0.03"
#                 marginLeft: "0.05"
#                 width: "0.9"
#                 height: "0.1"
#                 border:
#                   style: 4
#                 borderColor: "0x707070"
#                 borderWidth: "1.5"
#               children:
#                 - type: image
#                   path: cloud.svg
#                   style:
#                     height: "0.06"
#                     marginLeft: "0.15"
#                     display: "inline-block"
#                     verticalAlign: middle
#                 - type: label
#                   text: "Click here to upload"
#                   style:
#                     width: "auto"
#                     fontSize: .Nfont.h15
#                     color: "0xacacac"
#                     height: "0.1"
#                     lineHeight: "10vh" #y: center + height= 10vh
#                     display: "inline-block"
#                     verticalAlign: middle
#                     marginLeft: "0.1"
#             - type: view
#               style:
#                 marginTop: "0.04"
#                 marginLeft: "0.05"
#                 width: "0.9"
#                 height: "auto"
#               children:
#                 - type: label
#                   text: "Only the following file types are supported: "
#                   style:
#                     color: "0x707070"
#                     fontSize: .Nfont.h1
#                     height: "auto"
#                     lineHeight: "3vh"
#                     width: "0.8"
#                     marginLeft: "0.05"
#                     wordWrap: break-word
#                 - type: label
#                   dataKey: formData.need
#                   style:
#                     color: "0x707070"
#                     fontSize: .Nfont.h1
#                     height: "auto"
#                     width: "0.82"
#                     marginLeft: "0.05"
#                     wordWrap: break-word
#                 - type: label
#                   text: File size must be no larger than BLANK
#                   style:
#                     marginTop: "0.02"

#                     color: "0x707070"
#                     fontSize: .Nfont.h1
#                     height: "auto"
#                     lineHeight: "3vh"
#                     width: "0.7"
#                     marginLeft: "0.05"
#                     wordWrap: break-word
#                     textAlign:
#                       x: center

#         - type: scrollView
#           viewTag: showImgTag
#           style:
#             display: ..formData.showImg
#             marginTop: "0.03"
#             marginLeft: "0.05"
#             width: "0.9"
#             height: "0.57"
#             # backgroundColor: "pink"
#           children:
#             - type: image
#               path: null.png
#               viewTag: showFileTag
#               path=func: .builtIn.utils.prepareDocToPath
#               dataKey: DocumentShared.formData.fileId
#               style:
#                 width: "0.9"
#                 height: "auto"
#                 margin: auto

#     - type: view
#       style:
#         ..style.btnBox:
#         display: ..formDataTemp.displayBtn
#       children:
#         - type: button
#           text: Release
#           style:
#             ..style.btn:
#           onClick:
#             - ..event.btnClick

#     - .SuccessfulOneLine:
#       message: "Successfully"
#       viewTag: successTag

#     - .HeaderPopUpMenu:
#   event:
#     btnClick:
#       # 更新文档状态
#       - actionType: evalObject
#         object:
#           - ..apiRequest.medicalRecord.docReq.name.data.statusTag.name@: Released
#           - ..apiRequest.medicalRecord.docReq.name.data.statusTag.fontColor@: "0x2988e6"
#           - ..apiRequest.medicalRecord.docReq.name.data.statusTag.backgroundColor@: "0xdfedfc"
#       - actionType: evalObject
#         object:
#           # 修改tage
#           - ..apiRequest.medicalRecord.docReq.tage@: -1
#           - =.DocumentShared.apiRequest.medicalRecord.docAPI.store: ""
#           - =.builtIn.array.add:
#               dataIn:
#                 object: =.Global.currentMeetingDoc
#                 value: =..apiRequest.medicalRecord.docResp.doc
#       - actionType: evalObject
#         object:
#           .Global._nonce@:
#             =.builtIn.math.random: ""

#       - actionType: popUp
#         popUpView: successTag

#       - actionType: builtIn
#         funcName: goBack
#         reload: true

#   style:
#     scrollBox:
#       width: "1"
#       height: "0.84729"
#       boxSizing: "border-box"
#       overflow: "scroll"
#     btnBox:
#       width: "1"
#       height: "0.0972"
#       boxSizing: "border-box"
#       overflow: "scroll"
#       backgroundColor: "#ffffff"
#       boxShadow: "1px 1px 4px 1px #dededf"
#       textAlign:
#         x: center
#     btn:
#       marginTop: "0.0123"
#       height: "0.0443"
#       width: "0.84"
#       border:
#         style: 1
#       borderRadius: "5"
#       backgroundColor: "#2988e6"
#       color: "#ffffff"
#       fontSize: .Nfont.h14
#       boxSizing: border-box
#       fontWeight: "600"
#       textAlign:
#         x: center
