PatientConsentFormShared:
  title: Patient Consent Form - HIPPA
  pageNumber:
  init: #Page initialization
    - .SignInCheck
    - ..formData@: =.Global.Note
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - actionType: evalObject
      object:
        - if:
            # 根据Liz要求，所有release后的，不管是否让patient看，都可以下载pdf
            - =.builtIn.number.typeIsValid:
                dataIn:
                  docType: =.Global.Note.type
                  localArr: [1]
                  binaryArr: [1]
            - continue
            - ..formDataTemp.downFlag@: "none"
        # 下载pdf的样式控制
        - .Global.formData.downloadPDF.titleName@: "Patient Consent Form - HIPPA"
        - .Global.formData.downloadPDF.scaleX@: 0.9
        - .Global.formData.downloadPDF.scaleY@: 0.9
        - .Global.formData.downloadPDF.originX@: 0
        - .Global.formData.downloadPDF.originY@: 0

    # 判断是否私有只读
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.Note.tage
              string2: 1
        - actionType: evalObject
          object:
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =.Global.Note.name.data.classTag.name
                      string2: "Admin"
                - actionType: evalObject
                  object:
                    # 显示重置滚动条高度按钮
                    - ..formDataTemp.scrollHeight@: "0.945"
                    # 显示分享按钮
                    - ..formDataTemp.displayBtn@: "none"
                - actionType: evalObject
                  object:
                    # 取回当前文档信息
                    - ..apiRequest.patientConsentForm.docReq@: =.Global.Note
                    # 显示重置滚动条高度按钮
                    - ..formDataTemp.scrollHeight@: "0.84729"
                    # 显示分享按钮
                    - ..formDataTemp.displayBtn@: "block"
        - actionType: evalObject
          object:
            # 显示重置滚动条高度按钮
            - ..formDataTemp.scrollHeight@: "0.945"
            # 显示分享按钮
            - ..formDataTemp.displayBtn@: "none"

    # 判断签名是否存在
    - actionType: evalObject
      object: 
        - if: 
          - =.PatientConsentFormShared.formData.name.data.signatureId
          - ..formData.displaySign@: "block"
          - ..formData.displaySign@: "none"

  formData: 
    # 控制签名是否显示
    displaySign: "none"        

  formDataTemp: #Input data temp here, datatemp should not mix with formData
    downFlag: "inline-block"
    # 控制当前滚动条高度
    scrollHeight: "0.84729"
    # 是否显示分享按钮
    displayBtn: "none"
  apiRequest: #Input data request here
    patientConsentForm:
      docRes: ""
      docReq: ""
      docAPI:
        .DocAPI: ""
        store:
          api: cd
          dataIn: PatientConsentFormShared.apiRequest.patientConsentForm.docReq
          dataOut: PatientConsentFormShared.apiRequest.patientConsentForm.docRes
  components:
    - .BasePublicHeader:
      children:
        - .BasePublicHeaderLeft:
        - .BasePublicHeaderTitle:
        - .BasePublicHeaderMenu:
          style:
            display: ..formDataTemp.downFlag
    - type: scrollView
      viewTag: mainView
      style:
        ..style.scrollBox:
        height: ..formDataTemp.scrollHeight

      children:
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.0246"
            height: "auto"
            width: "0.92"
          children:
            - type: image
              path: office-building.svg
              path=func: =.builtIn.utils.prepareDocToPath
              dataKey: formData.name.data.facilityInfo.facilityAvatarID
              style:
                verticalAlign: middle
                display: "inline-block"
                height: "0.0578"
                width: "5.78vh"
            - type: view
              style:
                verticalAlign: middle
                marginLeft: "0.08"
                display: "inline-block"
                height: "auto"
                width: "0.71"
                overflow: hidden
              children:
                - type: label
                  dataKey: formData.name.data.facilityInfo.facilityName
                  style:
                    width: "0.71"
                    height: "auto"
                    fontSize: .Nfont.h20
                    fontWeight: "600"

                    verticalAlign: middle
                    wordWrap: break-word
                - type: label
                  dataKey: formData.name.data.facilityInfo.address
                  style:
                    marginTop: "0.0110"
                    width: "0.71"
                    height: "auto"
                    fontSize: .Nfont.h14
                    color: "0x666666"

                    verticalAlign: middle
                    wordWrap: break-word
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.00738"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: Email
                - .DocPublicStyleOneRight:
                  dataKey: formData.name.data.facilityInfo.email
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: Website
                - .DocPublicStyleOneRight:
                  dataKey: formData.name.data.facilityInfo.website
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Main #"
                - .DocPublicStyleOneRight:
                  dataKey: formData.name.data.facilityInfo.phoneNumber
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Fax #"
                - .DocPublicStyleOneRight:
                  dataKey: formData.name.data.facilityInfo.fax

        - .DocPublicLine:
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.00738"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Exam Date
                - .DocPublicStyleTwoRight:
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: formData.name.data.patientInfo.examDate
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Patient Name
                - .DocPublicStyleTwoRight:
                  dataKey: formData.name.data.patientInfo.patientName
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Date of Birth
                - .DocPublicStyleTwoRight:
                  dataKey: formData.name.data.patientInfo.dob
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Phone #"
                - .DocPublicStyleTwoRight:
                  dataKey: formData.name.data.patientInfo.phone
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Email"
                - .DocPublicStyleTwoRight:
                  dataKey: formData.name.data.patientInfo.email
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Patient Address"
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  dataKey: formData.name.data.patientInfo.address
                  style:
                    height: "auto"
                    width: "0.92"
                    fontSize: .Nfont.h14
                    wordWrap: break-word
                    color: "0x333333"
                    fontWeight: "600"
        - .DocPublicLine:
        - type: label
          text: The Department of Health and Human Services has established a “Privacy Rule” to help insure that personal health care information is protected for privacy. The Privacy Rule was also created in order to provide a standard for certain health care providers to obtain their patients' consent for uses and disclosures of health information about the patient to carry out treatment, payment or health care operations.
          dataKey:
          style:
            marginTop: "0.0246"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
            color: "0x333333"
            fontSize: .Nfont.h14
            lineHeight: "2.58vh"

        - type: label
          text: As our patient we want you to know that we respect the privacy of your personal medical records and will do all we can to secure and protect that privacy. We strive to always take reasonable precautions to protect your privacy. When it is appropriate and necessary, we provide the minimum necessary information to only those we feel are in need of your healthcare information and information about treatment, payment or health care operations, in order to provide health care that is in your best interest.
          dataKey:
          style:
            marginTop: "0.0246"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
            color: "0x333333"
            fontSize: .Nfont.h14
            lineHeight: "2.58vh"

        - type: label
          text: We also want you to know that we support your full access to your personal medical records. We may have indirect treatments relationships with you (such as laboratories that only interact with physicians and not patients), and may have to disclose personal health information for purposes of treatment, payment, or health operations, These entities are most often not required to obtain patient consent.
          dataKey:
          style:
            marginTop: "0.0246"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
            color: "0x333333"
            fontSize: .Nfont.h14
            lineHeight: "2.58vh"

        - type: label
          text: You may refuse to consent to the use or disclosure of your personal health information but this must be in writing. Under this law, we have the right to refuse to treat you should you choose to refuse to disclose your Personal Health Information (PIH). If you choose to give consent in this document, at some future time you may request to refuse all or part of your PHI. You may not revoke actions that have already been taken which relied on this or a previously signed consent.
          dataKey:
          style:
            marginTop: "0.0246"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
            color: "0x333333"
            fontSize: .Nfont.h14
            lineHeight: "2.58vh"

        - type: label
          text: If your have objections to this form, please ask to speak with out HIPPA Compliance Officer.
          dataKey:
          style:
            marginTop: "0.0246"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
            color: "0x333333"
            fontSize: .Nfont.h14
            lineHeight: "2.58vh"

        - type: label
          text: You have the right to review our privacy notice to request restrictions and revoke consent in writing after you have reviewed our privacy notice.
          dataKey:
          style:
            marginTop: "0.0246"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
            color: "0x333333"
            fontSize: .Nfont.h14
            lineHeight: "2.58vh"

        - type: label
          text: HIPPA Notice of Privacy Practices
          dataKey:
          style:
            marginTop: "0.0246"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
            color: "0x333333"
            fontSize: .Nfont.h14
            fontWeight: "600"

        - type: label
          text: "Signature below is only acknowledgement that you havereceived this Notice of our Privacy Practices:"
          dataKey:
          style:
            marginTop: "0.01"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
            color: "0x333333"
            fontSize: .Nfont.h14
            lineHeight: "2.58vh"

        - .DocPublicStyleFiveBox:
          children:
            - .DocPublicStyleFiveTitle:
              text: "Name of Recipient/Healthcare Proxy"
            - .DocPublicStyleFiveinput:
              placeholder: "No content"
              isEditable: "false"
              style:
                height: "0.0541"
                border:
                  style: 1
                color: "0x333333"
                backgroundColor: "0xf4f4f4"
              dataKey: formData.name.data.proxyInfo

        - .DocPublicLine:
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.03"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - type: label
              text: Signature
              style:
                width: "0.92"
                height: "auto"
                color: "0x333333"
                fontSize: .Nfont.h14
                fontWeight: "600"
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.01"
            height: "0.128"
            width: "0.9"
            border:
              style: "4"
              color: "0xa9a9a9"
            borderWidth: "2"
          children:
            - type: label
              text: X
              style:
                .SignLabelStyle:
            # 显示暂存的签名
            - type: image
              viewTag: signatureShowTag
              path=func: .builtIn.utils.prepareDocToPath
              # 传入签名文档的id
              dataKey: formData.name.data.signatureId
              style:
                left: "0"
                width: "0.88"
                top: "0"
                height: "0.128"
                overflow: scroll
                zIndex: "1000"
                display: ..formData.displaySign  

        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.0146"
            width: "0.92"
            height: "auto"
            overflow: hidden
            display: ..formData.displaySign  
          children:
            - type: view
              viewTag: signatureTimeTag
              style:
                display: ..formData.flag
                marginTop: "0.01"
                height: "auto"
                width: "0.92"
              children:
                - type: label
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: formData.name.data.signatureTime
                  style:
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    fontSize: .Nfont.h12
                    color: "0x757575"
                    verticalAlign: middle
                - type: label
                  text: "Digitally Signed"
                  dataKey:
                  style:
                    marginLeft: "0.02"
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    fontSize: .Nfont.h12
                    color: "0x757575"
                    verticalAlign: middle
            - type: view
              style:
                marginTop: "0.01"
                width: "auto"
                height: "auto"
              children:
                - type: label
                  text: Date
                  style:
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    color: "0x666666"
                    fontSize: .Nfont.h12
                - type: label
                  text=func: .builtIn.string.formatUnixtimeL_en
                  dataKey: formData.ctime
                  style:
                    marginLeft: "0.0373"
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    color: "0x333333"
                    fontSize: .Nfont.h12
                    fontWeight: "600"
        - type: view
          style:
            marginTop: "0.03"
    # 底部 button release
    - type: view
      style:
        ..style.btnBox:
        display: ..formDataTemp.displayBtn
      children:
        - type: button
          text: Release
          style:
            ..style.btn:
          onClick:
            - ..event.btnClick
    # - .HeaderPopUpDownload:
    - .HeaderPopUpMenu:
    - .SuccessfulOneLine:
      message: "Successfully"
      viewTag: successTag
  event:
    btnClick:
      # 更新文档状态
      - actionType: evalObject
        object:
          - ..apiRequest.patientConsentForm.docReq.name.data.statusTag.name@: Released
          - ..apiRequest.patientConsentForm.docReq.name.data.statusTag.fontColor@: "0x2988e6"
          - ..apiRequest.patientConsentForm.docReq.name.data.statusTag.backgroundColor@: "0xdfedfc"

      # 保存newNote
      - actionType: evalObject
        object:
          - ..apiRequest.patientConsentForm.docReq.tage@: -1
          - =..apiRequest.patientConsentForm.docAPI.store: ""

      - actionType: evalObject
        object:
          .Global._nonce@:
            =.builtIn.math.random: ""
      - actionType: popUp
        popUpView: successTag

      # 返回路径
      - actionType: builtIn
        funcName: goBack
        reload: true
  style:
    scrollBox:
      width: "1"
      height: "0.84729"
      boxSizing: "border-box"
      overflow: "scroll"
    btnBox:
      width: "1"
      height: "0.0972"
      boxSizing: "border-box"
      overflow: "scroll"
      backgroundColor: "#ffffff"
      boxShadow: "1px 1px 4px 1px #dededf"
      textAlign:
        x: center
    btn:
      marginTop: "0.0123"
      height: "0.0443"
      width: "0.84"
      border:
        style: 1
      borderRadius: "5"
      backgroundColor: "#2988e6"
      color: "#ffffff"
      fontSize: .Nfont.h14
      boxSizing: border-box
      fontWeight: "600"
      textAlign:
        x: center
