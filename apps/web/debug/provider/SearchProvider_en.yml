SearchProvider:
  title: "Search"
  init:
    - .SignInCheck
  formData:
    allProviders: []
    searchContent: ""
    providerInfo: ""
    providerId: ""
    speTag: "none"
    suggestAll:
      speciality_suggestion: []
  apiRequest:
    getProviderPublicProfile:
      resp: ""
      doc:
        id: =..formData.providerId
        type: .DocType.DoctorPublicProfile
        xfname: ovid
        maxcount: "1"
        obfname: ctime
      docApi:
        get:
          api: rd
          dataIn: apiRequest.getProviderPublicProfile.doc
          dataOut: SearchProvider.apiRequest.getProviderPublicProfile.resp

  components:
    - .BaseHeader:
    - .HeaderLeftButton:
    - type: view
      style:
        top: "0.1"
        weidth: "1"
        height: "0.9"
        overflow: hidden
      children:
        - type: view
          style:
            width: "1"
            border:
              style: 2
              width: "1.5px"
            borderColor: "0xdededf"
          children:
            - type: textField
              placeholder: Try Speciaty, or doctor name
              dataKey: formData.searchContent
              debounce: 200
              viewTag: specialtyTag
              style:
                width: "0.77"
                height: "0.05"
                marginLeft: "0.04"
                border:
                  style: 1
                display: "inline-block"
                verticalAlign: middle
              onInput:
                - actionType: evalObject
                  object:
                    - ..formData.suggestAll.speciality_suggestion@: []
                    - =.builtIn.search.suggest:
                        dataIn:
                          prefix: =..formData.searchContent
                        dataOut: SearchProvider.formData.suggestAll
                    - ..formData.speTag@: "block"
                - actionType: builtIn
                  funcName: redraw
                  viewTag: startSearch
            - type: button
              text: Search
              style:
                width: "0.16"
                height: "0.03"
                color: "0xffffff"
                fontSize: .Nfont.h12
                display: "inline-block"
                backgroundColor: "0x2988E6"
                borderRadius: "12"
                verticalAlign: middle

              onClick:
                - actionType: popUp
                  popUpView: searchingTag
                - actionType: evalObject
                  object:
                    - =.builtIn.search.queryProviders:
                        dataIn:
                          cond: =..formData.searchContent
                        dataOut: SearchProvider.formData.allProviders
                - actionType: builtIn
                  funcName: show
                  viewTag: ProvidersTag
                - actionType: builtIn
                  funcName: redraw
                  viewTag: providerListTag
                - actionType: popUpDismiss
                  popUpView: searchingTag
        - type: view
          viewTag: startSearch
          style:
            width: "1"
            height: "auto"
            backgroundColor: "0xffffff"
            display: ..formData.speTag
          children:
            - type: list
              contentType: listObject
              listObject: ..formData.suggestAll.speciality_suggestion
              iteratorVar: itemObject
              viewTag: startSearch
              scrollable: false
              style:
                width: '0.95'
                margin: '0'
                left: '0.04'
                height: "auto"
              children:
                - type: listItem
                  itemObject: 
                  style:
                    width: '0.95'
                    height: '0.042'
                    left: '0'
                    lineHeight: "4.2vh"
                    verticalAlign: middle
                  children:
                    - type: label
                      highlightKey: formData.searchContent
                      highlightStyle:
                        color: "#FF6666"
                      dataKey: itemObject.text
                      style:
                        height: '0.042'
                        width: auto
                        fontSize: .Nfont.h14
                        fontColor: "0x333333"
                        textAlign:
                          y: center
                  onClick:
                    - emit:
                        dataKey: 
                          var: itemObject
                        actions:
                          - ..formData.searchContent@: $var.text
                          - .Global.cond@: $var.text
                          - ..formData.speTag@: "none"
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: specialtyTag
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: startSearch
                    - actionType: popUpDismiss
                      popUpView: startSearch
           
        
        - type: view
          viewTag: ProvidersTag
          style:
            width: "1"
            height: "0.85"
            backgroundColor: "0xffffff"
          children:
            - type: list
              viewTag: providerListTag
              contentType: listObject
              listObject: ..formData.allProviders
              iteratorVar: itemObject
              style:
                width: "1"
                margin: "0"
                left: "0"
                height: "0.84"
                overflow: scroll
              children:
                - type: listItem
                  itemObject:
                  style:
                    width: "1"
                    height: "auto"
                    left: "0"
                    marginTop: "0"
                  children:
                    - type: view
                      style:
                        marginTop: "0.0198"
                        marginLeft: "0.0427" #16.01px
                        height: "auto"
                        width: "0.91"
                      children:
                        - type: image
                          # path=func: .builtIn.utils.prepareDocToPath
                          # dataKey: itemObject._source.avatar
                          path: providerImage.png
                          style:
                            verticalAlign: middle
                            display: "inline-block"
                            height: "12vw" #45px
                            width: "12vw" #45px
                        - type: view
                          style:
                            verticalAlign: middle
                            marginLeft: "0.037"
                            display: "inline-block"
                            height: "auto"
                            width: "0.71"
                            overflow: hidden
                          children:
                            - type: label
                              dataKey: itemObject._source.titleName
                              style:
                                width: "0.71"
                                height: "auto"
                                fontSize: .Nfont.h16
                                fontWeight: "500"
                                fontFamily: "Arial"
                                verticalAlign: middle
                                wordWrap: break-word
                            - type: label
                              dataKey: itemObject._source.specialty.0
                              style:
                                marginTop: "0.005"
                                width: "0.71"
                                height: "auto"
                                fontSize: .Nfont.h14
                                color: "0x666666"
                                fontFamily: "Arial"
                                verticalAlign: middle
                                wordWrap: break-word
                            - type: label
                              dataKey: itemObject._source.facilityName
                              style:
                                marginTop: "0.005"
                                width: "0.71"
                                height: "auto"
                                fontSize: .Nfont.h14
                                fontWeight: "600"
                                color: "0x666666"
                                fontFamily: "Arial"
                                verticalAlign: middle
                                wordWrap: break-word
                      onClick:
                        - emit:
                            dataKey:
                              var: itemObject
                            actions:
                              - ..formData.providerId@: $var._source.vid
                        - actionType: evalObject
                          object:
                            - ..formData.providerInfo@: ""
                            - =..apiRequest.getProviderPublicProfile.docApi.get: ""
                            - ..formData.providerInfo@: =..apiRequest.getProviderPublicProfile.resp.doc.0
                            # 存的是 profile 35840的信息
                            - .Global.temporaryId@: =..formData.providerInfo
                        - goto: SearchOutProviderInfo
                    - type: view
                      style:
                        height: "0.0198" #16.08px
                        width: "1"
                    - type: view
                      style:
                        width: "1"
                        height: "1px"
                        background: "0xdededf"
    - type: popUp
      viewTag: searchingTag
      style:
        height: "1"
        width: "1"
        zIndex: "10000"
        backgroundColor: "0x33333366"
        top: "0"
      children:
        - type: view
          style:
            backgroundColor: "0xffffff"
            height: "0.2"
            width: "0.6"
            left: "0.2"
            top: "0.3"
            border:
              style: ""
            borderWidth: "1"
            borderColor: ""
            borderRadius: "10"
          children:
            - type: image
              path: zhuanquan.gif
              style:
                width: "0.4"
                left: "0.1"
