MoreOptions:
  title: More Options
  pageNumber:
  init:
    - .SignInCheck
    # - ..apiRequest.medicalDocuments.docAPI.get
    - actionType: evalObject
      object:
        - actionType: evalObject
          async: true
          object:
            - =..apiRequest.diagnosesDoc.docAPI.get: ""
            - =..apiRequest.recommendation.docAPI.get: ""
            - =..apiRequest.superbillDoc.docAPI.get: ""
    # 处理diagnoses
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =..apiRequest.diagnosesDoc.docResp.doc
              len: 0
        - continue
        - .Global.formData.providerDoc.diagnosesDoc@: =..apiRequest.diagnosesDoc.docResp.doc.0
    # 处理Medical Recommendation
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =..apiRequest.recommendation.docResp.doc
              len: 0
        - actionType: evalObject
          object:
            - .Global.formData.isFirstRecommendation@: true
            - .Global.formData.productionSelectionList@: []
        - actionType: evalObject
          object:
            - .Global.formData.isFirstRecommendation@: false
            - .Global.formData.providerDoc.recommendationDoc@: =..apiRequest.recommendation.docResp.doc.0
            - .Global.formData.productionSelectionList@: =..apiRequest.recommendation.docResp.doc.0.name.data.goodsList
    - if:
        - =.Global.formData.isFirstRecommendation
        - ..formDataTemp.menuList.0.jumpPage@: MedicalRecommendation
        - actionType: evalObject
          object:
            - if:
                - =.builtIn.number.typeIsValid:
                    dataIn:
                      docType: =..apiRequest.recommendation.docResp.doc.0.type
                      localArr: [1]
                      binaryArr: [1]
                - actionType: evalObject
                  object:
                    - .Global.Note@: =..apiRequest.recommendation.docResp.doc.0
                    - ..formDataTemp.menuList.0.jumpPage@: RecommendationShared
                - actionType: evalObject
                  object:
                    - .Global.formData.providerDoc.recommendationDoc@: =..apiRequest.recommendation.docResp.doc.0
                    - .Global.formData.productionSelectionList@: =..apiRequest.recommendation.docResp.doc.0.name.data.goodsList
                    - ..formDataTemp.menuList.0.jumpPage@: SelectRecommendation

      # 处理superbill
    - if:
        - =.builtIn.array.judgeListLength:
            dataIn:
              array: =..apiRequest.superbillDoc.docResp.doc
              len: 0
        - actionType: evalObject
          object:
            - .Global.formData.superbillComplete@: false
            - ..formDataTemp.menuList.1.jumpPage@: SelectSuperbill
            - .Global.formData.providerDoc.superbillDoc@: ""
        - actionType: evalObject
          object:
            - .Global.formData.superbillComplete@: true
            - ..formDataTemp.menuList.1.jumpPage@: SuperbillReview
            - .Global.formData.providerDoc.superbillDoc@: =..apiRequest.superbillDoc.docResp.doc.0

  formData:
    currentPageName: ""
  formDataTemp:
    pageArr: ["UnfinishProviderNotes", "PatientAmendmentRequest"]
    checkArr:
      ["RecommendationShared", "SelectRecommendation", "SuperbillReview"]
    menuList:
      - title: Medical Recommendation
        isIcon: "block"
        icon: addMedical.svg
        top: "0.025862"
        pointer: ""
        backgroundColor: "0xffffff"
        boxShadow: "1px 1px 4px 1px #dededf"
        color: "#333333"
        jumpPage: MedicalRecommendation
      - title: Superbill
        isIcon: "block"
        icon: addMedical.svg
        top: "0"
        pointer: ""
        backgroundColor: "0xffffff"
        boxShadow: "1px 1px 4px 1px #dededf"
        color: "#333333"
        jumpPage: SelectSuperbill
      - title: Coming soon…
        isIcon: "none"
        icon: null.png
        top: "0"
        pointer: none
        backgroundColor: "#f4f4f4"
        boxShadow: "unset"
        color: "#4b4b4b"
  apiRequest:
    medicalDocuments:
      docQueryResp: ""
      docQueryReq:
        id: =.Global.currentRoom.edge.id
        xfname: reid
        # patient profile need not display in the list
        sCondition: .DocumentQuery.ProviderAllMeetingDocuments
        obfname: ctime
        asc: false
        _nonce: =.Global._nonce
        maxcount: "100"
      docAPI:
        get:
          api: rd
          dataIn: MoreOptions.apiRequest.medicalDocuments.docQueryReq
          dataOut: MoreOptions.apiRequest.medicalDocuments.docQueryResp

    diagnosesDoc:
      docResp: ""
      docReq:
        id:
          - =.Global.currentRoom.edge.id
          - =.Global.roomInfo.edge.id
        xfname: "eid,reid"
        type: .DocType.Diagnoses
        obfname: "mtime"
        maxcount: "1"
        _nonce: .Global._nonce
      docAPI:
        .DocAPI: ""
        get:
          api: rd
          dataIn: MoreOptions.apiRequest.diagnosesDoc.docReq
          dataOut: MoreOptions.apiRequest.diagnosesDoc.docResp
    recommendation:
      docResp: ""
      docReq:
        id:
          - .Global.currentRoom.edge.id
          - .Global.roomInfo.edge.id
        xfname: "eid,reid"
        sCondition: type & 0xff000 in (0x32000)
        obfname: "mtime"
        maxcount: "1"
        _nonce: .Global._nonce
      docAPI:
        .DocAPI: ""
        get:
          api: rd
          dataIn: MoreOptions.apiRequest.recommendation.docReq
          dataOut: MoreOptions.apiRequest.recommendation.docResp
    superbillDoc:
      docResp: ""
      docReq:
        id:
          - =.Global.currentRoom.edge.id
          - =.Global.roomInfo.edge.id
        xfname: "eid,reid"
        type: .DocType.Superbill
        obfname: "mtime"
        maxcount: "1"
        _nonce: .Global._nonce
      docAPI:
        .DocAPI: ""
        get:
          api: rd
          dataIn: MoreOptions.apiRequest.superbillDoc.docReq
          dataOut: MoreOptions.apiRequest.superbillDoc.docResp
  components:
    - .BasePublicHeader:
        children:
          - .BasePublicHeaderLeft:
            leftClick:
              - actionType: evalObject
                object:
                  - if:
                      - =.builtIn.string.equal:
                          dataIn:
                            string1: =.Global.formData.unPageName
                            string2: ""
                      - goto: =.Global.formData.lastPage
                      - goto: =.Global.formData.unPageName
          - .BasePublicHeaderTitle:
    - type: scrollView
      style:
        ..style.scrollBox:
      children:
        - type: view
          style:
            ..style.topBox:
          children:
            - type: image
              path: saveSuccess.svg
              style:
                ..style.successImg:
            - type: label
              text: Save Successfully!
              style:
                ..style.successLabel:
        - type: label
          text: Select a type to continue
          style:
            ..style.selectLabel:
        - type: list
          contentType: listObject
          listObject: ..formDataTemp.menuList
          iteratorVar: itemObject
          style:
            ..style.list:
          children:
            - type: listItem
              itemObject:
              style:
                ..style.item:
              children:
                - type: view
                  onClick:
                    - ..event.itemClick
                  style:
                    marginLeft: "0.04"
                    width: "0.92"
                    height: "0.077586"
                    marginTop: itemObject.top
                    boxShadow: itemObject.boxShadow
                    backgroundColor: itemObject.backgroundColor
                    pointerEvents: itemObject.pointer
                    borderRadius: "5"
                    textAlign:
                      y: center
                  children:
                    - type: view
                      style:
                        ..style.auto:
                      children:
                        - type: view
                          style:
                            ..style.auto:
                            display: inline-block
                            verticalAlign: middle
                            marginLeft: "0.2"
                          children:
                            - type: image
                              path: itemObject.icon
                              style:
                                ..style.icon:
                        - type: label
                          dataKey: itemObject.title
                          style:
                            ..style.title:
    - type: view
      style:
        ..style.btnBox:
      children:
        - type: button
          text: Done
          dataKey:
          style:
            ..style.btn:
          onClick:
            - ..event.doneClick

    # 弹窗
    - .warnDialogue:
      viewTag: warnDialogueTag
      leftButton:
        - actionType: popUpDismiss
          popUpView: warnDialogueTag
      rightButton:
        - actionType: popUpDismiss
          popUpView: warnDialogueTag
        - actionType: evalObject
          object:
            # 判断是否从unfinishProvidersn PatientAmendmentRequest进入
            - if:
                - =.builtIn.array.has:
                    dataIn:
                      object: =..formData.pageArr
                      value: =.Global.formData.unPageName
                - .Global.formData.lastPage@: =.Global.formData.unPageName
                - continue
        - actionType: evalObject
          object:
            - goto: =.MoreOptions.formData.currentPageName
  event:
    itemClick:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - ..formData.currentPageName@: $var.jumpPage
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.array.has:
                  dataIn:
                    object: =..formDataTemp.checkArr
                    value: =..formData.currentPageName
              - actionType: popUp
                popUpView: warnDialogueTag
                wait: true
              - continue
      - emit:
          dataKey:
            var: itemObject
          actions:
            - goto: $var.jumpPage
    doneClick:
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =.Global.formData.unPageName
                    string2: ""
              - goto: =.Global.formData.lastPage
              - goto: =.Global.formData.unPageName
  style:
    scrollBox:
      width: "1"
      height: "0.84729"
      boxSizing: "border-box"
      overflow: "scroll"
      color: "#333333"
    btnBox:
      width: "1"
      height: "0.0972"
      boxSizing: "border-box"
      overflow: "scroll"
      backgroundColor: "#ffffff"
      boxShadow: "1px 1px 4px 1px #dededf"
      textAlign:
        x: center
    btn:
      marginTop: "0.0123"
      height: "0.0443"
      width: "0.84"
      border:
        style: 1
      borderRadius: "5"
      backgroundColor: "#2988e6"
      color: "#ffffff"
      fontSize: .Nfont.h14
      boxSizing: border-box
      fontWeight: "600"
      textAlign:
        x: center
    topBox:
      marginTop: "0.03694"
      width: "1"
      height: "auto"
      textAlign:
        x: center
    successImg:
      height: "0.1046798"
      width: "0.2266666"
    successLabel:
      marginTop: "0.01"
      width: "1"
      textAlign:
        x: center
      fontWeight: "600"
    selectLabel:
      marginTop: "0.0615763"
      width: "1"
      height: "auto"
      fontSize: .Nfont.h14
      fontWeight: "600"
      textAlign:
        x: center
    list:
      width: "1"
      margin: "0"
      height: auto
      marginTop: "0.0110837"
    item:
      # marginLeft: "0.04"
      width: "1"
      height: "0.094"
      # marginTop: itemObject.top
      # boxShadow: itemObject.boxShadow
      # backgroundColor: itemObject.backgroundColor
      # pointerEvents: itemObject.pointer
      # borderRadius: "5"
      # textAlign:
      #   x: center
      #   y: center
    icon:
      display: itemObject.isIcon
      width: "0.064"
      height: "0.0295566"
      # verticalAlign: middle
    title:
      display: "inline-block"
      marginLeft: "0.032"
      width: "auto"
      height: "auto"
      color: itemObject.color
      fontSize: .Nfont.h14
      verticalAlign: middle
    auto:
      height: auto
      width: auto
