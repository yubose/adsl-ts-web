MedicalDocuments_VistoryHistory:
  title: "Medical Documents"
  init:
    #登录校验
    - .SignInCheck
    #拼接查询条件
    - =.builtIn.string.concat:
        dataIn:
          - =..apiRequest.medicalDocuments.docQueryReq.sCondition
          - =.DocType.UploadFile #1025
          - ","
          - =.DocType.MeetingNote #1537
          - ","
          - =.DocType.EvaluationNote #1793
          - ","
          - =.DocType.Prescription #2049
          - ","
          - =.DocType.AbsentNote #2305
          - ","
          - =.DocType.Moderna #84480
          - ","
          - =.DocType.PifzerBioNTech #87040
          - ","
          - =.DocType.Cov19Chart #92161
          - ","
          - =.DocType.PatientForm #94721
          - ","
          - =.DocType.Cov19TestNewPatForm #107521
          - ","
          - =.DocType.Cov19TestForm #110081
          - ","
          - =.DocType.PfizerVaccineFirDoseForm #112641
          - ","
          - =.DocType.PfizerVaccineSecDoseForm #115201
          - ","
          - =.DocType.ModernaVaccineFirDoseForm #117761
          - ","
          - =.DocType.ModernaVaccineSecDoseForm #120321
          - ","
          - =.DocType.workStatusForm #122881
          - ","
          - =.DocType.pROne #125441
          - ","
          - =.DocType.pRTwo #128001
          - ","
          - =.DocType.dWCFormRFA #130561
          - ","
          - =.DocType.InitEvalReport #135681
          - ","
          # - =.DocType.FluVaccinationConsentFormEnglish #143361
          # - ","
          # - =.DocType.FluVaccinationConsentFormSpanish #145921
          # - ","
          - =.DocType.ProgressReport #140801
          - ","
          - =.DocType.surgeryForm #133121
          # - ","
          # - =.DocType.FluVaccinationConsentFormEnglish #133121
          - )
        dataOut: MedicalDocuments_VistoryHistory.apiRequest.medicalDocuments.docQueryReq.sCondition
    #清除缓存
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    #获取历史文档数据
    - ..apiRequest.medicalDocuments.docAPI.get
    #根据文档名获取对应页面名
    - =.builtIn.array.transformPage:
        dataIn:
          array: =..apiRequest.medicalDocuments.docQueryResp.doc
          type: "Review"
          dataKey: "name.title"
        dataOut: MedicalDocuments_VistoryHistory.formData.docList
  formData:
    docList: [] # 用于接收处理过的
  apiRequest:
    medicalDocuments:
      docQueryResp: ""
      docQueryReq:
        id: .Global.roomInfo.edge.id
        xfname: eid
        obfname: ctime #按ctime排序
        sCondition: type in (
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: MedicalDocuments_VistoryHistory.apiRequest.medicalDocuments.docQueryReq
          dataOut: MedicalDocuments_VistoryHistory.apiRequest.medicalDocuments.docQueryResp
  components:
    - .BaseHeader:
    - .HeaderLeftButton:
    - type: view
      style:
        top: "0.1"
        left: "0"
        width: "1"
        height: "0.9"
        backgroundColor: "#f0f0f0"
      children:
        - type: label
          text: "Medical Documents"
          style:
            marginTop: "0"
            left: "0.08"
            width: "0.92"
            height: "0.04"
            fontSize: "15"
            fontWeight: 400
            color: "#4b4b4b"
            textAlign:
              y: center
        - type: view
          style:
            marginTop: "0"
            left: "0"
            width: "1"
            height: "0.86"
            overflow: scroll
            backgroundColor: "#ffffff"
          children:
            - type: list
              contentType: listObject
              listObject: ..formData.docList
              iteratorVar: itemObject
              style:
                left: "0"
                width: "1"
                height: "0.86"
                margin: "0"
                marginTop: "0"
                overflow: scroll
              children:
                - type: listItem
                  itemObject: ""
                  onClick:
                    - actionType: updateObject
                      dataObject: itemObject
                      dataKey: Global.DocReference.document
                    - actionType: evalObject
                      object:
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =.Global.DocReference.document.type
                                  string2: 1025
                            - goto: DocumentDetail
                            - continue
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =.Global.DocReference.document.type
                                  string2: 1537
                            - actionType: evalObject
                              object:
                                - .Global.Note@: =.Global.DocReference.document
                                - goto: BlankNoteShared
                            - continue
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =.Global.DocReference.document.type
                                  string2: 1793
                            - actionType: evalObject
                              object:
                                - .Global.Note@: =.Global.DocReference.document
                                - goto: EvaluationNoteShared
                            - continue
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =.Global.DocReference.document.type
                                  string2: 2049
                            - actionType: evalObject
                              object:
                                - .Global.Note@: =.Global.DocReference.document
                                - goto: PrescriptionShared
                            - continue
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =.Global.DocReference.document.type
                                  string2: 2305
                            - actionType: evalObject
                              object:
                                - .Global.Note@: =.Global.DocReference.document
                                - goto: AbsentNoteShared
                            - continue
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =.Global.DocReference.document.type
                                  string2: 122881
                            - actionType: evalObject
                              object:
                                - .Global.Note@: =.Global.DocReference.document
                                - goto: WorkStatusFormShared
                            - continue
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =.Global.DocReference.document.type
                                  string2: 125441
                            - actionType: evalObject
                              object:
                                - .Global.Note@: =.Global.DocReference.document
                                - goto: PROneShared
                            - continue
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =.Global.DocReference.document.type
                                  string2: 128001
                            - actionType: evalObject
                              object:
                                - .Global.Note@: =.Global.DocReference.document
                                - goto: PRTwoShared
                            - continue
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =.Global.DocReference.document.type
                                  string2: 130561
                            - actionType: evalObject
                              object:
                                - .Global.Note@: =.Global.DocReference.document
                                - goto: DWCFormRFAShared
                            - continue
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - if:
                              - true
                              - goto: $var.pageName
                              - goto: $var.pageName
                  style:
                    left: "0"
                    width: "1"
                    height: "0.1"
                    # border: none
                    borderBottom: "1px solid #dbdbdb"
                    border:
                      style: "2"
                      width: "1"
                  children:
                    - type: label
                      text: "Invalid date"
                      dataKey: itemObject.name.title
                      style:
                        top: "0.02"
                        fontSize: "18"
                        fontWeight: 400
                        left: "0.08"
                    - type: label
                      text=func: .builtIn.string.formatUnixtime_en
                      dataKey: itemObject.ctime
                      style:
                        top: "0.055"
                        fontSize: .Nfont.h14
                        fontWeight: 350
                        left: "0.08"
                    - type: label
                      dataKey: itemObject.name.user
                      style:
                        top: "0.055"
                        fontSize: "15"
                        fontWeight: 350
                        width: "0.35"
                        left: "0.55"
                        textAlign:
                          x: right
