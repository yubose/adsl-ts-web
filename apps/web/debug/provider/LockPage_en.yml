LockPage:
  title: LockPage
  pageNumber: 
  init: #Page initialization
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ''
    - .Global.currentUser.vertex.sk@: ""
    - =.builtIn.utils.getJumpPage:
        dataIn:
        dataOut: LockPage.formData.pg
    - =.builtIn.routeRediredct:
        dataIn:
          pageNames: [LockPage]
  formData: #Input data here
    errorTipColor: "#DEDEDE"
    errorTip: "none"
    pageNames: []
    pass: ""
    pg: []
    password: ""
    sk: ""
  formDataTemp: #Input data temp here, datatemp should not mix with formData

  apiRequest: #Input data request here


  components:
    - type: view
      style:
        width: "1"
        height: "1"
      children:
        - type: view
          style:
            width: "1"
            textAlign:
              x: center
          children:
            - type: image
              path: providerImage.svg
              path=func: =.builtIn.utils.prepareDocToPath
              dataKey: Global.MyProfile.name.data.avatar
              style:
                width: "0.20266"
                height: "0.093596"
                borderRadius: "6"
                overflow: hidden   
                marginTop: "0.2438"    
            - type: label
              text: Username
              dataKey: Global.currentUser.vertex.name.userName
              style:
                fontSize: .Nfont.h16
                color: "#333333"
                textAlign:
                  x: center
                width: "1"
        - type: view
          style:
            width: "0.84"
            marginLeft: "0.08"
          children:
            - type: view
              viewTag: errorTipTag
              style:
                ..style.logoutLockPasswordBox:
              children:
                - type: textField
                  contentType: password
                  placeholder: "Enter password"
                  dataKey: formData.password
                  required: "true"
                  style:
                    ..style.logoutLockPasswordField:
            - type: view
              style:
                marginTop: "0.00739"
              children:
                - type: view
                  style:
                    width: "0.38"
                    height: "0.02"
                    display: inline-block
                    textAlign: 
                      x: left
                  children:
                    - type: view
                      style:
                        width: auto
                      children:
                        - type: label
                          viewTag: "errorTipTag"
                          text: Incorrect password
                          style:
                            fontSize: .Nfont.h12
                            color: "#FB5051"
                            display: ..formData.errorTip
                - type: view
                  style: 
                    width: "0.38"
                    marginLeft: "0.08"
                    display: inline-block
                    textAlign: 
                      x: right
                  children:
                    - type: view
                      style:
                        width: auto
                      children:
                        - type: label
                          text: Forgot password?
                          style:
                            fontSize: .Nfont.h12
                            color: "#999999"
            - type: button
              text: Enter
              style:
                color: "0xffffff"
                fontSize: .Nfont.h18
                border: none
                marginTop: "0.03448"
                height: "0.054187"
                width: "0.84"
                borderRadius: "5"
                backgroundColor: "#2988e6"
                textAlign:
                  x: center
                  y: center
              onClick: 
                - actionType: evalObject
                  object:
                    - =.builtIn.eccNaCl.decryptAES:
                        dataIn:
                          key: =..formData.password
                          message: =.Global.currentUser.vertex.esk
                        dataOut: LockPage.formData.sk
                    - =.builtIn.eccNaCl.skCheck:
                        dataIn:
                          pk: =.Global.currentUser.vertex.pk
                          sk: =..formData.sk
                        dataOut: LockPage.formData.pass
                    - if:
                        - =..formData.pass
                        - actionType: evalObject
                          object:
                            - ..formData.errorTipColor@: "#DEDEDE"
                            - ..formData.errorTip@: none
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: errorTipTag
                            - .Global.currentUser.vertex.sk@: =.LockPage.formData.sk
                            - if:
                              - =.builtIn.array.judgeListLength:
                                  dataIn:
                                    array: =.Global.formData.pageNames
                                    len: 0
                              - actionType: evalObject
                                object:
                                  - .Global.formData.pageNames@: =.LockPage.formData.pg
                                  - =.builtIn.array.add:
                                      dataIn:
                                        object: =.Global.formData.pageNames
                                        value: "LockPage"
                              - =.builtIn.array.add:
                                  dataIn:
                                    object: =.Global.formData.pageNames
                                    value: "LockPage"
                                # dataOut: Global.formData.pageNames
                            - =.builtIn.routeRediredct:
                                dataIn:
                                  pageNames: =.Global.formData.pageNames
                            - .Global.formData.pageNames@: []
                            - actionType: builtIn
                              funcName: goBack
                              reload: true
                        - actionType: evalObject
                          object:
                            - ..formData.errorTipColor@: "#FB5051"
                            - ..formData.errorTip@: block
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: errorTipTag
  style: #Input style fragment here
    logoutLockPasswordBox:
      width: "0.84"
      borderColor: ..formData.errorTipColor
      # borderColor: ..changeColor.password.borderColor
      backgroundColor: "#F4F4F5"
      borderWidth: "1"
      borderRadius: "5"
      marginTop: "0.03571"
      border:
        style: "3"
    logoutLockPasswordField:
      textAlign:
        x: left
      fontSize: .Nfont.h14
      borderRadius: "5"
      width: "0.84"
      backgroundColor: "#F4F4F5"
      height: "0.04926"
      textIndent: "1em"
      borderWidth: "1"
      border:
        style: "1"