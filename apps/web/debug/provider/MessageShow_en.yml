MessageShow:
  pageNumber: "220"
  title: "Message"
  init:
    - .SignInCheck
    - actionType: updateObject
      dataKey: Global.formData.replyEmail
      dataObject: .EmptyObj
    - .Global.createjwt.edge.bvid@: =.Global.currentUser.vertex.id
    - =.Global.createjwt.edgeAPI.store: ""
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - actionType: evalObject
      object:
        - actionType: evalObject
          async: true
          object:
            #获取tag
            - =..apiRequest.emailTag.docAPI.get: ""
            #获取附件
            - =..apiRequest.attachment.docAPI.get: ""
            # 获取文件夹
            - =..apiRequest.folder.docAPI.get: ""

    - if:
        - =.builtIn.number.typeIsValid:
            dataIn:
              docType: =..apiRequest.emailTag.docQueryResp.doc.0.type
              localArr: [3]
              binaryArr: [1]
        - ..isStar@: 0
        - ..isStar@: 1
  requestListHidden: "true"
  subject: ""
  inboxFolder: ""
  isStar: 1
  formData:
    display:
      default: true
      amendent: false
  apiRequest:
    #get attachment
    attachment:
      docQueryResp: ""
      docQueryReq:
        type: .DocType.Attachment
        id: .Global.email.id
        xfname: reid
        obfname: "ctime"
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.attachment.docQueryReq
          dataOut: MessageShow.apiRequest.attachment.docQueryResp
    emailTag:
      docQueryResp: ""
      docQueryReq:
        sCondition: type & 0xFF00 = 0xE00
        ids:
          - .Global.rootNotebookID
          - .Global.email.id
        xfname: eid,reid
        _nonce: =.Global._nonce
      docCreateResp: ""
      docCreateReq:
        type: .DocType.MailTag
        eid: .Global.rootNotebookID
        name:
          data: ""
        reid: ""
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.emailTag.docQueryReq
          dataOut: MessageShow.apiRequest.emailTag.docQueryResp
        store:
          api: cd
          dataIn: MessageShow.apiRequest.emailTag.docCreateReq
          dataOut: MessageShow.apiRequest.emailTag.docCreateResp
    folder:
      docGetResp: ""
      docCreateReq:
        type: .DocType.MailFolder
        eid: .Global.rootNotebookID
        name:
          data: ""
          title: ""
      docGetReq:
        type: .DocType.MailFolder
        id: .Global.rootNotebookID
        xfname: eid
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: MessageShow.apiRequest.folder.docGetReq
          dataOut: MessageShow.apiRequest.folder.docGetResp
        store:
          api: cd
          dataIn: MessageShow.apiRequest.folder.docCreateReq
    folderTag:
      docCreateResp: ""
      docCreateReq:
        type: .DocType.MailFolderTag
        eid: .Global.rootNotebookID
        fid: ""
        reid: .Global.email.id
        name:
          data: ""
      docAPI:
        store:
          api: cd
          dataIn: MessageShow.apiRequest.folderTag.docCreateReq
          dataOut: MessageShow.apiRequest.folderTag.docCreateResp
  components:
    # - .BaseHeader:
    # - .HeaderLeftImg:
    #   onClick:
    #     - actionType: builtIn
    #       funcName: goBack
    #       reload: true
    #     # - goto: InboxDashboard
    # path: whiteLeft.svg
    - .BasePublicHeader:
      children:
        - .BasePublicHeaderLeft:
        - .BasePublicHeaderTitle:
    - type: view
      style:
        width: "1"
        height: "0.8"
        display: "block"
      viewTag: funbar
      children:
        - type: view
          style:
            width: "1"
            left: "0"
            height: "0.15"
            zIndex: "10"
            border:
              style: "2"
            borderColor: "0xe9e9eb"
            borderWidth: "1"
            position: "relative"
          children:
            - type: label
              text=func: .builtIn.string.formatUnixtime_en
              dataKey: Global.email.ctime
              style:
                top: "0.02"
                height: "0.02"
                width: "auto"
                textAlign:
                  y: center
                left: "0.05"
                fontSize: .Nfont.h12
                color: "0xBCC5D3"
            - type: label
              dataKey: Global.email.name.title
              style:
                fontSize: .Nfont.h16
                fontWeight: "600"

                left: "0.05"
                top: "0.045"
                width: "0.9"
            - type: label
              text: "From:"
              style:
                left: "0.05"
                top: "0.085"
                height: "0.035"
                fontSize: "15"
                textAlign:
                  x: left
            - type: label
              text: Blair Zhang
              dataKey: Global.email.name.data.senderName
              style:
                fontSize: "15"
                fontWeight: "450"
                height: "0.035"
                width: "0.6"
                color: "0xBCC5D3"
                left: "0.2"
                top: "0.085"
                textAlign:
                  x: left
            - type: label
              text: "To:"
              style:
                left: "0.05"
                top: "0.115"
                height: "0.035"
                fontSize: "15"
                textAlign:
                  x: left
            - type: label
              text:
              dataKey: Global.email.name.data.receiverName
              style:
                fontSize: "15"
                fontWeight: "450"
                height: "0.035"
                width: "0.6"
                color: "0xBCC5D3"
                left: "0.2"
                top: "0.115"
                textAlign:
                  x: left
        - type: image
          viewTag: select
          path:
            emit:
              actions:
                - if:
                    - =.builtIn.number.typeIsValid:
                        dataIn:
                          docType: =..apiRequest.emailTag.docQueryResp.doc.0.type
                          localArr: [3]
                          binaryArr: [1]
                    - providerOn.svg
                    - providerOff.svg
          onClick:
            - actionType: evalObject
              object:
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""
                - if:
                    - =..apiRequest.emailTag.docQueryResp.doc
                    - ..apiRequest.emailTag.docCreateReq@: =..apiRequest.emailTag.docQueryResp.doc.0
                    - continue
                - =.builtIn.number.inhx:
                    dataIn:
                      intHex: =..apiRequest.emailTag.docCreateReq.type
                      index: 3
                      hex: =..isStar
                    dataOut: MessageShow.apiRequest.emailTag.docCreateReq.type
                - =..apiRequest.emailTag.docAPI.store: ""
            - actionType: evalObject
              object:
                - .MessageShow.apiRequest.emailTag.docQueryResp.doc@: []
                - =.builtIn.array.add:
                    dataIn:
                      object: =.MessageShow.apiRequest.emailTag.docQueryResp.doc
                      value: =.MessageShow.apiRequest.emailTag.docCreateResp.doc
                - if:
                    - =..isStar
                    - ..isStar@: 0
                    - ..isStar@: 1
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""
            - actionType: builtIn
              funcName: redraw
              viewTag: select
          style:
            height: "0.025"
            left: "0.88"
            top: "0.09"
            zIndex: "100"
        # 默认content
        - type: view
          viewTag: default
          style:
            display: ..formData.display.default
            marginTop: "0.01477"
            marginLeft: "0.04"
            height: "auto"
            top: "0.16"
            width: "0.92"
            overflow: hidden
          children:
            - type: label
              textBoard:
                - text: "Hello,"
                - br:
                - br:
                - text: ""
                  dataKey: Global.email.name.data.patientName
                - text: " has requested to amend information in "
                - text: ""
                  dataKey: Global.email.name.data.recordName
                - text: " from "
                - text: ""
                  dataKey: Global.email.name.data.appointmentTime
                  color: "#2988e6"
                  fontWeight: "600"
                - text: " appointment"
              style:
                ..style.message:
            - type: view
              style:
                ..style.viewBox:

              children:
                - type: view
                  onClick:
                    - ..event.toAmendment
                  children:
                    - type: label
                      text: View Details
                      style:
                        ..style.viewLabel:
                    - type: image
                      path: rightCircleImg.svg
                      style:
                        ..style.viewImg:
        - type: scrollView
          style:
            top: "0.57"
            width: "1"
            height: "0.22"
          children:
            - type: list
              contentType: listObject
              listObject: ..apiRequest.attachment.docQueryResp.doc
              iteratorVar: itemObject
              style:
                left: "0"
                top: "0.01"
                width: "1"
                height: "auto"
                backgroundColor: "0xffffff"
              children:
                - type: listItem
                  itemObject: ""
                  style:
                    marginTop: "0.01"
                    left: "0"
                    width: "1"
                    height: "auto"
                  onClick:
                    - actionType: updateObject
                      dataKey: Global.showAttachment
                      dataObject: itemObject
                    - goto: ShowAttachment
                  children:
                    - type: view
                      style:
                        top: "0.001"
                        left: "0.05"
                        width: "0.9"
                        height: "0.049"
                        backgroundColor: "0xf8f9fa"
                        borderWidth: "1"
                        borderRadius: "10"
                        border:
                          style: "1"
                      children:
                        - type: image
                          path: blackAttachment.svg
                          style:
                            top: "0.01"
                            height: "0.03"
                            left: "0.03"
                        - type: label
                          dataKey: itemObject.name.title #需要加name.type
                          style:
                            top: "0"
                            textAlign:
                              y: center
                            height: "0.049"
                            width: "0.45"
                            left: "0.13"
                            overflow: hidden
                            text-overflow: ellipsis
                            whiteSpace: nowrap
                            fontSize: .Nfont.h2
                        - type: label
                          text=func: .builtIn.string.bitFormatting
                          dataKey: itemObject.size
                          style:
                            top: "0"
                            height: "0.049"
                            width: "0.3"
                            left: "0.58"
                            fontSize: .Nfont.h2
                            textAlign:
                              x: right
                              y: center
                            color: "0xbcc5d3"
    - type: view
      style:
        top: "0.9"
        width: "1"
        height: "0.1"
        backgroundColor: "0xffffff"
        boxShadow: "0 -2px 3px -1px #7070702a"
      children:
        - type: image
          path: trash.svg
          onClick:
            - actionType: popUp
              popUpView: tashComfirm
          style:
            left: "0.12"
            top: "0.03"
            height: "0.04"
        - type: image
          path: move.svg
          onClick:
            - actionType: popUp
              popUpView: folderPopUpView
          style:
            left: "0.4"
            top: "0.03"
            height: "0.04"
        - type: image
          path: reply.svg
          onClick: #reply 只能发送一个，再次回复只有一个邮件发生变化，而不是生成
            - goto: NewMessage2
          style:
            left: "0.67"
            top: "0.03"
            height: "0.04"
    - type: popUp
      viewTag: moveView
      style:
        top: "0"
        left: "0"
        width: "1"
        height: "0.8"
        zIndex: "20"
      children:
        - type: view
          onClick:
            - actionType: popUpDismiss
              popUpView: moveView
          style:
            top: "0"
            left: "0"
            width: "1"
            height: "0.8"
        - type: list
          contentType: listObject
          listObject: ..listData.folderList.edge
          iteratorVar: itemObject
          style:
            left: "0.35"
            width: "0.29"
            top: "0.075"
            backgroundColor: "0x2988e6"
            height: auto
            # height: "0.08"
            # left: "0"
            marginTop: "0"
          children:
            - type: listItem
              itemObject: ""
              onClick:
                - actionType: updateObject
                  dataKey: MessageShow.inboxFolder
                  dataObject: itemObject.id
                - actionType: evalObject
                  object:
                    ..email.edge.name.folderID@: =..inboxFolder.id
                - actionType: evalObject
                  object:
                    - =..email.edgeAPI.store: ""
                - actionType: popUpDismiss
                  popUpView: moveView
              style:
                left: "0"
                width: "0.29"
                height: "0.04"
                border:
                  style: "2"
                borderColor: "0xffffff"
                borderWidth: "1"
              children:
                - type: label
                  dataKey: itemObject.name.folderName
                  style:
                    left: "0"
                    height: "0.04"
                    top: "0.005"
                    width: "0.29"
                    color: "0xffffff"
                    textAlign:
                      x: center

    - type: popUp
      viewTag: folderPopUpView
      style:
        left: "0"
        top: "0"
        height: "1"
        width: "1"
        zIndex: "100"
        backgroundColor: "0x00000033"
      children:
        - type: view
          style:
            width: "1"
            height: "0.64"
          onClick:
            - actionType: popUpDismiss
              popUpView: folderPopUpView
        - type: view
          style:
            top: "0.64"
            left: "0"
            width: "1"
            height: "0.36"
            backgroundColor: "0xFFFFFF"
            borderRadius: "10px 10px 0 0"
          children:
            - type: list
              contentType: listObject
              listObject: ..apiRequest.folder.docGetResp.doc
              iteratorVar: itemObject
              style:
                marginTop: "0.01"
                width: "1"
                height: "0.2"
                overflow: scroll
              children:
                - type: listItem
                  itemObject:
                  onClick:
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - ..apiRequest.folderTag.docCreateReq.fid@: $var.id
                          - =..apiRequest.folderTag.docAPI.store: ""
                    - goto: InboxDashboard
                  style:
                    width: "1"
                    height: "0.049"
                    marginTop: "0.001"
                    border:
                      style: 2
                    borderColor: "0xf0f0f0"
                    borderWidth: "1"
                  children:
                    - type: image
                      path: folderShow.svg
                      style:
                        marginTop: "0.4vw"
                        height: "0.03"
                        left: "0.08"
                        top: "0.01"
                    - type: label
                      dataKey: itemObject.name.title
                      style:
                        left: "0.18"
                        width: "0.3"
                        height: "0.048"
                        top: "0"
                        textAlign:
                          y: center
            - type: view
              style:
                marginTop: "0.01"
                width: "1"
                height: "0.08"
                textAlign:
                  # x: center
                  y: center
              children:
                - type: image
                  path: AddNewFolder.svg
                  onClick:
                    - actionType: popUpDismiss
                      popUpView: folderPopUpView
                    - actionType: popUp
                      popUpView: addFolderPopUpView
                  style:
                    height: "0.055"
                    width: "0.6"
                    left: "0.2"
    - type: popUp
      title: Add New Folder
      viewTag: addFolderPopUpView
      style:
        left: "0"
        top: "0"
        width: "1"
        height: "1"
        backgroundColor: "0xffffff55"
        zIndex: 100000
      children:
        - type: view
          style:
            left: "0.15"
            width: "0.7"
            top: "0.32"
            height: "0.18"
            backgroundColor: "0xe5e5e5"
            border:
              style: "5"
            borderWidth: "1"
            borderRadius: "10"
          children:
            - type: label
              text: ___.title
              style:
                left: "0.1"
                width: "0.5"
                top: "0.01"
                height: "0.06"
                fontSize: .Nfont.h2
                color: "0x4b4b4b"
                backgroundColor: "0xe5e5e5"
                borderWidth: "1"
                borderColor: "0x3f3f3f66"
                textAlign:
                  x: center
                  y: center
            - type: textField
              placeholder: Enter name here
              dataKey: apiRequest.folder.docCreateReq.name.title
              style:
                left: "0.04"
                top: "0.07"
                width: "0.62"
                border:
                  style: "3"
                borderWidth: "1"
                borderColor: "0xc4c4c6"
                height: "0.03"
                backgroundColor: "0xffffff"
                textAlign:
                  x: left
                  y: center
            - type: view
              style:
                left: "0"
                top: "0.128"
                width: "0.7"
                height: "0.001"
                backgroundColor: "0x999999"
                margin: "0"
            - type: view
              style:
                left: "0.35"
                top: "0.128"
                width: "0.002"
                height: "0.052"
                backgroundColor: "0x999999"
            - type: label
              text: Cancel
              style:
                left: "0.01"
                width: "0.33"
                top: "0.13"
                height: "0.045"
                fontSize: .Nfont.h2
                backgroundColor: "0xe5e5e5"
                border:
                  style: "1"
                color: "0x007aff"
                textAlign:
                  x: center
                  y: center
              onClick:
                - actionType: popUpDismiss
                  popUpView: addFolderPopUpView
            - type: label
              text: Ok
              style:
                left: "0.36"
                width: "0.33"
                top: "0.13"
                height: "0.045"
                fontSize: .Nfont.h2
                backgroundColor: "0xe5e5e5"
                border:
                  style: "1"
                color: "0x007aff"
                textAlign:
                  x: center
                  y: center
              onClick:
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.array.checkElememtExist:
                            dataIn:
                              objArr: =..apiRequest.folder.docGetResp.doc
                              values: =..apiRequest.folder.docCreateReq.name.title
                        - actionType: popUp
                          popUpView: folderUniqueErrorPopUp
                        - actionType: evalObject
                          object:
                            - .Global.createjwt.edge.bvid@: =.Global.currentUser.vertex.id
                            - =.Global.createjwt.edgeAPI.store: ""
                            - =..apiRequest.folder.docAPI.store: ""
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""
                - actionType: evalObject
                  object:
                    - =..apiRequest.folder.docAPI.get: ""
                - actionType: builtIn
                  funcName: redraw
                  viewTag: folderPopUpView
                - actionType: popUpDismiss
                  popUpView: addFolderPopUpView
                - actionType: popUp
                  popUpView: folderPopUpView
                - actionType: evalObject
                  object:
                    - ..apiRequest.folder.docCreateReq.name.title@: ""
                - actionType: builtIn
                  funcName: redraw
                  viewTag: addFolderPopUpView
    # 文件名检查弹窗
    - .BaseMessageWarnPopup:
      message: The folder name is duplicate or empty
      viewTag: folderUniqueErrorPopUp
    - .simplePopup:
      message: "Are you sure you want to delete the message?"
      viewTag: tashComfirm
      children:
        - .simplePopupView:
          children:
            - .simplePopupLable:
            - .simplePopupSplit1:
            - .simplePopupSplit2:
            - .simplePopupLeftButton:
            - .simplePopupRightButton:
              onClick:
                - actionType: evalObject
                  object:
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - =..apiRequest.emailTag.docAPI.get: ""
                    - ..apiRequest.emailTag.docCreateReq@: =..apiRequest.emailTag.docQueryResp.doc.0
                    - =.builtIn.number.inhx:
                        dataIn:
                          intHex: =..apiRequest.emailTag.docCreateReq.type
                          index: 2
                          hex: 1
                        dataOut: MessageShow.apiRequest.emailTag.docCreateReq.type
                    - =.builtIn.number.inhx:
                        dataIn:
                          intHex: =..apiRequest.emailTag.docCreateReq.type
                          index: 3
                          hex: 0
                        dataOut: MessageShow.apiRequest.emailTag.docCreateReq.type
                    - =.builtIn.number.inhx:
                        dataIn:
                          intHex: =..apiRequest.emailTag.docCreateReq.type
                          index: 4
                          hex: 1
                        dataOut: MessageShow.apiRequest.emailTag.docCreateReq.type
                    - =..apiRequest.emailTag.docAPI.store: ""
                - goto: InboxDashboard
  event:
    toAmendment:
      - actionType: evalObject
        object:
          - .Global.formData.amendment.id@: =.Global.email.esig
          - .Global.formData.auditLog.patientId@: =.Global.email.bsig
          - .Global.formData.auditLog.patientName@: =.Global.email.name.data.patientName
      - goto: PatientAmendmentRequest
  style:
    message:
      fontSize: .Nfont.h14
      width: "0.92"
      height: "auto"
      color: "#333333"
      lineHeight: "2.58vh"
      wordBreak: break-word
    viewBox:
      marginTop: "0.0307881"
      width: "0.92"
      height: "auto"
      textAlign:
        x: right
    viewLabel:
      fontSize: .Nfont.h14
      color: "#2988e6"
      fontWeight: "600"
      display: "inline-block"
      verticalAlign: middle
    viewImg:
      marginLeft: "0.02"
      display: "inline-block"
      height: "0.019704"
      verticalAlign: middle
