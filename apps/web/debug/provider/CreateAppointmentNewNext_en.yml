CreateAppointmentNewNext:
  title: "Change Appointment"
  init:
    - .SignInCheck
    - ..formData.dataObject@: =.Global.roomInfo.edge
    - =.builtIn.object.setObjectKey:
        dataIn:
          objectArr: =..formDataTemp.appointmentTitle
          key: isSelected
          value: false
    - =.builtIn.object.setObjectKey:
        dataIn:
          objectArr: =..formDataTemp.optionalForms
          key: isSelected
          value: false
    - =.builtIn.number.transformSubtype:
        dataIn:
          subtype: =.Global.subtype
          addition: 8
        dataOut: Global.subtype
    - actionType: evalObject
      object:
        - if:
            - =.Global.currentMeetingPatientProfile.basicInfo.phone
            - =.builtIn.string.phoneNumberSplit:
                dataIn:
                  phoneNumber: =.Global.currentMeetingPatientProfile.basicInfo.phone
                  sign: " "
                dataOut: CreateAppointmentNewNext.formData.phone
            - continue
    - =..apiRequest.patientProfile.get: ""
    - ..apiRequest.facility.documentReq.id@: =..formData.dataObject.name.facilityId
    - =..apiRequest.facility.docAPI.get: ""
    - actionType: evalObject
      object:
        - =.builtIn.string.formatUnixtimeL_en:
            dataIn:
              - =.Global.roomInfo.edge.stime
            dataOut: CreateAppointmentNewNext.formData.clock.sdateTranslated
        - =.builtIn.string.formatUnixtimeL_en:
            dataIn:
              - =.Global.clock.stime
            dataOut: CreateAppointmentNewNext.formData.clock.edateTranslated
        - =.builtIn.string.formatUnixtimeLT_en:
            dataIn:
              - =.Global.roomInfo.edge.stime
            dataOut: CreateAppointmentNewNext.formData.clock.stimeTranslated
        - =.builtIn.string.formatUnixtimeLT_en:
            dataIn:
              - =.Global.clock.stime
            dataOut: CreateAppointmentNewNext.formData.clock.etimeTranslated
  formData:
    countryCode: "+1"
    phone: ["+1"]
    dataObject: ""
    patientId: ""
    FacilityId: ""
    Emailcontent: ""
    clock:
      sdateTranslated:
      edateTranslated:
      stimeTranslated:
      etimeTranslated:
  formDataTemp:
    generalInfo: true
    generalInfoForms: true
    optionalForms:
      - title: Patient Chart
      - title: General Information
    appointmentTitle:
      - title: Visit Questionnaire
      - title: PifzerBioNTech
      - title: Moderna
      - title: COVID-19 Testing
  sendNotification:
    document:
      .Document: ""
      eid: =.AddPatient.invite.response.edge.id
      subtype:
        isOnServer: 1
        isZipped: 0
        isBinary: 0
        isEncrypted: 0
        isExtraKeyNeeded: 0
        isEditable: 0
        applicationDataType: 0
        # 7 th bit
        notification: 1
        ringToneNotify: 0
        sendtoSelf: 0
        # 10 bit
        textMessage: 0
        mediaType: 8
      type: .DocType.Notification
      tage: 5
      name:
        data: ""
        notification:
          title: Appointment Time Changed
          context: Provider Changed Appointment Time
          body: Provider Changed Appointment Time
          onClickLandingPage: InboxDashboard
          #targetApp: =.FirebaseToken.response.edge.evid
    docAPI:
      store:
        api: cd
        dataIn: sendNotification.document
  apiRequest:
    changeTime:
      edgeCreateResp: ""
      edgeCreateReq:
        # the provider id
        type: 40000
        subtype: =.Global.subtype
        evid: .Global.clock.refid
        # the patient id
        bvid: .Global.currentUser.vertex.id
        #E8 id
        refid: .Global.roomInfo.edge.id
        stime: .Global.clock.stime
        etime: .Global.clock.etime
        # tage: 1
      edgeAPI:
        store:
          api: ce
          dataIn: CreateAppointmentNewNext.apiRequest.changeTime.edgeCreateReq
          dataOut: CreateAppointmentNewNext.apiRequest.changeTime.edgeCreateResp
    # 查询邮件需要挂在的edge的id
    relation:
      edgeReq:
        id: []
        type: .EdgeType.Email
        xfname: Evid&Bvid
        maxcount: "1"
        obfname: "ctime"
        _nonce: =.Global._nonce
      edgeRes: ""
      edgeAPI:
        get:
          api: re
          dataIn: CreateAppointmentNewNext.apiRequest.relation.edgeReq
          dataOut: CreateAppointmentNewNext.apiRequest.relation.edgeRes
    # 创建邮件doc
    changeEmail:
      docReq:
        type: .DocType.InboxMessage #邮件类型，默认1281
        eid: "" #邮件需要挂在的edge的id，为发送方与接收方之间10002的edge
        name:
          data:
            #邮件内容
            content: ""
            #收件人姓名
            receiverName: ""
            #发送人姓名
            senderName: "automatic-reply@aitmed.com"
            #收件人头像的id
            receiverAvatarId: ""
            #是否带附件
            haveAttachment: false
            #收件人id
            receiverId: ""
          # title: "Change Appointment"
          title: "Appointment changed  Notification"
          # user for store sender's avatar, not sender's vid
          user: ""
      docRes: ""
      docAPI:
        store:
          api: cd
          dataIn: CreateAppointmentNewNext.apiRequest.changeEmail.docReq
          dataOut: CreateAppointmentNewNext.apiRequest.changeEmail.docRes
    # get all patient profile
    patientProfile:
      docReponse: ""
      doc:
        ids:
          - .Global.roomInfo.edge.bvid
          - .Global.roomInfo.edge.evid
        xfname: Bvid
        type: .DocType.PatientProfile #  type: "102401"
        obfname: "ctime"
        maxcount: "1"
        ObjType: 12
        sCondition: "E.type=10000"
        _nonce: =.Global._nonce
      get:
        api: rd
        dataIn: apiRequest.patientProfile.doc
        dataOut: CreateAppointmentNewNext.apiRequest.patientProfile.docReponse
    facility:
      response: ""
      documentReq:
        id: ""
        xfname: ovid
        type: .DocType.FacilityProfile
        _nonce: .Global._nonce
        obfname: mtime
        maxcount: "1"
      docAPI:
        get:
          api: rd
          dataIn: CreateAppointmentNewNext.apiRequest.facility.documentReq
          dataOut: CreateAppointmentNewNext.apiRequest.facility.response
    getFacility:
      response:
      vertex:
        id: ""
        xfname: evid
        ObjType: 4
        type: "20"
      vertexAPI:
        get:
          api: rv
          dataIn: CreateAppointmentNewNext.apiRequest.getFacility.vertex
          dataOut: CreateAppointmentNewNext.apiRequest.getFacility.response

  components:
    - type: view
      style:
        width: "1"
        height: "0.1"
        backgroundColor: "0x2988e6ff"
      children:
        - type: label
          text: =..title
          style:
            left: "0.15"
            width: "0.7"
            fontWeight: 300
            height: "0.1"
            fontSize: .Nfont.h3
            color: "0xffffffff"
            textAlign:
              x: center
              y: center
            backgroundColor: "0x2988e6ff"
            border:
              style: "1"
    - type: view
      onClick:
        - actionType: builtIn
          funcName: goBack
          reload: true
      style:
        top: "0.04"
        left: "0.05"
        width: "0.1"
        height: "0.02"
        backgroundColor: "0x2988e6"
        zIndex: 100
        # border:
        #   style: "1"
        textAlign:
          x: center
          y: center
      children:
        - type: image
          path: falseWhite.svg
          style:
            left: "0.02"
            height: "0.02"
            zIndex: 100
    #  body
    - type: view
      style:
        top: "0.1"
        width: "1"
        height: "auto"
      children:
        - type: view
          viewTag: blockImageTag
          style:
            width: "1"
            marginTop: "0"
            height: "0.35"
            backgroundColor: "0x2988e6"
          children:
            - type: view
              style:
                marginTop: "0"
                width: "0.9"
                height: "0.32"
                marginLeft: "0.05"
                borderRadius: "6"
                backgroundColor: "0xffffff"
              children:
                - type: view
                  style:
                    width: "0.84"
                    height: "0.32"
                    marginTop: "0"
                    marginLeft: "0.03"
                    fontSize: .Nfont.n1
                  children:
                    - type: view
                      style:
                        width: "0.82"
                        height: "0.05"
                        marginLeft: "0.01"
                        border:
                          style: "2"
                        borderWidth: "1"
                        borderColor: "0xf8f8f8"
                      children:
                        - type: label
                          text: "Appointment Info"
                          style:
                            fontSize: .Nfont.n2
                            width: "0.77"
                            height: "0.05"
                            display: "inline-block"
                            lineHeight: "5vh"
                        - type: image
                          path: editBlue.svg
                          style:
                            width: "0.05"
                            marginTop: "0.015"
                            display: "inline-block"
                            textAlign:
                              x: right
                          onClick:
                            - actionType: builtIn
                              funcName: goBack
                              reload: true
                    - type: view
                      style:
                        width: "0.82"
                        height: "0.035"
                        marginLeft: "0.01"
                        marginTop: "0.015"
                      children:
                        - type: label
                          text: "Date"
                          style:
                            fontSize: .Nfont.n2
                            width: "0.3"
                            height: "0.035"
                            display: "inline-block"
                            lineHeight: "4vh"
                        - type: label
                          text: "02/12/2021"
                          text=func: .builtIn.string.formatUnixtimeL_en
                          dataKey: Global.clock.stime
                          style:
                            fontSize: .Nfont.n2
                            height: "0.035"
                            display: "inline-block"
                            lineHeight: "4vh"
                            width: "0.4"
                            marginLeft: "0.1"
                            textAlign:
                              x: right
                    - type: view
                      style:
                        width: "0.82"
                        height: "0.035"
                        marginLeft: "0.01"
                      children:
                        - type: label
                          text: "Time"
                          style:
                            fontSize: .Nfont.n2
                            width: "0.3"
                            height: "0.035"
                            display: "inline-block"
                            lineHeight: "3.5vh"
                        - type: label
                          text: "9:45am-10:00am"
                          text=func: .builtIn.date.ShowTimeSpan
                          dataKey: Global.clock
                          style:
                            fontSize: .Nfont.n2
                            height: "0.035"
                            display: "inline-block"
                            lineHeight: "3.5vh"
                            width: "0.4"
                            marginLeft: "0.1"
                            textAlign:
                              x: right
                    - type: view
                      style:
                        width: "0.82"
                        height: "0.035"
                        marginLeft: "0.01"
                      children:
                        - type: label
                          text: "Reason for Visit"
                          style:
                            fontSize: .Nfont.n2
                            width: "0.3"
                            height: "0.035"
                            display: "inline-block"
                            lineHeight: "3.5vh"
                        - type: label
                          text: "Fever"
                          dataKey: Global.roomInfo.edge.name.visitReason
                          style:
                            fontSize: .Nfont.n2
                            display: "inline-block"
                            lineHeight: "3.5vh"
                            width: "0.4"
                            marginLeft: "0.1"
                            textAlign:
                              x: right
                    - type: view
                      style:
                        width: "0.82"
                        height: "0.035"
                        marginLeft: "0.01"
                      children:
                        - type: label
                          text: "Appointment Type"
                          style:
                            fontSize: .Nfont.n2
                            height: "0.035"
                            width: "0.4"
                            display: "inline-block"
                            lineHeight: "3.5vh"
                        - type: label
                          dataKey: Global.roomInfo.edge.name.visitType
                          style:
                            fontSize: .Nfont.n2
                            display: "inline-block"
                            lineHeight: "3.5vh"
                            width: "0.4"
                            textAlign:
                              x: right
                    - type: view
                      style:
                        width: "0.82"
                        height: "0.035"
                        marginLeft: "0.01"
                        marginTop: "0.008"
                      children:
                        - type: label
                          text: "Provider"
                          style:
                            fontSize: .Nfont.n2
                            height: "0.035"
                            width: "0.2"
                            display: "inline-block"
                        - type: label
                          text: "Aomas Mueller"
                          dataKey: Global.MyProfile.name.data.fullName
                          style:
                            fontSize: .Nfont.n2
                            height: "0.035"
                            width: "0.6"
                            display: "inline-block"
                            textAlign:
                              x: right
                    - type: view
                      style:
                        width: "0.82"
                        height: "0.035"
                        marginLeft: "0.01"
                      children:
                        - type: label
                          text: "Facility"
                          style:
                            fontSize: .Nfont.n2
                            height: "0.035"
                            width: "0.2"
                            display: "inline-block"
                            lineHeight: "3.5vh"
                        - type: label
                          text: "A&C Urgentcare"
                          dataKey: Global.currentFacility.name.basicInfo.medicalFacilityName
                          style:
                            fontSize: .Nfont.n2
                            height: "0.035"
                            display: "inline-block"
                            lineHeight: "3.5vh"
                            width: "0.6"
                            textAlign:
                              x: right

        - type: view
          style:
            width: "0.82"
            marginLeft: "0.08"
            marginTop: "0.01"
            height: "0.25"
          children:
            - type: label
              text: "Add Patient"
              style:
                height: "0.03"
                color: "0x333333"
                fontSize: 4vw
            - type: view
              style:
                height: "0.08"
                width: "0.9"

              children:
                - type: view
                  style:
                    display: "inline-block"

                  children:
                    - type: label
                      text: "First Name"
                      style:
                        height: "0.03"
                        color: "0x333333"
                        fontSize: 4vw

                    - type: textField
                      dataKey: Global.currentMeetingPatientProfile.basicInfo.firstName
                      isEditable: false
                      style:
                        height: "0.04"
                        width: "0.25"
                        border:
                          style: "3"
                        borderRadius: "3"
                        borderColor: "#d8d8d8"
                        borderWidth: "1px"
                        backgroundColor: "0xfafafa"
                        textIndent: "8px"
                - type: view
                  style:
                    display: "inline-block"
                    marginLeft: "0.05"
                  children:
                    - type: label
                      text: "Middle Name"
                      style:
                        height: "0.03"
                        color: "0x333333"
                        fontSize: 4vw
                    - type: textField
                      dataKey: Global.currentMeetingPatientProfile.basicInfo.middleName
                      isEditable: false
                      style:
                        height: "0.04"
                        width: "0.25"
                        border:
                          style: "3"
                        borderRadius: "3"
                        borderColor: "#d8d8d8"
                        borderWidth: "1px"
                        backgroundColor: "0xfafafa"
                        textIndent: "8px"
                - type: view
                  style:
                    display: "inline-block"
                    marginLeft: "0.05"
                  children:
                    - type: label
                      text: "Last Name"
                      style:
                        height: "0.03"
                        color: "0x333333"
                        fontSize: 4vw
                    - type: textField
                      dataKey: Global.currentMeetingPatientProfile.basicInfo.lastName
                      isEditable: false
                      style:
                        height: "0.04"
                        width: "0.25"
                        border:
                          style: "3"
                        borderRadius: "3"
                        borderColor: "#d8d8d8"
                        borderWidth: "1px"
                        backgroundColor: "0xfafafa"
                        textIndent: "8px"
            - type: view
              style:
                height: "0.1"
                width: "0.9"
              children:
                - type: view
                  style:
                    display: "inline-block"
                  children:
                    - type: label
                      text: "Country"
                      style:
                        height: "auto"
                        color: "0x333333"
                        # fontSize: 4vw
                    - type: textField
                      dataKey: formData.phone.0
                      isEditable: false
                      # options: .Global.CountryCode
                      style:
                        # disabled: "disabled"
                        height: "0.04"
                        width: "0.25"
                        border:
                          style: "3"
                        borderRadius: "3"
                        borderColor: "#d8d8d8"
                        textIndent: "8px"
                        borderWidth: "1px"
                        backgroundColor: "0xfafafa"
                        # textAlign:
                        #   x: center
                - type: view
                  style:
                    display: "inline-block"
                    marginLeft: "0.05"
                  children:
                    - type: label
                      text: "Phone Number"
                      dataKey:
                      style:
                        width: "auto"
                    - type: textField
                      dataKey: formData.phone.1
                      isEditable: false
                      style:
                        height: "0.04"
                        width: "0.47"
                        border:
                          style: "3"
                        borderRadius: "3"
                        borderColor: "#d8d8d8"
                        textIndent: "8px"
                        borderWidth: "1px"
                        backgroundColor: "0xfafafa"

            # - type: list
            #   viewTag: appointmentListTag
            #   contentType: listObject
            #   listObject: ..formDataTemp.appointmentTitle
            #   iteratorVar: itemObject
            #   style:
            #     width: '0.82'
            #     margin: '0'
            #     height: "auto"
            #   children:
            #     - type: listItem
            #       itemObject:
            #       style:
            #         width: '0.82'
            #         height: '0.05'
            #         left: '0'
            #         marginTop: '0.01'
            #       children:
            #         - type: image
            #           path:
            #             emit:
            #               dataKey:
            #                   var: itemObject
            #               actions:
            #                 - if:
            #                   - =.builtIn.string.equal:
            #                       dataIn:
            #                         string1: =..formDataTemp.generalInfo
            #                         string2: $var.isSelected
            #                   - selectOn.svg
            #                   - selectOff.svg
            #           onClick:
            #             - emit:
            #                 dataKey:
            #                   var: itemObject
            #                 actions:
            #                   - if:
            #                     - =.builtIn.string.equal:
            #                         dataIn:
            #                           string1: =..formDataTemp.generalInfo
            #                           string2: $var.isSelected
            #                     - =.builtIn.object.clear:
            #                         dataIn:
            #                           object: $var
            #                           key: isSelected
            #                     - =.builtIn.object.set:
            #                         dataIn:
            #                           object: $var
            #                           key: isSelected
            #                           value: true
            #             - actionType: builtIn
            #               funcName: redraw
            #               viewTag: appointmentListTag
            #           style:
            #             width: "0.05"
            #             marginTop: "0.013"
            # - type: label
            #   dataKey: itemObject.title
            #   style:
            #     display: "inline-block"
            #     fontSize: .Nfont.n2
            #     height: "0.05"
            #     width: "0.75"
            #     lineHeight: "5vh"
            #     marginLeft: "0.02"
            # - type: label
            #   text: "Optional Forms"
            #   style:
            #     lineHeight: "5vh"
            #     height: "0.05"
            #     color: "0x333333"
            #     fontSize: 4vw
        - type: view
          style:
            width: "1"
            borderBottom: "1px solid #e6e6e6"

        - type: view
          style:
            marginTop: "0.05"
            width: "0.9"
            marginLeft: "0.04"
            height: "auto"
            textAlign:
              x: center
          children:
            - type: view
              style:
                width: "auto"
                height: "0.022"
              children:
                - type: image
                  path: redWarning.svg
                  style:
                    height: "0.022"
                    display: "inline-block"
                    verticalAlign: middle
                - type: label
                  text: " The appointment will be changed from&nbsp;"
                  style:
                    marginLeft: "0.01"
                    display: "inline-block"
                    height: "auto"
                    fontSize: .Nfont.h14
                    verticalAlign: middle
        - type: view
          style:
            marginTop: "0.005"
            width: "0.9"
            marginLeft: "0.04"
            height: "auto"
            textAlign:
              x: center
          children:
            - type: view
              style:
                width: "auto"
                height: "auto"
              children:
                - type: label
                  text=func: .builtIn.string.formatUnixtimeL_en
                  dataKey: Global.roomInfo.edge.stime
                  style:
                    display: "inline-block"
                    color: "0x69AAD8"
                    fontSize: .Nfont.h16
                    height: "auto"
                    width: "auto"
                    verticalAlign: middle
                - type: label
                  text=func: .builtIn.string.formatUnixtimeLT_en
                  dataKey: Global.roomInfo.edge.stime
                  style:
                    marginLeft: "0.01"
                    display: "inline-block"
                    width: "auto"
                    color: "0x69AAD8"
                    fontSize: .Nfont.h16
                    height: "auto"
                    verticalAlign: middle
                - type: label
                  text: "to"
                  style:
                    display: "inline-block"
                    marginLeft: "0.01"
                    width: "auto"
                    height: "auto"
                    fontSize: .Nfont.h16
                    verticalAlign: middle
                - type: label
                  text=func: .builtIn.string.formatUnixtimeL_en
                  dataKey: Global.clock.stime
                  style:
                    marginLeft: "0.01"
                    display: "inline-block"
                    width: "auto"
                    color: "0x69AAD8"
                    fontSize: .Nfont.h16
                    height: "auto"
                    verticalAlign: middle
                - type: label
                  text=func: .builtIn.string.formatUnixtimeLT_en
                  dataKey: Global.clock.stime
                  style:
                    marginLeft: "0.01"
                    display: "inline-block"
                    width: "auto"
                    color: "0x69AAD8"
                    fontSize: .Nfont.h16
                    height: "auto"
                    verticalAlign: middle
        - type: label
          text: An email will be sent to other participants.
          style:
            marginTop: "0.005"
            width: "0.9"
            marginLeft: "0.04"
            height: "auto"
            color: "0x000000"
            fontSize: .Nfont.h14
            textAlign:
              x: center

        - type: view
          style:
            width: "0.9"
            marginLeft: "0.05"
            marginTop: "0.03"
            height: "0.09"
          children:
            - type: button
              viewTag: buttonView
              text: "Change Appointment"
              style:
                width: "0.8"
                height: "0.05"
                color: "0xffffff"
                fontSize: .Nfont.n2
                marginLeft: "0.05"
                marginTop: "0.025"
                textAlign:
                  x: center
                lineHeight: "5vh"
                border:
                  style: "3"
                borderWidth: "1"
                backgroundColor: "0x2988e6"
                boxShadow: "0 0 1px 1px #7bb3f2"
                borderColor: "0x65a9ee"
                borderRadius: "5"
              onClick:
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =.Global.subtype
                              string2: 196616
                        # change telemedicine log
                        - =.builtIn.utils.createAuditLog:
                            dataIn:
                              actionTypeCode: =.ActionTypeCode.change
                              recordTypeCode: =.EdgeType.scheduleSubtype.Telemedicine
                              eid: =.Global.formData.currentFacility.relationEdge.id
                              user: =.Global.MyProfile.name.data.fullName
                              userId: =.Global.currentUser.vertex.id
                              targetUserId: =.Global.formData.currentMeetingPatientProfile.bsig
                              targetUser: =.Global.formData.currentMeetingPatientProfile.name.data.basicInfo.fullName
                              accessPort: provider
                        - actionType: evalObject
                          object:
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =.Global.subtype
                                      string2: 131080
                                # change office visit log
                                - =.builtIn.utils.createAuditLog:
                                    dataIn:
                                      actionTypeCode: =.ActionTypeCode.change
                                      recordTypeCode: =.EdgeType.scheduleSubtype.Office
                                      eid: =.Global.formData.currentFacility.relationEdge.id
                                      user: =.Global.MyProfile.name.data.fullName
                                      userId: =.Global.currentUser.vertex.id
                                      targetUserId: =.Global.formData.currentMeetingPatientProfile.bsig
                                      targetUser: =.Global.formData.currentMeetingPatientProfile.name.data.basicInfo.fullName
                                      accessPort: provider
                                # change room log
                                - =.builtIn.utils.createAuditLog:
                                    dataIn:
                                      actionTypeCode: =.ActionTypeCode.change
                                      recordTypeCode: =.EdgeType.scheduleSubtype.RoomType
                                      eid: =.Global.formData.currentFacility.relationEdge.id
                                      user: =.Global.MyProfile.name.data.fullName
                                      userId: =.Global.currentUser.vertex.id
                                      targetUserId: =.Global.formData.currentMeetingPatientProfile.bsig
                                      targetUser: =.Global.formData.currentMeetingPatientProfile.name.data.basicInfo.fullName
                                      accessPort: provider
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..formData.dataObject.evid
                              string2: =.Global.currentUser.vertex.id
                        - actionType: evalObject
                          object:
                            - ..formData.patientId@: =..formData.dataObject.bvid
                            - ..formData.FacilityId@: =..formData.dataObject.name.facilityId
                        - actionType: evalObject
                          object:
                            - ..formData.patientId@: =..formData.dataObject.evid
                            - ..formData.FacilityId@: =..formData.dataObject.name.facilityId
                - actionType: evalObject
                  object:
                    - =..apiRequest.changeTime.edgeAPI.store: ""
                - actionType: evalObject
                  object:
                    # change to patient jwt
                    #                    - =.builtIn.FCM.getAPPID:
                    #                        dataIn:
                    #                          appName: =.TargetApp.patient
                    #                        dataOut: FirebaseToken.edge.evid
                    #                    - actionType: evalObject
                    #                      object: .Global.updateJwt
                    - ..sendNotification.document.fid@: =.Global.patdAPPID
                    - ..sendNotification.document.eid@: =..apiRequest.changeTime.edgeCreateResp.edge.id
                    #send Notification
                    - =..sendNotification.docAPI.store: ""
                    # change the jwt back
                #                    - =.builtIn.FCM.getAPPID:
                #                        dataIn:
                #                          appName: =.AppName
                #                        dataOut: FirebaseToken.edge.evid
                #                    - actionType: evalObject
                #                      object: .Global.updateJwt
                #                    - =.Global.jwt.edgeAPI.store: ""
                # 发patients
                - actionType: evalObject
                  object:
                    - =.builtIn.array.add:
                        dataIn:
                          object: =..apiRequest.relation.edgeReq.id
                          value: =..formData.patientId
                    - =.builtIn.array.add:
                        dataIn:
                          object: =..apiRequest.relation.edgeReq.id
                          value: =.Global.currentUser.vertex.id

                - actionType: evalObject
                  object:
                    - =.builtIn.string.concat:
                        dataIn:
                          - "The appointment will be changed from "
                          - =.Global.MyProfile.name.data.fullName
                          - ","
                          - =..formData.clock.sdateTranslated
                          - ","
                          - =..formData.clock.stimeTranslated
                          - " to "
                          - =..formData.clock.edateTranslated
                          - ","
                          - =..formData.clock.etimeTranslated
                          - "."
                        dataOut: CreateAppointmentNewNext.formData.Emailcontent

                    - =..apiRequest.relation.edgeAPI.get: ""
                    - ..apiRequest.changeEmail.docReq.name.data.receiverName@: =..formData.dataObject.name.patientName
                    - ..apiRequest.changeEmail.docReq.name.data.receiverAvatarId@: =..apiRequest.patientProfile.docReponse.doc.0.name.data.basicInfo.avatar
                    - ..apiRequest.changeEmail.docReq.name.data.receiverId@: =..formData.patientId
                    - ..apiRequest.changeEmail.docReq.name.data.content@: =..formData.Emailcontent
                    - ..apiRequest.changeEmail.docReq.eid@: =..apiRequest.relation.edgeRes.edge.0.id
                    - if:
                        - =..apiRequest.changeTime.edgeCreateResp.edge.id
                        - =..apiRequest.changeEmail.docAPI.store: ""
                        - continue
                # 发facility
                - actionType: evalObject
                  object:
                    - ..apiRequest.relation.edgeRes.edge@: ""
                    - ..apiRequest.relation.edgeReq.id@: []
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =.Global.roomInfo.edge.name.visitType
                              string2: "Telemedicine"
                        - =.builtIn.array.add:
                            dataIn:
                              object: =..apiRequest.relation.edgeReq.id
                              value: =..formData.FacilityId
                        - actionType: evalObject
                          object:
                            - ..apiRequest.getFacility.vertex.id@: =.Global.clock.bvid
                            - =..apiRequest.getFacility.vertexAPI.get: ""
                            - =.builtIn.array.add:
                                dataIn:
                                  object: =..apiRequest.relation.edgeReq.id
                                  value: =..apiRequest.getFacility.response.vertex.0.id
                    - =.builtIn.array.add:
                        dataIn:
                          object: =..apiRequest.relation.edgeReq.id
                          value: =.Global.currentUser.vertex.id
                - actionType: evalObject
                  object:
                    - =..apiRequest.relation.edgeAPI.get: ""
                    - ..apiRequest.changeEmail.docReq.name.data.receiverName@: =..apiRequest.facility.response.doc.0.name.data.basicInfo.medicalFacilityName
                    - ..apiRequest.changeEmail.docReq.name.data.receiverAvatarId@: =..apiRequest.facility.response.doc.0.name.data.basicInfo.businessLogo
                    - ..apiRequest.changeEmail.docReq.name.data.receiverId@: =..formData.FacilityId
                    - ..apiRequest.changeEmail.docReq.name.data.content@: =..formData.Emailcontent
                    - ..apiRequest.changeEmail.docReq.eid@: =..apiRequest.relation.edgeRes.edge.0.id
                    - if:
                        - =..apiRequest.changeTime.edgeCreateResp.edge.id
                        - =..apiRequest.changeEmail.docAPI.store: ""
                        - continue
                - actionType: evalObject
                  object:
                    - .Global.ids@: []
                    - =.builtIn.array.concat:
                        dataIn:
                          array1: =.Global.ids
                          array2: =.Global.formData.currentFacility.alllocationId
                        dataOut: Global.ids
                    - =.builtIn.array.push:
                        dataIn:
                          messages: =.Global.ids
                          newMessage: =.Global.currentFacility.id
                        dataOut: Global.ids
                    - =.builtIn.array.push:
                        dataIn:
                          messages: =.Global.ids
                          newMessage: =.Global.currentUser.vertex.id
                        dataOut: Global.ids
                    - =.builtIn.string.concat:
                        dataIn:
                          - " E2.type=40000 AND E.subtype in (0x20006,0x30006,0x20064,0x30064) AND E.type=40000 AND E.tage&0x100 in (0)"
                        dataOut: Global.queryScondition
                    - =.builtIn.string.concat:
                        dataIn:
                          - "E.type = 1053 AND E.subtype in (110,120,130,140) AND E2.type=40000 AND E2.tage&0x100 in (0) AND E2.subtype in (0x20006,0x30006,0x20064,0x30064,0x60006,0x60064,0xa0006,0xa0064,0xc0006,0xc0064)"
                        dataOut: Global.queryScondition_participants
                - actionType: popUp
                  popUpView: success
                  wait: 2000
                - goto: WaitingRoom
    - type: popUp
      message: "Change Successfully!"
      viewTag: success
      colorChange: "0x30b354"
      imgPath: popUpSuccess.svg
      style:
        top: 0
        width: "1"
        height: "1"
        backgroundColor: "#00000040"
        zIndex: "1000"
      children:
        - type: view
          style:
            width: "0.6"
            height: "0.2"
            top: "0.3"
            left: "0.2"
            zIndex: "100"
            backgroundColor: "#e8e8e8"
            borderRadius: "7"
            border:
              style: "3"
            borderColor: "#f4f8fa"
            borderWidth: "3"
          children:
            - .BaseCheckViewImg:
              style:
                width: "0.12"
                top: "0.05"
                left: "0.25"
            - .BaseCheckViewLabel:
              style:
                width: "0.6"
                fontSize: 5vw
                top: "0.13"
                textAlign:
                  x: center
