ProgressReportPrivate:
  title: Progress Report
  pageNumber:
  init: #Page initialization
    - .SignInCheck
    - =.builtIn.date.currentDateTime:
        dataIn:
        dataOut: Global.formData.auditLog.startTime
    - .Global.formData.lastPage@: ProviderNotes
    # 判断是否从PatientAmendmentRequest进入
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.formData.unPageName
              string2: "PatientAmendmentRequest"
        - actionType: evalObject
          object:
            - ..formDataTemp.originalBtnShow@: "none"
            - ..formDataTemp.updateBtnShow@: "block"
        - actionType: evalObject
          object:
            - ..formDataTemp.originalBtnShow@: "block"
            - ..formDataTemp.updateBtnShow@: "none"
    # 判断本地会议是否有diagnoses存在,存在update,否则create
    - if:
        - =.Global.formData.providerDoc.diagnosesDoc.id
        - actionType: evalObject
          object:
            - ..apiRequest.diagnosesDoc.docReq@: =.Global.formData.providerDoc.diagnosesDoc
        - actionType: evalObject
          object:
            - =.ProgressReportPrivate.apiRequest.diagnosesDoc.docAPI.store: ""
            - ..apiRequest.diagnosesDoc.docReq@: =.ProgressReportPrivate.apiRequest.diagnosesDoc.docResp.doc
            - .Global.formData.providerDoc.diagnosesDoc@: =.ProgressReportPrivate.apiRequest.diagnosesDoc.docResp.doc
    - actionType: evalObject
      object:
        - if:
            - =.Global.Note.id
            - actionType: evalObject
              object:
                - ..apiRequest.progressReport.docCreateReq@: =.Global.Note
                - ..apiRequest.progressReport.docCreateReq.name.data.superbill@: =.Global.formData.superbillComplete
            - continue
    # 判断是否签名
    - if:
        - =..apiRequest.progressReport.docCreateReq.name.data.whetherSignature
        - continue
        - actionType: evalObject
          object:
            - ..formData.signatureTime@: =.ProgressReportPrivate.apiRequest.progressReport.docCreateReq.name.data.signatureTime
            - ..formData.temporarySignature@: =.ProgressReportPrivate.apiRequest.progressReport.docCreateReq.name.data.signatureId
            - ..formData.flag@: "block"

    - actionType: evalObject
      object:
        - =.builtIn.array.getListLength:
            dataIn:
              object: =..apiRequest.diagnosesDoc.docReq.name.data.diagnosis.descriptiveList
            dataOut: ProgressReportPrivate.formData.listDatalength
    - actionType: evalObject
      object:
        - if:
            - =.builtIn.string.equal:
                dataIn:
                  string1: =..formData.listDatalength
                  string2: "0"
            - continue
            - ..formData.listDataflag@: "block"
  formData: #Input data here
    diagnosesCodeList: []
    socialHistory: []
    flag: "none"
    selectedDiagnosis: ""
    temporarySignature: ""
    whetherSignature: ""
    signatureTime: ""
    listDatalength: ""
    diagnosesFlag: "none"
    searchShow: "none"
    radioData:
      isRadio: ""
    diagnosis:
      descriptiveList:
        code: ""
        description: ""
        comment: ""

  formDataTemp: #Input data temp here, datatemp should not mix with formData
    originalBtnShow: "block"
    updateBtnShow: "none"
    allListInfo: []
    allListString: []
    allCodes: []
    allDescription: []

  apiRequest: #Input data request here
    # provider同意修改的email
    email:
      docCreateResp: ""
      docCreateReq:
        reid: .Global.email.esig
        tage: 8
        eid: ""
        type: .DocType.InboxMessage
        name:
          data:
            # 邮件内容
            content: ""
            # 收件人姓名,provider或admin的fullName
            receiverName: .Global.email.name.data.patientName
            # 固定，为aitmed系统回复
            senderName: automatic-reply@aitmed.com
            # 空，这样可以显示为aitmed-logo
            senderAvatarId: ""
            # 被质疑的记录的名字
            recordName: .Global.email.name.data.recordName
            # 执行这个操作的人员的fullName，可能是admin，也可能是provider
            executorName: .Global.MyProfile.name.data.fullName
            #邮件标题
          title: Patient Amendment Reply Notification
          #收件人头像的id
          user: ""
      docAPI:
        store:
          api: cd
          dataIn: ProgressReportPrivate.apiRequest.email.docCreateReq
          dataOut: ProgressReportPrivate.apiRequest.email.docCreateResp
    # provider和patient之间的10002
    relation:
      edgeQueryResp: ""
      edgeQueryReq:
        id:
          - .Global.currentUser.vertex.id
          - .Global.email.bsig
        xfname: (bvid,evid)|(evid,bvid)
        obfname: mtime
        type: .EdgeType.Email
        maxcount: 1
      edgeAPI:
        get:
          api: re
          dataIn: ProgressReportPrivate.apiRequest.relation.edgeQueryReq
          dataOut: ProgressReportPrivate.apiRequest.relation.edgeQueryResp
    newSign:
      docResp: ""
      docCreateReq: #DOC
        type: .DocType.DocumentSignature
        name:
          title: ""
          type: ..apiRequest.newSign.docCreateReq.subtype.mediaType
          data:
            size: ""
        eid: .Global.rootNotebookID
        fid: ""
        reid: ""
        subtype:
          mediaType: "" # mediaType : "image/jpeg"
      docAPI: # DOCAPI
        store:
          api: cd
          dataIn: ProgressReportPrivate.apiRequest.newSign.docCreateReq
          dataOut: ProgressReportPrivate.apiRequest.newSign.docResp
    progressReport:
      docCreateResp: ""
      docCreateReq:
        id: ""
        type: .DocType.ProgressReport
        eid: .Global.currentRoom.edge.id
        reid: ""
        subtype:
          mediaType: "application/json"
        name:
          title: "Progress Report"
          user: .Global.formData.providerTitle
          data:
            classTag:
              name: Provider
              fontColor: "0x30b354"
              backgroundColor: "0xe4f5e9"
              display: block
            statusTag:
              name: Private
              fontColor: "0x4c5264"
              backgroundColor: "0xececee"
              display: block
            facilityInfo: ""
            providerInfo: ""
            patientInfo: ""
            signatureId: ""
            signatureTime: ""
            whetherSignature: true
            reportInfo:
              historyOfIllness: ""
              allergies: ""
              socialHistory: ""
              medications: ""
              diagnosis:
                descriptiveList: []
              planAndRecommendations: ""
              bloodGlucose: ""
            objectiveFindings: ""
            imagingStudies: ""
            vitalSigns:
              BP: ""
              HR: ""
              RR: ""
              PO: ""
              temperature: ""
              height: ""
              weight: ""
              BMI: ""

      docAPI:
        .DocAPI: ""
        store:
          api: cd
          dataIn: ProgressReportPrivate.apiRequest.progressReport.docCreateReq
          dataOut: ProgressReportPrivate.apiRequest.progressReport.docCreateResp
    diagnosesDoc:
      docResp: ""
      docReq:
        eid: .Global.currentRoom.edge.id
        reid: .Global.roomInfo.edge.id
        type: .DocType.Diagnoses
        subtype:
          mediaType: "application/json"
        name:
          data:
            diagnosis:
              descriptiveList: []
      docAPI:
        .DocAPI: ""
        store:
          api: cd
          dataIn: ProgressReportPrivate.apiRequest.diagnosesDoc.docReq
          dataOut: ProgressReportPrivate.apiRequest.diagnosesDoc.docResp
  components:
    - .TipsOneLine:
      viewTag: checkDiagnosesRepeat
      message: "Do not add repeatedly"
    - .BasePublicHeader:
      children:
        - .BasePublicHeaderLeft:
          leftClick:
            - actionType: evalObject
              object:
                - =.builtIn.utils.createAuditLog:
                    dataIn:
                      actionTypeCode: .ActionTypeCode.edit
                      recordTypeCode: .DocType.ProgressReport
                      eid: =.Global.formData.currentFacility.relationEdge.id
                      date: =.Global.formData.auditLog.startTime
                      user: =.Global.MyProfile.name.data.fullName
                      userId: =.Global.currentUser.vertex.id
                      targetUserId: =.Global.formData.auditLog.patientId
                      targetUser: =.Global.formData.auditLog.patientName
                      accessPort: provider
                    dataOut: Global.formData.auditLog.result
                - if:
                    - =.builtIn.string.equal:
                        dataIn:
                          string1: =..formDataTemp.updateBtnShow
                          string2: "block"
                    - actionType: popUp
                      popUpView: judgmentOperation
                    - actionType: builtIn
                      funcName: goBack
                      reload: true
        - .BasePublicHeaderTitle:
        - .BasePublicHeaderRightText:
          onClick:
            # 处理Diagnosis
            - actionType: evalObject
              object:
                - .Global.formData.providerDoc.diagnosesDoc@: =..apiRequest.diagnosesDoc.docReq
            # 签名处理
            - actionType: saveSignature
              dataObject: BLOB
              dataKey: ProgressReportPrivate.apiRequest.newSign.docCreateReq.name.data
              isEmpty: ProgressReportPrivate.formData.whetherSignature
            # 保存签名
            - actionType: evalObject
              object:
                - ..apiRequest.newSign.docCreateReq.reid@: =.ProgressReportPrivate.apiRequest.progressReport.docCreateReq.id

            - actionType: evalObject
              object:
                - if:
                    - =..formData.whetherSignature
                    - continue
                    - =..apiRequest.newSign.docAPI.store: ""

            - actionType: evalObject
              object:
                - if:
                    - =..formData.temporarySignature
                    - actionType: evalObject
                      object:
                        - ..apiRequest.progressReport.docCreateReq.name.data.signatureTime@: =..formData.signatureTime
                        - ..apiRequest.progressReport.docCreateReq.name.data.signatureId@: =..formData.temporarySignature
                        - ..apiRequest.progressReport.docCreateReq.name.data.whetherSignature@: false
                        - ..formData.whetherSignature@: false
                    - actionType: evalObject
                      object:
                        - ..apiRequest.progressReport.docCreateReq.name.data.signatureTime@: =..apiRequest.newSign.docResp.doc.ctime
                        - ..apiRequest.progressReport.docCreateReq.name.data.signatureId@: =..apiRequest.newSign.docResp.doc.id
                        - ..apiRequest.progressReport.docCreateReq.name.data.whetherSignature@: =..formData.whetherSignature
            - actionType: evalObject
              object:
                - =.ProgressReportPrivate.apiRequest.progressReport.docAPI.store: ""
                - .Global.Note@: =..apiRequest.progressReport.docCreateResp.doc
                - goto: ProviderMacros
    - type: scrollView
      style:
        width: "1"
        height: "0.846"
        overflow: scroll

      children:
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.0246"
            height: "auto"
            width: "0.92"
          children:
            - type: image
              path: office-building.svg
              path=func: .builtIn.utils.prepareDocToPath
              dataKey: apiRequest.progressReport.docCreateReq.name.data.facilityInfo.facilityAvatarID
              style:
                verticalAlign: middle
                display: "inline-block"
                height: "0.0578"
                width: "5.78vh"
            - type: view
              style:
                verticalAlign: middle
                marginLeft: "0.08"
                display: "inline-block"
                height: "auto"
                width: "0.71"
                overflow: hidden
              children:
                - type: label
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.facilityInfo.facilityName
                  style:
                    width: "0.71"
                    height: "auto"
                    fontSize: .Nfont.h20
                    fontWeight: "600"

                    verticalAlign: middle
                    wordBreak: "break-word"
                - type: label
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.facilityInfo.location
                  style:
                    marginTop: "0.0110"
                    width: "0.71"
                    height: "auto"
                    fontSize: .Nfont.h14
                    color: "0x666666"

                    verticalAlign: middle
        - type: view
          style:
            width: "0.92"
            height: "auto"
            marginTop: "0.015"
            marginLeft: "0.04"
            overflow:
          children:
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: Email
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.facilityInfo.email
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: Website
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.facilityInfo.website
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Main #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.facilityInfo.phone
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Fax #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.facilityInfo.fax

        - .DocPublicLine:

        - type: view
          style:
            width: "0.92"
            height: "auto"
            marginTop: "0.0222"
            marginLeft: "0.04"
            overflow: "hidden"
          children:
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Exam Date
                - .DocPublicStyleTwoRight:
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.patientInfo.examDate
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Patient Name
                - .DocPublicStyleTwoRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.patientInfo.patientName
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Date of Birth
                - .DocPublicStyleTwoRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.patientInfo.dob
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Phone #"
                - .DocPublicStyleTwoRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.patientInfo.phone
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Email"
                - .DocPublicStyleTwoRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.patientInfo.email
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Patient Address"
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.patientInfo.address
                  style:
                    height: "auto"
                    width: "0.92"
                    fontSize: .Nfont.h14
                    wordBreak: break-word
                    color: "0x333333"
                    fontWeight: "600"

        - .DocPublicLine:
        - type: view
          style:
            marginTop: "0.0222"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
          children:
            - type: label
              text: "History of Present lllness / Subject Complaints"
              dataKey:
              style:
                fontSize: .Nfont.h14
                fontWeight: "600"
                width: "0.92"
                textAlign:
                  X: "left"
                  y: "center"
                color: "#333333"
        - type: textView
          placeholder: "Enter here"
          dataKey: apiRequest.progressReport.docCreateReq.name.data.reportInfo.historyOfIllness
          style:
            width: "0.92"
            height: "0.0874"
            marginLeft: "0.04"
            marginTop: "0.01"
            borderColor: "#dedede"

            fontSize: .Nfont.h14
            borderRadius: "4"
            padding: "6px 12px"
            border:
              style: "3"
            borderWidth: "1"
            boxSizing: "border-box"
        # Allergies
        - type: label
          text: "Allergies"
          dataKey:
          style:
            width: "0.92"
            marginTop: "0.0222"
            marginLeft: "0.04"

            fontSize: .Nfont.h14
            fontWeight: "600"
        - type: textView
          placeholder: "Enter here"
          dataKey: apiRequest.progressReport.docCreateReq.name.data.reportInfo.allergies
          style:
            width: "0.92"
            height: "0.087"
            marginTop: "0.01"
            marginLeft: "0.04"

            fontSize: .Nfont.h14
            borderRadius: "4"
            borderColor: "#dedede"
            boxSizing: "border-box"
            padding: "6px 12px"
            border:
              style: "3"
            borderWidth: "1"
        # Social History
        - type: view
          style:
            width: "0.92"
            height: "auto"
            marginTop: "0.0222"
            marginLeft: "0.04"
          children:
            - type: label
              text: "Social History"
              dataKey:
              style:
                width: "0.92"
                fontSize: .Nfont.h14
                fontWeight: "600"

                textAlign:
                  x: "left"

            - type: textView
              placeholder: "Enter here"
              dataKey: apiRequest.progressReport.docCreateReq.name.data.reportInfo.socialHistory
              style:
                width: "0.92"
                height: "0.087"

                fontSize: .Nfont.h14
                marginTop: "0.01"
                borderRadius: "4"
                borderColor: "#dedede"
                border:
                  style: "3"
                borderWidth: "1"
                boxSizing: "border-box"
                padding: "6px 12px"

        # Medications
        - type: view
          style:
            width: "0.92"
            height: "auto"
            marginTop: "0.0222"
            marginLeft: "0.04"
          children:
            - type: label
              text: "Medications"
              dataKey:
              style:
                width: "0.92"

                fontSize: .Nfont.h14
                fontWeight: "600"
                textAlign:
                  x: "left"
            - type: textView
              placeholder: "Enter here"
              dataKey: apiRequest.progressReport.docCreateReq.name.data.reportInfo.medications
              style:
                width: "0.92"
                height: "0.087"

                fontSize: .Nfont.h14
                marginTop: "0.01"
                borderRadius: "4"
                borderColor: "#dedede"
                border:
                  style: "3"
                borderWidth: "1"
                boxSizing: "border-box"
                padding: "6px 12px"
        # Objective Findings
        - type: view
          style:
            width: "0.92"
            height: "auto"
            marginTop: "0.0222"
            marginLeft: "0.04"
          children:
            - type: label
              text: "Objective Findings"
              dataKey:
              style:
                width: "0.92"

                fontSize: .Nfont.h14
                fontWeight: "600"
                textAlign:
                  x: "left"
        # 文本 Vital Signs
        - type: view
          style:
            ..style.vital:
          children:
            - type: label
              text: "Vital Signs"
              dataKey:
              style:
                width: "0.45"

                fontSize: .Nfont.h14
                fontWeight: "600"
                textAlign:
                  x: "left"
        # Blood
        - type: view
          style:
            ..style.signBox:

          children:
            - type: label
              text: "Blood Pressure (mmHg)"
              dataKey:
              style:
                ..style.signTitle:

            - type: label
              text: "Heart Rate (bpm)"
              dataKey:
              style:
                ..style.signTitle:

        - type: view
          style:
            width: "0.92"
            height: "auto"
            marginTop: "0.01"
            marginLeft: "0.04"
          children:
            - type: textField
              placeholder: "Enter here"
              dataKey: apiRequest.progressReport.docCreateReq.name.data.vitalSigns.BP
              style:
                width: "0.44"
                height: "0.037"

                fontSize: .Nfont.h14
                textIndent: "12px"
                border:
                  style: "3"
                borderWidth: "1"
                borderColor: "#dedede"
                borderRadius: "4"
                boxSizing: "border-box"
                display: "inline-block"
            - type: textField
              placeholder: "Enter here"
              dataKey: apiRequest.progressReport.docCreateReq.name.data.vitalSigns.HR
              style:
                width: "0.44"
                height: "0.037"
                marginLeft: "0.04"

                fontSize: .Nfont.h14
                textIndent: "12px"
                border:
                  style: "3"
                  width: "1px"
                borderColor: "#dedede"
                borderRadius: "4"
                boxSizing: "border-box"
                display: "inline-block"
        #Respiratory Rate
        - type: view
          style:
            ..style.signBox:

          children:
            - type: label
              text: "Respiratory Rate (breaths/min)"
              dataKey:
              style:
                ..style.signTitle:

            - type: label
              text: "Pulse Oximetry (O₂ %)"
              dataKey:
              style:
                ..style.signTitle:

        - type: view
          style:
            width: "0.92"
            height: "auto"
            marginTop: "0.01"
            marginLeft: "0.04"
          children:
            - type: textField
              placeholder: "Enter here"
              dataKey: apiRequest.progressReport.docCreateReq.name.data.vitalSigns.RR
              style:
                width: "0.44"
                height: "0.037"

                fontSize: .Nfont.h14
                textIndent: "12px"
                border:
                  style: "3"
                  width: "1px"
                borderColor: "#dedede"
                borderRadius: "4"
                boxSizing: "border-box"
                display: "inline-block"
            - type: textField
              placeholder: "Enter here"
              dataKey: apiRequest.progressReport.docCreateReq.name.data.vitalSigns.PO
              style:
                width: "0.44"
                height: "0.037"
                marginLeft: "0.04"

                fontSize: .Nfont.h14
                textIndent: "12px"
                border:
                  style: "3"
                  width: "1px"
                borderColor: "#dedede"
                borderRadius: "4"
                boxSizing: "border-box"
                display: "inline-block"
        #Temperature
        - type: view
          style:
            ..style.signBox:

          children:
            - type: label
              text: "Temperature (°F/°C)"
              dataKey:
              style:
                ..style.signTitle:

            - type: label
              text: "Height (ft/in)"
              dataKey:
              style:
                ..style.signTitle:

        - type: view
          style:
            width: "0.92"
            height: "0.037"
            marginTop: "0.01"
            marginLeft: "0.04"
          children:
            - type: textField
              placeholder: "Enter here"
              dataKey: apiRequest.progressReport.docCreateReq.name.data.vitalSigns.temperature
              style:
                width: "0.44"
                height: "0.037"

                fontSize: .Nfont.h14
                textIndent: "12px"
                border:
                  style: "3"
                  width: "1px"
                borderColor: "#dedede"
                borderRadius: "4"
                boxSizing: "border-box"
                display: "inline-block"
            - type: textField
              placeholder: "Enter here"
              dataKey: apiRequest.progressReport.docCreateReq.name.data.vitalSigns.height
              style:
                width: "0.44"
                height: "0.037"
                marginLeft: "0.04"

                fontSize: .Nfont.h14
                textIndent: "12px"
                border:
                  style: "3"
                  width: "1px"
                borderColor: "#dedede"
                borderRadius: "4"
                boxSizing: "border-box"
                display: "inline-block"
        #Weight
        - type: view
          style:
            ..style.signBox:

          children:
            - type: label
              text: "Weight (lb)"
              dataKey:
              style:
                ..style.signTitle:

            - type: label
              text: "BMI (kg/m²)"
              dataKey:
              style:
                ..style.signTitle:

        - type: view
          style:
            width: "0.92"
            height: "auto"
            marginTop: "0.01"
            marginLeft: "0.04"
          children:
            - type: textField
              placeholder: "Enter here"
              dataKey: apiRequest.progressReport.docCreateReq.name.data.vitalSigns.weight
              style:
                width: "0.44"
                height: "0.037"

                fontSize: .Nfont.h14
                textIndent: "12px"
                border:
                  style: "3"
                  width: "1px"
                borderColor: "#dedede"
                borderRadius: "4"
                boxSizing: "border-box"
                display: "inline-block"
            - type: textField
              placeholder: "Enter here"
              dataKey: apiRequest.progressReport.docCreateReq.name.data.vitalSigns.BMI
              style:
                width: "0.44"
                height: "0.037"
                marginLeft: "0.04"

                fontSize: .Nfont.h14
                textIndent: "12px"
                border:
                  style: "3"
                  width: "1px"
                borderColor: "#dedede"
                borderRadius: "4"
                boxSizing: "border-box"
                display: "inline-block"
        - type: label
          text: "Physical Examination"
          dataKey:
          style:
            marginTop: "0.01724"
            marginLeft: "0.04"
            width: "auto"

            fontSize: .Nfont.h14
            fontWeight: "600"
        - type: textView
          placeholder: "Enter here"
          dataKey: apiRequest.progressReport.docCreateReq.name.data.objectiveFindings
          style:
            ..style.objectiveFindings:

        # 文本 Labs
        - type: view
          style:
            width: "0.92"
            height: "auto"
            marginTop: "0.0222"
            marginLeft: "0.04"
          children:
            - type: label
              text: "Labs"
              dataKey:
              style:
                width: "0.45"

                fontSize: .Nfont.h14
                fontWeight: "600"
                textAlign:
                  x: "left"
        # 文本 Blood Glucose
        - type: view
          style:
            width: "0.92"
            height: "0.024"
            marginTop: "0.0135"
            marginLeft: "0.04"
          children:
            - type: label
              text: "Blood Glucose"
              dataKey:
              style:
                width: "0.45"

                fontSize: .Nfont.h12
                fontWeight: "600"
                textAlign:
                  x: "left"
        # 输入单行
        - type: textField
          placeholder: "Enter here"
          dataKey: apiRequest.progressReport.docCreateReq.name.data.reportInfo.bloodGlucose
          style:
            width: "0.92"
            height: "0.037"
            marginTop: "0.01"
            marginLeft: "0.04"
            border:
              style: "3"
            borderWidth: "1"
            borderColor: "#dedede"
            borderRadius: "4"
            boxSizing: "border-box"
            textIndent: "12px"

            fontSize: .Nfont.h14
            color: "0x333333"
        # Object Fidings
        - type: view
          style:
            width: "0.92"
            height: "auto"
            marginTop: "0.0123"
            marginLeft: "0.04"
          children:
            - type: label
              text: "Imaging Studies"
              dataKey:
              style:
                width: "0.92"

                fontSize: .Nfont.h14
                fontWeight: "600"
                textAlign:
                  x: "left"
            - type: textView
              placeholder: "Enter here"
              dataKey: apiRequest.progressReport.docCreateReq.name.data.imagingStudies
              style:
                width: "0.92"
                height: "0.087"
                marginTop: "0.01"
                borderRadius: "4"
                borderColor: "#dedede"

                fontSize: .Nfont.h14
                border:
                  style: "3"
                borderWidth: "1"
                boxSizing: "border-box"
                padding: "6px 12px"

        - type: view
          style:
            width: "1"
            height: "auto"
            overflow: "auto"
            marginTop: "0.0222"
          children:
            # Diagnoses
            - type: label
              text: "Diagnoses"
              dataKey:
              style:
                width: "0.92"
                height: "auto"
                marginLeft: "0.04"

                fontWeight: "600"
                fontSize: .Nfont.h14

            - type: view
              viewTag: searchBox
              style:
                marginLeft: "0.04"
                height: "auto"
                width: "0.92"
              children:
                - type: view
                  style:
                    marginTop: "0.01"
                    width: "0.92"
                    height: "auto"
                    boxSizing: border-box
                  children:
                    - type: view
                      viewTag: selectDateTag
                      style:
                        display: "inline-block"
                        height: "0.037"
                        width: "0.325"
                        boxSizing: border-box
                        border:
                          style: 3
                        borderRadius: "4"
                        borderWidth: "1.5"
                        borderColor: "#dedede"
                        overflow: hidden
                      children:
                        - type: image
                          path: ICDsearch.svg
                          style:
                            marginLeft: "0.016"
                            display: "inline-block"
                            height: "0.015"
                            verticalAlign: middle
                        - type: textField
                          viewTag: CodeListTag
                          placeholder: Search
                          dataKey: formData.diagnosis.descriptiveList.code
                          style:
                            marginLeft: "0.01"
                            display: "inline-block"
                            height: "0.037"
                            width: "0.24"
                            boxSizing: border-box
                            border:
                              style: 1
                            fontSize: .Nfont.h14
                            verticalAlign: middle

                            color: "0x333333"
                          onInput:
                            - actionType: evalObject
                              object:
                                - if:
                                    - =.builtIn.string.equal:
                                        dataIn:
                                          string1: =..formData.diagnosis.descriptiveList.code
                                          string2: ""
                                    - actionType: evalObject
                                      object:
                                        - ..formData.listDataflag@: "block"
                                        - ..formData.searchShow@: "none"
                                    - actionType: evalObject
                                      object:
                                        - ..formData.listDataflag@: "none"
                                        - ..formData.searchShow@: "block"
                            - actionType: evalObject
                              object:
                                - ..formDataTemp.allListInfo@: []
                                - ..formDataTemp.allListString@: []
                            - actionType: evalObject
                              object:
                                - =.builtIn.search.queryCode:
                                    dataIn:
                                      query: =..formData.diagnosis.descriptiveList.code
                                    dataOut: ProgressReportPrivate.formDataTemp.allListInfo
                                - ..formDataTemp.allListString@: =..formDataTemp.allListInfo
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: CodeTag
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: CodeTags
                            - actionType: builtIn
                              funcName: show
                              viewTag: CodeTag
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: listData
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: listData
                            - actionType: builtIn
                              funcName: show
                              viewTag: ShowTag
                            - actionType: popUp
                              popUpView: CodeTag
                              dismissOnTouchOutside: true
                            - actionType: builtIn
                              funcName: redraw
                              viewTag: searchShowTag

                    - type: textField
                      viewTag: descriptionTag
                      placeholder: Description
                      dataKey: formData.diagnosis.descriptiveList.description
                      style:
                        marginLeft: "0.02"
                        display: "inline-block"
                        height: "0.037"
                        width: "0.573"
                        textIndent: "12px"
                        boxSizing: border-box
                        border:
                          style: 3
                        borderRadius: "4"
                        borderWidth: "1.5"
                        borderColor: "#dedede"
                        fontSize: .Nfont.h14
                        color: "0x333333"
                - type: textView
                  viewTag: CommentsTag
                  placeholder: Comments
                  dataKey: formData.diagnosis.descriptiveList.comment
                  style:
                    marginTop: "0.01"
                    width: "0.92"
                    height: "0.0874"
                    boxSizing: border-box
                    border:
                      style: 3
                    borderRadius: "4"
                    borderWidth: "1.5"
                    borderColor: "#dedede"
                    fontSize: .Nfont.h14
                    color: "0x333333"
                    padding: "6px 12px"

            - type: label
              text: + add more
              style:
                marginLeft: "0.76"
                marginTop: "0.0073"
                fontSize: .Nfont.h14
                color: "0x1492e6"
                height: "auto"
                width: "auto"
                fontWeight: "600"
              onClick:
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.array.allComplete:
                            dataIn:
                              - =..formData.diagnosis.descriptiveList.code
                              - =..formData.diagnosis.descriptiveList.description
                        - continue
                        - actionType: popUp
                          popUpView: SearchWarning
                          wait: true
                          popUpDismiss: 2000

                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.array.containingValue:
                            dataIn:
                              object: =..apiRequest.diagnosesDoc.docReq.name.data.diagnosis.descriptiveList
                              key: code
                              value: =..formData.diagnosis.descriptiveList.code
                        - actionType: popUp
                          popUpView: repeatWarning
                          wait: true
                          popUpDismiss: 2000
                        - continue

                - emit:
                    actions:
                      - =.builtIn.array.add:
                          dataIn:
                            object: =..apiRequest.diagnosesDoc.docReq.name.data.diagnosis.descriptiveList
                            value: =..formData.diagnosis.descriptiveList
                - actionType: evalObject
                  object:
                    - ..formData.diagnosis.descriptiveList.code@: ""
                    - ..formData.diagnosis.descriptiveList.description@: ""
                    - ..formData.diagnosis.descriptiveList.comment@: ""
                - actionType: builtIn
                  funcName: redraw
                  viewTag: listData
                - actionType: builtIn
                  funcName: redraw
                  viewTag: CodeListTag
                - actionType: builtIn
                  funcName: redraw
                  viewTag: descriptionTag
                - actionType: builtIn
                  funcName: hide
                  viewTag: ShowTag
                - actionType: builtIn
                  funcName: show
                  viewTag: listData
                - actionType: builtIn
                  funcName: redraw
                  viewTag: CommentsTag
                - actionType: builtIn
                  funcName: hide
                  viewTag: CodeTag
            - type: view
              style:
                marginTop: "0.01"
                height: "auto"
                width: "0.92"
              children:
                - type: view
                  viewTag: listData
                  style:
                    marginLeft: "0.04"
                    width: "0.92"
                    height: "auto"
                    marginTop: "0.01477"
                    display: ..formData.listDataflag
                  children:
                    - type: list
                      viewTag: listData
                      contentType: listObject
                      listObject: ..apiRequest.diagnosesDoc.docReq.name.data.diagnosis.descriptiveList
                      iteratorVar: itemObject
                      style:
                        width: "0.92"
                        height: "auto"
                        margin: "0"
                      children:
                        - type: listItem
                          itemObject: ""
                          style:
                            width: "0.92"
                            height: "auto"
                            left: "0"
                            overflow: hidden
                          children:
                            - type: view
                              style:
                                marginTop: "0.01"
                                width: "0.92"
                                height: "auto"
                              children:
                                - type: image
                                  path: x.svg
                                  style:
                                    display: "inline-block"
                                    height: "0.025"
                                    zIndex: 10
                                    verticalAlign: top
                                  onClick:
                                    - actionType: popUp
                                      popUpView: BaseDelWarningView
                                    - actionType: updateObject
                                      dataKey: ProgressReportPrivate.formData.selectedDiagnosis
                                      dataObject: itemObject
                                - type: label
                                  dataKey: itemObject.code
                                  style:
                                    display: "inline-block"
                                    marginLeft: "0.02"
                                    height: "auto"
                                    width: "0.17"
                                    textAlign:
                                      x: left

                                    backgroundColor: "0xffffff"
                                    wordBreak: break-word
                                    fontSize: .Nfont.h14
                                    fontWeight: "550"
                                    verticalAlign: top
                                    color: "0x333333"
                                - type: label
                                  text: "-"
                                  style:
                                    # verticalAlign: middle
                                    display: "inline-block"
                                    width: "auto"
                                    height: "auto"
                                    fontSize: .Nfont.h2
                                - type: label
                                  dataKey: itemObject.description
                                  style:
                                    verticalAlign: top
                                    marginLeft: "0.015"
                                    display: "inline-block"
                                    height: "auto"
                                    width: "0.64"
                                    textAlign:
                                      x: left
                                    backgroundColor: "0xffffff"

                                    wordBreak: break-word
                                    fontSize: .Nfont.h14
                                    color: "0x333333"
                            - type: label
                              dataKey: itemObject.comment
                              style:
                                marginTop: "0.002"
                                marginLeft: "0.07"
                                width: "0.845"
                                height: "auto"
                                color: "0x666666"

                                wordBreak: break-word
                                fontSize: .Nfont.h14
            # 文本 plan
            - type: view
              style:
                width: "0.92"
                height: "auto"
                marginTop: "0.0222"
                marginLeft: "0.04"
              children:
                - type: label
                  text: "Plan And Recommendations"
                  dataKey:
                  style:
                    width: "0.92"
                    fontSize: .Nfont.h14
                    fontWeight: "600"
                - type: label
                  text: You can add recommendations after finishing this note
                  style:
                    width: "0.92"
                    height: "auto"
                    color: "0x333333"
                    fontSize: .Nfont.h14
                    lineHeight: "2.58vh"
                - type: label
                  text: "&#8226 Note"
                  style:
                    width: "0.92"
                    fontSize: .Nfont.h14
                    lineHeight: "2.58vh"
            # textView
            - type: textView
              placeholder: "Enter here"
              dataKey: apiRequest.progressReport.docCreateReq.name.data.reportInfo.planAndRecommendations
              style:
                width: "0.92"
                height: "0.0874"
                marginLeft: "0.04"
                marginTop: "0.01"
                borderRadius: "4"

                fontSize: .Nfont.h14
                borderColor: "#dedede"
                boxSizing: "border-box"
                border:
                  style: "3"
                  width: "1px"
                paddingTop: "7px"
                textIndent: "12px"
            # - type: view
            #   viewTag: defaultTag
            #   style:
            #     ..style.blockBox:
            #   children:
            #     - type: image
            #       path:
            #         ..event.checkBoxPath:
            #       style:
            #         ..style.img:
            #     - type: label
            #       text: Superbill
            #       onClick:
            #         # 签名处理
            #         - actionType: saveSignature
            #           dataObject: BLOB
            #           dataKey: ProgressReportPrivate.apiRequest.newSign.docCreateReq.name.data
            #           isEmpty: ProgressReportPrivate.formData.whetherSignature
            #         # 保存签名
            #         - actionType: evalObject
            #           object:
            #             - ..apiRequest.newSign.docCreateReq.reid@: =.ProgressReportPrivate.apiRequest.progressReport.docCreateReq.id

            #         - actionType: evalObject
            #           object:
            #             - if:
            #                 - =..formData.whetherSignature
            #                 - continue
            #                 - =..apiRequest.newSign.docAPI.store: ""

            #         - actionType: evalObject
            #           object:
            #             - if:
            #                 - =..formData.temporarySignature
            #                 - actionType: evalObject
            #                   object:
            #                     - ..apiRequest.progressReport.docCreateReq.name.data.signatureTime@: =..formData.signatureTime
            #                     - ..apiRequest.progressReport.docCreateReq.name.data.signatureId@: =..formData.temporarySignature
            #                     - ..apiRequest.progressReport.docCreateReq.name.data.whetherSignature@: false
            #                     - ..formData.whetherSignature@: false
            #                 - actionType: evalObject
            #                   object:
            #                     - ..apiRequest.progressReport.docCreateReq.name.data.signatureTime@: =..apiRequest.newSign.docResp.doc.ctime
            #                     - ..apiRequest.progressReport.docCreateReq.name.data.signatureId@: =..apiRequest.newSign.docResp.doc.id
            #                     - ..apiRequest.progressReport.docCreateReq.name.data.whetherSignature@: =..formData.whetherSignature
            #         - actionType: evalObject
            #           object:
            #             - =.ProgressReportPrivate.apiRequest.progressReport.docAPI.store: ""
            #             - .Global.Note@: =..apiRequest.progressReport.docCreateResp.doc

            #         - actionType: evalObject
            #           object:
            #             # 更新本地
            #             - .Global.formData.providerDoc.diagnosesDoc@: =..apiRequest.diagnosesDoc.docReq
            #             - .Global.formData.parentPage@: ProgressReportPrivate
            #         - actionType: evalObject
            #           object:
            #             - if:
            #                 - =..apiRequest.progressReport.docCreateReq.name.data.superbill
            #                 - goto: SuperbillReview
            #                 - goto: SelectSuperbill
            #       style:
            #         ..style.setLabel:

            - type: view
              viewTag: searchShowTag
              style:
                top: "0.07"
                left: "0.04"
                display: ..formData.searchShow
                width: "auto"
                height: "auto"
                backgroundColor: "0xffffff"
                borderRadius: "4"
                boxSizing: "border-box"
                boxShadow: "1px 1px 4px 1px #dededf"
                zIndex: "20"
              children:
                - type: view
                  viewTag: CodeTag
                  style:
                    display: "none"
                    width: "0.92"
                    height: "auto"

                    backgroundColor: "0xffffff"
                    zIndex: 10
                    borderRadius: "4"
                    boxSizing: "border-box"
                    boxShadow: "1px 1px 4px 1px #dededf"
                  children:
                    - type: view
                      viewTag: ShowTag
                      style:
                        width: "0.9"
                        height: "0.27"
                        marginLeft: "0.02"
                        overflow: scroll
                      children:
                        - type: list
                          contentType: listObject
                          listObject: ..formDataTemp.allListString
                          iteratorVar: itemObject
                          viewTag: CodeTags
                          style:
                            width: "0.9"
                            height: "0.27"
                            margin: "0"
                            marginTop: "0"
                          children:
                            - type: listItem
                              itemObject: ""
                              style:
                                width: "0.9"
                                marginTop: "0.002"
                                height: "auto"
                                overflow: hidden
                              children:
                                - type: label
                                  dataKey: itemObject.0.2
                                  style:
                                    width: "0.88"
                                    textIndent: 20px
                                    marginTop: "0.005"
                                    textAlign:
                                      x: left
                                      y: center
                                    height: "auto"
                                    fontSize: .Nfont.h14
                                    color: "0x143459"
                                    wordBreak: break-word
                                  onClick:
                                    - emit:
                                        dataKey:
                                          var: itemObject
                                        actions:
                                          - ..formData.diagnosis.descriptiveList.code@: $var.0.0
                                          - ..formData.diagnosis.descriptiveList.description@: $var.0.1
                                    - actionType: builtIn
                                      funcName: redraw
                                      viewTag: CodeListTag
                                    - actionType: builtIn
                                      funcName: redraw
                                      viewTag: descriptionTag
                                    - actionType: builtIn
                                      funcName: hide
                                      viewTag: ShowTag
                                    - actionType: builtIn
                                      funcName: redraw
                                      viewTag: listData
                                    - actionType: builtIn
                                      funcName: show
                                      viewTag: listData
                                    - actionType: builtIn
                                      funcName: hide
                                      viewTag: CodeTag
        - .DocPublicLine:
        # 签名
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.03"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - type: view
              style:
                height: "auto"
                width: "0.92"
              children:
                - type: label
                  text: "Signature"
                  style:
                    display: "inline-block"
                    width: "0.816"
                    fontSize: .Nfont.h14
                    height: "auto"
                    color: "0x333333"
                    fontWeight: "600"
                    wordWrap: break-word
                    textAlign:
                      x: left
                - type: label
                  text: "Clear"
                  style:
                    display: "inline-block"
                    width: "auto"
                    fontSize: .Nfont.h14
                    height: "auto"
                    color: "0xfb5051"
                  onClick:
                    - actionType: removeSignature
                      dataObject: BLOB
                      dataKey: ProgressReportPrivate.apiRequest.newSign.docCreateReq.name.data
                      viewTag: signatureTag
                    - actionType: evalObject
                      object:
                        - ..formData.temporarySignature@: ""
                        - ..formData.signatureTime@: ""
                        - ..formData.flag@: "none"
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: signatureTimeTag
                    - actionType: builtIn
                      funcName: hide
                      viewTag: signatureShowTag
                    - actionType: builtIn
                      funcName: show
                      viewTag: signatureTag

        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.01"
            height: "0.128"
            width: "0.9"
            border:
              style: "4"
              color: "0xa9a9a9"
            borderWidth: "2"
          children:
            - type: label
              text: X
              style:
                .SignLabelStyle:
            - type: canvas
              dataKey: ProgressReportPrivate.apiRequest.newSign.docCreateReq.name.data
              viewTag: signatureTag
              style:
                left: "0"
                width: "0.88"
                height: "0.128"
                overflow: scroll
            - type: image
              viewTag: signatureShowTag
              path=func: .builtIn.utils.prepareDocToPath
              dataKey: ProgressReportPrivate.formData.temporarySignature
              style:
                display: =..formData.flag
                left: "0"
                width: "0.88"
                top: "0"
                height: "0.128"
                overflow: scroll
                zIndex: "1000"
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.0146"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - type: view
              viewTag: signatureTimeTag
              style:
                display: ..formData.flag
                marginTop: "0.01"
                height: "auto"
                width: "0.92"
              children:
                - type: label
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.signatureTime
                  style:
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    fontSize: .Nfont.h12
                    color: "0x757575"
                    verticalAlign: middle
                - type: label
                  text: "Digitally Signed"
                  dataKey:
                  style:
                    marginLeft: "0.02"
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    fontSize: .Nfont.h12
                    color: "0x757575"
                    verticalAlign: middle
            - type: view
              style:
                marginTop: "0.01"
                width: "auto"
                height: "auto"
              children:
                - type: label
                  text: Date
                  style:
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    color: "0x666666"
                    fontSize: .Nfont.h12
                - type: label
                  text=func: .builtIn.string.formatUnixtimeL_en
                  dataKey: apiRequest.progressReport.docCreateReq.mtime
                  style:
                    marginLeft: "0.0373"
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    color: "0x333333"
                    fontSize: .Nfont.h12
                    fontWeight: "600"
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.0246"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - type: label
              dataKey: apiRequest.progressReport.docCreateReq.name.data.providerInfo.providerFullName
              style:
                height: "auto"
                width: "0.92"
                margin: "0px"
                color: "0x333333"
                fontSize: .Nfont.h16
                fontWeight: "600"
                wordBreak: break-word
            - type: label
              text:
              dataKey: apiRequest.progressReport.docCreateReq.name.data.providerInfo.specialty
              style:
                marginTop: "0.006"
                height: "auto"
                width: "0.92"
                color: "0x666666"
                fontSize: .Nfont.h14

                wordBreak: break-word

            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "LIC #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.providerInfo.lic
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "NPI #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.providerInfo.npi
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "DEA #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.providerInfo.dea
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Email"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.providerInfo.email
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Fax #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.facilityInfo.fax
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Main #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.facilityInfo.phone
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Address"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.progressReport.docCreateReq.name.data.facilityInfo.location
            - .DocPublicLine:
              style:
                marginTop: "0.0246"
                height: "0.00369"
        - type: label
          dataKey: apiRequest.progressReport.docCreateReq.name.data.facilityInfo.website
          style:
            marginTop: "0.01"
            width: "1"
            height: "auto"
            color: "0x666666"
            fontSize: .Nfont.h12
            textAlign:
              x: center
        - type: view
          style:
            marginTop: "0.03"
    - .BasePublicFooter:
      children:
        # 更新的逻辑
        - type: view
          style:
            display: =..formDataTemp.updateBtnShow
          children:
            - .DocButtonPrivate:
              text: Cancel
              onClick:
                - actionType: popUp
                  popUpView: judgmentOperation

            - .DocButtonRelease:
              text: Update & Send
              onClick:
                # 处理Diagnosis
                - actionType: evalObject
                  object:
                    # 同步线上
                    - =.ProgressReportPrivate.apiRequest.diagnosesDoc.docAPI.store: ""
                    # 更新本地
                    - .Global.formData.providerDoc.diagnosesDoc@: =.ProgressReportPrivate.apiRequest.diagnosesDoc.docResp.doc
                - actionType: saveSignature
                  dataObject: BLOB
                  dataKey: ProgressReportPrivate.apiRequest.newSign.docCreateReq.name.data
                  isEmpty: ProgressReportPrivate.formData.whetherSignature

                - actionType: evalObject
                  object:
                    - ..apiRequest.newSign.docCreateReq.reid@: =.ProgressReportPrivate.apiRequest.progressReport.docCreateResp.doc.id

                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.whetherSignature
                        - continue
                        - =..apiRequest.newSign.docAPI.store: ""

                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =.Global.formData.unPageName
                              string2: ""
                        - actionType: evalObject
                          object:
                            - ..apiRequest.progressReport.docCreateReq.eid@: =.Global.currentRoom.edge.id
                            - ..apiRequest.progressReport.docCreateReq.reid@: =.Global.roomInfo.edge.id
                        - continue

                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.temporarySignature
                        - actionType: evalObject
                          object:
                            - ..apiRequest.progressReport.docCreateReq.name.data.signatureTime@: =..formData.signatureTime
                            - ..apiRequest.progressReport.docCreateReq.name.data.signatureId@: =..formData.temporarySignature
                            - ..apiRequest.progressReport.docCreateReq.name.data.whetherSignature@: false
                            - ..formData.whetherSignature@: false
                        - actionType: evalObject
                          object:
                            - ..apiRequest.progressReport.docCreateReq.name.data.signatureTime@: =..apiRequest.newSign.docResp.doc.ctime
                            - ..apiRequest.progressReport.docCreateReq.name.data.signatureId@: =..apiRequest.newSign.docResp.doc.id
                            - ..apiRequest.progressReport.docCreateReq.name.data.whetherSignature@: =..formData.whetherSignature

                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.whetherSignature
                        - actionType: popUp
                          popUpView: BaseWarningView
                          wait: true
                          popUpDismiss: 2000
                        - continue

                - actionType: evalObject
                  object:
                    - =.builtIn.number.inhx:
                        dataIn:
                          intHex: =..apiRequest.progressReport.docCreateReq.type
                          index: 1
                          hex: 1
                        dataOut: ProgressReportPrivate.apiRequest.progressReport.docCreateReq.type

                - actionType: evalObject
                  object:
                    - =.builtIn.utils.createAuditLog:
                        dataIn:
                          date: =.Global.formData.auditLog.startTime
                          actionTypeCode: .ActionTypeCode.edit
                          recordTypeCode: .DocType.ProgressReport
                          eid: =.Global.formData.currentFacility.relationEdge.id
                          user: =.Global.MyProfile.name.data.fullName
                          userId: =.Global.currentUser.vertex.id
                          targetUserId: =.Global.formData.auditLog.patientId
                          targetUser: =.Global.formData.auditLog.patientName
                          accessPort: provider
                          amendment: Amendment
                          amendmentId: =.Global.email.esig
                        dataOut: Global.formData.auditLog.result

                # 邮件逻辑
                - actionType: evalObject
                  object:
                    - actionType: evalObject
                      async: true
                      object:
                        - =..apiRequest.progressReport.docAPI.store: ""
                        # 向patient发送accept的邮件
                        # 获取10002edge
                        - =..apiRequest.relation.edgeAPI.get: ""
                    - =.builtIn.string.concat:
                        dataIn:
                          - "Hello,"
                          - =.Global.MyProfile.name.data.fullName
                          - " has updated the "
                          - =.Global.email.name.data.recordName
                          - "."
                        dataOut: ProgressReportPrivate.apiRequest.email.docCreateReq.name.data.content
                    - ..apiRequest.email.docCreateReq.eid@: =..apiRequest.relation.edgeQueryResp.edge.0.id
                    - =..apiRequest.email.docAPI.store: ""
                - actionType: popUp
                  popUpView: successTag
                  wait: 2000

                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""

                - goto: MessageShow

        # 原来的逻辑
        - type: view
          style:
            display: =..formDataTemp.originalBtnShow
          children:
            - .DocButtonPrivate:
              onClick:
                # 处理Diagnosis
                - actionType: evalObject
                  object:
                    # 同步线上
                    - =.ProgressReportPrivate.apiRequest.diagnosesDoc.docAPI.store: ""
                    # 更新本地
                    - .Global.formData.providerDoc.diagnosesDoc@: =.ProgressReportPrivate.apiRequest.diagnosesDoc.docResp.doc
                - actionType: saveSignature
                  dataObject: BLOB
                  dataKey: ProgressReportPrivate.apiRequest.newSign.docCreateReq.name.data
                  isEmpty: ProgressReportPrivate.formData.whetherSignature

                - actionType: evalObject
                  object:
                    - ..apiRequest.newSign.docCreateReq.reid@: =.ProgressReportPrivate.apiRequest.progressReport.docCreateResp.doc.id

                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.whetherSignature
                        - continue
                        - =..apiRequest.newSign.docAPI.store: ""
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =.Global.formData.unPageName
                              string2: ""
                        - actionType: evalObject
                          object:
                            - ..apiRequest.progressReport.docCreateReq.eid@: =.Global.currentRoom.edge.id
                            - ..apiRequest.progressReport.docCreateReq.reid@: =.Global.roomInfo.edge.id
                        - continue

                - actionType: evalObject
                  object:
                    - =.builtIn.utils.createAuditLog:
                        dataIn:
                          date: =.Global.formData.auditLog.startTime
                          actionTypeCode: .ActionTypeCode.edit
                          recordTypeCode: .DocType.ProgressReport
                          eid: =.Global.formData.currentFacility.relationEdge.id
                          user: =.Global.MyProfile.name.data.fullName
                          userId: =.Global.currentUser.vertex.id
                          targetUserId: =.Global.formData.auditLog.patientId
                          targetUser: =.Global.formData.auditLog.patientName
                          accessPort: provider
                        dataOut: Global.formData.auditLog.result

                - actionType: evalObject
                  object:
                    - goto: MoreOptions

            - .DocButtonRelease:
              onClick:
                # 处理Diagnosis
                - actionType: evalObject
                  object:
                    # 同步线上
                    - =.ProgressReportPrivate.apiRequest.diagnosesDoc.docAPI.store: ""
                    # 更新本地
                    - .Global.formData.providerDoc.diagnosesDoc@: =.ProgressReportPrivate.apiRequest.diagnosesDoc.docResp.doc
                - actionType: saveSignature
                  dataObject: BLOB
                  dataKey: ProgressReportPrivate.apiRequest.newSign.docCreateReq.name.data
                  isEmpty: ProgressReportPrivate.formData.whetherSignature

                - actionType: evalObject
                  object:
                    - ..apiRequest.newSign.docCreateReq.reid@: =.ProgressReportPrivate.apiRequest.progressReport.docCreateResp.doc.id

                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.whetherSignature
                        - continue
                        - =..apiRequest.newSign.docAPI.store: ""

                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =.Global.formData.unPageName
                              string2: ""
                        - actionType: evalObject
                          object:
                            - ..apiRequest.progressReport.docCreateReq.eid@: =.Global.currentRoom.edge.id
                            - ..apiRequest.progressReport.docCreateReq.reid@: =.Global.roomInfo.edge.id
                        - continue
                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.temporarySignature
                        - actionType: evalObject
                          object:
                            - ..apiRequest.progressReport.docCreateReq.name.data.signatureTime@: =..formData.signatureTime
                            - ..apiRequest.progressReport.docCreateReq.name.data.signatureId@: =..formData.temporarySignature
                            - ..apiRequest.progressReport.docCreateReq.name.data.whetherSignature@: false
                            - ..formData.whetherSignature@: false
                        - actionType: evalObject
                          object:
                            - ..apiRequest.progressReport.docCreateReq.name.data.signatureTime@: =..apiRequest.newSign.docResp.doc.ctime
                            - ..apiRequest.progressReport.docCreateReq.name.data.signatureId@: =..apiRequest.newSign.docResp.doc.id
                            - ..apiRequest.progressReport.docCreateReq.name.data.whetherSignature@: =..formData.whetherSignature

                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.whetherSignature
                        - actionType: popUp
                          popUpView: BaseWarningView
                          wait: true
                          popUpDismiss: 2000
                        - continue

                - actionType: evalObject
                  object:
                    - =.builtIn.number.inhx:
                        dataIn:
                          intHex: =..apiRequest.progressReport.docCreateReq.type
                          index: 1
                          hex: 1
                        dataOut: ProgressReportPrivate.apiRequest.progressReport.docCreateReq.type

                - actionType: evalObject
                  object:
                    - =.builtIn.utils.createAuditLog:
                        dataIn:
                          actionTypeCode: .ActionTypeCode.edit
                          recordTypeCode: .DocType.ProgressReport
                          eid: =.Global.formData.currentFacility.relationEdge.id
                          date: =.Global.formData.auditLog.startTime
                          user: =.Global.MyProfile.name.data.fullName
                          userId: =.Global.currentUser.vertex.id
                          targetUserId: =.Global.formData.auditLog.patientId
                          targetUser: =.Global.formData.auditLog.patientName
                          accessPort: provider
                        dataOut: Global.formData.auditLog.result
                - actionType: popUp
                  popUpView: dialogueTag
    - .BaseWarningView:
      message: "Please complete required fields: Search&Description"
      viewTag: SearchWarning

    - .BaseWarningView:
      message: "You haven't signed the form"

    - .publicDeleteUP:
      viewTag: BaseDelWarningView
      leftButton:
        - actionType: popUpDismiss
          popUpView: BaseDelWarningView
      rightButton:
        - actionType: evalObject
          object:
            - =.builtIn.array.removeByName:
                dataIn:
                  object: =..apiRequest.diagnosesDoc.docReq.name.data.diagnosis.descriptiveList
                  key: code
                  name: =..formData.selectedDiagnosis.code
            - ..formData.listDataflag@: "block"
            - actionType: builtIn
              funcName: redraw
              viewTag: listData
        - actionType: popUpDismiss
          popUpView: BaseDelWarningView

    - .Normal:
      message: "Do you want the patient to see it?"
      viewTag: dialogueTag
      leftText: "No"
      rightText: "Yes"
      leftButton:
        - actionType: evalObject
          object:
            # 修改tage
            - ..apiRequest.progressReport.docCreateReq.tage@: 1
            - =..apiRequest.progressReport.docAPI.store: ""

        - actionType: evalObject
          object:
            .Global._nonce@:
              =.builtIn.math.random: ""

        - actionType: evalObject
          object:
            - goto: MoreOptions

        - actionType: popUpDismiss
          popUpView: dialogueTag
      rightButton:
        - actionType: evalObject
          object:
            # 更新文档状态
            - ..apiRequest.progressReport.docCreateReq.name.data.statusTag.name@: "Released"
            - ..apiRequest.progressReport.docCreateReq.name.data.statusTag.fontColor@: "0x2988e6"
            - ..apiRequest.progressReport.docCreateReq.name.data.statusTag.backgroundColor@: "0xdfedfc"

        - actionType: evalObject
          object:
            # 修改tage
            - ..apiRequest.progressReport.docCreateReq.tage@: -1
            - =..apiRequest.progressReport.docAPI.store: ""

        - actionType: evalObject
          object:
            .Global._nonce@:
              =.builtIn.math.random: ""

        - actionType: evalObject
          object:
            - goto: MoreOptions

        - actionType: popUpDismiss
          popUpView: dialogueTag

    - .BaseWarningView:
      message: "Do not add repeatedly"
      viewTag: repeatWarning

    - .SuccessfulOneLine:
      message: "Update Successfully!"
      viewTag: successTag

    - .Normal:
      message: "Cancel the changes?"
      viewTag: judgmentOperation
      leftButton:
        - actionType: popUpDismiss
          popUpView: judgmentOperation

      rightButton:
        # # 处理Diagnosis
        # - actionType: evalObject
        #   object:
        #     # 同步线上
        #     - =.ProgressReportPrivate.apiRequest.diagnosesDoc.docAPI.store: ""
        #     # 更新本地
        #     - .Global.formData.providerDoc.diagnosesDoc@: =.ProgressReportPrivate.apiRequest.diagnosesDoc.docResp.doc
        # - actionType: saveSignature
        #   dataObject: BLOB
        #   dataKey: ProgressReportPrivate.apiRequest.newSign.docCreateReq.name.data
        #   isEmpty: ProgressReportPrivate.formData.whetherSignature

        # - actionType: evalObject
        #   object:
        #     - ..apiRequest.newSign.docCreateReq.reid@: =.ProgressReportPrivate.apiRequest.progressReport.docCreateResp.doc.id

        # - actionType: evalObject
        #   object:
        #     - if:
        #         - =..formData.whetherSignature
        #         - continue
        #         - =..apiRequest.newSign.docAPI.store: ""

        # - actionType: evalObject
        #   object:
        #     - if:
        #         - =.builtIn.string.equal:
        #             dataIn:
        #               string1: =.Global.formData.unPageName
        #               string2: ""
        #         - actionType: evalObject
        #           object:
        #             - ..apiRequest.progressReport.docCreateReq.eid@: =.Global.currentRoom.edge.id
        #             - ..apiRequest.progressReport.docCreateReq.reid@: =.Global.roomInfo.edge.id
        #         - continue

        # - actionType: evalObject
        #   object:
        #     - if:
        #         - =..formData.temporarySignature
        #         - actionType: evalObject
        #           object:
        #             - ..apiRequest.progressReport.docCreateReq.name.data.signatureTime@: =..formData.signatureTime
        #             - ..apiRequest.progressReport.docCreateReq.name.data.signatureId@: =..formData.temporarySignature
        #             - ..apiRequest.progressReport.docCreateReq.name.data.whetherSignature@: false
        #             - ..formData.whetherSignature@: false
        #         - actionType: evalObject
        #           object:
        #             - ..apiRequest.progressReport.docCreateReq.name.data.signatureTime@: =..apiRequest.newSign.docResp.doc.ctime
        #             - ..apiRequest.progressReport.docCreateReq.name.data.signatureId@: =..apiRequest.newSign.docResp.doc.id
        #             - ..apiRequest.progressReport.docCreateReq.name.data.whetherSignature@: =..formData.whetherSignature

        # - actionType: evalObject
        #   object:
        #     - if:
        #         - =..formData.whetherSignature
        #         - actionType: popUp
        #           popUpView: BaseWarningView
        #           wait: true
        #           popUpDismiss: 2000
        #         - continue

        # - actionType: evalObject
        #   object:
        #     - =.builtIn.number.inhx:
        #         dataIn:
        #           intHex: =..apiRequest.progressReport.docCreateReq.type
        #           index: 1
        #           hex: 1
        #         dataOut: ProgressReportPrivate.apiRequest.progressReport.docCreateReq.type

        # - actionType: evalObject
        #   object:
        #     - =.builtIn.utils.createAuditLog:
        #         dataIn:
        #           actionTypeCode: .ActionTypeCode.edit
        #           recordTypeCode: .DocType.ProgressReport
        #           eid: =.Global.formData.currentFacility.relationEdge.id
        #           date: =.Global.formData.auditLog.startTime
        #           user: =.Global.MyProfile.name.data.fullName
        #           userId: =.Global.currentUser.vertex.id
        #           targetUserId: =.Global.formData.auditLog.patientId
        # targetUser: =.Global.formData.auditLog.patientName
        #           accessPort: provider
        #         dataOut: Global.formData.auditLog.result

        # # 邮件逻辑
        # - actionType: evalObject
        #   object:
        #     - actionType: evalObject
        #       async: true
        #       object:
        #         - =..apiRequest.progressReport.docAPI.store: ""
        #         # 向patient发送accept的邮件
        #         # 获取10002edge
        #         - =..apiRequest.relation.edgeAPI.get: ""
        #     - =.builtIn.string.concat:
        #         dataIn:
        #           - "Hello,"
        #           - =.Global.MyProfile.name.data.fullName
        #           - " has updated the "
        #           - =.Global.email.name.data.recordName
        #           - "."
        #         dataOut: ProgressReportPrivate.apiRequest.email.docCreateReq.name.data.content
        #     - ..apiRequest.email.docCreateReq.eid@: =..apiRequest.relation.edgeQueryResp.edge.0.id
        #     - =..apiRequest.email.docAPI.store: ""

        # - actionType: popUpDismiss
        #   popUpView: judgmentOperation

        # - actionType: popUp
        #   popUpView: successTag
        #   wait: 2000

        - actionType: evalObject
          object:
            .Global._nonce@:
              =.builtIn.math.random: ""

        - goto: MessageShow

  event:
    checkBoxPath:
      emit:
        actions:
          - if:
              - =..apiRequest.progressReport.docCreateReq.name.data.superbill
              - selectOnBlue.svg
              - selectOffBlue.svg
  style:
    signBox:
      width: "auto"
      height: "auto"
      marginTop: "0.0123"
      marginLeft: "0.04"
    signTitle:
      height: "auto"
      width: "0.48"

      fontSize: .Nfont.h12
      display: "inline-block"
      verticalAlign: top
    vital:
      width: "0.92"
      height: "0.02586"
      marginLeft: "0.04"
      marginTop: "0.014778"
    objectiveFindings:
      marginTop: "0.014778"
      marginLeft: "0.04"
      width: "0.92"
      height: "0.087"

      fontSize: .Nfont.h14
      borderRadius: "4"
      borderColor: "#dedede"
      border:
        style: "3"
      borderWidth: "1"
      boxSizing: "border-box"
      padding: "6px 12px"
    blockBox:
      marginTop: "0.024630"
      marginLeft: "0.04"
      width: "0.92"
      height: "auto"
      overflow: hidden
    img:
      display: "inline-block"
      height: "0.01970"
      verticalAlign: middle
    setLabel:
      display: "inline-block"
      marginLeft: "0.026666"
      height: "auto"
      width: "auto"
      fontSize: .Nfont.h14
      color: "#2988e6"
      fontWeight: "700"
      verticalAlign: middle
      textDecoration: underline
