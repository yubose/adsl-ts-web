VisitHistory:
  title: "Visit History"
  pageNumber: "260"
  init:
    - .SignInCheck
    - ..apiRequest.listRoomData.get
    - ..apiRequest.meetingList.get
    - actionType: evalObject
      object:
        - =.builtIn.array.concatArray:
            dataIn:
              array1: =..apiRequest.listRoomData.response.edge
              array2: =..apiRequest.meetingList.meetingListInfo.edge
              sortby: "stime"
              orders: "asc"
            dataOut: VisitHistory.formData.allHistoryRoom
  listData:
    WaitingInRoom:
      edge: ""
    get:
      api: re
      ObjType: 4
      dataKey: listData.WaitingInRoom
      id: .Global.currentUser.vertex.id
      sCondition: "E2.type=40000 AND E.subtype in (0x20006,0x30006,0x20064,0x30064) AND E.type=40000 AND E.tage&0x100 in (0)"
      xfname: "E.evid | E.bvid"
      obfname: "mtime"
      maxcount: "100"
      _nonce: .Global._nonce
  apiRequest:
    listRoomData:
      response: ""
      edge:
        ObjType: "4"
        id:
          - =.Global.currentUser.vertex.id
          - =.Global.currentFacility.id
        xfname: "E.evid,E.bvid"
        sCondition: "E.type=40000 AND E.subtype in (10) AND E2.subtype in (0x60006,0x60064,0xa0006,0xa0064,0xc0006,0xc0064) AND E2.tage&0x100 in (256) "
        maxcount: "100"
        obfname: "stime"
        asc: true
        _nonce: =.Global._nonce
      get:
        api: re
        dataIn: apiRequest.listRoomData.edge
        dataOut: apiRequest.listRoomData.response
    meetingList:
      meetingListInfo: ""
      edge:
        type: "40000"
        id: =.Global.ids
        xfname: "E2.evid,E2.Bvid"
        sCondition: "E2.type=40000 AND E.subtype in (0x20006,0x30006,0x20064,0x30064) AND E.type=40000 AND E.tage&0x100 in (256)"
        maxcount: "20000"
        obfname: "stime"
        ObjType: "20"
        asc: true
        _nonce: .Global._nonce
      get:
        api: re
        dataIn: apiRequest.meetingList.edge
        dataOut: apiRequest.meetingList.meetingListInfo
  formData:
    allHistoryRoom: ""
  components:
    - type: view
      style:
        left: "0"
        width: "1"
        top: "0"
        height: "1"
        # position: fixed
      children:
        - .BaseHeader:
        - .HeaderLeftButton:
          onClick:
            - goto: "Dashboard"
        - .Basesearch:
        - type: view
          style:
            width: "1"
            left: "0"
            height: "0.06"
            top: "0.16"
            border:
              style: "2"
            borderWidth: "1"
            borderColor: "0xe6e6e6"
          children:
            - type: label
              text: "Unfinished"
              onClick:
                - goto: Unfinished
              style:
                left: "0"
                top: "0.02"
                width: "0.5"
                height: "0.04"
                color: "0x2988e6"
                fontWeight: "400"
                textAlign:
                  x: center
            - type: label
              text: "Visit History"
              style:
                left: "0.5"
                top: "0.02"
                width: "0.5"
                height: "0.038"
                color: "0x2988e6"
                fontWeight: "700"
                border:
                  style: "2"
                  # width: "2"
                borderWidth: "1"
                borderColor: "0x2988e6"
                textAlign:
                  x: center

        - type: scrollView
          style:
            top: "0.22"
            # left: "0.05"
            width: "1"
            height: "0.78"
            backgroundColor: "#ffffff"
          children:
            - type: list
              contentType: listObject
              listObject: ..formData.allHistoryRoom
              iteratorVar: itemObject
              style:
                top: "0"
                left: "0"
                width: "1"
                height: "0.78"
                # backgroundColor: "0x00000066"
                margin: "0"
                overflow: scroll
                boxShadow: "0px 0px 1px #dededf"
              children:
                - type: listItem
                  itemObject: ""
                  onClick:
                    - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                      dataKey: Global.roomInfo.edge
                      dataObject: itemObject
                    - actionType: evalObject
                      object:
                        - .Global.formData.showBackButton.visitDetail@: "true"
                    - goto: VisitDetial
                  style:
                    left: "0"
                    width: "1"
                    height: "0.1"
                    border:
                      style: "2"
                    borderColor: "0x00000066"
                    borderWidth: "1"
                  children:
                    - type: label
                      dataKey: itemObject.name.visitReason
                      style:
                        top: "0.02"
                        fontSize: "18"
                        fontWeight: 400
                        left: "0.08"
                        # color: itemObject.name.fontColor
                    - type: label
                      dataKey: itemObject.name.patientName
                      style:
                        top: "0.055"
                        fontSize: .Nfont.h14
                        fontWeight: 350
                        left: "0.08"
                    - type: label
                      text=func: .builtIn.string.formatUnixtime_en
                      dataKey: itemObject.stime
                      style:
                        top: "0.055"
                        width: "0.47"
                        fontSize: .Nfont.h14
                        fontWeight: 350
                        left: "0.48"
                        textAlign:
                          x: right
                    - type: label
                      dataKey: itemObject.name.visitType
                      style:
                        top: "0.02"
                        fontSize: .Nfont.h16
                        fontWeight: 400
                        left: "0.5"
                        width: "0.45"
                        textAlign:
                          x: right
                        color: itemObject.name.fontColor
