InboxFolder:
  pageNumber: "90"
  title: .Global.inboxFolder.name.folderName
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        - =.builtIn.string.concat:
            dataIn:
              - "subtype!=3 AND subtype!=5 AND name like '%"
              - =.Global.inboxFolder.id
              - "%'"
            dataOut: Global.sCondition
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    #获取未读邮件数量
    - actionType: evalObject
      object:
        - =..apiRequest.unReadEmail.docAPI.get: ""
        - =.builtIn.array.getListLength:
            dataIn:
              object: =..apiRequest.unReadEmail.docQueryResp.doc
            dataOut: InboxFolder.formData.unReadEmailNum
        - if:
            - =.builtIn.string.equal:
                dataIn:
                  string1: =..formData.unReadEmailNum
                  string2: "0"
            - ..formData.inboxHidden@: "true"
            - ..formData.inboxHidden@: "false"
    # - ..emailList.get
    # - actionType: evalObject
    #   object:
    #     =.builtIn.array.getListLength:
    #         dataIn:
    #           object: =..emailList.email.edge
    #         dataOut: InboxDashboard.emailNumber
    # - if:
    #   - =.builtIn.string.equal:
    #       dataIn:
    #         string1: =.Global.emailNumber
    #         string2: "0"
    #   - .Global.inboxHidden@: "true"
    #   - .Global.inboxHidden@: "false"
    - if:
        - =..emailList.email.edge.0
        - continue
        - =.builtIn.checkField:
            dataIn:
              contentType: messageHidden
              wait: 100
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.requestListNum
              string2: "0"
        - ..requestListHidden@: true
        - ..requestListHidden@: false
  requestListHidden: "true"
  lastTop: "0.0"
  emailNumber: ""
  formData:
    unReadEmailNum: "0"
    inboxHidden: true
  #获取未读邮件
  apiRequest:
    unReadEmail:
      docQueryReq:
        ObjType: 544
        type: 1281
        sCondition: E.type=10002 AND (D2.Type&0xFF02=0xE00 OR D2.reid IS NULL OR D2.Type = 66561)
        xfname: (E.bvid|E.evid)&!D.ovid
        obfname: ctime
        maxcount: "100"
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: InboxFolder.apiRequest.unReadEmail.docQueryReq
          dataOut: InboxFolder.apiRequest.unReadEmail.docQueryResp
  emailList:
    email:
      edge: ""
    get:
      .EdgeAPT.get: ""
      api: re
      dataIn: "emailList.edge"
      dataOut: "emailList.email"
      dataKey: emailList.email
    edge:
      id: .Global.currentUser.vertex.id
      xfname: evid
      type: .EdgeType.Email
      maxcount: 200
      sCondition: "=.Global.sCondition"
      _nonce: =.Global._nonce
  emailInfo:
    edge: ""
    edgeAPI:
      store:
        api: ce
        dataKey: emailInfo.edge
  update:
    - =..emailInfo.edgeAPI.store: ""
  components:
    - .BaseHeader:
    - .HeaderLeftImg:
      path: email.svg
      onClick:
        - goto: InboxMenu
    - .HeaderRightImg:
      path: sideNav.svg
      onClick:
        - goto: MenuBars
    - type: view
      style:
        left: "0"
        width: "1"
        top: "0.1"
        height: "0.08"
        border:
          style: "2"
        borderColor: "0x00000033"
        borderWidth: "1"
        zIndex: "10"
      children:
        - type: textField
          placeholder: search in mail
          dataKey: formData.serachInfo
          style:
            top: "0.02"
            width: "0.7"
            left: "0.05"
            height: "0.035"
            backgroundColor: "0xE4E4E5"
            borderRadius: "5"
            paddingLeft: "20px"
            borderWidth: "0"
        - type: label
          text: Edit
          # onClick:
          #   - emit:
          #       actions:
          #         - =.builtIn.utils.alert:
          #             dataIn:
          #               value: "1"
          # - goto: EditInbox
          style:
            top: "0.027"
            left: "0.84"
            height: "0.035"
            width: "0.15"
            fontSize: "17"
            color: "0x519DD3"
            fontWeight: 400
            textAlign:
              x: center
    - type: view
      style:
        left: "0"
        width: "1"
        top: "0.18"
        height: "0.72"
      children:
        - type: label
          contentType: messageHidden
          text: "No email to receive"
          style:
            left: "0.31"
            top: "0.25"
            width: "0.69"
            height: "0.04"
            color: "0x000058"
            fontSize: .Nfont.h16
            isHidden: "true"
            zIndex: 1000
        - type: list
          contentType: listObject
          listObject: ..emailList.email.edge
          iteratorVar: itemObject
          viewTag: emailList
          style:
            left: "0"
            top: "0"
            width: "1"
            height: "0.68"
            backgroundColor: "0xffffff"
            overflow: scroll
          children:
            - type: listItem
              onClick:
                - actionType: updateObject
                  dataKey: Global.email
                  dataObject: itemObject
                - actionType: evalObject
                  object:
                    - ..emailInfo.edge@: =.Global.email
                    - ..emailInfo.edge.name.isRead@: true
                - actionType: evalObject
                  object: ..update
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""
                - goto: MessageShow
              itemObject: ""
              style:
                left: "0"
                width: "1"
                height: "0.09"
                backgroundColor: "0xffffffff"
                borderWidth: "1"
                border:
                  style: "2"
                  color: "0xdcdcdc"
                # backgroundColor: "0x2988e6"
              children:
                - type: image
                  path:
                    emit:
                      dataKey:
                        var: itemObject
                      actions:
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: 1
                                  string2: $var.atimes
                            - dot.svg
                            - white.svg
                  style:
                    left: "0"
                    top: "0.024"
                    height: "0.04"
                - type: image
                  path: square.svg
                  style:
                    left: "0.075"
                    top: "0.015"
                    height: "0.06"
                - type: label
                  text: "Tonimarie Munoz"
                  dataKey: itemObject.name.senderName
                  style:
                    left: "0.25"
                    top: "0.012"
                    width: "0.45"
                    height: "0.022"
                    fontWeight: "700"
                    fontSize: .Nfont.h14
                    color: "0x707070"
                    textAlign:
                      x: left
                - type: label
                  text: "Phase 2 Design"
                  dataKey: itemObject.name.title
                  style:
                    left: "0.25"
                    top: "0.034"
                    width: "0.45"
                    fontWeight: 500
                    height: "0.022"
                    fontSize: "13"
                    color: "0x707070"
                    textAlign:
                      x: left
                - type: label
                  text: "Hey!Had a question about"
                  dataKey: itemObject.name.message
                  style:
                    left: "0.25"
                    top: "0.056"
                    width: "0.6"
                    height: "0.022"
                    fontWeight: "300"
                    fontSize: .Nfont.h12
                    textAlign:
                      x: left
                    fontFamily: PMingLiU

                - type: label
                  text: 1:30 PM
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: itemObject.ctime
                  style:
                    left: "0.5"
                    top: "0.02"
                    width: "0.3"
                    height: "0.02"
                    fontSize: "13"
                    textAlign:
                      x: left
                    fontFamily: PMingLiU
                - type: image
                  path: pin.svg
                  style:
                    left: "0.45"
                    top: "0.019"
                    height: "0.02"
                - type: image
                  viewTag: select
                  path:
                    emit:
                      dataKey:
                        var: itemObject
                      actions:
                        - if:
                            # - =.builtIn.string.equal:
                            #     dataIn:
                            #       string1: true
                            #       string2: $var.name.isFavorite
                            - $var.name.isStar
                            - providerOn.svg
                            - providerOff.svg
                  onClick:
                    - emit:
                        dataKey:
                          var: itemObject
                        actions:
                          - if:
                              - $var.name.isStar
                              - =.builtIn.object.set:
                                  dataIn:
                                    object: $var
                                    key: name.isStar
                                    value: false
                              - =.builtIn.object.set:
                                  dataIn:
                                    object: $var
                                    key: name.isStar
                                    value: true
                    - actionType: updateObject # updateObject(dataKey, dataObject, dataObjectKey)
                      dataKey: InboxDashboard.emailInfo.edge
                      dataObject: itemObject # this must be a rootRoom
                    - actionType: evalObject
                      object:
                        - if:
                            - =..emailInfo.edge.name.isStar
                            - ..emailInfo.edge.subtype@: 1
                            - ..emailInfo.edge.subtype@: 2
                    - actionType: evalObject
                      object: ..update
                    - actionType: evalObject
                      object:
                        .Global._nonce@:
                          =.builtIn.math.random: ""
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: emailList
                  style:
                    left: "0.88"
                    top: "0.025"
                    height: "0.033"
                    zIndex: "1000"
    - type: button
      onClick:
        - actionType: evalObject
          object:
            .Global.inboxContact@: ""
        - goto: NewMessage
      text: Compose
      style:
        left: "0.65"
        top: "0.78"
        width: "0.25"
        height: "0.05"
        fontSize: .Nfont.h16
        fontStyle: bold
        color: "0xffffff"
        backgroundColor: "0x2fb355"
        border:
          style: "3"
        borderColor: "0x2fb355"
        borderRadius: "15"
        textAlign:
          x: center
    - .DashboardFooter0:
      style:
        top: "0.9"
      children:
        - .DashboardFooterView:
          onClick:
            - goto: "Dashboard"
          children:
            - .DashboardBox:
              children:
                - .DashboardFooterImg:
                  path: dashboard0.svg
            - .DashboardFooterTxt:
        - .DashboardFooterView:
          style:
            left: "0.25"
          onClick:
            - goto: "InboxDashboard"
          children:
            - .DashboardBox:
              children:
                - .DashboardFooterImg:
                  path: inbox0Yellow.svg
            - .DashboardFooterTxt:
              text: "Inbox"
            - type: label
              dataKey: formData.unReadEmailNum
              style:
                left: "0.15"
                top: "0.005"
                width: "5vw"
                height: "5vw"
                zIndex: "2"
                fontSize: .Nfont.h15
                backgroundColor: "#ff3a41"
                border:
                  style: "5"
                borderRadius: "50"
                color: "0xffffff"
                isHidden: ..formData.inboxHidden
                textAlign:
                  x: center
        - .DashboardFooterView:
          style:
            left: "0.5"
          onClick:
            - goto: AppointmentSchedule
          children:
            - .DashboardBox:
              children:
                - .DashboardFooterImg:
                  path: schedule0.svg
                - type: label
                  dataKey: Global.requestListNum
                  style:
                    left: "0.145"
                    top: "0.01"
                    width: "0.05"
                    height: "0.024"
                    zIndex: "2"
                    fontSize: .Nfont.h12
                    backgroundColor: "#ff3a41"
                    border:
                      style: "5"
                    borderRadius: "50"
                    color: "0xffffff"
                    isHidden: ..requestListHidden
                    textAlign:
                      x: center
            - .DashboardFooterTxt:
              text: "Schedule"
        - .DashboardFooterView:
          style:
            left: "0.75"
          onClick:
            - goto: MenuBars
          children:
            - .DashboardBox:
              children:
                - .DashboardFooterImg:
                  path: me.svg
            - .DashboardFooterTxt:
              text: "Me"
    # - type: view
    #   style:
    #     top: "0.9"
    #     width: "1"
    #     height: "0.1"
    #     backgroundColor: "0x2988e6"
    #   children:
    #     - type: image
    #       onClick:
    #         - goto: NewMessage
    #       path: draft1.svg
    #       style:
    #         height: "0.04"
    #         top: "0.03"
    #         left: "0.85"
