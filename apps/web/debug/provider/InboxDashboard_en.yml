InboxDashboard:
  pageNumber: "90"
  title: "Inbox"
  init:
    - .SignInCheck
    - actionType: updateObject
      dataKey: Global.formData.entrancePageName
      dataObject: ""
    - actionType: updateObject
      dataKey: Global.inboxContact
      dataObject: .EmptyObj
    - actionType: updateObject
      dataKey: Global.email
      dataObject: .EmptyObj
    - actionType: updateObject
      dataKey: Global.inboxMessage
      dataObject: .EmptyObj
    - actionType: updateObject
      dataKey: Global.formData.attachments
      dataObject: []
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - .Global.createjwt.edge.bvid@: =.Global.currentUser.vertex.id
    - actionType: evalObject
      object:
        - actionType: evalObject
          async: true
          object:
            - =.Global.createjwt.edgeAPI.store: ""
            - =..apiRequest.email.docAPI.get: ""
            - =..apiRequest.unReadEmail.docAPI.get: ""
    - actionType: evalObject
      object:
        - =.builtIn.array.getListLength:
            dataIn:
              object: =..apiRequest.unReadEmail.docQueryResp.doc
            dataOut: InboxDashboard.formData.unReadEmailNum
        - if:
            - =.builtIn.string.equal:
                dataIn:
                  string1: =..formData.unReadEmailNum
                  string2: "0"
            - ..formData.inboxHidden@: "true"
            - ..formData.inboxHidden@: "false"
        - if:
            - =.InboxDashboard.apiRequest.email.docQueryResp.doc.0
            - continue
            - =.builtIn.checkField:
                dataIn:
                  contentType: messageHidden
                  wait: 100
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.requestListNum
              string2: "0"
        - ..requestListHidden@: "true"
        - ..requestListHidden@: "false"
  requestListHidden: true
  lastTop: "0.0"
  formData:
    unReadEmailNum: "0"
    inboxHidden: "true"
  apiRequest:
    emailTypeTag:
      docQueryResp:
        doc: []
      docQueryReq:
        id: ""
        xfname: reid
        type: .DocType.MailTypeTag
        maxcount: "1"
        obfname: mtime
      docAPI:
        get:
          api: rd
          dataIn: InboxDashboard.apiRequest.emailTypeTag.docQueryReq
          dataOut: InboxDashboard.apiRequest.emailTypeTag.docQueryResp
    email:
      docQueryResp: ""
      docQueryReq:
        id: .Global.currentUser.vertex.id
        ObjType: 544
        type: 1281
        sCondition: E.type=10002 AND (D2.type & 0xFF18 =0xE00 OR D2.reid is NULL OR D2.Type = 66561)
        xfname: (E.bvid|E.evid)&!D.ovid
        obfname: ctime
        maxcount: "100"
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: InboxDashboard.apiRequest.email.docQueryReq
          dataOut: InboxDashboard.apiRequest.email.docQueryResp
    emailTag:
      docQueryResp: ""
      docQueryReq:
        sCondition: type & 0xFF00 = 0xE00
        ids:
          - .Global.rootNotebookID
        xfname: eid,reid
        _nonce: =.Global._nonce
      docCreateReq:
        type: .DocType.MailTag
        eid: .Global.rootNotebookID
        name:
          data: ""
        reid: ""
      docAPI:
        get:
          api: rd
          dataIn: InboxDashboard.apiRequest.emailTag.docQueryReq
          dataOut: InboxDashboard.apiRequest.emailTag.docQueryResp
        store:
          api: cd
          dataIn: InboxDashboard.apiRequest.emailTag.docCreateReq
    unReadEmail:
      docQueryResp: ""
      docQueryReq:
        id: .Global.currentUser.vertex.id
        ObjType: 544
        type: 1281
        sCondition: E.type=10002 AND (D2.Type&0xFF02=0xE00 OR D2.reid IS NULL OR D2.Type = 66561)
        xfname: (E.bvid|E.evid)&!D.ovid
        obfname: ctime
        maxcount: "100"
        _nonce: =.Global._nonce
      docAPI:
        get:
          api: rd
          dataIn: InboxDashboard.apiRequest.unReadEmail.docQueryReq
          dataOut: InboxDashboard.apiRequest.unReadEmail.docQueryResp
  components:
    # - .BaseHeader:
    #   style:
    #     backgroundColor: "0x2988e6"
    # - .HeaderRightImg:
    #   path: sideNav3.svg
    #   onClick:
    #     - goto: InboxMenu
    - .BasePublicHeader:
      children:
        - .BasePublicHeaderLeftEmpty:
        - .BasePublicHeaderTitle:
        - .BasePublicHeaderRightIcon:
          path: sideNav3.svg
          style:
            height: "0.022167"
          onClick:
            - goto: InboxMenu
    - type: view
      style:
        left: "0"
        width: "1"
        # top: "0.1"
        height: "0.06"
        border:
          style: "2"
        borderColor: "0x00000033"
        backgroundColor: "0x2988e6"
        borderWidth: "1"
        zIndex: "10"
      children:
        - type: textField
          placeholder: "Search"
          dataKey: formData.serachInfo
          style:
            top: "0.015"
            width: "0.7"
            left: "0.05"
            height: "0.03"
            backgroundColor: "0xffffff"
            borderRadius: "5"
            paddingLeft: "20px"
            borderWidth: "0"
        - type: label
          text: Edit
          onClick:
            - actionType: evalObject
              object:
                - .Global.emailForEdit@: []
                - .Global.emailEditFunction@: []
                # 将页面的邮件传入edit中，让后可以进行的操作也进行传输
                - .Global.emailForEdit@: =..apiRequest.email.docQueryResp.doc
                - .Global.emailEditFunction@: [trash.svg, move.svg, mark.svg]
            - goto: EditInbox
          style:
            top: "0.019"
            left: "0.83"
            height: "0.03"
            width: "0.15"
            fontSize: .Nfont.h15
            color: "0xffffff"
            fontWeight: 400
            textAlign:
              x: center
    - type: scrollView
      style:
        left: "0"
        width: "1"
        # top: "0.16"
        height: "0.78"
        overflow: scroll
        boxSizing: "border-box"
        paddingBottom: "0.03"
      children:
        - type: view
          contentType: messageHidden
          style:
            width: "0.5"
            height: "0.5"
            top: "0.16"
            left: "0.25"
            isHidden: "true"
            zIndex: "100"
            textAlign:
              x: center
          children:
            - type: image
              path: noEmail.svg
              style:
                # height: "0.22"
                width: "0.5"
                margin: auto
            - type: label
              text: "No message here…"
              style:
                textAlign:
                  x: center
                left: "0.05"
                top: "0.24"
                width: "0.4"
                height: "0.04"
                color: "0x000058"
                fontSize: ".Nfont.h1"
        - type: list
          contentType: listObject
          listObject: ..apiRequest.email.docQueryResp.doc
          iteratorVar: itemObject
          viewTag: emailList
          style:
            # left: "0"
            # top: "0"
            # width: "1"
            # height: "0.78"
            # margin: "0"
            # overflow: scroll
          children:
            - type: listItem
              itemObject: ""
              style:
                width: "1"
                height: "auto"

                overflow: hidden
              children:
                - type: view
                  style:
                    width: "1"
                    height: "0.01"
                - type: view
                  style:
                    width: "1"
                    height: "auto"
                  children:
                    - type: view
                      style:
                        marginTop: "0.01"
                        height: "auto"
                        width: "0.2"
                        display: "inline-block"
                        verticalAlign: middle
                      children:
                        - type: image
                          path: aitmedLogo.svg
                          path=func: =.builtIn.utils.prepareDocToPath
                          dataKey: itemObject.name.user
                          style:
                            marginLeft: "0.05"
                            verticalAlign: middle
                            height: "0.06"
                            borderRadius: "7"
                            width: "6vh"
                        - type: image
                          style:
                            left: "0.16"
                            top: "-0.008"
                            height: "0.015"
                          path:
                            emit:
                              dataKey:
                                var: itemObject
                              actions:
                                - if:
                                    - =.builtIn.number.typeIsValid:
                                        dataIn:
                                          docType: $var.type
                                          localArr: [1, 2, 6]
                                          binaryArr: [1, 1, 0]
                                    - null.png
                                    - dot.svg
                    - type: view
                      style:
                        verticalAlign: middle
                        display: "inline-block"
                        height: "auto"
                        width: "auto"
                      children:
                        - type: view
                          style:
                            verticalAlign: middle
                            marginLeft: "0.05"
                            display: "inline-block"
                            height: "auto"
                            width: "0.51"
                          children:
                            - type: label
                              dataKey: itemObject.name.data.senderName
                              style:
                                width: "0.5"
                                height: "auto"
                                fontSize: .Nfont.h1
                                #
                                color: "0x707070"
                                overflow: hidden
                                text-overflow: ellipsis
                                whiteSpace: nowrap
                            - type: label
                              text: "(No subject)"
                              dataKey: itemObject.name.title
                              style:
                                marginTop: "0.003"
                                width: "0.4"
                                height: "auto"
                                fontSize: .Nfont.h1
                                color: "0x707070"
                                overflow: hidden
                                text-overflow: ellipsis
                                whiteSpace: nowrap
                            - type: label
                              text: "(No content)"
                              dataKey: itemObject.name.data.content
                              style:
                                marginTop: "0.003"
                                width: "0.4"
                                height: "auto"
                                fontSize: .Nfont.h1
                                color: "0x00000099"
                                overflow: hidden
                                text-overflow: ellipsis
                                whiteSpace: nowrap
                                #
                                # wordBreak: break-word

                      onClick:
                        - actionType: updateObject
                          dataKey: Global.email
                          dataObject: itemObject
                        - actionType: evalObject
                          object:
                            .Global._nonce@:
                              =.builtIn.math.random: ""
                        - actionType: evalObject
                          object:
                            - =.builtIn.array.add:
                                dataIn:
                                  object: =..apiRequest.emailTag.docQueryReq.ids
                                  value: =.Global.email.id
                            - =..apiRequest.emailTag.docAPI.get: ""
                            - if:
                                - =..apiRequest.emailTag.docQueryResp.doc
                                - ..apiRequest.emailTag.docCreateReq@: =..apiRequest.emailTag.docQueryResp.doc.0
                                - continue
                            - ..apiRequest.emailTag.docCreateReq.reid@: =.Global.email.id
                            - =.builtIn.number.inhx:
                                dataIn:
                                  intHex: =..apiRequest.emailTag.docCreateReq.type
                                  index: 2
                                  hex: 1
                                dataOut: InboxDashboard.apiRequest.emailTag.docCreateReq.type
                            - =..apiRequest.emailTag.docAPI.store: ""
                            - ..apiRequest.emailTypeTag.docQueryReq.id@: =.Global.email.id
                            - =..apiRequest.emailTypeTag.docAPI.get: ""
                            - if:
                                - =.builtIn.array.judgeListLength:
                                    dataIn:
                                      array: =..apiRequest.emailTypeTag.docQueryResp.doc
                                      len: 0
                                - goto: MessageShow
                                - actionType: evalObject
                                  object:
                                    - if:
                                        - =.builtIn.number.typeIsValid:
                                            dataIn:
                                              docType: =..apiRequest.emailTypeTag.docQueryResp.doc.0.tage
                                              localArr: [1]
                                              binaryArr: [1]
                                        - goto: AppointmentInviteMessage
                                        - goto: MessageShow
                    - type: view
                      style:
                        display: "inline-block"
                        width: "0.2"
                        height: "auto"
                        verticalAlign: top
                      children:
                        - type: label
                          text=func: =.builtIn.date.formatData
                          dataKey: itemObject.ctime
                          style:
                            height: "auto"
                            width: "0.2"
                        - type: view
                          style:
                            marginTop: "0.01"
                            width: "0.24"
                            height: "auto"
                          children:
                            - type: image
                              style:
                                height: "0.03"
                                verticalAlign: middle
                              path:
                                emit:
                                  dataKey:
                                    var: itemObject
                                  actions:
                                    - if:
                                        - $var.name.data.haveAttachment
                                        - flatAttachment.svg
                                        - null.png
                            - type: image
                              viewTag: select
                              style:
                                marginLeft: "0.04"
                                height: "0.02"
                                zIndex: "100"
                                verticalAlign: middle
                              path:
                                emit:
                                  dataKey:
                                    var: itemObject
                                  actions:
                                    - if:
                                        - =.builtIn.number.typeIsValid:
                                            dataIn:
                                              docType: $var.type
                                              localArr: [1, 3, 6]
                                              binaryArr: [1, 1, 0]
                                        - providerOn.svg
                                        - null.png

                - type: view
                  style:
                    width: "1"
                    height: "0.01"
                    borderWidth: "1"
                    border:
                      style: "2"
                      color: "0xdcdcdc"

    - type: image
      path: compose.svg
      onClick:
        - goto: NewMessage
      style:
        left: "0.8"
        top: "0.75"
        height: "0.06"
        zIndex: "100"

    - .footerBox:
      style:
        top: "0.9"
      children:
        - .footerMenuBox:
          onClick:
            - goto: "Dashboard"
          children:
            - .footerMenuImg:
              path: dashboard0.svg
            - .footerMenuLabel:
              text: Dashboard

        - .footerMenuBox:
          onClick:
            - goto: "InboxDashboard"
          children:
            - .footerMenuImg:
              path: inbox0Yellow.svg
            - .footerMenuLabel:
              text: Inbox
              style:
                color: "0xfece55"
            - .numberMark:
              dataKey: formData.unReadEmailNum
              style:
                isHidden: ..formData.inboxHidden

        - .footerMenuBox:
          onClick:
            - goto: AppointmentSchedule
          children:
            - .footerMenuImg:
              path: schedule0.svg
            - .footerMenuLabel:
              text: Schedule
            - .numberMark:
              dataKey: Global.requestListNum
              style:
                isHidden: ..requestListHidden

        - .footerMenuBox:
          onClick:
            - goto: MenuBars
          children:
            - .footerMenuImg:
              path: me.svg
            - .footerMenuLabel:
              text: Me

    # - type: view
    #   style:
    #     left: "0"
    #     width: "1"
    #     top: "0.9"
    #     height: "0.1"
    #     backgroundColor: "0x2988e6"
    #   children:
    #     - .DashboardFooterView:
    #       onClick:
    #         - goto: "Dashboard"
    #       children:
    #         - .DashboardBox:
    #           children:
    #             - .DashboardFooterImg:
    #               path: dashboard0.svg
    #         - .DashboardFooterTxt:
    #     - .DashboardFooterView:
    #       style:
    #         left: "0.25"
    #       onClick:
    #         - goto: "InboxDashboard"
    #       children:
    #         - .DashboardBox:
    #           children:
    #             - .DashboardFooterImg:
    #               path: inbox0Yellow.svg
    #         - .DashboardFooterTxt:
    #           text: "Inbox"
    #         - type: label
    #           dataKey: formData.unReadEmailNum
    #           style:
    #             left: "0.15"
    #             top: "0.005"
    #             width: "5vw"
    #             height: "5vw"
    #             zIndex: "2"
    #             fontSize: .Nfont.h15
    #             backgroundColor: "#ff3a41"
    #             border:
    #               style: "5"
    #             borderRadius: "50"
    #             color: "0xffffff"
    #             isHidden: ..formData.inboxHidden
    #             textAlign:
    #               x: center
    #     - .DashboardFooterView:
    #       style:
    #         left: "0.5"
    #       onClick:
    #         - goto: AppointmentSchedule
    #       children:
    #         - .DashboardBox:
    #           children:
    #             - .DashboardFooterImg:
    #               path: schedule0.svg
    #             - type: label
    #               dataKey: Global.requestListNum
    #               style:
    #                 left: "0.145"
    #                 top: "0.01"
    #                 width: "0.05"
    #                 height: "0.024"
    #                 zIndex: "2"
    #                 fontSize: .Nfont.h12
    #                 backgroundColor: "#ff3a41"
    #                 border:
    #                   style: "5"
    #                 borderRadius: "50"
    #                 color: "0xffffff"
    #                 isHidden: ..requestListHidden
    #                 textAlign:
    #                   x: center
    #         - .DashboardFooterTxt:
    #           text: "Schedule"
    #     - .DashboardFooterView:
    #       style:
    #         left: "0.75"
    #       onClick:
    #         - goto: MenuBars
    #       children:
    #         - .DashboardBox:
    #           children:
    #             - .DashboardFooterImg:
    #               path: me.svg
    #         - .DashboardFooterTxt:
    #           text: "Me"
