AvailableProfileOffice:
  # api请求
  # 1. 获取facility的rootnotebook, 为了获取 location 也不需要了  已删除
  # 2. 获取所有的location 这个在dashboard已经获取过了， 所以不需要重复获取 已删除
  pageNumber: "170"
  title: "Available Profile"
  init:
    - .SignInCheck
    - actionType: evalObject
      object:
        .Global._nonce@:
          =.builtIn.math.random: ""
    - =.builtIn.utils.setTimer:
        dataIn:
          timeUnix: 1000
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =.Global.currentUser.vertex.id
              string2: =.Global.currentFacility.id
        - ..getSchedule.get
        - actionType: evalObject
          object:
            # 获取返回的列表中第一个location
            - ..midLocation@: =.Global.formData.currentFacility.locations
            # 把 address name 放到数组里面， 方便下拉框展示
            - =.builtIn.array.selectOneToArr:
                dataIn:
                  arr: =.Global.formData.currentFacility.allLocationInforMation
                  key: "medicalFacilityName"
                dataOut: AvailableProfileOffice.addressName
            - ..formData.name.setting.Address@: =..addressName.0
            # 根据第一个name的名字去匹配第一个id
            - =.builtIn.array.matchInArray:
                dataIn:
                  arr: =.Global.formData.currentFacility.allLocationInforMation
                  value: =..addressName.0
                  key: medicalFacilityName
                  key1: "id"
                dataOut: AvailableProfileOffice.locationId
            #  获取当前默认选中的location的schedule
            - =.builtIn.array.add:
                dataIn:
                  object: =..getScheduleOfficeVisit.edgeReq.id
                  value: =..locationId
            - .Global.locationId@: =..locationId
            - =..getScheduleOfficeVisit.get: ""
            - ..getSchedule.schedule@: =..getScheduleOfficeVisit.schedule
    - if:
        - =..getSchedule.schedule.edge.0
        - actionType: evalObject
          object:
            - ..formDataTemp.isShow@: block
            - ..formDataTemp.isMessageShow@: none
        - actionType: evalObject
          object:
            - ..formDataTemp.isShow@: none
            - ..formDataTemp.isMessageShow@: block
    - if:
        - =..getSchedule.schedule.edge.0
        - ..buttonText@: "Update Now"
        - ..buttonText@: "Create Now"
    - actionType: updateObject
      dataKey: Global.currentSchdule
      dataObject: .EmptyObj
    - actionType: evalObject
      object:
        - ..midSchedule@: =..getSchedule.schedule.edge.0
        - =.builtIn.array.WeekSchedule:
            dataIn:
              planObject: =..midSchedule.name.setting.day
            dataOut: AvailableProfileOffice.day
  getSchedule:
    schedule:
      edge: ""
    get:
      .EdgeAPI.get: ""
      api: re
      dataKey: AvailableProfileOffice.getSchedule.schedule
      type: 40000
      id:
        - .Global.currentFacility.id
        - .Global.currentUser.vertex.id
      sCondition: "subtype=131075"
      xfname: "bvid,evid"
      maxcount: "1"
      obfname: "ctime"
      _nonce: =.Global._nonce
  locationId: ""
  midLocation: ""
  midSchedule: ""
  weekLabel:
    - key: Sunday
    - key: Monday
    - key: Tuesday
    - key: Wednesday
    - key: Thursday
    - key: Friday
    - key: Saturday

  getScheduleOfficeVisit:
    edgeReq:
      type: 40000
      id:
        - .Global.currentUser.vertex.id
      sCondition: "subtype=131075"
      xfname: "evid,bvid"
      maxcount: "1"
      obfname: "ctime"
      _nonce: =.Global._nonce
    schedule:
      edge: ""
    get:
      .EdgeAPI.get: ""
      api: re
      dataIn: AvailableProfileOffice.getScheduleOfficeVisit.edgeReq
      dataOut: AvailableProfileOffice.getScheduleOfficeVisit.schedule
  formData:
    name:
      setting:
        Address: ""
  addressName: []
  buttonText: ""
  day: ""
  formDataTemp:
    isShow: "none"
    isMessageShow: "block"
    tabTemp:
      - title: Telemedicine
        fontColor: "0x4b4b4b"
        fontWeight: "400"
        block: "none"
      - title: Office Visits
        fontColor: "0x2988e6"
        fontWeight: "500"
        block: "block"
  components:
    - .BasePublicHeader:
        children:
          - .BasePublicHeaderLeft:
            leftClick:
              - goto: ScheduleProfile
          - .BasePublicHeaderTitle:
    - type: view
      style:
        ..style.tabBox:
      children:
        - type: list
          viewTag: tabTag
          contentType: listObject
          listObject: ..formDataTemp.tabTemp
          iteratorVar: itemObject
          style:
            ..style.tabList:
          children:
            - type: listItem
              itemObject:
              style:
                ..style.tabListItem:
              onClick:
                - ..event.tabSwitch
              children:
                - type: label
                  dataKey: itemObject.title
                  style:
                    ..style.tabListTitle:
                - type: view
                  style:
                    ..style.tabListLine:
                - type: view
                  viewTag: leftBlockTag
                  style:
                    ..style.tabBar:
    - type: scrollView
      style:
        ..style.scrollBox:
      children:
        - type: view
          style:
            ..style.publicBox:
          children:
            - type: view
              style:
                ..style.segmentationBox:
              children:
                - type: label
                  text: Address
                  style:
                    ..style.divisionTitle:
            - type: select
              dataKey: formData.name.setting.Address
              options: ..addressName
              style:
                ..style.blockBoxInput:
              onChange:
                - ..event.selectChange
            - type: view
              viewTag: "btTag"
              style:
                ..style.publicBox:
                display: ..formDataTemp.isShow
              children:
                - type: view
                  style:
                    ..style.segmentationBox:
                    marginTop: "0.0123"
                  children:
                    - type: label
                      text: Available Days
                      style:
                        ..style.divisionTitle:
                - type: list
                  viewTag: officeTag1
                  contentType: listObject
                  listObject: ..day
                  iteratorVar: itemObject
                  style:
                    ..style.list:
                  children:
                    - type: listItem
                      itemObject:
                      style:
                        ..style.listItem:
                      children:
                        - type: view
                          style:
                            ..style.itemBox:
                          children:
                            - type: label
                              dataKey: itemObject.weekDay
                              style:
                                ..style.dayLabel:
                            - type: list
                              androidGrid: true
                              contentType: listObject
                              listObject: itemObject.info
                              iteratorVar: itemObject
                              style:
                                ..style.listLabel:
                              children:
                                - type: listItem
                                  itemObject: 
                                  style:
                                    ..style.itemBoxLabel:
                                  children:
                                    - type: label
                                      dataKey: itemObject
                                      style:
                                        ..style.infoLabel:
                - type: view
                  style:
                    ..style.segmentationBox:
                  children:
                    - type: label
                      text: Duration
                      style:
                        ..style.divisionTitle:
                - type: view
                  viewTag: officeTag2
                  style:
                    ..style.blockBox:
                  children:
                    - type: label
                      text: "Duration(weeks):"
                      style:
                        ..style.leftTitle:
                    - type: label
                      dataKey: getSchedule.schedule.edge.0.name.setting.forwardRepeatWeeks
                      style:
                        ..style.rightValue:
                - type: view
                  viewTag: officeTag3
                  style:
                    ..style.blockBox:
                  children:
                    - type: label
                      text: "Start Date:"
                      style:
                        ..style.leftTitle:
                    - type: label
                      dataKey: getSchedule.schedule.edge.0.name.setting.startDate_show
                      style:
                        ..style.rightValue:
                - type: view
                  style:
                    marginTop: "0.03"
            - type: view
              viewTag: messageTag
              style:
                display: ..formDataTemp.isMessageShow
                marginTop: "0.2"
                marginLeft: "0.04"
                width: "0.92"
                height: "auto"
                textAlign:
                  x: center
                overflow: hidden
              children:
                - type: label
                  text: You should create availability settings first, Please click the following button to create availability settings
                  style:
                    width: "0.92"
                    height: "auto"
                    fontSize: .Nfont.h16
                    color: "#333333"
                    textAlign:
                      x: center
                - type: button
                  viewTag: buttontext
                  dataKey: buttonText
                  style:
                    ..style.btn:
                    marginTop: "0.1"
                  onClick:
                    - actionType: evalObject
                      object:
                        - .Global.setSchedule.scheduleTypeNumber@: 131075
                        - .Global.setSchedule.scheduleType@: "Office Visit"
                        - if:
                            - =.builtIn.string.equal:
                                dataIn:
                                  string1: =.Global.currentUser.vertex.id
                                  string2: =.Global.currentFacility.id
                            - continue
                            - .Global.address@: =.AvailableProfileOffice.formData.name.setting.Address
                    - goto: CreateAvailability
    - type: view
      viewTag: "btTag"
      style:
        ..style.btnBox:
        display: ..formDataTemp.isShow
      children:
        - type: button
          dataKey: buttonText
          style:
            ..style.btn:
          onClick:
            - ..event.btnClick
  event:
    tabSwitch:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: $var.title
                      string2: Telemedicine
                - goto: AvailableProfileTelemedicine
                - continue
    selectChange:
      - actionType: evalObject
        object:
          - .Global._nonce@:
              =.builtIn.math.random: ""
          - ..getScheduleOfficeVisit.edgeReq.id@: []
          - ..getScheduleOfficeVisit.schedule.edge@: []
          - =.builtIn.array.add:
              dataIn:
                object: =..getScheduleOfficeVisit.edgeReq.id
                value: =.Global.currentUser.vertex.id
          - =.builtIn.array.matchInArray:
              dataIn:
                arr: =.Global.formData.currentFacility.allLocationInforMation
                value: =..formData.name.setting.Address
                key: medicalFacilityName
                key1: "id"
              dataOut: AvailableProfileOffice.locationId
      - actionType: evalObject
        object:
          - =.builtIn.array.add:
              dataIn:
                object: =..getScheduleOfficeVisit.edgeReq.id
                value: =..locationId
      - actionType: evalObject
        object:
          - .Global.locationId@: =..locationId
          - .Global.address@: =..formData.name.setting.Address
      - actionType: evalObject
        object:
          # 把id置空， 再重新添加选择的location的id，再get
          - =..getScheduleOfficeVisit.get: ""
          - ..getSchedule.schedule@: =..getScheduleOfficeVisit.schedule
          - =.builtIn.array.WeekSchedule:
              dataIn:
                planObject: =..getSchedule.schedule.edge.0.name.setting.day
              dataOut: AvailableProfileOffice.day
      - actionType: evalObject
        object:
          - if:
              - =..getSchedule.schedule.edge.0
              - ..buttonText@: "Update Now"
              - ..buttonText@: "Create Now"
          - if:
              - =..getScheduleOfficeVisit.schedule.edge.0.id
              - actionType: evalObject
                object:
                  - ..formDataTemp.isShow@: block
                  - ..formDataTemp.isMessageShow@: none
              - actionType: evalObject
                object:
                  - ..formDataTemp.isShow@: none
                  - ..formDataTemp.isMessageShow@: block
      - actionType: builtIn
        funcName: redraw
        viewTag: btTag
      - actionType: builtIn
        funcName: redraw
        viewTag: messageTag
      - actionType: builtIn
        funcName: redraw
        viewTag: buttontext
      - actionType: builtIn
        funcName: redraw
        viewTag: officeTag2
      - actionType: builtIn
        funcName: redraw
        viewTag: officeTag3
      - actionType: builtIn
        funcName: redraw
        viewTag: officeTag1
    btnClick:
      - actionType: evalObject
        object:
          - .Global.setSchedule.scheduleTypeNumber@: 131075
          - .Global.setSchedule.scheduleType@: "Office Visit"
          - if:
              - =.AvailableProfileOffice.getSchedule.schedule.edge.0.id
              - .Global.currentSchdule@: =..getSchedule.schedule.edge.0
              - .AvailableProfileOffice.test@: "123"
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =.Global.currentUser.vertex.id
                    string2: =.Global.currentFacility.id
              - continue
              - .Global.address@: =.AvailableProfileOffice.formData.name.setting.Address
      - goto: CreateAvailability
  style:
    scrollBox:
      width: "1"
      height: "0.793"
      boxSizing: "border-box"
      overflow: "scroll"
    btnBox:
      width: "1"
      height: "0.0972"
      boxSizing: "border-box"
      overflow: "scroll"
      backgroundColor: "#ffffff"
      boxShadow: "1px 1px 4px 1px #dededf"
      textAlign:
        x: center
    btn:
      marginTop: "0.0123"
      height: "0.0443"
      width: "0.84"
      border:
        style: 1
      borderRadius: "5"
      backgroundColor: "#2988e6"
      color: "#ffffff"
      fontSize: .Nfont.h14
      boxSizing: border-box
      fontWeight: "600"
      textAlign:
        x: center
    tabBox:
      height: "auto"
      width: "1"
      overflow: hidden
    tabList:
      width: "1"
      margin: "0"
      axis: horizontal
      height: "auto"
      overflow: hidden
      marginTop: "0.02"
    tabListItem:
      width: "0.5"
      height: "auto"
    tabListTitle:
      color: itemObject.fontColor
      height: "auto"
      width: "0.5"
      fontWeight: itemObject.fontWeight
      textAlign:
        x: center
      fontSize: .Nfont.h16
    tabListLine:
      marginTop: "0.005"
      height: "0.0025" #2.03px
      width: "0.5"
      backgroundColor: "0xdededf"
    tabBar:
      display: itemObject.block
      top: "0.031"
      left: "0.2"
      width: "0.08"
      height: "0.0025"
      backgroundColor: "0x2988e6"
      zIndex: 10
    publicBox:
      width: "auto"
      height: "auto"
      overflow: hidden
    segmentationBox:
      width: "1"
      height: "0.05"
      backgroundColor: "0xf0f0f0"
    divisionTitle:
      marginLeft: "0.04"
      color: "0x666666"
      height: "auto"
      width: "auto"
      lineHeight: 5vh
      fontSize: .Nfont.h14
      fontWeight: "700"
    list:
      width: "1"
      margin: "0"
      height: auto
      overflow: hidden
    listItem:
      marginTop: "0.0123"
      paddingBottom: "0.0123"
      width: "1"
      height: "auto"
      border:
        style: 2
      borderWidth: "1"
      borderColor: "#efefef"
    itemBox:
      marginLeft: "0.04"
      width: "auto"
      height: "auto"
      overflow: hidden
    dayLabel:
      color: "#333333"
      fontWeight: "600"
      fontSize: .Nfont.h16
    infoLabel:
      marginTop: "0.004"
      color: "#333333"
      fontWeight: "400"
      wordBreak: break-word
      lineHeight: "2.58vh"
      fontSize: .Nfont.h14
    blockBox:
      ..style.publicBox:
      marginLeft: "0.04"
      marginTop: "0.0123"
    leftTitle:
      display: "inline-block"
      fontSize: .Nfont.h16
      color: "#333333"
      height: "auto"
      width: "0.45"
    rightValue:
      display: "inline-block"
      fontSize: .Nfont.h16
      color: "#333333"
      height: "auto"
      width: "0.45"
      textAlign:
        x: right
    blockBoxInput:
      marginTop: "0.0135467"
      left: "0.04"
      width: "0.92"
      height: "0.044334"
      border:
        style: 3
      borderColor: "#dededf"
      boxSizing: border-box
      borderWidth: "1.5"
      borderRadius: "4"
      color: "#333333"
      fontSize: .Nfont.h14
      textIndent: "12px"
      verticalAlign: middle
    listLabel:
      width: "0.92"
      margin: "0"
      height: auto
      overflow: hidden
    itemBoxLabel:  
      width: '0.4'
      marginTop: '0'
      display: inline-block