SelectDiagnosis:
  title: Charge Entry
  pageNumber:
  init:
    - .SignInCheck
    # 判断本地会议是否有diagnoses存在,存在update,否则create
    - if:
        - =.Global.formData.providerDoc.diagnosesDoc.id
        - actionType: evalObject
          object:
            - ..apiRequest.diagnosesDoc.docReq@: =.Global.formData.providerDoc.diagnosesDoc
        - actionType: evalObject
          object:
            - =.SelectDiagnosis.apiRequest.diagnosesDoc.docAPI.store: ""
            - ..apiRequest.diagnosesDoc.docReq@: =.SelectDiagnosis.apiRequest.diagnosesDoc.docResp.doc
            - .Global.formData.providerDoc.diagnosesDoc@: =.SelectDiagnosis.apiRequest.diagnosesDoc.docResp.doc

    - actionType: evalObject
      object:
        - =.builtIn.array.getListLength:
            dataIn:
              object: =.Global.formData.providerDoc.diagnosesDoc.name.data.diagnosis.descriptiveList
            dataOut: SelectDiagnosis.formData.listDatalength

    - actionType: evalObject
      object:
        - if:
            - =.builtIn.string.equal:
                dataIn:
                  string1: =..formData.listDatalength
                  string2: "0"
            - continue
            - actionType: evalObject
              object:
                - ..apiRequest.diagnosesDoc.docReq.name.data.diagnosis.descriptiveList@: =.Global.formData.providerDoc.diagnosesDoc.name.data.diagnosis.descriptiveList
                - ..formData.listDataflag@: "block"
  formData:
    selectedDiagnosis: ""
    searchShow: "none"
    listDatalength: ""
    listDataflag: "none"
    diagnosis:
      descriptiveList:
        code: ""
        description: ""
        comment: ""
    selectDescriptiveList: []
  formDataTemp:
    allListInfo: []
    allListString: []
    allCodes: []
    allDescription: []
  apiRequest:
    diagnosesDoc:
      docResp: ""
      docReq:
        eid: .Global.currentRoom.edge.id
        reid: .Global.roomInfo.edge.id
        type: .DocType.Diagnoses
        subtype:
          mediaType: "application/json"
        name:
          data:
            diagnosis:
              descriptiveList: []
      docAPI:
        .DocAPI: ""
        store:
          api: cd
          dataIn: SelectDiagnosis.apiRequest.diagnosesDoc.docReq
          dataOut: SelectDiagnosis.apiRequest.diagnosesDoc.docResp
  components:
    - .BasePublicHeader:
        children:
          - .BasePublicHeaderLeft:
            leftClick:
              - actionType: popUp
                popUpView: judgmentOperation
          - .BasePublicHeaderTitle:
    - type: scrollView
      style:
        ..style.scrollBox:
      children:
        - type: view
          style:
            ..style.searchView:
          children:
            - type: label
              text: Diagnoses
              dataKey:
              style:
                ..style.searchTitle:
            - type: view
              viewTag: searchBox
              style:
                ..style.searchBox:
              children:
                - type: view
                  style:
                    ..style.searchSecondBox:
                  children:
                    - type: view
                      style:
                        ..style.ICDsearch:
                      children:
                        - type: image
                          path: ICDsearch.svg
                          style:
                            ..style.ICDImg:
                        - type: textField
                          viewTag: CodeListTag
                          placeholder: Search
                          dataKey: formData.diagnosis.descriptiveList.code
                          style:
                            ..style.ICDField:
                            fontSize: .Nfont.h14
                          onInput:
                            - ..event.diSearch
                    - type: textField
                      viewTag: descriptionTag
                      placeholder: Description
                      dataKey: formData.diagnosis.descriptiveList.description
                      style:
                        ..style.description:
                        fontSize: .Nfont.h14
                - type: textView
                  viewTag: CommentsTag
                  placeholder: Comments
                  dataKey: formData.diagnosis.descriptiveList.comment
                  style:
                    ..style.commentView:
                    fontSize: .Nfont.h14
            - type: label
              text: + add more
              style:
                ..style.addBox:
              onClick:
                - ..event.addClick
            - type: view
              viewTag: listData
              style:
                height: auto
                width: auto
                display: ..formData.listDataflag
              children:
                - type: list
                  contentType: listObject
                  listObject: ..apiRequest.diagnosesDoc.docReq.name.data.diagnosis.descriptiveList
                  iteratorVar: itemObject
                  style:
                    ..style.listDataShowList:
                  children:
                    - type: listItem
                      itemObject: ""
                      style:
                        ..style.listDataShowListItem:
                      children:
                        - type: view
                          style:
                            ..style.showListItemBox:
                          children:
                            - type: image
                              path: x.svg
                              style:
                                ..style.xImg:
                              onClick:
                                - ..event.delClick
                            - type: label
                              textBoard:
                                - text: ""
                                  dataKey: itemObject.code
                                - text: "&nbsp;-&nbsp;"
                                - text: ""
                                  dataKey: itemObject.description
                              style:
                                ..style.descriptionValue:
                        - type: label
                          dataKey: itemObject.comment
                          style:
                            ..style.commentValue:
            - type: view
              viewTag: searchShowTag
              style:
                ..style.searchShow:
                display: ..formData.searchShow
              children:
                - type: view
                  viewTag: CodeTag
                  style:
                    ..style.codeView:
                  children:
                    - type: view
                      viewTag: ShowTag
                      style:
                        ..style.scrollShow:
                      children:
                        - type: list
                          contentType: listObject
                          listObject: ..formDataTemp.allListString
                          iteratorVar: itemObject
                          viewTag: CodeTags
                          style:
                            ..style.dataList:
                          children:
                            - type: listItem
                              itemObject: ""
                              style:
                                ..style.dataListItem:
                              children:
                                - type: label
                                  dataKey: itemObject.0.2
                                  style:
                                    ..style.dataListItemValue:
                                  onClick:
                                    - ..event.searchDataClick
    - type: view
      style:
        ..style.btnBox:
      children:
        - type: button
          text: Done
          viewTag: btnTag
          style:
            ..style.btn:
          onClick:
            - ..event.btnClick

    - .publicDeleteUP:
      viewTag: BaseDelWarningView
      leftButton:
        - actionType: popUpDismiss
          popUpView: BaseDelWarningView
      rightButton:
        - actionType: evalObject
          object:
            - =.builtIn.array.removeByName:
                dataIn:
                  object: =..apiRequest.diagnosesDoc.docReq.name.data.diagnosis.descriptiveList
                  key: code
                  name: =..formData.selectedDiagnosis.code
            - ..formData.listDataflag@: "block"
            - actionType: builtIn
              funcName: redraw
              viewTag: listData
        - actionType: popUpDismiss
          popUpView: BaseDelWarningView

    - .BaseWarningView:
      message: "Please complete required fields: Search&Description"
      viewTag: SearchWarning

    - .BaseWarningView:
      message: "Do not add repeatedly"
      viewTag: repeatWarning

    - .Normal:
      message: "Do you want to save your changes?"
      viewTag: judgmentOperation
      leftButton:
        - actionType: popUpDismiss
          popUpView: judgmentOperation
        - actionType: builtIn
          funcName: goBack
          reload: true
      rightButton:
        - actionType: evalObject
          object:
            - =.SelectDiagnosis.apiRequest.diagnosesDoc.docAPI.store: ""
            - .Global.formData.providerDoc.diagnosesDoc@: =..apiRequest.diagnosesDoc.docResp.doc
        - actionType: popUpDismiss
          popUpView: judgmentOperation
        - actionType: builtIn
          funcName: goBack
          reload: true

  event:
    delClick:
      - actionType: popUp
        popUpView: BaseDelWarningView
      - actionType: updateObject
        dataKey: SelectDiagnosis.formData.selectedDiagnosis
        dataObject: itemObject
    diSearch:
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.string.equal:
                  dataIn:
                    string1: =..formData.diagnosis.descriptiveList.code
                    string2: ""
              - actionType: evalObject
                object:
                  - ..formData.listDataflag@: "block"
                  - ..formData.searchShow@: "none"
              - actionType: evalObject
                object:
                  - ..formData.listDataflag@: "none"
                  - ..formData.searchShow@: "block"
      - actionType: evalObject
        object:
          - ..formDataTemp.allListInfo@: []
          - ..formDataTemp.allListString@: []
      - actionType: evalObject
        object:
          - =.builtIn.search.queryCode:
              dataIn:
                query: =..formData.diagnosis.descriptiveList.code
              dataOut: SelectDiagnosis.formDataTemp.allListInfo
          - ..formDataTemp.allListString@: =..formDataTemp.allListInfo
      - actionType: builtIn
        funcName: redraw
        viewTag: CodeTag
      - actionType: builtIn
        funcName: redraw
        viewTag: CodeTags
      - actionType: builtIn
        funcName: show
        viewTag: CodeTag
      - actionType: builtIn
        funcName: redraw
        viewTag: listData
      - actionType: builtIn
        funcName: show
        viewTag: ShowTag
      - actionType: popUp
        popUpView: CodeTag
        dismissOnTouchOutside: true
      - actionType: builtIn
        funcName: redraw
        viewTag: searchShowTag
    searchDataClick:
      - emit:
          dataKey:
            var: itemObject
          actions:
            - ..formData.diagnosis.descriptiveList.code@: $var.0.0
            - ..formData.diagnosis.descriptiveList.description@: $var.0.1
            - ..formData.listDataflag@: ""
      - actionType: builtIn
        funcName: redraw
        viewTag: CodeListTag
      - actionType: builtIn
        funcName: redraw
        viewTag: descriptionTag
      - actionType: builtIn
        funcName: hide
        viewTag: ShowTag
      - actionType: builtIn
        funcName: redraw
        viewTag: listData
      - actionType: builtIn
        funcName: show
        viewTag: listData
      - actionType: builtIn
        funcName: hide
        viewTag: CodeTag
    addClick:
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.array.allComplete:
                  dataIn:
                    - =..formData.diagnosis.descriptiveList.code
                    - =..formData.diagnosis.descriptiveList.description
              - continue
              - actionType: popUp
                popUpView: SearchWarning
                wait: true
                popUpDismiss: 2000
      - actionType: evalObject
        object:
          - if:
              - =.builtIn.array.containingValue:
                  dataIn:
                    object: =..apiRequest.diagnosesDoc.docReq.name.data.diagnosis.descriptiveList
                    key: code
                    value: =..formData.diagnosis.descriptiveList.code
              - actionType: popUp
                popUpView: repeatWarning
                wait: true
                popUpDismiss: 2000
              - continue

      - emit:
          actions:
            - =.builtIn.array.add:
                dataIn:
                  object: =..apiRequest.diagnosesDoc.docReq.name.data.diagnosis.descriptiveList
                  value: =..formData.diagnosis.descriptiveList
      - actionType: evalObject
        object:
          - ..formData.diagnosis.descriptiveList.code@: ""
          - ..formData.diagnosis.descriptiveList.description@: ""
          - ..formData.diagnosis.descriptiveList.comment@: ""
          - ..formData.listDataflag@: "block"
      - actionType: builtIn
        funcName: redraw
        viewTag: listData
      - actionType: builtIn
        funcName: redraw
        viewTag: CodeListTag
      - actionType: builtIn
        funcName: redraw
        viewTag: descriptionTag
      - actionType: builtIn
        funcName: hide
        viewTag: ShowTag
      - actionType: builtIn
        funcName: show
        viewTag: listData
      - actionType: builtIn
        funcName: redraw
        viewTag: CommentsTag
      - actionType: builtIn
        funcName: hide
        viewTag: CodeTag
    btnClick:
      - actionType: evalObject
        object:
          - =.SelectDiagnosis.apiRequest.diagnosesDoc.docAPI.store: ""
          - .Global.formData.providerDoc.diagnosesDoc@: =..apiRequest.diagnosesDoc.docResp.doc
      - actionType: builtIn
        funcName: goBack
        reload: true
  style:
    scrollBox:
      width: "1"
      height: "0.84729"
      boxSizing: "border-box"
      overflow: "scroll"
    btnBox:
      width: "1"
      height: "0.0972"
      boxSizing: "border-box"
      overflow: "scroll"
      backgroundColor: "#ffffff"
      boxShadow: "1px 1px 4px 1px #dededf"
      textAlign:
        x: center
    btn:
      marginTop: "0.0123"
      height: "0.0443"
      width: "0.84"
      border:
        style: 1
      borderRadius: "5"
      backgroundColor: "#2988e6"
      color: "#ffffff"
      fontSize: .Nfont.h14
      boxSizing: border-box
      fontWeight: "600"
      textAlign:
        x: center
    searchView:
      width: "1"
      height: "auto"
      marginTop: "0.0221674"
    searchBox:
      marginTop: "0.016009"
      marginLeft: "0.04"
      height: "auto"
      width: "0.92"
    searchSecondBox:
      width: "0.92"
      height: "auto"
      boxSizing: border-box
    ICDsearch:
      display: "inline-block"
      height: "0.037"
      width: "0.325"
      boxSizing: border-box
      border:
        style: 3
      borderRadius: "4"
      borderWidth: "1.5"
      borderColor: "#dedede"
      overflow: hidden
    ICDImg:
      marginLeft: "0.016"
      display: "inline-block"
      height: "0.015"
      verticalAlign: middle
    ICDField:
      marginLeft: "0.01"
      display: "inline-block"
      height: "0.037"
      width: "0.24"
      boxSizing: border-box
      border:
        style: 1
      fontSize: .Nfont.h12
      verticalAlign: middle

      color: "0x333333"
    searchTitle:
      marginLeft: "0.04"
      width: "auto"

      fontSize: .Nfont.h14
      fontWeight: "600"
    description:
      marginLeft: "0.02"
      display: "inline-block"
      fontSize: .Nfont.h12
      height: "0.037"
      width: "0.573"
      textIndent: "12px"
      boxSizing: border-box
      border:
        style: 3
      borderRadius: "4"
      borderWidth: "1.5"
      borderColor: "#dedede"

      color: "0x333333"
    commentView:
      marginTop: "0.01"
      width: "0.92"
      height: "0.0874"
      boxSizing: border-box
      textIndent: "12px"
      fontSize: .Nfont.h12
      border:
        style: 3
      borderRadius: "4"
      borderWidth: "1.5"
      borderColor: "#dedede"

      color: "0x333333"
      paddingTop: "6px"
    searchShow:
      left: "0.04"
      width: "auto"
      height: "auto"
      backgroundColor: "0xffffff"
      borderRadius: "4"
      boxSizing: "border-box"
      zIndex: "20"
    codeView:
      display: "none"
      width: "0.92"
      height: "auto"

      borderRadius: "4"
      boxSizing: "border-box"
      backgroundColor: "0xffffff"
      boxShadow: "1px 1px 4px 1px #dededf"
      zIndex: 10
    addBox:
      marginLeft: "0.76"
      marginTop: "0.0073"
      fontSize: .Nfont.h14
      color: "0x1492e6"
      height: "auto"
      width: "auto"
      fontWeight: "600"
    listDataShowList:
      marginLeft: "0.04"
      width: "0.92"
      marginTop: "0.01477"
      height: "auto"
    listDataShowListItem:
      marginTop: "0.01"
      width: "0.92"
      height: "auto"
      left: "0"
      overflow: hidden
    showListItemBox:
      width: "0.92"
      height: "auto"
    xImg:
      display: "inline-block"
      height: "0.025"
      zIndex: 10
      verticalAlign: top
    codeValue:
      display: "inline-block"
      marginLeft: "0.02"
      height: "auto"
      width: "0.17"
      textAlign:
        x: left

      backgroundColor: "0xffffff"
      wordWrap: break-word
      fontSize: .Nfont.h14
      lineHeight: "2.28vh"
      fontWeight: "550"
      verticalAlign: top
      color: "0x333333"
    decollator:
      verticalAlign: middle
      display: "inline-block"
      width: "auto"
      height: "auto"
      fontSize: .Nfont.h2
    descriptionValue:
      verticalAlign: top
      marginLeft: "0.018"
      display: "inline-block"
      height: "auto"
      width: "0.818666666"
      textAlign:
        x: left
      backgroundColor: "0xffffff"

      wordWrap: break-word
      fontSize: .Nfont.h14
      color: "0x333333"
    commentValue:
      marginTop: "0.002"
      marginLeft: "0.07"
      width: "0.845"
      height: "auto"
      color: "0x666666"

      wordWrap: break-word
      fontSize: .Nfont.h14
    scrollShow:
      width: "0.9"
      height: "0.3"
      marginLeft: "0.02"
      overflow: scroll
    dataList:
      width: "0.9"
      height: "0.3"
      margin: "0"
    dataListItem:
      width: "0.9"
      marginTop: "0.002"
      height: "auto"
      overflow: hidden
    dataListItemValue:
      width: "0.88"
      textIndent: 20px
      marginTop: "0.005"
      textAlign:
        x: left
        y: center
      height: "auto"
      fontSize: .Nfont.h14
      color: "0x143459"
      wordWrap: break-word
