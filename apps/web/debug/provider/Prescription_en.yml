Prescription:
  pageNumber: "181"
  title: "Prescription(RX)"

  init: #Page initialization
    - .SignInCheck

    - .Global.prescriptionDrug.name@: "Search"
    - if:
        - .Global.prescriptionArray
        - .Prescription.prescription2@: =.Global.prescriptionArray
        - continue

    - if:
        #判断是否从ProviderMacros回来，需要复现之前已填的数据
        - =.Global.formData.providerDoc.prescription.id
        - actionType: evalObject
          object:
            - ..apiRequest.prescription.docReq@: =.Global.formData.providerDoc.prescription
            - .Prescription.prescription2@: =.Global.formData.providerDoc.prescription.name.data.prescriptionArray
        - actionType: evalObject
          object:
            #页面进入时就创建文档
            - =.Prescription.apiRequest.prescription.docAPI.store: ""
            # 将创建的文档数据重新给note 进行update
            - ..apiRequest.prescription.docReq@: =..apiRequest.prescription.docResp.doc

    # 判断是否签名
    - if:
        - =..apiRequest.prescription.docReq.name.data.whetherSign
        - continue
        # 非空修改显示的标识,刷新签名区域
        - actionType: evalObject
          object:
            # 签名的时间
            - ..formData.signatureTime@: =.Prescription.apiRequest.prescription.docReq.name.data.signatureTime
            # 签名的id
            - ..formData.temporarySignature@: =.Prescription.apiRequest.prescription.docReq.name.data.signatureId
            - ..formData.flag@: "block"

    # 判断 drugName是否为search
    - if:
        - =.builtIn.string.equal:
            dataIn:
              string1: =..prescriptionTemp.drugName
              string2: "Search"
        - continue
        - actionType: evalObject
          object:
            - ..formData.btnColor@: "0x2988e6"
            - ..formData.drugColor@: "0x333333"

    # 判断prescriotipn2是否为空
    - actionType: evalObject
      object:
        - =.builtIn.array.getListLength:
            dataIn:
              object: =.Prescription.prescription2
            dataOut: Prescription.formData.prescriptionLength

    - actionType: evalObject
      object:
        - if:
            - =.builtIn.string.equal:
                dataIn:
                  string1: =..formData.prescriptionLength
                  string2: "0"
            - ..formData.formShow@: "none"
            - ..formData.formShow@: "block"

    - actionType: evalObject
      object:
        # 拼接lic
        - =.builtIn.string.concat:
            dataIn:
              - =.Global.MyProfile.name.data.MedicalLicense.0.state
              - "&nbsp;"
              - =.Global.MyProfile.name.data.MedicalLicense.0.medicalLicense
            dataOut: Prescription.apiRequest.prescription.docReq.name.data.providerInfo.lic

        # 拼接 provider fullName
        - =.builtIn.string.concat:
            dataIn:
              - =.Global.MyProfile.name.data.fullName
              - ","
              - =.Global.MyProfile.name.data.title
            dataOut: Prescription.apiRequest.prescription.docReq.name.data.providerInfo.fullName

    - actionType: evalObject
      object:
        - =.builtIn.array.formatStringFill:
            dataIn:
              strArr: =.Global.MyProfile.name.data.selectedSpecialty
              sfill: ","
            dataOut: Prescription.apiRequest.prescription.docReq.name.data.providerInfo.specialty

  formData: #Input data here
    flag: "none"
    temporarySignature: ""
    signatureTime: ""
    whetherSign: ""
    prescriptionCount: ""
    selectedItem: ""
    drugColor: "0xb6b6b6"
    formShow: "none"
    btnColor: "0xe5e5e5"
    prescriptionLength: ""
  prescriptionTemp:
    drugName: .Global.prescriptionDrug.name
    dosage: .Global.prescriptionDrug.dosage
    genericName: .Global.prescriptionDrug.genericName
    strength: .Global.prescriptionDrug.strength
    route: .Global.prescriptionDrug.route
    RXcui: .Global.prescriptionDrug.RXcui
    drugCode: .Global.prescriptionDrug.drugCode
    frequency: ""
    disp: ""
    refills: ""
  list: []
  prescription2: []

  formDataTemp: #Input data temp here, datatemp should not mix with formData

  apiRequest: #Input data request here
    prescription:
      deleteInfo:
        id:
          - =..apiRequest.prescription.docResp.doc.id
      docResp: ""
      docReq:
        eid: .Global.currentRoom.edge.id
        reid: ""
        type: .DocType.Prescription
        subtype:
          mediaType: "application/json"
          isEncrypted: "1"
        name:
          data:
            classTag:
              name: Provider
              fontColor: "0x30b354"
              backgroundColor: "0xe4f5e9"
              display: block
            statusTag:
              name: Private
              fontColor: "0x4c5264"
              backgroundColor: "0xececee"
              display: block
            userInfo:
              patientName: .Global.formData.patientName
              participateName: .Global.formData.providerTitle
            signatureId: ""
            signatureTime: ""
            prescriptionCount: ""
            prescriptionArray: []
            whetherSign: "true"
            facilityInfo:
              facilityAvatarID: .Global.currentFacilityDoc.name.data.basicInfo.businessLogo
              facilityName: .Global.currentFacilityDoc.name.data.basicInfo.medicalFacilityName
              address: .Global.currentFacilityDoc.name.data.basicInfo.location
              email: .Global.currentFacilityDoc.name.data.basicInfo.email
              phone: .Global.currentFacilityDoc.name.data.basicInfo.phoneNumber
              fax: .Global.currentFacilityDoc.name.data.basicInfo.fax
              website: .Global.currentFacilityDoc.name.data.basicInfo.website
            providerInfo:
              lic: ""
              npi: .Global.MyProfile.name.data.NPI
              dea: .Global.MyProfile.name.data.DEA
              email: .Global.MyProfile.name.data.email
              phone: .Global.currentFacilityDoc.name.data.basicInfo.phoneNumber
              fullName: ""
              Medicine: .Global.currentFacilityDoc.name.data.basicInfo.medicalFacilityName
              specialty: ""
            patientInfo:
              examDate: .Global.roomInfo.edge.stime
              fullName: .Global.currentMeetingPatientProfile.basicInfo.fullName
              dob: .Global.currentMeetingPatientProfile.basicInfo.dateOfBirth
              phoneNumber: .Global.currentMeetingPatientProfile.basicInfo.phone
              email: .Global.currentMeetingPatientProfile.contactInfo.email
              address: .Global.currentMeetingPatientProfile.contactInfo.address.fullAddress
          title: "Prescription(RX)"
          user: .Global.formData.providerTitle
      docAPI:
        .DocAPI: ""
        store:
          api: cd
          dataIn: Prescription.apiRequest.prescription.docReq
          dataOut: Prescription.apiRequest.prescription.docResp
        delet:
          api: dx
          dataIn: Prescription.apiRequest.prescription.deleteInfo
    newSign:
      docRes: ""
      docReq: #DOC
        type: .DocType.DocumentSignature
        name:
          title: ""
          type: ..apiRequest.newSign.docReq.subtype.mediaType
          data: ""
        eid: .Global.rootNotebookID
        subtype:
          mediaType: ""
      docAPI: # DOCAPI
        store:
          api: cd
          dataIn: apiRequest.newSign.docReq
          dataOut: Prescription.apiRequest.newSign.docRes

  style: #Input style fragment here

  components:
    - .BasePublicHeader:
      children:
        - .BasePublicHeaderLeft:
          leftClick:
            - actionType: evalObject
              object:
                - =..apiRequest.prescription.docAPI.delet: ""
            - actionType: builtIn
              funcName: goBack
              reload: true
        - .BasePublicHeaderTitle:
        - .BasePublicHeaderRightText:
          onClick:
            # 签名处理
            - actionType: saveSignature
              dataObject: BLOB
              dataKey: Prescription.apiRequest.newSign.docReq.name.data
              isEmpty: Prescription.formData.whetherSign
            # 保存签名
            - actionType: evalObject
              object:
                - ..apiRequest.newSign.docReq.reid@: =.Prescription.apiRequest.prescription.docReq.id

            - actionType: evalObject
              object:
                - if:
                    - =..formData.whetherSign
                    - continue
                    - =..apiRequest.newSign.docAPI.store: ""
            - actionType: evalObject
              object:
                - if:
                    - =..formData.temporarySignature
                    - actionType: evalObject
                      object:
                        - ..apiRequest.prescription.docReq.name.data.signatureTime@: =..formData.signatureTime
                        - ..apiRequest.prescription.docReq.name.data.signatureId@: =..formData.temporarySignature
                        - ..apiRequest.prescription.docReq.name.data.whetherSign@: false
                        - ..formData.whetherSign@: false
                    - actionType: evalObject
                      object:
                        - ..apiRequest.prescription.docReq.name.data.signatureTime@: =..apiRequest.newSign.docRes.doc.ctime
                        - ..apiRequest.prescription.docReq.name.data.signatureId@: =..apiRequest.newSign.docRes.doc.id
                        - ..apiRequest.prescription.docReq.name.data.whetherSign@: =..formData.whetherSign
            - actionType: evalObject
              object:
                - =.Prescription.apiRequest.prescription.docAPI.store: ""
                - .Global.formData.providerDoc.prescription@: =..apiRequest.prescription.docResp.doc
                - goto: ProviderMacros
    - type: scrollView
      style:
        width: "1"
        height: "0.846"
        overflow: scroll

      children:
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.0246"
            height: "auto"
            width: "0.92"
          children:
            - type: image
              path: office-building.svg
              path=func: .builtIn.utils.prepareDocToPath
              dataKey: apiRequest.prescription.docReq.name.data.facilityInfo.facilityAvatarID
              style:
                verticalAlign: middle
                display: "inline-block"
                height: "0.0578"
                width: "5.78vh"
            - type: view
              style:
                verticalAlign: middle
                marginLeft: "0.08"
                display: "inline-block"
                height: "auto"
                width: "0.71"
                overflow: hidden
              children:
                - type: label
                  dataKey: apiRequest.prescription.docReq.name.data.facilityInfo.facilityName
                  style:
                    width: "0.71"
                    height: "auto"
                    fontSize: .Nfont.h20
                    fontWeight: "600"

                    verticalAlign: middle
                    wordWrap: break-word
                - type: label
                  dataKey: apiRequest.prescription.docReq.name.data.facilityInfo.address
                  style:
                    marginTop: "0.0110"
                    width: "0.71"
                    height: "auto"
                    fontSize: .Nfont.h14
                    color: "0x666666"

                    verticalAlign: middle
                    wordWrap: break-word
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.00738"
            width: "0.92"
            height: "auto"
            overflow: hidden

          children:
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: Email
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.prescription.docReq.name.data.facilityInfo.email
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: Website
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.prescription.docReq.name.data.facilityInfo.website
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Main #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.prescription.docReq.name.data.facilityInfo.phone
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Fax #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.prescription.docReq.name.data.facilityInfo.fax
        - .DocPublicLine:
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.00738"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Exam Date
                - .DocPublicStyleTwoRight:
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: apiRequest.prescription.docReq.name.data.patientInfo.examDate
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Patient Name
                - .DocPublicStyleTwoRight:
                  dataKey: apiRequest.prescription.docReq.name.data.patientInfo.fullName
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: Date of Birth
                - .DocPublicStyleTwoRight:
                  dataKey: apiRequest.prescription.docReq.name.data.patientInfo.dob
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Phone #"
                - .DocPublicStyleTwoRight:
                  dataKey: apiRequest.prescription.docReq.name.data.patientInfo.phoneNumber
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Email"
                - .DocPublicStyleTwoRight:
                  dataKey: apiRequest.prescription.docReq.name.data.patientInfo.email
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  text: "Patient Address"
            - .DocPublicStyleTwoBox:
              children:
                - .DocPublicStyleTwoLeft:
                  dataKey: apiRequest.prescription.docReq.name.data.patientInfo.address
                  style:
                    height: "auto"
                    width: "0.92"
                    fontSize: .Nfont.h14
                    wordWrap: break-word
                    color: "0x333333"
                    fontWeight: "600"
        - .DocPublicLine:
        - type: view
          viewTag: drugShowTag
          style:
            marginTop: "0.0246"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
            border:
              style: 3
            boxSizing: border-box
            borderRadius: "4"
            borderColor: "0xdedede"
            overflow: hidden
          children:
            - type: label
              text: Drug
              dataKey:
              style:
                marginLeft: "0.032"
                marginTop: "0.0246"
                fontWeight: "600"
                color: "0x333333"
                fontSize: .Nfont.h14
            - type: view
              style:
                marginTop: "0.01"
                marginLeft: "0.032"
                height: "0.037"
                width: "0.856"

                border:
                  style: 3
                  width: "1.5px"
                borderRadius: "4"
                boxSizing: "border-box"
                borderColor: "0xdededf"
                backgroundColor: "0xffffff"
                overflow: hidden
                textAlign:
                  y: center
              children:
                - type: image
                  path: searchBlue.svg
                  style:
                    marginLeft: "0.02"
                    verticalAlign: middle
                    display: "inline-block"
                    height: "0.02"
                - type: label
                  dataKey: prescriptionTemp.drugName
                  style:
                    margin: "0"
                    marginLeft: "0.032" #12px
                    border:
                      style: 1
                    width: "0.744"
                    height: "auto"
                    verticalAlign: middle
                    boxSizing: "border-box"
                    fontSize: .Nfont.h14
                    display: "inline-block"
                    color: ..formData.drugColor
                    overflow: hidden
                    whiteSpace: nowrap
                    text-overflow: ellipsis
                  onClick:
                    # 签名处理
                    - actionType: saveSignature
                      dataObject: BLOB
                      dataKey: Prescription.apiRequest.newSign.docReq.name.data
                      isEmpty: Prescription.formData.whetherSign

                    # 保存签名
                    - actionType: evalObject
                      object:
                        # 签名reid指向prescription doc 的id
                        - ..apiRequest.newSign.docReq.reid@: =.Prescription.apiRequest.prescription.docResp.doc.id

                    - actionType: evalObject
                      object:
                        - if:
                            - =..formData.whetherSign
                            - continue
                            - =..apiRequest.newSign.docAPI.store: ""

                    #  指定 eid
                    - actionType: evalObject
                      object:
                        - ..apiRequest.prescription.docReq.eid@: =.Global.currentRoom.edge.id

                    # 签名处理
                    - actionType: evalObject
                      object:
                        - if:
                            - =..formData.temporarySignature
                            - actionType: evalObject
                              object:
                                - ..apiRequest.prescription.docReq.name.data.signatureTime@: =..formData.signatureTime
                                # 存放签名的id到newNote
                                - ..apiRequest.prescription.docReq.name.data.signatureId@: =..formData.temporarySignature
                                - ..apiRequest.prescription.docReq.name.data.whetherSign@: false
                                - ..formData.whetherSign@: false
                            - actionType: evalObject
                              object:
                                - ..apiRequest.prescription.docReq.name.data.signatureTime@: =..apiRequest.newSign.docRes.doc.ctime
                                - ..apiRequest.prescription.docReq.name.data.signatureId@: =..apiRequest.newSign.docRes.doc.id
                                - ..apiRequest.prescription.docReq.name.data.whetherSign@: =..formData.whetherSign

                    # 保存prescription
                    - actionType: evalObject
                      object:
                        - =..apiRequest.prescription.docAPI.store: ""
                        - .Global.prescriptionArray@: []

                    - actionType: evalObject
                      object:
                        - .Global.formData.pageName@: "Prescription"
                        - .Global.prescriptionArray@: =.Prescription.prescription2
                        - .Global.formData.providerDoc.prescription@: =..apiRequest.prescription.docResp.doc

                    - goto: PrescriptionDrug
            - type: view
              style:
                marginTop: "0.0246"
                height: "auto"
                width: "0.92"
                boxSizing: border-box
              children:
                - .DocPublicInlineStyleTwoBox:
                  children:
                    - .DocPublicInlineStyleTwoTitle:
                      text: Quantity
                    - .DocPublicInlineStyleTwoInput:
                      dataKey: prescriptionTemp.frequency
                      viewTag: frequencyTag
                - .DocPublicInlineStyleTwoBox:
                  style:
                    marginLeft: "0.0293"
                  children:
                    - .DocPublicInlineStyleTwoTitle:
                      text: Directions
                    - .DocPublicInlineStyleTwoInput:
                      dataKey: prescriptionTemp.disp
                      viewTag: dispTag
                - .DocPublicInlineStyleTwoBox:
                  style:
                    marginLeft: "0.0293"
                  children:
                    - .DocPublicInlineStyleTwoTitle:
                      text: Refills
                    - .DocPublicInlineStyleTwoInput:
                      dataKey: prescriptionTemp.refills
                      viewTag: refillsTag

            - type: view
              viewTag: btnTag
              style:
                marginTop: "0.0246"
                marginLeft: "0.232"
                width: "0.4586"
                height: "0.0369"
                backgroundColor: ..formData.btnColor
                borderRadius: "5"
                textAlign:
                  y: center
              children:
                # - type: view
                #   style:
                #     width: "0.4586"
                #     height: "0.0369"
                #   children:
                - type: image
                  path: addWhite.svg
                  style:
                    marginLeft: "0.0533"
                    height: "0.02"
                    verticalAlign: middle
                    display: "inline-block"
                - type: label
                  text: Add Prescription
                  dataKey:
                  style:
                    marginLeft: "0.032"
                    width: "auto"
                    height: "0.0369"
                    fontSize: .Nfont.h14
                    display: "inline-block"
                    color: "0xffffff"
                    verticalAlign: middle
                    lineHeight: 3.69vh
              onClick:
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..prescriptionTemp.drugName
                              string2: "Search"
                        - actionType: popUp
                          popUpView: addWarnTag
                          wait: true
                          popUpDismiss: 2000
                        - continue
                - actionType: evalObject
                  object:
                    - =.builtIn.array.add:
                        dataIn:
                          object: =..prescription2
                          value: =..prescriptionTemp
                - actionType: evalObject
                  object:
                    - ..apiRequest.prescription.docReq.name.data.prescriptionArray@: =..prescription2
                    - ..prescriptionTemp.drugName@: "Search"
                    - .Global.prescriptionDrug.name@: "Search"
                    - ..prescriptionTemp.genericName@: ""
                    - ..prescriptionTemp.strength@: ""
                    - ..prescriptionTemp.dosage@: ""
                    - ..prescriptionTemp.route@: ""
                    - ..prescriptionTemp.frequency@: ""
                    - ..prescriptionTemp.disp@: ""
                    - ..prescriptionTemp.refills@: ""
                    - ..prescriptionTemp.RXcui@: ""
                    - ..prescriptionTemp.drugCode@: ""
                    - ..formData.formShow@: "block"
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..prescriptionTemp.drugName
                              string2: "Search"
                        - actionType: evalObject
                          object:
                            - ..formData.btnColor@: "0xe5e5e5"
                            - ..formData.drugColor@: "0xb6b6b6"
                        - continue

                - actionType: builtIn
                  funcName: redraw
                  viewTag: btnTag
                - actionType: builtIn
                  funcName: redraw
                  viewTag: prescriptionTag
                - actionType: builtIn
                  funcName: redraw
                  viewTag: drugShowTag
            - type: view
              style:
                marginTop: "0.0246"

        - type: view
          viewTag: prescriptionTag
          style:
            display: ..formData.formShow
            marginTop: "0.0246"
            marginLeft: "0.04"
            width: "0.92"
            height: "auto"
            border:
              style: 3
            boxSizing: border-box
            borderRadius: "4"
            borderColor: "0xdedede"
            overflow: hidden
            paddingBottom: "0.0147"
          children:
            - type: list
              contentType: listObject
              listObject: =.Prescription.prescription2
              iteratorVar: itemObject
              viewTag: prescriptionTag
              style:
                width: "0.92"
                height: "auto"
                boxSizing: border-box
              children:
                - type: listItem
                  style:
                    width: "0.9"
                    height: "auto"
                    overflow: hidden
                    boxSizing: border-box
                  children:
                    - type: view
                      style:
                        marginTop: "0.0147"
                        width: "auto"
                        height: "auto"
                      children:
                        - type: view
                          style:
                            marginLeft: "0.032"
                            width: "0.856"
                            height: "auto"
                          children:
                            - type: image
                              path: x.svg
                              style:
                                display: "inline-block"
                                height: "0.0221"
                                verticalAlign: middle
                              onClick:
                                - actionType: popUp
                                  popUpView: BaseDelWarningView
                                - actionType: updateObject
                                  dataKey: Prescription.formData.selectedItem
                                  dataObject: itemObject
                            - type: label
                              text: Drug
                              style:
                                marginLeft: "0.0213"
                                display: "inline-block"
                                height: "auto"
                                width: "0.78"
                                fontSize: .Nfont.h12
                                color: "0x666666"
                                verticalAlign: middle
                        - type: label
                          dataKey: itemObject.drugName
                          style:
                            marginLeft: "0.1013"
                            width: "0.78"
                            height: "auto"
                            textAlign:
                              x: left
                            fontSize: .Nfont.h14
                            fontWeight: "600"
                            wordWrap: break-word
                        - type: label
                          text: Generic Name
                          style:
                            marginTop: "0.0074"
                            marginLeft: "0.1013"
                            width: "0.78"
                            height: "auto"
                            fontSize: .Nfont.h12
                            color: "0x666666"
                        - type: label
                          dataKey: itemObject.genericName
                          style:
                            marginLeft: "0.1013"
                            width: "0.78"
                            height: "auto"
                            textAlign:
                              x: left
                            fontSize: .Nfont.h14
                            fontWeight: "600"
                            wordWrap: break-word
                        - type: label
                          text: Strength
                          style:
                            marginTop: "0.0074"
                            marginLeft: "0.1013"
                            width: "0.78"
                            height: "auto"
                            fontSize: .Nfont.h12
                            color: "0x666666"
                        - type: label
                          dataKey: itemObject.strength
                          style:
                            marginLeft: "0.1013"
                            width: "0.78"
                            height: "auto"
                            textAlign:
                              x: left
                            fontSize: .Nfont.h14
                            fontWeight: "600"
                            wordWrap: break-word
                        - type: view
                          style:
                            marginTop: "0.0074"
                            marginLeft: "0.1013"
                            width: "0.78"
                            height: "auto"
                            overflow: hidden
                          children:
                            - type: view
                              style:
                                display: "inline-block"
                                height: "auto"
                                width: "0.416"
                                overflow: hidden
                                boxSizing: border-box
                              children:
                                - type: label
                                  text: Dosage Form
                                  style:
                                    width: "0.416"
                                    height: "auto"
                                    fontSize: .Nfont.h12
                                    color: "0x666666"
                                    boxSizing: border-box
                                - type: label
                                  dataKey: itemObject.dosage
                                  style:
                                    width: "0.416"
                                    height: "auto"
                                    textAlign:
                                      x: left
                                    fontSize: .Nfont.h14
                                    fontWeight: "600"
                                    wordWrap: break-word
                            - type: view
                              style:
                                marginLeft: "0.0492"
                                display: "inline-block"
                                height: "auto"
                                width: "0.083"
                                overflow: hidden
                                boxSizing: border-box
                              children:
                                - type: label
                                  text: Route
                                  style:
                                    width: "auto"
                                    height: "auto"
                                    fontSize: .Nfont.h12
                                    color: "0x666666"
                                    boxSizing: border-box
                                - type: label
                                  dataKey: itemObject.route
                                  style:
                                    width: "0.083"
                                    height: "auto"
                                    textAlign:
                                      x: left
                                    fontSize: .Nfont.h14
                                    fontWeight: "600"
                                    wordWrap: break-word
                        - type: view
                          style:
                            marginTop: "0.0074"
                            marginLeft: "0.1013"
                            width: "0.78"
                            height: "auto"
                            overflow: hidden
                          children:
                            - type: view
                              style:
                                display: "inline-block"
                                height: "auto"
                                width: "0.238"
                                overflow: hidden
                                boxSizing: border-box
                              children:
                                - type: label
                                  text: Quantity
                                  style:
                                    width: "0.238"
                                    height: "auto"
                                    fontSize: .Nfont.h12
                                    color: "0x666666"
                                    boxSizing: border-box
                                - type: label
                                  dataKey: itemObject.frequency
                                  style:
                                    width: "0.238"
                                    height: "auto"
                                    textAlign:
                                      x: left
                                    fontSize: .Nfont.h14
                                    fontWeight: "600"
                                    wordWrap: break-word
                            - type: view
                              style:
                                marginLeft: "0.032"
                                display: "inline-block"
                                height: "auto"
                                width: "0.238"
                                overflow: hidden
                                boxSizing: border-box
                              children:
                                - type: label
                                  text: Directions
                                  style:
                                    width: "0.238"
                                    height: "auto"
                                    fontSize: .Nfont.h12
                                    color: "0x666666"
                                    boxSizing: border-box
                                - type: label
                                  dataKey: itemObject.disp
                                  style:
                                    width: "0.238"
                                    height: "auto"
                                    textAlign:
                                      x: left
                                    fontSize: .Nfont.h14
                                    fontWeight: "600"
                                    wordWrap: break-word
                            - type: view
                              style:
                                marginLeft: "0.032"
                                display: "inline-block"
                                height: "auto"
                                width: "0.238"
                                overflow: hidden
                                boxSizing: border-box
                              children:
                                - type: label
                                  text: Refills
                                  style:
                                    width: "0.238"
                                    height: "auto"
                                    fontSize: .Nfont.h12
                                    color: "0x666666"
                                    boxSizing: border-box
                                - type: label
                                  dataKey: itemObject.refills
                                  style:
                                    width: "0.238"
                                    height: "auto"
                                    textAlign:
                                      x: left
                                    fontSize: .Nfont.h14
                                    fontWeight: "600"
                                    wordWrap: break-word
                        - type: view
                          style:
                            marginTop: "0.0147"
                            marginLeft: "0.1013"
                            width: "0.78"
                            height: "1px"
                            backgroundColor: "0xf0f0f0"

        - type: view
          style:
            marginTop: "0.0246"
            marginLeft: "0.04"
            height: "auto"
            width: "0.92"
          children:
            - type: label
              textBoard:
                - text: Prescription is
                - text: "&nbsp;VOID&nbsp;"
                  color: "0xfb5051"
                - text: if the number of drugs prescribed is not noted.
              style:
                width: "0.7173"
                display: "inline-block"
                lineHeight: "2.58vh"
                fontSize: .Nfont.h14
                verticalAlign: top
            - type: textField
              placeholder: "0"
              dataKey: apiRequest.prescription.docReq.name.data.prescriptionCount
              style:
                marginLeft: "0.0933"
                display: "inline-block"
                width: "0.1093"
                height: "0.0369"
                boxSizing: border-box
                verticalAlign: top
                border:
                  style: "3"
                borderColor: "0xdedede"
                borderRadius: "4"
                textIndent: "12px"
                fontSize: .Nfont.h14
                color: "0x333333"
              onInput:
                #  判断Add Prescription 条数
                - actionType: evalObject
                  object:
                    - =.builtIn.array.getListLength:
                        dataIn:
                          object: =..apiRequest.prescription.docReq.name.data.prescriptionArray
                        dataOut: Prescription.formData.prescriptionCount

                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..formData.prescriptionCount
                              string2: "0"
                        - actionType: popUp
                          popUpView: inputWarn
                          wait: true
                          popUpDismiss: 2000
                        - actionType: evalObject
                          object:
                            - if:
                                - =.builtIn.string.equal:
                                    dataIn:
                                      string1: =..formData.prescriptionCount
                                      string2: =..apiRequest.prescription.docReq.name.data.prescriptionCount
                                - continue
                                - actionType: popUp
                                  popUpView: checkView
                                  wait: true
                                  popUpDismiss: 2000
        - .DocPublicLine:
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.03"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - type: view
              style:
                height: "auto"
                width: "0.92"
              children:
                - type: label
                  text: "Signature"
                  style:
                    display: "inline-block"
                    width: "0.816"
                    fontSize: .Nfont.h14
                    height: "auto"
                    color: "0x333333"
                    fontWeight: "600"
                    textAlign:
                      x: left
                - type: label
                  text: "Clear"
                  style:
                    display: "inline-block"
                    width: "auto"
                    fontSize: .Nfont.h14
                    height: "auto"
                    color: "0xfb5051"
                  onClick:
                    - actionType: removeSignature
                      dataObject: BLOB
                      dataKey: Prescription.apiRequest.newSign.docReq.name.data
                      viewTag: signatureTag
                    - actionType: evalObject
                      object:
                        - ..formData.temporarySignature@: ""
                        - ..formData.signatureTime@: ""
                        - ..formData.flag@: "none"
                    - actionType: builtIn
                      funcName: redraw
                      viewTag: signatureTimeTag
                    # 显示签名区域隐藏
                    - actionType: builtIn
                      funcName: hide
                      viewTag: signatureShowTag
                    - actionType: builtIn
                      funcName: show
                      viewTag: signatureTag
        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.01"
            height: "0.128"
            width: "0.9"
            border:
              style: "4"
              color: "0xa9a9a9"
            borderWidth: "2"
          children:
            - type: label
              text: X
              style:
                .SignLabelStyle:
            - type: canvas
              dataKey: Prescription.apiRequest.newSign.docReq.name.data
              viewTag: signatureTag
              style:
                left: "0"
                width: "0.88"
                height: "0.128"
                overflow: scroll
            # 显示暂存的签名
            - type: image
              viewTag: signatureShowTag
              path=func: .builtIn.utils.prepareDocToPath
              # 传入签名文档的id
              dataKey: Prescription.formData.temporarySignature
              style:
                # 控制显示
                display: ..formData.flag
                left: "0"
                width: "0.88"
                top: "0"
                height: "0.128"
                overflow: scroll
                zIndex: "10"

        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.0146"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - type: view
              viewTag: signatureTimeTag
              style:
                display: ..formData.flag
                marginTop: "0.01"
                height: "auto"
                width: "0.92"
              children:
                - type: label
                  text=func: .builtIn.string.formatUnixtime_en
                  dataKey: apiRequest.prescription.docReq.name.data.signatureTime
                  style:
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    fontSize: .Nfont.h12
                    color: "0x757575"
                    verticalAlign: middle
                - type: label
                  text: "Digitally Signed"
                  dataKey:
                  style:
                    marginLeft: "0.02"
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    fontSize: .Nfont.h12
                    color: "0x757575"
                    verticalAlign: middle
            - type: view
              style:
                marginTop: "0.01"
                width: "auto"
                height: "auto"
              children:
                - type: label
                  text: Date
                  style:
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    color: "0x666666"
                    fontSize: .Nfont.h12
                - type: label
                  text=func: .builtIn.string.formatUnixtimeL_en
                  dataKey: apiRequest.prescription.docReq.ctime
                  style:
                    marginLeft: "0.0373"
                    display: "inline-block"
                    width: "auto"
                    height: "auto"
                    color: "0x333333"
                    fontSize: .Nfont.h12
                    fontWeight: "600"

        - type: view
          style:
            marginLeft: "0.04"
            marginTop: "0.0246"
            width: "0.92"
            height: "auto"
            overflow: hidden
          children:
            - type: label
              dataKey: apiRequest.prescription.docReq.name.data.providerInfo.fullName
              style:
                height: "auto"
                width: "0.92"
                color: "0x333333"
                fontSize: .Nfont.h16
                fontWeight: "600"
                wordWrap: break-word
            - type: label
              dataKey: apiRequest.prescription.docReq.name.data.providerInfo.specialty
              style:
                marginTop: "0.006"
                height: "auto"
                width: "0.92"
                color: "0x666666"
                fontSize: .Nfont.h14
                wordWrap: break-word
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "LIC #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.prescription.docReq.name.data.providerInfo.lic
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "NPI #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.prescription.docReq.name.data.providerInfo.npi
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "DEA #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.prescription.docReq.name.data.providerInfo.dea
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Email"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.prescription.docReq.name.data.providerInfo.email
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Fax #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.prescription.docReq.name.data.facilityInfo.fax
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Main #"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.prescription.docReq.name.data.facilityInfo.phone
            - .DocPublicStyleOneBox:
              children:
                - .DocPublicStyleOneLeft:
                  text: "Address"
                - .DocPublicStyleOneRight:
                  dataKey: apiRequest.prescription.docReq.name.data.facilityInfo.address
            - .DocPublicLine:
              style:
                marginTop: "0.0246"
                height: "0.00369"
        - type: label
          dataKey: apiRequest.prescription.docReq.name.data.facilityInfo.website
          style:
            marginTop: "0.01"
            width: "1"
            height: "auto"
            color: "0x666666"
            fontSize: .Nfont.h12
            textAlign:
              x: center
        - type: view
          style:
            marginTop: "0.03"
    - .BasePublicFooter:
      children:
        - type: view
          style:
            height: auto
            width: "auto"
          children:
            - .DocButtonPrivate:
              onClick:
                # 签名处理
                - actionType: saveSignature
                  dataObject: BLOB
                  dataKey: Prescription.apiRequest.newSign.docReq.name.data
                  isEmpty: Prescription.formData.whetherSign

                # 保存签名
                - actionType: evalObject
                  object:
                    # 签名reid指向 doc 的id
                    - ..apiRequest.newSign.docReq.reid@: =.Prescription.apiRequest.prescription.docReq.id

                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.whetherSign
                        - continue
                        - =..apiRequest.newSign.docAPI.store: ""

                #  指定 eid 和 reid
                - actionType: evalObject
                  object:
                    - ..apiRequest.prescription.docReq.eid@: =.Global.currentRoom.edge.id
                    - ..apiRequest.prescription.docReq.reid@: =.Global.roomInfo.edge.id

                # 签名处理
                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.temporarySignature
                        - actionType: evalObject
                          object:
                            - ..apiRequest.prescription.docReq.name.data.signatureTime@: =..formData.signatureTime
                            - ..apiRequest.prescription.docReq.name.data.signatureId@: =..formData.temporarySignature
                            - ..apiRequest.prescription.docReq.name.data.whetherSign@: false
                            - ..formData.whetherSign@: false
                        - actionType: evalObject
                          object:
                            - ..apiRequest.prescription.docReq.name.data.signatureTime@: =..apiRequest.newSign.docRes.doc.ctime
                            - ..apiRequest.prescription.docReq.name.data.signatureId@: =..apiRequest.newSign.docRes.doc.id
                            - ..apiRequest.prescription.docReq.name.data.whetherSign@: =..formData.whetherSign

                #  修改type
                - actionType: evalObject
                  object:
                    - =.builtIn.number.inhx:
                        dataIn:
                          intHex: =..apiRequest.prescription.docReq.type
                          index: 1
                          hex: 0
                        dataOut: Prescription.apiRequest.prescription.docReq.type

                # 保存newNote
                - actionType: evalObject
                  object:
                    - =..apiRequest.prescription.docAPI.store: ""
                    - =.builtIn.array.add:
                        dataIn:
                          object: =.Global.currentMeetingDoc
                          value: =..apiRequest.prescription.docResp.doc
                - actionType: evalObject
                  object:
                    .Global._nonce@:
                      =.builtIn.math.random: ""

                - actionType: evalObject
                  object:
                    - =.builtIn.utils.createAuditLog:
                        dataIn:
                          actionTypeCode: .ActionTypeCode.create
                          recordTypeCode: 2049
                          eid: =.Global.formData.currentFacility.relationEdge.id

                          user: =.Global.MyProfile.name.data.fullName
                          userId: =.Global.currentUser.vertex.id
                          targetUserId: =.Global.formData.auditLog.patientId
                          targetUser: =.Global.formData.auditLog.patientName
                          accessPort: provider
                        dataOut: Global.formData.auditLog.result

                - actionType: evalObject
                  object:
                    - goto: ProviderNoteSelect

            - .DocButtonRelease:
              onClick:
                #  判断Add Prescription 条数
                - actionType: evalObject
                  object:
                    - =.builtIn.array.getListLength:
                        dataIn:
                          object: =..apiRequest.prescription.docReq.name.data.prescriptionArray
                        dataOut: Prescription.formData.prescriptionCount
                - actionType: evalObject
                  object:
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..formData.prescriptionCount
                              string2: "0"
                        - ..formData.prescriptionCount@: ""
                        - continue
                    - if:
                        - =.builtIn.string.equal:
                            dataIn:
                              string1: =..formData.prescriptionCount
                              string2: =..apiRequest.prescription.docReq.name.data.prescriptionCount
                        - continue
                        - actionType: popUp
                          popUpView: checkView
                          wait: true
                          popUpDismiss: 2000
                # 签名处理
                - actionType: saveSignature
                  dataObject: BLOB
                  dataKey: Prescription.apiRequest.newSign.docReq.name.data
                  isEmpty: Prescription.formData.whetherSign

                # 保存签名
                - actionType: evalObject
                  object:
                    # 签名reid指向 doc 的id
                    - ..apiRequest.newSign.docReq.reid@: =.Prescription.apiRequest.prescription.docReq.id

                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.whetherSign
                        - continue
                        - =..apiRequest.newSign.docAPI.store: ""

                #  指定 eid 和 reid
                - actionType: evalObject
                  object:
                    - ..apiRequest.prescription.docReq.eid@: =.Global.currentRoom.edge.id
                    - ..apiRequest.prescription.docReq.reid@: =.Global.roomInfo.edge.id

                # 签名处理
                - actionType: evalObject
                  object:
                    - if:
                        - =..formData.temporarySignature
                        - actionType: evalObject
                          object:
                            - ..apiRequest.prescription.docReq.name.data.signatureTime@: =..formData.signatureTime
                            - ..apiRequest.prescription.docReq.name.data.signatureId@: =..formData.temporarySignature
                            - ..apiRequest.prescription.docReq.name.data.whetherSign@: false
                            - ..formData.whetherSign@: false
                        - actionType: evalObject
                          object:
                            - ..apiRequest.prescription.docReq.name.data.signatureTime@: =..apiRequest.newSign.docRes.doc.ctime
                            - ..apiRequest.prescription.docReq.name.data.signatureId@: =..apiRequest.newSign.docRes.doc.id
                            - ..apiRequest.prescription.docReq.name.data.whetherSign@: =..formData.whetherSign

                - actionType: evalObject
                  object:
                    - if:
                        - =.Prescription.formData.whetherSign
                        - actionType: popUp
                          popUpView: BaseWarningView
                          wait: true
                          popUpDismiss: 2000
                        - continue

                #  修改type
                - actionType: evalObject
                  object:
                    - =.builtIn.number.inhx:
                        dataIn:
                          intHex: =..apiRequest.prescription.docReq.type
                          index: 1
                          hex: 1
                        dataOut: Prescription.apiRequest.prescription.docReq.type

                - actionType: evalObject
                  object:
                    - =.builtIn.utils.createAuditLog:
                        dataIn:
                          actionTypeCode: .ActionTypeCode.create
                          recordTypeCode: 2049
                          eid: =.Global.formData.currentFacility.relationEdge.id

                          user: =.Global.MyProfile.name.data.fullName
                          userId: =.Global.currentUser.vertex.id
                          targetUserId: =.Global.formData.auditLog.patientId
                          targetUser: =.Global.formData.auditLog.patientName
                          accessPort: provider
                        dataOut: Global.formData.auditLog.result

                # 对话弹窗
                - actionType: popUp
                  popUpView: dialogueTag
                # - actionType: evalObject
                #   object:
                #     # 更新文档状态
                #     - ..apiRequest.prescription.docReq.name.data.statusTag.name@: "Released"
                #     - ..apiRequest.prescription.docReq.name.data.statusTag.fontColor@: "0x2988e6"
                #     - ..apiRequest.prescription.docReq.name.data.statusTag.backgroundColor@: "0xdfedfc"

                # # 保存newNote
                # - actionType: evalObject
                #   object:
                #     - =..apiRequest.prescription.docAPI.store: ""
                #     - =.builtIn.array.add:
                #         dataIn:
                #           object: =.Global.currentMeetingDoc
                #           value: =..apiRequest.prescription.docResp.doc
                # - actionType: evalObject
                #   object:
                #     .Global._nonce@:
                #       =.builtIn.math.random: ""

                # - actionType: evalObject
                #   object:
                #     - goto: ProviderNoteSelect
    - .Normal:
      message: "Do you want the patient to see it?"
      viewTag: dialogueTag
      leftText: "No"
      rightText: "Yes"
      leftButton:
        # 保存newNote
        - actionType: evalObject
          object:
            # 修改tage
            - ..apiRequest.prescription.docReq.tage@: 1
            - =..apiRequest.prescription.docAPI.store: ""

        - actionType: evalObject
          object:
            .Global._nonce@:
              =.builtIn.math.random: ""

        - actionType: popUpDismiss
          popUpView: dialogueTag

        - actionType: popUp
          popUpView: successTag

        # 返回路径
        - actionType: evalObject
          object:
            - goto: ProviderNoteSelect

      rightButton:
        # 更新文档状态
        - actionType: evalObject
          object:
            - ..apiRequest.prescription.docReq.name.data.statusTag.name@: Released
            - ..apiRequest.prescription.docReq.name.data.statusTag.fontColor@: "0x2988e6"
            - ..apiRequest.prescription.docReq.name.data.statusTag.backgroundColor@: "0xdfedfc"

        # 保存newNote
        - actionType: evalObject
          object:
            # 修改tage
            - ..apiRequest.prescription.docReq.tage@: -1
            - =..apiRequest.prescription.docAPI.store: ""

        - actionType: evalObject
          object:
            .Global._nonce@:
              =.builtIn.math.random: ""

        - actionType: popUpDismiss
          popUpView: dialogueTag

        - actionType: popUp
          popUpView: successTag

        - actionType: evalObject
          object:
            - goto: ProviderNoteSelect

    - .publicDeleteUP:
      viewTag: BaseDelWarningView
      leftButton:
        - actionType: popUpDismiss
          popUpView: BaseDelWarningView
      rightButton:
        - actionType: evalObject
          object:
            - =.builtIn.array.removeByName:
                dataIn:
                  object: =.Prescription.prescription2
                  key: drugName
                  name: =..formData.selectedItem.drugName
            - =.builtIn.array.removeByName:
                dataIn:
                  object: =..apiRequest.prescription.docReq.name.data.prescriptionArray
                  key: drugName
                  name: =..formData.selectedItem.drugName
        - actionType: evalObject
          object:
            - =.builtIn.array.getListLength:
                dataIn:
                  object: =.Prescription.prescription2
                dataOut: Prescription.formData.prescriptionLength
        - actionType: evalObject
          object:
            - if:
                - =.builtIn.string.equal:
                    dataIn:
                      string1: =..formData.prescriptionLength
                      string2: "0"
                - ..formData.formShow@: "none"
                - ..formData.formShow@: "block"
        - actionType: builtIn
          funcName: redraw
          viewTag: prescriptionTag
        - actionType: popUpDismiss
          popUpView: BaseDelWarningView

    - .Normal:
      message: "Do you want the patient to see it?"
      viewTag: dialogueTag
      leftText: "No"
      rightText: "Yes"
      leftButton:
        # 保存newNote
        - actionType: evalObject
          object:
            # 修改tage
            - ..apiRequest.prescription.docReq.tage@: 1
            - =..apiRequest.prescription.docAPI.store: ""

        - actionType: evalObject
          object:
            .Global._nonce@:
              =.builtIn.math.random: ""

        - actionType: popUpDismiss
          popUpView: dialogueTag

        - actionType: popUp
          popUpView: successTag

        # 返回路径
        - actionType: evalObject
          object:
            - goto: ProviderNoteSelect

      rightButton:
        # 更新文档状态
        - actionType: evalObject
          object:
            - ..apiRequest.prescription.docReq.name.data.statusTag.name@: Released
            - ..apiRequest.prescription.docReq.name.data.statusTag.fontColor@: "0x2988e6"
            - ..apiRequest.prescription.docReq.name.data.statusTag.backgroundColor@: "0xdfedfc"

        # 保存newNote
        - actionType: evalObject
          object:
            # 修改tage
            - ..apiRequest.prescription.docReq.tage@: -1
            - =..apiRequest.prescription.docAPI.store: ""

        - actionType: evalObject
          object:
            .Global._nonce@:
              =.builtIn.math.random: ""

        - actionType: popUpDismiss
          popUpView: dialogueTag

        - actionType: popUp
          popUpView: successTag

        - actionType: evalObject
          object:
            - goto: ProviderNoteSelect

    - .BaseWarningView:
      message: "Please fill in the Drug first."
      viewTag: addWarnTag

    - .BaseWarningView:
      message: "Please add prescription first."
      viewTag: inputWarn

    - .BaseWarningView:
      message: "You haven't signed the form"

    - .BaseWarningView:
      viewTag: checkView
      message:
        "The count of prescriptions is inconformity"
        #成功提示
    - .SuccessfulOneLine:
      message: "Successfully"
      viewTag: successTag
